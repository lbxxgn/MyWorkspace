var sjcl = {
    cipher: {}
};
sjcl.cipher.aes = function(a) {
    this.a[0][0][0] || this.d();
    var d,
        c,
        g,
        b,
        e = this.a[0][4],
        f = this.a[1];
    d = a.length;
    var j = 1;
    this.c = [
        g = a.slice(0),
        b = []
    ];
    for (a = d; a < 4 * d + 28; a++) {
        c = g[a - 1];
        if (a % d === 0 || d === 8 && a % d === 4) {
            c = e[c >>> 24] << 24 ^ e[c >> 16 & 255] << 16 ^ e[c >> 8 & 255] << 8 ^ e[c & 255];
            if (a % d === 0) {
                c = c << 8 ^ c >>> 24 ^ j << 24;
                j = j << 1 ^ (j >> 7) * 283
            }
        }
        g[a] = g[a - d] ^ c
    }
    for (d = 0; a; d++, a--) {
        c = g[d & 3 ? a : a - 4];
        b[d] = a <= 4 || d < 4 ? c : f[0][e[c >>> 24]] ^ f[1][e[c >> 16 & 255]] ^ f[2][e[c >> 8 & 255]] ^ f[3][e[c & 255]]
    }
};
sjcl.cipher.aes.prototype = {
    encrypt: function(a) {
        return this.b(a, 0)
    },
    decrypt: function(a) {
        return this.b(a, 1)
    },
    a: [
        [
            [],
            [],
            [],
            [],
            []
        ],
        [
            [],
            [],
            [],
            [],
            []
        ]
    ],
    d: function() {
        var a = this.a[0],
            d = this.a[1],
            c = a[4],
            g = d[4],
            b,
            e,
            f,
            j = [],
            l = [],
            m,
            i,
            h,
            k;
        for (b = 0; b < 256; b++) l[(j[b] = b << 1 ^ (b >> 7) * 283) ^ b] = b;
        for (e = f = 0; !c[e]; e ^= m || 1, f = l[f] || 1) {
            h = f ^ f << 1 ^ f << 2 ^ f << 3 ^ f << 4;
            h = h >> 8 ^ h & 255 ^ 99;
            c[e] = h;
            g[h] = e;
            i = j[b = j[m = j[e]]];
            k = i * 16843009 ^ b * 65537 ^ m * 257 ^ e * 16843008;
            i = j[h] * 257 ^ h * 16843008;
            for (b = 0; b < 4; b++) {
                a[b][e] = i = i << 24 ^ i >>> 8;
                d[b][h] = k = k << 24 ^ k >>> 8
            }
        }
        for (b = 0; b < 5; b++) {
            a[b] = a[b].slice(0);
            d[b] = d[b].slice(0)
        }
    },
    b: function(a, d) {
        var c = this.c[d],
            g = a[0] ^ c[0],
            b = a[d ? 3 : 1] ^ c[1],
            e = a[2] ^ c[2];
        a = a[d ? 1 : 3] ^ c[3];
        var f,
            j,
            l,
            m = c.length / 4 - 2,
            i,
            h = 4,
            k = [
                0,
                0,
                0,
                0
            ];
        f = this.a[d];
        var n = f[0],
            o = f[1],
            p = f[2],
            q = f[3],
            r = f[4];
        for (i = 0; i < m; i++) {
            f = n[g >>> 24] ^ o[b >> 16 & 255] ^ p[e >> 8 & 255] ^ q[a & 255] ^ c[h];
            j = n[b >>> 24] ^ o[e >> 16 & 255] ^ p[a >> 8 & 255] ^ q[g & 255] ^ c[h + 1];
            l = n[e >>> 24] ^ o[a >> 16 & 255] ^ p[g >> 8 & 255] ^ q[b & 255] ^ c[h + 2];
            a = n[a >>> 24] ^ o[g >> 16 & 255] ^ p[b >> 8 & 255] ^ q[e & 255] ^ c[h + 3];
            h += 4;
            g = f;
            b = j;
            e = l
        }
        for (i = 0; i < 4; i++) {
            k[d ? 3 & -i : i] = r[g >>> 24] << 24 ^ r[b >> 16 & 255] << 16 ^ r[e >> 8 & 255] << 8 ^ r[a & 255] ^ c[h++];
            f = g;
            g = b;
            b = e;
            e = a;
            a = f
        }
        return k
    }
};
! function(a, b) {
    'use strict';

    function c() {
        var a = Error.apply(this, arguments);
        this.message = a.message,
        this.stack = a.stack
    }

    function d() {
        var a = Error.apply(this, arguments);
        this.message = a.message,
        this.stack = a.stack
    }

    function e() {
        var a = Error.apply(this, arguments);
        this.message = a.message,
        this.stack = a.stack
    }

    function f(a) {
        var b,
            c = a.length,
            d = new Uint8Array(c);
        for (b = 0; c > b; b += 1) d[b] = a.charCodeAt(b);
        return d
    }

    function g(a) {
        var b,
            c = [],
            d = a.length;
        for (1 & d && (a = '0' + a, d++), b = 0; d > b; b += 2) c.push(parseInt(a.substr(b, 2), 16));
        return new Uint8Array(c)
    }

    function h(a) {
        return f(atob(a))
    }

    function i(a) {
        for (var b = '', c = 0; c < a.length; c++) b += String.fromCharCode(a[c]);
        return b
    }

    function j(a) {
        for (var b = (a.byteLength || a.length) / a.length, c = '', d = 0; d < a.length; d++) {
            var e = a[d].toString(16);
            e.length < 2 * b && (c += '00000000000000'.substr(0, 2 * b - e.length)),
            c += e
        }
        return c
    }

    function k(a) {
        return btoa(i(a))
    }

    function l(a) {
        return a -= 1,
            a |= a >>> 1,
            a |= a >>> 2,
            a |= a >>> 4,
            a |= a >>> 8,
            a |= a >>> 16,
            a += 1
    }

    function m(a) {
        return 'number' == typeof a
    }

    function n(a) {
        return 'string' == typeof a
    }

    function o(a) {
        return a instanceof ArrayBuffer
    }

    function p(a) {
        return a instanceof Uint8Array
    }

    function q(a) {
        return a instanceof Int8Array || a instanceof Uint8Array || a instanceof Int16Array || a instanceof Uint16Array || a instanceof Int32Array || a instanceof Uint32Array || a instanceof Float32Array || a instanceof Float64Array
    }

    function r(a, b, c) {
        'use asm';
        var d = 0,
            e = 0,
            f = 0,
            g = 0,
            h = 0,
            i = 0,
            j = 0,
            k = 0,
            l = 0,
            m = 0,
            n = 0,
            o = 0,
            p = 0,
            q = 0,
            s = 0,
            t = 0;
        var u = 0;
        var v = 0,
            w = 0,
            x = 0,
            y = 0,
            z = 0,
            A = 0,
            B = 0,
            C = 0,
            D = 0,
            E = 0,
            F = 0,
            G = 0,
            H = 0,
            I = 0,
            J = 0,
            K = 0,
            L = 0,
            M = 0,
            N = 0,
            O = 0,
            P = 0,
            Q = 0,
            R = 0,
            S = 0,
            T = 0,
            U = 0,
            V = 0,
            W = 0,
            X = 0,
            Y = 0,
            Z = 0,
            $ = 0,
            _ = 0,
            ab = 0,
            bb = 0,
            cb = 0,
            db = 0,
            eb = 0,
            fb = 0,
            gb = 0,
            hb = 0,
            ib = 0,
            jb = 0,
            kb = 0,
            lb = 0,
            mb = 0,
            nb = 0,
            ob = 0,
            pb = 0,
            qb = 0,
            rb = 0,
            sb = 0,
            tb = 0,
            ub = 0,
            vb = 0,
            wb = 0,
            xb = 0,
            yb = 0,
            zb = 0,
            Ab = 0,
            Bb = 0,
            Cb = 0,
            Db = 0,
            Eb = 0,
            Fb = 0,
            Gb = 0,
            Hb = 0,
            Ib = 0,
            Jb = 0,
            Kb = 0,
            Lb = 0,
            Mb = 0,
            Nb = 0,
            Ob = 0,
            Pb = 0,
            Qb = 0,
            Rb = 0,
            Sb = 0,
            Tb = 0,
            Ub = 0,
            Vb = 0,
            Wb = 0,
            Xb = 0,
            Yb = 0,
            Zb = 0,
            $b = 0,
            _b = 0,
            ac = 0,
            bc = 0,
            cc = 0,
            dc = 0,
            ec = 0,
            fc = 0,
            gc = 0,
            hc = 0,
            ic = 0,
            jc = 0,
            kc = 0,
            lc = 0,
            mc = 0,
            nc = 0,
            oc = 0,
            pc = 0,
            qc = 0,
            rc = 0,
            sc = 0,
            tc = 0,
            uc = 0,
            vc = 0,
            wc = 0,
            xc = 0,
            yc = 0,
            zc = 0,
            Ac = 0,
            Bc = 0,
            Cc = 0,
            Dc = 0,
            Ec = 0,
            Fc = 0,
            Gc = 0,
            Hc = 0,
            Ic = 0,
            Jc = 0,
            Kc = 0,
            Lc = 0,
            Mc = 0,
            Nc = 0,
            Oc = 0,
            Pc = 0,
            Qc = 0,
            Rc = 0,
            Sc = 0,
            Tc = 0,
            Uc = 0,
            Vc = 0,
            Wc = 0,
            Xc = 0,
            Yc = 0,
            Zc = 0,
            $c = 0,
            _c = 0,
            ad = 0,
            bd = 0,
            cd = 0,
            dd = 0,
            ed = 0,
            fd = 0,
            gd = 0,
            hd = 0,
            id = 0,
            jd = 0,
            kd = 0,
            ld = 0,
            md = 0,
            nd = 0,
            od = 0,
            pd = 0,
            qd = 0,
            rd = 0,
            sd = 0,
            td = 0,
            ud = 0,
            vd = 0,
            wd = 0,
            xd = 0,
            yd = 0,
            zd = 0,
            Ad = 0,
            Bd = 0,
            Cd = 0,
            Dd = 0,
            Ed = 0,
            Fd = 0,
            Gd = 0,
            Hd = 0,
            Id = 0,
            Jd = 0,
            Kd = 0,
            Ld = 0,
            Md = 0,
            Nd = 0,
            Od = 0,
            Pd = 0,
            Qd = 0,
            Rd = 0,
            Sd = 0,
            Td = 0,
            Ud = 0,
            Vd = 0,
            Wd = 0,
            Xd = 0,
            Yd = 0,
            Zd = 0,
            $d = 0,
            _d = 0,
            ae = 0,
            be = 0,
            ce = 0,
            de = 0,
            ee = 0,
            fe = 0,
            ge = 0,
            he = 0,
            ie = 0,
            je = 0,
            ke = 0,
            le = 0,
            me = 0,
            ne = 0,
            oe = 0,
            pe = 0,
            qe = 0,
            re = 0,
            se = 0,
            te = 0,
            ue = 0,
            ve = 0,
            we = 0,
            xe = 0,
            ye = 0,
            ze = 0,
            Ae = 0,
            Be = 0,
            Ce = 0,
            De = 0,
            Ee = 0,
            Fe = 0,
            Ge = 0,
            He = 0,
            Ie = 0,
            Je = 0,
            Ke = 0,
            Le = 0,
            Me = 0,
            Ne = 0,
            Oe = 0,
            Pe = 0,
            Qe = 0,
            Re = 0,
            Se = 0;
        var Te = new a.Uint8Array(c);

        function Ue() {
            var kf = 0;
            L = v ^ Te[kf | I] ^ 1;
            M = w ^ Te[kf | J];
            N = x ^ Te[kf | K];
            O = y ^ Te[kf | H];
            P = z ^ L;
            Q = A ^ M;
            R = B ^ N;
            S = C ^ O;
            T = D ^ P;
            U = E ^ Q;
            V = F ^ R;
            W = G ^ S;
            X = H ^ T;
            Y = I ^ U;
            Z = J ^ V;
            $ = K ^ W;
            _ = L ^ Te[kf | Y] ^ 2;
            ab = M ^ Te[kf | Z];
            bb = N ^ Te[kf | $];
            cb = O ^ Te[kf | X];
            db = P ^ _;
            eb = Q ^ ab;
            fb = R ^ bb;
            gb = S ^ cb;
            hb = T ^ db;
            ib = U ^ eb;
            jb = V ^ fb;
            kb = W ^ gb;
            lb = X ^ hb;
            mb = Y ^ ib;
            nb = Z ^ jb;
            ob = $ ^ kb;
            pb = _ ^ Te[kf | mb] ^ 4;
            qb = ab ^ Te[kf | nb];
            rb = bb ^ Te[kf | ob];
            sb = cb ^ Te[kf | lb];
            tb = db ^ pb;
            ub = eb ^ qb;
            vb = fb ^ rb;
            wb = gb ^ sb;
            xb = hb ^ tb;
            yb = ib ^ ub;
            zb = jb ^ vb;
            Ab = kb ^ wb;
            Bb = lb ^ xb;
            Cb = mb ^ yb;
            Db = nb ^ zb;
            Eb = ob ^ Ab;
            Fb = pb ^ Te[kf | Cb] ^ 8;
            Gb = qb ^ Te[kf | Db];
            Hb = rb ^ Te[kf | Eb];
            Ib = sb ^ Te[kf | Bb];
            Jb = tb ^ Fb;
            Kb = ub ^ Gb;
            Lb = vb ^ Hb;
            Mb = wb ^ Ib;
            Nb = xb ^ Jb;
            Ob = yb ^ Kb;
            Pb = zb ^ Lb;
            Qb = Ab ^ Mb;
            Rb = Bb ^ Nb;
            Sb = Cb ^ Ob;
            Tb = Db ^ Pb;
            Ub = Eb ^ Qb;
            Vb = Fb ^ Te[kf | Sb] ^ 16;
            Wb = Gb ^ Te[kf | Tb];
            Xb = Hb ^ Te[kf | Ub];
            Yb = Ib ^ Te[kf | Rb];
            Zb = Jb ^ Vb;
            $b = Kb ^ Wb;
            _b = Lb ^ Xb;
            ac = Mb ^ Yb;
            bc = Nb ^ Zb;
            cc = Ob ^ $b;
            dc = Pb ^ _b;
            ec = Qb ^ ac;
            fc = Rb ^ bc;
            gc = Sb ^ cc;
            hc = Tb ^ dc;
            ic = Ub ^ ec;
            jc = Vb ^ Te[kf | gc] ^ 32;
            kc = Wb ^ Te[kf | hc];
            lc = Xb ^ Te[kf | ic];
            mc = Yb ^ Te[kf | fc];
            nc = Zb ^ jc;
            oc = $b ^ kc;
            pc = _b ^ lc;
            qc = ac ^ mc;
            rc = bc ^ nc;
            sc = cc ^ oc;
            tc = dc ^ pc;
            uc = ec ^ qc;
            vc = fc ^ rc;
            wc = gc ^ sc;
            xc = hc ^ tc;
            yc = ic ^ uc;
            zc = jc ^ Te[kf | wc] ^ 64;
            Ac = kc ^ Te[kf | xc];
            Bc = lc ^ Te[kf | yc];
            Cc = mc ^ Te[kf | vc];
            Dc = nc ^ zc;
            Ec = oc ^ Ac;
            Fc = pc ^ Bc;
            Gc = qc ^ Cc;
            Hc = rc ^ Dc;
            Ic = sc ^ Ec;
            Jc = tc ^ Fc;
            Kc = uc ^ Gc;
            Lc = vc ^ Hc;
            Mc = wc ^ Ic;
            Nc = xc ^ Jc;
            Oc = yc ^ Kc;
            Pc = zc ^ Te[kf | Mc] ^ 128;
            Qc = Ac ^ Te[kf | Nc];
            Rc = Bc ^ Te[kf | Oc];
            Sc = Cc ^ Te[kf | Lc];
            Tc = Dc ^ Pc;
            Uc = Ec ^ Qc;
            Vc = Fc ^ Rc;
            Wc = Gc ^ Sc;
            Xc = Hc ^ Tc;
            Yc = Ic ^ Uc;
            Zc = Jc ^ Vc;
            $c = Kc ^ Wc;
            _c = Lc ^ Xc;
            ad = Mc ^ Yc;
            bd = Nc ^ Zc;
            cd = Oc ^ $c;
            dd = Pc ^ Te[kf | ad] ^ 27;
            ed = Qc ^ Te[kf | bd];
            fd = Rc ^ Te[kf | cd];
            gd = Sc ^ Te[kf | _c];
            hd = Tc ^ dd;
            id = Uc ^ ed;
            jd = Vc ^ fd;
            kd = Wc ^ gd;
            ld = Xc ^ hd;
            md = Yc ^ id;
            nd = Zc ^ jd;
            od = $c ^ kd;
            pd = _c ^ ld;
            qd = ad ^ md;
            rd = bd ^ nd;
            sd = cd ^ od;
            td = dd ^ Te[kf | qd] ^ 54;
            ud = ed ^ Te[kf | rd];
            vd = fd ^ Te[kf | sd];
            wd = gd ^ Te[kf | pd];
            xd = hd ^ td;
            yd = id ^ ud;
            zd = jd ^ vd;
            Ad = kd ^ wd;
            Bd = ld ^ xd;
            Cd = md ^ yd;
            Dd = nd ^ zd;
            Ed = od ^ Ad;
            Fd = pd ^ Bd;
            Gd = qd ^ Cd;
            Hd = rd ^ Dd;
            Id = sd ^ Ed
        }

        function Ve() {
            var kf = 0;
            _ = v ^ Te[kf | Y] ^ 1;
            ab = w ^ Te[kf | Z];
            bb = x ^ Te[kf | $];
            cb = y ^ Te[kf | X];
            db = z ^ _;
            eb = A ^ ab;
            fb = B ^ bb;
            gb = C ^ cb;
            hb = D ^ db;
            ib = E ^ eb;
            jb = F ^ fb;
            kb = G ^ gb;
            lb = H ^ hb;
            mb = I ^ ib;
            nb = J ^ jb;
            ob = K ^ kb;
            pb = L ^ Te[kf | lb];
            qb = M ^ Te[kf | mb];
            rb = N ^ Te[kf | nb];
            sb = O ^ Te[kf | ob];
            tb = P ^ pb;
            ub = Q ^ qb;
            vb = R ^ rb;
            wb = S ^ sb;
            xb = T ^ tb;
            yb = U ^ ub;
            zb = V ^ vb;
            Ab = W ^ wb;
            Bb = X ^ xb;
            Cb = Y ^ yb;
            Db = Z ^ zb;
            Eb = $ ^ Ab;
            Fb = _ ^ Te[kf | Cb] ^ 2;
            Gb = ab ^ Te[kf | Db];
            Hb = bb ^ Te[kf | Eb];
            Ib = cb ^ Te[kf | Bb];
            Jb = db ^ Fb;
            Kb = eb ^ Gb;
            Lb = fb ^ Hb;
            Mb = gb ^ Ib;
            Nb = hb ^ Jb;
            Ob = ib ^ Kb;
            Pb = jb ^ Lb;
            Qb = kb ^ Mb;
            Rb = lb ^ Nb;
            Sb = mb ^ Ob;
            Tb = nb ^ Pb;
            Ub = ob ^ Qb;
            Vb = pb ^ Te[kf | Rb];
            Wb = qb ^ Te[kf | Sb];
            Xb = rb ^ Te[kf | Tb];
            Yb = sb ^ Te[kf | Ub];
            Zb = tb ^ Vb;
            $b = ub ^ Wb;
            _b = vb ^ Xb;
            ac = wb ^ Yb;
            bc = xb ^ Zb;
            cc = yb ^ $b;
            dc = zb ^ _b;
            ec = Ab ^ ac;
            fc = Bb ^ bc;
            gc = Cb ^ cc;
            hc = Db ^ dc;
            ic = Eb ^ ec;
            jc = Fb ^ Te[kf | gc] ^ 4;
            kc = Gb ^ Te[kf | hc];
            lc = Hb ^ Te[kf | ic];
            mc = Ib ^ Te[kf | fc];
            nc = Jb ^ jc;
            oc = Kb ^ kc;
            pc = Lb ^ lc;
            qc = Mb ^ mc;
            rc = Nb ^ nc;
            sc = Ob ^ oc;
            tc = Pb ^ pc;
            uc = Qb ^ qc;
            vc = Rb ^ rc;
            wc = Sb ^ sc;
            xc = Tb ^ tc;
            yc = Ub ^ uc;
            zc = Vb ^ Te[kf | vc];
            Ac = Wb ^ Te[kf | wc];
            Bc = Xb ^ Te[kf | xc];
            Cc = Yb ^ Te[kf | yc];
            Dc = Zb ^ zc;
            Ec = $b ^ Ac;
            Fc = _b ^ Bc;
            Gc = ac ^ Cc;
            Hc = bc ^ Dc;
            Ic = cc ^ Ec;
            Jc = dc ^ Fc;
            Kc = ec ^ Gc;
            Lc = fc ^ Hc;
            Mc = gc ^ Ic;
            Nc = hc ^ Jc;
            Oc = ic ^ Kc;
            Pc = jc ^ Te[kf | Mc] ^ 8;
            Qc = kc ^ Te[kf | Nc];
            Rc = lc ^ Te[kf | Oc];
            Sc = mc ^ Te[kf | Lc];
            Tc = nc ^ Pc;
            Uc = oc ^ Qc;
            Vc = pc ^ Rc;
            Wc = qc ^ Sc;
            Xc = rc ^ Tc;
            Yc = sc ^ Uc;
            Zc = tc ^ Vc;
            $c = uc ^ Wc;
            _c = vc ^ Xc;
            ad = wc ^ Yc;
            bd = xc ^ Zc;
            cd = yc ^ $c;
            dd = zc ^ Te[kf | _c];
            ed = Ac ^ Te[kf | ad];
            fd = Bc ^ Te[kf | bd];
            gd = Cc ^ Te[kf | cd];
            hd = Dc ^ dd;
            id = Ec ^ ed;
            jd = Fc ^ fd;
            kd = Gc ^ gd;
            ld = Hc ^ hd;
            md = Ic ^ id;
            nd = Jc ^ jd;
            od = Kc ^ kd;
            pd = Lc ^ ld;
            qd = Mc ^ md;
            rd = Nc ^ nd;
            sd = Oc ^ od;
            td = Pc ^ Te[kf | qd] ^ 16;
            ud = Qc ^ Te[kf | rd];
            vd = Rc ^ Te[kf | sd];
            wd = Sc ^ Te[kf | pd];
            xd = Tc ^ td;
            yd = Uc ^ ud;
            zd = Vc ^ vd;
            Ad = Wc ^ wd;
            Bd = Xc ^ xd;
            Cd = Yc ^ yd;
            Dd = Zc ^ zd;
            Ed = $c ^ Ad;
            Fd = _c ^ Bd;
            Gd = ad ^ Cd;
            Hd = bd ^ Dd;
            Id = cd ^ Ed;
            Jd = dd ^ Te[kf | Fd];
            Kd = ed ^ Te[kf | Gd];
            Ld = fd ^ Te[kf | Hd];
            Md = gd ^ Te[kf | Id];
            Nd = hd ^ Jd;
            Od = id ^ Kd;
            Pd = jd ^ Ld;
            Qd = kd ^ Md;
            Rd = ld ^ Nd;
            Sd = md ^ Od;
            Td = nd ^ Pd;
            Ud = od ^ Qd;
            Vd = pd ^ Rd;
            Wd = qd ^ Sd;
            Xd = rd ^ Td;
            Yd = sd ^ Ud;
            Zd = td ^ Te[kf | Wd] ^ 32;
            $d = ud ^ Te[kf | Xd];
            _d = vd ^ Te[kf | Yd];
            ae = wd ^ Te[kf | Vd];
            be = xd ^ Zd;
            ce = yd ^ $d;
            de = zd ^ _d;
            ee = Ad ^ ae;
            fe = Bd ^ be;
            ge = Cd ^ ce;
            he = Dd ^ de;
            ie = Ed ^ ee;
            je = Fd ^ fe;
            ke = Gd ^ ge;
            le = Hd ^ he;
            me = Id ^ ie;
            ne = Jd ^ Te[kf | je];
            oe = Kd ^ Te[kf | ke];
            pe = Ld ^ Te[kf | le];
            qe = Md ^ Te[kf | me];
            re = Nd ^ ne;
            se = Od ^ oe;
            te = Pd ^ pe;
            ue = Qd ^ qe;
            ve = Rd ^ re;
            we = Sd ^ se;
            xe = Td ^ te;
            ye = Ud ^ ue;
            ze = Vd ^ ve;
            Ae = Wd ^ we;
            Be = Xd ^ xe;
            Ce = Yd ^ ye;
            De = Zd ^ Te[kf | Ae] ^ 64;
            Ee = $d ^ Te[kf | Be];
            Fe = _d ^ Te[kf | Ce];
            Ge = ae ^ Te[kf | ze];
            He = be ^ De;
            Ie = ce ^ Ee;
            Je = de ^ Fe;
            Ke = ee ^ Ge;
            Le = fe ^ He;
            Me = ge ^ Ie;
            Ne = he ^ Je;
            Oe = ie ^ Ke;
            Pe = je ^ Le;
            Qe = ke ^ Me;
            Re = le ^ Ne;
            Se = me ^ Oe
        }

        function We(kf, lf, mf, nf, of, pf, qf, rf, sf, tf, uf, vf, wf, xf, yf, zf) {
            kf = kf | 0;
            lf = lf | 0;
            mf = mf | 0;
            nf = nf | 0;
            of = of | 0;
            pf = pf | 0;
            qf = qf | 0;
            rf = rf | 0;
            sf = sf | 0;
            tf = tf | 0;
            uf = uf | 0;
            vf = vf | 0;
            wf = wf | 0;
            xf = xf | 0;
            yf = yf | 0;
            zf = zf | 0;
            var Af = 0,
                Bf = 0,
                Cf = 0,
                Df = 0,
                Ef = 0,
                Ff = 0,
                Gf = 0,
                Hf = 0,
                If = 0,
                Jf = 0,
                Kf = 0,
                Lf = 0,
                Mf = 0,
                Nf = 0,
                Of = 0,
                Pf = 0,
                Qf = 0,
                Rf = 512,
                Sf = 768;
            kf = kf ^ v;
            lf = lf ^ w;
            mf = mf ^ x;
            nf = nf ^ y;
            of = of ^ z;
            pf = pf ^ A;
            qf = qf ^ B;
            rf = rf ^ C;
            sf = sf ^ D;
            tf = tf ^ E;
            uf = uf ^ F;
            vf = vf ^ G;
            wf = wf ^ H;
            xf = xf ^ I;
            yf = yf ^ J;
            zf = zf ^ K;
            Af = Te[Rf | kf] ^ Te[Sf | pf] ^ Te[Qf | uf] ^ Te[Qf | zf] ^ L;
            Bf = Te[Qf | kf] ^ Te[Rf | pf] ^ Te[Sf | uf] ^ Te[Qf | zf] ^ M;
            Cf = Te[Qf | kf] ^ Te[Qf | pf] ^ Te[Rf | uf] ^ Te[Sf | zf] ^ N;
            Df = Te[Sf | kf] ^ Te[Qf | pf] ^ Te[Qf | uf] ^ Te[Rf | zf] ^ O;
            Ef = Te[Rf | of] ^ Te[Sf | tf] ^ Te[Qf | yf] ^ Te[Qf | nf] ^ P;
            Ff = Te[Qf | of] ^ Te[Rf | tf] ^ Te[Sf | yf] ^ Te[Qf | nf] ^ Q;
            Gf = Te[Qf | of] ^ Te[Qf | tf] ^ Te[Rf | yf] ^ Te[Sf | nf] ^ R;
            Hf = Te[Sf | of] ^ Te[Qf | tf] ^ Te[Qf | yf] ^ Te[Rf | nf] ^ S;
            If = Te[Rf | sf] ^ Te[Sf | xf] ^ Te[Qf | mf] ^ Te[Qf | rf] ^ T;
            Jf = Te[Qf | sf] ^ Te[Rf | xf] ^ Te[Sf | mf] ^ Te[Qf | rf] ^ U;
            Kf = Te[Qf | sf] ^ Te[Qf | xf] ^ Te[Rf | mf] ^ Te[Sf | rf] ^ V;
            Lf = Te[Sf | sf] ^ Te[Qf | xf] ^ Te[Qf | mf] ^ Te[Rf | rf] ^ W;
            Mf = Te[Rf | wf] ^ Te[Sf | lf] ^ Te[Qf | qf] ^ Te[Qf | vf] ^ X;
            Nf = Te[Qf | wf] ^ Te[Rf | lf] ^ Te[Sf | qf] ^ Te[Qf | vf] ^ Y;
            Of = Te[Qf | wf] ^ Te[Qf | lf] ^ Te[Rf | qf] ^ Te[Sf | vf] ^ Z;
            Pf = Te[Sf | wf] ^ Te[Qf | lf] ^ Te[Qf | qf] ^ Te[Rf | vf] ^ $;
            kf = Te[Rf | Af] ^ Te[Sf | Ff] ^ Te[Qf | Kf] ^ Te[Qf | Pf] ^ _;
            lf = Te[Qf | Af] ^ Te[Rf | Ff] ^ Te[Sf | Kf] ^ Te[Qf | Pf] ^ ab;
            mf = Te[Qf | Af] ^ Te[Qf | Ff] ^ Te[Rf | Kf] ^ Te[Sf | Pf] ^ bb;
            nf = Te[Sf | Af] ^ Te[Qf | Ff] ^ Te[Qf | Kf] ^ Te[Rf | Pf] ^ cb;
            of = Te[Rf | Ef] ^ Te[Sf | Jf] ^ Te[Qf | Of] ^ Te[Qf | Df] ^ db;
            pf = Te[Qf | Ef] ^ Te[Rf | Jf] ^ Te[Sf | Of] ^ Te[Qf | Df] ^ eb;
            qf = Te[Qf | Ef] ^ Te[Qf | Jf] ^ Te[Rf | Of] ^ Te[Sf | Df] ^ fb;
            rf = Te[Sf | Ef] ^ Te[Qf | Jf] ^ Te[Qf | Of] ^ Te[Rf | Df] ^ gb;
            sf = Te[Rf | If] ^ Te[Sf | Nf] ^ Te[Qf | Cf] ^ Te[Qf | Hf] ^ hb;
            tf = Te[Qf | If] ^ Te[Rf | Nf] ^ Te[Sf | Cf] ^ Te[Qf | Hf] ^ ib;
            uf = Te[Qf | If] ^ Te[Qf | Nf] ^ Te[Rf | Cf] ^ Te[Sf | Hf] ^ jb;
            vf = Te[Sf | If] ^ Te[Qf | Nf] ^ Te[Qf | Cf] ^ Te[Rf | Hf] ^ kb;
            wf = Te[Rf | Mf] ^ Te[Sf | Bf] ^ Te[Qf | Gf] ^ Te[Qf | Lf] ^ lb;
            xf = Te[Qf | Mf] ^ Te[Rf | Bf] ^ Te[Sf | Gf] ^ Te[Qf | Lf] ^ mb;
            yf = Te[Qf | Mf] ^ Te[Qf | Bf] ^ Te[Rf | Gf] ^ Te[Sf | Lf] ^ nb;
            zf = Te[Sf | Mf] ^ Te[Qf | Bf] ^ Te[Qf | Gf] ^ Te[Rf | Lf] ^ ob;
            Af = Te[Rf | kf] ^ Te[Sf | pf] ^ Te[Qf | uf] ^ Te[Qf | zf] ^ pb;
            Bf = Te[Qf | kf] ^ Te[Rf | pf] ^ Te[Sf | uf] ^ Te[Qf | zf] ^ qb;
            Cf = Te[Qf | kf] ^ Te[Qf | pf] ^ Te[Rf | uf] ^ Te[Sf | zf] ^ rb;
            Df = Te[Sf | kf] ^ Te[Qf | pf] ^ Te[Qf | uf] ^ Te[Rf | zf] ^ sb;
            Ef = Te[Rf | of] ^ Te[Sf | tf] ^ Te[Qf | yf] ^ Te[Qf | nf] ^ tb;
            Ff = Te[Qf | of] ^ Te[Rf | tf] ^ Te[Sf | yf] ^ Te[Qf | nf] ^ ub;
            Gf = Te[Qf | of] ^ Te[Qf | tf] ^ Te[Rf | yf] ^ Te[Sf | nf] ^ vb;
            Hf = Te[Sf | of] ^ Te[Qf | tf] ^ Te[Qf | yf] ^ Te[Rf | nf] ^ wb;
            If = Te[Rf | sf] ^ Te[Sf | xf] ^ Te[Qf | mf] ^ Te[Qf | rf] ^ xb;
            Jf = Te[Qf | sf] ^ Te[Rf | xf] ^ Te[Sf | mf] ^ Te[Qf | rf] ^ yb;
            Kf = Te[Qf | sf] ^ Te[Qf | xf] ^ Te[Rf | mf] ^ Te[Sf | rf] ^ zb;
            Lf = Te[Sf | sf] ^ Te[Qf | xf] ^ Te[Qf | mf] ^ Te[Rf | rf] ^ Ab;
            Mf = Te[Rf | wf] ^ Te[Sf | lf] ^ Te[Qf | qf] ^ Te[Qf | vf] ^ Bb;
            Nf = Te[Qf | wf] ^ Te[Rf | lf] ^ Te[Sf | qf] ^ Te[Qf | vf] ^ Cb;
            Of = Te[Qf | wf] ^ Te[Qf | lf] ^ Te[Rf | qf] ^ Te[Sf | vf] ^ Db;
            Pf = Te[Sf | wf] ^ Te[Qf | lf] ^ Te[Qf | qf] ^ Te[Rf | vf] ^ Eb;
            kf = Te[Rf | Af] ^ Te[Sf | Ff] ^ Te[Qf | Kf] ^ Te[Qf | Pf] ^ Fb;
            lf = Te[Qf | Af] ^ Te[Rf | Ff] ^ Te[Sf | Kf] ^ Te[Qf | Pf] ^ Gb;
            mf = Te[Qf | Af] ^ Te[Qf | Ff] ^ Te[Rf | Kf] ^ Te[Sf | Pf] ^ Hb;
            nf = Te[Sf | Af] ^ Te[Qf | Ff] ^ Te[Qf | Kf] ^ Te[Rf | Pf] ^ Ib;
            of = Te[Rf | Ef] ^ Te[Sf | Jf] ^ Te[Qf | Of] ^ Te[Qf | Df] ^ Jb;
            pf = Te[Qf | Ef] ^ Te[Rf | Jf] ^ Te[Sf | Of] ^ Te[Qf | Df] ^ Kb;
            qf = Te[Qf | Ef] ^ Te[Qf | Jf] ^ Te[Rf | Of] ^ Te[Sf | Df] ^ Lb;
            rf = Te[Sf | Ef] ^ Te[Qf | Jf] ^ Te[Qf | Of] ^ Te[Rf | Df] ^ Mb;
            sf = Te[Rf | If] ^ Te[Sf | Nf] ^ Te[Qf | Cf] ^ Te[Qf | Hf] ^ Nb;
            tf = Te[Qf | If] ^ Te[Rf | Nf] ^ Te[Sf | Cf] ^ Te[Qf | Hf] ^ Ob;
            uf = Te[Qf | If] ^ Te[Qf | Nf] ^ Te[Rf | Cf] ^ Te[Sf | Hf] ^ Pb;
            vf = Te[Sf | If] ^ Te[Qf | Nf] ^ Te[Qf | Cf] ^ Te[Rf | Hf] ^ Qb;
            wf = Te[Rf | Mf] ^ Te[Sf | Bf] ^ Te[Qf | Gf] ^ Te[Qf | Lf] ^ Rb;
            xf = Te[Qf | Mf] ^ Te[Rf | Bf] ^ Te[Sf | Gf] ^ Te[Qf | Lf] ^ Sb;
            yf = Te[Qf | Mf] ^ Te[Qf | Bf] ^ Te[Rf | Gf] ^ Te[Sf | Lf] ^ Tb;
            zf = Te[Sf | Mf] ^ Te[Qf | Bf] ^ Te[Qf | Gf] ^ Te[Rf | Lf] ^ Ub;
            Af = Te[Rf | kf] ^ Te[Sf | pf] ^ Te[Qf | uf] ^ Te[Qf | zf] ^ Vb;
            Bf = Te[Qf | kf] ^ Te[Rf | pf] ^ Te[Sf | uf] ^ Te[Qf | zf] ^ Wb;
            Cf = Te[Qf | kf] ^ Te[Qf | pf] ^ Te[Rf | uf] ^ Te[Sf | zf] ^ Xb;
            Df = Te[Sf | kf] ^ Te[Qf | pf] ^ Te[Qf | uf] ^ Te[Rf | zf] ^ Yb;
            Ef = Te[Rf | of] ^ Te[Sf | tf] ^ Te[Qf | yf] ^ Te[Qf | nf] ^ Zb;
            Ff = Te[Qf | of] ^ Te[Rf | tf] ^ Te[Sf | yf] ^ Te[Qf | nf] ^ $b;
            Gf = Te[Qf | of] ^ Te[Qf | tf] ^ Te[Rf | yf] ^ Te[Sf | nf] ^ _b;
            Hf = Te[Sf | of] ^ Te[Qf | tf] ^ Te[Qf | yf] ^ Te[Rf | nf] ^ ac;
            If = Te[Rf | sf] ^ Te[Sf | xf] ^ Te[Qf | mf] ^ Te[Qf | rf] ^ bc;
            Jf = Te[Qf | sf] ^ Te[Rf | xf] ^ Te[Sf | mf] ^ Te[Qf | rf] ^ cc;
            Kf = Te[Qf | sf] ^ Te[Qf | xf] ^ Te[Rf | mf] ^ Te[Sf | rf] ^ dc;
            Lf = Te[Sf | sf] ^ Te[Qf | xf] ^ Te[Qf | mf] ^ Te[Rf | rf] ^ ec;
            Mf = Te[Rf | wf] ^ Te[Sf | lf] ^ Te[Qf | qf] ^ Te[Qf | vf] ^ fc;
            Nf = Te[Qf | wf] ^ Te[Rf | lf] ^ Te[Sf | qf] ^ Te[Qf | vf] ^ gc;
            Of = Te[Qf | wf] ^ Te[Qf | lf] ^ Te[Rf | qf] ^ Te[Sf | vf] ^ hc;
            Pf = Te[Sf | wf] ^ Te[Qf | lf] ^ Te[Qf | qf] ^ Te[Rf | vf] ^ ic;
            kf = Te[Rf | Af] ^ Te[Sf | Ff] ^ Te[Qf | Kf] ^ Te[Qf | Pf] ^ jc;
            lf = Te[Qf | Af] ^ Te[Rf | Ff] ^ Te[Sf | Kf] ^ Te[Qf | Pf] ^ kc;
            mf = Te[Qf | Af] ^ Te[Qf | Ff] ^ Te[Rf | Kf] ^ Te[Sf | Pf] ^ lc;
            nf = Te[Sf | Af] ^ Te[Qf | Ff] ^ Te[Qf | Kf] ^ Te[Rf | Pf] ^ mc;
            of = Te[Rf | Ef] ^ Te[Sf | Jf] ^ Te[Qf | Of] ^ Te[Qf | Df] ^ nc;
            pf = Te[Qf | Ef] ^ Te[Rf | Jf] ^ Te[Sf | Of] ^ Te[Qf | Df] ^ oc;
            qf = Te[Qf | Ef] ^ Te[Qf | Jf] ^ Te[Rf | Of] ^ Te[Sf | Df] ^ pc;
            rf = Te[Sf | Ef] ^ Te[Qf | Jf] ^ Te[Qf | Of] ^ Te[Rf | Df] ^ qc;
            sf = Te[Rf | If] ^ Te[Sf | Nf] ^ Te[Qf | Cf] ^ Te[Qf | Hf] ^ rc;
            tf = Te[Qf | If] ^ Te[Rf | Nf] ^ Te[Sf | Cf] ^ Te[Qf | Hf] ^ sc;
            uf = Te[Qf | If] ^ Te[Qf | Nf] ^ Te[Rf | Cf] ^ Te[Sf | Hf] ^ tc;
            vf = Te[Sf | If] ^ Te[Qf | Nf] ^ Te[Qf | Cf] ^ Te[Rf | Hf] ^ uc;
            wf = Te[Rf | Mf] ^ Te[Sf | Bf] ^ Te[Qf | Gf] ^ Te[Qf | Lf] ^ vc;
            xf = Te[Qf | Mf] ^ Te[Rf | Bf] ^ Te[Sf | Gf] ^ Te[Qf | Lf] ^ wc;
            yf = Te[Qf | Mf] ^ Te[Qf | Bf] ^ Te[Rf | Gf] ^ Te[Sf | Lf] ^ xc;
            zf = Te[Sf | Mf] ^ Te[Qf | Bf] ^ Te[Qf | Gf] ^ Te[Rf | Lf] ^ yc;
            Af = Te[Rf | kf] ^ Te[Sf | pf] ^ Te[Qf | uf] ^ Te[Qf | zf] ^ zc;
            Bf = Te[Qf | kf] ^ Te[Rf | pf] ^ Te[Sf | uf] ^ Te[Qf | zf] ^ Ac;
            Cf = Te[Qf | kf] ^ Te[Qf | pf] ^ Te[Rf | uf] ^ Te[Sf | zf] ^ Bc;
            Df = Te[Sf | kf] ^ Te[Qf | pf] ^ Te[Qf | uf] ^ Te[Rf | zf] ^ Cc;
            Ef = Te[Rf | of] ^ Te[Sf | tf] ^ Te[Qf | yf] ^ Te[Qf | nf] ^ Dc;
            Ff = Te[Qf | of] ^ Te[Rf | tf] ^ Te[Sf | yf] ^ Te[Qf | nf] ^ Ec;
            Gf = Te[Qf | of] ^ Te[Qf | tf] ^ Te[Rf | yf] ^ Te[Sf | nf] ^ Fc;
            Hf = Te[Sf | of] ^ Te[Qf | tf] ^ Te[Qf | yf] ^ Te[Rf | nf] ^ Gc;
            If = Te[Rf | sf] ^ Te[Sf | xf] ^ Te[Qf | mf] ^ Te[Qf | rf] ^ Hc;
            Jf = Te[Qf | sf] ^ Te[Rf | xf] ^ Te[Sf | mf] ^ Te[Qf | rf] ^ Ic;
            Kf = Te[Qf | sf] ^ Te[Qf | xf] ^ Te[Rf | mf] ^ Te[Sf | rf] ^ Jc;
            Lf = Te[Sf | sf] ^ Te[Qf | xf] ^ Te[Qf | mf] ^ Te[Rf | rf] ^ Kc;
            Mf = Te[Rf | wf] ^ Te[Sf | lf] ^ Te[Qf | qf] ^ Te[Qf | vf] ^ Lc;
            Nf = Te[Qf | wf] ^ Te[Rf | lf] ^ Te[Sf | qf] ^ Te[Qf | vf] ^ Mc;
            Of = Te[Qf | wf] ^ Te[Qf | lf] ^ Te[Rf | qf] ^ Te[Sf | vf] ^ Nc;
            Pf = Te[Sf | wf] ^ Te[Qf | lf] ^ Te[Qf | qf] ^ Te[Rf | vf] ^ Oc;
            kf = Te[Rf | Af] ^ Te[Sf | Ff] ^ Te[Qf | Kf] ^ Te[Qf | Pf] ^ Pc;
            lf = Te[Qf | Af] ^ Te[Rf | Ff] ^ Te[Sf | Kf] ^ Te[Qf | Pf] ^ Qc;
            mf = Te[Qf | Af] ^ Te[Qf | Ff] ^ Te[Rf | Kf] ^ Te[Sf | Pf] ^ Rc;
            nf = Te[Sf | Af] ^ Te[Qf | Ff] ^ Te[Qf | Kf] ^ Te[Rf | Pf] ^ Sc;
            of = Te[Rf | Ef] ^ Te[Sf | Jf] ^ Te[Qf | Of] ^ Te[Qf | Df] ^ Tc;
            pf = Te[Qf | Ef] ^ Te[Rf | Jf] ^ Te[Sf | Of] ^ Te[Qf | Df] ^ Uc;
            qf = Te[Qf | Ef] ^ Te[Qf | Jf] ^ Te[Rf | Of] ^ Te[Sf | Df] ^ Vc;
            rf = Te[Sf | Ef] ^ Te[Qf | Jf] ^ Te[Qf | Of] ^ Te[Rf | Df] ^ Wc;
            sf = Te[Rf | If] ^ Te[Sf | Nf] ^ Te[Qf | Cf] ^ Te[Qf | Hf] ^ Xc;
            tf = Te[Qf | If] ^ Te[Rf | Nf] ^ Te[Sf | Cf] ^ Te[Qf | Hf] ^ Yc;
            uf = Te[Qf | If] ^ Te[Qf | Nf] ^ Te[Rf | Cf] ^ Te[Sf | Hf] ^ Zc;
            vf = Te[Sf | If] ^ Te[Qf | Nf] ^ Te[Qf | Cf] ^ Te[Rf | Hf] ^ $c;
            wf = Te[Rf | Mf] ^ Te[Sf | Bf] ^ Te[Qf | Gf] ^ Te[Qf | Lf] ^ _c;
            xf = Te[Qf | Mf] ^ Te[Rf | Bf] ^ Te[Sf | Gf] ^ Te[Qf | Lf] ^ ad;
            yf = Te[Qf | Mf] ^ Te[Qf | Bf] ^ Te[Rf | Gf] ^ Te[Sf | Lf] ^ bd;
            zf = Te[Sf | Mf] ^ Te[Qf | Bf] ^ Te[Qf | Gf] ^ Te[Rf | Lf] ^ cd;
            Af = Te[Rf | kf] ^ Te[Sf | pf] ^ Te[Qf | uf] ^ Te[Qf | zf] ^ dd;
            Bf = Te[Qf | kf] ^ Te[Rf | pf] ^ Te[Sf | uf] ^ Te[Qf | zf] ^ ed;
            Cf = Te[Qf | kf] ^ Te[Qf | pf] ^ Te[Rf | uf] ^ Te[Sf | zf] ^ fd;
            Df = Te[Sf | kf] ^ Te[Qf | pf] ^ Te[Qf | uf] ^ Te[Rf | zf] ^ gd;
            Ef = Te[Rf | of] ^ Te[Sf | tf] ^ Te[Qf | yf] ^ Te[Qf | nf] ^ hd;
            Ff = Te[Qf | of] ^ Te[Rf | tf] ^ Te[Sf | yf] ^ Te[Qf | nf] ^ id;
            Gf = Te[Qf | of] ^ Te[Qf | tf] ^ Te[Rf | yf] ^ Te[Sf | nf] ^ jd;
            Hf = Te[Sf | of] ^ Te[Qf | tf] ^ Te[Qf | yf] ^ Te[Rf | nf] ^ kd;
            If = Te[Rf | sf] ^ Te[Sf | xf] ^ Te[Qf | mf] ^ Te[Qf | rf] ^ ld;
            Jf = Te[Qf | sf] ^ Te[Rf | xf] ^ Te[Sf | mf] ^ Te[Qf | rf] ^ md;
            Kf = Te[Qf | sf] ^ Te[Qf | xf] ^ Te[Rf | mf] ^ Te[Sf | rf] ^ nd;
            Lf = Te[Sf | sf] ^ Te[Qf | xf] ^ Te[Qf | mf] ^ Te[Rf | rf] ^ od;
            Mf = Te[Rf | wf] ^ Te[Sf | lf] ^ Te[Qf | qf] ^ Te[Qf | vf] ^ pd;
            Nf = Te[Qf | wf] ^ Te[Rf | lf] ^ Te[Sf | qf] ^ Te[Qf | vf] ^ qd;
            Of = Te[Qf | wf] ^ Te[Qf | lf] ^ Te[Rf | qf] ^ Te[Sf | vf] ^ rd;
            Pf = Te[Sf | wf] ^ Te[Qf | lf] ^ Te[Qf | qf] ^ Te[Rf | vf] ^ sd;
            if ((u | 0) == 16) {
                d = Te[Qf | Af] ^ td;
                e = Te[Qf | Ff] ^ ud;
                f = Te[Qf | Kf] ^ vd;
                g = Te[Qf | Pf] ^ wd;
                h = Te[Qf | Ef] ^ xd;
                i = Te[Qf | Jf] ^ yd;
                j = Te[Qf | Of] ^ zd;
                k = Te[Qf | Df] ^ Ad;
                l = Te[Qf | If] ^ Bd;
                m = Te[Qf | Nf] ^ Cd;
                n = Te[Qf | Cf] ^ Dd;
                o = Te[Qf | Hf] ^ Ed;
                p = Te[Qf | Mf] ^ Fd;
                q = Te[Qf | Bf] ^ Gd;
                s = Te[Qf | Gf] ^ Hd;
                t = Te[Qf | Lf] ^ Id;
                return
            }
            kf = Te[Rf | Af] ^ Te[Sf | Ff] ^ Te[Qf | Kf] ^ Te[Qf | Pf] ^ td;
            lf = Te[Qf | Af] ^ Te[Rf | Ff] ^ Te[Sf | Kf] ^ Te[Qf | Pf] ^ ud;
            mf = Te[Qf | Af] ^ Te[Qf | Ff] ^ Te[Rf | Kf] ^ Te[Sf | Pf] ^ vd;
            nf = Te[Sf | Af] ^ Te[Qf | Ff] ^ Te[Qf | Kf] ^ Te[Rf | Pf] ^ wd;
            of = Te[Rf | Ef] ^ Te[Sf | Jf] ^ Te[Qf | Of] ^ Te[Qf | Df] ^ xd;
            pf = Te[Qf | Ef] ^ Te[Rf | Jf] ^ Te[Sf | Of] ^ Te[Qf | Df] ^ yd;
            qf = Te[Qf | Ef] ^ Te[Qf | Jf] ^ Te[Rf | Of] ^ Te[Sf | Df] ^ zd;
            rf = Te[Sf | Ef] ^ Te[Qf | Jf] ^ Te[Qf | Of] ^ Te[Rf | Df] ^ Ad;
            sf = Te[Rf | If] ^ Te[Sf | Nf] ^ Te[Qf | Cf] ^ Te[Qf | Hf] ^ Bd;
            tf = Te[Qf | If] ^ Te[Rf | Nf] ^ Te[Sf | Cf] ^ Te[Qf | Hf] ^ Cd;
            uf = Te[Qf | If] ^ Te[Qf | Nf] ^ Te[Rf | Cf] ^ Te[Sf | Hf] ^ Dd;
            vf = Te[Sf | If] ^ Te[Qf | Nf] ^ Te[Qf | Cf] ^ Te[Rf | Hf] ^ Ed;
            wf = Te[Rf | Mf] ^ Te[Sf | Bf] ^ Te[Qf | Gf] ^ Te[Qf | Lf] ^ Fd;
            xf = Te[Qf | Mf] ^ Te[Rf | Bf] ^ Te[Sf | Gf] ^ Te[Qf | Lf] ^ Gd;
            yf = Te[Qf | Mf] ^ Te[Qf | Bf] ^ Te[Rf | Gf] ^ Te[Sf | Lf] ^ Hd;
            zf = Te[Sf | Mf] ^ Te[Qf | Bf] ^ Te[Qf | Gf] ^ Te[Rf | Lf] ^ Id;
            Af = Te[Rf | kf] ^ Te[Sf | pf] ^ Te[Qf | uf] ^ Te[Qf | zf] ^ Jd;
            Bf = Te[Qf | kf] ^ Te[Rf | pf] ^ Te[Sf | uf] ^ Te[Qf | zf] ^ Kd;
            Cf = Te[Qf | kf] ^ Te[Qf | pf] ^ Te[Rf | uf] ^ Te[Sf | zf] ^ Ld;
            Df = Te[Sf | kf] ^ Te[Qf | pf] ^ Te[Qf | uf] ^ Te[Rf | zf] ^ Md;
            Ef = Te[Rf | of] ^ Te[Sf | tf] ^ Te[Qf | yf] ^ Te[Qf | nf] ^ Nd;
            Ff = Te[Qf | of] ^ Te[Rf | tf] ^ Te[Sf | yf] ^ Te[Qf | nf] ^ Od;
            Gf = Te[Qf | of] ^ Te[Qf | tf] ^ Te[Rf | yf] ^ Te[Sf | nf] ^ Pd;
            Hf = Te[Sf | of] ^ Te[Qf | tf] ^ Te[Qf | yf] ^ Te[Rf | nf] ^ Qd;
            If = Te[Rf | sf] ^ Te[Sf | xf] ^ Te[Qf | mf] ^ Te[Qf | rf] ^ Rd;
            Jf = Te[Qf | sf] ^ Te[Rf | xf] ^ Te[Sf | mf] ^ Te[Qf | rf] ^ Sd;
            Kf = Te[Qf | sf] ^ Te[Qf | xf] ^ Te[Rf | mf] ^ Te[Sf | rf] ^ Td;
            Lf = Te[Sf | sf] ^ Te[Qf | xf] ^ Te[Qf | mf] ^ Te[Rf | rf] ^ Ud;
            Mf = Te[Rf | wf] ^ Te[Sf | lf] ^ Te[Qf | qf] ^ Te[Qf | vf] ^ Vd;
            Nf = Te[Qf | wf] ^ Te[Rf | lf] ^ Te[Sf | qf] ^ Te[Qf | vf] ^ Wd;
            Of = Te[Qf | wf] ^ Te[Qf | lf] ^ Te[Rf | qf] ^ Te[Sf | vf] ^ Xd;
            Pf = Te[Sf | wf] ^ Te[Qf | lf] ^ Te[Qf | qf] ^ Te[Rf | vf] ^ Yd;
            kf = Te[Rf | Af] ^ Te[Sf | Ff] ^ Te[Qf | Kf] ^ Te[Qf | Pf] ^ Zd;
            lf = Te[Qf | Af] ^ Te[Rf | Ff] ^ Te[Sf | Kf] ^ Te[Qf | Pf] ^ $d;
            mf = Te[Qf | Af] ^ Te[Qf | Ff] ^ Te[Rf | Kf] ^ Te[Sf | Pf] ^ _d;
            nf = Te[Sf | Af] ^ Te[Qf | Ff] ^ Te[Qf | Kf] ^ Te[Rf | Pf] ^ ae;
            of = Te[Rf | Ef] ^ Te[Sf | Jf] ^ Te[Qf | Of] ^ Te[Qf | Df] ^ be;
            pf = Te[Qf | Ef] ^ Te[Rf | Jf] ^ Te[Sf | Of] ^ Te[Qf | Df] ^ ce;
            qf = Te[Qf | Ef] ^ Te[Qf | Jf] ^ Te[Rf | Of] ^ Te[Sf | Df] ^ de;
            rf = Te[Sf | Ef] ^ Te[Qf | Jf] ^ Te[Qf | Of] ^ Te[Rf | Df] ^ ee;
            sf = Te[Rf | If] ^ Te[Sf | Nf] ^ Te[Qf | Cf] ^ Te[Qf | Hf] ^ fe;
            tf = Te[Qf | If] ^ Te[Rf | Nf] ^ Te[Sf | Cf] ^ Te[Qf | Hf] ^ ge;
            uf = Te[Qf | If] ^ Te[Qf | Nf] ^ Te[Rf | Cf] ^ Te[Sf | Hf] ^ he;
            vf = Te[Sf | If] ^ Te[Qf | Nf] ^ Te[Qf | Cf] ^ Te[Rf | Hf] ^ ie;
            wf = Te[Rf | Mf] ^ Te[Sf | Bf] ^ Te[Qf | Gf] ^ Te[Qf | Lf] ^ je;
            xf = Te[Qf | Mf] ^ Te[Rf | Bf] ^ Te[Sf | Gf] ^ Te[Qf | Lf] ^ ke;
            yf = Te[Qf | Mf] ^ Te[Qf | Bf] ^ Te[Rf | Gf] ^ Te[Sf | Lf] ^ le;
            zf = Te[Sf | Mf] ^ Te[Qf | Bf] ^ Te[Qf | Gf] ^ Te[Rf | Lf] ^ me;
            Af = Te[Rf | kf] ^ Te[Sf | pf] ^ Te[Qf | uf] ^ Te[Qf | zf] ^ ne;
            Bf = Te[Qf | kf] ^ Te[Rf | pf] ^ Te[Sf | uf] ^ Te[Qf | zf] ^ oe;
            Cf = Te[Qf | kf] ^ Te[Qf | pf] ^ Te[Rf | uf] ^ Te[Sf | zf] ^ pe;
            Df = Te[Sf | kf] ^ Te[Qf | pf] ^ Te[Qf | uf] ^ Te[Rf | zf] ^ qe;
            Ef = Te[Rf | of] ^ Te[Sf | tf] ^ Te[Qf | yf] ^ Te[Qf | nf] ^ re;
            Ff = Te[Qf | of] ^ Te[Rf | tf] ^ Te[Sf | yf] ^ Te[Qf | nf] ^ se;
            Gf = Te[Qf | of] ^ Te[Qf | tf] ^ Te[Rf | yf] ^ Te[Sf | nf] ^ te;
            Hf = Te[Sf | of] ^ Te[Qf | tf] ^ Te[Qf | yf] ^ Te[Rf | nf] ^ ue;
            If = Te[Rf | sf] ^ Te[Sf | xf] ^ Te[Qf | mf] ^ Te[Qf | rf] ^ ve;
            Jf = Te[Qf | sf] ^ Te[Rf | xf] ^ Te[Sf | mf] ^ Te[Qf | rf] ^ we;
            Kf = Te[Qf | sf] ^ Te[Qf | xf] ^ Te[Rf | mf] ^ Te[Sf | rf] ^ xe;
            Lf = Te[Sf | sf] ^ Te[Qf | xf] ^ Te[Qf | mf] ^ Te[Rf | rf] ^ ye;
            Mf = Te[Rf | wf] ^ Te[Sf | lf] ^ Te[Qf | qf] ^ Te[Qf | vf] ^ ze;
            Nf = Te[Qf | wf] ^ Te[Rf | lf] ^ Te[Sf | qf] ^ Te[Qf | vf] ^ Ae;
            Of = Te[Qf | wf] ^ Te[Qf | lf] ^ Te[Rf | qf] ^ Te[Sf | vf] ^ Be;
            Pf = Te[Sf | wf] ^ Te[Qf | lf] ^ Te[Qf | qf] ^ Te[Rf | vf] ^ Ce;
            d = Te[Qf | Af] ^ De;
            e = Te[Qf | Ff] ^ Ee;
            f = Te[Qf | Kf] ^ Fe;
            g = Te[Qf | Pf] ^ Ge;
            h = Te[Qf | Ef] ^ He;
            i = Te[Qf | Jf] ^ Ie;
            j = Te[Qf | Of] ^ Je;
            k = Te[Qf | Df] ^ Ke;
            l = Te[Qf | If] ^ Le;
            m = Te[Qf | Nf] ^ Me;
            n = Te[Qf | Cf] ^ Ne;
            o = Te[Qf | Hf] ^ Oe;
            p = Te[Qf | Mf] ^ Pe;
            q = Te[Qf | Bf] ^ Qe;
            s = Te[Qf | Gf] ^ Re;
            t = Te[Qf | Lf] ^ Se
        }

        function Xe(kf, lf, mf, nf, of, pf, qf, rf, sf, tf, uf, vf, wf, xf, yf, zf) {
            kf = kf | 0;
            lf = lf | 0;
            mf = mf | 0;
            nf = nf | 0;
            of = of | 0;
            pf = pf | 0;
            qf = qf | 0;
            rf = rf | 0;
            sf = sf | 0;
            tf = tf | 0;
            uf = uf | 0;
            vf = vf | 0;
            wf = wf | 0;
            xf = xf | 0;
            yf = yf | 0;
            zf = zf | 0;
            var Af = 0,
                Bf = 0,
                Cf = 0,
                Df = 0,
                Ef = 0,
                Ff = 0,
                Gf = 0,
                Hf = 0,
                If = 0,
                Jf = 0,
                Kf = 0,
                Lf = 0,
                Mf = 0,
                Nf = 0,
                Of = 0,
                Pf = 0,
                Qf = 256,
                Rf = 1024,
                Sf = 1280,
                Tf = 1536,
                Uf = 1792;
            if ((u | 0) == 32) {
                Af = Te[Qf | kf ^ De] ^ ne;
                Bf = Te[Qf | xf ^ Qe] ^ oe;
                Cf = Te[Qf | uf ^ Ne] ^ pe;
                Df = Te[Qf | rf ^ Ke] ^ qe;
                Ef = Te[Qf | of ^ He] ^ re;
                Ff = Te[Qf | lf ^ Ee] ^ se;
                Gf = Te[Qf | yf ^ Re] ^ te;
                Hf = Te[Qf | vf ^ Oe] ^ ue;
                If = Te[Qf | sf ^ Le] ^ ve;
                Jf = Te[Qf | pf ^ Ie] ^ we;
                Kf = Te[Qf | mf ^ Fe] ^ xe;
                Lf = Te[Qf | zf ^ Se] ^ ye;
                Mf = Te[Qf | wf ^ Pe] ^ ze;
                Nf = Te[Qf | tf ^ Me] ^ Ae;
                Of = Te[Qf | qf ^ Je] ^ Be;
                Pf = Te[Qf | nf ^ Ge] ^ Ce;
                kf = Te[Uf | Af] ^ Te[Sf | Bf] ^ Te[Tf | Cf] ^ Te[Rf | Df];
                lf = Te[Rf | Mf] ^ Te[Uf | Nf] ^ Te[Sf | Of] ^ Te[Tf | Pf];
                mf = Te[Tf | If] ^ Te[Rf | Jf] ^ Te[Uf | Kf] ^ Te[Sf | Lf];
                nf = Te[Sf | Ef] ^ Te[Tf | Ff] ^ Te[Rf | Gf] ^ Te[Uf | Hf];
                of = Te[Uf | Ef] ^ Te[Sf | Ff] ^ Te[Tf | Gf] ^ Te[Rf | Hf];
                pf = Te[Rf | Af] ^ Te[Uf | Bf] ^ Te[Sf | Cf] ^ Te[Tf | Df];
                qf = Te[Tf | Mf] ^ Te[Rf | Nf] ^ Te[Uf | Of] ^ Te[Sf | Pf];
                rf = Te[Sf | If] ^ Te[Tf | Jf] ^ Te[Rf | Kf] ^ Te[Uf | Lf];
                sf = Te[Uf | If] ^ Te[Sf | Jf] ^ Te[Tf | Kf] ^ Te[Rf | Lf];
                tf = Te[Rf | Ef] ^ Te[Uf | Ff] ^ Te[Sf | Gf] ^ Te[Tf | Hf];
                uf = Te[Tf | Af] ^ Te[Rf | Bf] ^ Te[Uf | Cf] ^ Te[Sf | Df];
                vf = Te[Sf | Mf] ^ Te[Tf | Nf] ^ Te[Rf | Of] ^ Te[Uf | Pf];
                wf = Te[Uf | Mf] ^ Te[Sf | Nf] ^ Te[Tf | Of] ^ Te[Rf | Pf];
                xf = Te[Rf | If] ^ Te[Uf | Jf] ^ Te[Sf | Kf] ^ Te[Tf | Lf];
                yf = Te[Tf | Ef] ^ Te[Rf | Ff] ^ Te[Uf | Gf] ^ Te[Sf | Hf];
                zf = Te[Sf | Af] ^ Te[Tf | Bf] ^ Te[Rf | Cf] ^ Te[Uf | Df];
                Af = Te[Qf | kf] ^ Zd;
                Bf = Te[Qf | lf] ^ $d;
                Cf = Te[Qf | mf] ^ _d;
                Df = Te[Qf | nf] ^ ae;
                Ef = Te[Qf | of] ^ be;
                Ff = Te[Qf | pf] ^ ce;
                Gf = Te[Qf | qf] ^ de;
                Hf = Te[Qf | rf] ^ ee;
                If = Te[Qf | sf] ^ fe;
                Jf = Te[Qf | tf] ^ ge;
                Kf = Te[Qf | uf] ^ he;
                Lf = Te[Qf | vf] ^ ie;
                Mf = Te[Qf | wf] ^ je;
                Nf = Te[Qf | xf] ^ ke;
                Of = Te[Qf | yf] ^ le;
                Pf = Te[Qf | zf] ^ me;
                kf = Te[Uf | Af] ^ Te[Sf | Bf] ^ Te[Tf | Cf] ^ Te[Rf | Df];
                lf = Te[Rf | Mf] ^ Te[Uf | Nf] ^ Te[Sf | Of] ^ Te[Tf | Pf];
                mf = Te[Tf | If] ^ Te[Rf | Jf] ^ Te[Uf | Kf] ^ Te[Sf | Lf];
                nf = Te[Sf | Ef] ^ Te[Tf | Ff] ^ Te[Rf | Gf] ^ Te[Uf | Hf];
                of = Te[Uf | Ef] ^ Te[Sf | Ff] ^ Te[Tf | Gf] ^ Te[Rf | Hf];
                pf = Te[Rf | Af] ^ Te[Uf | Bf] ^ Te[Sf | Cf] ^ Te[Tf | Df];
                qf = Te[Tf | Mf] ^ Te[Rf | Nf] ^ Te[Uf | Of] ^ Te[Sf | Pf];
                rf = Te[Sf | If] ^ Te[Tf | Jf] ^ Te[Rf | Kf] ^ Te[Uf | Lf];
                sf = Te[Uf | If] ^ Te[Sf | Jf] ^ Te[Tf | Kf] ^ Te[Rf | Lf];
                tf = Te[Rf | Ef] ^ Te[Uf | Ff] ^ Te[Sf | Gf] ^ Te[Tf | Hf];
                uf = Te[Tf | Af] ^ Te[Rf | Bf] ^ Te[Uf | Cf] ^ Te[Sf | Df];
                vf = Te[Sf | Mf] ^ Te[Tf | Nf] ^ Te[Rf | Of] ^ Te[Uf | Pf];
                wf = Te[Uf | Mf] ^ Te[Sf | Nf] ^ Te[Tf | Of] ^ Te[Rf | Pf];
                xf = Te[Rf | If] ^ Te[Uf | Jf] ^ Te[Sf | Kf] ^ Te[Tf | Lf];
                yf = Te[Tf | Ef] ^ Te[Rf | Ff] ^ Te[Uf | Gf] ^ Te[Sf | Hf];
                zf = Te[Sf | Af] ^ Te[Tf | Bf] ^ Te[Rf | Cf] ^ Te[Uf | Df];
                Af = Te[Qf | kf] ^ Jd;
                Bf = Te[Qf | lf] ^ Kd;
                Cf = Te[Qf | mf] ^ Ld;
                Df = Te[Qf | nf] ^ Md;
                Ef = Te[Qf | of] ^ Nd;
                Ff = Te[Qf | pf] ^ Od;
                Gf = Te[Qf | qf] ^ Pd;
                Hf = Te[Qf | rf] ^ Qd;
                If = Te[Qf | sf] ^ Rd;
                Jf = Te[Qf | tf] ^ Sd;
                Kf = Te[Qf | uf] ^ Td;
                Lf = Te[Qf | vf] ^ Ud;
                Mf = Te[Qf | wf] ^ Vd;
                Nf = Te[Qf | xf] ^ Wd;
                Of = Te[Qf | yf] ^ Xd;
                Pf = Te[Qf | zf] ^ Yd;
                kf = Te[Uf | Af] ^ Te[Sf | Bf] ^ Te[Tf | Cf] ^ Te[Rf | Df];
                lf = Te[Rf | Mf] ^ Te[Uf | Nf] ^ Te[Sf | Of] ^ Te[Tf | Pf];
                mf = Te[Tf | If] ^ Te[Rf | Jf] ^ Te[Uf | Kf] ^ Te[Sf | Lf];
                nf = Te[Sf | Ef] ^ Te[Tf | Ff] ^ Te[Rf | Gf] ^ Te[Uf | Hf];
                of = Te[Uf | Ef] ^ Te[Sf | Ff] ^ Te[Tf | Gf] ^ Te[Rf | Hf];
                pf = Te[Rf | Af] ^ Te[Uf | Bf] ^ Te[Sf | Cf] ^ Te[Tf | Df];
                qf = Te[Tf | Mf] ^ Te[Rf | Nf] ^ Te[Uf | Of] ^ Te[Sf | Pf];
                rf = Te[Sf | If] ^ Te[Tf | Jf] ^ Te[Rf | Kf] ^ Te[Uf | Lf];
                sf = Te[Uf | If] ^ Te[Sf | Jf] ^ Te[Tf | Kf] ^ Te[Rf | Lf];
                tf = Te[Rf | Ef] ^ Te[Uf | Ff] ^ Te[Sf | Gf] ^ Te[Tf | Hf];
                uf = Te[Tf | Af] ^ Te[Rf | Bf] ^ Te[Uf | Cf] ^ Te[Sf | Df];
                vf = Te[Sf | Mf] ^ Te[Tf | Nf] ^ Te[Rf | Of] ^ Te[Uf | Pf];
                wf = Te[Uf | Mf] ^ Te[Sf | Nf] ^ Te[Tf | Of] ^ Te[Rf | Pf];
                xf = Te[Rf | If] ^ Te[Uf | Jf] ^ Te[Sf | Kf] ^ Te[Tf | Lf];
                yf = Te[Tf | Ef] ^ Te[Rf | Ff] ^ Te[Uf | Gf] ^ Te[Sf | Hf];
                zf = Te[Sf | Af] ^ Te[Tf | Bf] ^ Te[Rf | Cf] ^ Te[Uf | Df];
                Af = Te[Qf | kf] ^ td;
                Bf = Te[Qf | lf] ^ ud;
                Cf = Te[Qf | mf] ^ vd;
                Df = Te[Qf | nf] ^ wd;
                Ef = Te[Qf | of] ^ xd;
                Ff = Te[Qf | pf] ^ yd;
                Gf = Te[Qf | qf] ^ zd;
                Hf = Te[Qf | rf] ^ Ad;
                If = Te[Qf | sf] ^ Bd;
                Jf = Te[Qf | tf] ^ Cd;
                Kf = Te[Qf | uf] ^ Dd;
                Lf = Te[Qf | vf] ^ Ed;
                Mf = Te[Qf | wf] ^ Fd;
                Nf = Te[Qf | xf] ^ Gd;
                Of = Te[Qf | yf] ^ Hd;
                Pf = Te[Qf | zf] ^ Id;
                kf = Te[Uf | Af] ^ Te[Sf | Bf] ^ Te[Tf | Cf] ^ Te[Rf | Df];
                lf = Te[Rf | Mf] ^ Te[Uf | Nf] ^ Te[Sf | Of] ^ Te[Tf | Pf];
                mf = Te[Tf | If] ^ Te[Rf | Jf] ^ Te[Uf | Kf] ^ Te[Sf | Lf];
                nf = Te[Sf | Ef] ^ Te[Tf | Ff] ^ Te[Rf | Gf] ^ Te[Uf | Hf];
                of = Te[Uf | Ef] ^ Te[Sf | Ff] ^ Te[Tf | Gf] ^ Te[Rf | Hf];
                pf = Te[Rf | Af] ^ Te[Uf | Bf] ^ Te[Sf | Cf] ^ Te[Tf | Df];
                qf = Te[Tf | Mf] ^ Te[Rf | Nf] ^ Te[Uf | Of] ^ Te[Sf | Pf];
                rf = Te[Sf | If] ^ Te[Tf | Jf] ^ Te[Rf | Kf] ^ Te[Uf | Lf];
                sf = Te[Uf | If] ^ Te[Sf | Jf] ^ Te[Tf | Kf] ^ Te[Rf | Lf];
                tf = Te[Rf | Ef] ^ Te[Uf | Ff] ^ Te[Sf | Gf] ^ Te[Tf | Hf];
                uf = Te[Tf | Af] ^ Te[Rf | Bf] ^ Te[Uf | Cf] ^ Te[Sf | Df];
                vf = Te[Sf | Mf] ^ Te[Tf | Nf] ^ Te[Rf | Of] ^ Te[Uf | Pf];
                wf = Te[Uf | Mf] ^ Te[Sf | Nf] ^ Te[Tf | Of] ^ Te[Rf | Pf];
                xf = Te[Rf | If] ^ Te[Uf | Jf] ^ Te[Sf | Kf] ^ Te[Tf | Lf];
                yf = Te[Tf | Ef] ^ Te[Rf | Ff] ^ Te[Uf | Gf] ^ Te[Sf | Hf];
                zf = Te[Sf | Af] ^ Te[Tf | Bf] ^ Te[Rf | Cf] ^ Te[Uf | Df];
                Af = Te[Qf | kf] ^ dd;
                Bf = Te[Qf | lf] ^ ed;
                Cf = Te[Qf | mf] ^ fd;
                Df = Te[Qf | nf] ^ gd;
                Ef = Te[Qf | of] ^ hd;
                Ff = Te[Qf | pf] ^ id;
                Gf = Te[Qf | qf] ^ jd;
                Hf = Te[Qf | rf] ^ kd;
                If = Te[Qf | sf] ^ ld;
                Jf = Te[Qf | tf] ^ md;
                Kf = Te[Qf | uf] ^ nd;
                Lf = Te[Qf | vf] ^ od;
                Mf = Te[Qf | wf] ^ pd;
                Nf = Te[Qf | xf] ^ qd;
                Of = Te[Qf | yf] ^ rd;
                Pf = Te[Qf | zf] ^ sd
            } else {
                Af = Te[Qf | kf ^ td] ^ dd;
                Bf = Te[Qf | xf ^ Gd] ^ ed;
                Cf = Te[Qf | uf ^ Dd] ^ fd;
                Df = Te[Qf | rf ^ Ad] ^ gd;
                Ef = Te[Qf | of ^ xd] ^ hd;
                Ff = Te[Qf | lf ^ ud] ^ id;
                Gf = Te[Qf | yf ^ Hd] ^ jd;
                Hf = Te[Qf | vf ^ Ed] ^ kd;
                If = Te[Qf | sf ^ Bd] ^ ld;
                Jf = Te[Qf | pf ^ yd] ^ md;
                Kf = Te[Qf | mf ^ vd] ^ nd;
                Lf = Te[Qf | zf ^ Id] ^ od;
                Mf = Te[Qf | wf ^ Fd] ^ pd;
                Nf = Te[Qf | tf ^ Cd] ^ qd;
                Of = Te[Qf | qf ^ zd] ^ rd;
                Pf = Te[Qf | nf ^ wd] ^ sd
            }
            kf = Te[Uf | Af] ^ Te[Sf | Bf] ^ Te[Tf | Cf] ^ Te[Rf | Df];
            lf = Te[Rf | Mf] ^ Te[Uf | Nf] ^ Te[Sf | Of] ^ Te[Tf | Pf];
            mf = Te[Tf | If] ^ Te[Rf | Jf] ^ Te[Uf | Kf] ^ Te[Sf | Lf];
            nf = Te[Sf | Ef] ^ Te[Tf | Ff] ^ Te[Rf | Gf] ^ Te[Uf | Hf];
            of = Te[Uf | Ef] ^ Te[Sf | Ff] ^ Te[Tf | Gf] ^ Te[Rf | Hf];
            pf = Te[Rf | Af] ^ Te[Uf | Bf] ^ Te[Sf | Cf] ^ Te[Tf | Df];
            qf = Te[Tf | Mf] ^ Te[Rf | Nf] ^ Te[Uf | Of] ^ Te[Sf | Pf];
            rf = Te[Sf | If] ^ Te[Tf | Jf] ^ Te[Rf | Kf] ^ Te[Uf | Lf];
            sf = Te[Uf | If] ^ Te[Sf | Jf] ^ Te[Tf | Kf] ^ Te[Rf | Lf];
            tf = Te[Rf | Ef] ^ Te[Uf | Ff] ^ Te[Sf | Gf] ^ Te[Tf | Hf];
            uf = Te[Tf | Af] ^ Te[Rf | Bf] ^ Te[Uf | Cf] ^ Te[Sf | Df];
            vf = Te[Sf | Mf] ^ Te[Tf | Nf] ^ Te[Rf | Of] ^ Te[Uf | Pf];
            wf = Te[Uf | Mf] ^ Te[Sf | Nf] ^ Te[Tf | Of] ^ Te[Rf | Pf];
            xf = Te[Rf | If] ^ Te[Uf | Jf] ^ Te[Sf | Kf] ^ Te[Tf | Lf];
            yf = Te[Tf | Ef] ^ Te[Rf | Ff] ^ Te[Uf | Gf] ^ Te[Sf | Hf];
            zf = Te[Sf | Af] ^ Te[Tf | Bf] ^ Te[Rf | Cf] ^ Te[Uf | Df];
            Af = Te[Qf | kf] ^ Pc;
            Bf = Te[Qf | lf] ^ Qc;
            Cf = Te[Qf | mf] ^ Rc;
            Df = Te[Qf | nf] ^ Sc;
            Ef = Te[Qf | of] ^ Tc;
            Ff = Te[Qf | pf] ^ Uc;
            Gf = Te[Qf | qf] ^ Vc;
            Hf = Te[Qf | rf] ^ Wc;
            If = Te[Qf | sf] ^ Xc;
            Jf = Te[Qf | tf] ^ Yc;
            Kf = Te[Qf | uf] ^ Zc;
            Lf = Te[Qf | vf] ^ $c;
            Mf = Te[Qf | wf] ^ _c;
            Nf = Te[Qf | xf] ^ ad;
            Of = Te[Qf | yf] ^ bd;
            Pf = Te[Qf | zf] ^ cd;
            kf = Te[Uf | Af] ^ Te[Sf | Bf] ^ Te[Tf | Cf] ^ Te[Rf | Df];
            lf = Te[Rf | Mf] ^ Te[Uf | Nf] ^ Te[Sf | Of] ^ Te[Tf | Pf];
            mf = Te[Tf | If] ^ Te[Rf | Jf] ^ Te[Uf | Kf] ^ Te[Sf | Lf];
            nf = Te[Sf | Ef] ^ Te[Tf | Ff] ^ Te[Rf | Gf] ^ Te[Uf | Hf];
            of = Te[Uf | Ef] ^ Te[Sf | Ff] ^ Te[Tf | Gf] ^ Te[Rf | Hf];
            pf = Te[Rf | Af] ^ Te[Uf | Bf] ^ Te[Sf | Cf] ^ Te[Tf | Df];
            qf = Te[Tf | Mf] ^ Te[Rf | Nf] ^ Te[Uf | Of] ^ Te[Sf | Pf];
            rf = Te[Sf | If] ^ Te[Tf | Jf] ^ Te[Rf | Kf] ^ Te[Uf | Lf];
            sf = Te[Uf | If] ^ Te[Sf | Jf] ^ Te[Tf | Kf] ^ Te[Rf | Lf];
            tf = Te[Rf | Ef] ^ Te[Uf | Ff] ^ Te[Sf | Gf] ^ Te[Tf | Hf];
            uf = Te[Tf | Af] ^ Te[Rf | Bf] ^ Te[Uf | Cf] ^ Te[Sf | Df];
            vf = Te[Sf | Mf] ^ Te[Tf | Nf] ^ Te[Rf | Of] ^ Te[Uf | Pf];
            wf = Te[Uf | Mf] ^ Te[Sf | Nf] ^ Te[Tf | Of] ^ Te[Rf | Pf];
            xf = Te[Rf | If] ^ Te[Uf | Jf] ^ Te[Sf | Kf] ^ Te[Tf | Lf];
            yf = Te[Tf | Ef] ^ Te[Rf | Ff] ^ Te[Uf | Gf] ^ Te[Sf | Hf];
            zf = Te[Sf | Af] ^ Te[Tf | Bf] ^ Te[Rf | Cf] ^ Te[Uf | Df];
            Af = Te[Qf | kf] ^ zc;
            Bf = Te[Qf | lf] ^ Ac;
            Cf = Te[Qf | mf] ^ Bc;
            Df = Te[Qf | nf] ^ Cc;
            Ef = Te[Qf | of] ^ Dc;
            Ff = Te[Qf | pf] ^ Ec;
            Gf = Te[Qf | qf] ^ Fc;
            Hf = Te[Qf | rf] ^ Gc;
            If = Te[Qf | sf] ^ Hc;
            Jf = Te[Qf | tf] ^ Ic;
            Kf = Te[Qf | uf] ^ Jc;
            Lf = Te[Qf | vf] ^ Kc;
            Mf = Te[Qf | wf] ^ Lc;
            Nf = Te[Qf | xf] ^ Mc;
            Of = Te[Qf | yf] ^ Nc;
            Pf = Te[Qf | zf] ^ Oc;
            kf = Te[Uf | Af] ^ Te[Sf | Bf] ^ Te[Tf | Cf] ^ Te[Rf | Df];
            lf = Te[Rf | Mf] ^ Te[Uf | Nf] ^ Te[Sf | Of] ^ Te[Tf | Pf];
            mf = Te[Tf | If] ^ Te[Rf | Jf] ^ Te[Uf | Kf] ^ Te[Sf | Lf];
            nf = Te[Sf | Ef] ^ Te[Tf | Ff] ^ Te[Rf | Gf] ^ Te[Uf | Hf];
            of = Te[Uf | Ef] ^ Te[Sf | Ff] ^ Te[Tf | Gf] ^ Te[Rf | Hf];
            pf = Te[Rf | Af] ^ Te[Uf | Bf] ^ Te[Sf | Cf] ^ Te[Tf | Df];
            qf = Te[Tf | Mf] ^ Te[Rf | Nf] ^ Te[Uf | Of] ^ Te[Sf | Pf];
            rf = Te[Sf | If] ^ Te[Tf | Jf] ^ Te[Rf | Kf] ^ Te[Uf | Lf];
            sf = Te[Uf | If] ^ Te[Sf | Jf] ^ Te[Tf | Kf] ^ Te[Rf | Lf];
            tf = Te[Rf | Ef] ^ Te[Uf | Ff] ^ Te[Sf | Gf] ^ Te[Tf | Hf];
            uf = Te[Tf | Af] ^ Te[Rf | Bf] ^ Te[Uf | Cf] ^ Te[Sf | Df];
            vf = Te[Sf | Mf] ^ Te[Tf | Nf] ^ Te[Rf | Of] ^ Te[Uf | Pf];
            wf = Te[Uf | Mf] ^ Te[Sf | Nf] ^ Te[Tf | Of] ^ Te[Rf | Pf];
            xf = Te[Rf | If] ^ Te[Uf | Jf] ^ Te[Sf | Kf] ^ Te[Tf | Lf];
            yf = Te[Tf | Ef] ^ Te[Rf | Ff] ^ Te[Uf | Gf] ^ Te[Sf | Hf];
            zf = Te[Sf | Af] ^ Te[Tf | Bf] ^ Te[Rf | Cf] ^ Te[Uf | Df];
            Af = Te[Qf | kf] ^ jc;
            Bf = Te[Qf | lf] ^ kc;
            Cf = Te[Qf | mf] ^ lc;
            Df = Te[Qf | nf] ^ mc;
            Ef = Te[Qf | of] ^ nc;
            Ff = Te[Qf | pf] ^ oc;
            Gf = Te[Qf | qf] ^ pc;
            Hf = Te[Qf | rf] ^ qc;
            If = Te[Qf | sf] ^ rc;
            Jf = Te[Qf | tf] ^ sc;
            Kf = Te[Qf | uf] ^ tc;
            Lf = Te[Qf | vf] ^ uc;
            Mf = Te[Qf | wf] ^ vc;
            Nf = Te[Qf | xf] ^ wc;
            Of = Te[Qf | yf] ^ xc;
            Pf = Te[Qf | zf] ^ yc;
            kf = Te[Uf | Af] ^ Te[Sf | Bf] ^ Te[Tf | Cf] ^ Te[Rf | Df];
            lf = Te[Rf | Mf] ^ Te[Uf | Nf] ^ Te[Sf | Of] ^ Te[Tf | Pf];
            mf = Te[Tf | If] ^ Te[Rf | Jf] ^ Te[Uf | Kf] ^ Te[Sf | Lf];
            nf = Te[Sf | Ef] ^ Te[Tf | Ff] ^ Te[Rf | Gf] ^ Te[Uf | Hf];
            of = Te[Uf | Ef] ^ Te[Sf | Ff] ^ Te[Tf | Gf] ^ Te[Rf | Hf];
            pf = Te[Rf | Af] ^ Te[Uf | Bf] ^ Te[Sf | Cf] ^ Te[Tf | Df];
            qf = Te[Tf | Mf] ^ Te[Rf | Nf] ^ Te[Uf | Of] ^ Te[Sf | Pf];
            rf = Te[Sf | If] ^ Te[Tf | Jf] ^ Te[Rf | Kf] ^ Te[Uf | Lf];
            sf = Te[Uf | If] ^ Te[Sf | Jf] ^ Te[Tf | Kf] ^ Te[Rf | Lf];
            tf = Te[Rf | Ef] ^ Te[Uf | Ff] ^ Te[Sf | Gf] ^ Te[Tf | Hf];
            uf = Te[Tf | Af] ^ Te[Rf | Bf] ^ Te[Uf | Cf] ^ Te[Sf | Df];
            vf = Te[Sf | Mf] ^ Te[Tf | Nf] ^ Te[Rf | Of] ^ Te[Uf | Pf];
            wf = Te[Uf | Mf] ^ Te[Sf | Nf] ^ Te[Tf | Of] ^ Te[Rf | Pf];
            xf = Te[Rf | If] ^ Te[Uf | Jf] ^ Te[Sf | Kf] ^ Te[Tf | Lf];
            yf = Te[Tf | Ef] ^ Te[Rf | Ff] ^ Te[Uf | Gf] ^ Te[Sf | Hf];
            zf = Te[Sf | Af] ^ Te[Tf | Bf] ^ Te[Rf | Cf] ^ Te[Uf | Df];
            Af = Te[Qf | kf] ^ Vb;
            Bf = Te[Qf | lf] ^ Wb;
            Cf = Te[Qf | mf] ^ Xb;
            Df = Te[Qf | nf] ^ Yb;
            Ef = Te[Qf | of] ^ Zb;
            Ff = Te[Qf | pf] ^ $b;
            Gf = Te[Qf | qf] ^ _b;
            Hf = Te[Qf | rf] ^ ac;
            If = Te[Qf | sf] ^ bc;
            Jf = Te[Qf | tf] ^ cc;
            Kf = Te[Qf | uf] ^ dc;
            Lf = Te[Qf | vf] ^ ec;
            Mf = Te[Qf | wf] ^ fc;
            Nf = Te[Qf | xf] ^ gc;
            Of = Te[Qf | yf] ^ hc;
            Pf = Te[Qf | zf] ^ ic;
            kf = Te[Uf | Af] ^ Te[Sf | Bf] ^ Te[Tf | Cf] ^ Te[Rf | Df];
            lf = Te[Rf | Mf] ^ Te[Uf | Nf] ^ Te[Sf | Of] ^ Te[Tf | Pf];
            mf = Te[Tf | If] ^ Te[Rf | Jf] ^ Te[Uf | Kf] ^ Te[Sf | Lf];
            nf = Te[Sf | Ef] ^ Te[Tf | Ff] ^ Te[Rf | Gf] ^ Te[Uf | Hf];
            of = Te[Uf | Ef] ^ Te[Sf | Ff] ^ Te[Tf | Gf] ^ Te[Rf | Hf];
            pf = Te[Rf | Af] ^ Te[Uf | Bf] ^ Te[Sf | Cf] ^ Te[Tf | Df];
            qf = Te[Tf | Mf] ^ Te[Rf | Nf] ^ Te[Uf | Of] ^ Te[Sf | Pf];
            rf = Te[Sf | If] ^ Te[Tf | Jf] ^ Te[Rf | Kf] ^ Te[Uf | Lf];
            sf = Te[Uf | If] ^ Te[Sf | Jf] ^ Te[Tf | Kf] ^ Te[Rf | Lf];
            tf = Te[Rf | Ef] ^ Te[Uf | Ff] ^ Te[Sf | Gf] ^ Te[Tf | Hf];
            uf = Te[Tf | Af] ^ Te[Rf | Bf] ^ Te[Uf | Cf] ^ Te[Sf | Df];
            vf = Te[Sf | Mf] ^ Te[Tf | Nf] ^ Te[Rf | Of] ^ Te[Uf | Pf];
            wf = Te[Uf | Mf] ^ Te[Sf | Nf] ^ Te[Tf | Of] ^ Te[Rf | Pf];
            xf = Te[Rf | If] ^ Te[Uf | Jf] ^ Te[Sf | Kf] ^ Te[Tf | Lf];
            yf = Te[Tf | Ef] ^ Te[Rf | Ff] ^ Te[Uf | Gf] ^ Te[Sf | Hf];
            zf = Te[Sf | Af] ^ Te[Tf | Bf] ^ Te[Rf | Cf] ^ Te[Uf | Df];
            Af = Te[Qf | kf] ^ Fb;
            Bf = Te[Qf | lf] ^ Gb;
            Cf = Te[Qf | mf] ^ Hb;
            Df = Te[Qf | nf] ^ Ib;
            Ef = Te[Qf | of] ^ Jb;
            Ff = Te[Qf | pf] ^ Kb;
            Gf = Te[Qf | qf] ^ Lb;
            Hf = Te[Qf | rf] ^ Mb;
            If = Te[Qf | sf] ^ Nb;
            Jf = Te[Qf | tf] ^ Ob;
            Kf = Te[Qf | uf] ^ Pb;
            Lf = Te[Qf | vf] ^ Qb;
            Mf = Te[Qf | wf] ^ Rb;
            Nf = Te[Qf | xf] ^ Sb;
            Of = Te[Qf | yf] ^ Tb;
            Pf = Te[Qf | zf] ^ Ub;
            kf = Te[Uf | Af] ^ Te[Sf | Bf] ^ Te[Tf | Cf] ^ Te[Rf | Df];
            lf = Te[Rf | Mf] ^ Te[Uf | Nf] ^ Te[Sf | Of] ^ Te[Tf | Pf];
            mf = Te[Tf | If] ^ Te[Rf | Jf] ^ Te[Uf | Kf] ^ Te[Sf | Lf];
            nf = Te[Sf | Ef] ^ Te[Tf | Ff] ^ Te[Rf | Gf] ^ Te[Uf | Hf];
            of = Te[Uf | Ef] ^ Te[Sf | Ff] ^ Te[Tf | Gf] ^ Te[Rf | Hf];
            pf = Te[Rf | Af] ^ Te[Uf | Bf] ^ Te[Sf | Cf] ^ Te[Tf | Df];
            qf = Te[Tf | Mf] ^ Te[Rf | Nf] ^ Te[Uf | Of] ^ Te[Sf | Pf];
            rf = Te[Sf | If] ^ Te[Tf | Jf] ^ Te[Rf | Kf] ^ Te[Uf | Lf];
            sf = Te[Uf | If] ^ Te[Sf | Jf] ^ Te[Tf | Kf] ^ Te[Rf | Lf];
            tf = Te[Rf | Ef] ^ Te[Uf | Ff] ^ Te[Sf | Gf] ^ Te[Tf | Hf];
            uf = Te[Tf | Af] ^ Te[Rf | Bf] ^ Te[Uf | Cf] ^ Te[Sf | Df];
            vf = Te[Sf | Mf] ^ Te[Tf | Nf] ^ Te[Rf | Of] ^ Te[Uf | Pf];
            wf = Te[Uf | Mf] ^ Te[Sf | Nf] ^ Te[Tf | Of] ^ Te[Rf | Pf];
            xf = Te[Rf | If] ^ Te[Uf | Jf] ^ Te[Sf | Kf] ^ Te[Tf | Lf];
            yf = Te[Tf | Ef] ^ Te[Rf | Ff] ^ Te[Uf | Gf] ^ Te[Sf | Hf];
            zf = Te[Sf | Af] ^ Te[Tf | Bf] ^ Te[Rf | Cf] ^ Te[Uf | Df];
            Af = Te[Qf | kf] ^ pb;
            Bf = Te[Qf | lf] ^ qb;
            Cf = Te[Qf | mf] ^ rb;
            Df = Te[Qf | nf] ^ sb;
            Ef = Te[Qf | of] ^ tb;
            Ff = Te[Qf | pf] ^ ub;
            Gf = Te[Qf | qf] ^ vb;
            Hf = Te[Qf | rf] ^ wb;
            If = Te[Qf | sf] ^ xb;
            Jf = Te[Qf | tf] ^ yb;
            Kf = Te[Qf | uf] ^ zb;
            Lf = Te[Qf | vf] ^ Ab;
            Mf = Te[Qf | wf] ^ Bb;
            Nf = Te[Qf | xf] ^ Cb;
            Of = Te[Qf | yf] ^ Db;
            Pf = Te[Qf | zf] ^ Eb;
            kf = Te[Uf | Af] ^ Te[Sf | Bf] ^ Te[Tf | Cf] ^ Te[Rf | Df];
            lf = Te[Rf | Mf] ^ Te[Uf | Nf] ^ Te[Sf | Of] ^ Te[Tf | Pf];
            mf = Te[Tf | If] ^ Te[Rf | Jf] ^ Te[Uf | Kf] ^ Te[Sf | Lf];
            nf = Te[Sf | Ef] ^ Te[Tf | Ff] ^ Te[Rf | Gf] ^ Te[Uf | Hf];
            of = Te[Uf | Ef] ^ Te[Sf | Ff] ^ Te[Tf | Gf] ^ Te[Rf | Hf];
            pf = Te[Rf | Af] ^ Te[Uf | Bf] ^ Te[Sf | Cf] ^ Te[Tf | Df];
            qf = Te[Tf | Mf] ^ Te[Rf | Nf] ^ Te[Uf | Of] ^ Te[Sf | Pf];
            rf = Te[Sf | If] ^ Te[Tf | Jf] ^ Te[Rf | Kf] ^ Te[Uf | Lf];
            sf = Te[Uf | If] ^ Te[Sf | Jf] ^ Te[Tf | Kf] ^ Te[Rf | Lf];
            tf = Te[Rf | Ef] ^ Te[Uf | Ff] ^ Te[Sf | Gf] ^ Te[Tf | Hf];
            uf = Te[Tf | Af] ^ Te[Rf | Bf] ^ Te[Uf | Cf] ^ Te[Sf | Df];
            vf = Te[Sf | Mf] ^ Te[Tf | Nf] ^ Te[Rf | Of] ^ Te[Uf | Pf];
            wf = Te[Uf | Mf] ^ Te[Sf | Nf] ^ Te[Tf | Of] ^ Te[Rf | Pf];
            xf = Te[Rf | If] ^ Te[Uf | Jf] ^ Te[Sf | Kf] ^ Te[Tf | Lf];
            yf = Te[Tf | Ef] ^ Te[Rf | Ff] ^ Te[Uf | Gf] ^ Te[Sf | Hf];
            zf = Te[Sf | Af] ^ Te[Tf | Bf] ^ Te[Rf | Cf] ^ Te[Uf | Df];
            Af = Te[Qf | kf] ^ _;
            Bf = Te[Qf | lf] ^ ab;
            Cf = Te[Qf | mf] ^ bb;
            Df = Te[Qf | nf] ^ cb;
            Ef = Te[Qf | of] ^ db;
            Ff = Te[Qf | pf] ^ eb;
            Gf = Te[Qf | qf] ^ fb;
            Hf = Te[Qf | rf] ^ gb;
            If = Te[Qf | sf] ^ hb;
            Jf = Te[Qf | tf] ^ ib;
            Kf = Te[Qf | uf] ^ jb;
            Lf = Te[Qf | vf] ^ kb;
            Mf = Te[Qf | wf] ^ lb;
            Nf = Te[Qf | xf] ^ mb;
            Of = Te[Qf | yf] ^ nb;
            Pf = Te[Qf | zf] ^ ob;
            kf = Te[Uf | Af] ^ Te[Sf | Bf] ^ Te[Tf | Cf] ^ Te[Rf | Df];
            lf = Te[Rf | Mf] ^ Te[Uf | Nf] ^ Te[Sf | Of] ^ Te[Tf | Pf];
            mf = Te[Tf | If] ^ Te[Rf | Jf] ^ Te[Uf | Kf] ^ Te[Sf | Lf];
            nf = Te[Sf | Ef] ^ Te[Tf | Ff] ^ Te[Rf | Gf] ^ Te[Uf | Hf];
            of = Te[Uf | Ef] ^ Te[Sf | Ff] ^ Te[Tf | Gf] ^ Te[Rf | Hf];
            pf = Te[Rf | Af] ^ Te[Uf | Bf] ^ Te[Sf | Cf] ^ Te[Tf | Df];
            qf = Te[Tf | Mf] ^ Te[Rf | Nf] ^ Te[Uf | Of] ^ Te[Sf | Pf];
            rf = Te[Sf | If] ^ Te[Tf | Jf] ^ Te[Rf | Kf] ^ Te[Uf | Lf];
            sf = Te[Uf | If] ^ Te[Sf | Jf] ^ Te[Tf | Kf] ^ Te[Rf | Lf];
            tf = Te[Rf | Ef] ^ Te[Uf | Ff] ^ Te[Sf | Gf] ^ Te[Tf | Hf];
            uf = Te[Tf | Af] ^ Te[Rf | Bf] ^ Te[Uf | Cf] ^ Te[Sf | Df];
            vf = Te[Sf | Mf] ^ Te[Tf | Nf] ^ Te[Rf | Of] ^ Te[Uf | Pf];
            wf = Te[Uf | Mf] ^ Te[Sf | Nf] ^ Te[Tf | Of] ^ Te[Rf | Pf];
            xf = Te[Rf | If] ^ Te[Uf | Jf] ^ Te[Sf | Kf] ^ Te[Tf | Lf];
            yf = Te[Tf | Ef] ^ Te[Rf | Ff] ^ Te[Uf | Gf] ^ Te[Sf | Hf];
            zf = Te[Sf | Af] ^ Te[Tf | Bf] ^ Te[Rf | Cf] ^ Te[Uf | Df];
            Af = Te[Qf | kf] ^ L;
            Bf = Te[Qf | lf] ^ M;
            Cf = Te[Qf | mf] ^ N;
            Df = Te[Qf | nf] ^ O;
            Ef = Te[Qf | of] ^ P;
            Ff = Te[Qf | pf] ^ Q;
            Gf = Te[Qf | qf] ^ R;
            Hf = Te[Qf | rf] ^ S;
            If = Te[Qf | sf] ^ T;
            Jf = Te[Qf | tf] ^ U;
            Kf = Te[Qf | uf] ^ V;
            Lf = Te[Qf | vf] ^ W;
            Mf = Te[Qf | wf] ^ X;
            Nf = Te[Qf | xf] ^ Y;
            Of = Te[Qf | yf] ^ Z;
            Pf = Te[Qf | zf] ^ $;
            kf = Te[Uf | Af] ^ Te[Sf | Bf] ^ Te[Tf | Cf] ^ Te[Rf | Df];
            lf = Te[Rf | Mf] ^ Te[Uf | Nf] ^ Te[Sf | Of] ^ Te[Tf | Pf];
            mf = Te[Tf | If] ^ Te[Rf | Jf] ^ Te[Uf | Kf] ^ Te[Sf | Lf];
            nf = Te[Sf | Ef] ^ Te[Tf | Ff] ^ Te[Rf | Gf] ^ Te[Uf | Hf];
            of = Te[Uf | Ef] ^ Te[Sf | Ff] ^ Te[Tf | Gf] ^ Te[Rf | Hf];
            pf = Te[Rf | Af] ^ Te[Uf | Bf] ^ Te[Sf | Cf] ^ Te[Tf | Df];
            qf = Te[Tf | Mf] ^ Te[Rf | Nf] ^ Te[Uf | Of] ^ Te[Sf | Pf];
            rf = Te[Sf | If] ^ Te[Tf | Jf] ^ Te[Rf | Kf] ^ Te[Uf | Lf];
            sf = Te[Uf | If] ^ Te[Sf | Jf] ^ Te[Tf | Kf] ^ Te[Rf | Lf];
            tf = Te[Rf | Ef] ^ Te[Uf | Ff] ^ Te[Sf | Gf] ^ Te[Tf | Hf];
            uf = Te[Tf | Af] ^ Te[Rf | Bf] ^ Te[Uf | Cf] ^ Te[Sf | Df];
            vf = Te[Sf | Mf] ^ Te[Tf | Nf] ^ Te[Rf | Of] ^ Te[Uf | Pf];
            wf = Te[Uf | Mf] ^ Te[Sf | Nf] ^ Te[Tf | Of] ^ Te[Rf | Pf];
            xf = Te[Rf | If] ^ Te[Uf | Jf] ^ Te[Sf | Kf] ^ Te[Tf | Lf];
            yf = Te[Tf | Ef] ^ Te[Rf | Ff] ^ Te[Uf | Gf] ^ Te[Sf | Hf];
            zf = Te[Sf | Af] ^ Te[Tf | Bf] ^ Te[Rf | Cf] ^ Te[Uf | Df];
            d = Te[Qf | kf] ^ v;
            e = Te[Qf | lf] ^ w;
            f = Te[Qf | mf] ^ x;
            g = Te[Qf | nf] ^ y;
            h = Te[Qf | of] ^ z;
            i = Te[Qf | pf] ^ A;
            j = Te[Qf | qf] ^ B;
            k = Te[Qf | rf] ^ C;
            l = Te[Qf | sf] ^ D;
            m = Te[Qf | tf] ^ E;
            n = Te[Qf | uf] ^ F;
            o = Te[Qf | vf] ^ G;
            p = Te[Qf | wf] ^ H;
            q = Te[Qf | xf] ^ I;
            s = Te[Qf | yf] ^ J;
            t = Te[Qf | zf] ^ K
        }

        function Ye(kf, lf, mf, nf, of, pf, qf, rf, sf, tf, uf, vf, wf, xf, yf, zf) {
            kf = kf | 0;
            lf = lf | 0;
            mf = mf | 0;
            nf = nf | 0;
            of = of | 0;
            pf = pf | 0;
            qf = qf | 0;
            rf = rf | 0;
            sf = sf | 0;
            tf = tf | 0;
            uf = uf | 0;
            vf = vf | 0;
            wf = wf | 0;
            xf = xf | 0;
            yf = yf | 0;
            zf = zf | 0;
            d = kf;
            e = lf;
            f = mf;
            g = nf;
            h = of;
            i = pf;
            j = qf;
            k = rf;
            l = sf;
            m = tf;
            n = uf;
            o = vf;
            p = wf;
            q = xf;
            s = yf;
            t = zf
        }

        function Ze(kf) {
            kf = kf | 0;
            Te[kf] = d;
            Te[kf | 1] = e;
            Te[kf | 2] = f;
            Te[kf | 3] = g;
            Te[kf | 4] = h;
            Te[kf | 5] = i;
            Te[kf | 6] = j;
            Te[kf | 7] = k;
            Te[kf | 8] = l;
            Te[kf | 9] = m;
            Te[kf | 10] = n;
            Te[kf | 11] = o;
            Te[kf | 12] = p;
            Te[kf | 13] = q;
            Te[kf | 14] = s;
            Te[kf | 15] = t
        }

        function $e(kf, lf, mf, nf, of, pf, qf, rf, sf, tf, uf, vf, wf, xf, yf, zf) {
            kf = kf | 0;
            lf = lf | 0;
            mf = mf | 0;
            nf = nf | 0;
            of = of | 0;
            pf = pf | 0;
            qf = qf | 0;
            rf = rf | 0;
            sf = sf | 0;
            tf = tf | 0;
            uf = uf | 0;
            vf = vf | 0;
            wf = wf | 0;
            xf = xf | 0;
            yf = yf | 0;
            zf = zf | 0;
            v = kf;
            w = lf;
            x = mf;
            y = nf;
            z = of;
            A = pf;
            B = qf;
            C = rf;
            D = sf;
            E = tf;
            F = uf;
            G = vf;
            H = wf;
            I = xf;
            J = yf;
            K = zf;
            u = 16;
            Ue()
        }

        function _e(kf, lf, mf, nf, of, pf, qf, rf, sf, tf, uf, vf, wf, xf, yf, zf, Af, Bf, Cf, Df, Ef, Ff, Gf, Hf, If, Jf, Kf, Lf, Mf, Nf, Of, Pf) {
            kf = kf | 0;
            lf = lf | 0;
            mf = mf | 0;
            nf = nf | 0;
            of = of | 0;
            pf = pf | 0;
            qf = qf | 0;
            rf = rf | 0;
            sf = sf | 0;
            tf = tf | 0;
            uf = uf | 0;
            vf = vf | 0;
            wf = wf | 0;
            xf = xf | 0;
            yf = yf | 0;
            zf = zf | 0;
            Af = Af | 0;
            Bf = Bf | 0;
            Cf = Cf | 0;
            Df = Df | 0;
            Ef = Ef | 0;
            Ff = Ff | 0;
            Gf = Gf | 0;
            Hf = Hf | 0;
            If = If | 0;
            Jf = Jf | 0;
            Kf = Kf | 0;
            Lf = Lf | 0;
            Mf = Mf | 0;
            Nf = Nf | 0;
            Of = Of | 0;
            Pf = Pf | 0;
            v = kf;
            w = lf;
            x = mf;
            y = nf;
            z = of;
            A = pf;
            B = qf;
            C = rf;
            D = sf;
            E = tf;
            F = uf;
            G = vf;
            H = wf;
            I = xf;
            J = yf;
            K = zf;
            L = Af;
            M = Bf;
            N = Cf;
            O = Df;
            P = Ef;
            Q = Ff;
            R = Gf;
            S = Hf;
            T = If;
            U = Jf;
            V = Kf;
            W = Lf;
            X = Mf;
            Y = Nf;
            Z = Of;
            $ = Pf;
            u = 32;
            Ve()
        }

        function af(kf, lf) {
            kf = kf | 0;
            lf = lf | 0;
            var mf = 0;
            if (kf & 15) return -1;
            while ((lf | 0) >= 16) {
                We(Te[kf] | 0, Te[kf | 1] | 0, Te[kf | 2] | 0, Te[kf | 3] | 0, Te[kf | 4] | 0, Te[kf | 5] | 0, Te[kf | 6] | 0, Te[kf | 7] | 0, Te[kf | 8] | 0, Te[kf | 9] | 0, Te[kf | 10] | 0, Te[kf | 11] | 0, Te[kf | 12] | 0, Te[kf | 13] | 0, Te[kf | 14] | 0, Te[kf | 15] | 0);
                Te[kf] = d;
                Te[kf | 1] = e;
                Te[kf | 2] = f;
                Te[kf | 3] = g;
                Te[kf | 4] = h;
                Te[kf | 5] = i;
                Te[kf | 6] = j;
                Te[kf | 7] = k;
                Te[kf | 8] = l;
                Te[kf | 9] = m;
                Te[kf | 10] = n;
                Te[kf | 11] = o;
                Te[kf | 12] = p;
                Te[kf | 13] = q;
                Te[kf | 14] = s;
                Te[kf | 15] = t;
                kf = kf + 16 | 0;
                lf = lf - 16 | 0;
                mf = mf + 16 | 0
            }
            return mf | 0
        }

        function bf(kf, lf) {
            kf = kf | 0;
            lf = lf | 0;
            var mf = 0;
            if (kf & 15) return -1;
            while ((lf | 0) >= 16) {
                Xe(Te[kf] | 0, Te[kf | 1] | 0, Te[kf | 2] | 0, Te[kf | 3] | 0, Te[kf | 4] | 0, Te[kf | 5] | 0, Te[kf | 6] | 0, Te[kf | 7] | 0, Te[kf | 8] | 0, Te[kf | 9] | 0, Te[kf | 10] | 0, Te[kf | 11] | 0, Te[kf | 12] | 0, Te[kf | 13] | 0, Te[kf | 14] | 0, Te[kf | 15] | 0);
                Te[kf] = d;
                Te[kf | 1] = e;
                Te[kf | 2] = f;
                Te[kf | 3] = g;
                Te[kf | 4] = h;
                Te[kf | 5] = i;
                Te[kf | 6] = j;
                Te[kf | 7] = k;
                Te[kf | 8] = l;
                Te[kf | 9] = m;
                Te[kf | 10] = n;
                Te[kf | 11] = o;
                Te[kf | 12] = p;
                Te[kf | 13] = q;
                Te[kf | 14] = s;
                Te[kf | 15] = t;
                kf = kf + 16 | 0;
                lf = lf - 16 | 0;
                mf = mf + 16 | 0
            }
            return mf | 0
        }

        function cf(kf, lf) {
            kf = kf | 0;
            lf = lf | 0;
            var mf = 0;
            if (kf & 15) return -1;
            while ((lf | 0) >= 16) {
                We(d ^ Te[kf], e ^ Te[kf | 1], f ^ Te[kf | 2], g ^ Te[kf | 3], h ^ Te[kf | 4], i ^ Te[kf | 5], j ^ Te[kf | 6], k ^ Te[kf | 7], l ^ Te[kf | 8], m ^ Te[kf | 9], n ^ Te[kf | 10], o ^ Te[kf | 11], p ^ Te[kf | 12], q ^ Te[kf | 13], s ^ Te[kf | 14], t ^ Te[kf | 15]);
                Te[kf] = d;
                Te[kf | 1] = e;
                Te[kf | 2] = f;
                Te[kf | 3] = g;
                Te[kf | 4] = h;
                Te[kf | 5] = i;
                Te[kf | 6] = j;
                Te[kf | 7] = k;
                Te[kf | 8] = l;
                Te[kf | 9] = m;
                Te[kf | 10] = n;
                Te[kf | 11] = o;
                Te[kf | 12] = p;
                Te[kf | 13] = q;
                Te[kf | 14] = s;
                Te[kf | 15] = t;
                kf = kf + 16 | 0;
                lf = lf - 16 | 0;
                mf = mf + 16 | 0
            }
            return mf | 0
        }

        function df(kf, lf) {
            kf = kf | 0;
            lf = lf | 0;
            var mf = 0,
                nf = 0,
                of = 0,
                pf = 0,
                qf = 0,
                rf = 0,
                sf = 0,
                tf = 0,
                uf = 0,
                vf = 0,
                wf = 0,
                xf = 0,
                yf = 0,
                zf = 0,
                Af = 0,
                Bf = 0,
                Cf = 0;
            if (kf & 15) return -1;
            mf = d;
            nf = e;
            of = f;
            pf = g;
            qf = h;
            rf = i;
            sf = j;
            tf = k;
            uf = l;
            vf = m;
            wf = n;
            xf = o;
            yf = p;
            zf = q;
            Af = s;
            Bf = t;
            while ((lf | 0) >= 16) {
                Xe(Te[kf] | 0, Te[kf | 1] | 0, Te[kf | 2] | 0, Te[kf | 3] | 0, Te[kf | 4] | 0, Te[kf | 5] | 0, Te[kf | 6] | 0, Te[kf | 7] | 0, Te[kf | 8] | 0, Te[kf | 9] | 0, Te[kf | 10] | 0, Te[kf | 11] | 0, Te[kf | 12] | 0, Te[kf | 13] | 0, Te[kf | 14] | 0, Te[kf | 15] | 0);
                d = d ^ mf;
                mf = Te[kf] | 0;
                e = e ^ nf;
                nf = Te[kf | 1] | 0;
                f = f ^ of;
                of = Te[kf | 2] | 0;
                g = g ^ pf;
                pf = Te[kf | 3] | 0;
                h = h ^ qf;
                qf = Te[kf | 4] | 0;
                i = i ^ rf;
                rf = Te[kf | 5] | 0;
                j = j ^ sf;
                sf = Te[kf | 6] | 0;
                k = k ^ tf;
                tf = Te[kf | 7] | 0;
                l = l ^ uf;
                uf = Te[kf | 8] | 0;
                m = m ^ vf;
                vf = Te[kf | 9] | 0;
                n = n ^ wf;
                wf = Te[kf | 10] | 0;
                o = o ^ xf;
                xf = Te[kf | 11] | 0;
                p = p ^ yf;
                yf = Te[kf | 12] | 0;
                q = q ^ zf;
                zf = Te[kf | 13] | 0;
                s = s ^ Af;
                Af = Te[kf | 14] | 0;
                t = t ^ Bf;
                Bf = Te[kf | 15] | 0;
                Te[kf] = d;
                Te[kf | 1] = e;
                Te[kf | 2] = f;
                Te[kf | 3] = g;
                Te[kf | 4] = h;
                Te[kf | 5] = i;
                Te[kf | 6] = j;
                Te[kf | 7] = k;
                Te[kf | 8] = l;
                Te[kf | 9] = m;
                Te[kf | 10] = n;
                Te[kf | 11] = o;
                Te[kf | 12] = p;
                Te[kf | 13] = q;
                Te[kf | 14] = s;
                Te[kf | 15] = t;
                kf = kf + 16 | 0;
                lf = lf - 16 | 0;
                Cf = Cf + 16 | 0
            }
            d = mf;
            e = nf;
            f = of;
            g = pf;
            h = qf;
            i = rf;
            j = sf;
            k = tf;
            l = uf;
            m = vf;
            n = wf;
            o = xf;
            p = yf;
            q = zf;
            s = Af;
            t = Bf;
            return Cf | 0
        }

        function ef(kf, lf, mf) {
            kf = kf | 0;
            lf = lf | 0;
            mf = mf | 0;
            if (kf & 15) return -1;
            if (~mf)
                if (mf & 31) return -1;
            while ((lf | 0) >= 16) {
                We(d ^ Te[kf], e ^ Te[kf | 1], f ^ Te[kf | 2], g ^ Te[kf | 3], h ^ Te[kf | 4], i ^ Te[kf | 5], j ^ Te[kf | 6], k ^ Te[kf | 7], l ^ Te[kf | 8], m ^ Te[kf | 9], n ^ Te[kf | 10], o ^ Te[kf | 11], p ^ Te[kf | 12], q ^ Te[kf | 13], s ^ Te[kf | 14], t ^ Te[kf | 15]);
                kf = kf + 16 | 0;
                lf = lf - 16 | 0
            }
            if ((lf | 0) > 0) {
                d = d ^ Te[kf];
                if ((lf | 0) > 1) e = e ^ Te[kf | 1];
                if ((lf | 0) > 2) f = f ^ Te[kf | 2];
                if ((lf | 0) > 3) g = g ^ Te[kf | 3];
                if ((lf | 0) > 4) h = h ^ Te[kf | 4];
                if ((lf | 0) > 5) i = i ^ Te[kf | 5];
                if ((lf | 0) > 6) j = j ^ Te[kf | 6];
                if ((lf | 0) > 7) k = k ^ Te[kf | 7];
                if ((lf | 0) > 8) l = l ^ Te[kf | 8];
                if ((lf | 0) > 9) m = m ^ Te[kf | 9];
                if ((lf | 0) > 10) n = n ^ Te[kf | 10];
                if ((lf | 0) > 11) o = o ^ Te[kf | 11];
                if ((lf | 0) > 12) p = p ^ Te[kf | 12];
                if ((lf | 0) > 13) q = q ^ Te[kf | 13];
                if ((lf | 0) > 14) s = s ^ Te[kf | 14];
                We(d, e, f, g, h, i, j, k, l, m, n, o, p, q, s, t);
                kf = kf + lf | 0;
                lf = 0
            }
            if (~mf) {
                Te[mf | 0] = d;
                Te[mf | 1] = e;
                Te[mf | 2] = f;
                Te[mf | 3] = g;
                Te[mf | 4] = h;
                Te[mf | 5] = i;
                Te[mf | 6] = j;
                Te[mf | 7] = k;
                Te[mf | 8] = l;
                Te[mf | 9] = m;
                Te[mf | 10] = n;
                Te[mf | 11] = o;
                Te[mf | 12] = p;
                Te[mf | 13] = q;
                Te[mf | 14] = s;
                Te[mf | 15] = t
            }
            return 0
        }

        function ff(kf, lf, mf, nf, of, pf, qf, rf, sf, tf, uf, vf, wf, xf, yf, zf, Af, Bf) {
            kf = kf | 0;
            lf = lf | 0;
            mf = mf | 0;
            nf = nf | 0;
            of = of | 0;
            pf = pf | 0;
            qf = qf | 0;
            rf = rf | 0;
            sf = sf | 0;
            tf = tf | 0;
            uf = uf | 0;
            vf = vf | 0;
            wf = wf | 0;
            xf = xf | 0;
            yf = yf | 0;
            zf = zf | 0;
            Af = Af | 0;
            Bf = Bf | 0;
            var Cf = 0,
                Df = 0,
                Ef = 0,
                Ff = 0,
                Gf = 0,
                Hf = 0,
                If = 0,
                Jf = 0,
                Kf = 0,
                Lf = 0,
                Mf = 0,
                Nf = 0,
                Of = 0,
                Pf = 0,
                Qf = 0,
                Rf = 0,
                Sf = 0,
                Tf = 0,
                Uf = 0,
                Vf = 0,
                Wf = 0,
                Xf = 0,
                Yf = 0,
                Zf = 0,
                $f = 0,
                _f = 0,
                ag = 0,
                bg = 0,
                cg = 0,
                dg = 0,
                eg = 0,
                fg = 0,
                gg = 0;
            if (kf & 15) return -1;
            Cf = d,
            Df = e,
            Ef = f,
            Ff = g,
            Gf = h,
            Hf = i,
            If = j,
            Jf = k,
            Kf = l,
            Lf = m,
            Mf = n,
            Nf = o,
            Of = p,
            Pf = q,
            Qf = s,
            Rf = t;
            while ((lf | 0) >= 16) {
                Sf = Te[kf] | 0;
                Tf = Te[kf | 1] | 0;
                Uf = Te[kf | 2] | 0;
                Vf = Te[kf | 3] | 0;
                Wf = Te[kf | 4] | 0;
                Xf = Te[kf | 5] | 0;
                Yf = Te[kf | 6] | 0;
                Zf = Te[kf | 7] | 0;
                $f = Te[kf | 8] | 0;
                _f = Te[kf | 9] | 0;
                ag = Te[kf | 10] | 0;
                bg = Te[kf | 11] | 0;
                cg = Te[kf | 12] | 0;
                dg = Te[kf | 13] | 0;
                eg = Te[kf | 14] | 0;
                fg = Te[kf | 15] | 0;
                We(mf, nf, of, pf, qf, rf, sf, tf, uf ^ Af >>> 24, vf ^ Af >>> 16 & 255, wf ^ Af >>> 8 & 255, xf ^ Af & 255, yf ^ Bf >>> 24, zf ^ Bf >>> 16 & 255, Bf >>> 8 & 255, Bf & 255);
                Te[kf] = Sf ^ d;
                Te[kf | 1] = Tf ^ e;
                Te[kf | 2] = Uf ^ f;
                Te[kf | 3] = Vf ^ g;
                Te[kf | 4] = Wf ^ h;
                Te[kf | 5] = Xf ^ i;
                Te[kf | 6] = Yf ^ j;
                Te[kf | 7] = Zf ^ k;
                Te[kf | 8] = $f ^ l;
                Te[kf | 9] = _f ^ m;
                Te[kf | 10] = ag ^ n;
                Te[kf | 11] = bg ^ o;
                Te[kf | 12] = cg ^ p;
                Te[kf | 13] = dg ^ q;
                Te[kf | 14] = eg ^ s;
                Te[kf | 15] = fg ^ t;
                We(Sf ^ Cf, Tf ^ Df, Uf ^ Ef, Vf ^ Ff, Wf ^ Gf, Xf ^ Hf, Yf ^ If, Zf ^ Jf, $f ^ Kf, _f ^ Lf, ag ^ Mf, bg ^ Nf, cg ^ Of, dg ^ Pf, eg ^ Qf, fg ^ Rf);
                Cf = d,
                Df = e,
                Ef = f,
                Ff = g,
                Gf = h,
                Hf = i,
                If = j,
                Jf = k,
                Kf = l,
                Lf = m,
                Mf = n,
                Nf = o,
                Of = p,
                Pf = q,
                Qf = s,
                Rf = t;
                gg = gg + 16 | 0;
                kf = kf + 16 | 0;
                lf = lf - 16 | 0;
                Bf = Bf + 1 | 0;
                if ((Bf | 0) == 0) Af = Af + 1 | 0
            }
            if ((lf | 0) > 0) {
                Sf = Te[kf] | 0;
                Tf = (lf | 0) > 1 ? Te[kf | 1] | 0 : 0;
                Uf = (lf | 0) > 2 ? Te[kf | 2] | 0 : 0;
                Vf = (lf | 0) > 3 ? Te[kf | 3] | 0 : 0;
                Wf = (lf | 0) > 4 ? Te[kf | 4] | 0 : 0;
                Xf = (lf | 0) > 5 ? Te[kf | 5] | 0 : 0;
                Yf = (lf | 0) > 6 ? Te[kf | 6] | 0 : 0;
                Zf = (lf | 0) > 7 ? Te[kf | 7] | 0 : 0;
                $f = (lf | 0) > 8 ? Te[kf | 8] | 0 : 0;
                _f = (lf | 0) > 9 ? Te[kf | 9] | 0 : 0;
                ag = (lf | 0) > 10 ? Te[kf | 10] | 0 : 0;
                bg = (lf | 0) > 11 ? Te[kf | 11] | 0 : 0;
                cg = (lf | 0) > 12 ? Te[kf | 12] | 0 : 0;
                dg = (lf | 0) > 13 ? Te[kf | 13] | 0 : 0;
                eg = (lf | 0) > 14 ? Te[kf | 14] | 0 : 0;
                We(mf, nf, of, pf, qf, rf, sf, tf, uf ^ Af >>> 24, vf ^ Af >>> 16 & 255, wf ^ Af >>> 8 & 255, xf ^ Af & 255, yf ^ Bf >>> 24, zf ^ Bf >>> 16 & 255, Bf >>> 8 & 255, Bf & 255);
                Te[kf] = Sf ^ d;
                if ((lf | 0) > 1) Te[kf | 1] = Tf ^ e;
                if ((lf | 0) > 2) Te[kf | 2] = Uf ^ f;
                if ((lf | 0) > 3) Te[kf | 3] = Vf ^ g;
                if ((lf | 0) > 4) Te[kf | 4] = Wf ^ h;
                if ((lf | 0) > 5) Te[kf | 5] = Xf ^ i;
                if ((lf | 0) > 6) Te[kf | 6] = Yf ^ j;
                if ((lf | 0) > 7) Te[kf | 7] = Zf ^ k;
                if ((lf | 0) > 8) Te[kf | 8] = $f ^ l;
                if ((lf | 0) > 9) Te[kf | 9] = _f ^ m;
                if ((lf | 0) > 10) Te[kf | 10] = ag ^ n;
                if ((lf | 0) > 11) Te[kf | 11] = bg ^ o;
                if ((lf | 0) > 12) Te[kf | 12] = cg ^ p;
                if ((lf | 0) > 13) Te[kf | 13] = dg ^ q;
                if ((lf | 0) > 14) Te[kf | 14] = eg ^ s;
                We(Sf ^ Cf, Tf ^ Df, Uf ^ Ef, Vf ^ Ff, Wf ^ Gf, Xf ^ Hf, Yf ^ If, Zf ^ Jf, $f ^ Kf, _f ^ Lf, ag ^ Mf, bg ^ Nf, cg ^ Of, dg ^ Pf, eg ^ Qf, Rf);
                Cf = d,
                Df = e,
                Ef = f,
                Ff = g,
                Gf = h,
                Hf = i,
                If = j,
                Jf = k,
                Kf = l,
                Lf = m,
                Mf = n,
                Nf = o,
                Of = p,
                Pf = q,
                Qf = s,
                Rf = t;
                gg = gg + lf | 0;
                kf = kf + lf | 0;
                lf = 0;
                Bf = Bf + 1 | 0;
                if ((Bf | 0) == 0) Af = Af + 1 | 0
            }
            return gg | 0
        }

        function gf(kf, lf, mf, nf, of, pf, qf, rf, sf, tf, uf, vf, wf, xf, yf, zf, Af, Bf) {
            kf = kf | 0;
            lf = lf | 0;
            mf = mf | 0;
            nf = nf | 0;
            of = of | 0;
            pf = pf | 0;
            qf = qf | 0;
            rf = rf | 0;
            sf = sf | 0;
            tf = tf | 0;
            uf = uf | 0;
            vf = vf | 0;
            wf = wf | 0;
            xf = xf | 0;
            yf = yf | 0;
            zf = zf | 0;
            Af = Af | 0;
            Bf = Bf | 0;
            var Cf = 0,
                Df = 0,
                Ef = 0,
                Ff = 0,
                Gf = 0,
                Hf = 0,
                If = 0,
                Jf = 0,
                Kf = 0,
                Lf = 0,
                Mf = 0,
                Nf = 0,
                Of = 0,
                Pf = 0,
                Qf = 0,
                Rf = 0,
                Sf = 0,
                Tf = 0,
                Uf = 0,
                Vf = 0,
                Wf = 0,
                Xf = 0,
                Yf = 0,
                Zf = 0,
                $f = 0,
                _f = 0,
                ag = 0,
                bg = 0,
                cg = 0,
                dg = 0,
                eg = 0,
                fg = 0,
                gg = 0;
            if (kf & 15) return -1;
            Cf = d,
            Df = e,
            Ef = f,
            Ff = g,
            Gf = h,
            Hf = i,
            If = j,
            Jf = k,
            Kf = l,
            Lf = m,
            Mf = n,
            Nf = o,
            Of = p,
            Pf = q,
            Qf = s,
            Rf = t;
            while ((lf | 0) >= 16) {
                We(mf, nf, of, pf, qf, rf, sf, tf, uf ^ Af >>> 24, vf ^ Af >>> 16 & 255, wf ^ Af >>> 8 & 255, xf ^ Af & 255, yf ^ Bf >>> 24, zf ^ Bf >>> 16 & 255, Bf >>> 8 & 255, Bf & 255);
                Te[kf] = Sf = Te[kf] ^ d;
                Te[kf | 1] = Tf = Te[kf | 1] ^ e;
                Te[kf | 2] = Uf = Te[kf | 2] ^ f;
                Te[kf | 3] = Vf = Te[kf | 3] ^ g;
                Te[kf | 4] = Wf = Te[kf | 4] ^ h;
                Te[kf | 5] = Xf = Te[kf | 5] ^ i;
                Te[kf | 6] = Yf = Te[kf | 6] ^ j;
                Te[kf | 7] = Zf = Te[kf | 7] ^ k;
                Te[kf | 8] = $f = Te[kf | 8] ^ l;
                Te[kf | 9] = _f = Te[kf | 9] ^ m;
                Te[kf | 10] = ag = Te[kf | 10] ^ n;
                Te[kf | 11] = bg = Te[kf | 11] ^ o;
                Te[kf | 12] = cg = Te[kf | 12] ^ p;
                Te[kf | 13] = dg = Te[kf | 13] ^ q;
                Te[kf | 14] = eg = Te[kf | 14] ^ s;
                Te[kf | 15] = fg = Te[kf | 15] ^ t;
                We(Sf ^ Cf, Tf ^ Df, Uf ^ Ef, Vf ^ Ff, Wf ^ Gf, Xf ^ Hf, Yf ^ If, Zf ^ Jf, $f ^ Kf, _f ^ Lf, ag ^ Mf, bg ^ Nf, cg ^ Of, dg ^ Pf, eg ^ Qf, fg ^ Rf);
                Cf = d,
                Df = e,
                Ef = f,
                Ff = g,
                Gf = h,
                Hf = i,
                If = j,
                Jf = k,
                Kf = l,
                Lf = m,
                Mf = n,
                Nf = o,
                Of = p,
                Pf = q,
                Qf = s,
                Rf = t;
                gg = gg + 16 | 0;
                kf = kf + 16 | 0;
                lf = lf - 16 | 0;
                Bf = Bf + 1 | 0;
                if ((Bf | 0) == 0) Af = Af + 1 | 0
            }
            if ((lf | 0) > 0) {
                We(mf, nf, of, pf, qf, rf, sf, tf, uf ^ Af >>> 24, vf ^ Af >>> 16 & 255, wf ^ Af >>> 8 & 255, xf ^ Af & 255, yf ^ Bf >>> 24, zf ^ Bf >>> 16 & 255, Bf >>> 8 & 255, Bf & 255);
                Sf = Te[kf] ^ d;
                Tf = (lf | 0) > 1 ? Te[kf | 1] ^ e : 0;
                Uf = (lf | 0) > 2 ? Te[kf | 2] ^ f : 0;
                Vf = (lf | 0) > 3 ? Te[kf | 3] ^ g : 0;
                Wf = (lf | 0) > 4 ? Te[kf | 4] ^ h : 0;
                Xf = (lf | 0) > 5 ? Te[kf | 5] ^ i : 0;
                Yf = (lf | 0) > 6 ? Te[kf | 6] ^ j : 0;
                Zf = (lf | 0) > 7 ? Te[kf | 7] ^ k : 0;
                $f = (lf | 0) > 8 ? Te[kf | 8] ^ l : 0;
                _f = (lf | 0) > 9 ? Te[kf | 9] ^ m : 0;
                ag = (lf | 0) > 10 ? Te[kf | 10] ^ n : 0;
                bg = (lf | 0) > 11 ? Te[kf | 11] ^ o : 0;
                cg = (lf | 0) > 12 ? Te[kf | 12] ^ p : 0;
                dg = (lf | 0) > 13 ? Te[kf | 13] ^ q : 0;
                eg = (lf | 0) > 14 ? Te[kf | 14] ^ s : 0;
                fg = (lf | 0) > 15 ? Te[kf | 15] ^ t : 0;
                Te[kf] = Sf;
                if ((lf | 0) > 1) Te[kf | 1] = Tf;
                if ((lf | 0) > 2) Te[kf | 2] = Uf;
                if ((lf | 0) > 3) Te[kf | 3] = Vf;
                if ((lf | 0) > 4) Te[kf | 4] = Wf;
                if ((lf | 0) > 5) Te[kf | 5] = Xf;
                if ((lf | 0) > 6) Te[kf | 6] = Yf;
                if ((lf | 0) > 7) Te[kf | 7] = Zf;
                if ((lf | 0) > 8) Te[kf | 8] = $f;
                if ((lf | 0) > 9) Te[kf | 9] = _f;
                if ((lf | 0) > 10) Te[kf | 10] = ag;
                if ((lf | 0) > 11) Te[kf | 11] = bg;
                if ((lf | 0) > 12) Te[kf | 12] = cg;
                if ((lf | 0) > 13) Te[kf | 13] = dg;
                if ((lf | 0) > 14) Te[kf | 14] = eg;
                We(Sf ^ Cf, Tf ^ Df, Uf ^ Ef, Vf ^ Ff, Wf ^ Gf, Xf ^ Hf, Yf ^ If, Zf ^ Jf, $f ^ Kf, _f ^ Lf, ag ^ Mf, bg ^ Nf, cg ^ Of, dg ^ Pf, eg ^ Qf, fg ^ Rf);
                Cf = d,
                Df = e,
                Ef = f,
                Ff = g,
                Gf = h,
                Hf = i,
                If = j,
                Jf = k,
                Kf = l,
                Lf = m,
                Mf = n,
                Nf = o,
                Of = p,
                Pf = q,
                Qf = s,
                Rf = t;
                gg = gg + lf | 0;
                kf = kf + lf | 0;
                lf = 0;
                Bf = Bf + 1 | 0;
                if ((Bf | 0) == 0) Af = Af + 1 | 0
            }
            return gg | 0
        }

        function hf(kf, lf) {
            kf = kf | 0;
            lf = lf | 0;
            var mf = 0;
            if (kf & 15) return -1;
            while ((lf | 0) >= 16) {
                We(d, e, f, g, h, i, j, k, l, m, n, o, p, q, s, t);
                d = d ^ Te[kf];
                e = e ^ Te[kf | 1];
                f = f ^ Te[kf | 2];
                g = g ^ Te[kf | 3];
                h = h ^ Te[kf | 4];
                i = i ^ Te[kf | 5];
                j = j ^ Te[kf | 6];
                k = k ^ Te[kf | 7];
                l = l ^ Te[kf | 8];
                m = m ^ Te[kf | 9];
                n = n ^ Te[kf | 10];
                o = o ^ Te[kf | 11];
                p = p ^ Te[kf | 12];
                q = q ^ Te[kf | 13];
                s = s ^ Te[kf | 14];
                t = t ^ Te[kf | 15];
                Te[kf] = d;
                Te[kf | 1] = e;
                Te[kf | 2] = f;
                Te[kf | 3] = g;
                Te[kf | 4] = h;
                Te[kf | 5] = i;
                Te[kf | 6] = j;
                Te[kf | 7] = k;
                Te[kf | 8] = l;
                Te[kf | 9] = m;
                Te[kf | 10] = n;
                Te[kf | 11] = o;
                Te[kf | 12] = p;
                Te[kf | 13] = q;
                Te[kf | 14] = s;
                Te[kf | 15] = t;
                kf = kf + 16 | 0;
                lf = lf - 16 | 0;
                mf = mf + 16 | 0
            }
            if ((lf | 0) > 0) {
                We(d, e, f, g, h, i, j, k, l, m, n, o, p, q, s, t);
                Te[kf] = Te[kf] ^ d;
                if ((lf | 0) > 1) Te[kf | 1] = Te[kf | 1] ^ e;
                if ((lf | 0) > 2) Te[kf | 2] = Te[kf | 2] ^ f;
                if ((lf | 0) > 3) Te[kf | 3] = Te[kf | 3] ^ g;
                if ((lf | 0) > 4) Te[kf | 4] = Te[kf | 4] ^ h;
                if ((lf | 0) > 5) Te[kf | 5] = Te[kf | 5] ^ i;
                if ((lf | 0) > 6) Te[kf | 6] = Te[kf | 6] ^ j;
                if ((lf | 0) > 7) Te[kf | 7] = Te[kf | 7] ^ k;
                if ((lf | 0) > 8) Te[kf | 8] = Te[kf | 8] ^ l;
                if ((lf | 0) > 9) Te[kf | 9] = Te[kf | 9] ^ m;
                if ((lf | 0) > 10) Te[kf | 10] = Te[kf | 10] ^ n;
                if ((lf | 0) > 11) Te[kf | 11] = Te[kf | 11] ^ o;
                if ((lf | 0) > 12) Te[kf | 12] = Te[kf | 12] ^ p;
                if ((lf | 0) > 13) Te[kf | 13] = Te[kf | 13] ^ q;
                if ((lf | 0) > 14) Te[kf | 14] = Te[kf | 14] ^ s;
                mf = mf + lf | 0;
                kf = kf + lf | 0;
                lf = 0
            }
            return mf | 0
        }

        function jf(kf, lf) {
            kf = kf | 0;
            lf = lf | 0;
            var mf = 0,
                nf = 0,
                of = 0,
                pf = 0,
                qf = 0,
                rf = 0,
                sf = 0,
                tf = 0,
                uf = 0,
                vf = 0,
                wf = 0,
                xf = 0,
                yf = 0,
                zf = 0,
                Af = 0,
                Bf = 0,
                Cf = 0;
            if (kf & 15) return -1;
            while ((lf | 0) >= 16) {
                We(d, e, f, g, h, i, j, k, l, m, n, o, p, q, s, t);
                mf = Te[kf] | 0;
                nf = Te[kf | 1] | 0;
                of = Te[kf | 2] | 0;
                pf = Te[kf | 3] | 0;
                qf = Te[kf | 4] | 0;
                rf = Te[kf | 5] | 0;
                sf = Te[kf | 6] | 0;
                tf = Te[kf | 7] | 0;
                uf = Te[kf | 8] | 0;
                vf = Te[kf | 9] | 0;
                wf = Te[kf | 10] | 0;
                xf = Te[kf | 11] | 0;
                yf = Te[kf | 12] | 0;
                zf = Te[kf | 13] | 0;
                Af = Te[kf | 14] | 0;
                Bf = Te[kf | 15] | 0;
                Te[kf] = d ^ mf;
                Te[kf | 1] = e ^ nf;
                Te[kf | 2] = f ^ of;
                Te[kf | 3] = g ^ pf;
                Te[kf | 4] = h ^ qf;
                Te[kf | 5] = i ^ rf;
                Te[kf | 6] = j ^ sf;
                Te[kf | 7] = k ^ tf;
                Te[kf | 8] = l ^ uf;
                Te[kf | 9] = m ^ vf;
                Te[kf | 10] = n ^ wf;
                Te[kf | 11] = o ^ xf;
                Te[kf | 12] = p ^ yf;
                Te[kf | 13] = q ^ zf;
                Te[kf | 14] = s ^ Af;
                Te[kf | 15] = t ^ Bf;
                d = mf;
                e = nf;
                f = of;
                g = pf;
                h = qf;
                i = rf;
                j = sf;
                k = tf;
                l = uf;
                m = vf;
                n = wf;
                o = xf;
                p = yf;
                q = zf;
                s = Af;
                t = Bf;
                kf = kf + 16 | 0;
                lf = lf - 16 | 0;
                Cf = Cf + 16 | 0
            }
            if ((lf | 0) > 0) {
                We(d, e, f, g, h, i, j, k, l, m, n, o, p, q, s, t);
                Te[kf] = Te[kf] ^ d;
                if ((lf | 0) > 1) Te[kf | 1] = Te[kf | 1] ^ e;
                if ((lf | 0) > 2) Te[kf | 2] = Te[kf | 2] ^ f;
                if ((lf | 0) > 3) Te[kf | 3] = Te[kf | 3] ^ g;
                if ((lf | 0) > 4) Te[kf | 4] = Te[kf | 4] ^ h;
                if ((lf | 0) > 5) Te[kf | 5] = Te[kf | 5] ^ i;
                if ((lf | 0) > 6) Te[kf | 6] = Te[kf | 6] ^ j;
                if ((lf | 0) > 7) Te[kf | 7] = Te[kf | 7] ^ k;
                if ((lf | 0) > 8) Te[kf | 8] = Te[kf | 8] ^ l;
                if ((lf | 0) > 9) Te[kf | 9] = Te[kf | 9] ^ m;
                if ((lf | 0) > 10) Te[kf | 10] = Te[kf | 10] ^ n;
                if ((lf | 0) > 11) Te[kf | 11] = Te[kf | 11] ^ o;
                if ((lf | 0) > 12) Te[kf | 12] = Te[kf | 12] ^ p;
                if ((lf | 0) > 13) Te[kf | 13] = Te[kf | 13] ^ q;
                if ((lf | 0) > 14) Te[kf | 14] = Te[kf | 14] ^ s;
                Cf = Cf + lf | 0;
                kf = kf + lf | 0;
                lf = 0
            }
            return Cf | 0
        }
        return {
            init_state: Ye,
            save_state: Ze,
            init_key_128: $e,
            init_key_256: _e,
            ecb_encrypt: af,
            ecb_decrypt: bf,
            cbc_encrypt: cf,
            cbc_decrypt: df,
            cbc_mac: ef,
            ccm_encrypt: ff,
            ccm_decrypt: gf,
            cfb_encrypt: hf,
            cfb_decrypt: jf
        }
    }

    function s(a, b, c) {
        var d = new Uint8Array(c);
        return d.set(_c),
            r(a, b, c)
    }

    function t(a) {
        if (a = a || {}, a.heapSize = a.heapSize || 4096, a.heapSize <= 0 || a.heapSize % 4096) throw new d('heapSize must be a positive number and multiple of 4096');
        this.BLOCK_SIZE = bd,
        this.heap = a.heap || new Uint8Array(a.heapSize),
        this.asm = a.asm || s(b, null, this.heap.buffer),
        this.pos = ad,
        this.len = 0,
        this.key = null,
        this.result = null,
        this.reset(a)
    }

    function u(a) {
        a = a || {},
        this.result = null,
        this.pos = ad,
        this.len = 0;
        var b = this.asm,
            c = a.key;
        if (void 0 !== c) {
            if (o(c) || p(c)) c = new Uint8Array(c);
            else {
                if (!n(c)) throw new TypeError('unexpected key type');
                var e = c;
                c = new Uint8Array(e.length);
                for (var f = 0; f < e.length; ++f) c[f] = e.charCodeAt(f)
            }
            if (16 === c.length) this.key = c,
                b.init_key_128.call(b, c[0], c[1], c[2], c[3], c[4], c[5], c[6], c[7], c[8], c[9], c[10], c[11], c[12], c[13], c[14], c[15]);
            else {
                if (24 === c.length) throw new d('illegal key size');
                if (32 !== c.length) throw new d('illegal key size');
                this.key = c,
                b.init_key_256.call(b, c[0], c[1], c[2], c[3], c[4], c[5], c[6], c[7], c[8], c[9], c[10], c[11], c[12], c[13], c[14], c[15], c[16], c[17], c[18], c[19], c[20], c[21], c[22], c[23], c[24], c[25], c[26], c[27], c[28], c[29], c[30], c[31])
            }
        }
        return this
    }

    function v(a) {
        var b = this.asm;
        if (void 0 !== a) {
            if (o(a) || p(a)) a = new Uint8Array(a);
            else {
                if (!n(a)) throw new TypeError('unexpected iv type');
                var c = a;
                a = new Uint8Array(c.length);
                for (var e = 0; e < c.length; ++e) a[e] = c.charCodeAt(e)
            }
            if (a.length !== bd) throw new d('illegal iv size');
            this.iv = a,
            b.init_state.call(b, a[0], a[1], a[2], a[3], a[4], a[5], a[6], a[7], a[8], a[9], a[10], a[11], a[12], a[13], a[14], a[15])
        } else this.iv = null,
            b.init_state.call(b, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0)
    }

    function w(a, b, c, d, e) {
        var f = a.byteLength - b,
            g = e > f ? f : e;
        if (o(c) || p(c)) a.set(new Uint8Array(c.buffer || c, d, g), b);
        else {
            if (!n(c)) throw new TypeError('unexpected data type');
            for (var h = 0; g > h; ++h) a[b + h] = c.charCodeAt(d + h)
        }
        return g
    }

    function x(a) {
        this.padding = !0,
        this.mode = 'ecb',
        t.call(this, a)
    }

    function y(a) {
        x.call(this, a)
    }

    function z(a) {
        x.call(this, a)
    }

    function A(a) {
        a = a || {},
        u.call(this, a);
        var b = a.padding;
        return this.padding = void 0 !== b ? !!b : !0,
            v.call(this),
            this
    }

    function B(a) {
        if (!this.key) throw new c('no key is associated with the instance');
        for (var b = a.byteOffset || 0, d = a.byteLength || a.length || 0, e = this.asm, f = this.heap, g = this.pos, h = this.len, i = 0, j = bd * Math.floor((h + d) / bd), k = 0, l = new Uint8Array(j); d > 0;) k = w(f, g + h, a, b, d),
            h += k,
            b += k,
            d -= k,
            k = e.ecb_encrypt(g, h),
            l.set(f.subarray(g, g + k), i),
            i += k,
            h > k ? (g += k, h -= k) : (g = ad, h = 0);
        return this.result = l,
            this.pos = g,
            this.len = h,
            this
    }

    function C() {
        if (!this.key) throw new c('no key is associated with the instance');
        var a = this.asm,
            b = this.heap,
            e = this.padding,
            f = this.pos,
            g = this.len,
            h = bd * Math.ceil(g / bd);
        if (g % bd === 0) e && (h += bd);
        else if (!e) throw new d('data length must be a multiple of ' + bd);
        var i = new Uint8Array(h);
        if (h > g) {
            for (var j = bd - g % bd, k = 0; j > k; ++k) b[f + g + k] = j;
            g += j
        }
        return g > 0 && (a.ecb_encrypt(f, g), i.set(b.subarray(f, f + g))),
            this.result = i,
            this.pos = ad,
            this.len = 0,
            this
    }

    function D(a) {
        var b,
            c = B.call(this, a).result,
            d = C.call(this).result;
        return b = new Uint8Array(c.length + d.length),
            b.set(c),
            d.length > 0 && b.set(d, c.length),
            this.result = b,
            this
    }

    function E(a) {
        if (!this.key) throw new c('no key is associated with the instance');
        for (var b = a.byteOffset || 0, d = a.byteLength || a.length || 0, e = this.asm, f = this.heap, g = this.padding, h = this.pos, i = this.len, j = 0, k = bd * Math.floor((i + d) / bd), l = 0, m = new Uint8Array(k); d > 0;) l = w(f, h + i, a, b, d),
            i += l,
            b += l,
            d -= l,
            l = e.ecb_decrypt(h, i - (g && 0 === d && i % bd === 0 ? bd : 0)),
            m.set(f.subarray(h, h + l), j),
            j += l,
            i > l ? (h += l, i -= l) : (h = ad, i = 0);
        return this.result = m.subarray(0, j),
            this.pos = h,
            this.len = i,
            this
    }

    function F() {
        if (!this.key) throw new c('no key is associated with the instance');
        var a = this.asm,
            b = this.heap,
            e = this.padding,
            f = this.pos,
            g = this.len;
        if (0 === g) {
            if (e) throw new c('padding not found');
            return this.result = new Uint8Array(0),
                this.pos = ad,
                this.len = 0,
                this
        }
        if (g % bd !== 0) throw new d('data length must be a multiple of ' + bd);
        var h = new Uint8Array(g);
        if (g > 0 && (a.ecb_decrypt(f, g), h.set(b.subarray(f, f + g))), e) {
            var i = h[g - 1];
            h = h.subarray(0, g - i)
        }
        return this.result = h,
            this.pos = ad,
            this.len = 0,
            this
    }

    function G(a) {
        var b,
            c = E.call(this, a).result,
            d = F.call(this).result;
        return b = new Uint8Array(c.length + d.length),
            b.set(c),
            d.length > 0 && b.set(d, c.length),
            this.result = b,
            this
    }

    function H(a) {
        this.padding = !0,
        this.mode = 'cbc',
        this.iv = null,
        t.call(this, a)
    }

    function I(a) {
        H.call(this, a)
    }

    function J(a) {
        H.call(this, a)
    }

    function K(a) {
        a = a || {},
        u.call(this, a);
        var b = a.padding;
        return this.padding = void 0 !== b ? !!b : !0,
            v.call(this, a.iv),
            this
    }

    function L(a) {
        if (!this.key) throw new c('no key is associated with the instance');
        for (var b = a.byteOffset || 0, d = a.byteLength || a.length || 0, e = this.asm, f = this.heap, g = this.pos, h = this.len, i = 0, j = bd * Math.floor((h + d) / bd), k = 0, l = new Uint8Array(j); d > 0;) k = w(f, g + h, a, b, d),
            h += k,
            b += k,
            d -= k,
            k = e.cbc_encrypt(g, h),
            l.set(f.subarray(g, g + k), i),
            i += k,
            h > k ? (g += k, h -= k) : (g = ad, h = 0);
        return this.result = l,
            this.pos = g,
            this.len = h,
            this
    }

    function M() {
        if (!this.key) throw new c('no key is associated with the instance');
        var a = this.asm,
            b = this.heap,
            e = this.padding,
            f = this.pos,
            g = this.len,
            h = bd * Math.ceil(g / bd);
        if (g % bd === 0) e && (h += bd);
        else if (!e) throw new d('data length must be a multiple of ' + bd);
        var i = new Uint8Array(h);
        if (h > g) {
            for (var j = bd - g % bd, k = 0; j > k; ++k) b[f + g + k] = j;
            g += j
        }
        return g > 0 && (a.cbc_encrypt(f, g), i.set(b.subarray(f, f + g))),
            this.result = i,
            this.pos = ad,
            this.len = 0,
            this
    }

    function N(a) {
        var b,
            c = L.call(this, a).result,
            d = M.call(this).result;
        return b = new Uint8Array(c.length + d.length),
            b.set(c),
            d.length > 0 && b.set(d, c.length),
            this.result = b,
            this
    }

    function O(a) {
        if (!this.key) throw new c('no key is associated with the instance');
        for (var b = a.byteOffset || 0, d = a.byteLength || a.length || 0, e = this.asm, f = this.heap, g = this.padding, h = this.pos, i = this.len, j = 0, k = bd * Math.floor((i + d) / bd), l = 0, m = new Uint8Array(k); d > 0;) l = w(f, h + i, a, b, d),
            i += l,
            b += l,
            d -= l,
            l = e.cbc_decrypt(h, i - (g && 0 === d && i % bd === 0 ? bd : 0)),
            m.set(f.subarray(h, h + l), j),
            j += l,
            i > l ? (h += l, i -= l) : (h = ad, i = 0);
        return this.result = m.subarray(0, j),
            this.pos = h,
            this.len = i,
            this
    }

    function P() {
        if (!this.key) throw new c('no key is associated with the instance');
        var a = this.asm,
            b = this.heap,
            e = this.padding,
            f = this.pos,
            g = this.len;
        if (0 === g) {
            if (e) throw new c('padding not found');
            return this.result = new Uint8Array(0),
                this.pos = ad,
                this.len = 0,
                this
        }
        if (g % bd !== 0) throw new d('data length must be a multiple of ' + bd);
        var h = new Uint8Array(g);
        if (g > 0 && (a.cbc_decrypt(f, g), h.set(b.subarray(f, f + g))), e) {
            var i = h[g - 1];
            h = h.subarray(0, g - i)
        }
        return this.result = h,
            this.pos = ad,
            this.len = 0,
            this
    }

    function Q(a) {
        var b,
            c = O.call(this, a).result,
            d = P.call(this).result;
        return b = new Uint8Array(c.length + d.length),
            b.set(c),
            d.length > 0 && b.set(d, c.length),
            this.result = b,
            this
    }

    function R(a) {
        for (var b = a.byteOffset || 0, c = a.byteLength || a.length || 0, d = 0; c > 0;) d = w(this.heap, ad, a, b, c),
            this.asm.cbc_mac(ad, d, -1),
            b += d,
            c -= d
    }

    function S(a) {
        this.padding = !1,
        this.mode = 'ccm',
        this.tagSize = bd,
        this.lengthSize = 4,
        this.nonce = null,
        this.adata = null,
        this.iv = null,
        this.dataLength = -1,
        this.dataLeft = -1,
        this.counter = 1,
        t.call(this, a)
    }

    function T(a) {
        S.call(this, a)
    }

    function U(a) {
        S.call(this, a)
    }

    function V() {
        var a = this.nonce,
            b = this.adata,
            c = this.tagSize,
            d = this.lengthSize,
            e = this.dataLength,
            f = new Uint8Array(bd + (b ? 2 + b.byteLength : 0));
        f[0] = (b ? 64 : 0) | c - 2 << 2 | d - 1,
        f.set(a, 1),
        d > 4 && (f[11] = (e - (e >>> 0)) / 4294967296 & 15),
        d > 3 && (f[12] = e >>> 24),
        d > 2 && (f[13] = e >>> 16 & 255),
        f[14] = e >>> 8 & 255,
        f[15] = 255 & e,
        b && (f[16] = b.byteLength >>> 8 & 255, f[17] = 255 & b.byteLength, f.set(b, 18)),
        R.call(this, f),
        this.asm.save_state(ad),
        this.iv = new Uint8Array(this.heap.subarray(ad, ad + bd))
    }

    function W(a) {
        a = a || {},
        u.call(this, a),
        v.call(this, a.iv);
        var b = a.tagSize;
        if (void 0 !== b) {
            if (!m(b)) throw new TypeError('tagSize must be a number');
            if (4 > b || b > 16 || 1 & b) throw new d('illegal tagSize value');
            this.tagSize = b
        } else this.tagSize = bd;
        var e = a.lengthSize,
            f = a.nonce;
        if (void 0 !== f) {
            if (o(f) || p(f)) f = new Uint8Array(f);
            else {
                if (!n(f)) throw new TypeError('unexpected nonce type');
                var g = f;
                f = new Uint8Array(g.length);
                for (var h = 0; h < g.length; ++h) f[h] = g.charCodeAt(h)
            }
            if (f.length < 10 || f.length > 13) throw new d('illegal nonce length');
            e = e || 15 - f.length,
            this.nonce = f
        } else this.nonce = null;
        if (void 0 !== e) {
            if (!m(e)) throw new TypeError('lengthSize must be a number');
            if (2 > e || e > 5 || f.length + e !== 15) throw new d('illegal lengthSize value');
            this.lengthSize = e
        } else this.lengthSize = e = 4;
        var i = this.iv,
            j = a.counter;
        if (void 0 !== j) {
            if (null === i) throw new c('iv is also required');
            if (!m(j)) throw new TypeError('counter must be a number');
            this.counter = j
        } else this.counter = 1;
        var k = a.dataLength;
        if (void 0 !== k) {
            if (!m(k)) throw new TypeError('dataLength must be a number');
            if (0 > k || k > jd || k > Math.pow(2, 8 * e) - 1) throw new d('illegal dataLength value');
            this.dataLength = k;
            var l = a.dataLeft || k;
            if (!m(l)) throw new TypeError('dataLeft must be a number');
            if (0 > l || l > k) throw new d('illegal dataLeft value');
            this.dataLeft = l
        } else this.dataLength = k = -1,
            this.dataLeft = k;
        var q = a.adata;
        if (void 0 !== q) {
            if (null !== i) throw new c('you must specify either adata or iv, not both');
            if (o(q) || p(q)) q = new Uint8Array(q);
            else {
                if (!n(q)) throw new TypeError('unexpected adata type');
                var g = q;
                q = new Uint8Array(g.length);
                for (var h = 0; h < g.length; ++h) q[h] = g.charCodeAt(h)
            }
            if (0 === q.byteLength || q.byteLength > id) throw new d('illegal adata length');
            this.adata = q,
            this.counter = 1
        } else this.adata = q = null;
        return -1 !== k && V.call(this),
        this
    }

    function X(a) {
        if (!this.key) throw new c('no key is associated with the instance');
        var b = a.byteOffset || 0,
            d = a.byteLength || a.length || 0,
            e = this.asm,
            f = this.heap,
            g = this.nonce,
            h = this.counter,
            i = this.pos,
            j = this.len,
            k = 0,
            l = bd * Math.floor((j + d) / bd),
            m = 0;
        if ((h - 1 << 4) + j + d > jd) throw new RangeError('counter overflow');
        for (var n = new Uint8Array(l), o = [
            0,
            0,
            this.lengthSize - 1,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0
        ], p = 0; p < g.length; p++) o[3 + p] = g[p];
        for (; d > 0;) m = w(f, i + j, a, b, d),
            j += m,
            b += m,
            d -= m,
            o[0] = i,
            o[1] = -16 & j,
            o[16] = h / 4294967296 >>> 0,
            o[17] = h >>> 0,
            m = e.ccm_encrypt.apply(e, o),
            n.set(f.subarray(i, i + m), k),
            h += m >>> 4,
            k += m,
            j > m ? (i += m, j -= m) : (i = ad, j = 0);
        return this.result = n,
            this.counter = h,
            this.pos = i,
            this.len = j,
            this
    }

    function Y() {
        if (!this.key) throw new c('no key is associated with the instance');
        for (var a = this.asm, b = this.heap, d = this.nonce, e = this.counter, f = this.tagSize, g = this.pos, h = this.len, i = 0, j = new Uint8Array(h + f), k = [
            0,
            0,
            this.lengthSize - 1,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0
        ], l = 0; l < d.length; l++) k[3 + l] = d[l];
        return k[0] = g,
            k[1] = h,
            k[16] = e / 4294967296 >>> 0,
            k[17] = e >>> 0,
            i = a.ccm_encrypt.apply(a, k),
            j.set(b.subarray(g, g + i)),
            e = 1,
            g = ad,
            h = 0,
            a.save_state(ad),
            k[0] = ad,
            k[1] = bd,
            k[16] = 0,
            k[17] = 0,
            a.ccm_encrypt.apply(a, k),
            j.set(b.subarray(ad, ad + f), i),
            this.result = j,
            this.counter = e,
            this.pos = g,
            this.len = h,
            this
    }

    function Z(a) {
        this.dataLength = this.dataLeft = a.byteLength || a.length || 0;
        var b,
            c = X.call(this, a).result,
            d = Y.call(this).result;
        return b = new Uint8Array(c.length + d.length),
            b.set(c),
            b.set(d, c.length),
            this.result = b,
            this
    }

    function $(a) {
        if (!this.key) throw new c('no key is associated with the instance');
        var b = a.byteOffset || 0,
            d = a.byteLength || a.length || 0,
            e = this.asm,
            f = this.heap,
            g = this.nonce,
            h = this.counter,
            i = this.tagSize,
            j = this.pos,
            k = this.len,
            l = 0,
            m = bd * Math.floor((k + d) / bd),
            n = 0;
        if ((h - 1 << 4) + k + d > jd) throw new RangeError('counter overflow');
        for (var o = new Uint8Array(m), p = [
            0,
            0,
            this.lengthSize - 1,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0
        ], q = 0; q < g.length; q++) p[3 + q] = g[q];
        for (; d > 0;) n = w(f, j + k, a, b, d),
            k += n,
            b += n,
            d -= n,
            p[0] = j,
            p[1] = k + d - i >= bd ? d >= i ? -16 & k : k + d - i & -16 : 0,
            p[16] = h / 4294967296 >>> 0,
            p[17] = h >>> 0,
            n = e.ccm_decrypt.apply(e, p),
            o.set(f.subarray(j, j + n), l),
            h += n >>> 4,
            l += n,
            k > n ? (j += n, k -= n) : (j = ad, k = 0);
        return this.result = o.subarray(0, l),
            this.counter = h,
            this.pos = j,
            this.len = k,
            this
    }

    function _() {
        if (!this.key) throw new c('no key is associated with the instance');
        var a = this.asm,
            b = this.heap,
            d = this.nonce,
            f = this.counter,
            g = this.tagSize,
            h = this.pos,
            i = this.len,
            j = i - g,
            k = 0;
        if (g > i) throw new c('authentication tag not found');
        for (var l = new Uint8Array(j), m = new Uint8Array(b.subarray(h + j, h + i)), n = [
            0,
            0,
            this.lengthSize - 1,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0,
            0
        ], o = 0; o < d.length; o++) n[3 + o] = d[o];
        n[0] = h,
        n[1] = j,
        n[16] = f / 4294967296 >>> 0,
        n[17] = f >>> 0,
        k = a.ccm_decrypt.apply(a, n),
        l.set(b.subarray(h, h + k)),
        f = 1,
        h = ad,
        i = 0,
        a.save_state(ad),
        n[0] = ad,
        n[1] = bd,
        n[16] = 0,
        n[17] = 0,
        a.ccm_encrypt.apply(a, n);
        for (var p = 0, o = 0; g > o; ++o) p |= m[o] ^ b[ad + o];
        if (p) throw new e('data integrity check failed');
        return this.result = l,
            this.counter = f,
            this.pos = h,
            this.len = i,
            this
    }

    function ab(a) {
        this.dataLength = this.dataLeft = a.byteLength || a.length || 0;
        var b,
            c = $.call(this, a).result,
            d = _.call(this).result;
        return b = new Uint8Array(c.length + d.length),
            b.set(c),
            b.set(d, c.length),
            this.result = b,
            this
    }

    function bb(a, b, c) {
        if (void 0 === a) throw new SyntaxError('data required');
        if (void 0 === b) throw new SyntaxError('key required');
        return od.reset({
            key: b,
            padding: c
        }).encrypt(a).result
    }

    function cb(a, b, c) {
        if (void 0 === a) throw new SyntaxError('data required');
        if (void 0 === b) throw new SyntaxError('key required');
        return od.reset({
            key: b,
            padding: c
        }).decrypt(a).result
    }

    function db(a, b, c, d) {
        if (void 0 === a) throw new SyntaxError('data required');
        if (void 0 === b) throw new SyntaxError('key required');
        return pd.reset({
            key: b,
            padding: c,
            iv: d
        }).encrypt(a).result
    }

    function eb(a, b, c, d) {
        if (void 0 === a) throw new SyntaxError('data required');
        if (void 0 === b) throw new SyntaxError('key required');
        return pd.reset({
            key: b,
            padding: c,
            iv: d
        }).decrypt(a).result
    }

    function fb(a, b, c, d, e) {
        if (void 0 === a) throw new SyntaxError('data required');
        if (void 0 === b) throw new SyntaxError('key required');
        if (void 0 === c) throw new SyntaxError('nonce required');
        var f = a.byteLength || a.length || 0;
        return qd.reset({
            key: b,
            nonce: c,
            adata: d,
            tagSize: e,
            dataLength: f
        }).encrypt(a).result
    }

    function gb(a, b, c, d, e) {
        if (void 0 === a) throw new SyntaxError('data required');
        if (void 0 === b) throw new SyntaxError('key required');
        if (void 0 === c) throw new SyntaxError('nonce required');
        var f = a.byteLength || a.length || 0;
        return e = e || bd,
            qd.reset({
                key: b,
                nonce: c,
                adata: d,
                tagSize: e,
                dataLength: f - e
            }).decrypt(a).result
    }

    function hb(a, b, c) {
        'use asm';
        var d = 0,
            e = 0,
            f = 0,
            g = 0,
            h = 0,
            i = 0;
        var j = 0,
            k = 0,
            l = 0,
            m = 0,
            n = 0,
            o = 0,
            p = 0,
            q = 0,
            r = 0,
            s = 0;
        var t = new a.Uint8Array(c);

        function u(G, H, I, J, K, L, M, N, O, P, Q, R, S, T, U, V) {
            G = G | 0;
            H = H | 0;
            I = I | 0;
            J = J | 0;
            K = K | 0;
            L = L | 0;
            M = M | 0;
            N = N | 0;
            O = O | 0;
            P = P | 0;
            Q = Q | 0;
            R = R | 0;
            S = S | 0;
            T = T | 0;
            U = U | 0;
            V = V | 0;
            var W = 0,
                X = 0,
                Y = 0,
                Z = 0,
                $ = 0,
                _ = 0,
                ab = 0,
                bb = 0,
                cb = 0,
                db = 0,
                eb = 0,
                fb = 0,
                gb = 0,
                hb = 0,
                ib = 0,
                jb = 0,
                kb = 0,
                lb = 0,
                mb = 0,
                nb = 0,
                ob = 0,
                pb = 0,
                qb = 0,
                rb = 0,
                sb = 0,
                tb = 0,
                ub = 0,
                vb = 0,
                wb = 0,
                xb = 0,
                yb = 0,
                zb = 0,
                Ab = 0,
                Bb = 0,
                Cb = 0,
                Db = 0,
                Eb = 0,
                Fb = 0,
                Gb = 0,
                Hb = 0,
                Ib = 0,
                Jb = 0,
                Kb = 0,
                Lb = 0,
                Mb = 0,
                Nb = 0,
                Ob = 0,
                Pb = 0,
                Qb = 0,
                Rb = 0,
                Sb = 0,
                Tb = 0,
                Ub = 0,
                Vb = 0,
                Wb = 0,
                Xb = 0,
                Yb = 0,
                Zb = 0,
                $b = 0,
                _b = 0,
                ac = 0,
                bc = 0,
                cc = 0,
                dc = 0,
                ec = 0,
                fc = 0,
                gc = 0,
                hc = 0,
                ic = 0,
                jc = 0,
                kc = 0;
            W = d;
            X = e;
            Y = f;
            Z = g;
            $ = h;
            ab = G + (W << 5 | W >>> 27) + $ + (X & Y | ~X & Z) + 1518500249 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            ab = H + (W << 5 | W >>> 27) + $ + (X & Y | ~X & Z) + 1518500249 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            ab = I + (W << 5 | W >>> 27) + $ + (X & Y | ~X & Z) + 1518500249 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            ab = J + (W << 5 | W >>> 27) + $ + (X & Y | ~X & Z) + 1518500249 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            ab = K + (W << 5 | W >>> 27) + $ + (X & Y | ~X & Z) + 1518500249 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            ab = L + (W << 5 | W >>> 27) + $ + (X & Y | ~X & Z) + 1518500249 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            ab = M + (W << 5 | W >>> 27) + $ + (X & Y | ~X & Z) + 1518500249 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            ab = N + (W << 5 | W >>> 27) + $ + (X & Y | ~X & Z) + 1518500249 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            ab = O + (W << 5 | W >>> 27) + $ + (X & Y | ~X & Z) + 1518500249 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            ab = P + (W << 5 | W >>> 27) + $ + (X & Y | ~X & Z) + 1518500249 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            ab = Q + (W << 5 | W >>> 27) + $ + (X & Y | ~X & Z) + 1518500249 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            ab = R + (W << 5 | W >>> 27) + $ + (X & Y | ~X & Z) + 1518500249 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            ab = S + (W << 5 | W >>> 27) + $ + (X & Y | ~X & Z) + 1518500249 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            ab = T + (W << 5 | W >>> 27) + $ + (X & Y | ~X & Z) + 1518500249 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            ab = U + (W << 5 | W >>> 27) + $ + (X & Y | ~X & Z) + 1518500249 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            ab = V + (W << 5 | W >>> 27) + $ + (X & Y | ~X & Z) + 1518500249 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            _ = T ^ O ^ I ^ G;
            bb = _ << 1 | _ >>> 31;
            ab = bb + (W << 5 | W >>> 27) + $ + (X & Y | ~X & Z) + 1518500249 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            _ = U ^ P ^ J ^ H;
            cb = _ << 1 | _ >>> 31;
            ab = cb + (W << 5 | W >>> 27) + $ + (X & Y | ~X & Z) + 1518500249 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            _ = V ^ Q ^ K ^ I;
            db = _ << 1 | _ >>> 31;
            ab = db + (W << 5 | W >>> 27) + $ + (X & Y | ~X & Z) + 1518500249 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            _ = bb ^ R ^ L ^ J;
            eb = _ << 1 | _ >>> 31;
            ab = eb + (W << 5 | W >>> 27) + $ + (X & Y | ~X & Z) + 1518500249 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            _ = cb ^ S ^ M ^ K;
            fb = _ << 1 | _ >>> 31;
            ab = fb + (W << 5 | W >>> 27) + $ + (X ^ Y ^ Z) + 1859775393 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            _ = db ^ T ^ N ^ L;
            gb = _ << 1 | _ >>> 31;
            ab = gb + (W << 5 | W >>> 27) + $ + (X ^ Y ^ Z) + 1859775393 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            _ = eb ^ U ^ O ^ M;
            hb = _ << 1 | _ >>> 31;
            ab = hb + (W << 5 | W >>> 27) + $ + (X ^ Y ^ Z) + 1859775393 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            _ = fb ^ V ^ P ^ N;
            ib = _ << 1 | _ >>> 31;
            ab = ib + (W << 5 | W >>> 27) + $ + (X ^ Y ^ Z) + 1859775393 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            _ = gb ^ bb ^ Q ^ O;
            jb = _ << 1 | _ >>> 31;
            ab = jb + (W << 5 | W >>> 27) + $ + (X ^ Y ^ Z) + 1859775393 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            _ = hb ^ cb ^ R ^ P;
            kb = _ << 1 | _ >>> 31;
            ab = kb + (W << 5 | W >>> 27) + $ + (X ^ Y ^ Z) + 1859775393 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            _ = ib ^ db ^ S ^ Q;
            lb = _ << 1 | _ >>> 31;
            ab = lb + (W << 5 | W >>> 27) + $ + (X ^ Y ^ Z) + 1859775393 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            _ = jb ^ eb ^ T ^ R;
            mb = _ << 1 | _ >>> 31;
            ab = mb + (W << 5 | W >>> 27) + $ + (X ^ Y ^ Z) + 1859775393 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            _ = kb ^ fb ^ U ^ S;
            nb = _ << 1 | _ >>> 31;
            ab = nb + (W << 5 | W >>> 27) + $ + (X ^ Y ^ Z) + 1859775393 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            _ = lb ^ gb ^ V ^ T;
            ob = _ << 1 | _ >>> 31;
            ab = ob + (W << 5 | W >>> 27) + $ + (X ^ Y ^ Z) + 1859775393 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            _ = mb ^ hb ^ bb ^ U;
            pb = _ << 1 | _ >>> 31;
            ab = pb + (W << 5 | W >>> 27) + $ + (X ^ Y ^ Z) + 1859775393 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            _ = nb ^ ib ^ cb ^ V;
            qb = _ << 1 | _ >>> 31;
            ab = qb + (W << 5 | W >>> 27) + $ + (X ^ Y ^ Z) + 1859775393 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            _ = ob ^ jb ^ db ^ bb;
            rb = _ << 1 | _ >>> 31;
            ab = rb + (W << 5 | W >>> 27) + $ + (X ^ Y ^ Z) + 1859775393 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            _ = pb ^ kb ^ eb ^ cb;
            sb = _ << 1 | _ >>> 31;
            ab = sb + (W << 5 | W >>> 27) + $ + (X ^ Y ^ Z) + 1859775393 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            _ = qb ^ lb ^ fb ^ db;
            tb = _ << 1 | _ >>> 31;
            ab = tb + (W << 5 | W >>> 27) + $ + (X ^ Y ^ Z) + 1859775393 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            _ = rb ^ mb ^ gb ^ eb;
            ub = _ << 1 | _ >>> 31;
            ab = ub + (W << 5 | W >>> 27) + $ + (X ^ Y ^ Z) + 1859775393 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            _ = sb ^ nb ^ hb ^ fb;
            vb = _ << 1 | _ >>> 31;
            ab = vb + (W << 5 | W >>> 27) + $ + (X ^ Y ^ Z) + 1859775393 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            _ = tb ^ ob ^ ib ^ gb;
            wb = _ << 1 | _ >>> 31;
            ab = wb + (W << 5 | W >>> 27) + $ + (X ^ Y ^ Z) + 1859775393 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            _ = ub ^ pb ^ jb ^ hb;
            xb = _ << 1 | _ >>> 31;
            ab = xb + (W << 5 | W >>> 27) + $ + (X ^ Y ^ Z) + 1859775393 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            _ = vb ^ qb ^ kb ^ ib;
            yb = _ << 1 | _ >>> 31;
            ab = yb + (W << 5 | W >>> 27) + $ + (X ^ Y ^ Z) + 1859775393 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            _ = wb ^ rb ^ lb ^ jb;
            zb = _ << 1 | _ >>> 31;
            ab = zb + (W << 5 | W >>> 27) + $ + (X & Y | X & Z | Y & Z) - 1894007588 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            _ = xb ^ sb ^ mb ^ kb;
            Ab = _ << 1 | _ >>> 31;
            ab = Ab + (W << 5 | W >>> 27) + $ + (X & Y | X & Z | Y & Z) - 1894007588 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            _ = yb ^ tb ^ nb ^ lb;
            Bb = _ << 1 | _ >>> 31;
            ab = Bb + (W << 5 | W >>> 27) + $ + (X & Y | X & Z | Y & Z) - 1894007588 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            _ = zb ^ ub ^ ob ^ mb;
            Cb = _ << 1 | _ >>> 31;
            ab = Cb + (W << 5 | W >>> 27) + $ + (X & Y | X & Z | Y & Z) - 1894007588 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            _ = Ab ^ vb ^ pb ^ nb;
            Db = _ << 1 | _ >>> 31;
            ab = Db + (W << 5 | W >>> 27) + $ + (X & Y | X & Z | Y & Z) - 1894007588 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            _ = Bb ^ wb ^ qb ^ ob;
            Eb = _ << 1 | _ >>> 31;
            ab = Eb + (W << 5 | W >>> 27) + $ + (X & Y | X & Z | Y & Z) - 1894007588 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            _ = Cb ^ xb ^ rb ^ pb;
            Fb = _ << 1 | _ >>> 31;
            ab = Fb + (W << 5 | W >>> 27) + $ + (X & Y | X & Z | Y & Z) - 1894007588 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            _ = Db ^ yb ^ sb ^ qb;
            Gb = _ << 1 | _ >>> 31;
            ab = Gb + (W << 5 | W >>> 27) + $ + (X & Y | X & Z | Y & Z) - 1894007588 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            _ = Eb ^ zb ^ tb ^ rb;
            Hb = _ << 1 | _ >>> 31;
            ab = Hb + (W << 5 | W >>> 27) + $ + (X & Y | X & Z | Y & Z) - 1894007588 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            _ = Fb ^ Ab ^ ub ^ sb;
            Ib = _ << 1 | _ >>> 31;
            ab = Ib + (W << 5 | W >>> 27) + $ + (X & Y | X & Z | Y & Z) - 1894007588 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            _ = Gb ^ Bb ^ vb ^ tb;
            Jb = _ << 1 | _ >>> 31;
            ab = Jb + (W << 5 | W >>> 27) + $ + (X & Y | X & Z | Y & Z) - 1894007588 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            _ = Hb ^ Cb ^ wb ^ ub;
            Kb = _ << 1 | _ >>> 31;
            ab = Kb + (W << 5 | W >>> 27) + $ + (X & Y | X & Z | Y & Z) - 1894007588 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            _ = Ib ^ Db ^ xb ^ vb;
            Lb = _ << 1 | _ >>> 31;
            ab = Lb + (W << 5 | W >>> 27) + $ + (X & Y | X & Z | Y & Z) - 1894007588 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            _ = Jb ^ Eb ^ yb ^ wb;
            Mb = _ << 1 | _ >>> 31;
            ab = Mb + (W << 5 | W >>> 27) + $ + (X & Y | X & Z | Y & Z) - 1894007588 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            _ = Kb ^ Fb ^ zb ^ xb;
            Nb = _ << 1 | _ >>> 31;
            ab = Nb + (W << 5 | W >>> 27) + $ + (X & Y | X & Z | Y & Z) - 1894007588 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            _ = Lb ^ Gb ^ Ab ^ yb;
            Ob = _ << 1 | _ >>> 31;
            ab = Ob + (W << 5 | W >>> 27) + $ + (X & Y | X & Z | Y & Z) - 1894007588 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            _ = Mb ^ Hb ^ Bb ^ zb;
            Pb = _ << 1 | _ >>> 31;
            ab = Pb + (W << 5 | W >>> 27) + $ + (X & Y | X & Z | Y & Z) - 1894007588 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            _ = Nb ^ Ib ^ Cb ^ Ab;
            Qb = _ << 1 | _ >>> 31;
            ab = Qb + (W << 5 | W >>> 27) + $ + (X & Y | X & Z | Y & Z) - 1894007588 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            _ = Ob ^ Jb ^ Db ^ Bb;
            Rb = _ << 1 | _ >>> 31;
            ab = Rb + (W << 5 | W >>> 27) + $ + (X & Y | X & Z | Y & Z) - 1894007588 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            _ = Pb ^ Kb ^ Eb ^ Cb;
            Sb = _ << 1 | _ >>> 31;
            ab = Sb + (W << 5 | W >>> 27) + $ + (X & Y | X & Z | Y & Z) - 1894007588 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            _ = Qb ^ Lb ^ Fb ^ Db;
            Tb = _ << 1 | _ >>> 31;
            ab = Tb + (W << 5 | W >>> 27) + $ + (X ^ Y ^ Z) - 899497514 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            _ = Rb ^ Mb ^ Gb ^ Eb;
            Ub = _ << 1 | _ >>> 31;
            ab = Ub + (W << 5 | W >>> 27) + $ + (X ^ Y ^ Z) - 899497514 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            _ = Sb ^ Nb ^ Hb ^ Fb;
            Vb = _ << 1 | _ >>> 31;
            ab = Vb + (W << 5 | W >>> 27) + $ + (X ^ Y ^ Z) - 899497514 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            _ = Tb ^ Ob ^ Ib ^ Gb;
            Wb = _ << 1 | _ >>> 31;
            ab = Wb + (W << 5 | W >>> 27) + $ + (X ^ Y ^ Z) - 899497514 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            _ = Ub ^ Pb ^ Jb ^ Hb;
            Xb = _ << 1 | _ >>> 31;
            ab = Xb + (W << 5 | W >>> 27) + $ + (X ^ Y ^ Z) - 899497514 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            _ = Vb ^ Qb ^ Kb ^ Ib;
            Yb = _ << 1 | _ >>> 31;
            ab = Yb + (W << 5 | W >>> 27) + $ + (X ^ Y ^ Z) - 899497514 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            _ = Wb ^ Rb ^ Lb ^ Jb;
            Zb = _ << 1 | _ >>> 31;
            ab = Zb + (W << 5 | W >>> 27) + $ + (X ^ Y ^ Z) - 899497514 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            _ = Xb ^ Sb ^ Mb ^ Kb;
            $b = _ << 1 | _ >>> 31;
            ab = $b + (W << 5 | W >>> 27) + $ + (X ^ Y ^ Z) - 899497514 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            _ = Yb ^ Tb ^ Nb ^ Lb;
            _b = _ << 1 | _ >>> 31;
            ab = _b + (W << 5 | W >>> 27) + $ + (X ^ Y ^ Z) - 899497514 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            _ = Zb ^ Ub ^ Ob ^ Mb;
            ac = _ << 1 | _ >>> 31;
            ab = ac + (W << 5 | W >>> 27) + $ + (X ^ Y ^ Z) - 899497514 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            _ = $b ^ Vb ^ Pb ^ Nb;
            bc = _ << 1 | _ >>> 31;
            ab = bc + (W << 5 | W >>> 27) + $ + (X ^ Y ^ Z) - 899497514 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            _ = _b ^ Wb ^ Qb ^ Ob;
            cc = _ << 1 | _ >>> 31;
            ab = cc + (W << 5 | W >>> 27) + $ + (X ^ Y ^ Z) - 899497514 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            _ = ac ^ Xb ^ Rb ^ Pb;
            dc = _ << 1 | _ >>> 31;
            ab = dc + (W << 5 | W >>> 27) + $ + (X ^ Y ^ Z) - 899497514 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            _ = bc ^ Yb ^ Sb ^ Qb;
            ec = _ << 1 | _ >>> 31;
            ab = ec + (W << 5 | W >>> 27) + $ + (X ^ Y ^ Z) - 899497514 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            _ = cc ^ Zb ^ Tb ^ Rb;
            fc = _ << 1 | _ >>> 31;
            ab = fc + (W << 5 | W >>> 27) + $ + (X ^ Y ^ Z) - 899497514 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            _ = dc ^ $b ^ Ub ^ Sb;
            gc = _ << 1 | _ >>> 31;
            ab = gc + (W << 5 | W >>> 27) + $ + (X ^ Y ^ Z) - 899497514 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            _ = ec ^ _b ^ Vb ^ Tb;
            hc = _ << 1 | _ >>> 31;
            ab = hc + (W << 5 | W >>> 27) + $ + (X ^ Y ^ Z) - 899497514 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            _ = fc ^ ac ^ Wb ^ Ub;
            ic = _ << 1 | _ >>> 31;
            ab = ic + (W << 5 | W >>> 27) + $ + (X ^ Y ^ Z) - 899497514 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            _ = gc ^ bc ^ Xb ^ Vb;
            jc = _ << 1 | _ >>> 31;
            ab = jc + (W << 5 | W >>> 27) + $ + (X ^ Y ^ Z) - 899497514 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            _ = hc ^ cc ^ Yb ^ Wb;
            kc = _ << 1 | _ >>> 31;
            ab = kc + (W << 5 | W >>> 27) + $ + (X ^ Y ^ Z) - 899497514 | 0;
            $ = Z;
            Z = Y;
            Y = X << 30 | X >>> 2;
            X = W;
            W = ab;
            d = d + W | 0;
            e = e + X | 0;
            f = f + Y | 0;
            g = g + Z | 0;
            h = h + $ | 0
        }

        function v(G) {
            G = G | 0;
            u(t[G | 0] << 24 | t[G | 1] << 16 | t[G | 2] << 8 | t[G | 3], t[G | 4] << 24 | t[G | 5] << 16 | t[G | 6] << 8 | t[G | 7], t[G | 8] << 24 | t[G | 9] << 16 | t[G | 10] << 8 | t[G | 11], t[G | 12] << 24 | t[G | 13] << 16 | t[G | 14] << 8 | t[G | 15], t[G | 16] << 24 | t[G | 17] << 16 | t[G | 18] << 8 | t[G | 19], t[G | 20] << 24 | t[G | 21] << 16 | t[G | 22] << 8 | t[G | 23], t[G | 24] << 24 | t[G | 25] << 16 | t[G | 26] << 8 | t[G | 27], t[G | 28] << 24 | t[G | 29] << 16 | t[G | 30] << 8 | t[G | 31], t[G | 32] << 24 | t[G | 33] << 16 | t[G | 34] << 8 | t[G | 35], t[G | 36] << 24 | t[G | 37] << 16 | t[G | 38] << 8 | t[G | 39], t[G | 40] << 24 | t[G | 41] << 16 | t[G | 42] << 8 | t[G | 43], t[G | 44] << 24 | t[G | 45] << 16 | t[G | 46] << 8 | t[G | 47], t[G | 48] << 24 | t[G | 49] << 16 | t[G | 50] << 8 | t[G | 51], t[G | 52] << 24 | t[G | 53] << 16 | t[G | 54] << 8 | t[G | 55], t[G | 56] << 24 | t[G | 57] << 16 | t[G | 58] << 8 | t[G | 59], t[G | 60] << 24 | t[G | 61] << 16 | t[G | 62] << 8 | t[G | 63])
        }

        function w(G) {
            G = G | 0;
            t[G | 0] = d >>> 24;
            t[G | 1] = d >>> 16 & 255;
            t[G | 2] = d >>> 8 & 255;
            t[G | 3] = d & 255;
            t[G | 4] = e >>> 24;
            t[G | 5] = e >>> 16 & 255;
            t[G | 6] = e >>> 8 & 255;
            t[G | 7] = e & 255;
            t[G | 8] = f >>> 24;
            t[G | 9] = f >>> 16 & 255;
            t[G | 10] = f >>> 8 & 255;
            t[G | 11] = f & 255;
            t[G | 12] = g >>> 24;
            t[G | 13] = g >>> 16 & 255;
            t[G | 14] = g >>> 8 & 255;
            t[G | 15] = g & 255;
            t[G | 16] = h >>> 24;
            t[G | 17] = h >>> 16 & 255;
            t[G | 18] = h >>> 8 & 255;
            t[G | 19] = h & 255
        }

        function x() {
            d = 1732584193;
            e = 4023233417;
            f = 2562383102;
            g = 271733878;
            h = 3285377520;
            i = 0
        }

        function y(G, H, I, J, K, L) {
            G = G | 0;
            H = H | 0;
            I = I | 0;
            J = J | 0;
            K = K | 0;
            L = L | 0;
            d = G;
            e = H;
            f = I;
            g = J;
            h = K;
            i = L
        }

        function z(G, H) {
            G = G | 0;
            H = H | 0;
            var I = 0;
            if (G & 63) return -1;
            while ((H | 0) >= 64) {
                v(G);
                G = G + 64 | 0;
                H = H - 64 | 0;
                I = I + 64 | 0
            }
            i = i + I | 0;
            return I | 0
        }

        function A(G, H, I) {
            G = G | 0;
            H = H | 0;
            I = I | 0;
            var J = 0,
                K = 0;
            if (G & 63) return -1;
            if (~I)
                if (I & 31) return -1;
            if ((H | 0) >= 64) {
                J = z(G, H) | 0;
                if ((J | 0) == -1) return -1;
                G = G + J | 0;
                H = H - J | 0
            }
            J = J + H | 0;
            i = i + H | 0;
            t[G | H] = 128;
            if ((H | 0) >= 56) {
                for (K = H + 1 | 0;
                    (K | 0) < 64; K = K + 1 | 0) t[G | K] = 0;
                v(G);
                H = 0;
                t[G | 0] = 0
            }
            for (K = H + 1 | 0;
                (K | 0) < 59; K = K + 1 | 0) t[G | K] = 0;
            t[G | 59] = i >>> 29;
            t[G | 60] = i >>> 21 & 255;
            t[G | 61] = i >>> 13 & 255;
            t[G | 62] = i >>> 5 & 255;
            t[G | 63] = i << 3 & 255;
            v(G);
            if (~I) w(I);
            return J | 0
        }

        function B() {
            d = j;
            e = k;
            f = l;
            g = m;
            h = n;
            i = 64
        }

        function C() {
            d = o;
            e = p;
            f = q;
            g = r;
            h = s;
            i = 64
        }

        function D(G, H, I, J, K, L, M, N, O, P, Q, R, S, T, U, V) {
            G = G | 0;
            H = H | 0;
            I = I | 0;
            J = J | 0;
            K = K | 0;
            L = L | 0;
            M = M | 0;
            N = N | 0;
            O = O | 0;
            P = P | 0;
            Q = Q | 0;
            R = R | 0;
            S = S | 0;
            T = T | 0;
            U = U | 0;
            V = V | 0;
            x();
            u(G ^ 1549556828, H ^ 1549556828, I ^ 1549556828, J ^ 1549556828, K ^ 1549556828, L ^ 1549556828, M ^ 1549556828, N ^ 1549556828, O ^ 1549556828, P ^ 1549556828, Q ^ 1549556828, R ^ 1549556828, S ^ 1549556828, T ^ 1549556828, U ^ 1549556828, V ^ 1549556828);
            o = d;
            p = e;
            q = f;
            r = g;
            s = h;
            x();
            u(G ^ 909522486, H ^ 909522486, I ^ 909522486, J ^ 909522486, K ^ 909522486, L ^ 909522486, M ^ 909522486, N ^ 909522486, O ^ 909522486, P ^ 909522486, Q ^ 909522486, R ^ 909522486, S ^ 909522486, T ^ 909522486, U ^ 909522486, V ^ 909522486);
            j = d;
            k = e;
            l = f;
            m = g;
            n = h;
            i = 64
        }

        function E(G, H, I) {
            G = G | 0;
            H = H | 0;
            I = I | 0;
            var J = 0,
                K = 0,
                L = 0,
                M = 0,
                N = 0,
                O = 0;
            if (G & 63) return -1;
            if (~I)
                if (I & 31) return -1;
            O = A(G, H, -1) | 0;
            J = d,
            K = e,
            L = f,
            M = g,
            N = h;
            C();
            u(J, K, L, M, N, 2147483648, 0, 0, 0, 0, 0, 0, 0, 0, 0, 672);
            if (~I) w(I);
            return O | 0
        }

        function F(G, H, I, J, K) {
            G = G | 0;
            H = H | 0;
            I = I | 0;
            J = J | 0;
            K = K | 0;
            var L = 0,
                M = 0,
                N = 0,
                O = 0,
                P = 0,
                Q = 0,
                R = 0,
                S = 0,
                T = 0,
                U = 0;
            if (G & 63) return -1;
            if (~K)
                if (K & 31) return -1;
            t[G + H | 0] = I >>> 24;
            t[G + H + 1 | 0] = I >>> 16 & 255;
            t[G + H + 2 | 0] = I >>> 8 & 255;
            t[G + H + 3 | 0] = I & 255;
            E(G, H + 4 | 0, -1) | 0;
            L = Q = d,
            M = R = e,
            N = S = f,
            O = T = g,
            P = U = h;
            J = J - 1 | 0;
            while ((J | 0) > 0) {
                B();
                u(Q, R, S, T, U, 2147483648, 0, 0, 0, 0, 0, 0, 0, 0, 0, 672);
                Q = d,
                R = e,
                S = f,
                T = g,
                U = h;
                C();
                u(Q, R, S, T, U, 2147483648, 0, 0, 0, 0, 0, 0, 0, 0, 0, 672);
                Q = d,
                R = e,
                S = f,
                T = g,
                U = h;
                L = L ^ d;
                M = M ^ e;
                N = N ^ f;
                O = O ^ g;
                P = P ^ h;
                J = J - 1 | 0
            }
            d = L;
            e = M;
            f = N;
            g = O;
            h = P;
            if (~K) w(K);
            return 0
        }
        return {
            reset: x,
            init: y,
            process: z,
            finish: A,
            hmac_reset: B,
            hmac_init: D,
            hmac_finish: E,
            pbkdf2_generate_block: F
        }
    }

    function ib(a) {
        if (a = a || {}, a.heapSize = a.heapSize || 4096, a.heapSize <= 0 || a.heapSize % 4096) throw new d('heapSize must be a positive number and multiple of 4096');
        this.heap = a.heap || new Uint8Array(a.heapSize),
        this.asm = a.asm || hb(b, null, this.heap.buffer),
        this.BLOCK_SIZE = rd,
        this.HASH_SIZE = sd,
        this.reset()
    }

    function jb() {
        return this.result = null,
            this.pos = 0,
            this.len = 0,
            this.asm.reset(),
            this
    }

    function kb(a) {
        if (null !== this.result) throw new c('state must be reset before processing new data');
        var b = 0,
            d = 0,
            e = 0;
        if (o(a) || p(a)) b = a.byteOffset || 0,
            d = a.byteLength;
        else {
            if (!n(a)) throw new TypeError('data isn\'t of expected type');
            d = a.length
        }
        for (; d > 0;) {
            if (e = this.heap.byteLength - this.pos - this.len, e = d > e ? e : d, o(a) || p(a)) this.heap.set(new Uint8Array(a.buffer || a, b, e), this.pos + this.len);
            else
                for (var f = 0; e > f; f++) this.heap[this.pos + this.len + f] = a.charCodeAt(b + f);
            this.len += e,
            b += e,
            d -= e,
            e = this.asm.process(this.pos, this.len),
            e < this.len ? (this.pos += e, this.len -= e) : (this.pos = 0, this.len = 0)
        }
        return this
    }

    function lb() {
        if (null !== this.result) throw new c('state must be reset before processing new data');
        return this.asm.finish(this.pos, this.len, 0),
            this.result = new Uint8Array(sd),
            this.result.set(this.heap.subarray(0, sd)),
            this.pos = 0,
            this.len = 0,
            this
    }

    function mb() {
        return null === ud && (ud = new ib({
                heapSize: 1048576
            })),
            ud
    }

    function nb(a) {
        if (void 0 === a) throw new SyntaxError('data required');
        return mb().reset().process(a).finish().result
    }

    function ob(a) {
        var b = nb(a);
        return j(b)
    }

    function pb(a) {
        var b = nb(a);
        return k(b)
    }

    function qb(a, b, c) {
        'use asm';
        var d = 0,
            e = 0,
            f = 0,
            g = 0,
            h = 0,
            i = 0,
            j = 0,
            k = 0,
            l = 0;
        var m = 0,
            n = 0,
            o = 0,
            p = 0,
            q = 0,
            r = 0,
            s = 0,
            t = 0,
            u = 0,
            v = 0,
            w = 0,
            x = 0,
            y = 0,
            z = 0,
            A = 0,
            B = 0;
        var C = new a.Uint8Array(c);

        function D(P, Q, R, S, T, U, V, W, X, Y, Z, $, _, ab, bb, cb) {
            P = P | 0;
            Q = Q | 0;
            R = R | 0;
            S = S | 0;
            T = T | 0;
            U = U | 0;
            V = V | 0;
            W = W | 0;
            X = X | 0;
            Y = Y | 0;
            Z = Z | 0;
            $ = $ | 0;
            _ = _ | 0;
            ab = ab | 0;
            bb = bb | 0;
            cb = cb | 0;
            var db = 0,
                eb = 0,
                fb = 0,
                gb = 0,
                hb = 0,
                ib = 0,
                jb = 0,
                kb = 0,
                lb = 0;
            db = d;
            eb = e;
            fb = f;
            gb = g;
            hb = h;
            ib = i;
            jb = j;
            kb = k;
            lb = P + kb + (hb >>> 6 ^ hb >>> 11 ^ hb >>> 25 ^ hb << 26 ^ hb << 21 ^ hb << 7) + (jb ^ hb & (ib ^ jb)) + 1116352408 | 0;
            kb = jb;
            jb = ib;
            ib = hb;
            hb = gb + lb | 0;
            gb = fb;
            fb = eb;
            eb = db;
            db = lb + (eb & fb ^ gb & (eb ^ fb)) + (eb >>> 2 ^ eb >>> 13 ^ eb >>> 22 ^ eb << 30 ^ eb << 19 ^ eb << 10) | 0;
            lb = Q + kb + (hb >>> 6 ^ hb >>> 11 ^ hb >>> 25 ^ hb << 26 ^ hb << 21 ^ hb << 7) + (jb ^ hb & (ib ^ jb)) + 1899447441 | 0;
            kb = jb;
            jb = ib;
            ib = hb;
            hb = gb + lb | 0;
            gb = fb;
            fb = eb;
            eb = db;
            db = lb + (eb & fb ^ gb & (eb ^ fb)) + (eb >>> 2 ^ eb >>> 13 ^ eb >>> 22 ^ eb << 30 ^ eb << 19 ^ eb << 10) | 0;
            lb = R + kb + (hb >>> 6 ^ hb >>> 11 ^ hb >>> 25 ^ hb << 26 ^ hb << 21 ^ hb << 7) + (jb ^ hb & (ib ^ jb)) + 3049323471 | 0;
            kb = jb;
            jb = ib;
            ib = hb;
            hb = gb + lb | 0;
            gb = fb;
            fb = eb;
            eb = db;
            db = lb + (eb & fb ^ gb & (eb ^ fb)) + (eb >>> 2 ^ eb >>> 13 ^ eb >>> 22 ^ eb << 30 ^ eb << 19 ^ eb << 10) | 0;
            lb = S + kb + (hb >>> 6 ^ hb >>> 11 ^ hb >>> 25 ^ hb << 26 ^ hb << 21 ^ hb << 7) + (jb ^ hb & (ib ^ jb)) + 3921009573 | 0;
            kb = jb;
            jb = ib;
            ib = hb;
            hb = gb + lb | 0;
            gb = fb;
            fb = eb;
            eb = db;
            db = lb + (eb & fb ^ gb & (eb ^ fb)) + (eb >>> 2 ^ eb >>> 13 ^ eb >>> 22 ^ eb << 30 ^ eb << 19 ^ eb << 10) | 0;
            lb = T + kb + (hb >>> 6 ^ hb >>> 11 ^ hb >>> 25 ^ hb << 26 ^ hb << 21 ^ hb << 7) + (jb ^ hb & (ib ^ jb)) + 961987163 | 0;
            kb = jb;
            jb = ib;
            ib = hb;
            hb = gb + lb | 0;
            gb = fb;
            fb = eb;
            eb = db;
            db = lb + (eb & fb ^ gb & (eb ^ fb)) + (eb >>> 2 ^ eb >>> 13 ^ eb >>> 22 ^ eb << 30 ^ eb << 19 ^ eb << 10) | 0;
            lb = U + kb + (hb >>> 6 ^ hb >>> 11 ^ hb >>> 25 ^ hb << 26 ^ hb << 21 ^ hb << 7) + (jb ^ hb & (ib ^ jb)) + 1508970993 | 0;
            kb = jb;
            jb = ib;
            ib = hb;
            hb = gb + lb | 0;
            gb = fb;
            fb = eb;
            eb = db;
            db = lb + (eb & fb ^ gb & (eb ^ fb)) + (eb >>> 2 ^ eb >>> 13 ^ eb >>> 22 ^ eb << 30 ^ eb << 19 ^ eb << 10) | 0;
            lb = V + kb + (hb >>> 6 ^ hb >>> 11 ^ hb >>> 25 ^ hb << 26 ^ hb << 21 ^ hb << 7) + (jb ^ hb & (ib ^ jb)) + 2453635748 | 0;
            kb = jb;
            jb = ib;
            ib = hb;
            hb = gb + lb | 0;
            gb = fb;
            fb = eb;
            eb = db;
            db = lb + (eb & fb ^ gb & (eb ^ fb)) + (eb >>> 2 ^ eb >>> 13 ^ eb >>> 22 ^ eb << 30 ^ eb << 19 ^ eb << 10) | 0;
            lb = W + kb + (hb >>> 6 ^ hb >>> 11 ^ hb >>> 25 ^ hb << 26 ^ hb << 21 ^ hb << 7) + (jb ^ hb & (ib ^ jb)) + 2870763221 | 0;
            kb = jb;
            jb = ib;
            ib = hb;
            hb = gb + lb | 0;
            gb = fb;
            fb = eb;
            eb = db;
            db = lb + (eb & fb ^ gb & (eb ^ fb)) + (eb >>> 2 ^ eb >>> 13 ^ eb >>> 22 ^ eb << 30 ^ eb << 19 ^ eb << 10) | 0;
            lb = X + kb + (hb >>> 6 ^ hb >>> 11 ^ hb >>> 25 ^ hb << 26 ^ hb << 21 ^ hb << 7) + (jb ^ hb & (ib ^ jb)) + 3624381080 | 0;
            kb = jb;
            jb = ib;
            ib = hb;
            hb = gb + lb | 0;
            gb = fb;
            fb = eb;
            eb = db;
            db = lb + (eb & fb ^ gb & (eb ^ fb)) + (eb >>> 2 ^ eb >>> 13 ^ eb >>> 22 ^ eb << 30 ^ eb << 19 ^ eb << 10) | 0;
            lb = Y + kb + (hb >>> 6 ^ hb >>> 11 ^ hb >>> 25 ^ hb << 26 ^ hb << 21 ^ hb << 7) + (jb ^ hb & (ib ^ jb)) + 310598401 | 0;
            kb = jb;
            jb = ib;
            ib = hb;
            hb = gb + lb | 0;
            gb = fb;
            fb = eb;
            eb = db;
            db = lb + (eb & fb ^ gb & (eb ^ fb)) + (eb >>> 2 ^ eb >>> 13 ^ eb >>> 22 ^ eb << 30 ^ eb << 19 ^ eb << 10) | 0;
            lb = Z + kb + (hb >>> 6 ^ hb >>> 11 ^ hb >>> 25 ^ hb << 26 ^ hb << 21 ^ hb << 7) + (jb ^ hb & (ib ^ jb)) + 607225278 | 0;
            kb = jb;
            jb = ib;
            ib = hb;
            hb = gb + lb | 0;
            gb = fb;
            fb = eb;
            eb = db;
            db = lb + (eb & fb ^ gb & (eb ^ fb)) + (eb >>> 2 ^ eb >>> 13 ^ eb >>> 22 ^ eb << 30 ^ eb << 19 ^ eb << 10) | 0;
            lb = $ + kb + (hb >>> 6 ^ hb >>> 11 ^ hb >>> 25 ^ hb << 26 ^ hb << 21 ^ hb << 7) + (jb ^ hb & (ib ^ jb)) + 1426881987 | 0;
            kb = jb;
            jb = ib;
            ib = hb;
            hb = gb + lb | 0;
            gb = fb;
            fb = eb;
            eb = db;
            db = lb + (eb & fb ^ gb & (eb ^ fb)) + (eb >>> 2 ^ eb >>> 13 ^ eb >>> 22 ^ eb << 30 ^ eb << 19 ^ eb << 10) | 0;
            lb = _ + kb + (hb >>> 6 ^ hb >>> 11 ^ hb >>> 25 ^ hb << 26 ^ hb << 21 ^ hb << 7) + (jb ^ hb & (ib ^ jb)) + 1925078388 | 0;
            kb = jb;
            jb = ib;
            ib = hb;
            hb = gb + lb | 0;
            gb = fb;
            fb = eb;
            eb = db;
            db = lb + (eb & fb ^ gb & (eb ^ fb)) + (eb >>> 2 ^ eb >>> 13 ^ eb >>> 22 ^ eb << 30 ^ eb << 19 ^ eb << 10) | 0;
            lb = ab + kb + (hb >>> 6 ^ hb >>> 11 ^ hb >>> 25 ^ hb << 26 ^ hb << 21 ^ hb << 7) + (jb ^ hb & (ib ^ jb)) + 2162078206 | 0;
            kb = jb;
            jb = ib;
            ib = hb;
            hb = gb + lb | 0;
            gb = fb;
            fb = eb;
            eb = db;
            db = lb + (eb & fb ^ gb & (eb ^ fb)) + (eb >>> 2 ^ eb >>> 13 ^ eb >>> 22 ^ eb << 30 ^ eb << 19 ^ eb << 10) | 0;
            lb = bb + kb + (hb >>> 6 ^ hb >>> 11 ^ hb >>> 25 ^ hb << 26 ^ hb << 21 ^ hb << 7) + (jb ^ hb & (ib ^ jb)) + 2614888103 | 0;
            kb = jb;
            jb = ib;
            ib = hb;
            hb = gb + lb | 0;
            gb = fb;
            fb = eb;
            eb = db;
            db = lb + (eb & fb ^ gb & (eb ^ fb)) + (eb >>> 2 ^ eb >>> 13 ^ eb >>> 22 ^ eb << 30 ^ eb << 19 ^ eb << 10) | 0;
            lb = cb + kb + (hb >>> 6 ^ hb >>> 11 ^ hb >>> 25 ^ hb << 26 ^ hb << 21 ^ hb << 7) + (jb ^ hb & (ib ^ jb)) + 3248222580 | 0;
            kb = jb;
            jb = ib;
            ib = hb;
            hb = gb + lb | 0;
            gb = fb;
            fb = eb;
            eb = db;
            db = lb + (eb & fb ^ gb & (eb ^ fb)) + (eb >>> 2 ^ eb >>> 13 ^ eb >>> 22 ^ eb << 30 ^ eb << 19 ^ eb << 10) | 0;
            P = lb = (Q >>> 7 ^ Q >>> 18 ^ Q >>> 3 ^ Q << 25 ^ Q << 14) + (bb >>> 17 ^ bb >>> 19 ^ bb >>> 10 ^ bb << 15 ^ bb << 13) + P + Y | 0;
            lb = lb + kb + (hb >>> 6 ^ hb >>> 11 ^ hb >>> 25 ^ hb << 26 ^ hb << 21 ^ hb << 7) + (jb ^ hb & (ib ^ jb)) + 3835390401 | 0;
            kb = jb;
            jb = ib;
            ib = hb;
            hb = gb + lb | 0;
            gb = fb;
            fb = eb;
            eb = db;
            db = lb + (eb & fb ^ gb & (eb ^ fb)) + (eb >>> 2 ^ eb >>> 13 ^ eb >>> 22 ^ eb << 30 ^ eb << 19 ^ eb << 10) | 0;
            Q = lb = (R >>> 7 ^ R >>> 18 ^ R >>> 3 ^ R << 25 ^ R << 14) + (cb >>> 17 ^ cb >>> 19 ^ cb >>> 10 ^ cb << 15 ^ cb << 13) + Q + Z | 0;
            lb = lb + kb + (hb >>> 6 ^ hb >>> 11 ^ hb >>> 25 ^ hb << 26 ^ hb << 21 ^ hb << 7) + (jb ^ hb & (ib ^ jb)) + 4022224774 | 0;
            kb = jb;
            jb = ib;
            ib = hb;
            hb = gb + lb | 0;
            gb = fb;
            fb = eb;
            eb = db;
            db = lb + (eb & fb ^ gb & (eb ^ fb)) + (eb >>> 2 ^ eb >>> 13 ^ eb >>> 22 ^ eb << 30 ^ eb << 19 ^ eb << 10) | 0;
            R = lb = (S >>> 7 ^ S >>> 18 ^ S >>> 3 ^ S << 25 ^ S << 14) + (P >>> 17 ^ P >>> 19 ^ P >>> 10 ^ P << 15 ^ P << 13) + R + $ | 0;
            lb = lb + kb + (hb >>> 6 ^ hb >>> 11 ^ hb >>> 25 ^ hb << 26 ^ hb << 21 ^ hb << 7) + (jb ^ hb & (ib ^ jb)) + 264347078 | 0;
            kb = jb;
            jb = ib;
            ib = hb;
            hb = gb + lb | 0;
            gb = fb;
            fb = eb;
            eb = db;
            db = lb + (eb & fb ^ gb & (eb ^ fb)) + (eb >>> 2 ^ eb >>> 13 ^ eb >>> 22 ^ eb << 30 ^ eb << 19 ^ eb << 10) | 0;
            S = lb = (T >>> 7 ^ T >>> 18 ^ T >>> 3 ^ T << 25 ^ T << 14) + (Q >>> 17 ^ Q >>> 19 ^ Q >>> 10 ^ Q << 15 ^ Q << 13) + S + _ | 0;
            lb = lb + kb + (hb >>> 6 ^ hb >>> 11 ^ hb >>> 25 ^ hb << 26 ^ hb << 21 ^ hb << 7) + (jb ^ hb & (ib ^ jb)) + 604807628 | 0;
            kb = jb;
            jb = ib;
            ib = hb;
            hb = gb + lb | 0;
            gb = fb;
            fb = eb;
            eb = db;
            db = lb + (eb & fb ^ gb & (eb ^ fb)) + (eb >>> 2 ^ eb >>> 13 ^ eb >>> 22 ^ eb << 30 ^ eb << 19 ^ eb << 10) | 0;
            T = lb = (U >>> 7 ^ U >>> 18 ^ U >>> 3 ^ U << 25 ^ U << 14) + (R >>> 17 ^ R >>> 19 ^ R >>> 10 ^ R << 15 ^ R << 13) + T + ab | 0;
            lb = lb + kb + (hb >>> 6 ^ hb >>> 11 ^ hb >>> 25 ^ hb << 26 ^ hb << 21 ^ hb << 7) + (jb ^ hb & (ib ^ jb)) + 770255983 | 0;
            kb = jb;
            jb = ib;
            ib = hb;
            hb = gb + lb | 0;
            gb = fb;
            fb = eb;
            eb = db;
            db = lb + (eb & fb ^ gb & (eb ^ fb)) + (eb >>> 2 ^ eb >>> 13 ^ eb >>> 22 ^ eb << 30 ^ eb << 19 ^ eb << 10) | 0;
            U = lb = (V >>> 7 ^ V >>> 18 ^ V >>> 3 ^ V << 25 ^ V << 14) + (S >>> 17 ^ S >>> 19 ^ S >>> 10 ^ S << 15 ^ S << 13) + U + bb | 0;
            lb = lb + kb + (hb >>> 6 ^ hb >>> 11 ^ hb >>> 25 ^ hb << 26 ^ hb << 21 ^ hb << 7) + (jb ^ hb & (ib ^ jb)) + 1249150122 | 0;
            kb = jb;
            jb = ib;
            ib = hb;
            hb = gb + lb | 0;
            gb = fb;
            fb = eb;
            eb = db;
            db = lb + (eb & fb ^ gb & (eb ^ fb)) + (eb >>> 2 ^ eb >>> 13 ^ eb >>> 22 ^ eb << 30 ^ eb << 19 ^ eb << 10) | 0;
            V = lb = (W >>> 7 ^ W >>> 18 ^ W >>> 3 ^ W << 25 ^ W << 14) + (T >>> 17 ^ T >>> 19 ^ T >>> 10 ^ T << 15 ^ T << 13) + V + cb | 0;
            lb = lb + kb + (hb >>> 6 ^ hb >>> 11 ^ hb >>> 25 ^ hb << 26 ^ hb << 21 ^ hb << 7) + (jb ^ hb & (ib ^ jb)) + 1555081692 | 0;
            kb = jb;
            jb = ib;
            ib = hb;
            hb = gb + lb | 0;
            gb = fb;
            fb = eb;
            eb = db;
            db = lb + (eb & fb ^ gb & (eb ^ fb)) + (eb >>> 2 ^ eb >>> 13 ^ eb >>> 22 ^ eb << 30 ^ eb << 19 ^ eb << 10) | 0;
            W = lb = (X >>> 7 ^ X >>> 18 ^ X >>> 3 ^ X << 25 ^ X << 14) + (U >>> 17 ^ U >>> 19 ^ U >>> 10 ^ U << 15 ^ U << 13) + W + P | 0;
            lb = lb + kb + (hb >>> 6 ^ hb >>> 11 ^ hb >>> 25 ^ hb << 26 ^ hb << 21 ^ hb << 7) + (jb ^ hb & (ib ^ jb)) + 1996064986 | 0;
            kb = jb;
            jb = ib;
            ib = hb;
            hb = gb + lb | 0;
            gb = fb;
            fb = eb;
            eb = db;
            db = lb + (eb & fb ^ gb & (eb ^ fb)) + (eb >>> 2 ^ eb >>> 13 ^ eb >>> 22 ^ eb << 30 ^ eb << 19 ^ eb << 10) | 0;
            X = lb = (Y >>> 7 ^ Y >>> 18 ^ Y >>> 3 ^ Y << 25 ^ Y << 14) + (V >>> 17 ^ V >>> 19 ^ V >>> 10 ^ V << 15 ^ V << 13) + X + Q | 0;
            lb = lb + kb + (hb >>> 6 ^ hb >>> 11 ^ hb >>> 25 ^ hb << 26 ^ hb << 21 ^ hb << 7) + (jb ^ hb & (ib ^ jb)) + 2554220882 | 0;
            kb = jb;
            jb = ib;
            ib = hb;
            hb = gb + lb | 0;
            gb = fb;
            fb = eb;
            eb = db;
            db = lb + (eb & fb ^ gb & (eb ^ fb)) + (eb >>> 2 ^ eb >>> 13 ^ eb >>> 22 ^ eb << 30 ^ eb << 19 ^ eb << 10) | 0;
            Y = lb = (Z >>> 7 ^ Z >>> 18 ^ Z >>> 3 ^ Z << 25 ^ Z << 14) + (W >>> 17 ^ W >>> 19 ^ W >>> 10 ^ W << 15 ^ W << 13) + Y + R | 0;
            lb = lb + kb + (hb >>> 6 ^ hb >>> 11 ^ hb >>> 25 ^ hb << 26 ^ hb << 21 ^ hb << 7) + (jb ^ hb & (ib ^ jb)) + 2821834349 | 0;
            kb = jb;
            jb = ib;
            ib = hb;
            hb = gb + lb | 0;
            gb = fb;
            fb = eb;
            eb = db;
            db = lb + (eb & fb ^ gb & (eb ^ fb)) + (eb >>> 2 ^ eb >>> 13 ^ eb >>> 22 ^ eb << 30 ^ eb << 19 ^ eb << 10) | 0;
            Z = lb = ($ >>> 7 ^ $ >>> 18 ^ $ >>> 3 ^ $ << 25 ^ $ << 14) + (X >>> 17 ^ X >>> 19 ^ X >>> 10 ^ X << 15 ^ X << 13) + Z + S | 0;
            lb = lb + kb + (hb >>> 6 ^ hb >>> 11 ^ hb >>> 25 ^ hb << 26 ^ hb << 21 ^ hb << 7) + (jb ^ hb & (ib ^ jb)) + 2952996808 | 0;
            kb = jb;
            jb = ib;
            ib = hb;
            hb = gb + lb | 0;
            gb = fb;
            fb = eb;
            eb = db;
            db = lb + (eb & fb ^ gb & (eb ^ fb)) + (eb >>> 2 ^ eb >>> 13 ^ eb >>> 22 ^ eb << 30 ^ eb << 19 ^ eb << 10) | 0;
            $ = lb = (_ >>> 7 ^ _ >>> 18 ^ _ >>> 3 ^ _ << 25 ^ _ << 14) + (Y >>> 17 ^ Y >>> 19 ^ Y >>> 10 ^ Y << 15 ^ Y << 13) + $ + T | 0;
            lb = lb + kb + (hb >>> 6 ^ hb >>> 11 ^ hb >>> 25 ^ hb << 26 ^ hb << 21 ^ hb << 7) + (jb ^ hb & (ib ^ jb)) + 3210313671 | 0;
            kb = jb;
            jb = ib;
            ib = hb;
            hb = gb + lb | 0;
            gb = fb;
            fb = eb;
            eb = db;
            db = lb + (eb & fb ^ gb & (eb ^ fb)) + (eb >>> 2 ^ eb >>> 13 ^ eb >>> 22 ^ eb << 30 ^ eb << 19 ^ eb << 10) | 0;
            _ = lb = (ab >>> 7 ^ ab >>> 18 ^ ab >>> 3 ^ ab << 25 ^ ab << 14) + (Z >>> 17 ^ Z >>> 19 ^ Z >>> 10 ^ Z << 15 ^ Z << 13) + _ + U | 0;
            lb = lb + kb + (hb >>> 6 ^ hb >>> 11 ^ hb >>> 25 ^ hb << 26 ^ hb << 21 ^ hb << 7) + (jb ^ hb & (ib ^ jb)) + 3336571891 | 0;
            kb = jb;
            jb = ib;
            ib = hb;
            hb = gb + lb | 0;
            gb = fb;
            fb = eb;
            eb = db;
            db = lb + (eb & fb ^ gb & (eb ^ fb)) + (eb >>> 2 ^ eb >>> 13 ^ eb >>> 22 ^ eb << 30 ^ eb << 19 ^ eb << 10) | 0;
            ab = lb = (bb >>> 7 ^ bb >>> 18 ^ bb >>> 3 ^ bb << 25 ^ bb << 14) + ($ >>> 17 ^ $ >>> 19 ^ $ >>> 10 ^ $ << 15 ^ $ << 13) + ab + V | 0;
            lb = lb + kb + (hb >>> 6 ^ hb >>> 11 ^ hb >>> 25 ^ hb << 26 ^ hb << 21 ^ hb << 7) + (jb ^ hb & (ib ^ jb)) + 3584528711 | 0;
            kb = jb;
            jb = ib;
            ib = hb;
            hb = gb + lb | 0;
            gb = fb;
            fb = eb;
            eb = db;
            db = lb + (eb & fb ^ gb & (eb ^ fb)) + (eb >>> 2 ^ eb >>> 13 ^ eb >>> 22 ^ eb << 30 ^ eb << 19 ^ eb << 10) | 0;
            bb = lb = (cb >>> 7 ^ cb >>> 18 ^ cb >>> 3 ^ cb << 25 ^ cb << 14) + (_ >>> 17 ^ _ >>> 19 ^ _ >>> 10 ^ _ << 15 ^ _ << 13) + bb + W | 0;
            lb = lb + kb + (hb >>> 6 ^ hb >>> 11 ^ hb >>> 25 ^ hb << 26 ^ hb << 21 ^ hb << 7) + (jb ^ hb & (ib ^ jb)) + 113926993 | 0;
            kb = jb;
            jb = ib;
            ib = hb;
            hb = gb + lb | 0;
            gb = fb;
            fb = eb;
            eb = db;
            db = lb + (eb & fb ^ gb & (eb ^ fb)) + (eb >>> 2 ^ eb >>> 13 ^ eb >>> 22 ^ eb << 30 ^ eb << 19 ^ eb << 10) | 0;
            cb = lb = (P >>> 7 ^ P >>> 18 ^ P >>> 3 ^ P << 25 ^ P << 14) + (ab >>> 17 ^ ab >>> 19 ^ ab >>> 10 ^ ab << 15 ^ ab << 13) + cb + X | 0;
            lb = lb + kb + (hb >>> 6 ^ hb >>> 11 ^ hb >>> 25 ^ hb << 26 ^ hb << 21 ^ hb << 7) + (jb ^ hb & (ib ^ jb)) + 338241895 | 0;
            kb = jb;
            jb = ib;
            ib = hb;
            hb = gb + lb | 0;
            gb = fb;
            fb = eb;
            eb = db;
            db = lb + (eb & fb ^ gb & (eb ^ fb)) + (eb >>> 2 ^ eb >>> 13 ^ eb >>> 22 ^ eb << 30 ^ eb << 19 ^ eb << 10) | 0;
            P = lb = (Q >>> 7 ^ Q >>> 18 ^ Q >>> 3 ^ Q << 25 ^ Q << 14) + (bb >>> 17 ^ bb >>> 19 ^ bb >>> 10 ^ bb << 15 ^ bb << 13) + P + Y | 0;
            lb = lb + kb + (hb >>> 6 ^ hb >>> 11 ^ hb >>> 25 ^ hb << 26 ^ hb << 21 ^ hb << 7) + (jb ^ hb & (ib ^ jb)) + 666307205 | 0;
            kb = jb;
            jb = ib;
            ib = hb;
            hb = gb + lb | 0;
            gb = fb;
            fb = eb;
            eb = db;
            db = lb + (eb & fb ^ gb & (eb ^ fb)) + (eb >>> 2 ^ eb >>> 13 ^ eb >>> 22 ^ eb << 30 ^ eb << 19 ^ eb << 10) | 0;
            Q = lb = (R >>> 7 ^ R >>> 18 ^ R >>> 3 ^ R << 25 ^ R << 14) + (cb >>> 17 ^ cb >>> 19 ^ cb >>> 10 ^ cb << 15 ^ cb << 13) + Q + Z | 0;
            lb = lb + kb + (hb >>> 6 ^ hb >>> 11 ^ hb >>> 25 ^ hb << 26 ^ hb << 21 ^ hb << 7) + (jb ^ hb & (ib ^ jb)) + 773529912 | 0;
            kb = jb;
            jb = ib;
            ib = hb;
            hb = gb + lb | 0;
            gb = fb;
            fb = eb;
            eb = db;
            db = lb + (eb & fb ^ gb & (eb ^ fb)) + (eb >>> 2 ^ eb >>> 13 ^ eb >>> 22 ^ eb << 30 ^ eb << 19 ^ eb << 10) | 0;
            R = lb = (S >>> 7 ^ S >>> 18 ^ S >>> 3 ^ S << 25 ^ S << 14) + (P >>> 17 ^ P >>> 19 ^ P >>> 10 ^ P << 15 ^ P << 13) + R + $ | 0;
            lb = lb + kb + (hb >>> 6 ^ hb >>> 11 ^ hb >>> 25 ^ hb << 26 ^ hb << 21 ^ hb << 7) + (jb ^ hb & (ib ^ jb)) + 1294757372 | 0;
            kb = jb;
            jb = ib;
            ib = hb;
            hb = gb + lb | 0;
            gb = fb;
            fb = eb;
            eb = db;
            db = lb + (eb & fb ^ gb & (eb ^ fb)) + (eb >>> 2 ^ eb >>> 13 ^ eb >>> 22 ^ eb << 30 ^ eb << 19 ^ eb << 10) | 0;
            S = lb = (T >>> 7 ^ T >>> 18 ^ T >>> 3 ^ T << 25 ^ T << 14) + (Q >>> 17 ^ Q >>> 19 ^ Q >>> 10 ^ Q << 15 ^ Q << 13) + S + _ | 0;
            lb = lb + kb + (hb >>> 6 ^ hb >>> 11 ^ hb >>> 25 ^ hb << 26 ^ hb << 21 ^ hb << 7) + (jb ^ hb & (ib ^ jb)) + 1396182291 | 0;
            kb = jb;
            jb = ib;
            ib = hb;
            hb = gb + lb | 0;
            gb = fb;
            fb = eb;
            eb = db;
            db = lb + (eb & fb ^ gb & (eb ^ fb)) + (eb >>> 2 ^ eb >>> 13 ^ eb >>> 22 ^ eb << 30 ^ eb << 19 ^ eb << 10) | 0;
            T = lb = (U >>> 7 ^ U >>> 18 ^ U >>> 3 ^ U << 25 ^ U << 14) + (R >>> 17 ^ R >>> 19 ^ R >>> 10 ^ R << 15 ^ R << 13) + T + ab | 0;
            lb = lb + kb + (hb >>> 6 ^ hb >>> 11 ^ hb >>> 25 ^ hb << 26 ^ hb << 21 ^ hb << 7) + (jb ^ hb & (ib ^ jb)) + 1695183700 | 0;
            kb = jb;
            jb = ib;
            ib = hb;
            hb = gb + lb | 0;
            gb = fb;
            fb = eb;
            eb = db;
            db = lb + (eb & fb ^ gb & (eb ^ fb)) + (eb >>> 2 ^ eb >>> 13 ^ eb >>> 22 ^ eb << 30 ^ eb << 19 ^ eb << 10) | 0;
            U = lb = (V >>> 7 ^ V >>> 18 ^ V >>> 3 ^ V << 25 ^ V << 14) + (S >>> 17 ^ S >>> 19 ^ S >>> 10 ^ S << 15 ^ S << 13) + U + bb | 0;
            lb = lb + kb + (hb >>> 6 ^ hb >>> 11 ^ hb >>> 25 ^ hb << 26 ^ hb << 21 ^ hb << 7) + (jb ^ hb & (ib ^ jb)) + 1986661051 | 0;
            kb = jb;
            jb = ib;
            ib = hb;
            hb = gb + lb | 0;
            gb = fb;
            fb = eb;
            eb = db;
            db = lb + (eb & fb ^ gb & (eb ^ fb)) + (eb >>> 2 ^ eb >>> 13 ^ eb >>> 22 ^ eb << 30 ^ eb << 19 ^ eb << 10) | 0;
            V = lb = (W >>> 7 ^ W >>> 18 ^ W >>> 3 ^ W << 25 ^ W << 14) + (T >>> 17 ^ T >>> 19 ^ T >>> 10 ^ T << 15 ^ T << 13) + V + cb | 0;
            lb = lb + kb + (hb >>> 6 ^ hb >>> 11 ^ hb >>> 25 ^ hb << 26 ^ hb << 21 ^ hb << 7) + (jb ^ hb & (ib ^ jb)) + 2177026350 | 0;
            kb = jb;
            jb = ib;
            ib = hb;
            hb = gb + lb | 0;
            gb = fb;
            fb = eb;
            eb = db;
            db = lb + (eb & fb ^ gb & (eb ^ fb)) + (eb >>> 2 ^ eb >>> 13 ^ eb >>> 22 ^ eb << 30 ^ eb << 19 ^ eb << 10) | 0;
            W = lb = (X >>> 7 ^ X >>> 18 ^ X >>> 3 ^ X << 25 ^ X << 14) + (U >>> 17 ^ U >>> 19 ^ U >>> 10 ^ U << 15 ^ U << 13) + W + P | 0;
            lb = lb + kb + (hb >>> 6 ^ hb >>> 11 ^ hb >>> 25 ^ hb << 26 ^ hb << 21 ^ hb << 7) + (jb ^ hb & (ib ^ jb)) + 2456956037 | 0;
            kb = jb;
            jb = ib;
            ib = hb;
            hb = gb + lb | 0;
            gb = fb;
            fb = eb;
            eb = db;
            db = lb + (eb & fb ^ gb & (eb ^ fb)) + (eb >>> 2 ^ eb >>> 13 ^ eb >>> 22 ^ eb << 30 ^ eb << 19 ^ eb << 10) | 0;
            X = lb = (Y >>> 7 ^ Y >>> 18 ^ Y >>> 3 ^ Y << 25 ^ Y << 14) + (V >>> 17 ^ V >>> 19 ^ V >>> 10 ^ V << 15 ^ V << 13) + X + Q | 0;
            lb = lb + kb + (hb >>> 6 ^ hb >>> 11 ^ hb >>> 25 ^ hb << 26 ^ hb << 21 ^ hb << 7) + (jb ^ hb & (ib ^ jb)) + 2730485921 | 0;
            kb = jb;
            jb = ib;
            ib = hb;
            hb = gb + lb | 0;
            gb = fb;
            fb = eb;
            eb = db;
            db = lb + (eb & fb ^ gb & (eb ^ fb)) + (eb >>> 2 ^ eb >>> 13 ^ eb >>> 22 ^ eb << 30 ^ eb << 19 ^ eb << 10) | 0;
            Y = lb = (Z >>> 7 ^ Z >>> 18 ^ Z >>> 3 ^ Z << 25 ^ Z << 14) + (W >>> 17 ^ W >>> 19 ^ W >>> 10 ^ W << 15 ^ W << 13) + Y + R | 0;
            lb = lb + kb + (hb >>> 6 ^ hb >>> 11 ^ hb >>> 25 ^ hb << 26 ^ hb << 21 ^ hb << 7) + (jb ^ hb & (ib ^ jb)) + 2820302411 | 0;
            kb = jb;
            jb = ib;
            ib = hb;
            hb = gb + lb | 0;
            gb = fb;
            fb = eb;
            eb = db;
            db = lb + (eb & fb ^ gb & (eb ^ fb)) + (eb >>> 2 ^ eb >>> 13 ^ eb >>> 22 ^ eb << 30 ^ eb << 19 ^ eb << 10) | 0;
            Z = lb = ($ >>> 7 ^ $ >>> 18 ^ $ >>> 3 ^ $ << 25 ^ $ << 14) + (X >>> 17 ^ X >>> 19 ^ X >>> 10 ^ X << 15 ^ X << 13) + Z + S | 0;
            lb = lb + kb + (hb >>> 6 ^ hb >>> 11 ^ hb >>> 25 ^ hb << 26 ^ hb << 21 ^ hb << 7) + (jb ^ hb & (ib ^ jb)) + 3259730800 | 0;
            kb = jb;
            jb = ib;
            ib = hb;
            hb = gb + lb | 0;
            gb = fb;
            fb = eb;
            eb = db;
            db = lb + (eb & fb ^ gb & (eb ^ fb)) + (eb >>> 2 ^ eb >>> 13 ^ eb >>> 22 ^ eb << 30 ^ eb << 19 ^ eb << 10) | 0;
            $ = lb = (_ >>> 7 ^ _ >>> 18 ^ _ >>> 3 ^ _ << 25 ^ _ << 14) + (Y >>> 17 ^ Y >>> 19 ^ Y >>> 10 ^ Y << 15 ^ Y << 13) + $ + T | 0;
            lb = lb + kb + (hb >>> 6 ^ hb >>> 11 ^ hb >>> 25 ^ hb << 26 ^ hb << 21 ^ hb << 7) + (jb ^ hb & (ib ^ jb)) + 3345764771 | 0;
            kb = jb;
            jb = ib;
            ib = hb;
            hb = gb + lb | 0;
            gb = fb;
            fb = eb;
            eb = db;
            db = lb + (eb & fb ^ gb & (eb ^ fb)) + (eb >>> 2 ^ eb >>> 13 ^ eb >>> 22 ^ eb << 30 ^ eb << 19 ^ eb << 10) | 0;
            _ = lb = (ab >>> 7 ^ ab >>> 18 ^ ab >>> 3 ^ ab << 25 ^ ab << 14) + (Z >>> 17 ^ Z >>> 19 ^ Z >>> 10 ^ Z << 15 ^ Z << 13) + _ + U | 0;
            lb = lb + kb + (hb >>> 6 ^ hb >>> 11 ^ hb >>> 25 ^ hb << 26 ^ hb << 21 ^ hb << 7) + (jb ^ hb & (ib ^ jb)) + 3516065817 | 0;
            kb = jb;
            jb = ib;
            ib = hb;
            hb = gb + lb | 0;
            gb = fb;
            fb = eb;
            eb = db;
            db = lb + (eb & fb ^ gb & (eb ^ fb)) + (eb >>> 2 ^ eb >>> 13 ^ eb >>> 22 ^ eb << 30 ^ eb << 19 ^ eb << 10) | 0;
            ab = lb = (bb >>> 7 ^ bb >>> 18 ^ bb >>> 3 ^ bb << 25 ^ bb << 14) + ($ >>> 17 ^ $ >>> 19 ^ $ >>> 10 ^ $ << 15 ^ $ << 13) + ab + V | 0;
            lb = lb + kb + (hb >>> 6 ^ hb >>> 11 ^ hb >>> 25 ^ hb << 26 ^ hb << 21 ^ hb << 7) + (jb ^ hb & (ib ^ jb)) + 3600352804 | 0;
            kb = jb;
            jb = ib;
            ib = hb;
            hb = gb + lb | 0;
            gb = fb;
            fb = eb;
            eb = db;
            db = lb + (eb & fb ^ gb & (eb ^ fb)) + (eb >>> 2 ^ eb >>> 13 ^ eb >>> 22 ^ eb << 30 ^ eb << 19 ^ eb << 10) | 0;
            bb = lb = (cb >>> 7 ^ cb >>> 18 ^ cb >>> 3 ^ cb << 25 ^ cb << 14) + (_ >>> 17 ^ _ >>> 19 ^ _ >>> 10 ^ _ << 15 ^ _ << 13) + bb + W | 0;
            lb = lb + kb + (hb >>> 6 ^ hb >>> 11 ^ hb >>> 25 ^ hb << 26 ^ hb << 21 ^ hb << 7) + (jb ^ hb & (ib ^ jb)) + 4094571909 | 0;
            kb = jb;
            jb = ib;
            ib = hb;
            hb = gb + lb | 0;
            gb = fb;
            fb = eb;
            eb = db;
            db = lb + (eb & fb ^ gb & (eb ^ fb)) + (eb >>> 2 ^ eb >>> 13 ^ eb >>> 22 ^ eb << 30 ^ eb << 19 ^ eb << 10) | 0;
            cb = lb = (P >>> 7 ^ P >>> 18 ^ P >>> 3 ^ P << 25 ^ P << 14) + (ab >>> 17 ^ ab >>> 19 ^ ab >>> 10 ^ ab << 15 ^ ab << 13) + cb + X | 0;
            lb = lb + kb + (hb >>> 6 ^ hb >>> 11 ^ hb >>> 25 ^ hb << 26 ^ hb << 21 ^ hb << 7) + (jb ^ hb & (ib ^ jb)) + 275423344 | 0;
            kb = jb;
            jb = ib;
            ib = hb;
            hb = gb + lb | 0;
            gb = fb;
            fb = eb;
            eb = db;
            db = lb + (eb & fb ^ gb & (eb ^ fb)) + (eb >>> 2 ^ eb >>> 13 ^ eb >>> 22 ^ eb << 30 ^ eb << 19 ^ eb << 10) | 0;
            P = lb = (Q >>> 7 ^ Q >>> 18 ^ Q >>> 3 ^ Q << 25 ^ Q << 14) + (bb >>> 17 ^ bb >>> 19 ^ bb >>> 10 ^ bb << 15 ^ bb << 13) + P + Y | 0;
            lb = lb + kb + (hb >>> 6 ^ hb >>> 11 ^ hb >>> 25 ^ hb << 26 ^ hb << 21 ^ hb << 7) + (jb ^ hb & (ib ^ jb)) + 430227734 | 0;
            kb = jb;
            jb = ib;
            ib = hb;
            hb = gb + lb | 0;
            gb = fb;
            fb = eb;
            eb = db;
            db = lb + (eb & fb ^ gb & (eb ^ fb)) + (eb >>> 2 ^ eb >>> 13 ^ eb >>> 22 ^ eb << 30 ^ eb << 19 ^ eb << 10) | 0;
            Q = lb = (R >>> 7 ^ R >>> 18 ^ R >>> 3 ^ R << 25 ^ R << 14) + (cb >>> 17 ^ cb >>> 19 ^ cb >>> 10 ^ cb << 15 ^ cb << 13) + Q + Z | 0;
            lb = lb + kb + (hb >>> 6 ^ hb >>> 11 ^ hb >>> 25 ^ hb << 26 ^ hb << 21 ^ hb << 7) + (jb ^ hb & (ib ^ jb)) + 506948616 | 0;
            kb = jb;
            jb = ib;
            ib = hb;
            hb = gb + lb | 0;
            gb = fb;
            fb = eb;
            eb = db;
            db = lb + (eb & fb ^ gb & (eb ^ fb)) + (eb >>> 2 ^ eb >>> 13 ^ eb >>> 22 ^ eb << 30 ^ eb << 19 ^ eb << 10) | 0;
            R = lb = (S >>> 7 ^ S >>> 18 ^ S >>> 3 ^ S << 25 ^ S << 14) + (P >>> 17 ^ P >>> 19 ^ P >>> 10 ^ P << 15 ^ P << 13) + R + $ | 0;
            lb = lb + kb + (hb >>> 6 ^ hb >>> 11 ^ hb >>> 25 ^ hb << 26 ^ hb << 21 ^ hb << 7) + (jb ^ hb & (ib ^ jb)) + 659060556 | 0;
            kb = jb;
            jb = ib;
            ib = hb;
            hb = gb + lb | 0;
            gb = fb;
            fb = eb;
            eb = db;
            db = lb + (eb & fb ^ gb & (eb ^ fb)) + (eb >>> 2 ^ eb >>> 13 ^ eb >>> 22 ^ eb << 30 ^ eb << 19 ^ eb << 10) | 0;
            S = lb = (T >>> 7 ^ T >>> 18 ^ T >>> 3 ^ T << 25 ^ T << 14) + (Q >>> 17 ^ Q >>> 19 ^ Q >>> 10 ^ Q << 15 ^ Q << 13) + S + _ | 0;
            lb = lb + kb + (hb >>> 6 ^ hb >>> 11 ^ hb >>> 25 ^ hb << 26 ^ hb << 21 ^ hb << 7) + (jb ^ hb & (ib ^ jb)) + 883997877 | 0;
            kb = jb;
            jb = ib;
            ib = hb;
            hb = gb + lb | 0;
            gb = fb;
            fb = eb;
            eb = db;
            db = lb + (eb & fb ^ gb & (eb ^ fb)) + (eb >>> 2 ^ eb >>> 13 ^ eb >>> 22 ^ eb << 30 ^ eb << 19 ^ eb << 10) | 0;
            T = lb = (U >>> 7 ^ U >>> 18 ^ U >>> 3 ^ U << 25 ^ U << 14) + (R >>> 17 ^ R >>> 19 ^ R >>> 10 ^ R << 15 ^ R << 13) + T + ab | 0;
            lb = lb + kb + (hb >>> 6 ^ hb >>> 11 ^ hb >>> 25 ^ hb << 26 ^ hb << 21 ^ hb << 7) + (jb ^ hb & (ib ^ jb)) + 958139571 | 0;
            kb = jb;
            jb = ib;
            ib = hb;
            hb = gb + lb | 0;
            gb = fb;
            fb = eb;
            eb = db;
            db = lb + (eb & fb ^ gb & (eb ^ fb)) + (eb >>> 2 ^ eb >>> 13 ^ eb >>> 22 ^ eb << 30 ^ eb << 19 ^ eb << 10) | 0;
            U = lb = (V >>> 7 ^ V >>> 18 ^ V >>> 3 ^ V << 25 ^ V << 14) + (S >>> 17 ^ S >>> 19 ^ S >>> 10 ^ S << 15 ^ S << 13) + U + bb | 0;
            lb = lb + kb + (hb >>> 6 ^ hb >>> 11 ^ hb >>> 25 ^ hb << 26 ^ hb << 21 ^ hb << 7) + (jb ^ hb & (ib ^ jb)) + 1322822218 | 0;
            kb = jb;
            jb = ib;
            ib = hb;
            hb = gb + lb | 0;
            gb = fb;
            fb = eb;
            eb = db;
            db = lb + (eb & fb ^ gb & (eb ^ fb)) + (eb >>> 2 ^ eb >>> 13 ^ eb >>> 22 ^ eb << 30 ^ eb << 19 ^ eb << 10) | 0;
            V = lb = (W >>> 7 ^ W >>> 18 ^ W >>> 3 ^ W << 25 ^ W << 14) + (T >>> 17 ^ T >>> 19 ^ T >>> 10 ^ T << 15 ^ T << 13) + V + cb | 0;
            lb = lb + kb + (hb >>> 6 ^ hb >>> 11 ^ hb >>> 25 ^ hb << 26 ^ hb << 21 ^ hb << 7) + (jb ^ hb & (ib ^ jb)) + 1537002063 | 0;
            kb = jb;
            jb = ib;
            ib = hb;
            hb = gb + lb | 0;
            gb = fb;
            fb = eb;
            eb = db;
            db = lb + (eb & fb ^ gb & (eb ^ fb)) + (eb >>> 2 ^ eb >>> 13 ^ eb >>> 22 ^ eb << 30 ^ eb << 19 ^ eb << 10) | 0;
            W = lb = (X >>> 7 ^ X >>> 18 ^ X >>> 3 ^ X << 25 ^ X << 14) + (U >>> 17 ^ U >>> 19 ^ U >>> 10 ^ U << 15 ^ U << 13) + W + P | 0;
            lb = lb + kb + (hb >>> 6 ^ hb >>> 11 ^ hb >>> 25 ^ hb << 26 ^ hb << 21 ^ hb << 7) + (jb ^ hb & (ib ^ jb)) + 1747873779 | 0;
            kb = jb;
            jb = ib;
            ib = hb;
            hb = gb + lb | 0;
            gb = fb;
            fb = eb;
            eb = db;
            db = lb + (eb & fb ^ gb & (eb ^ fb)) + (eb >>> 2 ^ eb >>> 13 ^ eb >>> 22 ^ eb << 30 ^ eb << 19 ^ eb << 10) | 0;
            X = lb = (Y >>> 7 ^ Y >>> 18 ^ Y >>> 3 ^ Y << 25 ^ Y << 14) + (V >>> 17 ^ V >>> 19 ^ V >>> 10 ^ V << 15 ^ V << 13) + X + Q | 0;
            lb = lb + kb + (hb >>> 6 ^ hb >>> 11 ^ hb >>> 25 ^ hb << 26 ^ hb << 21 ^ hb << 7) + (jb ^ hb & (ib ^ jb)) + 1955562222 | 0;
            kb = jb;
            jb = ib;
            ib = hb;
            hb = gb + lb | 0;
            gb = fb;
            fb = eb;
            eb = db;
            db = lb + (eb & fb ^ gb & (eb ^ fb)) + (eb >>> 2 ^ eb >>> 13 ^ eb >>> 22 ^ eb << 30 ^ eb << 19 ^ eb << 10) | 0;
            Y = lb = (Z >>> 7 ^ Z >>> 18 ^ Z >>> 3 ^ Z << 25 ^ Z << 14) + (W >>> 17 ^ W >>> 19 ^ W >>> 10 ^ W << 15 ^ W << 13) + Y + R | 0;
            lb = lb + kb + (hb >>> 6 ^ hb >>> 11 ^ hb >>> 25 ^ hb << 26 ^ hb << 21 ^ hb << 7) + (jb ^ hb & (ib ^ jb)) + 2024104815 | 0;
            kb = jb;
            jb = ib;
            ib = hb;
            hb = gb + lb | 0;
            gb = fb;
            fb = eb;
            eb = db;
            db = lb + (eb & fb ^ gb & (eb ^ fb)) + (eb >>> 2 ^ eb >>> 13 ^ eb >>> 22 ^ eb << 30 ^ eb << 19 ^ eb << 10) | 0;
            Z = lb = ($ >>> 7 ^ $ >>> 18 ^ $ >>> 3 ^ $ << 25 ^ $ << 14) + (X >>> 17 ^ X >>> 19 ^ X >>> 10 ^ X << 15 ^ X << 13) + Z + S | 0;
            lb = lb + kb + (hb >>> 6 ^ hb >>> 11 ^ hb >>> 25 ^ hb << 26 ^ hb << 21 ^ hb << 7) + (jb ^ hb & (ib ^ jb)) + 2227730452 | 0;
            kb = jb;
            jb = ib;
            ib = hb;
            hb = gb + lb | 0;
            gb = fb;
            fb = eb;
            eb = db;
            db = lb + (eb & fb ^ gb & (eb ^ fb)) + (eb >>> 2 ^ eb >>> 13 ^ eb >>> 22 ^ eb << 30 ^ eb << 19 ^ eb << 10) | 0;
            $ = lb = (_ >>> 7 ^ _ >>> 18 ^ _ >>> 3 ^ _ << 25 ^ _ << 14) + (Y >>> 17 ^ Y >>> 19 ^ Y >>> 10 ^ Y << 15 ^ Y << 13) + $ + T | 0;
            lb = lb + kb + (hb >>> 6 ^ hb >>> 11 ^ hb >>> 25 ^ hb << 26 ^ hb << 21 ^ hb << 7) + (jb ^ hb & (ib ^ jb)) + 2361852424 | 0;
            kb = jb;
            jb = ib;
            ib = hb;
            hb = gb + lb | 0;
            gb = fb;
            fb = eb;
            eb = db;
            db = lb + (eb & fb ^ gb & (eb ^ fb)) + (eb >>> 2 ^ eb >>> 13 ^ eb >>> 22 ^ eb << 30 ^ eb << 19 ^ eb << 10) | 0;
            _ = lb = (ab >>> 7 ^ ab >>> 18 ^ ab >>> 3 ^ ab << 25 ^ ab << 14) + (Z >>> 17 ^ Z >>> 19 ^ Z >>> 10 ^ Z << 15 ^ Z << 13) + _ + U | 0;
            lb = lb + kb + (hb >>> 6 ^ hb >>> 11 ^ hb >>> 25 ^ hb << 26 ^ hb << 21 ^ hb << 7) + (jb ^ hb & (ib ^ jb)) + 2428436474 | 0;
            kb = jb;
            jb = ib;
            ib = hb;
            hb = gb + lb | 0;
            gb = fb;
            fb = eb;
            eb = db;
            db = lb + (eb & fb ^ gb & (eb ^ fb)) + (eb >>> 2 ^ eb >>> 13 ^ eb >>> 22 ^ eb << 30 ^ eb << 19 ^ eb << 10) | 0;
            ab = lb = (bb >>> 7 ^ bb >>> 18 ^ bb >>> 3 ^ bb << 25 ^ bb << 14) + ($ >>> 17 ^ $ >>> 19 ^ $ >>> 10 ^ $ << 15 ^ $ << 13) + ab + V | 0;
            lb = lb + kb + (hb >>> 6 ^ hb >>> 11 ^ hb >>> 25 ^ hb << 26 ^ hb << 21 ^ hb << 7) + (jb ^ hb & (ib ^ jb)) + 2756734187 | 0;
            kb = jb;
            jb = ib;
            ib = hb;
            hb = gb + lb | 0;
            gb = fb;
            fb = eb;
            eb = db;
            db = lb + (eb & fb ^ gb & (eb ^ fb)) + (eb >>> 2 ^ eb >>> 13 ^ eb >>> 22 ^ eb << 30 ^ eb << 19 ^ eb << 10) | 0;
            bb = lb = (cb >>> 7 ^ cb >>> 18 ^ cb >>> 3 ^ cb << 25 ^ cb << 14) + (_ >>> 17 ^ _ >>> 19 ^ _ >>> 10 ^ _ << 15 ^ _ << 13) + bb + W | 0;
            lb = lb + kb + (hb >>> 6 ^ hb >>> 11 ^ hb >>> 25 ^ hb << 26 ^ hb << 21 ^ hb << 7) + (jb ^ hb & (ib ^ jb)) + 3204031479 | 0;
            kb = jb;
            jb = ib;
            ib = hb;
            hb = gb + lb | 0;
            gb = fb;
            fb = eb;
            eb = db;
            db = lb + (eb & fb ^ gb & (eb ^ fb)) + (eb >>> 2 ^ eb >>> 13 ^ eb >>> 22 ^ eb << 30 ^ eb << 19 ^ eb << 10) | 0;
            cb = lb = (P >>> 7 ^ P >>> 18 ^ P >>> 3 ^ P << 25 ^ P << 14) + (ab >>> 17 ^ ab >>> 19 ^ ab >>> 10 ^ ab << 15 ^ ab << 13) + cb + X | 0;
            lb = lb + kb + (hb >>> 6 ^ hb >>> 11 ^ hb >>> 25 ^ hb << 26 ^ hb << 21 ^ hb << 7) + (jb ^ hb & (ib ^ jb)) + 3329325298 | 0;
            kb = jb;
            jb = ib;
            ib = hb;
            hb = gb + lb | 0;
            gb = fb;
            fb = eb;
            eb = db;
            db = lb + (eb & fb ^ gb & (eb ^ fb)) + (eb >>> 2 ^ eb >>> 13 ^ eb >>> 22 ^ eb << 30 ^ eb << 19 ^ eb << 10) | 0;
            d = d + db | 0;
            e = e + eb | 0;
            f = f + fb | 0;
            g = g + gb | 0;
            h = h + hb | 0;
            i = i + ib | 0;
            j = j + jb | 0;
            k = k + kb | 0
        }

        function E(P) {
            P = P | 0;
            D(C[P | 0] << 24 | C[P | 1] << 16 | C[P | 2] << 8 | C[P | 3], C[P | 4] << 24 | C[P | 5] << 16 | C[P | 6] << 8 | C[P | 7], C[P | 8] << 24 | C[P | 9] << 16 | C[P | 10] << 8 | C[P | 11], C[P | 12] << 24 | C[P | 13] << 16 | C[P | 14] << 8 | C[P | 15], C[P | 16] << 24 | C[P | 17] << 16 | C[P | 18] << 8 | C[P | 19], C[P | 20] << 24 | C[P | 21] << 16 | C[P | 22] << 8 | C[P | 23], C[P | 24] << 24 | C[P | 25] << 16 | C[P | 26] << 8 | C[P | 27], C[P | 28] << 24 | C[P | 29] << 16 | C[P | 30] << 8 | C[P | 31], C[P | 32] << 24 | C[P | 33] << 16 | C[P | 34] << 8 | C[P | 35], C[P | 36] << 24 | C[P | 37] << 16 | C[P | 38] << 8 | C[P | 39], C[P | 40] << 24 | C[P | 41] << 16 | C[P | 42] << 8 | C[P | 43], C[P | 44] << 24 | C[P | 45] << 16 | C[P | 46] << 8 | C[P | 47], C[P | 48] << 24 | C[P | 49] << 16 | C[P | 50] << 8 | C[P | 51], C[P | 52] << 24 | C[P | 53] << 16 | C[P | 54] << 8 | C[P | 55], C[P | 56] << 24 | C[P | 57] << 16 | C[P | 58] << 8 | C[P | 59], C[P | 60] << 24 | C[P | 61] << 16 | C[P | 62] << 8 | C[P | 63])
        }

        function F(P) {
            P = P | 0;
            C[P | 0] = d >>> 24;
            C[P | 1] = d >>> 16 & 255;
            C[P | 2] = d >>> 8 & 255;
            C[P | 3] = d & 255;
            C[P | 4] = e >>> 24;
            C[P | 5] = e >>> 16 & 255;
            C[P | 6] = e >>> 8 & 255;
            C[P | 7] = e & 255;
            C[P | 8] = f >>> 24;
            C[P | 9] = f >>> 16 & 255;
            C[P | 10] = f >>> 8 & 255;
            C[P | 11] = f & 255;
            C[P | 12] = g >>> 24;
            C[P | 13] = g >>> 16 & 255;
            C[P | 14] = g >>> 8 & 255;
            C[P | 15] = g & 255;
            C[P | 16] = h >>> 24;
            C[P | 17] = h >>> 16 & 255;
            C[P | 18] = h >>> 8 & 255;
            C[P | 19] = h & 255;
            C[P | 20] = i >>> 24;
            C[P | 21] = i >>> 16 & 255;
            C[P | 22] = i >>> 8 & 255;
            C[P | 23] = i & 255;
            C[P | 24] = j >>> 24;
            C[P | 25] = j >>> 16 & 255;
            C[P | 26] = j >>> 8 & 255;
            C[P | 27] = j & 255;
            C[P | 28] = k >>> 24;
            C[P | 29] = k >>> 16 & 255;
            C[P | 30] = k >>> 8 & 255;
            C[P | 31] = k & 255
        }

        function G() {
            d = 1779033703;
            e = 3144134277;
            f = 1013904242;
            g = 2773480762;
            h = 1359893119;
            i = 2600822924;
            j = 528734635;
            k = 1541459225;
            l = 0
        }

        function H(P, Q, R, S, T, U, V, W, X) {
            P = P | 0;
            Q = Q | 0;
            R = R | 0;
            S = S | 0;
            T = T | 0;
            U = U | 0;
            V = V | 0;
            W = W | 0;
            X = X | 0;
            d = P;
            e = Q;
            f = R;
            g = S;
            h = T;
            i = U;
            j = V;
            k = W;
            l = X
        }

        function I(P, Q) {
            P = P | 0;
            Q = Q | 0;
            var R = 0;
            if (P & 63) return -1;
            while ((Q | 0) >= 64) {
                E(P);
                P = P + 64 | 0;
                Q = Q - 64 | 0;
                R = R + 64 | 0
            }
            l = l + R | 0;
            return R | 0
        }

        function J(P, Q, R) {
            P = P | 0;
            Q = Q | 0;
            R = R | 0;
            var S = 0,
                T = 0;
            if (P & 63) return -1;
            if (~R)
                if (R & 31) return -1;
            if ((Q | 0) >= 64) {
                S = I(P, Q) | 0;
                if ((S | 0) == -1) return -1;
                P = P + S | 0;
                Q = Q - S | 0
            }
            S = S + Q | 0;
            l = l + Q | 0;
            C[P | Q] = 128;
            if ((Q | 0) >= 56) {
                for (T = Q + 1 | 0;
                    (T | 0) < 64; T = T + 1 | 0) C[P | T] = 0;
                E(P);
                Q = 0;
                C[P | 0] = 0
            }
            for (T = Q + 1 | 0;
                (T | 0) < 59; T = T + 1 | 0) C[P | T] = 0;
            C[P | 59] = l >>> 29;
            C[P | 60] = l >>> 21 & 255;
            C[P | 61] = l >>> 13 & 255;
            C[P | 62] = l >>> 5 & 255;
            C[P | 63] = l << 3 & 255;
            E(P);
            if (~R) F(R);
            return S | 0
        }

        function K() {
            d = m;
            e = n;
            f = o;
            g = p;
            h = q;
            i = r;
            j = s;
            k = t;
            l = 64
        }

        function L() {
            d = u;
            e = v;
            f = w;
            g = x;
            h = y;
            i = z;
            j = A;
            k = B;
            l = 64
        }

        function M(P, Q, R, S, T, U, V, W, X, Y, Z, $, _, ab, bb, cb) {
            P = P | 0;
            Q = Q | 0;
            R = R | 0;
            S = S | 0;
            T = T | 0;
            U = U | 0;
            V = V | 0;
            W = W | 0;
            X = X | 0;
            Y = Y | 0;
            Z = Z | 0;
            $ = $ | 0;
            _ = _ | 0;
            ab = ab | 0;
            bb = bb | 0;
            cb = cb | 0;
            G();
            D(P ^ 1549556828, Q ^ 1549556828, R ^ 1549556828, S ^ 1549556828, T ^ 1549556828, U ^ 1549556828, V ^ 1549556828, W ^ 1549556828, X ^ 1549556828, Y ^ 1549556828, Z ^ 1549556828, $ ^ 1549556828, _ ^ 1549556828, ab ^ 1549556828, bb ^ 1549556828, cb ^ 1549556828);
            u = d;
            v = e;
            w = f;
            x = g;
            y = h;
            z = i;
            A = j;
            B = k;
            G();
            D(P ^ 909522486, Q ^ 909522486, R ^ 909522486, S ^ 909522486, T ^ 909522486, U ^ 909522486, V ^ 909522486, W ^ 909522486, X ^ 909522486, Y ^ 909522486, Z ^ 909522486, $ ^ 909522486, _ ^ 909522486, ab ^ 909522486, bb ^ 909522486, cb ^ 909522486);
            m = d;
            n = e;
            o = f;
            p = g;
            q = h;
            r = i;
            s = j;
            t = k;
            l = 64
        }

        function N(P, Q, R) {
            P = P | 0;
            Q = Q | 0;
            R = R | 0;
            var S = 0,
                T = 0,
                U = 0,
                V = 0,
                W = 0,
                X = 0,
                Y = 0,
                Z = 0,
                $ = 0;
            if (P & 63) return -1;
            if (~R)
                if (R & 31) return -1;
            $ = J(P, Q, -1) | 0;
            S = d,
            T = e,
            U = f,
            V = g,
            W = h,
            X = i,
            Y = j,
            Z = k;
            L();
            D(S, T, U, V, W, X, Y, Z, 2147483648, 0, 0, 0, 0, 0, 0, 768);
            if (~R) F(R);
            return $ | 0
        }

        function O(P, Q, R, S, T) {
            P = P | 0;
            Q = Q | 0;
            R = R | 0;
            S = S | 0;
            T = T | 0;
            var U = 0,
                V = 0,
                W = 0,
                X = 0,
                Y = 0,
                Z = 0,
                $ = 0,
                _ = 0,
                ab = 0,
                bb = 0,
                cb = 0,
                db = 0,
                eb = 0,
                fb = 0,
                gb = 0,
                hb = 0;
            if (P & 63) return -1;
            if (~T)
                if (T & 31) return -1;
            C[P + Q | 0] = R >>> 24;
            C[P + Q + 1 | 0] = R >>> 16 & 255;
            C[P + Q + 2 | 0] = R >>> 8 & 255;
            C[P + Q + 3 | 0] = R & 255;
            N(P, Q + 4 | 0, -1) | 0;
            U = ab = d,
            V = bb = e,
            W = cb = f,
            X = db = g,
            Y = eb = h,
            Z = fb = i,
            $ = gb = j,
            _ = hb = k;
            S = S - 1 | 0;
            while ((S | 0) > 0) {
                K();
                D(ab, bb, cb, db, eb, fb, gb, hb, 2147483648, 0, 0, 0, 0, 0, 0, 768);
                ab = d,
                bb = e,
                cb = f,
                db = g,
                eb = h,
                fb = i,
                gb = j,
                hb = k;
                L();
                D(ab, bb, cb, db, eb, fb, gb, hb, 2147483648, 0, 0, 0, 0, 0, 0, 768);
                ab = d,
                bb = e,
                cb = f,
                db = g,
                eb = h,
                fb = i,
                gb = j,
                hb = k;
                U = U ^ d;
                V = V ^ e;
                W = W ^ f;
                X = X ^ g;
                Y = Y ^ h;
                Z = Z ^ i;
                $ = $ ^ j;
                _ = _ ^ k;
                S = S - 1 | 0
            }
            d = U;
            e = V;
            f = W;
            g = X;
            h = Y;
            i = Z;
            j = $;
            k = _;
            if (~T) F(T);
            return 0
        }
        return {
            reset: G,
            init: H,
            process: I,
            finish: J,
            hmac_reset: K,
            hmac_init: M,
            hmac_finish: N,
            pbkdf2_generate_block: O
        }
    }

    function rb(a) {
        if (a = a || {}, a.heapSize = a.heapSize || 4096, a.heapSize <= 0 || a.heapSize % 4096) throw new d('heapSize must be a positive number and multiple of 4096');
        this.heap = a.heap || new Uint8Array(a.heapSize),
        this.asm = a.asm || qb(b, null, this.heap.buffer),
        this.BLOCK_SIZE = vd,
        this.HASH_SIZE = wd,
        this.reset()
    }

    function sb() {
        return this.result = null,
            this.pos = 0,
            this.len = 0,
            this.asm.reset(),
            this
    }

    function tb(a) {
        if (null !== this.result) throw new c('state must be reset before processing new data');
        var b = 0,
            d = 0,
            e = 0;
        if (o(a) || p(a)) b = a.byteOffset || 0,
            d = a.byteLength;
        else {
            if (!n(a)) throw new TypeError('data isn\'t of expected type');
            d = a.length
        }
        for (; d > 0;) {
            if (e = this.heap.byteLength - this.pos - this.len, e = d > e ? e : d, o(a) || p(a)) this.heap.set(new Uint8Array(a.buffer || a, b, e), this.pos + this.len);
            else
                for (var f = 0; e > f; f++) this.heap[this.pos + this.len + f] = a.charCodeAt(b + f);
            this.len += e,
            b += e,
            d -= e,
            e = this.asm.process(this.pos, this.len),
            e < this.len ? (this.pos += e, this.len -= e) : (this.pos = 0, this.len = 0)
        }
        return this
    }

    function ub() {
        if (null !== this.result) throw new c('state must be reset before processing new data');
        return this.asm.finish(this.pos, this.len, 0),
            this.result = new Uint8Array(wd),
            this.result.set(this.heap.subarray(0, wd)),
            this.pos = 0,
            this.len = 0,
            this
    }

    function vb() {
        return null === yd && (yd = new rb({
                heapSize: 1048576
            })),
            yd
    }

    function wb(a) {
        if (void 0 === a) throw new SyntaxError('data required');
        return vb().reset().process(a).finish().result
    }

    function xb(a) {
        var b = wb(a);
        return j(b)
    }

    function yb(a) {
        var b = wb(a);
        return k(b)
    }

    function zb(a, b, c) {
        'use asm';
        var d = 0,
            e = 0,
            f = 0,
            g = 0,
            h = 0,
            i = 0,
            j = 0,
            k = 0,
            l = 0,
            m = 0,
            n = 0,
            o = 0,
            p = 0,
            q = 0,
            r = 0,
            s = 0,
            t = 0;
        var u = 0,
            v = 0,
            w = 0,
            x = 0,
            y = 0,
            z = 0,
            A = 0,
            B = 0,
            C = 0,
            D = 0,
            E = 0,
            F = 0,
            G = 0,
            H = 0,
            I = 0,
            J = 0,
            K = 0,
            L = 0,
            M = 0,
            N = 0,
            O = 0,
            P = 0,
            Q = 0,
            R = 0,
            S = 0,
            T = 0,
            U = 0,
            V = 0,
            W = 0,
            X = 0,
            Y = 0,
            Z = 0;
        var $ = new a.Uint8Array(c);

        function _(lb, mb, nb, ob, pb, qb, rb, sb, tb, ub, vb, wb, xb, yb, zb, Ab, Bb, Cb, Db, Eb, Fb, Gb, Hb, Ib, Jb, Kb, Lb, Mb, Nb, Ob, Pb, Qb) {
            lb = lb | 0;
            mb = mb | 0;
            nb = nb | 0;
            ob = ob | 0;
            pb = pb | 0;
            qb = qb | 0;
            rb = rb | 0;
            sb = sb | 0;
            tb = tb | 0;
            ub = ub | 0;
            vb = vb | 0;
            wb = wb | 0;
            xb = xb | 0;
            yb = yb | 0;
            zb = zb | 0;
            Ab = Ab | 0;
            Bb = Bb | 0;
            Cb = Cb | 0;
            Db = Db | 0;
            Eb = Eb | 0;
            Fb = Fb | 0;
            Gb = Gb | 0;
            Hb = Hb | 0;
            Ib = Ib | 0;
            Jb = Jb | 0;
            Kb = Kb | 0;
            Lb = Lb | 0;
            Mb = Mb | 0;
            Nb = Nb | 0;
            Ob = Ob | 0;
            Pb = Pb | 0;
            Qb = Qb | 0;
            var Rb = 0,
                Sb = 0,
                Tb = 0,
                Ub = 0,
                Vb = 0,
                Wb = 0,
                Xb = 0,
                Yb = 0,
                Zb = 0,
                $b = 0,
                _b = 0,
                ac = 0,
                bc = 0,
                cc = 0,
                dc = 0,
                ec = 0,
                fc = 0,
                gc = 0,
                hc = 0;
            Rb = d;
            Sb = e;
            Tb = f;
            Ub = g;
            Vb = h;
            Wb = i;
            Xb = j;
            Yb = k;
            Zb = l;
            $b = m;
            _b = n;
            ac = o;
            bc = p;
            cc = q;
            dc = r;
            ec = s;
            gc = 3609767458 + mb | 0;
            fc = 1116352408 + lb + (gc >>> 0 < mb >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 602891725 + ob | 0;
            fc = 1899447441 + nb + (gc >>> 0 < ob >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 3964484399 + qb | 0;
            fc = 3049323471 + pb + (gc >>> 0 < qb >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 2173295548 + sb | 0;
            fc = 3921009573 + rb + (gc >>> 0 < sb >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 4081628472 + ub | 0;
            fc = 961987163 + tb + (gc >>> 0 < ub >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 3053834265 + wb | 0;
            fc = 1508970993 + vb + (gc >>> 0 < wb >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 2937671579 + yb | 0;
            fc = 2453635748 + xb + (gc >>> 0 < yb >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 3664609560 + Ab | 0;
            fc = 2870763221 + zb + (gc >>> 0 < Ab >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 2734883394 + Cb | 0;
            fc = 3624381080 + Bb + (gc >>> 0 < Cb >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 1164996542 + Eb | 0;
            fc = 310598401 + Db + (gc >>> 0 < Eb >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 1323610764 + Gb | 0;
            fc = 607225278 + Fb + (gc >>> 0 < Gb >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 3590304994 + Ib | 0;
            fc = 1426881987 + Hb + (gc >>> 0 < Ib >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 4068182383 + Kb | 0;
            fc = 1925078388 + Jb + (gc >>> 0 < Kb >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 991336113 + Mb | 0;
            fc = 2162078206 + Lb + (gc >>> 0 < Mb >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 633803317 + Ob | 0;
            fc = 2614888103 + Nb + (gc >>> 0 < Ob >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 3479774868 + Qb | 0;
            fc = 3248222580 + Pb + (gc >>> 0 < Qb >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            mb = mb + Eb | 0;
            lb = lb + Db + (mb >>> 0 < Eb >>> 0 ? 1 : 0) | 0;
            hc = (ob >>> 1 | nb << 31) ^ (ob >>> 8 | nb << 24) ^ (ob >>> 7 | nb << 25) | 0;
            mb = mb + hc | 0;
            lb = lb + ((nb >>> 1 | ob << 31) ^ (nb >>> 8 | ob << 24) ^ nb >>> 7) + (mb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = (Ob >>> 19 | Nb << 13) ^ (Ob << 3 | Nb >>> 29) ^ (Ob >>> 6 | Nb << 26) | 0;
            mb = mb + hc | 0;
            lb = lb + ((Nb >>> 19 | Ob << 13) ^ (Nb << 3 | Ob >>> 29) ^ Nb >>> 6) + (mb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 2666613458 + mb | 0;
            fc = 3835390401 + lb + (gc >>> 0 < mb >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ob = ob + Gb | 0;
            nb = nb + Fb + (ob >>> 0 < Gb >>> 0 ? 1 : 0) | 0;
            hc = (qb >>> 1 | pb << 31) ^ (qb >>> 8 | pb << 24) ^ (qb >>> 7 | pb << 25) | 0;
            ob = ob + hc | 0;
            nb = nb + ((pb >>> 1 | qb << 31) ^ (pb >>> 8 | qb << 24) ^ pb >>> 7) + (ob >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = (Qb >>> 19 | Pb << 13) ^ (Qb << 3 | Pb >>> 29) ^ (Qb >>> 6 | Pb << 26) | 0;
            ob = ob + hc | 0;
            nb = nb + ((Pb >>> 19 | Qb << 13) ^ (Pb << 3 | Qb >>> 29) ^ Pb >>> 6) + (ob >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 944711139 + ob | 0;
            fc = 4022224774 + nb + (gc >>> 0 < ob >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            qb = qb + Ib | 0;
            pb = pb + Hb + (qb >>> 0 < Ib >>> 0 ? 1 : 0) | 0;
            hc = (sb >>> 1 | rb << 31) ^ (sb >>> 8 | rb << 24) ^ (sb >>> 7 | rb << 25) | 0;
            qb = qb + hc | 0;
            pb = pb + ((rb >>> 1 | sb << 31) ^ (rb >>> 8 | sb << 24) ^ rb >>> 7) + (qb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = (mb >>> 19 | lb << 13) ^ (mb << 3 | lb >>> 29) ^ (mb >>> 6 | lb << 26) | 0;
            qb = qb + hc | 0;
            pb = pb + ((lb >>> 19 | mb << 13) ^ (lb << 3 | mb >>> 29) ^ lb >>> 6) + (qb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 2341262773 + qb | 0;
            fc = 264347078 + pb + (gc >>> 0 < qb >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            sb = sb + Kb | 0;
            rb = rb + Jb + (sb >>> 0 < Kb >>> 0 ? 1 : 0) | 0;
            hc = (ub >>> 1 | tb << 31) ^ (ub >>> 8 | tb << 24) ^ (ub >>> 7 | tb << 25) | 0;
            sb = sb + hc | 0;
            rb = rb + ((tb >>> 1 | ub << 31) ^ (tb >>> 8 | ub << 24) ^ tb >>> 7) + (sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = (ob >>> 19 | nb << 13) ^ (ob << 3 | nb >>> 29) ^ (ob >>> 6 | nb << 26) | 0;
            sb = sb + hc | 0;
            rb = rb + ((nb >>> 19 | ob << 13) ^ (nb << 3 | ob >>> 29) ^ nb >>> 6) + (sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 2007800933 + sb | 0;
            fc = 604807628 + rb + (gc >>> 0 < sb >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ub = ub + Mb | 0;
            tb = tb + Lb + (ub >>> 0 < Mb >>> 0 ? 1 : 0) | 0;
            hc = (wb >>> 1 | vb << 31) ^ (wb >>> 8 | vb << 24) ^ (wb >>> 7 | vb << 25) | 0;
            ub = ub + hc | 0;
            tb = tb + ((vb >>> 1 | wb << 31) ^ (vb >>> 8 | wb << 24) ^ vb >>> 7) + (ub >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = (qb >>> 19 | pb << 13) ^ (qb << 3 | pb >>> 29) ^ (qb >>> 6 | pb << 26) | 0;
            ub = ub + hc | 0;
            tb = tb + ((pb >>> 19 | qb << 13) ^ (pb << 3 | qb >>> 29) ^ pb >>> 6) + (ub >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 1495990901 + ub | 0;
            fc = 770255983 + tb + (gc >>> 0 < ub >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            wb = wb + Ob | 0;
            vb = vb + Nb + (wb >>> 0 < Ob >>> 0 ? 1 : 0) | 0;
            hc = (yb >>> 1 | xb << 31) ^ (yb >>> 8 | xb << 24) ^ (yb >>> 7 | xb << 25) | 0;
            wb = wb + hc | 0;
            vb = vb + ((xb >>> 1 | yb << 31) ^ (xb >>> 8 | yb << 24) ^ xb >>> 7) + (wb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = (sb >>> 19 | rb << 13) ^ (sb << 3 | rb >>> 29) ^ (sb >>> 6 | rb << 26) | 0;
            wb = wb + hc | 0;
            vb = vb + ((rb >>> 19 | sb << 13) ^ (rb << 3 | sb >>> 29) ^ rb >>> 6) + (wb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 1856431235 + wb | 0;
            fc = 1249150122 + vb + (gc >>> 0 < wb >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            yb = yb + Qb | 0;
            xb = xb + Pb + (yb >>> 0 < Qb >>> 0 ? 1 : 0) | 0;
            hc = (Ab >>> 1 | zb << 31) ^ (Ab >>> 8 | zb << 24) ^ (Ab >>> 7 | zb << 25) | 0;
            yb = yb + hc | 0;
            xb = xb + ((zb >>> 1 | Ab << 31) ^ (zb >>> 8 | Ab << 24) ^ zb >>> 7) + (yb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = (ub >>> 19 | tb << 13) ^ (ub << 3 | tb >>> 29) ^ (ub >>> 6 | tb << 26) | 0;
            yb = yb + hc | 0;
            xb = xb + ((tb >>> 19 | ub << 13) ^ (tb << 3 | ub >>> 29) ^ tb >>> 6) + (yb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 3175218132 + yb | 0;
            fc = 1555081692 + xb + (gc >>> 0 < yb >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            Ab = Ab + mb | 0;
            zb = zb + lb + (Ab >>> 0 < mb >>> 0 ? 1 : 0) | 0;
            hc = (Cb >>> 1 | Bb << 31) ^ (Cb >>> 8 | Bb << 24) ^ (Cb >>> 7 | Bb << 25) | 0;
            Ab = Ab + hc | 0;
            zb = zb + ((Bb >>> 1 | Cb << 31) ^ (Bb >>> 8 | Cb << 24) ^ Bb >>> 7) + (Ab >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = (wb >>> 19 | vb << 13) ^ (wb << 3 | vb >>> 29) ^ (wb >>> 6 | vb << 26) | 0;
            Ab = Ab + hc | 0;
            zb = zb + ((vb >>> 19 | wb << 13) ^ (vb << 3 | wb >>> 29) ^ vb >>> 6) + (Ab >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 2198950837 + Ab | 0;
            fc = 1996064986 + zb + (gc >>> 0 < Ab >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            Cb = Cb + ob | 0;
            Bb = Bb + nb + (Cb >>> 0 < ob >>> 0 ? 1 : 0) | 0;
            hc = (Eb >>> 1 | Db << 31) ^ (Eb >>> 8 | Db << 24) ^ (Eb >>> 7 | Db << 25) | 0;
            Cb = Cb + hc | 0;
            Bb = Bb + ((Db >>> 1 | Eb << 31) ^ (Db >>> 8 | Eb << 24) ^ Db >>> 7) + (Cb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = (yb >>> 19 | xb << 13) ^ (yb << 3 | xb >>> 29) ^ (yb >>> 6 | xb << 26) | 0;
            Cb = Cb + hc | 0;
            Bb = Bb + ((xb >>> 19 | yb << 13) ^ (xb << 3 | yb >>> 29) ^ xb >>> 6) + (Cb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 3999719339 + Cb | 0;
            fc = 2554220882 + Bb + (gc >>> 0 < Cb >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            Eb = Eb + qb | 0;
            Db = Db + pb + (Eb >>> 0 < qb >>> 0 ? 1 : 0) | 0;
            hc = (Gb >>> 1 | Fb << 31) ^ (Gb >>> 8 | Fb << 24) ^ (Gb >>> 7 | Fb << 25) | 0;
            Eb = Eb + hc | 0;
            Db = Db + ((Fb >>> 1 | Gb << 31) ^ (Fb >>> 8 | Gb << 24) ^ Fb >>> 7) + (Eb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = (Ab >>> 19 | zb << 13) ^ (Ab << 3 | zb >>> 29) ^ (Ab >>> 6 | zb << 26) | 0;
            Eb = Eb + hc | 0;
            Db = Db + ((zb >>> 19 | Ab << 13) ^ (zb << 3 | Ab >>> 29) ^ zb >>> 6) + (Eb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 766784016 + Eb | 0;
            fc = 2821834349 + Db + (gc >>> 0 < Eb >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            Gb = Gb + sb | 0;
            Fb = Fb + rb + (Gb >>> 0 < sb >>> 0 ? 1 : 0) | 0;
            hc = (Ib >>> 1 | Hb << 31) ^ (Ib >>> 8 | Hb << 24) ^ (Ib >>> 7 | Hb << 25) | 0;
            Gb = Gb + hc | 0;
            Fb = Fb + ((Hb >>> 1 | Ib << 31) ^ (Hb >>> 8 | Ib << 24) ^ Hb >>> 7) + (Gb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = (Cb >>> 19 | Bb << 13) ^ (Cb << 3 | Bb >>> 29) ^ (Cb >>> 6 | Bb << 26) | 0;
            Gb = Gb + hc | 0;
            Fb = Fb + ((Bb >>> 19 | Cb << 13) ^ (Bb << 3 | Cb >>> 29) ^ Bb >>> 6) + (Gb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 2566594879 + Gb | 0;
            fc = 2952996808 + Fb + (gc >>> 0 < Gb >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            Ib = Ib + ub | 0;
            Hb = Hb + tb + (Ib >>> 0 < ub >>> 0 ? 1 : 0) | 0;
            hc = (Kb >>> 1 | Jb << 31) ^ (Kb >>> 8 | Jb << 24) ^ (Kb >>> 7 | Jb << 25) | 0;
            Ib = Ib + hc | 0;
            Hb = Hb + ((Jb >>> 1 | Kb << 31) ^ (Jb >>> 8 | Kb << 24) ^ Jb >>> 7) + (Ib >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = (Eb >>> 19 | Db << 13) ^ (Eb << 3 | Db >>> 29) ^ (Eb >>> 6 | Db << 26) | 0;
            Ib = Ib + hc | 0;
            Hb = Hb + ((Db >>> 19 | Eb << 13) ^ (Db << 3 | Eb >>> 29) ^ Db >>> 6) + (Ib >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 3203337956 + Ib | 0;
            fc = 3210313671 + Hb + (gc >>> 0 < Ib >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            Kb = Kb + wb | 0;
            Jb = Jb + vb + (Kb >>> 0 < wb >>> 0 ? 1 : 0) | 0;
            hc = (Mb >>> 1 | Lb << 31) ^ (Mb >>> 8 | Lb << 24) ^ (Mb >>> 7 | Lb << 25) | 0;
            Kb = Kb + hc | 0;
            Jb = Jb + ((Lb >>> 1 | Mb << 31) ^ (Lb >>> 8 | Mb << 24) ^ Lb >>> 7) + (Kb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = (Gb >>> 19 | Fb << 13) ^ (Gb << 3 | Fb >>> 29) ^ (Gb >>> 6 | Fb << 26) | 0;
            Kb = Kb + hc | 0;
            Jb = Jb + ((Fb >>> 19 | Gb << 13) ^ (Fb << 3 | Gb >>> 29) ^ Fb >>> 6) + (Kb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 1034457026 + Kb | 0;
            fc = 3336571891 + Jb + (gc >>> 0 < Kb >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            Mb = Mb + yb | 0;
            Lb = Lb + xb + (Mb >>> 0 < yb >>> 0 ? 1 : 0) | 0;
            hc = (Ob >>> 1 | Nb << 31) ^ (Ob >>> 8 | Nb << 24) ^ (Ob >>> 7 | Nb << 25) | 0;
            Mb = Mb + hc | 0;
            Lb = Lb + ((Nb >>> 1 | Ob << 31) ^ (Nb >>> 8 | Ob << 24) ^ Nb >>> 7) + (Mb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = (Ib >>> 19 | Hb << 13) ^ (Ib << 3 | Hb >>> 29) ^ (Ib >>> 6 | Hb << 26) | 0;
            Mb = Mb + hc | 0;
            Lb = Lb + ((Hb >>> 19 | Ib << 13) ^ (Hb << 3 | Ib >>> 29) ^ Hb >>> 6) + (Mb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 2466948901 + Mb | 0;
            fc = 3584528711 + Lb + (gc >>> 0 < Mb >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            Ob = Ob + Ab | 0;
            Nb = Nb + zb + (Ob >>> 0 < Ab >>> 0 ? 1 : 0) | 0;
            hc = (Qb >>> 1 | Pb << 31) ^ (Qb >>> 8 | Pb << 24) ^ (Qb >>> 7 | Pb << 25) | 0;
            Ob = Ob + hc | 0;
            Nb = Nb + ((Pb >>> 1 | Qb << 31) ^ (Pb >>> 8 | Qb << 24) ^ Pb >>> 7) + (Ob >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = (Kb >>> 19 | Jb << 13) ^ (Kb << 3 | Jb >>> 29) ^ (Kb >>> 6 | Jb << 26) | 0;
            Ob = Ob + hc | 0;
            Nb = Nb + ((Jb >>> 19 | Kb << 13) ^ (Jb << 3 | Kb >>> 29) ^ Jb >>> 6) + (Ob >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 3758326383 + Ob | 0;
            fc = 113926993 + Nb + (gc >>> 0 < Ob >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            Qb = Qb + Cb | 0;
            Pb = Pb + Bb + (Qb >>> 0 < Cb >>> 0 ? 1 : 0) | 0;
            hc = (mb >>> 1 | lb << 31) ^ (mb >>> 8 | lb << 24) ^ (mb >>> 7 | lb << 25) | 0;
            Qb = Qb + hc | 0;
            Pb = Pb + ((lb >>> 1 | mb << 31) ^ (lb >>> 8 | mb << 24) ^ lb >>> 7) + (Qb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = (Mb >>> 19 | Lb << 13) ^ (Mb << 3 | Lb >>> 29) ^ (Mb >>> 6 | Lb << 26) | 0;
            Qb = Qb + hc | 0;
            Pb = Pb + ((Lb >>> 19 | Mb << 13) ^ (Lb << 3 | Mb >>> 29) ^ Lb >>> 6) + (Qb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 168717936 + Qb | 0;
            fc = 338241895 + Pb + (gc >>> 0 < Qb >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            mb = mb + Eb | 0;
            lb = lb + Db + (mb >>> 0 < Eb >>> 0 ? 1 : 0) | 0;
            hc = (ob >>> 1 | nb << 31) ^ (ob >>> 8 | nb << 24) ^ (ob >>> 7 | nb << 25) | 0;
            mb = mb + hc | 0;
            lb = lb + ((nb >>> 1 | ob << 31) ^ (nb >>> 8 | ob << 24) ^ nb >>> 7) + (mb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = (Ob >>> 19 | Nb << 13) ^ (Ob << 3 | Nb >>> 29) ^ (Ob >>> 6 | Nb << 26) | 0;
            mb = mb + hc | 0;
            lb = lb + ((Nb >>> 19 | Ob << 13) ^ (Nb << 3 | Ob >>> 29) ^ Nb >>> 6) + (mb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 1188179964 + mb | 0;
            fc = 666307205 + lb + (gc >>> 0 < mb >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ob = ob + Gb | 0;
            nb = nb + Fb + (ob >>> 0 < Gb >>> 0 ? 1 : 0) | 0;
            hc = (qb >>> 1 | pb << 31) ^ (qb >>> 8 | pb << 24) ^ (qb >>> 7 | pb << 25) | 0;
            ob = ob + hc | 0;
            nb = nb + ((pb >>> 1 | qb << 31) ^ (pb >>> 8 | qb << 24) ^ pb >>> 7) + (ob >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = (Qb >>> 19 | Pb << 13) ^ (Qb << 3 | Pb >>> 29) ^ (Qb >>> 6 | Pb << 26) | 0;
            ob = ob + hc | 0;
            nb = nb + ((Pb >>> 19 | Qb << 13) ^ (Pb << 3 | Qb >>> 29) ^ Pb >>> 6) + (ob >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 1546045734 + ob | 0;
            fc = 773529912 + nb + (gc >>> 0 < ob >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            qb = qb + Ib | 0;
            pb = pb + Hb + (qb >>> 0 < Ib >>> 0 ? 1 : 0) | 0;
            hc = (sb >>> 1 | rb << 31) ^ (sb >>> 8 | rb << 24) ^ (sb >>> 7 | rb << 25) | 0;
            qb = qb + hc | 0;
            pb = pb + ((rb >>> 1 | sb << 31) ^ (rb >>> 8 | sb << 24) ^ rb >>> 7) + (qb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = (mb >>> 19 | lb << 13) ^ (mb << 3 | lb >>> 29) ^ (mb >>> 6 | lb << 26) | 0;
            qb = qb + hc | 0;
            pb = pb + ((lb >>> 19 | mb << 13) ^ (lb << 3 | mb >>> 29) ^ lb >>> 6) + (qb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 1522805485 + qb | 0;
            fc = 1294757372 + pb + (gc >>> 0 < qb >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            sb = sb + Kb | 0;
            rb = rb + Jb + (sb >>> 0 < Kb >>> 0 ? 1 : 0) | 0;
            hc = (ub >>> 1 | tb << 31) ^ (ub >>> 8 | tb << 24) ^ (ub >>> 7 | tb << 25) | 0;
            sb = sb + hc | 0;
            rb = rb + ((tb >>> 1 | ub << 31) ^ (tb >>> 8 | ub << 24) ^ tb >>> 7) + (sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = (ob >>> 19 | nb << 13) ^ (ob << 3 | nb >>> 29) ^ (ob >>> 6 | nb << 26) | 0;
            sb = sb + hc | 0;
            rb = rb + ((nb >>> 19 | ob << 13) ^ (nb << 3 | ob >>> 29) ^ nb >>> 6) + (sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 2643833823 + sb | 0;
            fc = 1396182291 + rb + (gc >>> 0 < sb >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ub = ub + Mb | 0;
            tb = tb + Lb + (ub >>> 0 < Mb >>> 0 ? 1 : 0) | 0;
            hc = (wb >>> 1 | vb << 31) ^ (wb >>> 8 | vb << 24) ^ (wb >>> 7 | vb << 25) | 0;
            ub = ub + hc | 0;
            tb = tb + ((vb >>> 1 | wb << 31) ^ (vb >>> 8 | wb << 24) ^ vb >>> 7) + (ub >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = (qb >>> 19 | pb << 13) ^ (qb << 3 | pb >>> 29) ^ (qb >>> 6 | pb << 26) | 0;
            ub = ub + hc | 0;
            tb = tb + ((pb >>> 19 | qb << 13) ^ (pb << 3 | qb >>> 29) ^ pb >>> 6) + (ub >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 2343527390 + ub | 0;
            fc = 1695183700 + tb + (gc >>> 0 < ub >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            wb = wb + Ob | 0;
            vb = vb + Nb + (wb >>> 0 < Ob >>> 0 ? 1 : 0) | 0;
            hc = (yb >>> 1 | xb << 31) ^ (yb >>> 8 | xb << 24) ^ (yb >>> 7 | xb << 25) | 0;
            wb = wb + hc | 0;
            vb = vb + ((xb >>> 1 | yb << 31) ^ (xb >>> 8 | yb << 24) ^ xb >>> 7) + (wb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = (sb >>> 19 | rb << 13) ^ (sb << 3 | rb >>> 29) ^ (sb >>> 6 | rb << 26) | 0;
            wb = wb + hc | 0;
            vb = vb + ((rb >>> 19 | sb << 13) ^ (rb << 3 | sb >>> 29) ^ rb >>> 6) + (wb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 1014477480 + wb | 0;
            fc = 1986661051 + vb + (gc >>> 0 < wb >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            yb = yb + Qb | 0;
            xb = xb + Pb + (yb >>> 0 < Qb >>> 0 ? 1 : 0) | 0;
            hc = (Ab >>> 1 | zb << 31) ^ (Ab >>> 8 | zb << 24) ^ (Ab >>> 7 | zb << 25) | 0;
            yb = yb + hc | 0;
            xb = xb + ((zb >>> 1 | Ab << 31) ^ (zb >>> 8 | Ab << 24) ^ zb >>> 7) + (yb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = (ub >>> 19 | tb << 13) ^ (ub << 3 | tb >>> 29) ^ (ub >>> 6 | tb << 26) | 0;
            yb = yb + hc | 0;
            xb = xb + ((tb >>> 19 | ub << 13) ^ (tb << 3 | ub >>> 29) ^ tb >>> 6) + (yb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 1206759142 + yb | 0;
            fc = 2177026350 + xb + (gc >>> 0 < yb >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            Ab = Ab + mb | 0;
            zb = zb + lb + (Ab >>> 0 < mb >>> 0 ? 1 : 0) | 0;
            hc = (Cb >>> 1 | Bb << 31) ^ (Cb >>> 8 | Bb << 24) ^ (Cb >>> 7 | Bb << 25) | 0;
            Ab = Ab + hc | 0;
            zb = zb + ((Bb >>> 1 | Cb << 31) ^ (Bb >>> 8 | Cb << 24) ^ Bb >>> 7) + (Ab >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = (wb >>> 19 | vb << 13) ^ (wb << 3 | vb >>> 29) ^ (wb >>> 6 | vb << 26) | 0;
            Ab = Ab + hc | 0;
            zb = zb + ((vb >>> 19 | wb << 13) ^ (vb << 3 | wb >>> 29) ^ vb >>> 6) + (Ab >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 344077627 + Ab | 0;
            fc = 2456956037 + zb + (gc >>> 0 < Ab >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            Cb = Cb + ob | 0;
            Bb = Bb + nb + (Cb >>> 0 < ob >>> 0 ? 1 : 0) | 0;
            hc = (Eb >>> 1 | Db << 31) ^ (Eb >>> 8 | Db << 24) ^ (Eb >>> 7 | Db << 25) | 0;
            Cb = Cb + hc | 0;
            Bb = Bb + ((Db >>> 1 | Eb << 31) ^ (Db >>> 8 | Eb << 24) ^ Db >>> 7) + (Cb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = (yb >>> 19 | xb << 13) ^ (yb << 3 | xb >>> 29) ^ (yb >>> 6 | xb << 26) | 0;
            Cb = Cb + hc | 0;
            Bb = Bb + ((xb >>> 19 | yb << 13) ^ (xb << 3 | yb >>> 29) ^ xb >>> 6) + (Cb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 1290863460 + Cb | 0;
            fc = 2730485921 + Bb + (gc >>> 0 < Cb >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            Eb = Eb + qb | 0;
            Db = Db + pb + (Eb >>> 0 < qb >>> 0 ? 1 : 0) | 0;
            hc = (Gb >>> 1 | Fb << 31) ^ (Gb >>> 8 | Fb << 24) ^ (Gb >>> 7 | Fb << 25) | 0;
            Eb = Eb + hc | 0;
            Db = Db + ((Fb >>> 1 | Gb << 31) ^ (Fb >>> 8 | Gb << 24) ^ Fb >>> 7) + (Eb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = (Ab >>> 19 | zb << 13) ^ (Ab << 3 | zb >>> 29) ^ (Ab >>> 6 | zb << 26) | 0;
            Eb = Eb + hc | 0;
            Db = Db + ((zb >>> 19 | Ab << 13) ^ (zb << 3 | Ab >>> 29) ^ zb >>> 6) + (Eb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 3158454273 + Eb | 0;
            fc = 2820302411 + Db + (gc >>> 0 < Eb >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            Gb = Gb + sb | 0;
            Fb = Fb + rb + (Gb >>> 0 < sb >>> 0 ? 1 : 0) | 0;
            hc = (Ib >>> 1 | Hb << 31) ^ (Ib >>> 8 | Hb << 24) ^ (Ib >>> 7 | Hb << 25) | 0;
            Gb = Gb + hc | 0;
            Fb = Fb + ((Hb >>> 1 | Ib << 31) ^ (Hb >>> 8 | Ib << 24) ^ Hb >>> 7) + (Gb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = (Cb >>> 19 | Bb << 13) ^ (Cb << 3 | Bb >>> 29) ^ (Cb >>> 6 | Bb << 26) | 0;
            Gb = Gb + hc | 0;
            Fb = Fb + ((Bb >>> 19 | Cb << 13) ^ (Bb << 3 | Cb >>> 29) ^ Bb >>> 6) + (Gb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 3505952657 + Gb | 0;
            fc = 3259730800 + Fb + (gc >>> 0 < Gb >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            Ib = Ib + ub | 0;
            Hb = Hb + tb + (Ib >>> 0 < ub >>> 0 ? 1 : 0) | 0;
            hc = (Kb >>> 1 | Jb << 31) ^ (Kb >>> 8 | Jb << 24) ^ (Kb >>> 7 | Jb << 25) | 0;
            Ib = Ib + hc | 0;
            Hb = Hb + ((Jb >>> 1 | Kb << 31) ^ (Jb >>> 8 | Kb << 24) ^ Jb >>> 7) + (Ib >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = (Eb >>> 19 | Db << 13) ^ (Eb << 3 | Db >>> 29) ^ (Eb >>> 6 | Db << 26) | 0;
            Ib = Ib + hc | 0;
            Hb = Hb + ((Db >>> 19 | Eb << 13) ^ (Db << 3 | Eb >>> 29) ^ Db >>> 6) + (Ib >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 106217008 + Ib | 0;
            fc = 3345764771 + Hb + (gc >>> 0 < Ib >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            Kb = Kb + wb | 0;
            Jb = Jb + vb + (Kb >>> 0 < wb >>> 0 ? 1 : 0) | 0;
            hc = (Mb >>> 1 | Lb << 31) ^ (Mb >>> 8 | Lb << 24) ^ (Mb >>> 7 | Lb << 25) | 0;
            Kb = Kb + hc | 0;
            Jb = Jb + ((Lb >>> 1 | Mb << 31) ^ (Lb >>> 8 | Mb << 24) ^ Lb >>> 7) + (Kb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = (Gb >>> 19 | Fb << 13) ^ (Gb << 3 | Fb >>> 29) ^ (Gb >>> 6 | Fb << 26) | 0;
            Kb = Kb + hc | 0;
            Jb = Jb + ((Fb >>> 19 | Gb << 13) ^ (Fb << 3 | Gb >>> 29) ^ Fb >>> 6) + (Kb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 3606008344 + Kb | 0;
            fc = 3516065817 + Jb + (gc >>> 0 < Kb >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            Mb = Mb + yb | 0;
            Lb = Lb + xb + (Mb >>> 0 < yb >>> 0 ? 1 : 0) | 0;
            hc = (Ob >>> 1 | Nb << 31) ^ (Ob >>> 8 | Nb << 24) ^ (Ob >>> 7 | Nb << 25) | 0;
            Mb = Mb + hc | 0;
            Lb = Lb + ((Nb >>> 1 | Ob << 31) ^ (Nb >>> 8 | Ob << 24) ^ Nb >>> 7) + (Mb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = (Ib >>> 19 | Hb << 13) ^ (Ib << 3 | Hb >>> 29) ^ (Ib >>> 6 | Hb << 26) | 0;
            Mb = Mb + hc | 0;
            Lb = Lb + ((Hb >>> 19 | Ib << 13) ^ (Hb << 3 | Ib >>> 29) ^ Hb >>> 6) + (Mb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 1432725776 + Mb | 0;
            fc = 3600352804 + Lb + (gc >>> 0 < Mb >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            Ob = Ob + Ab | 0;
            Nb = Nb + zb + (Ob >>> 0 < Ab >>> 0 ? 1 : 0) | 0;
            hc = (Qb >>> 1 | Pb << 31) ^ (Qb >>> 8 | Pb << 24) ^ (Qb >>> 7 | Pb << 25) | 0;
            Ob = Ob + hc | 0;
            Nb = Nb + ((Pb >>> 1 | Qb << 31) ^ (Pb >>> 8 | Qb << 24) ^ Pb >>> 7) + (Ob >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = (Kb >>> 19 | Jb << 13) ^ (Kb << 3 | Jb >>> 29) ^ (Kb >>> 6 | Jb << 26) | 0;
            Ob = Ob + hc | 0;
            Nb = Nb + ((Jb >>> 19 | Kb << 13) ^ (Jb << 3 | Kb >>> 29) ^ Jb >>> 6) + (Ob >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 1467031594 + Ob | 0;
            fc = 4094571909 + Nb + (gc >>> 0 < Ob >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            Qb = Qb + Cb | 0;
            Pb = Pb + Bb + (Qb >>> 0 < Cb >>> 0 ? 1 : 0) | 0;
            hc = (mb >>> 1 | lb << 31) ^ (mb >>> 8 | lb << 24) ^ (mb >>> 7 | lb << 25) | 0;
            Qb = Qb + hc | 0;
            Pb = Pb + ((lb >>> 1 | mb << 31) ^ (lb >>> 8 | mb << 24) ^ lb >>> 7) + (Qb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = (Mb >>> 19 | Lb << 13) ^ (Mb << 3 | Lb >>> 29) ^ (Mb >>> 6 | Lb << 26) | 0;
            Qb = Qb + hc | 0;
            Pb = Pb + ((Lb >>> 19 | Mb << 13) ^ (Lb << 3 | Mb >>> 29) ^ Lb >>> 6) + (Qb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 851169720 + Qb | 0;
            fc = 275423344 + Pb + (gc >>> 0 < Qb >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            mb = mb + Eb | 0;
            lb = lb + Db + (mb >>> 0 < Eb >>> 0 ? 1 : 0) | 0;
            hc = (ob >>> 1 | nb << 31) ^ (ob >>> 8 | nb << 24) ^ (ob >>> 7 | nb << 25) | 0;
            mb = mb + hc | 0;
            lb = lb + ((nb >>> 1 | ob << 31) ^ (nb >>> 8 | ob << 24) ^ nb >>> 7) + (mb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = (Ob >>> 19 | Nb << 13) ^ (Ob << 3 | Nb >>> 29) ^ (Ob >>> 6 | Nb << 26) | 0;
            mb = mb + hc | 0;
            lb = lb + ((Nb >>> 19 | Ob << 13) ^ (Nb << 3 | Ob >>> 29) ^ Nb >>> 6) + (mb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 3100823752 + mb | 0;
            fc = 430227734 + lb + (gc >>> 0 < mb >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ob = ob + Gb | 0;
            nb = nb + Fb + (ob >>> 0 < Gb >>> 0 ? 1 : 0) | 0;
            hc = (qb >>> 1 | pb << 31) ^ (qb >>> 8 | pb << 24) ^ (qb >>> 7 | pb << 25) | 0;
            ob = ob + hc | 0;
            nb = nb + ((pb >>> 1 | qb << 31) ^ (pb >>> 8 | qb << 24) ^ pb >>> 7) + (ob >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = (Qb >>> 19 | Pb << 13) ^ (Qb << 3 | Pb >>> 29) ^ (Qb >>> 6 | Pb << 26) | 0;
            ob = ob + hc | 0;
            nb = nb + ((Pb >>> 19 | Qb << 13) ^ (Pb << 3 | Qb >>> 29) ^ Pb >>> 6) + (ob >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 1363258195 + ob | 0;
            fc = 506948616 + nb + (gc >>> 0 < ob >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            qb = qb + Ib | 0;
            pb = pb + Hb + (qb >>> 0 < Ib >>> 0 ? 1 : 0) | 0;
            hc = (sb >>> 1 | rb << 31) ^ (sb >>> 8 | rb << 24) ^ (sb >>> 7 | rb << 25) | 0;
            qb = qb + hc | 0;
            pb = pb + ((rb >>> 1 | sb << 31) ^ (rb >>> 8 | sb << 24) ^ rb >>> 7) + (qb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = (mb >>> 19 | lb << 13) ^ (mb << 3 | lb >>> 29) ^ (mb >>> 6 | lb << 26) | 0;
            qb = qb + hc | 0;
            pb = pb + ((lb >>> 19 | mb << 13) ^ (lb << 3 | mb >>> 29) ^ lb >>> 6) + (qb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 3750685593 + qb | 0;
            fc = 659060556 + pb + (gc >>> 0 < qb >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            sb = sb + Kb | 0;
            rb = rb + Jb + (sb >>> 0 < Kb >>> 0 ? 1 : 0) | 0;
            hc = (ub >>> 1 | tb << 31) ^ (ub >>> 8 | tb << 24) ^ (ub >>> 7 | tb << 25) | 0;
            sb = sb + hc | 0;
            rb = rb + ((tb >>> 1 | ub << 31) ^ (tb >>> 8 | ub << 24) ^ tb >>> 7) + (sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = (ob >>> 19 | nb << 13) ^ (ob << 3 | nb >>> 29) ^ (ob >>> 6 | nb << 26) | 0;
            sb = sb + hc | 0;
            rb = rb + ((nb >>> 19 | ob << 13) ^ (nb << 3 | ob >>> 29) ^ nb >>> 6) + (sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 3785050280 + sb | 0;
            fc = 883997877 + rb + (gc >>> 0 < sb >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ub = ub + Mb | 0;
            tb = tb + Lb + (ub >>> 0 < Mb >>> 0 ? 1 : 0) | 0;
            hc = (wb >>> 1 | vb << 31) ^ (wb >>> 8 | vb << 24) ^ (wb >>> 7 | vb << 25) | 0;
            ub = ub + hc | 0;
            tb = tb + ((vb >>> 1 | wb << 31) ^ (vb >>> 8 | wb << 24) ^ vb >>> 7) + (ub >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = (qb >>> 19 | pb << 13) ^ (qb << 3 | pb >>> 29) ^ (qb >>> 6 | pb << 26) | 0;
            ub = ub + hc | 0;
            tb = tb + ((pb >>> 19 | qb << 13) ^ (pb << 3 | qb >>> 29) ^ pb >>> 6) + (ub >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 3318307427 + ub | 0;
            fc = 958139571 + tb + (gc >>> 0 < ub >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            wb = wb + Ob | 0;
            vb = vb + Nb + (wb >>> 0 < Ob >>> 0 ? 1 : 0) | 0;
            hc = (yb >>> 1 | xb << 31) ^ (yb >>> 8 | xb << 24) ^ (yb >>> 7 | xb << 25) | 0;
            wb = wb + hc | 0;
            vb = vb + ((xb >>> 1 | yb << 31) ^ (xb >>> 8 | yb << 24) ^ xb >>> 7) + (wb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = (sb >>> 19 | rb << 13) ^ (sb << 3 | rb >>> 29) ^ (sb >>> 6 | rb << 26) | 0;
            wb = wb + hc | 0;
            vb = vb + ((rb >>> 19 | sb << 13) ^ (rb << 3 | sb >>> 29) ^ rb >>> 6) + (wb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 3812723403 + wb | 0;
            fc = 1322822218 + vb + (gc >>> 0 < wb >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            yb = yb + Qb | 0;
            xb = xb + Pb + (yb >>> 0 < Qb >>> 0 ? 1 : 0) | 0;
            hc = (Ab >>> 1 | zb << 31) ^ (Ab >>> 8 | zb << 24) ^ (Ab >>> 7 | zb << 25) | 0;
            yb = yb + hc | 0;
            xb = xb + ((zb >>> 1 | Ab << 31) ^ (zb >>> 8 | Ab << 24) ^ zb >>> 7) + (yb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = (ub >>> 19 | tb << 13) ^ (ub << 3 | tb >>> 29) ^ (ub >>> 6 | tb << 26) | 0;
            yb = yb + hc | 0;
            xb = xb + ((tb >>> 19 | ub << 13) ^ (tb << 3 | ub >>> 29) ^ tb >>> 6) + (yb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 2003034995 + yb | 0;
            fc = 1537002063 + xb + (gc >>> 0 < yb >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            Ab = Ab + mb | 0;
            zb = zb + lb + (Ab >>> 0 < mb >>> 0 ? 1 : 0) | 0;
            hc = (Cb >>> 1 | Bb << 31) ^ (Cb >>> 8 | Bb << 24) ^ (Cb >>> 7 | Bb << 25) | 0;
            Ab = Ab + hc | 0;
            zb = zb + ((Bb >>> 1 | Cb << 31) ^ (Bb >>> 8 | Cb << 24) ^ Bb >>> 7) + (Ab >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = (wb >>> 19 | vb << 13) ^ (wb << 3 | vb >>> 29) ^ (wb >>> 6 | vb << 26) | 0;
            Ab = Ab + hc | 0;
            zb = zb + ((vb >>> 19 | wb << 13) ^ (vb << 3 | wb >>> 29) ^ vb >>> 6) + (Ab >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 3602036899 + Ab | 0;
            fc = 1747873779 + zb + (gc >>> 0 < Ab >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            Cb = Cb + ob | 0;
            Bb = Bb + nb + (Cb >>> 0 < ob >>> 0 ? 1 : 0) | 0;
            hc = (Eb >>> 1 | Db << 31) ^ (Eb >>> 8 | Db << 24) ^ (Eb >>> 7 | Db << 25) | 0;
            Cb = Cb + hc | 0;
            Bb = Bb + ((Db >>> 1 | Eb << 31) ^ (Db >>> 8 | Eb << 24) ^ Db >>> 7) + (Cb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = (yb >>> 19 | xb << 13) ^ (yb << 3 | xb >>> 29) ^ (yb >>> 6 | xb << 26) | 0;
            Cb = Cb + hc | 0;
            Bb = Bb + ((xb >>> 19 | yb << 13) ^ (xb << 3 | yb >>> 29) ^ xb >>> 6) + (Cb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 1575990012 + Cb | 0;
            fc = 1955562222 + Bb + (gc >>> 0 < Cb >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            Eb = Eb + qb | 0;
            Db = Db + pb + (Eb >>> 0 < qb >>> 0 ? 1 : 0) | 0;
            hc = (Gb >>> 1 | Fb << 31) ^ (Gb >>> 8 | Fb << 24) ^ (Gb >>> 7 | Fb << 25) | 0;
            Eb = Eb + hc | 0;
            Db = Db + ((Fb >>> 1 | Gb << 31) ^ (Fb >>> 8 | Gb << 24) ^ Fb >>> 7) + (Eb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = (Ab >>> 19 | zb << 13) ^ (Ab << 3 | zb >>> 29) ^ (Ab >>> 6 | zb << 26) | 0;
            Eb = Eb + hc | 0;
            Db = Db + ((zb >>> 19 | Ab << 13) ^ (zb << 3 | Ab >>> 29) ^ zb >>> 6) + (Eb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 1125592928 + Eb | 0;
            fc = 2024104815 + Db + (gc >>> 0 < Eb >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            Gb = Gb + sb | 0;
            Fb = Fb + rb + (Gb >>> 0 < sb >>> 0 ? 1 : 0) | 0;
            hc = (Ib >>> 1 | Hb << 31) ^ (Ib >>> 8 | Hb << 24) ^ (Ib >>> 7 | Hb << 25) | 0;
            Gb = Gb + hc | 0;
            Fb = Fb + ((Hb >>> 1 | Ib << 31) ^ (Hb >>> 8 | Ib << 24) ^ Hb >>> 7) + (Gb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = (Cb >>> 19 | Bb << 13) ^ (Cb << 3 | Bb >>> 29) ^ (Cb >>> 6 | Bb << 26) | 0;
            Gb = Gb + hc | 0;
            Fb = Fb + ((Bb >>> 19 | Cb << 13) ^ (Bb << 3 | Cb >>> 29) ^ Bb >>> 6) + (Gb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 2716904306 + Gb | 0;
            fc = 2227730452 + Fb + (gc >>> 0 < Gb >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            Ib = Ib + ub | 0;
            Hb = Hb + tb + (Ib >>> 0 < ub >>> 0 ? 1 : 0) | 0;
            hc = (Kb >>> 1 | Jb << 31) ^ (Kb >>> 8 | Jb << 24) ^ (Kb >>> 7 | Jb << 25) | 0;
            Ib = Ib + hc | 0;
            Hb = Hb + ((Jb >>> 1 | Kb << 31) ^ (Jb >>> 8 | Kb << 24) ^ Jb >>> 7) + (Ib >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = (Eb >>> 19 | Db << 13) ^ (Eb << 3 | Db >>> 29) ^ (Eb >>> 6 | Db << 26) | 0;
            Ib = Ib + hc | 0;
            Hb = Hb + ((Db >>> 19 | Eb << 13) ^ (Db << 3 | Eb >>> 29) ^ Db >>> 6) + (Ib >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 442776044 + Ib | 0;
            fc = 2361852424 + Hb + (gc >>> 0 < Ib >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            Kb = Kb + wb | 0;
            Jb = Jb + vb + (Kb >>> 0 < wb >>> 0 ? 1 : 0) | 0;
            hc = (Mb >>> 1 | Lb << 31) ^ (Mb >>> 8 | Lb << 24) ^ (Mb >>> 7 | Lb << 25) | 0;
            Kb = Kb + hc | 0;
            Jb = Jb + ((Lb >>> 1 | Mb << 31) ^ (Lb >>> 8 | Mb << 24) ^ Lb >>> 7) + (Kb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = (Gb >>> 19 | Fb << 13) ^ (Gb << 3 | Fb >>> 29) ^ (Gb >>> 6 | Fb << 26) | 0;
            Kb = Kb + hc | 0;
            Jb = Jb + ((Fb >>> 19 | Gb << 13) ^ (Fb << 3 | Gb >>> 29) ^ Fb >>> 6) + (Kb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 593698344 + Kb | 0;
            fc = 2428436474 + Jb + (gc >>> 0 < Kb >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            Mb = Mb + yb | 0;
            Lb = Lb + xb + (Mb >>> 0 < yb >>> 0 ? 1 : 0) | 0;
            hc = (Ob >>> 1 | Nb << 31) ^ (Ob >>> 8 | Nb << 24) ^ (Ob >>> 7 | Nb << 25) | 0;
            Mb = Mb + hc | 0;
            Lb = Lb + ((Nb >>> 1 | Ob << 31) ^ (Nb >>> 8 | Ob << 24) ^ Nb >>> 7) + (Mb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = (Ib >>> 19 | Hb << 13) ^ (Ib << 3 | Hb >>> 29) ^ (Ib >>> 6 | Hb << 26) | 0;
            Mb = Mb + hc | 0;
            Lb = Lb + ((Hb >>> 19 | Ib << 13) ^ (Hb << 3 | Ib >>> 29) ^ Hb >>> 6) + (Mb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 3733110249 + Mb | 0;
            fc = 2756734187 + Lb + (gc >>> 0 < Mb >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            Ob = Ob + Ab | 0;
            Nb = Nb + zb + (Ob >>> 0 < Ab >>> 0 ? 1 : 0) | 0;
            hc = (Qb >>> 1 | Pb << 31) ^ (Qb >>> 8 | Pb << 24) ^ (Qb >>> 7 | Pb << 25) | 0;
            Ob = Ob + hc | 0;
            Nb = Nb + ((Pb >>> 1 | Qb << 31) ^ (Pb >>> 8 | Qb << 24) ^ Pb >>> 7) + (Ob >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = (Kb >>> 19 | Jb << 13) ^ (Kb << 3 | Jb >>> 29) ^ (Kb >>> 6 | Jb << 26) | 0;
            Ob = Ob + hc | 0;
            Nb = Nb + ((Jb >>> 19 | Kb << 13) ^ (Jb << 3 | Kb >>> 29) ^ Jb >>> 6) + (Ob >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 2999351573 + Ob | 0;
            fc = 3204031479 + Nb + (gc >>> 0 < Ob >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            Qb = Qb + Cb | 0;
            Pb = Pb + Bb + (Qb >>> 0 < Cb >>> 0 ? 1 : 0) | 0;
            hc = (mb >>> 1 | lb << 31) ^ (mb >>> 8 | lb << 24) ^ (mb >>> 7 | lb << 25) | 0;
            Qb = Qb + hc | 0;
            Pb = Pb + ((lb >>> 1 | mb << 31) ^ (lb >>> 8 | mb << 24) ^ lb >>> 7) + (Qb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = (Mb >>> 19 | Lb << 13) ^ (Mb << 3 | Lb >>> 29) ^ (Mb >>> 6 | Lb << 26) | 0;
            Qb = Qb + hc | 0;
            Pb = Pb + ((Lb >>> 19 | Mb << 13) ^ (Lb << 3 | Mb >>> 29) ^ Lb >>> 6) + (Qb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 3815920427 + Qb | 0;
            fc = 3329325298 + Pb + (gc >>> 0 < Qb >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            mb = mb + Eb | 0;
            lb = lb + Db + (mb >>> 0 < Eb >>> 0 ? 1 : 0) | 0;
            hc = (ob >>> 1 | nb << 31) ^ (ob >>> 8 | nb << 24) ^ (ob >>> 7 | nb << 25) | 0;
            mb = mb + hc | 0;
            lb = lb + ((nb >>> 1 | ob << 31) ^ (nb >>> 8 | ob << 24) ^ nb >>> 7) + (mb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = (Ob >>> 19 | Nb << 13) ^ (Ob << 3 | Nb >>> 29) ^ (Ob >>> 6 | Nb << 26) | 0;
            mb = mb + hc | 0;
            lb = lb + ((Nb >>> 19 | Ob << 13) ^ (Nb << 3 | Ob >>> 29) ^ Nb >>> 6) + (mb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 3928383900 + mb | 0;
            fc = 3391569614 + lb + (gc >>> 0 < mb >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ob = ob + Gb | 0;
            nb = nb + Fb + (ob >>> 0 < Gb >>> 0 ? 1 : 0) | 0;
            hc = (qb >>> 1 | pb << 31) ^ (qb >>> 8 | pb << 24) ^ (qb >>> 7 | pb << 25) | 0;
            ob = ob + hc | 0;
            nb = nb + ((pb >>> 1 | qb << 31) ^ (pb >>> 8 | qb << 24) ^ pb >>> 7) + (ob >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = (Qb >>> 19 | Pb << 13) ^ (Qb << 3 | Pb >>> 29) ^ (Qb >>> 6 | Pb << 26) | 0;
            ob = ob + hc | 0;
            nb = nb + ((Pb >>> 19 | Qb << 13) ^ (Pb << 3 | Qb >>> 29) ^ Pb >>> 6) + (ob >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 566280711 + ob | 0;
            fc = 3515267271 + nb + (gc >>> 0 < ob >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            qb = qb + Ib | 0;
            pb = pb + Hb + (qb >>> 0 < Ib >>> 0 ? 1 : 0) | 0;
            hc = (sb >>> 1 | rb << 31) ^ (sb >>> 8 | rb << 24) ^ (sb >>> 7 | rb << 25) | 0;
            qb = qb + hc | 0;
            pb = pb + ((rb >>> 1 | sb << 31) ^ (rb >>> 8 | sb << 24) ^ rb >>> 7) + (qb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = (mb >>> 19 | lb << 13) ^ (mb << 3 | lb >>> 29) ^ (mb >>> 6 | lb << 26) | 0;
            qb = qb + hc | 0;
            pb = pb + ((lb >>> 19 | mb << 13) ^ (lb << 3 | mb >>> 29) ^ lb >>> 6) + (qb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 3454069534 + qb | 0;
            fc = 3940187606 + pb + (gc >>> 0 < qb >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            sb = sb + Kb | 0;
            rb = rb + Jb + (sb >>> 0 < Kb >>> 0 ? 1 : 0) | 0;
            hc = (ub >>> 1 | tb << 31) ^ (ub >>> 8 | tb << 24) ^ (ub >>> 7 | tb << 25) | 0;
            sb = sb + hc | 0;
            rb = rb + ((tb >>> 1 | ub << 31) ^ (tb >>> 8 | ub << 24) ^ tb >>> 7) + (sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = (ob >>> 19 | nb << 13) ^ (ob << 3 | nb >>> 29) ^ (ob >>> 6 | nb << 26) | 0;
            sb = sb + hc | 0;
            rb = rb + ((nb >>> 19 | ob << 13) ^ (nb << 3 | ob >>> 29) ^ nb >>> 6) + (sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 4000239992 + sb | 0;
            fc = 4118630271 + rb + (gc >>> 0 < sb >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ub = ub + Mb | 0;
            tb = tb + Lb + (ub >>> 0 < Mb >>> 0 ? 1 : 0) | 0;
            hc = (wb >>> 1 | vb << 31) ^ (wb >>> 8 | vb << 24) ^ (wb >>> 7 | vb << 25) | 0;
            ub = ub + hc | 0;
            tb = tb + ((vb >>> 1 | wb << 31) ^ (vb >>> 8 | wb << 24) ^ vb >>> 7) + (ub >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = (qb >>> 19 | pb << 13) ^ (qb << 3 | pb >>> 29) ^ (qb >>> 6 | pb << 26) | 0;
            ub = ub + hc | 0;
            tb = tb + ((pb >>> 19 | qb << 13) ^ (pb << 3 | qb >>> 29) ^ pb >>> 6) + (ub >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 1914138554 + ub | 0;
            fc = 116418474 + tb + (gc >>> 0 < ub >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            wb = wb + Ob | 0;
            vb = vb + Nb + (wb >>> 0 < Ob >>> 0 ? 1 : 0) | 0;
            hc = (yb >>> 1 | xb << 31) ^ (yb >>> 8 | xb << 24) ^ (yb >>> 7 | xb << 25) | 0;
            wb = wb + hc | 0;
            vb = vb + ((xb >>> 1 | yb << 31) ^ (xb >>> 8 | yb << 24) ^ xb >>> 7) + (wb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = (sb >>> 19 | rb << 13) ^ (sb << 3 | rb >>> 29) ^ (sb >>> 6 | rb << 26) | 0;
            wb = wb + hc | 0;
            vb = vb + ((rb >>> 19 | sb << 13) ^ (rb << 3 | sb >>> 29) ^ rb >>> 6) + (wb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 2731055270 + wb | 0;
            fc = 174292421 + vb + (gc >>> 0 < wb >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            yb = yb + Qb | 0;
            xb = xb + Pb + (yb >>> 0 < Qb >>> 0 ? 1 : 0) | 0;
            hc = (Ab >>> 1 | zb << 31) ^ (Ab >>> 8 | zb << 24) ^ (Ab >>> 7 | zb << 25) | 0;
            yb = yb + hc | 0;
            xb = xb + ((zb >>> 1 | Ab << 31) ^ (zb >>> 8 | Ab << 24) ^ zb >>> 7) + (yb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = (ub >>> 19 | tb << 13) ^ (ub << 3 | tb >>> 29) ^ (ub >>> 6 | tb << 26) | 0;
            yb = yb + hc | 0;
            xb = xb + ((tb >>> 19 | ub << 13) ^ (tb << 3 | ub >>> 29) ^ tb >>> 6) + (yb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 3203993006 + yb | 0;
            fc = 289380356 + xb + (gc >>> 0 < yb >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            Ab = Ab + mb | 0;
            zb = zb + lb + (Ab >>> 0 < mb >>> 0 ? 1 : 0) | 0;
            hc = (Cb >>> 1 | Bb << 31) ^ (Cb >>> 8 | Bb << 24) ^ (Cb >>> 7 | Bb << 25) | 0;
            Ab = Ab + hc | 0;
            zb = zb + ((Bb >>> 1 | Cb << 31) ^ (Bb >>> 8 | Cb << 24) ^ Bb >>> 7) + (Ab >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = (wb >>> 19 | vb << 13) ^ (wb << 3 | vb >>> 29) ^ (wb >>> 6 | vb << 26) | 0;
            Ab = Ab + hc | 0;
            zb = zb + ((vb >>> 19 | wb << 13) ^ (vb << 3 | wb >>> 29) ^ vb >>> 6) + (Ab >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 320620315 + Ab | 0;
            fc = 460393269 + zb + (gc >>> 0 < Ab >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            Cb = Cb + ob | 0;
            Bb = Bb + nb + (Cb >>> 0 < ob >>> 0 ? 1 : 0) | 0;
            hc = (Eb >>> 1 | Db << 31) ^ (Eb >>> 8 | Db << 24) ^ (Eb >>> 7 | Db << 25) | 0;
            Cb = Cb + hc | 0;
            Bb = Bb + ((Db >>> 1 | Eb << 31) ^ (Db >>> 8 | Eb << 24) ^ Db >>> 7) + (Cb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = (yb >>> 19 | xb << 13) ^ (yb << 3 | xb >>> 29) ^ (yb >>> 6 | xb << 26) | 0;
            Cb = Cb + hc | 0;
            Bb = Bb + ((xb >>> 19 | yb << 13) ^ (xb << 3 | yb >>> 29) ^ xb >>> 6) + (Cb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 587496836 + Cb | 0;
            fc = 685471733 + Bb + (gc >>> 0 < Cb >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            Eb = Eb + qb | 0;
            Db = Db + pb + (Eb >>> 0 < qb >>> 0 ? 1 : 0) | 0;
            hc = (Gb >>> 1 | Fb << 31) ^ (Gb >>> 8 | Fb << 24) ^ (Gb >>> 7 | Fb << 25) | 0;
            Eb = Eb + hc | 0;
            Db = Db + ((Fb >>> 1 | Gb << 31) ^ (Fb >>> 8 | Gb << 24) ^ Fb >>> 7) + (Eb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = (Ab >>> 19 | zb << 13) ^ (Ab << 3 | zb >>> 29) ^ (Ab >>> 6 | zb << 26) | 0;
            Eb = Eb + hc | 0;
            Db = Db + ((zb >>> 19 | Ab << 13) ^ (zb << 3 | Ab >>> 29) ^ zb >>> 6) + (Eb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 1086792851 + Eb | 0;
            fc = 852142971 + Db + (gc >>> 0 < Eb >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            Gb = Gb + sb | 0;
            Fb = Fb + rb + (Gb >>> 0 < sb >>> 0 ? 1 : 0) | 0;
            hc = (Ib >>> 1 | Hb << 31) ^ (Ib >>> 8 | Hb << 24) ^ (Ib >>> 7 | Hb << 25) | 0;
            Gb = Gb + hc | 0;
            Fb = Fb + ((Hb >>> 1 | Ib << 31) ^ (Hb >>> 8 | Ib << 24) ^ Hb >>> 7) + (Gb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = (Cb >>> 19 | Bb << 13) ^ (Cb << 3 | Bb >>> 29) ^ (Cb >>> 6 | Bb << 26) | 0;
            Gb = Gb + hc | 0;
            Fb = Fb + ((Bb >>> 19 | Cb << 13) ^ (Bb << 3 | Cb >>> 29) ^ Bb >>> 6) + (Gb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 365543100 + Gb | 0;
            fc = 1017036298 + Fb + (gc >>> 0 < Gb >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            Ib = Ib + ub | 0;
            Hb = Hb + tb + (Ib >>> 0 < ub >>> 0 ? 1 : 0) | 0;
            hc = (Kb >>> 1 | Jb << 31) ^ (Kb >>> 8 | Jb << 24) ^ (Kb >>> 7 | Jb << 25) | 0;
            Ib = Ib + hc | 0;
            Hb = Hb + ((Jb >>> 1 | Kb << 31) ^ (Jb >>> 8 | Kb << 24) ^ Jb >>> 7) + (Ib >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = (Eb >>> 19 | Db << 13) ^ (Eb << 3 | Db >>> 29) ^ (Eb >>> 6 | Db << 26) | 0;
            Ib = Ib + hc | 0;
            Hb = Hb + ((Db >>> 19 | Eb << 13) ^ (Db << 3 | Eb >>> 29) ^ Db >>> 6) + (Ib >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 2618297676 + Ib | 0;
            fc = 1126000580 + Hb + (gc >>> 0 < Ib >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            Kb = Kb + wb | 0;
            Jb = Jb + vb + (Kb >>> 0 < wb >>> 0 ? 1 : 0) | 0;
            hc = (Mb >>> 1 | Lb << 31) ^ (Mb >>> 8 | Lb << 24) ^ (Mb >>> 7 | Lb << 25) | 0;
            Kb = Kb + hc | 0;
            Jb = Jb + ((Lb >>> 1 | Mb << 31) ^ (Lb >>> 8 | Mb << 24) ^ Lb >>> 7) + (Kb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = (Gb >>> 19 | Fb << 13) ^ (Gb << 3 | Fb >>> 29) ^ (Gb >>> 6 | Fb << 26) | 0;
            Kb = Kb + hc | 0;
            Jb = Jb + ((Fb >>> 19 | Gb << 13) ^ (Fb << 3 | Gb >>> 29) ^ Fb >>> 6) + (Kb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 3409855158 + Kb | 0;
            fc = 1288033470 + Jb + (gc >>> 0 < Kb >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            Mb = Mb + yb | 0;
            Lb = Lb + xb + (Mb >>> 0 < yb >>> 0 ? 1 : 0) | 0;
            hc = (Ob >>> 1 | Nb << 31) ^ (Ob >>> 8 | Nb << 24) ^ (Ob >>> 7 | Nb << 25) | 0;
            Mb = Mb + hc | 0;
            Lb = Lb + ((Nb >>> 1 | Ob << 31) ^ (Nb >>> 8 | Ob << 24) ^ Nb >>> 7) + (Mb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = (Ib >>> 19 | Hb << 13) ^ (Ib << 3 | Hb >>> 29) ^ (Ib >>> 6 | Hb << 26) | 0;
            Mb = Mb + hc | 0;
            Lb = Lb + ((Hb >>> 19 | Ib << 13) ^ (Hb << 3 | Ib >>> 29) ^ Hb >>> 6) + (Mb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 4234509866 + Mb | 0;
            fc = 1501505948 + Lb + (gc >>> 0 < Mb >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            Ob = Ob + Ab | 0;
            Nb = Nb + zb + (Ob >>> 0 < Ab >>> 0 ? 1 : 0) | 0;
            hc = (Qb >>> 1 | Pb << 31) ^ (Qb >>> 8 | Pb << 24) ^ (Qb >>> 7 | Pb << 25) | 0;
            Ob = Ob + hc | 0;
            Nb = Nb + ((Pb >>> 1 | Qb << 31) ^ (Pb >>> 8 | Qb << 24) ^ Pb >>> 7) + (Ob >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = (Kb >>> 19 | Jb << 13) ^ (Kb << 3 | Jb >>> 29) ^ (Kb >>> 6 | Jb << 26) | 0;
            Ob = Ob + hc | 0;
            Nb = Nb + ((Jb >>> 19 | Kb << 13) ^ (Jb << 3 | Kb >>> 29) ^ Jb >>> 6) + (Ob >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 987167468 + Ob | 0;
            fc = 1607167915 + Nb + (gc >>> 0 < Ob >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            Qb = Qb + Cb | 0;
            Pb = Pb + Bb + (Qb >>> 0 < Cb >>> 0 ? 1 : 0) | 0;
            hc = (mb >>> 1 | lb << 31) ^ (mb >>> 8 | lb << 24) ^ (mb >>> 7 | lb << 25) | 0;
            Qb = Qb + hc | 0;
            Pb = Pb + ((lb >>> 1 | mb << 31) ^ (lb >>> 8 | mb << 24) ^ lb >>> 7) + (Qb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = (Mb >>> 19 | Lb << 13) ^ (Mb << 3 | Lb >>> 29) ^ (Mb >>> 6 | Lb << 26) | 0;
            Qb = Qb + hc | 0;
            Pb = Pb + ((Lb >>> 19 | Mb << 13) ^ (Lb << 3 | Mb >>> 29) ^ Lb >>> 6) + (Qb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            gc = 1246189591 + Qb | 0;
            fc = 1816402316 + Pb + (gc >>> 0 < Qb >>> 0 ? 1 : 0) | 0;
            gc = gc + ec | 0;
            fc = fc + dc + (gc >>> 0 < ec >>> 0 ? 1 : 0) | 0;
            hc = ($b >>> 14 | Zb << 18) ^ ($b >>> 18 | Zb << 14) ^ ($b << 23 | Zb >>> 9) | 0;
            gc = gc + hc | 0;
            fc = fc + ((Zb >>> 14 | $b << 18) ^ (Zb >>> 18 | $b << 14) ^ (Zb << 23 | $b >>> 9)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            hc = cc ^ $b & (ac ^ cc) | 0;
            gc = gc + hc | 0;
            fc = fc + (bc ^ Zb & (_b ^ bc)) + (gc >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            ec = cc;
            dc = bc;
            cc = ac;
            bc = _b;
            ac = $b;
            _b = Zb;
            $b = Yb + gc | 0;
            Zb = Xb + fc + ($b >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            Yb = Wb;
            Xb = Vb;
            Wb = Ub;
            Vb = Tb;
            Ub = Sb;
            Tb = Rb;
            Sb = gc + (Ub & Wb ^ Yb & (Ub ^ Wb)) | 0;
            Rb = fc + (Tb & Vb ^ Xb & (Tb ^ Vb)) + (Sb >>> 0 < gc >>> 0 ? 1 : 0) | 0;
            hc = (Ub >>> 28 | Tb << 4) ^ (Ub << 30 | Tb >>> 2) ^ (Ub << 25 | Tb >>> 7) | 0;
            Sb = Sb + hc | 0;
            Rb = Rb + ((Tb >>> 28 | Ub << 4) ^ (Tb << 30 | Ub >>> 2) ^ (Tb << 25 | Ub >>> 7)) + (Sb >>> 0 < hc >>> 0 ? 1 : 0) | 0;
            e = e + Sb | 0;
            d = d + Rb + (e >>> 0 < Sb >>> 0 ? 1 : 0) | 0;
            g = g + Ub | 0;
            f = f + Tb + (g >>> 0 < Ub >>> 0 ? 1 : 0) | 0;
            i = i + Wb | 0;
            h = h + Vb + (i >>> 0 < Wb >>> 0 ? 1 : 0) | 0;
            k = k + Yb | 0;
            j = j + Xb + (k >>> 0 < Yb >>> 0 ? 1 : 0) | 0;
            m = m + $b | 0;
            l = l + Zb + (m >>> 0 < $b >>> 0 ? 1 : 0) | 0;
            o = o + ac | 0;
            n = n + _b + (o >>> 0 < ac >>> 0 ? 1 : 0) | 0;
            q = q + cc | 0;
            p = p + bc + (q >>> 0 < cc >>> 0 ? 1 : 0) | 0;
            s = s + ec | 0;
            r = r + dc + (s >>> 0 < ec >>> 0 ? 1 : 0) | 0
        }

        function ab(lb) {
            lb = lb | 0;
            _($[lb | 0] << 24 | $[lb | 1] << 16 | $[lb | 2] << 8 | $[lb | 3], $[lb | 4] << 24 | $[lb | 5] << 16 | $[lb | 6] << 8 | $[lb | 7], $[lb | 8] << 24 | $[lb | 9] << 16 | $[lb | 10] << 8 | $[lb | 11], $[lb | 12] << 24 | $[lb | 13] << 16 | $[lb | 14] << 8 | $[lb | 15], $[lb | 16] << 24 | $[lb | 17] << 16 | $[lb | 18] << 8 | $[lb | 19], $[lb | 20] << 24 | $[lb | 21] << 16 | $[lb | 22] << 8 | $[lb | 23], $[lb | 24] << 24 | $[lb | 25] << 16 | $[lb | 26] << 8 | $[lb | 27], $[lb | 28] << 24 | $[lb | 29] << 16 | $[lb | 30] << 8 | $[lb | 31], $[lb | 32] << 24 | $[lb | 33] << 16 | $[lb | 34] << 8 | $[lb | 35], $[lb | 36] << 24 | $[lb | 37] << 16 | $[lb | 38] << 8 | $[lb | 39], $[lb | 40] << 24 | $[lb | 41] << 16 | $[lb | 42] << 8 | $[lb | 43], $[lb | 44] << 24 | $[lb | 45] << 16 | $[lb | 46] << 8 | $[lb | 47], $[lb | 48] << 24 | $[lb | 49] << 16 | $[lb | 50] << 8 | $[lb | 51], $[lb | 52] << 24 | $[lb | 53] << 16 | $[lb | 54] << 8 | $[lb | 55], $[lb | 56] << 24 | $[lb | 57] << 16 | $[lb | 58] << 8 | $[lb | 59], $[lb | 60] << 24 | $[lb | 61] << 16 | $[lb | 62] << 8 | $[lb | 63], $[lb | 64] << 24 | $[lb | 65] << 16 | $[lb | 66] << 8 | $[lb | 67], $[lb | 68] << 24 | $[lb | 69] << 16 | $[lb | 70] << 8 | $[lb | 71], $[lb | 72] << 24 | $[lb | 73] << 16 | $[lb | 74] << 8 | $[lb | 75], $[lb | 76] << 24 | $[lb | 77] << 16 | $[lb | 78] << 8 | $[lb | 79], $[lb | 80] << 24 | $[lb | 81] << 16 | $[lb | 82] << 8 | $[lb | 83], $[lb | 84] << 24 | $[lb | 85] << 16 | $[lb | 86] << 8 | $[lb | 87], $[lb | 88] << 24 | $[lb | 89] << 16 | $[lb | 90] << 8 | $[lb | 91], $[lb | 92] << 24 | $[lb | 93] << 16 | $[lb | 94] << 8 | $[lb | 95], $[lb | 96] << 24 | $[lb | 97] << 16 | $[lb | 98] << 8 | $[lb | 99], $[lb | 100] << 24 | $[lb | 101] << 16 | $[lb | 102] << 8 | $[lb | 103], $[lb | 104] << 24 | $[lb | 105] << 16 | $[lb | 106] << 8 | $[lb | 107], $[lb | 108] << 24 | $[lb | 109] << 16 | $[lb | 110] << 8 | $[lb | 111], $[lb | 112] << 24 | $[lb | 113] << 16 | $[lb | 114] << 8 | $[lb | 115], $[lb | 116] << 24 | $[lb | 117] << 16 | $[lb | 118] << 8 | $[lb | 119], $[lb | 120] << 24 | $[lb | 121] << 16 | $[lb | 122] << 8 | $[lb | 123], $[lb | 124] << 24 | $[lb | 125] << 16 | $[lb | 126] << 8 | $[lb | 127])
        }

        function bb(lb) {
            lb = lb | 0;
            $[lb | 0] = d >>> 24;
            $[lb | 1] = d >>> 16 & 255;
            $[lb | 2] = d >>> 8 & 255;
            $[lb | 3] = d & 255;
            $[lb | 4] = e >>> 24;
            $[lb | 5] = e >>> 16 & 255;
            $[lb | 6] = e >>> 8 & 255;
            $[lb | 7] = e & 255;
            $[lb | 8] = f >>> 24;
            $[lb | 9] = f >>> 16 & 255;
            $[lb | 10] = f >>> 8 & 255;
            $[lb | 11] = f & 255;
            $[lb | 12] = g >>> 24;
            $[lb | 13] = g >>> 16 & 255;
            $[lb | 14] = g >>> 8 & 255;
            $[lb | 15] = g & 255;
            $[lb | 16] = h >>> 24;
            $[lb | 17] = h >>> 16 & 255;
            $[lb | 18] = h >>> 8 & 255;
            $[lb | 19] = h & 255;
            $[lb | 20] = i >>> 24;
            $[lb | 21] = i >>> 16 & 255;
            $[lb | 22] = i >>> 8 & 255;
            $[lb | 23] = i & 255;
            $[lb | 24] = j >>> 24;
            $[lb | 25] = j >>> 16 & 255;
            $[lb | 26] = j >>> 8 & 255;
            $[lb | 27] = j & 255;
            $[lb | 28] = k >>> 24;
            $[lb | 29] = k >>> 16 & 255;
            $[lb | 30] = k >>> 8 & 255;
            $[lb | 31] = k & 255;
            $[lb | 32] = l >>> 24;
            $[lb | 33] = l >>> 16 & 255;
            $[lb | 34] = l >>> 8 & 255;
            $[lb | 35] = l & 255;
            $[lb | 36] = m >>> 24;
            $[lb | 37] = m >>> 16 & 255;
            $[lb | 38] = m >>> 8 & 255;
            $[lb | 39] = m & 255;
            $[lb | 40] = n >>> 24;
            $[lb | 41] = n >>> 16 & 255;
            $[lb | 42] = n >>> 8 & 255;
            $[lb | 43] = n & 255;
            $[lb | 44] = o >>> 24;
            $[lb | 45] = o >>> 16 & 255;
            $[lb | 46] = o >>> 8 & 255;
            $[lb | 47] = o & 255;
            $[lb | 48] = p >>> 24;
            $[lb | 49] = p >>> 16 & 255;
            $[lb | 50] = p >>> 8 & 255;
            $[lb | 51] = p & 255;
            $[lb | 52] = q >>> 24;
            $[lb | 53] = q >>> 16 & 255;
            $[lb | 54] = q >>> 8 & 255;
            $[lb | 55] = q & 255;
            $[lb | 56] = r >>> 24;
            $[lb | 57] = r >>> 16 & 255;
            $[lb | 58] = r >>> 8 & 255;
            $[lb | 59] = r & 255;
            $[lb | 60] = s >>> 24;
            $[lb | 61] = s >>> 16 & 255;
            $[lb | 62] = s >>> 8 & 255;
            $[lb | 63] = s & 255
        }

        function cb() {
            d = 1779033703;
            e = 4089235720;
            f = 3144134277;
            g = 2227873595;
            h = 1013904242;
            i = 4271175723;
            j = 2773480762;
            k = 1595750129;
            l = 1359893119;
            m = 2917565137;
            n = 2600822924;
            o = 725511199;
            p = 528734635;
            q = 4215389547;
            r = 1541459225;
            s = 327033209;
            t = 0
        }

        function db(lb, mb, nb, ob, pb, qb, rb, sb, tb, ub, vb, wb, xb, yb, zb, Ab, Bb) {
            lb = lb | 0;
            mb = mb | 0;
            nb = nb | 0;
            ob = ob | 0;
            pb = pb | 0;
            qb = qb | 0;
            rb = rb | 0;
            sb = sb | 0;
            tb = tb | 0;
            ub = ub | 0;
            vb = vb | 0;
            wb = wb | 0;
            xb = xb | 0;
            yb = yb | 0;
            zb = zb | 0;
            Ab = Ab | 0;
            Bb = Bb | 0;
            d = lb;
            e = mb;
            f = nb;
            g = ob;
            h = pb;
            i = qb;
            j = rb;
            k = sb;
            l = tb;
            m = ub;
            n = vb;
            o = wb;
            p = xb;
            q = yb;
            r = zb;
            s = Ab;
            t = Bb
        }

        function eb(lb, mb) {
            lb = lb | 0;
            mb = mb | 0;
            var nb = 0;
            if (lb & 127) return -1;
            while ((mb | 0) >= 128) {
                ab(lb);
                lb = lb + 128 | 0;
                mb = mb - 128 | 0;
                nb = nb + 128 | 0
            }
            t = t + nb | 0;
            return nb | 0
        }

        function fb(lb, mb, nb) {
            lb = lb | 0;
            mb = mb | 0;
            nb = nb | 0;
            var ob = 0,
                pb = 0;
            if (lb & 127) return -1;
            if (~nb)
                if (nb & 63) return -1;
            if ((mb | 0) >= 128) {
                ob = eb(lb, mb) | 0;
                if ((ob | 0) == -1) return -1;
                lb = lb + ob | 0;
                mb = mb - ob | 0
            }
            ob = ob + mb | 0;
            t = t + mb | 0;
            $[lb | mb] = 128;
            if ((mb | 0) >= 112) {
                for (pb = mb + 1 | 0;
                    (pb | 0) < 128; pb = pb + 1 | 0) $[lb | pb] = 0;
                ab(lb);
                mb = 0;
                $[lb | 0] = 0
            }
            for (pb = mb + 1 | 0;
                (pb | 0) < 123; pb = pb + 1 | 0) $[lb | pb] = 0;
            $[lb | 123] = t >>> 29;
            $[lb | 124] = t >>> 21 & 255;
            $[lb | 125] = t >>> 13 & 255;
            $[lb | 126] = t >>> 5 & 255;
            $[lb | 127] = t << 3 & 255;
            ab(lb);
            if (~nb) bb(nb);
            return ob | 0
        }

        function gb() {
            d = u;
            e = v;
            f = w;
            g = x;
            h = y;
            i = z;
            j = A;
            k = B;
            l = C;
            m = D;
            n = E;
            o = F;
            p = G;
            q = H;
            r = I;
            s = J;
            t = 128
        }

        function hb() {
            d = K;
            e = L;
            f = M;
            g = N;
            h = O;
            i = P;
            j = Q;
            k = R;
            l = S;
            m = T;
            n = U;
            o = V;
            p = W;
            q = X;
            r = Y;
            s = Z;
            t = 128
        }

        function ib(lb, mb, nb, ob, pb, qb, rb, sb, tb, ub, vb, wb, xb, yb, zb, Ab, Bb, Cb, Db, Eb, Fb, Gb, Hb, Ib, Jb, Kb, Lb, Mb, Nb, Ob, Pb, Qb) {
            lb = lb | 0;
            mb = mb | 0;
            nb = nb | 0;
            ob = ob | 0;
            pb = pb | 0;
            qb = qb | 0;
            rb = rb | 0;
            sb = sb | 0;
            tb = tb | 0;
            ub = ub | 0;
            vb = vb | 0;
            wb = wb | 0;
            xb = xb | 0;
            yb = yb | 0;
            zb = zb | 0;
            Ab = Ab | 0;
            Bb = Bb | 0;
            Cb = Cb | 0;
            Db = Db | 0;
            Eb = Eb | 0;
            Fb = Fb | 0;
            Gb = Gb | 0;
            Hb = Hb | 0;
            Ib = Ib | 0;
            Jb = Jb | 0;
            Kb = Kb | 0;
            Lb = Lb | 0;
            Mb = Mb | 0;
            Nb = Nb | 0;
            Ob = Ob | 0;
            Pb = Pb | 0;
            Qb = Qb | 0;
            cb();
            _(lb ^ 1549556828, mb ^ 1549556828, nb ^ 1549556828, ob ^ 1549556828, pb ^ 1549556828, qb ^ 1549556828, rb ^ 1549556828, sb ^ 1549556828, tb ^ 1549556828, ub ^ 1549556828, vb ^ 1549556828, wb ^ 1549556828, xb ^ 1549556828, yb ^ 1549556828, zb ^ 1549556828, Ab ^ 1549556828, Bb ^ 1549556828, Cb ^ 1549556828, Db ^ 1549556828, Eb ^ 1549556828, Fb ^ 1549556828, Gb ^ 1549556828, Hb ^ 1549556828, Ib ^ 1549556828, Jb ^ 1549556828, Kb ^ 1549556828, Lb ^ 1549556828, Mb ^ 1549556828, Nb ^ 1549556828, Ob ^ 1549556828, Pb ^ 1549556828, Qb ^ 1549556828);
            K = d;
            L = e;
            M = f;
            N = g;
            O = h;
            P = i;
            Q = j;
            R = k;
            S = l;
            T = m;
            U = n;
            V = o;
            W = p;
            X = q;
            Y = r;
            Z = s;
            cb();
            _(lb ^ 909522486, mb ^ 909522486, nb ^ 909522486, ob ^ 909522486, pb ^ 909522486, qb ^ 909522486, rb ^ 909522486, sb ^ 909522486, tb ^ 909522486, ub ^ 909522486, vb ^ 909522486, wb ^ 909522486, xb ^ 909522486, yb ^ 909522486, zb ^ 909522486, Ab ^ 909522486, Bb ^ 909522486, Cb ^ 909522486, Db ^ 909522486, Eb ^ 909522486, Fb ^ 909522486, Gb ^ 909522486, Hb ^ 909522486, Ib ^ 909522486, Jb ^ 909522486, Kb ^ 909522486, Lb ^ 909522486, Mb ^ 909522486, Nb ^ 909522486, Ob ^ 909522486, Pb ^ 909522486, Qb ^ 909522486);
            u = d;
            v = e;
            w = f;
            x = g;
            y = h;
            z = i;
            A = j;
            B = k;
            C = l;
            D = m;
            E = n;
            F = o;
            G = p;
            H = q;
            I = r;
            J = s;
            t = 128
        }

        function jb(lb, mb, nb) {
            lb = lb | 0;
            mb = mb | 0;
            nb = nb | 0;
            var ob = 0,
                pb = 0,
                qb = 0,
                rb = 0,
                sb = 0,
                tb = 0,
                ub = 0,
                vb = 0,
                wb = 0,
                xb = 0,
                yb = 0,
                zb = 0,
                Ab = 0,
                Bb = 0,
                Cb = 0,
                Db = 0,
                Eb = 0;
            if (lb & 127) return -1;
            if (~nb)
                if (nb & 63) return -1;
            Eb = fb(lb, mb, -1) | 0;
            ob = d;
            pb = e;
            qb = f;
            rb = g;
            sb = h;
            tb = i;
            ub = j;
            vb = k;
            wb = l;
            xb = m;
            yb = n;
            zb = o;
            Ab = p;
            Bb = q;
            Cb = r;
            Db = s;
            hb();
            _(ob, pb, qb, rb, sb, tb, ub, vb, wb, xb, yb, zb, Ab, Bb, Cb, Db, 2147483648, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1536);
            if (~nb) bb(nb);
            return Eb | 0
        }

        function kb(lb, mb, nb, ob, pb) {
            lb = lb | 0;
            mb = mb | 0;
            nb = nb | 0;
            ob = ob | 0;
            pb = pb | 0;
            var qb = 0,
                rb = 0,
                sb = 0,
                tb = 0,
                ub = 0,
                vb = 0,
                wb = 0,
                xb = 0,
                yb = 0,
                zb = 0,
                Ab = 0,
                Bb = 0,
                Cb = 0,
                Db = 0,
                Eb = 0,
                Fb = 0,
                Gb = 0,
                Hb = 0,
                Ib = 0,
                Jb = 0,
                Kb = 0,
                Lb = 0,
                Mb = 0,
                Nb = 0,
                Ob = 0,
                Pb = 0,
                Qb = 0,
                Rb = 0,
                Sb = 0,
                Tb = 0,
                Ub = 0,
                Vb = 0;
            if (lb & 127) return -1;
            if (~pb)
                if (pb & 63) return -1;
            $[lb + mb | 0] = nb >>> 24;
            $[lb + mb + 1 | 0] = nb >>> 16 & 255;
            $[lb + mb + 2 | 0] = nb >>> 8 & 255;
            $[lb + mb + 3 | 0] = nb & 255;
            jb(lb, mb + 4 | 0, -1) | 0;
            qb = Gb = d;
            rb = Hb = e;
            sb = Ib = f;
            tb = Jb = g;
            ub = Kb = h;
            vb = Lb = i;
            wb = Mb = j;
            xb = Nb = k;
            yb = Ob = l;
            zb = Pb = m;
            Ab = Qb = n;
            Bb = Rb = o;
            Cb = Sb = p;
            Db = Tb = q;
            Eb = Ub = r;
            Fb = Vb = s;
            ob = ob - 1 | 0;
            while ((ob | 0) > 0) {
                gb();
                _(Gb, Hb, Ib, Jb, Kb, Lb, Mb, Nb, Ob, Pb, Qb, Rb, Sb, Tb, Ub, Vb, 2147483648, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1536);
                Gb = d;
                Hb = e;
                Ib = f;
                Jb = g;
                Kb = h;
                Lb = i;
                Mb = j;
                Nb = k;
                Ob = l;
                Pb = m;
                Qb = n;
                Rb = o;
                Sb = p;
                Tb = q;
                Ub = r;
                Vb = s;
                hb();
                _(Gb, Hb, Ib, Jb, Kb, Lb, Mb, Nb, Ob, Pb, Qb, Rb, Sb, Tb, Ub, Vb, 2147483648, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1536);
                Gb = d;
                Hb = e;
                Ib = f;
                Jb = g;
                Kb = h;
                Lb = i;
                Mb = j;
                Nb = k;
                Ob = l;
                Pb = m;
                Qb = n;
                Rb = o;
                Sb = p;
                Tb = q;
                Ub = r;
                Vb = s;
                qb = qb ^ d;
                rb = rb ^ e;
                sb = sb ^ f;
                tb = tb ^ g;
                ub = ub ^ h;
                vb = vb ^ i;
                wb = wb ^ j;
                xb = xb ^ k;
                yb = yb ^ l;
                zb = zb ^ m;
                Ab = Ab ^ n;
                Bb = Bb ^ o;
                Cb = Cb ^ p;
                Db = Db ^ q;
                Eb = Eb ^ r;
                Fb = Fb ^ s;
                ob = ob - 1 | 0
            }
            d = qb;
            e = rb;
            f = sb;
            g = tb;
            h = ub;
            i = vb;
            j = wb;
            k = xb;
            l = yb;
            m = zb;
            n = Ab;
            o = Bb;
            p = Cb;
            q = Db;
            r = Eb;
            s = Fb;
            if (~pb) bb(pb);
            return 0
        }
        return {
            reset: cb,
            init: db,
            process: eb,
            finish: fb,
            hmac_reset: gb,
            hmac_init: ib,
            hmac_finish: jb,
            pbkdf2_generate_block: kb
        }
    }

    function Ab(a) {
        if (a = a || {}, a.heapSize = a.heapSize || 4096, a.heapSize <= 0 || a.heapSize % 4096) throw new d('heapSize must be a positive number and multiple of 4096');
        this.heap = a.heap || new Uint8Array(a.heapSize),
        this.asm = a.asm || zb(b, null, this.heap.buffer),
        this.BLOCK_SIZE = zd,
        this.HASH_SIZE = Ad,
        this.reset()
    }

    function Bb() {
        return this.result = null,
            this.pos = 0,
            this.len = 0,
            this.asm.reset(),
            this
    }

    function Cb(a) {
        if (null !== this.result) throw new c('state must be reset before processing new data');
        var b = 0,
            d = 0,
            e = 0;
        if (o(a) || p(a)) b = a.byteOffset || 0,
            d = a.byteLength;
        else {
            if (!n(a)) throw new TypeError('data isn\'t of expected type');
            d = a.length
        }
        for (; d > 0;) {
            if (e = this.heap.byteLength - this.pos - this.len, e = d > e ? e : d, o(a) || p(a)) this.heap.set(new Uint8Array(a.buffer || a, b, e), this.pos + this.len);
            else
                for (var f = 0; e > f; f++) this.heap[this.pos + this.len + f] = a.charCodeAt(b + f);
            this.len += e,
            b += e,
            d -= e,
            e = this.asm.process(this.pos, this.len),
            e < this.len ? (this.pos += e, this.len -= e) : (this.pos = 0, this.len = 0)
        }
        return this
    }

    function Db() {
        if (null !== this.result) throw new c('state must be reset before processing new data');
        return this.asm.finish(this.pos, this.len, 0),
            this.result = new Uint8Array(Ad),
            this.result.set(this.heap.subarray(0, Ad)),
            this.pos = 0,
            this.len = 0,
            this
    }

    function Eb() {
        return null === Cd && (Cd = new Ab({
                heapSize: 1048576
            })),
            Cd
    }

    function Fb(a) {
        if (void 0 === a) throw new SyntaxError('data required');
        return Eb().reset().process(a).finish().result
    }

    function Gb(a) {
        var b = Fb(a);
        return j(b)
    }

    function Hb(a) {
        var b = Fb(a);
        return k(b)
    }

    function Ib(a) {
        if (a = a || {}, !a.hash) throw new SyntaxError('option \'hash\' is required');
        if (!a.hash.HASH_SIZE) throw new SyntaxError('option \'hash\' supplied doesn\'t seem to be a valid hash function');
        return this.hash = a.hash,
            this.BLOCK_SIZE = this.hash.BLOCK_SIZE,
            this.HMAC_SIZE = this.hash.HASH_SIZE,
            this.key = null,
            this.verify = null,
            this.result = null, (void 0 !== a.password || void 0 !== a.verify) && this.reset(a),
            this
    }

    function Jb(a, b) {
        var c;
        if (o(b) || p(b)) c = new Uint8Array(a.BLOCK_SIZE),
            c.set(b.byteLength > a.BLOCK_SIZE ? new Uint8Array(a.reset().process(b).finish().result) : o(b) ? new Uint8Array(b) : b);
        else {
            if (!n(b)) throw new TypeError('password isn\'t of expected type');
            if (c = new Uint8Array(a.BLOCK_SIZE), b.length > a.BLOCK_SIZE) c.set(new Uint8Array(a.reset().process(b).finish().result));
            else
                for (var d = 0; d < b.length; ++d) c[d] = b.charCodeAt(d)
        }
        return c
    }

    function Kb(a) {
        if (o(a) || p(a)) a = new Uint8Array(a);
        else {
            if (!n(a)) throw new TypeError('verify tag isn\'t of expected type');
            a = f(a)
        }
        if (a.length !== this.HMAC_SIZE) throw new d('illegal verification tag size');
        this.verify = a
    }

    function Lb(a) {
        a = a || {};
        var b = a.password;
        if (null === this.key && !n(b) && !b) throw new c('no key is associated with the instance');
        this.result = null,
        this.hash.reset(), (b || n(b)) && (this.key = Jb(this.hash, b));
        for (var d = new Uint8Array(this.key), e = 0; e < d.length; ++e) d[e] ^= 54;
        this.hash.process(d);
        var f = a.verify;
        return void 0 !== f ? Kb.call(this, f) : this.verify = null,
            this
    }

    function Mb(a) {
        if (null === this.key) throw new c('no key is associated with the instance');
        if (null !== this.result) throw new c('state must be reset before processing new data');
        return this.hash.process(a),
            this
    }

    function Nb() {
        if (null === this.key) throw new c('no key is associated with the instance');
        if (null !== this.result) throw new c('state must be reset before processing new data');
        for (var a = this.hash.finish().result, b = new Uint8Array(this.key), d = 0; d < b.length; ++d) b[d] ^= 92;
        var e = this.verify,
            f = this.hash.reset().process(b).process(a).finish().result;
        if (e)
            if (e.length === f.length) {
                for (var g = 0, d = 0; d < e.length; d++) g |= e[d] ^ f[d];
                this.result = !g
            } else this.result = !1;
        else this.result = f;
        return this
    }

    function Ob(a) {
        return a = a || {},
            a.hash instanceof ib || (a.hash = mb()),
            Ib.call(this, a),
            this
    }

    function Pb(a) {
        a = a || {};
        var b = a.password;
        if (null === this.key && !n(b) && !b) throw new c('no key is associated with the instance');
        if (this.result = null, this.hash.reset(), b || n(b)) {
            var d = this.key = Jb(this.hash, b);
            this.hash.reset().asm.hmac_init(d[0] << 24 | d[1] << 16 | d[2] << 8 | d[3], d[4] << 24 | d[5] << 16 | d[6] << 8 | d[7], d[8] << 24 | d[9] << 16 | d[10] << 8 | d[11], d[12] << 24 | d[13] << 16 | d[14] << 8 | d[15], d[16] << 24 | d[17] << 16 | d[18] << 8 | d[19], d[20] << 24 | d[21] << 16 | d[22] << 8 | d[23], d[24] << 24 | d[25] << 16 | d[26] << 8 | d[27], d[28] << 24 | d[29] << 16 | d[30] << 8 | d[31], d[32] << 24 | d[33] << 16 | d[34] << 8 | d[35], d[36] << 24 | d[37] << 16 | d[38] << 8 | d[39], d[40] << 24 | d[41] << 16 | d[42] << 8 | d[43], d[44] << 24 | d[45] << 16 | d[46] << 8 | d[47], d[48] << 24 | d[49] << 16 | d[50] << 8 | d[51], d[52] << 24 | d[53] << 16 | d[54] << 8 | d[55], d[56] << 24 | d[57] << 16 | d[58] << 8 | d[59], d[60] << 24 | d[61] << 16 | d[62] << 8 | d[63])
        } else this.hash.asm.hmac_reset();
        var e = a.verify;
        return void 0 !== e ? Kb.call(this, e) : this.verify = null,
            this
    }

    function Qb() {
        if (null === this.key) throw new c('no key is associated with the instance');
        if (null !== this.result) throw new c('state must be reset before processing new data');
        var a = this.hash,
            b = this.hash.asm,
            d = this.hash.heap;
        b.hmac_finish(a.pos, a.len, 0);
        var e = this.verify,
            f = new Uint8Array(sd);
        if (f.set(d.subarray(0, sd)), e)
            if (e.length === f.length) {
                for (var g = 0, h = 0; h < e.length; h++) g |= e[h] ^ f[h];
                this.result = !g
            } else this.result = !1;
        else this.result = f;
        return this
    }

    function Rb() {
        return null === Fd && (Fd = new Ob),
            Fd
    }

    function Sb(a) {
        return a = a || {},
            a.hash instanceof rb || (a.hash = vb()),
            Ib.call(this, a),
            this
    }

    function Tb(a) {
        a = a || {};
        var b = a.password;
        if (null === this.key && !n(b) && !b) throw new c('no key is associated with the instance');
        if (this.result = null, this.hash.reset(), b || n(b)) {
            var d = this.key = Jb(this.hash, b);
            this.hash.reset().asm.hmac_init(d[0] << 24 | d[1] << 16 | d[2] << 8 | d[3], d[4] << 24 | d[5] << 16 | d[6] << 8 | d[7], d[8] << 24 | d[9] << 16 | d[10] << 8 | d[11], d[12] << 24 | d[13] << 16 | d[14] << 8 | d[15], d[16] << 24 | d[17] << 16 | d[18] << 8 | d[19], d[20] << 24 | d[21] << 16 | d[22] << 8 | d[23], d[24] << 24 | d[25] << 16 | d[26] << 8 | d[27], d[28] << 24 | d[29] << 16 | d[30] << 8 | d[31], d[32] << 24 | d[33] << 16 | d[34] << 8 | d[35], d[36] << 24 | d[37] << 16 | d[38] << 8 | d[39], d[40] << 24 | d[41] << 16 | d[42] << 8 | d[43], d[44] << 24 | d[45] << 16 | d[46] << 8 | d[47], d[48] << 24 | d[49] << 16 | d[50] << 8 | d[51], d[52] << 24 | d[53] << 16 | d[54] << 8 | d[55], d[56] << 24 | d[57] << 16 | d[58] << 8 | d[59], d[60] << 24 | d[61] << 16 | d[62] << 8 | d[63])
        } else this.hash.asm.hmac_reset();
        var e = a.verify;
        return void 0 !== e ? Kb.call(this, e) : this.verify = null,
            this
    }

    function Ub() {
        if (null === this.key) throw new c('no key is associated with the instance');
        if (null !== this.result) throw new c('state must be reset before processing new data');
        var a = this.hash,
            b = this.hash.asm,
            d = this.hash.heap;
        b.hmac_finish(a.pos, a.len, 0);
        var e = this.verify,
            f = new Uint8Array(wd);
        if (f.set(d.subarray(0, wd)), e)
            if (e.length === f.length) {
                for (var g = 0, h = 0; h < e.length; h++) g |= e[h] ^ f[h];
                this.result = !g
            } else this.result = !1;
        else this.result = f;
        return this
    }

    function Vb() {
        return null === Hd && (Hd = new Sb),
            Hd
    }

    function Wb(a) {
        return a = a || {},
            a.hash instanceof Ab || (a.hash = Eb()),
            Ib.call(this, a),
            this
    }

    function Xb(a) {
        a = a || {};
        var b = a.password;
        if (null === this.key && !n(b) && !b) throw new c('no key is associated with the instance');
        if (this.result = null, this.hash.reset(), b || n(b)) {
            var d = this.key = Jb(this.hash, b);
            this.hash.reset().asm.hmac_init(d[0] << 24 | d[1] << 16 | d[2] << 8 | d[3], d[4] << 24 | d[5] << 16 | d[6] << 8 | d[7], d[8] << 24 | d[9] << 16 | d[10] << 8 | d[11], d[12] << 24 | d[13] << 16 | d[14] << 8 | d[15], d[16] << 24 | d[17] << 16 | d[18] << 8 | d[19], d[20] << 24 | d[21] << 16 | d[22] << 8 | d[23], d[24] << 24 | d[25] << 16 | d[26] << 8 | d[27], d[28] << 24 | d[29] << 16 | d[30] << 8 | d[31], d[32] << 24 | d[33] << 16 | d[34] << 8 | d[35], d[36] << 24 | d[37] << 16 | d[38] << 8 | d[39], d[40] << 24 | d[41] << 16 | d[42] << 8 | d[43], d[44] << 24 | d[45] << 16 | d[46] << 8 | d[47], d[48] << 24 | d[49] << 16 | d[50] << 8 | d[51], d[52] << 24 | d[53] << 16 | d[54] << 8 | d[55], d[56] << 24 | d[57] << 16 | d[58] << 8 | d[59], d[60] << 24 | d[61] << 16 | d[62] << 8 | d[63], d[64] << 24 | d[65] << 16 | d[66] << 8 | d[67], d[68] << 24 | d[69] << 16 | d[70] << 8 | d[71], d[72] << 24 | d[73] << 16 | d[74] << 8 | d[75], d[76] << 24 | d[77] << 16 | d[78] << 8 | d[79], d[80] << 24 | d[81] << 16 | d[82] << 8 | d[83], d[84] << 24 | d[85] << 16 | d[86] << 8 | d[87], d[88] << 24 | d[89] << 16 | d[90] << 8 | d[91], d[92] << 24 | d[93] << 16 | d[94] << 8 | d[95], d[96] << 24 | d[97] << 16 | d[98] << 8 | d[99], d[100] << 24 | d[101] << 16 | d[102] << 8 | d[103], d[104] << 24 | d[105] << 16 | d[106] << 8 | d[107], d[108] << 24 | d[109] << 16 | d[110] << 8 | d[111], d[112] << 24 | d[113] << 16 | d[114] << 8 | d[115], d[116] << 24 | d[117] << 16 | d[118] << 8 | d[119], d[120] << 24 | d[121] << 16 | d[122] << 8 | d[123], d[124] << 24 | d[125] << 16 | d[126] << 8 | d[127])
        } else this.hash.asm.hmac_reset();
        var e = a.verify;
        return void 0 !== e ? Kb.call(this, e) : this.verify = null,
            this
    }

    function Yb() {
        if (null === this.key) throw new c('no key is associated with the instance');
        if (null !== this.result) throw new c('state must be reset before processing new data');
        var a = this.hash,
            b = this.hash.asm,
            d = this.hash.heap;
        b.hmac_finish(a.pos, a.len, 0);
        var e = this.verify,
            f = new Uint8Array(Ad);
        if (f.set(d.subarray(0, Ad)), e)
            if (e.length === f.length) {
                for (var g = 0, h = 0; h < e.length; h++) g |= e[h] ^ f[h];
                this.result = !g
            } else this.result = !1;
        else this.result = f;
        return this
    }

    function Zb() {
        return null === Jd && (Jd = new Wb),
            Jd
    }

    function $b(a, b) {
        if (void 0 === a) throw new SyntaxError('data required');
        if (void 0 === b) throw new SyntaxError('password required');
        return Rb().reset({
            password: b
        }).process(a).finish().result
    }

    function _b(a, b) {
        var c = $b(a, b);
        return j(c)
    }

    function ac(a, b) {
        var c = $b(a, b);
        return k(c)
    }

    function bc(a, b) {
        if (void 0 === a) throw new SyntaxError('data required');
        if (void 0 === b) throw new SyntaxError('password required');
        return Vb().reset({
            password: b
        }).process(a).finish().result
    }

    function cc(a, b) {
        var c = bc(a, b);
        return j(c)
    }

    function dc(a, b) {
        var c = bc(a, b);
        return k(c)
    }

    function ec(a, b) {
        if (void 0 === a) throw new SyntaxError('data required');
        if (void 0 === b) throw new SyntaxError('password required');
        return Zb().reset({
            password: b
        }).process(a).finish().result
    }

    function fc(a, b) {
        var c = ec(a, b);
        return j(c)
    }

    function gc(a, b) {
        var c = ec(a, b);
        return k(c)
    }

    function hc(a) {
        if (a = a || {}, !a.hmac) throw new SyntaxError('option \'hmac\' is required');
        if (!a.hmac.HMAC_SIZE) throw new SyntaxError('option \'hmac\' supplied doesn\'t seem to be a valid HMAC function');
        this.hmac = a.hmac,
        this.count = a.count || 4096,
        this.length = a.length || this.hmac.HMAC_SIZE,
        this.result = null;
        var b = a.password;
        return (b || n(b)) && this.reset(a),
            this
    }

    function ic(a) {
        return this.result = null,
            this.hmac.reset(a),
            this
    }

    function jc(a, b, e) {
        if (null !== this.result) throw new c('state must be reset before processing new data');
        if (!a && !n(a)) throw new d('bad \'salt\' value');
        b = b || this.count,
        e = e || this.length,
        this.result = new Uint8Array(e);
        for (var f = Math.ceil(e / this.hmac.HMAC_SIZE), g = 1; f >= g; ++g) {
            var h = (g - 1) * this.hmac.HMAC_SIZE,
                i = (f > g ? 0 : e % this.hmac.HMAC_SIZE) || this.hmac.HMAC_SIZE,
                j = new Uint8Array(this.hmac.reset().process(a).process(new Uint8Array([g >>> 24 & 255,
                    g >>> 16 & 255,
                    g >>> 8 & 255,
                    255 & g
                ])).finish().result);
            this.result.set(j.subarray(0, i), h);
            for (var k = 1; b > k; ++k) {
                j = new Uint8Array(this.hmac.reset().process(j).finish().result);
                for (var l = 0; i > l; ++l) this.result[h + l] ^= j[l]
            }
        }
        return this
    }

    function kc(a) {
        return a = a || {},
            a.hmac instanceof Sb || (a.hmac = Vb()),
            hc.call(this, a),
            this
    }

    function lc(a, b, e) {
        if (null !== this.result) throw new c('state must be reset before processing new data');
        if (!a && !n(a)) throw new d('bad \'salt\' value');
        b = b || this.count,
        e = e || this.length,
        this.result = new Uint8Array(e);
        for (var f = Math.ceil(e / this.hmac.HMAC_SIZE), g = 1; f >= g; ++g) {
            var h = (g - 1) * this.hmac.HMAC_SIZE,
                i = (f > g ? 0 : e % this.hmac.HMAC_SIZE) || this.hmac.HMAC_SIZE;
            this.hmac.reset().process(a),
            this.hmac.hash.asm.pbkdf2_generate_block(this.hmac.hash.pos, this.hmac.hash.len, g, b, 0),
            this.result.set(this.hmac.hash.heap.subarray(0, i), h)
        }
        return this
    }

    function mc() {
        return null === Nd && (Nd = new kc),
            Nd
    }

    function nc() {
        if (void 0 !== Td) d = new Uint8Array(32),
            Md.call(Td, d),
            Wd(d);
        else {
            var a,
                c,
                d = new $c(3);
            d[0] = Rd(),
            d[1] = Qd(),
            d[2] = Ud(),
            d = new Uint8Array(d.buffer);
            var e = mc();
            for (a = 0; 100 > a; a++) d = e.reset({
                    password: d
                }).generate(b.location.href, 1000, 32).result,
                c = Ud(),
                d[0] ^= c >>> 24,
                d[1] ^= c >>> 16,
                d[2] ^= c >>> 8,
                d[3] ^= c;
            Wd(d)
        }
        Xd = 0,
        Yd = !0
    }

    function oc(a) {
        if (!o(a) && !q(a)) throw new TypeError('bad seed type');
        var b = a.byteOffest || 0,
            c = a.byteLength || a.length,
            d = new Uint8Array(a.buffer || a, b, c);
        Wd(d),
        Xd = 0;
        for (var e = 0, f = 0; f < d.length; f++) e |= d[f],
            d[f] = 0;
        return 0 !== e && ($d += 4 * c),
            Zd = $d >= _d
    }

    function pc(a) {
        if (Yd || nc(), !Zd && void 0 === Td) {
            if (!ae) throw new e('No strong PRNGs available. Use asmCrypto.random.seed().');
            void 0 !== Pd && Pd.error('No strong PRNGs available; your security is greatly lowered. Use asmCrypto.random.seed().')
        }
        if (!be && !Zd && void 0 !== Td && void 0 !== Pd) {
            var b = (new Error).stack;
            ce[b] |= 0,
            ce[b]++ || Pd.warn('asmCrypto PRNG not seeded; your security relies on your system PRNG. If this is not acceptable, use asmCrypto.random.seed().')
        }
        if (!o(a) && !q(a)) throw new TypeError('unexpected buffer type');
        var c,
            d,
            f = a.byteOffset || 0,
            g = a.byteLength || a.length,
            h = new Uint8Array(a.buffer || a, f, g);
        for (void 0 !== Td && Md.call(Td, h), c = 0; g > c; c++) 0 === (3 & c) && (Xd >= 1099511627776 && nc(), d = Vd(), Xd++),
            h[c] ^= d,
            d >>>= 8
    }

    function qc() {
        (!Yd || Xd >= 1099511627776) && nc();
        var a = (1048576 * Vd() + (Vd() >>> 12)) / 4503599627370496;
        return Xd += 2,
            a
    }

    function rc(a, b) {
        return a * b | 0
    }

    function sc(a, b, c) {
        'use asm';
        var d = 0;
        var e = new a.Uint32Array(c);
        var f = a.Math.imul;

        function g(u) {
            u = u | 0;
            d = u = u + 31 & -32;
            return u | 0
        }

        function h(u) {
            u = u | 0;
            var v = 0;
            v = d;
            d = v + (u + 31 & -32) | 0;
            return v | 0
        }

        function i(u) {
            u = u | 0;
            d = d - (u + 31 & -32) | 0
        }

        function j(u, v, w) {
            u = u | 0;
            v = v | 0;
            w = w | 0;
            var x = 0;
            if ((v | 0) > (w | 0)) {
                for (;
                    (x | 0) < (u | 0); x = x + 4 | 0) {
                    e[w + x >> 2] = e[v + x >> 2]
                }
            } else {
                for (x = u - 4 | 0;
                    (x | 0) >= 0; x = x - 4 | 0) {
                    e[w + x >> 2] = e[v + x >> 2]
                }
            }
        }

        function k(u, v, w) {
            u = u | 0;
            v = v | 0;
            w = w | 0;
            var x = 0;
            for (;
                (x | 0) < (u | 0); x = x + 4 | 0) {
                e[w + x >> 2] = v
            }
        }

        function l(u, v, w, x) {
            u = u | 0;
            v = v | 0;
            w = w | 0;
            x = x | 0;
            var y = 0,
                z = 0,
                A = 0,
                B = 0,
                C = 0;
            if ((x | 0) <= 0) x = v;
            if ((x | 0) < (v | 0)) v = x;
            z = 1;
            for (;
                (C | 0) < (v | 0); C = C + 4 | 0) {
                y = ~e[u + C >> 2];
                A = (y & 65535) + z | 0;
                B = (y >>> 16) + (A >>> 16) | 0;
                e[w + C >> 2] = B << 16 | A & 65535;
                z = B >>> 16
            }
            for (;
                (C | 0) < (x | 0); C = C + 4 | 0) {
                e[w + C >> 2] = z - 1 | 0
            }
            return z | 0
        }

        function m(u, v, w, x) {
            u = u | 0;
            v = v | 0;
            w = w | 0;
            x = x | 0;
            var y = 0,
                z = 0,
                A = 0;
            if ((v | 0) > (x | 0)) {
                for (A = v - 4 | 0;
                    (A | 0) >= (x | 0); A = A - 4 | 0) {
                    if (e[u + A >> 2] | 0) return 1
                }
            } else {
                for (A = x - 4 | 0;
                    (A | 0) >= (v | 0); A = A - 4 | 0) {
                    if (e[w + A >> 2] | 0) return -1
                }
            }
            for (;
                (A | 0) >= 0; A = A - 4 | 0) {
                y = e[u + A >> 2] | 0,
                z = e[w + A >> 2] | 0;
                if (y >>> 0 < z >>> 0) return -1;
                if (y >>> 0 > z >>> 0) return 1
            }
            return 0
        }

        function n(u, v) {
            u = u | 0;
            v = v | 0;
            var w = 0;
            for (w = v - 4 | 0;
                (w | 0) >= 0; w = w - 4 | 0) {
                if (e[u + w >> 2] | 0) return w + 4 | 0
            }
            return 0
        }

        function o(u, v, w, x, y, z) {
            u = u | 0;
            v = v | 0;
            w = w | 0;
            x = x | 0;
            y = y | 0;
            z = z | 0;
            var A = 0,
                B = 0,
                C = 0,
                D = 0,
                E = 0,
                F = 0;
            if ((v | 0) < (x | 0)) {
                D = u,
                u = w,
                w = D;
                D = v,
                v = x,
                x = D
            }
            if ((z | 0) <= 0) z = v + 4 | 0;
            if ((z | 0) < (x | 0)) v = x = z;
            for (;
                (F | 0) < (x | 0); F = F + 4 | 0) {
                A = e[u + F >> 2] | 0;
                B = e[w + F >> 2] | 0;
                D = ((A & 65535) + (B & 65535) | 0) + C | 0;
                E = ((A >>> 16) + (B >>> 16) | 0) + (D >>> 16) | 0;
                e[y + F >> 2] = D & 65535 | E << 16;
                C = E >>> 16
            }
            for (;
                (F | 0) < (v | 0); F = F + 4 | 0) {
                A = e[u + F >> 2] | 0;
                D = (A & 65535) + C | 0;
                E = (A >>> 16) + (D >>> 16) | 0;
                e[y + F >> 2] = D & 65535 | E << 16;
                C = E >>> 16
            }
            for (;
                (F | 0) < (z | 0); F = F + 4 | 0) {
                e[y + F >> 2] = C | 0;
                C = 0
            }
            return C | 0
        }

        function p(u, v, w, x, y, z) {
            u = u | 0;
            v = v | 0;
            w = w | 0;
            x = x | 0;
            y = y | 0;
            z = z | 0;
            var A = 0,
                B = 0,
                C = 0,
                D = 0,
                E = 0,
                F = 0;
            if ((z | 0) <= 0) z = (v | 0) > (x | 0) ? v + 4 | 0 : x + 4 | 0;
            if ((z | 0) < (v | 0)) v = z;
            if ((z | 0) < (x | 0)) x = z;
            if ((v | 0) < (x | 0)) {
                for (;
                    (F | 0) < (v | 0); F = F + 4 | 0) {
                    A = e[u + F >> 2] | 0;
                    B = e[w + F >> 2] | 0;
                    D = ((A & 65535) - (B & 65535) | 0) + C | 0;
                    E = ((A >>> 16) - (B >>> 16) | 0) + (D >> 16) | 0;
                    e[y + F >> 2] = D & 65535 | E << 16;
                    C = E >> 16
                }
                for (;
                    (F | 0) < (x | 0); F = F + 4 | 0) {
                    B = e[w + F >> 2] | 0;
                    D = C - (B & 65535) | 0;
                    E = (D >> 16) - (B >>> 16) | 0;
                    e[y + F >> 2] = D & 65535 | E << 16;
                    C = E >> 16
                }
            } else {
                for (;
                    (F | 0) < (x | 0); F = F + 4 | 0) {
                    A = e[u + F >> 2] | 0;
                    B = e[w + F >> 2] | 0;
                    D = ((A & 65535) - (B & 65535) | 0) + C | 0;
                    E = ((A >>> 16) - (B >>> 16) | 0) + (D >> 16) | 0;
                    e[y + F >> 2] = D & 65535 | E << 16;
                    C = E >> 16
                }
                for (;
                    (F | 0) < (v | 0); F = F + 4 | 0) {
                    A = e[u + F >> 2] | 0;
                    D = (A & 65535) + C | 0;
                    E = (A >>> 16) + (D >> 16) | 0;
                    e[y + F >> 2] = D & 65535 | E << 16;
                    C = E >> 16
                }
            }
            for (;
                (F | 0) < (z | 0); F = F + 4 | 0) {
                e[y + F >> 2] = C | 0
            }
            return C | 0
        }

        function q(u, v, w, x, y, z) {
            u = u | 0;
            v = v | 0;
            w = w | 0;
            x = x | 0;
            y = y | 0;
            z = z | 0;
            var A = 0,
                B = 0,
                C = 0,
                D = 0,
                E = 0,
                F = 0,
                G = 0,
                H = 0,
                I = 0,
                J = 0,
                K = 0,
                L = 0,
                M = 0,
                N = 0,
                O = 0,
                P = 0,
                Q = 0,
                R = 0,
                S = 0,
                T = 0,
                U = 0,
                V = 0,
                W = 0,
                X = 0,
                Y = 0,
                Z = 0,
                $ = 0,
                _ = 0,
                ab = 0,
                bb = 0,
                cb = 0,
                db = 0,
                eb = 0,
                fb = 0,
                gb = 0,
                hb = 0,
                ib = 0,
                jb = 0,
                kb = 0,
                lb = 0,
                mb = 0,
                nb = 0,
                ob = 0,
                pb = 0,
                qb = 0,
                rb = 0,
                sb = 0,
                tb = 0,
                ub = 0,
                vb = 0,
                wb = 0,
                xb = 0,
                yb = 0,
                zb = 0,
                Ab = 0,
                Bb = 0,
                Cb = 0;
            if ((v | 0) > (x | 0)) {
                ub = u,
                vb = v;
                u = w,
                v = x;
                w = ub,
                x = vb
            }
            xb = v + x | 0;
            if ((z | 0) > (xb | 0) | (z | 0) <= 0) z = xb;
            if ((z | 0) < (v | 0)) v = z;
            if ((z | 0) < (x | 0)) x = z;
            for (;
                (yb | 0) < (v | 0); yb = yb + 32 | 0) {
                zb = u + yb | 0;
                I = e[(zb | 0) >> 2] | 0,
                J = e[(zb | 4) >> 2] | 0,
                K = e[(zb | 8) >> 2] | 0,
                L = e[(zb | 12) >> 2] | 0,
                M = e[(zb | 16) >> 2] | 0,
                N = e[(zb | 20) >> 2] | 0,
                O = e[(zb | 24) >> 2] | 0,
                P = e[(zb | 28) >> 2] | 0,
                A = I & 65535,
                B = J & 65535,
                C = K & 65535,
                D = L & 65535,
                E = M & 65535,
                F = N & 65535,
                G = O & 65535,
                H = P & 65535,
                I = I >>> 16,
                J = J >>> 16,
                K = K >>> 16,
                L = L >>> 16,
                M = M >>> 16,
                N = N >>> 16,
                O = O >>> 16,
                P = P >>> 16;
                mb = nb = ob = pb = qb = rb = sb = tb = 0;
                for (Ab = 0;
                    (Ab | 0) < (x | 0); Ab = Ab + 32 | 0) {
                    Bb = w + Ab | 0;
                    Cb = y + (yb + Ab | 0) | 0;
                    Y = e[(Bb | 0) >> 2] | 0,
                    Z = e[(Bb | 4) >> 2] | 0,
                    $ = e[(Bb | 8) >> 2] | 0,
                    _ = e[(Bb | 12) >> 2] | 0,
                    ab = e[(Bb | 16) >> 2] | 0,
                    bb = e[(Bb | 20) >> 2] | 0,
                    cb = e[(Bb | 24) >> 2] | 0,
                    db = e[(Bb | 28) >> 2] | 0,
                    Q = Y & 65535,
                    R = Z & 65535,
                    S = $ & 65535,
                    T = _ & 65535,
                    U = ab & 65535,
                    V = bb & 65535,
                    W = cb & 65535,
                    X = db & 65535,
                    Y = Y >>> 16,
                    Z = Z >>> 16,
                    $ = $ >>> 16,
                    _ = _ >>> 16,
                    ab = ab >>> 16,
                    bb = bb >>> 16,
                    cb = cb >>> 16,
                    db = db >>> 16;
                    eb = e[(Cb | 0) >> 2] | 0,
                    fb = e[(Cb | 4) >> 2] | 0,
                    gb = e[(Cb | 8) >> 2] | 0,
                    hb = e[(Cb | 12) >> 2] | 0,
                    ib = e[(Cb | 16) >> 2] | 0,
                    jb = e[(Cb | 20) >> 2] | 0,
                    kb = e[(Cb | 24) >> 2] | 0,
                    lb = e[(Cb | 28) >> 2] | 0;
                    ub = ((f(A, Q) | 0) + (mb & 65535) | 0) + (eb & 65535) | 0;
                    vb = ((f(I, Q) | 0) + (mb >>> 16) | 0) + (eb >>> 16) | 0;
                    wb = ((f(A, Y) | 0) + (vb & 65535) | 0) + (ub >>> 16) | 0;
                    xb = ((f(I, Y) | 0) + (vb >>> 16) | 0) + (wb >>> 16) | 0;
                    eb = wb << 16 | ub & 65535;
                    ub = ((f(A, R) | 0) + (xb & 65535) | 0) + (fb & 65535) | 0;
                    vb = ((f(I, R) | 0) + (xb >>> 16) | 0) + (fb >>> 16) | 0;
                    wb = ((f(A, Z) | 0) + (vb & 65535) | 0) + (ub >>> 16) | 0;
                    xb = ((f(I, Z) | 0) + (vb >>> 16) | 0) + (wb >>> 16) | 0;
                    fb = wb << 16 | ub & 65535;
                    ub = ((f(A, S) | 0) + (xb & 65535) | 0) + (gb & 65535) | 0;
                    vb = ((f(I, S) | 0) + (xb >>> 16) | 0) + (gb >>> 16) | 0;
                    wb = ((f(A, $) | 0) + (vb & 65535) | 0) + (ub >>> 16) | 0;
                    xb = ((f(I, $) | 0) + (vb >>> 16) | 0) + (wb >>> 16) | 0;
                    gb = wb << 16 | ub & 65535;
                    ub = ((f(A, T) | 0) + (xb & 65535) | 0) + (hb & 65535) | 0;
                    vb = ((f(I, T) | 0) + (xb >>> 16) | 0) + (hb >>> 16) | 0;
                    wb = ((f(A, _) | 0) + (vb & 65535) | 0) + (ub >>> 16) | 0;
                    xb = ((f(I, _) | 0) + (vb >>> 16) | 0) + (wb >>> 16) | 0;
                    hb = wb << 16 | ub & 65535;
                    ub = ((f(A, U) | 0) + (xb & 65535) | 0) + (ib & 65535) | 0;
                    vb = ((f(I, U) | 0) + (xb >>> 16) | 0) + (ib >>> 16) | 0;
                    wb = ((f(A, ab) | 0) + (vb & 65535) | 0) + (ub >>> 16) | 0;
                    xb = ((f(I, ab) | 0) + (vb >>> 16) | 0) + (wb >>> 16) | 0;
                    ib = wb << 16 | ub & 65535;
                    ub = ((f(A, V) | 0) + (xb & 65535) | 0) + (jb & 65535) | 0;
                    vb = ((f(I, V) | 0) + (xb >>> 16) | 0) + (jb >>> 16) | 0;
                    wb = ((f(A, bb) | 0) + (vb & 65535) | 0) + (ub >>> 16) | 0;
                    xb = ((f(I, bb) | 0) + (vb >>> 16) | 0) + (wb >>> 16) | 0;
                    jb = wb << 16 | ub & 65535;
                    ub = ((f(A, W) | 0) + (xb & 65535) | 0) + (kb & 65535) | 0;
                    vb = ((f(I, W) | 0) + (xb >>> 16) | 0) + (kb >>> 16) | 0;
                    wb = ((f(A, cb) | 0) + (vb & 65535) | 0) + (ub >>> 16) | 0;
                    xb = ((f(I, cb) | 0) + (vb >>> 16) | 0) + (wb >>> 16) | 0;
                    kb = wb << 16 | ub & 65535;
                    ub = ((f(A, X) | 0) + (xb & 65535) | 0) + (lb & 65535) | 0;
                    vb = ((f(I, X) | 0) + (xb >>> 16) | 0) + (lb >>> 16) | 0;
                    wb = ((f(A, db) | 0) + (vb & 65535) | 0) + (ub >>> 16) | 0;
                    xb = ((f(I, db) | 0) + (vb >>> 16) | 0) + (wb >>> 16) | 0;
                    lb = wb << 16 | ub & 65535;
                    mb = xb;
                    ub = ((f(B, Q) | 0) + (nb & 65535) | 0) + (fb & 65535) | 0;
                    vb = ((f(J, Q) | 0) + (nb >>> 16) | 0) + (fb >>> 16) | 0;
                    wb = ((f(B, Y) | 0) + (vb & 65535) | 0) + (ub >>> 16) | 0;
                    xb = ((f(J, Y) | 0) + (vb >>> 16) | 0) + (wb >>> 16) | 0;
                    fb = wb << 16 | ub & 65535;
                    ub = ((f(B, R) | 0) + (xb & 65535) | 0) + (gb & 65535) | 0;
                    vb = ((f(J, R) | 0) + (xb >>> 16) | 0) + (gb >>> 16) | 0;
                    wb = ((f(B, Z) | 0) + (vb & 65535) | 0) + (ub >>> 16) | 0;
                    xb = ((f(J, Z) | 0) + (vb >>> 16) | 0) + (wb >>> 16) | 0;
                    gb = wb << 16 | ub & 65535;
                    ub = ((f(B, S) | 0) + (xb & 65535) | 0) + (hb & 65535) | 0;
                    vb = ((f(J, S) | 0) + (xb >>> 16) | 0) + (hb >>> 16) | 0;
                    wb = ((f(B, $) | 0) + (vb & 65535) | 0) + (ub >>> 16) | 0;
                    xb = ((f(J, $) | 0) + (vb >>> 16) | 0) + (wb >>> 16) | 0;
                    hb = wb << 16 | ub & 65535;
                    ub = ((f(B, T) | 0) + (xb & 65535) | 0) + (ib & 65535) | 0;
                    vb = ((f(J, T) | 0) + (xb >>> 16) | 0) + (ib >>> 16) | 0;
                    wb = ((f(B, _) | 0) + (vb & 65535) | 0) + (ub >>> 16) | 0;
                    xb = ((f(J, _) | 0) + (vb >>> 16) | 0) + (wb >>> 16) | 0;
                    ib = wb << 16 | ub & 65535;
                    ub = ((f(B, U) | 0) + (xb & 65535) | 0) + (jb & 65535) | 0;
                    vb = ((f(J, U) | 0) + (xb >>> 16) | 0) + (jb >>> 16) | 0;
                    wb = ((f(B, ab) | 0) + (vb & 65535) | 0) + (ub >>> 16) | 0;
                    xb = ((f(J, ab) | 0) + (vb >>> 16) | 0) + (wb >>> 16) | 0;
                    jb = wb << 16 | ub & 65535;
                    ub = ((f(B, V) | 0) + (xb & 65535) | 0) + (kb & 65535) | 0;
                    vb = ((f(J, V) | 0) + (xb >>> 16) | 0) + (kb >>> 16) | 0;
                    wb = ((f(B, bb) | 0) + (vb & 65535) | 0) + (ub >>> 16) | 0;
                    xb = ((f(J, bb) | 0) + (vb >>> 16) | 0) + (wb >>> 16) | 0;
                    kb = wb << 16 | ub & 65535;
                    ub = ((f(B, W) | 0) + (xb & 65535) | 0) + (lb & 65535) | 0;
                    vb = ((f(J, W) | 0) + (xb >>> 16) | 0) + (lb >>> 16) | 0;
                    wb = ((f(B, cb) | 0) + (vb & 65535) | 0) + (ub >>> 16) | 0;
                    xb = ((f(J, cb) | 0) + (vb >>> 16) | 0) + (wb >>> 16) | 0;
                    lb = wb << 16 | ub & 65535;
                    ub = ((f(B, X) | 0) + (xb & 65535) | 0) + (mb & 65535) | 0;
                    vb = ((f(J, X) | 0) + (xb >>> 16) | 0) + (mb >>> 16) | 0;
                    wb = ((f(B, db) | 0) + (vb & 65535) | 0) + (ub >>> 16) | 0;
                    xb = ((f(J, db) | 0) + (vb >>> 16) | 0) + (wb >>> 16) | 0;
                    mb = wb << 16 | ub & 65535;
                    nb = xb;
                    ub = ((f(C, Q) | 0) + (ob & 65535) | 0) + (gb & 65535) | 0;
                    vb = ((f(K, Q) | 0) + (ob >>> 16) | 0) + (gb >>> 16) | 0;
                    wb = ((f(C, Y) | 0) + (vb & 65535) | 0) + (ub >>> 16) | 0;
                    xb = ((f(K, Y) | 0) + (vb >>> 16) | 0) + (wb >>> 16) | 0;
                    gb = wb << 16 | ub & 65535;
                    ub = ((f(C, R) | 0) + (xb & 65535) | 0) + (hb & 65535) | 0;
                    vb = ((f(K, R) | 0) + (xb >>> 16) | 0) + (hb >>> 16) | 0;
                    wb = ((f(C, Z) | 0) + (vb & 65535) | 0) + (ub >>> 16) | 0;
                    xb = ((f(K, Z) | 0) + (vb >>> 16) | 0) + (wb >>> 16) | 0;
                    hb = wb << 16 | ub & 65535;
                    ub = ((f(C, S) | 0) + (xb & 65535) | 0) + (ib & 65535) | 0;
                    vb = ((f(K, S) | 0) + (xb >>> 16) | 0) + (ib >>> 16) | 0;
                    wb = ((f(C, $) | 0) + (vb & 65535) | 0) + (ub >>> 16) | 0;
                    xb = ((f(K, $) | 0) + (vb >>> 16) | 0) + (wb >>> 16) | 0;
                    ib = wb << 16 | ub & 65535;
                    ub = ((f(C, T) | 0) + (xb & 65535) | 0) + (jb & 65535) | 0;
                    vb = ((f(K, T) | 0) + (xb >>> 16) | 0) + (jb >>> 16) | 0;
                    wb = ((f(C, _) | 0) + (vb & 65535) | 0) + (ub >>> 16) | 0;
                    xb = ((f(K, _) | 0) + (vb >>> 16) | 0) + (wb >>> 16) | 0;
                    jb = wb << 16 | ub & 65535;
                    ub = ((f(C, U) | 0) + (xb & 65535) | 0) + (kb & 65535) | 0;
                    vb = ((f(K, U) | 0) + (xb >>> 16) | 0) + (kb >>> 16) | 0;
                    wb = ((f(C, ab) | 0) + (vb & 65535) | 0) + (ub >>> 16) | 0;
                    xb = ((f(K, ab) | 0) + (vb >>> 16) | 0) + (wb >>> 16) | 0;
                    kb = wb << 16 | ub & 65535;
                    ub = ((f(C, V) | 0) + (xb & 65535) | 0) + (lb & 65535) | 0;
                    vb = ((f(K, V) | 0) + (xb >>> 16) | 0) + (lb >>> 16) | 0;
                    wb = ((f(C, bb) | 0) + (vb & 65535) | 0) + (ub >>> 16) | 0;
                    xb = ((f(K, bb) | 0) + (vb >>> 16) | 0) + (wb >>> 16) | 0;
                    lb = wb << 16 | ub & 65535;
                    ub = ((f(C, W) | 0) + (xb & 65535) | 0) + (mb & 65535) | 0;
                    vb = ((f(K, W) | 0) + (xb >>> 16) | 0) + (mb >>> 16) | 0;
                    wb = ((f(C, cb) | 0) + (vb & 65535) | 0) + (ub >>> 16) | 0;
                    xb = ((f(K, cb) | 0) + (vb >>> 16) | 0) + (wb >>> 16) | 0;
                    mb = wb << 16 | ub & 65535;
                    ub = ((f(C, X) | 0) + (xb & 65535) | 0) + (nb & 65535) | 0;
                    vb = ((f(K, X) | 0) + (xb >>> 16) | 0) + (nb >>> 16) | 0;
                    wb = ((f(C, db) | 0) + (vb & 65535) | 0) + (ub >>> 16) | 0;
                    xb = ((f(K, db) | 0) + (vb >>> 16) | 0) + (wb >>> 16) | 0;
                    nb = wb << 16 | ub & 65535;
                    ob = xb;
                    ub = ((f(D, Q) | 0) + (pb & 65535) | 0) + (hb & 65535) | 0;
                    vb = ((f(L, Q) | 0) + (pb >>> 16) | 0) + (hb >>> 16) | 0;
                    wb = ((f(D, Y) | 0) + (vb & 65535) | 0) + (ub >>> 16) | 0;
                    xb = ((f(L, Y) | 0) + (vb >>> 16) | 0) + (wb >>> 16) | 0;
                    hb = wb << 16 | ub & 65535;
                    ub = ((f(D, R) | 0) + (xb & 65535) | 0) + (ib & 65535) | 0;
                    vb = ((f(L, R) | 0) + (xb >>> 16) | 0) + (ib >>> 16) | 0;
                    wb = ((f(D, Z) | 0) + (vb & 65535) | 0) + (ub >>> 16) | 0;
                    xb = ((f(L, Z) | 0) + (vb >>> 16) | 0) + (wb >>> 16) | 0;
                    ib = wb << 16 | ub & 65535;
                    ub = ((f(D, S) | 0) + (xb & 65535) | 0) + (jb & 65535) | 0;
                    vb = ((f(L, S) | 0) + (xb >>> 16) | 0) + (jb >>> 16) | 0;
                    wb = ((f(D, $) | 0) + (vb & 65535) | 0) + (ub >>> 16) | 0;
                    xb = ((f(L, $) | 0) + (vb >>> 16) | 0) + (wb >>> 16) | 0;
                    jb = wb << 16 | ub & 65535;
                    ub = ((f(D, T) | 0) + (xb & 65535) | 0) + (kb & 65535) | 0;
                    vb = ((f(L, T) | 0) + (xb >>> 16) | 0) + (kb >>> 16) | 0;
                    wb = ((f(D, _) | 0) + (vb & 65535) | 0) + (ub >>> 16) | 0;
                    xb = ((f(L, _) | 0) + (vb >>> 16) | 0) + (wb >>> 16) | 0;
                    kb = wb << 16 | ub & 65535;
                    ub = ((f(D, U) | 0) + (xb & 65535) | 0) + (lb & 65535) | 0;
                    vb = ((f(L, U) | 0) + (xb >>> 16) | 0) + (lb >>> 16) | 0;
                    wb = ((f(D, ab) | 0) + (vb & 65535) | 0) + (ub >>> 16) | 0;
                    xb = ((f(L, ab) | 0) + (vb >>> 16) | 0) + (wb >>> 16) | 0;
                    lb = wb << 16 | ub & 65535;
                    ub = ((f(D, V) | 0) + (xb & 65535) | 0) + (mb & 65535) | 0;
                    vb = ((f(L, V) | 0) + (xb >>> 16) | 0) + (mb >>> 16) | 0;
                    wb = ((f(D, bb) | 0) + (vb & 65535) | 0) + (ub >>> 16) | 0;
                    xb = ((f(L, bb) | 0) + (vb >>> 16) | 0) + (wb >>> 16) | 0;
                    mb = wb << 16 | ub & 65535;
                    ub = ((f(D, W) | 0) + (xb & 65535) | 0) + (nb & 65535) | 0;
                    vb = ((f(L, W) | 0) + (xb >>> 16) | 0) + (nb >>> 16) | 0;
                    wb = ((f(D, cb) | 0) + (vb & 65535) | 0) + (ub >>> 16) | 0;
                    xb = ((f(L, cb) | 0) + (vb >>> 16) | 0) + (wb >>> 16) | 0;
                    nb = wb << 16 | ub & 65535;
                    ub = ((f(D, X) | 0) + (xb & 65535) | 0) + (ob & 65535) | 0;
                    vb = ((f(L, X) | 0) + (xb >>> 16) | 0) + (ob >>> 16) | 0;
                    wb = ((f(D, db) | 0) + (vb & 65535) | 0) + (ub >>> 16) | 0;
                    xb = ((f(L, db) | 0) + (vb >>> 16) | 0) + (wb >>> 16) | 0;
                    ob = wb << 16 | ub & 65535;
                    pb = xb;
                    ub = ((f(E, Q) | 0) + (qb & 65535) | 0) + (ib & 65535) | 0;
                    vb = ((f(M, Q) | 0) + (qb >>> 16) | 0) + (ib >>> 16) | 0;
                    wb = ((f(E, Y) | 0) + (vb & 65535) | 0) + (ub >>> 16) | 0;
                    xb = ((f(M, Y) | 0) + (vb >>> 16) | 0) + (wb >>> 16) | 0;
                    ib = wb << 16 | ub & 65535;
                    ub = ((f(E, R) | 0) + (xb & 65535) | 0) + (jb & 65535) | 0;
                    vb = ((f(M, R) | 0) + (xb >>> 16) | 0) + (jb >>> 16) | 0;
                    wb = ((f(E, Z) | 0) + (vb & 65535) | 0) + (ub >>> 16) | 0;
                    xb = ((f(M, Z) | 0) + (vb >>> 16) | 0) + (wb >>> 16) | 0;
                    jb = wb << 16 | ub & 65535;
                    ub = ((f(E, S) | 0) + (xb & 65535) | 0) + (kb & 65535) | 0;
                    vb = ((f(M, S) | 0) + (xb >>> 16) | 0) + (kb >>> 16) | 0;
                    wb = ((f(E, $) | 0) + (vb & 65535) | 0) + (ub >>> 16) | 0;
                    xb = ((f(M, $) | 0) + (vb >>> 16) | 0) + (wb >>> 16) | 0;
                    kb = wb << 16 | ub & 65535;
                    ub = ((f(E, T) | 0) + (xb & 65535) | 0) + (lb & 65535) | 0;
                    vb = ((f(M, T) | 0) + (xb >>> 16) | 0) + (lb >>> 16) | 0;
                    wb = ((f(E, _) | 0) + (vb & 65535) | 0) + (ub >>> 16) | 0;
                    xb = ((f(M, _) | 0) + (vb >>> 16) | 0) + (wb >>> 16) | 0;
                    lb = wb << 16 | ub & 65535;
                    ub = ((f(E, U) | 0) + (xb & 65535) | 0) + (mb & 65535) | 0;
                    vb = ((f(M, U) | 0) + (xb >>> 16) | 0) + (mb >>> 16) | 0;
                    wb = ((f(E, ab) | 0) + (vb & 65535) | 0) + (ub >>> 16) | 0;
                    xb = ((f(M, ab) | 0) + (vb >>> 16) | 0) + (wb >>> 16) | 0;
                    mb = wb << 16 | ub & 65535;
                    ub = ((f(E, V) | 0) + (xb & 65535) | 0) + (nb & 65535) | 0;
                    vb = ((f(M, V) | 0) + (xb >>> 16) | 0) + (nb >>> 16) | 0;
                    wb = ((f(E, bb) | 0) + (vb & 65535) | 0) + (ub >>> 16) | 0;
                    xb = ((f(M, bb) | 0) + (vb >>> 16) | 0) + (wb >>> 16) | 0;
                    nb = wb << 16 | ub & 65535;
                    ub = ((f(E, W) | 0) + (xb & 65535) | 0) + (ob & 65535) | 0;
                    vb = ((f(M, W) | 0) + (xb >>> 16) | 0) + (ob >>> 16) | 0;
                    wb = ((f(E, cb) | 0) + (vb & 65535) | 0) + (ub >>> 16) | 0;
                    xb = ((f(M, cb) | 0) + (vb >>> 16) | 0) + (wb >>> 16) | 0;
                    ob = wb << 16 | ub & 65535;
                    ub = ((f(E, X) | 0) + (xb & 65535) | 0) + (pb & 65535) | 0;
                    vb = ((f(M, X) | 0) + (xb >>> 16) | 0) + (pb >>> 16) | 0;
                    wb = ((f(E, db) | 0) + (vb & 65535) | 0) + (ub >>> 16) | 0;
                    xb = ((f(M, db) | 0) + (vb >>> 16) | 0) + (wb >>> 16) | 0;
                    pb = wb << 16 | ub & 65535;
                    qb = xb;
                    ub = ((f(F, Q) | 0) + (rb & 65535) | 0) + (jb & 65535) | 0;
                    vb = ((f(N, Q) | 0) + (rb >>> 16) | 0) + (jb >>> 16) | 0;
                    wb = ((f(F, Y) | 0) + (vb & 65535) | 0) + (ub >>> 16) | 0;
                    xb = ((f(N, Y) | 0) + (vb >>> 16) | 0) + (wb >>> 16) | 0;
                    jb = wb << 16 | ub & 65535;
                    ub = ((f(F, R) | 0) + (xb & 65535) | 0) + (kb & 65535) | 0;
                    vb = ((f(N, R) | 0) + (xb >>> 16) | 0) + (kb >>> 16) | 0;
                    wb = ((f(F, Z) | 0) + (vb & 65535) | 0) + (ub >>> 16) | 0;
                    xb = ((f(N, Z) | 0) + (vb >>> 16) | 0) + (wb >>> 16) | 0;
                    kb = wb << 16 | ub & 65535;
                    ub = ((f(F, S) | 0) + (xb & 65535) | 0) + (lb & 65535) | 0;
                    vb = ((f(N, S) | 0) + (xb >>> 16) | 0) + (lb >>> 16) | 0;
                    wb = ((f(F, $) | 0) + (vb & 65535) | 0) + (ub >>> 16) | 0;
                    xb = ((f(N, $) | 0) + (vb >>> 16) | 0) + (wb >>> 16) | 0;
                    lb = wb << 16 | ub & 65535;
                    ub = ((f(F, T) | 0) + (xb & 65535) | 0) + (mb & 65535) | 0;
                    vb = ((f(N, T) | 0) + (xb >>> 16) | 0) + (mb >>> 16) | 0;
                    wb = ((f(F, _) | 0) + (vb & 65535) | 0) + (ub >>> 16) | 0;
                    xb = ((f(N, _) | 0) + (vb >>> 16) | 0) + (wb >>> 16) | 0;
                    mb = wb << 16 | ub & 65535;
                    ub = ((f(F, U) | 0) + (xb & 65535) | 0) + (nb & 65535) | 0;
                    vb = ((f(N, U) | 0) + (xb >>> 16) | 0) + (nb >>> 16) | 0;
                    wb = ((f(F, ab) | 0) + (vb & 65535) | 0) + (ub >>> 16) | 0;
                    xb = ((f(N, ab) | 0) + (vb >>> 16) | 0) + (wb >>> 16) | 0;
                    nb = wb << 16 | ub & 65535;
                    ub = ((f(F, V) | 0) + (xb & 65535) | 0) + (ob & 65535) | 0;
                    vb = ((f(N, V) | 0) + (xb >>> 16) | 0) + (ob >>> 16) | 0;
                    wb = ((f(F, bb) | 0) + (vb & 65535) | 0) + (ub >>> 16) | 0;
                    xb = ((f(N, bb) | 0) + (vb >>> 16) | 0) + (wb >>> 16) | 0;
                    ob = wb << 16 | ub & 65535;
                    ub = ((f(F, W) | 0) + (xb & 65535) | 0) + (pb & 65535) | 0;
                    vb = ((f(N, W) | 0) + (xb >>> 16) | 0) + (pb >>> 16) | 0;
                    wb = ((f(F, cb) | 0) + (vb & 65535) | 0) + (ub >>> 16) | 0;
                    xb = ((f(N, cb) | 0) + (vb >>> 16) | 0) + (wb >>> 16) | 0;
                    pb = wb << 16 | ub & 65535;
                    ub = ((f(F, X) | 0) + (xb & 65535) | 0) + (qb & 65535) | 0;
                    vb = ((f(N, X) | 0) + (xb >>> 16) | 0) + (qb >>> 16) | 0;
                    wb = ((f(F, db) | 0) + (vb & 65535) | 0) + (ub >>> 16) | 0;
                    xb = ((f(N, db) | 0) + (vb >>> 16) | 0) + (wb >>> 16) | 0;
                    qb = wb << 16 | ub & 65535;
                    rb = xb;
                    ub = ((f(G, Q) | 0) + (sb & 65535) | 0) + (kb & 65535) | 0;
                    vb = ((f(O, Q) | 0) + (sb >>> 16) | 0) + (kb >>> 16) | 0;
                    wb = ((f(G, Y) | 0) + (vb & 65535) | 0) + (ub >>> 16) | 0;
                    xb = ((f(O, Y) | 0) + (vb >>> 16) | 0) + (wb >>> 16) | 0;
                    kb = wb << 16 | ub & 65535;
                    ub = ((f(G, R) | 0) + (xb & 65535) | 0) + (lb & 65535) | 0;
                    vb = ((f(O, R) | 0) + (xb >>> 16) | 0) + (lb >>> 16) | 0;
                    wb = ((f(G, Z) | 0) + (vb & 65535) | 0) + (ub >>> 16) | 0;
                    xb = ((f(O, Z) | 0) + (vb >>> 16) | 0) + (wb >>> 16) | 0;
                    lb = wb << 16 | ub & 65535;
                    ub = ((f(G, S) | 0) + (xb & 65535) | 0) + (mb & 65535) | 0;
                    vb = ((f(O, S) | 0) + (xb >>> 16) | 0) + (mb >>> 16) | 0;
                    wb = ((f(G, $) | 0) + (vb & 65535) | 0) + (ub >>> 16) | 0;
                    xb = ((f(O, $) | 0) + (vb >>> 16) | 0) + (wb >>> 16) | 0;
                    mb = wb << 16 | ub & 65535;
                    ub = ((f(G, T) | 0) + (xb & 65535) | 0) + (nb & 65535) | 0;
                    vb = ((f(O, T) | 0) + (xb >>> 16) | 0) + (nb >>> 16) | 0;
                    wb = ((f(G, _) | 0) + (vb & 65535) | 0) + (ub >>> 16) | 0;
                    xb = ((f(O, _) | 0) + (vb >>> 16) | 0) + (wb >>> 16) | 0;
                    nb = wb << 16 | ub & 65535;
                    ub = ((f(G, U) | 0) + (xb & 65535) | 0) + (ob & 65535) | 0;
                    vb = ((f(O, U) | 0) + (xb >>> 16) | 0) + (ob >>> 16) | 0;
                    wb = ((f(G, ab) | 0) + (vb & 65535) | 0) + (ub >>> 16) | 0;
                    xb = ((f(O, ab) | 0) + (vb >>> 16) | 0) + (wb >>> 16) | 0;
                    ob = wb << 16 | ub & 65535;
                    ub = ((f(G, V) | 0) + (xb & 65535) | 0) + (pb & 65535) | 0;
                    vb = ((f(O, V) | 0) + (xb >>> 16) | 0) + (pb >>> 16) | 0;
                    wb = ((f(G, bb) | 0) + (vb & 65535) | 0) + (ub >>> 16) | 0;
                    xb = ((f(O, bb) | 0) + (vb >>> 16) | 0) + (wb >>> 16) | 0;
                    pb = wb << 16 | ub & 65535;
                    ub = ((f(G, W) | 0) + (xb & 65535) | 0) + (qb & 65535) | 0;
                    vb = ((f(O, W) | 0) + (xb >>> 16) | 0) + (qb >>> 16) | 0;
                    wb = ((f(G, cb) | 0) + (vb & 65535) | 0) + (ub >>> 16) | 0;
                    xb = ((f(O, cb) | 0) + (vb >>> 16) | 0) + (wb >>> 16) | 0;
                    qb = wb << 16 | ub & 65535;
                    ub = ((f(G, X) | 0) + (xb & 65535) | 0) + (rb & 65535) | 0;
                    vb = ((f(O, X) | 0) + (xb >>> 16) | 0) + (rb >>> 16) | 0;
                    wb = ((f(G, db) | 0) + (vb & 65535) | 0) + (ub >>> 16) | 0;
                    xb = ((f(O, db) | 0) + (vb >>> 16) | 0) + (wb >>> 16) | 0;
                    rb = wb << 16 | ub & 65535;
                    sb = xb;
                    ub = ((f(H, Q) | 0) + (tb & 65535) | 0) + (lb & 65535) | 0;
                    vb = ((f(P, Q) | 0) + (tb >>> 16) | 0) + (lb >>> 16) | 0;
                    wb = ((f(H, Y) | 0) + (vb & 65535) | 0) + (ub >>> 16) | 0;
                    xb = ((f(P, Y) | 0) + (vb >>> 16) | 0) + (wb >>> 16) | 0;
                    lb = wb << 16 | ub & 65535;
                    ub = ((f(H, R) | 0) + (xb & 65535) | 0) + (mb & 65535) | 0;
                    vb = ((f(P, R) | 0) + (xb >>> 16) | 0) + (mb >>> 16) | 0;
                    wb = ((f(H, Z) | 0) + (vb & 65535) | 0) + (ub >>> 16) | 0;
                    xb = ((f(P, Z) | 0) + (vb >>> 16) | 0) + (wb >>> 16) | 0;
                    mb = wb << 16 | ub & 65535;
                    ub = ((f(H, S) | 0) + (xb & 65535) | 0) + (nb & 65535) | 0;
                    vb = ((f(P, S) | 0) + (xb >>> 16) | 0) + (nb >>> 16) | 0;
                    wb = ((f(H, $) | 0) + (vb & 65535) | 0) + (ub >>> 16) | 0;
                    xb = ((f(P, $) | 0) + (vb >>> 16) | 0) + (wb >>> 16) | 0;
                    nb = wb << 16 | ub & 65535;
                    ub = ((f(H, T) | 0) + (xb & 65535) | 0) + (ob & 65535) | 0;
                    vb = ((f(P, T) | 0) + (xb >>> 16) | 0) + (ob >>> 16) | 0;
                    wb = ((f(H, _) | 0) + (vb & 65535) | 0) + (ub >>> 16) | 0;
                    xb = ((f(P, _) | 0) + (vb >>> 16) | 0) + (wb >>> 16) | 0;
                    ob = wb << 16 | ub & 65535;
                    ub = ((f(H, U) | 0) + (xb & 65535) | 0) + (pb & 65535) | 0;
                    vb = ((f(P, U) | 0) + (xb >>> 16) | 0) + (pb >>> 16) | 0;
                    wb = ((f(H, ab) | 0) + (vb & 65535) | 0) + (ub >>> 16) | 0;
                    xb = ((f(P, ab) | 0) + (vb >>> 16) | 0) + (wb >>> 16) | 0;
                    pb = wb << 16 | ub & 65535;
                    ub = ((f(H, V) | 0) + (xb & 65535) | 0) + (qb & 65535) | 0;
                    vb = ((f(P, V) | 0) + (xb >>> 16) | 0) + (qb >>> 16) | 0;
                    wb = ((f(H, bb) | 0) + (vb & 65535) | 0) + (ub >>> 16) | 0;
                    xb = ((f(P, bb) | 0) + (vb >>> 16) | 0) + (wb >>> 16) | 0;
                    qb = wb << 16 | ub & 65535;
                    ub = ((f(H, W) | 0) + (xb & 65535) | 0) + (rb & 65535) | 0;
                    vb = ((f(P, W) | 0) + (xb >>> 16) | 0) + (rb >>> 16) | 0;
                    wb = ((f(H, cb) | 0) + (vb & 65535) | 0) + (ub >>> 16) | 0;
                    xb = ((f(P, cb) | 0) + (vb >>> 16) | 0) + (wb >>> 16) | 0;
                    rb = wb << 16 | ub & 65535;
                    ub = ((f(H, X) | 0) + (xb & 65535) | 0) + (sb & 65535) | 0;
                    vb = ((f(P, X) | 0) + (xb >>> 16) | 0) + (sb >>> 16) | 0;
                    wb = ((f(H, db) | 0) + (vb & 65535) | 0) + (ub >>> 16) | 0;
                    xb = ((f(P, db) | 0) + (vb >>> 16) | 0) + (wb >>> 16) | 0;
                    sb = wb << 16 | ub & 65535;
                    tb = xb;
                    e[(Cb | 0) >> 2] = eb,
                    e[(Cb | 4) >> 2] = fb,
                    e[(Cb | 8) >> 2] = gb,
                    e[(Cb | 12) >> 2] = hb,
                    e[(Cb | 16) >> 2] = ib,
                    e[(Cb | 20) >> 2] = jb,
                    e[(Cb | 24) >> 2] = kb,
                    e[(Cb | 28) >> 2] = lb
                }
                Cb = y + (yb + Ab | 0) | 0;
                e[(Cb | 0) >> 2] = mb,
                e[(Cb | 4) >> 2] = nb,
                e[(Cb | 8) >> 2] = ob,
                e[(Cb | 12) >> 2] = pb,
                e[(Cb | 16) >> 2] = qb,
                e[(Cb | 20) >> 2] = rb,
                e[(Cb | 24) >> 2] = sb,
                e[(Cb | 28) >> 2] = tb
            }
        }

        function r(u, v, w) {
            u = u | 0;
            v = v | 0;
            w = w | 0;
            var x = 0,
                y = 0,
                z = 0,
                A = 0,
                B = 0,
                C = 0,
                D = 0,
                E = 0,
                F = 0,
                G = 0,
                H = 0,
                I = 0,
                J = 0,
                K = 0,
                L = 0,
                M = 0,
                N = 0,
                O = 0,
                P = 0,
                Q = 0,
                R = 0,
                S = 0,
                T = 0,
                U = 0,
                V = 0,
                W = 0,
                X = 0,
                Y = 0,
                Z = 0,
                $ = 0,
                _ = 0,
                ab = 0,
                bb = 0,
                cb = 0,
                db = 0,
                eb = 0,
                fb = 0,
                gb = 0,
                hb = 0,
                ib = 0,
                jb = 0,
                kb = 0,
                lb = 0,
                mb = 0,
                nb = 0,
                ob = 0,
                pb = 0,
                qb = 0,
                rb = 0,
                sb = 0,
                tb = 0,
                ub = 0,
                vb = 0,
                wb = 0,
                xb = 0,
                yb = 0,
                zb = 0,
                Ab = 0,
                Bb = 0,
                Cb = 0,
                Db = 0,
                Eb = 0,
                Fb = 0,
                Gb = 0;
            for (;
                (Bb | 0) < (v | 0); Bb = Bb + 4 | 0) {
                Gb = w + (Bb << 1) | 0;
                F = e[u + Bb >> 2] | 0,
                x = F & 65535,
                F = F >>> 16;
                rb = f(x, x) | 0;
                sb = (f(x, F) | 0) + (rb >>> 17) | 0;
                tb = (f(F, F) | 0) + (sb >>> 15) | 0;
                e[Gb >> 2] = sb << 17 | rb & 131071;
                e[(Gb | 4) >> 2] = tb
            }
            for (Ab = 0;
                (Ab | 0) < (v | 0); Ab = Ab + 8 | 0) {
                Eb = u + Ab | 0,
                Gb = w + (Ab << 1) | 0;
                F = e[Eb >> 2] | 0,
                x = F & 65535,
                F = F >>> 16;
                V = e[(Eb | 4) >> 2] | 0,
                N = V & 65535,
                V = V >>> 16;
                rb = f(x, N) | 0;
                sb = (f(x, V) | 0) + (rb >>> 16) | 0;
                tb = (f(F, N) | 0) + (sb & 65535) | 0;
                wb = ((f(F, V) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                xb = e[(Gb | 4) >> 2] | 0;
                rb = (xb & 65535) + ((rb & 65535) << 1) | 0;
                tb = ((xb >>> 16) + ((tb & 65535) << 1) | 0) + (rb >>> 16) | 0;
                e[(Gb | 4) >> 2] = tb << 16 | rb & 65535;
                ub = tb >>> 16;
                xb = e[(Gb | 8) >> 2] | 0;
                rb = ((xb & 65535) + ((wb & 65535) << 1) | 0) + ub | 0;
                tb = ((xb >>> 16) + (wb >>> 16 << 1) | 0) + (rb >>> 16) | 0;
                e[(Gb | 8) >> 2] = tb << 16 | rb & 65535;
                ub = tb >>> 16;
                if (ub) {
                    xb = e[(Gb | 12) >> 2] | 0;
                    rb = (xb & 65535) + ub | 0;
                    tb = (xb >>> 16) + (rb >>> 16) | 0;
                    e[(Gb | 12) >> 2] = tb << 16 | rb & 65535
                }
            }
            for (Ab = 0;
                (Ab | 0) < (v | 0); Ab = Ab + 16 | 0) {
                Eb = u + Ab | 0,
                Gb = w + (Ab << 1) | 0;
                F = e[Eb >> 2] | 0,
                x = F & 65535,
                F = F >>> 16,
                G = e[(Eb | 4) >> 2] | 0,
                y = G & 65535,
                G = G >>> 16;
                V = e[(Eb | 8) >> 2] | 0,
                N = V & 65535,
                V = V >>> 16,
                W = e[(Eb | 12) >> 2] | 0,
                O = W & 65535,
                W = W >>> 16;
                rb = f(x, N) | 0;
                sb = f(F, N) | 0;
                tb = ((f(x, V) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                wb = ((f(F, V) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                bb = tb << 16 | rb & 65535;
                rb = (f(x, O) | 0) + (wb & 65535) | 0;
                sb = (f(F, O) | 0) + (wb >>> 16) | 0;
                tb = ((f(x, W) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                wb = ((f(F, W) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                cb = tb << 16 | rb & 65535;
                db = wb;
                rb = (f(y, N) | 0) + (cb & 65535) | 0;
                sb = (f(G, N) | 0) + (cb >>> 16) | 0;
                tb = ((f(y, V) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                wb = ((f(G, V) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                cb = tb << 16 | rb & 65535;
                rb = ((f(y, O) | 0) + (db & 65535) | 0) + (wb & 65535) | 0;
                sb = ((f(G, O) | 0) + (db >>> 16) | 0) + (wb >>> 16) | 0;
                tb = ((f(y, W) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                wb = ((f(G, W) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                db = tb << 16 | rb & 65535;
                eb = wb;
                xb = e[(Gb | 8) >> 2] | 0;
                rb = (xb & 65535) + ((bb & 65535) << 1) | 0;
                tb = ((xb >>> 16) + (bb >>> 16 << 1) | 0) + (rb >>> 16) | 0;
                e[(Gb | 8) >> 2] = tb << 16 | rb & 65535;
                ub = tb >>> 16;
                xb = e[(Gb | 12) >> 2] | 0;
                rb = ((xb & 65535) + ((cb & 65535) << 1) | 0) + ub | 0;
                tb = ((xb >>> 16) + (cb >>> 16 << 1) | 0) + (rb >>> 16) | 0;
                e[(Gb | 12) >> 2] = tb << 16 | rb & 65535;
                ub = tb >>> 16;
                xb = e[(Gb | 16) >> 2] | 0;
                rb = ((xb & 65535) + ((db & 65535) << 1) | 0) + ub | 0;
                tb = ((xb >>> 16) + (db >>> 16 << 1) | 0) + (rb >>> 16) | 0;
                e[(Gb | 16) >> 2] = tb << 16 | rb & 65535;
                ub = tb >>> 16;
                xb = e[(Gb | 20) >> 2] | 0;
                rb = ((xb & 65535) + ((eb & 65535) << 1) | 0) + ub | 0;
                tb = ((xb >>> 16) + (eb >>> 16 << 1) | 0) + (rb >>> 16) | 0;
                e[(Gb | 20) >> 2] = tb << 16 | rb & 65535;
                ub = tb >>> 16;
                for (Db = 24; !!ub & (Db | 0) < 32; Db = Db + 4 | 0) {
                    xb = e[(Gb | Db) >> 2] | 0;
                    rb = (xb & 65535) + ub | 0;
                    tb = (xb >>> 16) + (rb >>> 16) | 0;
                    e[(Gb | Db) >> 2] = tb << 16 | rb & 65535;
                    ub = tb >>> 16
                }
            }
            for (Ab = 0;
                (Ab | 0) < (v | 0); Ab = Ab + 32 | 0) {
                Eb = u + Ab | 0,
                Gb = w + (Ab << 1) | 0;
                F = e[Eb >> 2] | 0,
                x = F & 65535,
                F = F >>> 16,
                G = e[(Eb | 4) >> 2] | 0,
                y = G & 65535,
                G = G >>> 16,
                H = e[(Eb | 8) >> 2] | 0,
                z = H & 65535,
                H = H >>> 16,
                I = e[(Eb | 12) >> 2] | 0,
                A = I & 65535,
                I = I >>> 16;
                V = e[(Eb | 16) >> 2] | 0,
                N = V & 65535,
                V = V >>> 16,
                W = e[(Eb | 20) >> 2] | 0,
                O = W & 65535,
                W = W >>> 16,
                X = e[(Eb | 24) >> 2] | 0,
                P = X & 65535,
                X = X >>> 16,
                Y = e[(Eb | 28) >> 2] | 0,
                Q = Y & 65535,
                Y = Y >>> 16;
                rb = f(x, N) | 0;
                sb = f(F, N) | 0;
                tb = ((f(x, V) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                wb = ((f(F, V) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                bb = tb << 16 | rb & 65535;
                rb = (f(x, O) | 0) + (wb & 65535) | 0;
                sb = (f(F, O) | 0) + (wb >>> 16) | 0;
                tb = ((f(x, W) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                wb = ((f(F, W) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                cb = tb << 16 | rb & 65535;
                rb = (f(x, P) | 0) + (wb & 65535) | 0;
                sb = (f(F, P) | 0) + (wb >>> 16) | 0;
                tb = ((f(x, X) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                wb = ((f(F, X) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                db = tb << 16 | rb & 65535;
                rb = (f(x, Q) | 0) + (wb & 65535) | 0;
                sb = (f(F, Q) | 0) + (wb >>> 16) | 0;
                tb = ((f(x, Y) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                wb = ((f(F, Y) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                eb = tb << 16 | rb & 65535;
                fb = wb;
                rb = (f(y, N) | 0) + (cb & 65535) | 0;
                sb = (f(G, N) | 0) + (cb >>> 16) | 0;
                tb = ((f(y, V) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                wb = ((f(G, V) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                cb = tb << 16 | rb & 65535;
                rb = ((f(y, O) | 0) + (db & 65535) | 0) + (wb & 65535) | 0;
                sb = ((f(G, O) | 0) + (db >>> 16) | 0) + (wb >>> 16) | 0;
                tb = ((f(y, W) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                wb = ((f(G, W) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                db = tb << 16 | rb & 65535;
                rb = ((f(y, P) | 0) + (eb & 65535) | 0) + (wb & 65535) | 0;
                sb = ((f(G, P) | 0) + (eb >>> 16) | 0) + (wb >>> 16) | 0;
                tb = ((f(y, X) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                wb = ((f(G, X) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                eb = tb << 16 | rb & 65535;
                rb = ((f(y, Q) | 0) + (fb & 65535) | 0) + (wb & 65535) | 0;
                sb = ((f(G, Q) | 0) + (fb >>> 16) | 0) + (wb >>> 16) | 0;
                tb = ((f(y, Y) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                wb = ((f(G, Y) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                fb = tb << 16 | rb & 65535;
                gb = wb;
                rb = (f(z, N) | 0) + (db & 65535) | 0;
                sb = (f(H, N) | 0) + (db >>> 16) | 0;
                tb = ((f(z, V) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                wb = ((f(H, V) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                db = tb << 16 | rb & 65535;
                rb = ((f(z, O) | 0) + (eb & 65535) | 0) + (wb & 65535) | 0;
                sb = ((f(H, O) | 0) + (eb >>> 16) | 0) + (wb >>> 16) | 0;
                tb = ((f(z, W) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                wb = ((f(H, W) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                eb = tb << 16 | rb & 65535;
                rb = ((f(z, P) | 0) + (fb & 65535) | 0) + (wb & 65535) | 0;
                sb = ((f(H, P) | 0) + (fb >>> 16) | 0) + (wb >>> 16) | 0;
                tb = ((f(z, X) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                wb = ((f(H, X) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                fb = tb << 16 | rb & 65535;
                rb = ((f(z, Q) | 0) + (gb & 65535) | 0) + (wb & 65535) | 0;
                sb = ((f(H, Q) | 0) + (gb >>> 16) | 0) + (wb >>> 16) | 0;
                tb = ((f(z, Y) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                wb = ((f(H, Y) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                gb = tb << 16 | rb & 65535;
                hb = wb;
                rb = (f(A, N) | 0) + (eb & 65535) | 0;
                sb = (f(I, N) | 0) + (eb >>> 16) | 0;
                tb = ((f(A, V) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                wb = ((f(I, V) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                eb = tb << 16 | rb & 65535;
                rb = ((f(A, O) | 0) + (fb & 65535) | 0) + (wb & 65535) | 0;
                sb = ((f(I, O) | 0) + (fb >>> 16) | 0) + (wb >>> 16) | 0;
                tb = ((f(A, W) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                wb = ((f(I, W) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                fb = tb << 16 | rb & 65535;
                rb = ((f(A, P) | 0) + (gb & 65535) | 0) + (wb & 65535) | 0;
                sb = ((f(I, P) | 0) + (gb >>> 16) | 0) + (wb >>> 16) | 0;
                tb = ((f(A, X) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                wb = ((f(I, X) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                gb = tb << 16 | rb & 65535;
                rb = ((f(A, Q) | 0) + (hb & 65535) | 0) + (wb & 65535) | 0;
                sb = ((f(I, Q) | 0) + (hb >>> 16) | 0) + (wb >>> 16) | 0;
                tb = ((f(A, Y) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                wb = ((f(I, Y) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                hb = tb << 16 | rb & 65535;
                ib = wb;
                xb = e[(Gb | 16) >> 2] | 0;
                rb = (xb & 65535) + ((bb & 65535) << 1) | 0;
                tb = ((xb >>> 16) + (bb >>> 16 << 1) | 0) + (rb >>> 16) | 0;
                e[(Gb | 16) >> 2] = tb << 16 | rb & 65535;
                ub = tb >>> 16;
                xb = e[(Gb | 20) >> 2] | 0;
                rb = ((xb & 65535) + ((cb & 65535) << 1) | 0) + ub | 0;
                tb = ((xb >>> 16) + (cb >>> 16 << 1) | 0) + (rb >>> 16) | 0;
                e[(Gb | 20) >> 2] = tb << 16 | rb & 65535;
                ub = tb >>> 16;
                xb = e[(Gb | 24) >> 2] | 0;
                rb = ((xb & 65535) + ((db & 65535) << 1) | 0) + ub | 0;
                tb = ((xb >>> 16) + (db >>> 16 << 1) | 0) + (rb >>> 16) | 0;
                e[(Gb | 24) >> 2] = tb << 16 | rb & 65535;
                ub = tb >>> 16;
                xb = e[(Gb | 28) >> 2] | 0;
                rb = ((xb & 65535) + ((eb & 65535) << 1) | 0) + ub | 0;
                tb = ((xb >>> 16) + (eb >>> 16 << 1) | 0) + (rb >>> 16) | 0;
                e[(Gb | 28) >> 2] = tb << 16 | rb & 65535;
                ub = tb >>> 16;
                xb = e[Gb + 32 >> 2] | 0;
                rb = ((xb & 65535) + ((fb & 65535) << 1) | 0) + ub | 0;
                tb = ((xb >>> 16) + (fb >>> 16 << 1) | 0) + (rb >>> 16) | 0;
                e[Gb + 32 >> 2] = tb << 16 | rb & 65535;
                ub = tb >>> 16;
                xb = e[Gb + 36 >> 2] | 0;
                rb = ((xb & 65535) + ((gb & 65535) << 1) | 0) + ub | 0;
                tb = ((xb >>> 16) + (gb >>> 16 << 1) | 0) + (rb >>> 16) | 0;
                e[Gb + 36 >> 2] = tb << 16 | rb & 65535;
                ub = tb >>> 16;
                xb = e[Gb + 40 >> 2] | 0;
                rb = ((xb & 65535) + ((hb & 65535) << 1) | 0) + ub | 0;
                tb = ((xb >>> 16) + (hb >>> 16 << 1) | 0) + (rb >>> 16) | 0;
                e[Gb + 40 >> 2] = tb << 16 | rb & 65535;
                ub = tb >>> 16;
                xb = e[Gb + 44 >> 2] | 0;
                rb = ((xb & 65535) + ((ib & 65535) << 1) | 0) + ub | 0;
                tb = ((xb >>> 16) + (ib >>> 16 << 1) | 0) + (rb >>> 16) | 0;
                e[Gb + 44 >> 2] = tb << 16 | rb & 65535;
                ub = tb >>> 16;
                for (Db = 48; !!ub & (Db | 0) < 64; Db = Db + 4 | 0) {
                    xb = e[Gb + Db >> 2] | 0;
                    rb = (xb & 65535) + ub | 0;
                    tb = (xb >>> 16) + (rb >>> 16) | 0;
                    e[Gb + Db >> 2] = tb << 16 | rb & 65535;
                    ub = tb >>> 16
                }
            }
            for (yb = 32;
                (yb | 0) < (v | 0); yb = yb << 1) {
                zb = yb << 1;
                for (Ab = 0;
                    (Ab | 0) < (v | 0); Ab = Ab + zb | 0) {
                    Gb = w + (Ab << 1) | 0;
                    vb = 0;
                    for (Bb = 0;
                        (Bb | 0) < (yb | 0); Bb = Bb + 32 | 0) {
                        Eb = (u + Ab | 0) + Bb | 0;
                        F = e[Eb >> 2] | 0,
                        x = F & 65535,
                        F = F >>> 16,
                        G = e[(Eb | 4) >> 2] | 0,
                        y = G & 65535,
                        G = G >>> 16,
                        H = e[(Eb | 8) >> 2] | 0,
                        z = H & 65535,
                        H = H >>> 16,
                        I = e[(Eb | 12) >> 2] | 0,
                        A = I & 65535,
                        I = I >>> 16,
                        J = e[(Eb | 16) >> 2] | 0,
                        B = J & 65535,
                        J = J >>> 16,
                        K = e[(Eb | 20) >> 2] | 0,
                        C = K & 65535,
                        K = K >>> 16,
                        L = e[(Eb | 24) >> 2] | 0,
                        D = L & 65535,
                        L = L >>> 16,
                        M = e[(Eb | 28) >> 2] | 0,
                        E = M & 65535,
                        M = M >>> 16;
                        jb = kb = lb = mb = nb = ob = pb = qb = ub = 0;
                        for (Cb = 0;
                            (Cb | 0) < (yb | 0); Cb = Cb + 32 | 0) {
                            Fb = ((u + Ab | 0) + yb | 0) + Cb | 0;
                            V = e[Fb >> 2] | 0,
                            N = V & 65535,
                            V = V >>> 16,
                            W = e[(Fb | 4) >> 2] | 0,
                            O = W & 65535,
                            W = W >>> 16,
                            X = e[(Fb | 8) >> 2] | 0,
                            P = X & 65535,
                            X = X >>> 16,
                            Y = e[(Fb | 12) >> 2] | 0,
                            Q = Y & 65535,
                            Y = Y >>> 16,
                            Z = e[(Fb | 16) >> 2] | 0,
                            R = Z & 65535,
                            Z = Z >>> 16,
                            $ = e[(Fb | 20) >> 2] | 0,
                            S = $ & 65535,
                            $ = $ >>> 16,
                            _ = e[(Fb | 24) >> 2] | 0,
                            T = _ & 65535,
                            _ = _ >>> 16,
                            ab = e[(Fb | 28) >> 2] | 0,
                            U = ab & 65535,
                            ab = ab >>> 16;
                            bb = cb = db = eb = fb = gb = hb = ib = 0;
                            rb = ((f(x, N) | 0) + (bb & 65535) | 0) + (jb & 65535) | 0;
                            sb = ((f(F, N) | 0) + (bb >>> 16) | 0) + (jb >>> 16) | 0;
                            tb = ((f(x, V) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                            wb = ((f(F, V) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                            bb = tb << 16 | rb & 65535;
                            rb = ((f(x, O) | 0) + (cb & 65535) | 0) + (wb & 65535) | 0;
                            sb = ((f(F, O) | 0) + (cb >>> 16) | 0) + (wb >>> 16) | 0;
                            tb = ((f(x, W) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                            wb = ((f(F, W) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                            cb = tb << 16 | rb & 65535;
                            rb = ((f(x, P) | 0) + (db & 65535) | 0) + (wb & 65535) | 0;
                            sb = ((f(F, P) | 0) + (db >>> 16) | 0) + (wb >>> 16) | 0;
                            tb = ((f(x, X) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                            wb = ((f(F, X) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                            db = tb << 16 | rb & 65535;
                            rb = ((f(x, Q) | 0) + (eb & 65535) | 0) + (wb & 65535) | 0;
                            sb = ((f(F, Q) | 0) + (eb >>> 16) | 0) + (wb >>> 16) | 0;
                            tb = ((f(x, Y) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                            wb = ((f(F, Y) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                            eb = tb << 16 | rb & 65535;
                            rb = ((f(x, R) | 0) + (fb & 65535) | 0) + (wb & 65535) | 0;
                            sb = ((f(F, R) | 0) + (fb >>> 16) | 0) + (wb >>> 16) | 0;
                            tb = ((f(x, Z) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                            wb = ((f(F, Z) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                            fb = tb << 16 | rb & 65535;
                            rb = ((f(x, S) | 0) + (gb & 65535) | 0) + (wb & 65535) | 0;
                            sb = ((f(F, S) | 0) + (gb >>> 16) | 0) + (wb >>> 16) | 0;
                            tb = ((f(x, $) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                            wb = ((f(F, $) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                            gb = tb << 16 | rb & 65535;
                            rb = ((f(x, T) | 0) + (hb & 65535) | 0) + (wb & 65535) | 0;
                            sb = ((f(F, T) | 0) + (hb >>> 16) | 0) + (wb >>> 16) | 0;
                            tb = ((f(x, _) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                            wb = ((f(F, _) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                            hb = tb << 16 | rb & 65535;
                            rb = ((f(x, U) | 0) + (ib & 65535) | 0) + (wb & 65535) | 0;
                            sb = ((f(F, U) | 0) + (ib >>> 16) | 0) + (wb >>> 16) | 0;
                            tb = ((f(x, ab) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                            wb = ((f(F, ab) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                            ib = tb << 16 | rb & 65535;
                            jb = wb;
                            rb = ((f(y, N) | 0) + (cb & 65535) | 0) + (kb & 65535) | 0;
                            sb = ((f(G, N) | 0) + (cb >>> 16) | 0) + (kb >>> 16) | 0;
                            tb = ((f(y, V) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                            wb = ((f(G, V) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                            cb = tb << 16 | rb & 65535;
                            rb = ((f(y, O) | 0) + (db & 65535) | 0) + (wb & 65535) | 0;
                            sb = ((f(G, O) | 0) + (db >>> 16) | 0) + (wb >>> 16) | 0;
                            tb = ((f(y, W) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                            wb = ((f(G, W) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                            db = tb << 16 | rb & 65535;
                            rb = ((f(y, P) | 0) + (eb & 65535) | 0) + (wb & 65535) | 0;
                            sb = ((f(G, P) | 0) + (eb >>> 16) | 0) + (wb >>> 16) | 0;
                            tb = ((f(y, X) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                            wb = ((f(G, X) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                            eb = tb << 16 | rb & 65535;
                            rb = ((f(y, Q) | 0) + (fb & 65535) | 0) + (wb & 65535) | 0;
                            sb = ((f(G, Q) | 0) + (fb >>> 16) | 0) + (wb >>> 16) | 0;
                            tb = ((f(y, Y) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                            wb = ((f(G, Y) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                            fb = tb << 16 | rb & 65535;
                            rb = ((f(y, R) | 0) + (gb & 65535) | 0) + (wb & 65535) | 0;
                            sb = ((f(G, R) | 0) + (gb >>> 16) | 0) + (wb >>> 16) | 0;
                            tb = ((f(y, Z) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                            wb = ((f(G, Z) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                            gb = tb << 16 | rb & 65535;
                            rb = ((f(y, S) | 0) + (hb & 65535) | 0) + (wb & 65535) | 0;
                            sb = ((f(G, S) | 0) + (hb >>> 16) | 0) + (wb >>> 16) | 0;
                            tb = ((f(y, $) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                            wb = ((f(G, $) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                            hb = tb << 16 | rb & 65535;
                            rb = ((f(y, T) | 0) + (ib & 65535) | 0) + (wb & 65535) | 0;
                            sb = ((f(G, T) | 0) + (ib >>> 16) | 0) + (wb >>> 16) | 0;
                            tb = ((f(y, _) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                            wb = ((f(G, _) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                            ib = tb << 16 | rb & 65535;
                            rb = ((f(y, U) | 0) + (jb & 65535) | 0) + (wb & 65535) | 0;
                            sb = ((f(G, U) | 0) + (jb >>> 16) | 0) + (wb >>> 16) | 0;
                            tb = ((f(y, ab) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                            wb = ((f(G, ab) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                            jb = tb << 16 | rb & 65535;
                            kb = wb;
                            rb = ((f(z, N) | 0) + (db & 65535) | 0) + (lb & 65535) | 0;
                            sb = ((f(H, N) | 0) + (db >>> 16) | 0) + (lb >>> 16) | 0;
                            tb = ((f(z, V) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                            wb = ((f(H, V) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                            db = tb << 16 | rb & 65535;
                            rb = ((f(z, O) | 0) + (eb & 65535) | 0) + (wb & 65535) | 0;
                            sb = ((f(H, O) | 0) + (eb >>> 16) | 0) + (wb >>> 16) | 0;
                            tb = ((f(z, W) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                            wb = ((f(H, W) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                            eb = tb << 16 | rb & 65535;
                            rb = ((f(z, P) | 0) + (fb & 65535) | 0) + (wb & 65535) | 0;
                            sb = ((f(H, P) | 0) + (fb >>> 16) | 0) + (wb >>> 16) | 0;
                            tb = ((f(z, X) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                            wb = ((f(H, X) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                            fb = tb << 16 | rb & 65535;
                            rb = ((f(z, Q) | 0) + (gb & 65535) | 0) + (wb & 65535) | 0;
                            sb = ((f(H, Q) | 0) + (gb >>> 16) | 0) + (wb >>> 16) | 0;
                            tb = ((f(z, Y) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                            wb = ((f(H, Y) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                            gb = tb << 16 | rb & 65535;
                            rb = ((f(z, R) | 0) + (hb & 65535) | 0) + (wb & 65535) | 0;
                            sb = ((f(H, R) | 0) + (hb >>> 16) | 0) + (wb >>> 16) | 0;
                            tb = ((f(z, Z) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                            wb = ((f(H, Z) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                            hb = tb << 16 | rb & 65535;
                            rb = ((f(z, S) | 0) + (ib & 65535) | 0) + (wb & 65535) | 0;
                            sb = ((f(H, S) | 0) + (ib >>> 16) | 0) + (wb >>> 16) | 0;
                            tb = ((f(z, $) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                            wb = ((f(H, $) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                            ib = tb << 16 | rb & 65535;
                            rb = ((f(z, T) | 0) + (jb & 65535) | 0) + (wb & 65535) | 0;
                            sb = ((f(H, T) | 0) + (jb >>> 16) | 0) + (wb >>> 16) | 0;
                            tb = ((f(z, _) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                            wb = ((f(H, _) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                            jb = tb << 16 | rb & 65535;
                            rb = ((f(z, U) | 0) + (kb & 65535) | 0) + (wb & 65535) | 0;
                            sb = ((f(H, U) | 0) + (kb >>> 16) | 0) + (wb >>> 16) | 0;
                            tb = ((f(z, ab) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                            wb = ((f(H, ab) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                            kb = tb << 16 | rb & 65535;
                            lb = wb;
                            rb = ((f(A, N) | 0) + (eb & 65535) | 0) + (mb & 65535) | 0;
                            sb = ((f(I, N) | 0) + (eb >>> 16) | 0) + (mb >>> 16) | 0;
                            tb = ((f(A, V) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                            wb = ((f(I, V) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                            eb = tb << 16 | rb & 65535;
                            rb = ((f(A, O) | 0) + (fb & 65535) | 0) + (wb & 65535) | 0;
                            sb = ((f(I, O) | 0) + (fb >>> 16) | 0) + (wb >>> 16) | 0;
                            tb = ((f(A, W) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                            wb = ((f(I, W) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                            fb = tb << 16 | rb & 65535;
                            rb = ((f(A, P) | 0) + (gb & 65535) | 0) + (wb & 65535) | 0;
                            sb = ((f(I, P) | 0) + (gb >>> 16) | 0) + (wb >>> 16) | 0;
                            tb = ((f(A, X) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                            wb = ((f(I, X) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                            gb = tb << 16 | rb & 65535;
                            rb = ((f(A, Q) | 0) + (hb & 65535) | 0) + (wb & 65535) | 0;
                            sb = ((f(I, Q) | 0) + (hb >>> 16) | 0) + (wb >>> 16) | 0;
                            tb = ((f(A, Y) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                            wb = ((f(I, Y) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                            hb = tb << 16 | rb & 65535;
                            rb = ((f(A, R) | 0) + (ib & 65535) | 0) + (wb & 65535) | 0;
                            sb = ((f(I, R) | 0) + (ib >>> 16) | 0) + (wb >>> 16) | 0;
                            tb = ((f(A, Z) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                            wb = ((f(I, Z) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                            ib = tb << 16 | rb & 65535;
                            rb = ((f(A, S) | 0) + (jb & 65535) | 0) + (wb & 65535) | 0;
                            sb = ((f(I, S) | 0) + (jb >>> 16) | 0) + (wb >>> 16) | 0;
                            tb = ((f(A, $) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                            wb = ((f(I, $) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                            jb = tb << 16 | rb & 65535;
                            rb = ((f(A, T) | 0) + (kb & 65535) | 0) + (wb & 65535) | 0;
                            sb = ((f(I, T) | 0) + (kb >>> 16) | 0) + (wb >>> 16) | 0;
                            tb = ((f(A, _) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                            wb = ((f(I, _) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                            kb = tb << 16 | rb & 65535;
                            rb = ((f(A, U) | 0) + (lb & 65535) | 0) + (wb & 65535) | 0;
                            sb = ((f(I, U) | 0) + (lb >>> 16) | 0) + (wb >>> 16) | 0;
                            tb = ((f(A, ab) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                            wb = ((f(I, ab) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                            lb = tb << 16 | rb & 65535;
                            mb = wb;
                            rb = ((f(B, N) | 0) + (fb & 65535) | 0) + (nb & 65535) | 0;
                            sb = ((f(J, N) | 0) + (fb >>> 16) | 0) + (nb >>> 16) | 0;
                            tb = ((f(B, V) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                            wb = ((f(J, V) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                            fb = tb << 16 | rb & 65535;
                            rb = ((f(B, O) | 0) + (gb & 65535) | 0) + (wb & 65535) | 0;
                            sb = ((f(J, O) | 0) + (gb >>> 16) | 0) + (wb >>> 16) | 0;
                            tb = ((f(B, W) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                            wb = ((f(J, W) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                            gb = tb << 16 | rb & 65535;
                            rb = ((f(B, P) | 0) + (hb & 65535) | 0) + (wb & 65535) | 0;
                            sb = ((f(J, P) | 0) + (hb >>> 16) | 0) + (wb >>> 16) | 0;
                            tb = ((f(B, X) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                            wb = ((f(J, X) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                            hb = tb << 16 | rb & 65535;
                            rb = ((f(B, Q) | 0) + (ib & 65535) | 0) + (wb & 65535) | 0;
                            sb = ((f(J, Q) | 0) + (ib >>> 16) | 0) + (wb >>> 16) | 0;
                            tb = ((f(B, Y) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                            wb = ((f(J, Y) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                            ib = tb << 16 | rb & 65535;
                            rb = ((f(B, R) | 0) + (jb & 65535) | 0) + (wb & 65535) | 0;
                            sb = ((f(J, R) | 0) + (jb >>> 16) | 0) + (wb >>> 16) | 0;
                            tb = ((f(B, Z) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                            wb = ((f(J, Z) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                            jb = tb << 16 | rb & 65535;
                            rb = ((f(B, S) | 0) + (kb & 65535) | 0) + (wb & 65535) | 0;
                            sb = ((f(J, S) | 0) + (kb >>> 16) | 0) + (wb >>> 16) | 0;
                            tb = ((f(B, $) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                            wb = ((f(J, $) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                            kb = tb << 16 | rb & 65535;
                            rb = ((f(B, T) | 0) + (lb & 65535) | 0) + (wb & 65535) | 0;
                            sb = ((f(J, T) | 0) + (lb >>> 16) | 0) + (wb >>> 16) | 0;
                            tb = ((f(B, _) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                            wb = ((f(J, _) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                            lb = tb << 16 | rb & 65535;
                            rb = ((f(B, U) | 0) + (mb & 65535) | 0) + (wb & 65535) | 0;
                            sb = ((f(J, U) | 0) + (mb >>> 16) | 0) + (wb >>> 16) | 0;
                            tb = ((f(B, ab) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                            wb = ((f(J, ab) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                            mb = tb << 16 | rb & 65535;
                            nb = wb;
                            rb = ((f(C, N) | 0) + (gb & 65535) | 0) + (ob & 65535) | 0;
                            sb = ((f(K, N) | 0) + (gb >>> 16) | 0) + (ob >>> 16) | 0;
                            tb = ((f(C, V) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                            wb = ((f(K, V) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                            gb = tb << 16 | rb & 65535;
                            rb = ((f(C, O) | 0) + (hb & 65535) | 0) + (wb & 65535) | 0;
                            sb = ((f(K, O) | 0) + (hb >>> 16) | 0) + (wb >>> 16) | 0;
                            tb = ((f(C, W) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                            wb = ((f(K, W) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                            hb = tb << 16 | rb & 65535;
                            rb = ((f(C, P) | 0) + (ib & 65535) | 0) + (wb & 65535) | 0;
                            sb = ((f(K, P) | 0) + (ib >>> 16) | 0) + (wb >>> 16) | 0;
                            tb = ((f(C, X) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                            wb = ((f(K, X) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                            ib = tb << 16 | rb & 65535;
                            rb = ((f(C, Q) | 0) + (jb & 65535) | 0) + (wb & 65535) | 0;
                            sb = ((f(K, Q) | 0) + (jb >>> 16) | 0) + (wb >>> 16) | 0;
                            tb = ((f(C, Y) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                            wb = ((f(K, Y) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                            jb = tb << 16 | rb & 65535;
                            rb = ((f(C, R) | 0) + (kb & 65535) | 0) + (wb & 65535) | 0;
                            sb = ((f(K, R) | 0) + (kb >>> 16) | 0) + (wb >>> 16) | 0;
                            tb = ((f(C, Z) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                            wb = ((f(K, Z) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                            kb = tb << 16 | rb & 65535;
                            rb = ((f(C, S) | 0) + (lb & 65535) | 0) + (wb & 65535) | 0;
                            sb = ((f(K, S) | 0) + (lb >>> 16) | 0) + (wb >>> 16) | 0;
                            tb = ((f(C, $) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                            wb = ((f(K, $) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                            lb = tb << 16 | rb & 65535;
                            rb = ((f(C, T) | 0) + (mb & 65535) | 0) + (wb & 65535) | 0;
                            sb = ((f(K, T) | 0) + (mb >>> 16) | 0) + (wb >>> 16) | 0;
                            tb = ((f(C, _) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                            wb = ((f(K, _) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                            mb = tb << 16 | rb & 65535;
                            rb = ((f(C, U) | 0) + (nb & 65535) | 0) + (wb & 65535) | 0;
                            sb = ((f(K, U) | 0) + (nb >>> 16) | 0) + (wb >>> 16) | 0;
                            tb = ((f(C, ab) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                            wb = ((f(K, ab) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                            nb = tb << 16 | rb & 65535;
                            ob = wb;
                            rb = ((f(D, N) | 0) + (hb & 65535) | 0) + (pb & 65535) | 0;
                            sb = ((f(L, N) | 0) + (hb >>> 16) | 0) + (pb >>> 16) | 0;
                            tb = ((f(D, V) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                            wb = ((f(L, V) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                            hb = tb << 16 | rb & 65535;
                            rb = ((f(D, O) | 0) + (ib & 65535) | 0) + (wb & 65535) | 0;
                            sb = ((f(L, O) | 0) + (ib >>> 16) | 0) + (wb >>> 16) | 0;
                            tb = ((f(D, W) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                            wb = ((f(L, W) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                            ib = tb << 16 | rb & 65535;
                            rb = ((f(D, P) | 0) + (jb & 65535) | 0) + (wb & 65535) | 0;
                            sb = ((f(L, P) | 0) + (jb >>> 16) | 0) + (wb >>> 16) | 0;
                            tb = ((f(D, X) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                            wb = ((f(L, X) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                            jb = tb << 16 | rb & 65535;
                            rb = ((f(D, Q) | 0) + (kb & 65535) | 0) + (wb & 65535) | 0;
                            sb = ((f(L, Q) | 0) + (kb >>> 16) | 0) + (wb >>> 16) | 0;
                            tb = ((f(D, Y) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                            wb = ((f(L, Y) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                            kb = tb << 16 | rb & 65535;
                            rb = ((f(D, R) | 0) + (lb & 65535) | 0) + (wb & 65535) | 0;
                            sb = ((f(L, R) | 0) + (lb >>> 16) | 0) + (wb >>> 16) | 0;
                            tb = ((f(D, Z) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                            wb = ((f(L, Z) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                            lb = tb << 16 | rb & 65535;
                            rb = ((f(D, S) | 0) + (mb & 65535) | 0) + (wb & 65535) | 0;
                            sb = ((f(L, S) | 0) + (mb >>> 16) | 0) + (wb >>> 16) | 0;
                            tb = ((f(D, $) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                            wb = ((f(L, $) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                            mb = tb << 16 | rb & 65535;
                            rb = ((f(D, T) | 0) + (nb & 65535) | 0) + (wb & 65535) | 0;
                            sb = ((f(L, T) | 0) + (nb >>> 16) | 0) + (wb >>> 16) | 0;
                            tb = ((f(D, _) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                            wb = ((f(L, _) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                            nb = tb << 16 | rb & 65535;
                            rb = ((f(D, U) | 0) + (ob & 65535) | 0) + (wb & 65535) | 0;
                            sb = ((f(L, U) | 0) + (ob >>> 16) | 0) + (wb >>> 16) | 0;
                            tb = ((f(D, ab) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                            wb = ((f(L, ab) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                            ob = tb << 16 | rb & 65535;
                            pb = wb;
                            rb = ((f(E, N) | 0) + (ib & 65535) | 0) + (qb & 65535) | 0;
                            sb = ((f(M, N) | 0) + (ib >>> 16) | 0) + (qb >>> 16) | 0;
                            tb = ((f(E, V) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                            wb = ((f(M, V) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                            ib = tb << 16 | rb & 65535;
                            rb = ((f(E, O) | 0) + (jb & 65535) | 0) + (wb & 65535) | 0;
                            sb = ((f(M, O) | 0) + (jb >>> 16) | 0) + (wb >>> 16) | 0;
                            tb = ((f(E, W) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                            wb = ((f(M, W) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                            jb = tb << 16 | rb & 65535;
                            rb = ((f(E, P) | 0) + (kb & 65535) | 0) + (wb & 65535) | 0;
                            sb = ((f(M, P) | 0) + (kb >>> 16) | 0) + (wb >>> 16) | 0;
                            tb = ((f(E, X) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                            wb = ((f(M, X) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                            kb = tb << 16 | rb & 65535;
                            rb = ((f(E, Q) | 0) + (lb & 65535) | 0) + (wb & 65535) | 0;
                            sb = ((f(M, Q) | 0) + (lb >>> 16) | 0) + (wb >>> 16) | 0;
                            tb = ((f(E, Y) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                            wb = ((f(M, Y) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                            lb = tb << 16 | rb & 65535;
                            rb = ((f(E, R) | 0) + (mb & 65535) | 0) + (wb & 65535) | 0;
                            sb = ((f(M, R) | 0) + (mb >>> 16) | 0) + (wb >>> 16) | 0;
                            tb = ((f(E, Z) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                            wb = ((f(M, Z) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                            mb = tb << 16 | rb & 65535;
                            rb = ((f(E, S) | 0) + (nb & 65535) | 0) + (wb & 65535) | 0;
                            sb = ((f(M, S) | 0) + (nb >>> 16) | 0) + (wb >>> 16) | 0;
                            tb = ((f(E, $) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                            wb = ((f(M, $) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                            nb = tb << 16 | rb & 65535;
                            rb = ((f(E, T) | 0) + (ob & 65535) | 0) + (wb & 65535) | 0;
                            sb = ((f(M, T) | 0) + (ob >>> 16) | 0) + (wb >>> 16) | 0;
                            tb = ((f(E, _) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                            wb = ((f(M, _) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                            ob = tb << 16 | rb & 65535;
                            rb = ((f(E, U) | 0) + (pb & 65535) | 0) + (wb & 65535) | 0;
                            sb = ((f(M, U) | 0) + (pb >>> 16) | 0) + (wb >>> 16) | 0;
                            tb = ((f(E, ab) | 0) + (sb & 65535) | 0) + (rb >>> 16) | 0;
                            wb = ((f(M, ab) | 0) + (sb >>> 16) | 0) + (tb >>> 16) | 0;
                            pb = tb << 16 | rb & 65535;
                            qb = wb;
                            Db = yb + (Bb + Cb | 0) | 0;
                            xb = e[Gb + Db >> 2] | 0;
                            rb = ((xb & 65535) + ((bb & 65535) << 1) | 0) + ub | 0;
                            tb = ((xb >>> 16) + (bb >>> 16 << 1) | 0) + (rb >>> 16) | 0;
                            e[Gb + Db >> 2] = tb << 16 | rb & 65535;
                            ub = tb >>> 16;
                            Db = Db + 4 | 0;
                            xb = e[Gb + Db >> 2] | 0;
                            rb = ((xb & 65535) + ((cb & 65535) << 1) | 0) + ub | 0;
                            tb = ((xb >>> 16) + (cb >>> 16 << 1) | 0) + (rb >>> 16) | 0;
                            e[Gb + Db >> 2] = tb << 16 | rb & 65535;
                            ub = tb >>> 16;
                            Db = Db + 4 | 0;
                            xb = e[Gb + Db >> 2] | 0;
                            rb = ((xb & 65535) + ((db & 65535) << 1) | 0) + ub | 0;
                            tb = ((xb >>> 16) + (db >>> 16 << 1) | 0) + (rb >>> 16) | 0;
                            e[Gb + Db >> 2] = tb << 16 | rb & 65535;
                            ub = tb >>> 16;
                            Db = Db + 4 | 0;
                            xb = e[Gb + Db >> 2] | 0;
                            rb = ((xb & 65535) + ((eb & 65535) << 1) | 0) + ub | 0;
                            tb = ((xb >>> 16) + (eb >>> 16 << 1) | 0) + (rb >>> 16) | 0;
                            e[Gb + Db >> 2] = tb << 16 | rb & 65535;
                            ub = tb >>> 16;
                            Db = Db + 4 | 0;
                            xb = e[Gb + Db >> 2] | 0;
                            rb = ((xb & 65535) + ((fb & 65535) << 1) | 0) + ub | 0;
                            tb = ((xb >>> 16) + (fb >>> 16 << 1) | 0) + (rb >>> 16) | 0;
                            e[Gb + Db >> 2] = tb << 16 | rb & 65535;
                            ub = tb >>> 16;
                            Db = Db + 4 | 0;
                            xb = e[Gb + Db >> 2] | 0;
                            rb = ((xb & 65535) + ((gb & 65535) << 1) | 0) + ub | 0;
                            tb = ((xb >>> 16) + (gb >>> 16 << 1) | 0) + (rb >>> 16) | 0;
                            e[Gb + Db >> 2] = tb << 16 | rb & 65535;
                            ub = tb >>> 16;
                            Db = Db + 4 | 0;
                            xb = e[Gb + Db >> 2] | 0;
                            rb = ((xb & 65535) + ((hb & 65535) << 1) | 0) + ub | 0;
                            tb = ((xb >>> 16) + (hb >>> 16 << 1) | 0) + (rb >>> 16) | 0;
                            e[Gb + Db >> 2] = tb << 16 | rb & 65535;
                            ub = tb >>> 16;
                            Db = Db + 4 | 0;
                            xb = e[Gb + Db >> 2] | 0;
                            rb = ((xb & 65535) + ((ib & 65535) << 1) | 0) + ub | 0;
                            tb = ((xb >>> 16) + (ib >>> 16 << 1) | 0) + (rb >>> 16) | 0;
                            e[Gb + Db >> 2] = tb << 16 | rb & 65535;
                            ub = tb >>> 16
                        }
                        Db = yb + (Bb + Cb | 0) | 0;
                        xb = e[Gb + Db >> 2] | 0;
                        rb = (((xb & 65535) + ((jb & 65535) << 1) | 0) + ub | 0) + vb | 0;
                        tb = ((xb >>> 16) + (jb >>> 16 << 1) | 0) + (rb >>> 16) | 0;
                        e[Gb + Db >> 2] = tb << 16 | rb & 65535;
                        ub = tb >>> 16;
                        Db = Db + 4 | 0;
                        xb = e[Gb + Db >> 2] | 0;
                        rb = ((xb & 65535) + ((kb & 65535) << 1) | 0) + ub | 0;
                        tb = ((xb >>> 16) + (kb >>> 16 << 1) | 0) + (rb >>> 16) | 0;
                        e[Gb + Db >> 2] = tb << 16 | rb & 65535;
                        ub = tb >>> 16;
                        Db = Db + 4 | 0;
                        xb = e[Gb + Db >> 2] | 0;
                        rb = ((xb & 65535) + ((lb & 65535) << 1) | 0) + ub | 0;
                        tb = ((xb >>> 16) + (lb >>> 16 << 1) | 0) + (rb >>> 16) | 0;
                        e[Gb + Db >> 2] = tb << 16 | rb & 65535;
                        ub = tb >>> 16;
                        Db = Db + 4 | 0;
                        xb = e[Gb + Db >> 2] | 0;
                        rb = ((xb & 65535) + ((mb & 65535) << 1) | 0) + ub | 0;
                        tb = ((xb >>> 16) + (mb >>> 16 << 1) | 0) + (rb >>> 16) | 0;
                        e[Gb + Db >> 2] = tb << 16 | rb & 65535;
                        ub = tb >>> 16;
                        Db = Db + 4 | 0;
                        xb = e[Gb + Db >> 2] | 0;
                        rb = ((xb & 65535) + ((nb & 65535) << 1) | 0) + ub | 0;
                        tb = ((xb >>> 16) + (nb >>> 16 << 1) | 0) + (rb >>> 16) | 0;
                        e[Gb + Db >> 2] = tb << 16 | rb & 65535;
                        ub = tb >>> 16;
                        Db = Db + 4 | 0;
                        xb = e[Gb + Db >> 2] | 0;
                        rb = ((xb & 65535) + ((ob & 65535) << 1) | 0) + ub | 0;
                        tb = ((xb >>> 16) + (ob >>> 16 << 1) | 0) + (rb >>> 16) | 0;
                        e[Gb + Db >> 2] = tb << 16 | rb & 65535;
                        ub = tb >>> 16;
                        Db = Db + 4 | 0;
                        xb = e[Gb + Db >> 2] | 0;
                        rb = ((xb & 65535) + ((pb & 65535) << 1) | 0) + ub | 0;
                        tb = ((xb >>> 16) + (pb >>> 16 << 1) | 0) + (rb >>> 16) | 0;
                        e[Gb + Db >> 2] = tb << 16 | rb & 65535;
                        ub = tb >>> 16;
                        Db = Db + 4 | 0;
                        xb = e[Gb + Db >> 2] | 0;
                        rb = ((xb & 65535) + ((qb & 65535) << 1) | 0) + ub | 0;
                        tb = ((xb >>> 16) + (qb >>> 16 << 1) | 0) + (rb >>> 16) | 0;
                        e[Gb + Db >> 2] = tb << 16 | rb & 65535;
                        vb = tb >>> 16
                    }
                    for (Db = Db + 4 | 0; !!vb & (Db | 0) < zb << 1; Db = Db + 4 | 0) {
                        xb = e[Gb + Db >> 2] | 0;
                        rb = (xb & 65535) + vb | 0;
                        tb = (xb >>> 16) + (rb >>> 16) | 0;
                        e[Gb + Db >> 2] = tb << 16 | rb & 65535;
                        vb = tb >>> 16
                    }
                }
            }
        }

        function s(u, v, w, x, y, z) {
            u = u | 0;
            v = v | 0;
            w = w | 0;
            x = x | 0;
            y = y | 0;
            z = z | 0;
            var A = 0,
                B = 0,
                C = 0,
                D = 0,
                E = 0,
                F = 0,
                G = 0,
                H = 0,
                I = 0,
                J = 0,
                K = 0,
                L = 0,
                M = 0,
                N = 0,
                O = 0,
                P = 0,
                Q = 0,
                R = 0,
                S = 0;
            j(v, u, y);
            for (Q = v - 1 & -4;
                (Q | 0) >= 0; Q = Q - 4 | 0) {
                A = e[u + Q >> 2] | 0;
                if (A) {
                    v = Q;
                    break
                }
            }
            for (Q = x - 1 & -4;
                (Q | 0) >= 0; Q = Q - 4 | 0) {
                B = e[w + Q >> 2] | 0;
                if (B) {
                    x = Q;
                    break
                }
            }
            while ((B & 2147483648) == 0) {
                B = B << 1;
                C = C + 1 | 0
            }
            E = e[u + v >> 2] | 0;
            if (C) D = E >>> (32 - C | 0);
            for (Q = v - 4 | 0;
                (Q | 0) >= 0; Q = Q - 4 | 0) {
                A = e[u + Q >> 2] | 0;
                e[y + Q + 4 >> 2] = E << C | (C ? A >>> (32 - C | 0) : 0);
                E = A
            }
            e[y >> 2] = E << C;
            if (C) {
                F = e[w + x >> 2] | 0;
                for (Q = x - 4 | 0;
                    (Q | 0) >= 0; Q = Q - 4 | 0) {
                    B = e[w + Q >> 2] | 0;
                    e[w + Q + 4 >> 2] = F << C | B >>> (32 - C | 0);
                    F = B
                }
                e[w >> 2] = F << C
            }
            F = e[w + x >> 2] | 0;
            G = F >>> 16,
            H = F & 65535;
            for (Q = v;
                (Q | 0) >= (x | 0); Q = Q - 4 | 0) {
                R = Q - x | 0;
                E = e[y + Q >> 2] | 0;
                I = (D >>> 0) / (G >>> 0) | 0,
                K = (D >>> 0) % (G >>> 0) | 0,
                M = f(I, H) | 0;
                while ((I | 0) == 65536 | M >>> 0 > (K << 16 | E >>> 16) >>> 0) {
                    I = I - 1 | 0,
                    K = K + G | 0,
                    M = M - H | 0;
                    if ((K | 0) >= 65536) break
                }
                O = 0,
                P = 0;
                for (S = 0;
                    (S | 0) <= (x | 0); S = S + 4 | 0) {
                    B = e[w + S >> 2] | 0;
                    M = (f(I, B & 65535) | 0) + (O >>> 16) | 0;
                    N = (f(I, B >>> 16) | 0) + (M >>> 16) | 0;
                    B = O & 65535 | M << 16;
                    O = N;
                    A = e[y + R + S >> 2] | 0;
                    M = ((A & 65535) - (B & 65535) | 0) + P | 0;
                    N = ((A >>> 16) - (B >>> 16) | 0) + (M >> 16) | 0;
                    e[y + R + S >> 2] = N << 16 | M & 65535;
                    P = N >> 16
                }
                M = ((D & 65535) - (O & 65535) | 0) + P | 0;
                N = ((D >>> 16) - (O >>> 16) | 0) + (M >> 16) | 0;
                e[y + R + S >> 2] = D = N << 16 | M & 65535;
                P = N >> 16;
                if (P) {
                    I = I - 1 | 0,
                    K = K - G | 0;
                    P = 0;
                    for (S = 0;
                        (S | 0) <= (x | 0); S = S + 4 | 0) {
                        B = e[w + S >> 2] | 0;
                        A = e[y + R + S >> 2] | 0;
                        M = ((A & 65535) + (B & 65535) | 0) + P | 0;
                        N = ((A >>> 16) + (B >>> 16) | 0) + (M >>> 16) | 0;
                        e[y + R + S >> 2] = N << 16 | M & 65535;
                        P = N >>> 16
                    }
                    e[y + R + S >> 2] = D = D + P | 0
                }
                E = e[y + Q >> 2] | 0;
                A = D << 16 | E >>> 16;
                J = (A >>> 0) / (G >>> 0) | 0,
                L = (A >>> 0) % (G >>> 0) | 0,
                M = f(J, H) | 0;
                while ((J | 0) == 65536 | M >>> 0 > (L << 16 | E & 65535) >>> 0) {
                    J = J - 1 | 0,
                    L = L + G | 0,
                    M = M - H | 0;
                    if ((L | 0) >= 65536) break
                }
                O = 0,
                P = 0;
                for (S = 0;
                    (S | 0) <= (x | 0); S = S + 4 | 0) {
                    B = e[w + S >> 2] | 0;
                    M = (f(J, B & 65535) | 0) + (O & 65535) | 0;
                    N = ((f(J, B >>> 16) | 0) + (M >>> 16) | 0) + (O >>> 16) | 0;
                    B = M & 65535 | N << 16;
                    O = N >>> 16;
                    A = e[y + R + S >> 2] | 0;
                    M = ((A & 65535) - (B & 65535) | 0) + P | 0;
                    N = ((A >>> 16) - (B >>> 16) | 0) + (M >> 16) | 0;
                    P = N >> 16;
                    e[y + R + S >> 2] = N << 16 | M & 65535
                }
                M = ((D & 65535) - (O & 65535) | 0) + P | 0;
                N = ((D >>> 16) - (O >>> 16) | 0) + (M >> 16) | 0;
                e[y + R + S >> 2] = D = N << 16 | M & 65535;
                P = N >> 16;
                if (P) {
                    J = J - 1 | 0,
                    L = L + G | 0;
                    P = 0;
                    for (S = 0;
                        (S | 0) <= (x | 0); S = S + 4 | 0) {
                        B = e[w + S >> 2] | 0;
                        A = e[y + R + S >> 2] | 0;
                        M = ((A & 65535) + (B & 65535) | 0) + P | 0;
                        N = ((A >>> 16) + (B >>> 16) | 0) + (M >>> 16) | 0;
                        P = N >>> 16;
                        e[y + R + S >> 2] = M & 65535 | N << 16
                    }
                    e[y + R + S >> 2] = D + P | 0
                }
                e[z + R >> 2] = I << 16 | J;
                D = e[y + Q >> 2] | 0
            }
            if (C) {
                E = e[y >> 2] | 0;
                for (Q = 4;
                    (Q | 0) <= (x | 0); Q = Q + 4 | 0) {
                    A = e[y + Q >> 2] | 0;
                    e[y + Q - 4 >> 2] = A << (32 - C | 0) | E >>> C;
                    E = A
                }
                e[y + x >> 2] = E >>> C
            }
        }

        function t(u, v, w, x, y, z) {
            u = u | 0;
            v = v | 0;
            w = w | 0;
            x = x | 0;
            y = y | 0;
            z = z | 0;
            var A = 0,
                B = 0,
                C = 0,
                D = 0,
                E = 0,
                F = 0,
                G = 0,
                H = 0,
                I = 0,
                J = 0,
                K = 0,
                L = 0,
                M = 0,
                N = 0;
            A = h(x << 1) | 0;
            k(x << 1, 0, A);
            j(v, u, A);
            for (L = 0;
                (L | 0) < (x | 0); L = L + 4 | 0) {
                C = e[A + L >> 2] | 0,
                D = C & 65535,
                C = C >>> 16;
                F = y >>> 16,
                E = y & 65535;
                G = f(D, E) | 0,
                H = ((f(D, F) | 0) + (f(C, E) | 0) | 0) + (G >>> 16) | 0;
                D = G & 65535,
                C = H & 65535;
                K = 0;
                for (M = 0;
                    (M | 0) < (x | 0); M = M + 4 | 0) {
                    N = L + M | 0;
                    F = e[w + M >> 2] | 0,
                    E = F & 65535,
                    F = F >>> 16;
                    J = e[A + N >> 2] | 0;
                    G = ((f(D, E) | 0) + (K & 65535) | 0) + (J & 65535) | 0;
                    H = ((f(D, F) | 0) + (K >>> 16) | 0) + (J >>> 16) | 0;
                    I = ((f(C, E) | 0) + (H & 65535) | 0) + (G >>> 16) | 0;
                    K = ((f(C, F) | 0) + (I >>> 16) | 0) + (H >>> 16) | 0;
                    J = I << 16 | G & 65535;
                    e[A + N >> 2] = J
                }
                N = L + M | 0;
                J = e[A + N >> 2] | 0;
                G = ((J & 65535) + (K & 65535) | 0) + B | 0;
                H = ((J >>> 16) + (K >>> 16) | 0) + (G >>> 16) | 0;
                e[A + N >> 2] = H << 16 | G & 65535;
                B = H >>> 16
            }
            j(x, A + x | 0, z);
            i(x << 1);
            if (B | (m(w, x, z, x) | 0) <= 0) {
                p(z, x, w, x, z, x) | 0
            }
        }
        return {
            sreset: g,
            salloc: h,
            sfree: i,
            z: k,
            tst: n,
            neg: l,
            cmp: m,
            add: o,
            sub: p,
            mul: q,
            sqr: r,
            div: s,
            mredc: t
        }
    }

    function tc(a) {
        return a instanceof uc
    }

    function uc(a) {
        var b = ge,
            c = 0,
            d = 0;
        if (n(a) && (a = f(a)), o(a) && (a = new Uint8Array(a)), void 0 === a);
        else if (m(a)) {
            var e = Math.abs(a);
            e > 4294967295 ? (b = new Uint32Array(2), b[0] = 0 | e, b[1] = e / 4294967296 | 0, c = 52) : e > 0 ? (b = new Uint32Array(1), b[0] = e, c = 32) : (b = ge, c = 0),
            d = 0 > a ? -1 : 1
        } else if (p(a)) {
            if (c = 8 * a.length, !c) return ie;
            b = new Uint32Array(c + 31 >> 5);
            for (var g = a.length - 4; g >= 0; g -= 4) b[a.length - 4 - g >> 2] = a[g] << 24 | a[g + 1] << 16 | a[g + 2] << 8 | a[g + 3]; - 3 === g ? b[b.length - 1] = a[0] : -2 === g ? b[b.length - 1] = a[0] << 8 | a[1] : -1 === g && (b[b.length - 1] = a[0] << 16 | a[1] << 8 | a[2]),
            d = 1
        } else {
            if ('object' != typeof a || null === a) throw new TypeError('number is of unexpected type');
            b = new Uint32Array(a.limbs),
            c = a.bitLength,
            d = a.sign
        }
        this.limbs = b,
        this.bitLength = c,
        this.sign = d
    }

    function vc(a) {
        a = a || 16;
        var b = this.limbs,
            c = this.bitLength,
            e = '';
        if (16 !== a) throw new d('bad radix');
        for (var f = (c + 31 >> 5) - 1; f >= 0; f--) {
            var g = b[f].toString(16);
            e += '00000000'.substr(g.length),
            e += g
        }
        return e = e.replace(/^0+/, ''),
            e.length || (e = '0'),
            this.sign < 0 && (e = '-' + e),
            e
    }

    function wc() {
        var a = this.bitLength,
            b = this.limbs;
        if (0 === a) return new Uint8Array(0);
        for (var c = a + 7 >> 3, d = new Uint8Array(c), e = 0; c > e; e++) {
            var f = c - e - 1;
            d[e] = b[f >> 2] >> ((3 & f) << 3)
        }
        return d
    }

    function xc() {
        var a = this.limbs,
            b = this.bitLength,
            c = this.sign;
        if (!c) return 0;
        if (32 >= b) return c * (a[0] >>> 0);
        if (52 >= b) return c * (4294967296 * (a[1] >>> 0) + (a[0] >>> 0));
        var d,
            e,
            f = 0;
        for (d = a.length - 1; d >= 0; d--)
            if (0 !== (e = a[d])) {
                for (; 0 === (e << f & 2147483648);) f++;
                break
            }
        return 0 === d ? c * (a[0] >>> 0) : c * (1048576 * ((a[d] << f | (f ? a[d - 1] >>> 32 - f : 0)) >>> 0) + ((a[d - 1] << f | (f && d > 1 ? a[d - 2] >>> 32 - f : 0)) >>> 12)) * Math.pow(2, 32 * d - f - 52)
    }

    function yc(a) {
        var b = this.limbs,
            c = this.bitLength;
        if (a >= c) return this;
        var d = new uc,
            e = a + 31 >> 5,
            f = a % 32;
        return d.limbs = new Uint32Array(b.subarray(0, e)),
            d.bitLength = a,
            d.sign = this.sign,
            f && (d.limbs[e - 1] &= -1 >>> 32 - f),
            d
    }

    function zc(a, b) {
        if (!m(a)) throw new TypeError('TODO');
        if (void 0 !== b && !m(b)) throw new TypeError('TODO');
        var c = this.limbs,
            d = this.bitLength;
        if (0 > a) throw new RangeError('TODO');
        if (a >= d) return ie;
        (void 0 === b || b > d - a) && (b = d - a);
        var e,
            f = new uc,
            g = a >> 5,
            h = a + b + 31 >> 5,
            i = b + 31 >> 5,
            j = a % 32,
            k = b % 32;
        if (e = new Uint32Array(i), j) {
            for (var l = 0; h - g - 1 > l; l++) e[l] = c[g + l] >>> j | c[g + l + 1] << 32 - j;
            e[l] = c[g + l] >>> j
        } else e.set(c.subarray(g, h));
        return k && (e[i - 1] &= -1 >>> 32 - k),
            f.limbs = e,
            f.bitLength = b,
            f.sign = this.sign,
            f
    }

    function Ac() {
        var a = new uc;
        return a.limbs = this.limbs,
            a.bitLength = this.bitLength,
            a.sign = -1 * this.sign,
            a
    }

    function Bc(a) {
        tc(a) || (a = new uc(a));
        var b = this.limbs,
            c = b.length,
            d = a.limbs,
            e = d.length,
            f = 0;
        return this.sign < a.sign ? -1 : this.sign > a.sign ? 1 : (fe.set(b, 0), fe.set(d, c), f = sc.cmp(0, c << 2, c << 2, e << 2), f * this.sign)
    }

    function Cc(a) {
        if (tc(a) || (a = new uc(a)), !this.sign) return a;
        if (!a.sign) return this;
        var b,
            c,
            d,
            e,
            f = this.bitLength,
            g = this.limbs,
            h = g.length,
            i = this.sign,
            j = a.bitLength,
            k = a.limbs,
            l = k.length,
            m = a.sign,
            n = new uc;
        b = (f > j ? f : j) + (i * m > 0 ? 1 : 0),
        c = b + 31 >> 5,
        sc.sreset();
        var o = sc.salloc(h << 2),
            p = sc.salloc(l << 2),
            q = sc.salloc(c << 2);
        return sc.z(q - o + (c << 2), 0, o),
            fe.set(g, o >> 2),
            fe.set(k, p >> 2),
            i * m > 0 ? (sc.add(o, h << 2, p, l << 2, q, c << 2), d = i) : i > m ? (e = sc.sub(o, h << 2, p, l << 2, q, c << 2), d = e ? m : i) : (e = sc.sub(p, l << 2, o, h << 2, q, c << 2), d = e ? i : m),
            e && sc.neg(q, c << 2, q, c << 2),
            0 === sc.tst(q, c << 2) ? ie : (n.limbs = new Uint32Array(fe.subarray(q >> 2, (q >> 2) + c)), n.bitLength = b, n.sign = d, n)
    }

    function Dc(a) {
        return tc(a) || (a = new uc(a)),
            this.add(a.negate())
    }

    function Ec(a) {
        if (tc(a) || (a = new uc(a)), !this.sign || !a.sign) return ie;
        var b,
            c,
            d = this.bitLength,
            e = this.limbs,
            f = e.length,
            g = a.bitLength,
            h = a.limbs,
            i = h.length,
            j = new uc;
        b = d + g,
        c = b + 31 >> 5,
        sc.sreset();
        var k = sc.salloc(f << 2),
            l = sc.salloc(i << 2),
            m = sc.salloc(c << 2);
        return sc.z(m - k + (c << 2), 0, k),
            fe.set(e, k >> 2),
            fe.set(h, l >> 2),
            sc.mul(k, f << 2, l, i << 2, m, c << 2),
            j.limbs = new Uint32Array(fe.subarray(m >> 2, (m >> 2) + c)),
            j.sign = this.sign * a.sign,
            j.bitLength = b,
            j
    }

    function Fc() {
        if (!this.sign) return ie;
        var a,
            b,
            c = this.bitLength,
            d = this.limbs,
            e = d.length,
            f = new uc;
        a = c << 1,
        b = a + 31 >> 5,
        sc.sreset();
        var g = sc.salloc(e << 2),
            h = sc.salloc(b << 2);
        return sc.z(h - g + (b << 2), 0, g),
            fe.set(d, g >> 2),
            sc.sqr(g, e << 2, h),
            f.limbs = new Uint32Array(fe.subarray(h >> 2, (h >> 2) + b)),
            f.bitLength = a,
            f.sign = 1,
            f
    }

    function Gc(a) {
        tc(a) || (a = new uc(a));
        var b,
            c,
            d = this.bitLength,
            e = this.limbs,
            f = e.length,
            g = a.bitLength,
            h = a.limbs,
            i = h.length,
            j = ie,
            k = ie;
        sc.sreset();
        var l = sc.salloc(f << 2),
            m = sc.salloc(i << 2),
            n = sc.salloc(i << 2),
            o = sc.salloc(f << 2);
        return sc.z(o - l + (f << 2), 0, l),
            fe.set(e, l >> 2),
            fe.set(h, m >> 2),
            sc.div(l, f << 2, m, i << 2, n, o),
            b = sc.tst(o, f << 2) >> 2,
            b && (j = new uc, j.limbs = new Uint32Array(fe.subarray(o >> 2, (o >> 2) + b)), j.bitLength = b << 5 > d ? d : b << 5, j.sign = this.sign * a.sign),
            c = sc.tst(n, i << 2) >> 2,
            c && (k = new uc, k.limbs = new Uint32Array(fe.subarray(n >> 2, (n >> 2) + c)), k.bitLength = c << 5 > g ? g : c << 5, k.sign = this.sign), {
                quotient: j,
                remainder: k
            }
    }

    function Hc(a, b) {
        var c,
            d,
            e,
            f,
            g = 0 > a ? -1 : 1,
            h = 0 > b ? -1 : 1,
            i = 1,
            j = 0,
            k = 0,
            l = 1;
        for (a *= g, b *= h, f = b > a, f && (e = a, a = b, b = e, e = g, g = h, h = e), d = Math.floor(a / b), c = a - d * b; c;) e = i - d * j,
            i = j,
            j = e,
            e = k - d * l,
            k = l,
            l = e,
            a = b,
            b = c,
            d = Math.floor(a / b),
            c = a - d * b;
        return j *= g,
            l *= h,
            f && (e = j, j = l, l = e), {
                gcd: b,
                x: j,
                y: l
            }
    }

    function Ic(a, b) {
        tc(a) || (a = new uc(a)),
        tc(b) || (b = new uc(b));
        var c = a.sign,
            d = b.sign;
        0 > c && (a = a.negate()),
        0 > d && (b = b.negate());
        var e = a.compare(b);
        if (0 > e) {
            var f = a;
            a = b,
            b = f,
            f = c,
            c = d,
            d = f
        }
        var g,
            h,
            i,
            j = je,
            k = ie,
            l = b.bitLength,
            m = ie,
            n = je,
            o = a.bitLength;
        for (g = a.divide(b);
            (h = g.remainder) !== ie;) i = g.quotient,
            g = j.subtract(i.multiply(k).clamp(l)).clamp(l),
            j = k,
            k = g,
            g = m.subtract(i.multiply(n).clamp(o)).clamp(o),
            m = n,
            n = g,
            a = b,
            b = h,
            g = a.divide(b);
        if (0 > c && (k = k.negate()), 0 > d && (n = n.negate()), 0 > e) {
            var f = k;
            k = n,
            n = f
        }
        return {
            gcd: b,
            x: k,
            y: n
        }
    }

    function Jc() {
        if (uc.apply(this, arguments), this.valueOf() < 1) throw new RangeError;
        if (!(this.bitLength <= 32)) {
            var a;
            if (1 & this.limbs[0]) {
                var b = (this.bitLength + 31 & -32) + 1,
                    c = new Uint32Array(b + 31 >> 5);
                c[c.length - 1] = 1,
                a = new uc,
                a.sign = 1,
                a.bitLength = b,
                a.limbs = c;
                var d = Hc(4294967296, this.limbs[0]).y;
                this.coefficient = 0 > d ? -d : 4294967296 - d,
                this.comodulus = a,
                this.comodulusRemainder = a.divide(this).remainder,
                this.comodulusRemainderSquare = a.square().divide(this).remainder
            }
        }
    }

    function Kc(a) {
        return tc(a) || (a = new uc(a)),
            a.bitLength <= 32 && this.bitLength <= 32 ? new uc(a.valueOf() % this.valueOf()) : a.compare(this) < 0 ? a : a.divide(this).remainder
    }

    function Lc(a) {
        a = this.reduce(a);
        var b = Ic(this, a);
        return 1 !== b.gcd.valueOf() ? null : (b = b.y, b.sign < 0 && (b = b.add(this).clamp(this.bitLength)), b)
    }

    function Mc(a, b) {
        tc(a) || (a = new uc(a)),
        tc(b) || (b = new uc(b));
        for (var c = 0, d = 0; d < b.limbs.length; d++)
            for (var e = b.limbs[d]; e;) 1 & e && c++,
                e >>>= 1;
        var f = 8;
        b.bitLength <= 4536 && (f = 7),
        b.bitLength <= 1736 && (f = 6),
        b.bitLength <= 630 && (f = 5),
        b.bitLength <= 210 && (f = 4),
        b.bitLength <= 60 && (f = 3),
        b.bitLength <= 12 && (f = 2),
        1 << f - 1 >= c && (f = 1),
        a = Nc(this.reduce(a).multiply(this.comodulusRemainderSquare), this);
        var g = Nc(a.square(), this),
            h = new Array(1 << f - 1);
        h[0] = a,
        h[1] = Nc(a.multiply(g), this);
        for (var d = 2; 1 << f - 1 > d; d++) h[d] = Nc(h[d - 1].multiply(g), this);
        for (var i = this.comodulusRemainder, j = i, d = b.limbs.length - 1; d >= 0; d--)
            for (var e = b.limbs[d], k = 32; k > 0;)
                if (2147483648 & e) {
                    for (var l = e >>> 32 - f, m = f; 0 === (1 & l);) l >>>= 1,
                        m--;
                    for (var n = h[l >>> 1]; l;) l >>>= 1,
                        j !== i && (j = Nc(j.square(), this));
                    j = j !== i ? Nc(j.multiply(n), this) : n,
                    e <<= m,
                    k -= m
                } else j !== i && (j = Nc(j.square(), this)),
                    e <<= 1,
                    k--;
        return j = Nc(j, this)
    }

    function Nc(a, b) {
        var c = a.limbs,
            d = c.length,
            e = b.limbs,
            f = e.length,
            g = b.coefficient;
        sc.sreset();
        var h = sc.salloc(d << 2),
            i = sc.salloc(f << 2),
            j = sc.salloc(f << 2);
        sc.z(j - h + (f << 2), 0, h),
        fe.set(c, h >> 2),
        fe.set(e, i >> 2),
        sc.mredc(h, d << 2, i, f << 2, g, j);
        var k = new uc;
        return k.limbs = new Uint32Array(fe.subarray(j >> 2, (j >> 2) + f)),
            k.bitLength = b.bitLength,
            k.sign = 1,
            k
    }

    function Oc(a) {
        var b = new uc(this),
            c = 0;
        for (b.limbs[0] -= 1; 0 === b.limbs[c >> 5];) c += 32;
        for (; 0 === (b.limbs[c >> 5] >> (31 & c) & 1);) c++;
        b = b.slice(c);
        for (var d = new Jc(this), e = this.subtract(je), f = new uc(this), g = this.limbs.length - 1; 0 === f.limbs[g];) g--;
        for (; --a >= 0;) {
            for (pc(f.limbs), f.limbs[0] < 2 && (f.limbs[0] += 2); f.compare(e) >= 0;) f.limbs[g] >>>= 1;
            var h = d.power(f, b);
            if (0 !== h.compare(je) && 0 !== h.compare(e)) {
                for (var i = c; --i > 0;) {
                    if (h = h.square().divide(d).remainder, 0 === h.compare(je)) return !1;
                    if (0 === h.compare(e)) break
                }
                if (0 === i) return !1
            }
        }
        return !0
    }

    function Pc(a) {
        a = a || 80;
        var b = this.limbs,
            c = 0;
        if (0 === (1 & b[0])) return !1;
        if (1 >= a) return !0;
        var d = 0,
            e = 0,
            f = 0;
        for (c = 0; c < b.length; c++) {
            for (var g = b[c]; g;) d += 3 & g,
                g >>>= 2;
            for (var h = b[c]; h;) e += 3 & h,
                h >>>= 2,
                e -= 3 & h,
                h >>>= 2;
            for (var i = b[c]; i;) f += 15 & i,
                i >>>= 4,
                f -= 15 & i,
                i >>>= 4
        }
        return d % 3 && e % 5 && f % 17 ? 2 >= a ? !0 : Oc.call(this, a >>> 1) : !1
    }

    function Qc(a) {
        if (le.length >= a) return le.slice(0, a);
        for (var b = le[le.length - 1] + 2; le.length < a; b += 2) {
            for (var c = 0, d = le[c]; b >= d * d && b % d != 0; d = le[++c]);
            d * d > b && le.push(b)
        }
        return le
    }

    function Rc(a, c) {
        var d = a + 31 >> 5,
            e = new uc({
                sign: 1,
                bitLength: a,
                limbs: d
            }),
            f = e.limbs,
            g = 10000;
        512 >= a && (g = 2200),
        256 >= a && (g = 600);
        var h = Qc(g),
            i = new Uint32Array(g),
            j = a * b.Math.LN2 | 0,
            k = 27;
        for (a >= 250 && (k = 12), a >= 450 && (k = 6), a >= 850 && (k = 3), a >= 1300 && (k = 2);;) {
            pc(f),
            f[0] |= 1,
            f[d - 1] |= 1 << (a - 1 & 31),
            31 & a && (f[d - 1] &= l(a + 1 & 31) - 1),
            i[0] = 1;
            for (var m = 1; g > m; m++) i[m] = e.divide(h[m]).remainder.valueOf();
            a: for (var n = 0; j > n; n += 2, f[0] += 2) {
                for (var m = 1; g > m; m++)
                    if ((i[m] + n) % h[m] === 0) continue a;
                if (('function' != typeof c || c(e)) && Oc.call(e, k)) return e
            }
        }
    }

    function Sc(a) {
        a = a || {},
        this.key = null,
        this.result = null,
        this.reset(a)
    }

    function Tc(a) {
        a = a || {},
        this.result = null;
        var b = a.key;
        if (void 0 !== b) {
            if (!(b instanceof Array)) throw new TypeError('unexpected key type');
            var c = b.length;
            if (2 !== c && 3 !== c && 8 !== c) throw new SyntaxError('unexpected key type');
            var d = [];
            d[0] = new Jc(b[0]),
            d[1] = new uc(b[1]),
            c > 2 && (d[2] = new uc(b[2])),
            c > 3 && (d[3] = new Jc(b[3]), d[4] = new Jc(b[4]), d[5] = new uc(b[5]), d[6] = new uc(b[6]), d[7] = new uc(b[7])),
            this.key = d
        }
        return this
    }

    function Uc(a) {
        if (!this.key) throw new c('no key is associated with the instance');
        n(a) && (a = f(a)),
        o(a) && (a = new Uint8Array(a));
        var b;
        if (p(a)) b = new uc(a);
        else {
            if (!tc(a)) throw new TypeError('unexpected data type');
            b = a
        }
        if (this.key[0].compare(b) <= 0) throw new RangeError('data too large');
        var d = this.key[0],
            e = this.key[1],
            g = d.power(b, e).toBytes(),
            h = d.bitLength + 7 >> 3;
        if (g.length < h) {
            var i = new Uint8Array(h);
            i.set(g, h - g.length),
            g = i
        }
        return this.result = g,
            this
    }

    function Vc(a) {
        if (!this.key) throw new c('no key is associated with the instance');
        if (this.key.length < 3) throw new c('key isn\'t suitable for decription');
        n(a) && (a = f(a)),
        o(a) && (a = new Uint8Array(a));
        var b;
        if (p(a)) b = new uc(a);
        else {
            if (!tc(a)) throw new TypeError('unexpected data type');
            b = a
        }
        if (this.key[0].compare(b) <= 0) throw new RangeError('data too large');
        var d;
        if (this.key.length > 3) {
            for (var e = this.key[0], g = this.key[3], h = this.key[4], i = this.key[5], j = this.key[6], k = this.key[7], l = g.power(b, i), m = h.power(b, j), q = l.subtract(m); q.sign < 0;) q = q.add(g);
            var r = g.reduce(k.multiply(q));
            d = r.multiply(h).add(m).clamp(e.bitLength).toBytes()
        } else {
            var e = this.key[0],
                s = this.key[2];
            d = e.power(b, s).toBytes()
        }
        var t = e.bitLength + 7 >> 3;
        if (d.length < t) {
            var u = new Uint8Array(t);
            u.set(d, t - d.length),
            d = u
        }
        return this.result = d,
            this
    }

    function Wc(a, b) {
        if (a = a || 2048, b = b || 65537, 512 > a) throw new d('bit length is too small');
        if (n(b) && (b = f(b)), o(b) && (b = new Uint8Array(b)), !(p(b) || m(b) || tc(b))) throw new TypeError('unexpected exponent type');
        if (b = new uc(b), 0 === (1 & b.limbs[0])) throw new d('exponent must be an odd number');
        var c,
            b,
            e,
            g,
            h,
            i,
            j,
            k,
            l,
            q;
        g = Rc(a >> 1, function(a) {
            return i = new uc(a),
                i.limbs[0] -= 1,
                1 == Ic(i, b).gcd.valueOf()
        }),
        h = Rc(a - (a >> 1), function(d) {
            return c = new Jc(g.multiply(d)),
                c.limbs[(a + 31 >> 5) - 1] >>> (a - 1 & 31) ? (j = new uc(d), j.limbs[0] -= 1, 1 == Ic(j, b).gcd.valueOf()) : !1
        }),
        e = new Jc(i.multiply(j)).inverse(b),
        k = e.divide(i).remainder,
        l = e.divide(j).remainder,
        g = new Jc(g),
        h = new Jc(h);
        var q = g.inverse(h);
        return [c,
            b,
            e,
            g,
            h,
            k,
            l,
            q
        ]
    }

    function Xc(a, b) {
        if (void 0 === a) throw new SyntaxError('bitlen required');
        if (void 0 === b) throw new SyntaxError('e required');
        for (var c = Wc(a, b), d = 0; d < c.length; d++) tc(c[d]) && (c[d] = c[d].toBytes());
        return c
    }

    function Yc(a, b) {
        if (void 0 === a) throw new SyntaxError('data required');
        if (void 0 === b) throw new SyntaxError('key required');
        return new ne({
            key: b
        }).encrypt(a).result
    }

    function Zc(a, b) {
        if (void 0 === a) throw new SyntaxError('data required');
        if (void 0 === b) throw new SyntaxError('key required');
        return new ne({
            key: b
        }).decrypt(a).result
    }
    b.asmCrypto = a,
    c.prototype = Object.create(Error.prototype, {
        name: {
            value: 'IllegalStateError'
        }
    }),
    d.prototype = Object.create(Error.prototype, {
        name: {
            value: 'IllegalArgumentError'
        }
    }),
    e.prototype = Object.create(Error.prototype, {
        name: {
            value: 'SecurityError'
        }
    });
    var $c = b.Float64Array || b.Float32Array,
        _c = [
            99,
            124,
            119,
            123,
            242,
            107,
            111,
            197,
            48,
            1,
            103,
            43,
            254,
            215,
            171,
            118,
            202,
            130,
            201,
            125,
            250,
            89,
            71,
            240,
            173,
            212,
            162,
            175,
            156,
            164,
            114,
            192,
            183,
            253,
            147,
            38,
            54,
            63,
            247,
            204,
            52,
            165,
            229,
            241,
            113,
            216,
            49,
            21,
            4,
            199,
            35,
            195,
            24,
            150,
            5,
            154,
            7,
            18,
            128,
            226,
            235,
            39,
            178,
            117,
            9,
            131,
            44,
            26,
            27,
            110,
            90,
            160,
            82,
            59,
            214,
            179,
            41,
            227,
            47,
            132,
            83,
            209,
            0,
            237,
            32,
            252,
            177,
            91,
            106,
            203,
            190,
            57,
            74,
            76,
            88,
            207,
            208,
            239,
            170,
            251,
            67,
            77,
            51,
            133,
            69,
            249,
            2,
            127,
            80,
            60,
            159,
            168,
            81,
            163,
            64,
            143,
            146,
            157,
            56,
            245,
            188,
            182,
            218,
            33,
            16,
            255,
            243,
            210,
            205,
            12,
            19,
            236,
            95,
            151,
            68,
            23,
            196,
            167,
            126,
            61,
            100,
            93,
            25,
            115,
            96,
            129,
            79,
            220,
            34,
            42,
            144,
            136,
            70,
            238,
            184,
            20,
            222,
            94,
            11,
            219,
            224,
            50,
            58,
            10,
            73,
            6,
            36,
            92,
            194,
            211,
            172,
            98,
            145,
            149,
            228,
            121,
            231,
            200,
            55,
            109,
            141,
            213,
            78,
            169,
            108,
            86,
            244,
            234,
            101,
            122,
            174,
            8,
            186,
            120,
            37,
            46,
            28,
            166,
            180,
            198,
            232,
            221,
            116,
            31,
            75,
            189,
            139,
            138,
            112,
            62,
            181,
            102,
            72,
            3,
            246,
            14,
            97,
            53,
            87,
            185,
            134,
            193,
            29,
            158,
            225,
            248,
            152,
            17,
            105,
            217,
            142,
            148,
            155,
            30,
            135,
            233,
            206,
            85,
            40,
            223,
            140,
            161,
            137,
            13,
            191,
            230,
            66,
            104,
            65,
            153,
            45,
            15,
            176,
            84,
            187,
            22,
            82,
            9,
            106,
            213,
            48,
            54,
            165,
            56,
            191,
            64,
            163,
            158,
            129,
            243,
            215,
            251,
            124,
            227,
            57,
            130,
            155,
            47,
            255,
            135,
            52,
            142,
            67,
            68,
            196,
            222,
            233,
            203,
            84,
            123,
            148,
            50,
            166,
            194,
            35,
            61,
            238,
            76,
            149,
            11,
            66,
            250,
            195,
            78,
            8,
            46,
            161,
            102,
            40,
            217,
            36,
            178,
            118,
            91,
            162,
            73,
            109,
            139,
            209,
            37,
            114,
            248,
            246,
            100,
            134,
            104,
            152,
            22,
            212,
            164,
            92,
            204,
            93,
            101,
            182,
            146,
            108,
            112,
            72,
            80,
            253,
            237,
            185,
            218,
            94,
            21,
            70,
            87,
            167,
            141,
            157,
            132,
            144,
            216,
            171,
            0,
            140,
            188,
            211,
            10,
            247,
            228,
            88,
            5,
            184,
            179,
            69,
            6,
            208,
            44,
            30,
            143,
            202,
            63,
            15,
            2,
            193,
            175,
            189,
            3,
            1,
            19,
            138,
            107,
            58,
            145,
            17,
            65,
            79,
            103,
            220,
            234,
            151,
            242,
            207,
            206,
            240,
            180,
            230,
            115,
            150,
            172,
            116,
            34,
            231,
            173,
            53,
            133,
            226,
            249,
            55,
            232,
            28,
            117,
            223,
            110,
            71,
            241,
            26,
            113,
            29,
            41,
            197,
            137,
            111,
            183,
            98,
            14,
            170,
            24,
            190,
            27,
            252,
            86,
            62,
            75,
            198,
            210,
            121,
            32,
            154,
            219,
            192,
            254,
            120,
            205,
            90,
            244,
            31,
            221,
            168,
            51,
            136,
            7,
            199,
            49,
            177,
            18,
            16,
            89,
            39,
            128,
            236,
            95,
            96,
            81,
            127,
            169,
            25,
            181,
            74,
            13,
            45,
            229,
            122,
            159,
            147,
            201,
            156,
            239,
            160,
            224,
            59,
            77,
            174,
            42,
            245,
            176,
            200,
            235,
            187,
            60,
            131,
            83,
            153,
            97,
            23,
            43,
            4,
            126,
            186,
            119,
            214,
            38,
            225,
            105,
            20,
            99,
            85,
            33,
            12,
            125,
            198,
            248,
            238,
            246,
            255,
            214,
            222,
            145,
            96,
            2,
            206,
            86,
            231,
            181,
            77,
            236,
            143,
            31,
            137,
            250,
            239,
            178,
            142,
            251,
            65,
            179,
            95,
            69,
            35,
            83,
            228,
            155,
            117,
            225,
            61,
            76,
            108,
            126,
            245,
            131,
            104,
            81,
            209,
            249,
            226,
            171,
            98,
            42,
            8,
            149,
            70,
            157,
            48,
            55,
            10,
            47,
            14,
            36,
            27,
            223,
            205,
            78,
            127,
            234,
            18,
            29,
            88,
            52,
            54,
            220,
            180,
            91,
            164,
            118,
            183,
            125,
            82,
            221,
            94,
            19,
            166,
            185,
            0,
            193,
            64,
            227,
            121,
            182,
            212,
            141,
            103,
            114,
            148,
            152,
            176,
            133,
            187,
            197,
            79,
            237,
            134,
            154,
            102,
            17,
            138,
            233,
            4,
            254,
            160,
            120,
            37,
            75,
            162,
            93,
            128,
            5,
            63,
            33,
            112,
            241,
            99,
            119,
            175,
            66,
            32,
            229,
            253,
            191,
            129,
            24,
            38,
            195,
            190,
            53,
            136,
            46,
            147,
            85,
            252,
            122,
            200,
            186,
            50,
            230,
            192,
            25,
            158,
            163,
            68,
            84,
            59,
            11,
            140,
            199,
            107,
            40,
            167,
            188,
            22,
            173,
            219,
            100,
            116,
            20,
            146,
            12,
            72,
            184,
            159,
            189,
            67,
            196,
            57,
            49,
            211,
            242,
            213,
            139,
            110,
            218,
            1,
            177,
            156,
            73,
            216,
            172,
            243,
            207,
            202,
            244,
            71,
            16,
            111,
            240,
            74,
            92,
            56,
            87,
            115,
            151,
            203,
            161,
            232,
            62,
            150,
            97,
            13,
            15,
            224,
            124,
            113,
            204,
            144,
            6,
            247,
            28,
            194,
            106,
            174,
            105,
            23,
            153,
            58,
            39,
            217,
            235,
            43,
            34,
            210,
            169,
            7,
            51,
            45,
            60,
            21,
            201,
            135,
            170,
            80,
            165,
            3,
            89,
            9,
            26,
            101,
            215,
            132,
            208,
            130,
            41,
            90,
            30,
            123,
            168,
            109,
            44,
            165,
            132,
            153,
            141,
            13,
            189,
            177,
            84,
            80,
            3,
            169,
            125,
            25,
            98,
            230,
            154,
            69,
            157,
            64,
            135,
            21,
            235,
            201,
            11,
            236,
            103,
            253,
            234,
            191,
            247,
            150,
            91,
            194,
            28,
            174,
            106,
            90,
            65,
            2,
            79,
            92,
            244,
            52,
            8,
            147,
            115,
            83,
            63,
            12,
            82,
            101,
            94,
            40,
            161,
            15,
            181,
            9,
            54,
            155,
            61,
            38,
            105,
            205,
            159,
            27,
            158,
            116,
            46,
            45,
            178,
            238,
            251,
            246,
            77,
            97,
            206,
            123,
            62,
            113,
            151,
            245,
            104,
            0,
            44,
            96,
            31,
            200,
            237,
            190,
            70,
            217,
            75,
            222,
            212,
            232,
            74,
            107,
            42,
            229,
            22,
            197,
            215,
            85,
            148,
            207,
            16,
            6,
            129,
            240,
            68,
            186,
            227,
            243,
            254,
            192,
            138,
            173,
            188,
            72,
            4,
            223,
            193,
            117,
            99,
            48,
            26,
            14,
            109,
            76,
            20,
            53,
            47,
            225,
            162,
            204,
            57,
            87,
            242,
            130,
            71,
            172,
            231,
            43,
            149,
            160,
            152,
            209,
            127,
            102,
            126,
            171,
            131,
            202,
            41,
            211,
            60,
            121,
            226,
            29,
            118,
            59,
            86,
            78,
            30,
            219,
            10,
            108,
            228,
            93,
            110,
            239,
            166,
            168,
            164,
            55,
            139,
            50,
            67,
            89,
            183,
            140,
            100,
            210,
            224,
            180,
            250,
            7,
            37,
            175,
            142,
            233,
            24,
            213,
            136,
            111,
            114,
            36,
            241,
            199,
            81,
            35,
            124,
            156,
            33,
            221,
            220,
            134,
            133,
            144,
            66,
            196,
            170,
            216,
            5,
            1,
            18,
            163,
            95,
            249,
            208,
            145,
            88,
            39,
            185,
            56,
            19,
            179,
            51,
            187,
            112,
            137,
            167,
            182,
            34,
            146,
            32,
            73,
            255,
            120,
            122,
            143,
            248,
            128,
            23,
            218,
            49,
            198,
            184,
            195,
            176,
            119,
            17,
            203,
            252,
            214,
            58,
            0,
            9,
            18,
            27,
            36,
            45,
            54,
            63,
            72,
            65,
            90,
            83,
            108,
            101,
            126,
            119,
            144,
            153,
            130,
            139,
            180,
            189,
            166,
            175,
            216,
            209,
            202,
            195,
            252,
            245,
            238,
            231,
            59,
            50,
            41,
            32,
            31,
            22,
            13,
            4,
            115,
            122,
            97,
            104,
            87,
            94,
            69,
            76,
            171,
            162,
            185,
            176,
            143,
            134,
            157,
            148,
            227,
            234,
            241,
            248,
            199,
            206,
            213,
            220,
            118,
            127,
            100,
            109,
            82,
            91,
            64,
            73,
            62,
            55,
            44,
            37,
            26,
            19,
            8,
            1,
            230,
            239,
            244,
            253,
            194,
            203,
            208,
            217,
            174,
            167,
            188,
            181,
            138,
            131,
            152,
            145,
            77,
            68,
            95,
            86,
            105,
            96,
            123,
            114,
            5,
            12,
            23,
            30,
            33,
            40,
            51,
            58,
            221,
            212,
            207,
            198,
            249,
            240,
            235,
            226,
            149,
            156,
            135,
            142,
            177,
            184,
            163,
            170,
            236,
            229,
            254,
            247,
            200,
            193,
            218,
            211,
            164,
            173,
            182,
            191,
            128,
            137,
            146,
            155,
            124,
            117,
            110,
            103,
            88,
            81,
            74,
            67,
            52,
            61,
            38,
            47,
            16,
            25,
            2,
            11,
            215,
            222,
            197,
            204,
            243,
            250,
            225,
            232,
            159,
            150,
            141,
            132,
            187,
            178,
            169,
            160,
            71,
            78,
            85,
            92,
            99,
            106,
            113,
            120,
            15,
            6,
            29,
            20,
            43,
            34,
            57,
            48,
            154,
            147,
            136,
            129,
            190,
            183,
            172,
            165,
            210,
            219,
            192,
            201,
            246,
            255,
            228,
            237,
            10,
            3,
            24,
            17,
            46,
            39,
            60,
            53,
            66,
            75,
            80,
            89,
            102,
            111,
            116,
            125,
            161,
            168,
            179,
            186,
            133,
            140,
            151,
            158,
            233,
            224,
            251,
            242,
            205,
            196,
            223,
            214,
            49,
            56,
            35,
            42,
            21,
            28,
            7,
            14,
            121,
            112,
            107,
            98,
            93,
            84,
            79,
            70,
            0,
            11,
            22,
            29,
            44,
            39,
            58,
            49,
            88,
            83,
            78,
            69,
            116,
            127,
            98,
            105,
            176,
            187,
            166,
            173,
            156,
            151,
            138,
            129,
            232,
            227,
            254,
            245,
            196,
            207,
            210,
            217,
            123,
            112,
            109,
            102,
            87,
            92,
            65,
            74,
            35,
            40,
            53,
            62,
            15,
            4,
            25,
            18,
            203,
            192,
            221,
            214,
            231,
            236,
            241,
            250,
            147,
            152,
            133,
            142,
            191,
            180,
            169,
            162,
            246,
            253,
            224,
            235,
            218,
            209,
            204,
            199,
            174,
            165,
            184,
            179,
            130,
            137,
            148,
            159,
            70,
            77,
            80,
            91,
            106,
            97,
            124,
            119,
            30,
            21,
            8,
            3,
            50,
            57,
            36,
            47,
            141,
            134,
            155,
            144,
            161,
            170,
            183,
            188,
            213,
            222,
            195,
            200,
            249,
            242,
            239,
            228,
            61,
            54,
            43,
            32,
            17,
            26,
            7,
            12,
            101,
            110,
            115,
            120,
            73,
            66,
            95,
            84,
            247,
            252,
            225,
            234,
            219,
            208,
            205,
            198,
            175,
            164,
            185,
            178,
            131,
            136,
            149,
            158,
            71,
            76,
            81,
            90,
            107,
            96,
            125,
            118,
            31,
            20,
            9,
            2,
            51,
            56,
            37,
            46,
            140,
            135,
            154,
            145,
            160,
            171,
            182,
            189,
            212,
            223,
            194,
            201,
            248,
            243,
            238,
            229,
            60,
            55,
            42,
            33,
            16,
            27,
            6,
            13,
            100,
            111,
            114,
            121,
            72,
            67,
            94,
            85,
            1,
            10,
            23,
            28,
            45,
            38,
            59,
            48,
            89,
            82,
            79,
            68,
            117,
            126,
            99,
            104,
            177,
            186,
            167,
            172,
            157,
            150,
            139,
            128,
            233,
            226,
            255,
            244,
            197,
            206,
            211,
            216,
            122,
            113,
            108,
            103,
            86,
            93,
            64,
            75,
            34,
            41,
            52,
            63,
            14,
            5,
            24,
            19,
            202,
            193,
            220,
            215,
            230,
            237,
            240,
            251,
            146,
            153,
            132,
            143,
            190,
            181,
            168,
            163,
            0,
            13,
            26,
            23,
            52,
            57,
            46,
            35,
            104,
            101,
            114,
            127,
            92,
            81,
            70,
            75,
            208,
            221,
            202,
            199,
            228,
            233,
            254,
            243,
            184,
            181,
            162,
            175,
            140,
            129,
            150,
            155,
            187,
            182,
            161,
            172,
            143,
            130,
            149,
            152,
            211,
            222,
            201,
            196,
            231,
            234,
            253,
            240,
            107,
            102,
            113,
            124,
            95,
            82,
            69,
            72,
            3,
            14,
            25,
            20,
            55,
            58,
            45,
            32,
            109,
            96,
            119,
            122,
            89,
            84,
            67,
            78,
            5,
            8,
            31,
            18,
            49,
            60,
            43,
            38,
            189,
            176,
            167,
            170,
            137,
            132,
            147,
            158,
            213,
            216,
            207,
            194,
            225,
            236,
            251,
            246,
            214,
            219,
            204,
            193,
            226,
            239,
            248,
            245,
            190,
            179,
            164,
            169,
            138,
            135,
            144,
            157,
            6,
            11,
            28,
            17,
            50,
            63,
            40,
            37,
            110,
            99,
            116,
            121,
            90,
            87,
            64,
            77,
            218,
            215,
            192,
            205,
            238,
            227,
            244,
            249,
            178,
            191,
            168,
            165,
            134,
            139,
            156,
            145,
            10,
            7,
            16,
            29,
            62,
            51,
            36,
            41,
            98,
            111,
            120,
            117,
            86,
            91,
            76,
            65,
            97,
            108,
            123,
            118,
            85,
            88,
            79,
            66,
            9,
            4,
            19,
            30,
            61,
            48,
            39,
            42,
            177,
            188,
            171,
            166,
            133,
            136,
            159,
            146,
            217,
            212,
            195,
            206,
            237,
            224,
            247,
            250,
            183,
            186,
            173,
            160,
            131,
            142,
            153,
            148,
            223,
            210,
            197,
            200,
            235,
            230,
            241,
            252,
            103,
            106,
            125,
            112,
            83,
            94,
            73,
            68,
            15,
            2,
            21,
            24,
            59,
            54,
            33,
            44,
            12,
            1,
            22,
            27,
            56,
            53,
            34,
            47,
            100,
            105,
            126,
            115,
            80,
            93,
            74,
            71,
            220,
            209,
            198,
            203,
            232,
            229,
            242,
            255,
            180,
            185,
            174,
            163,
            128,
            141,
            154,
            151,
            0,
            14,
            28,
            18,
            56,
            54,
            36,
            42,
            112,
            126,
            108,
            98,
            72,
            70,
            84,
            90,
            224,
            238,
            252,
            242,
            216,
            214,
            196,
            202,
            144,
            158,
            140,
            130,
            168,
            166,
            180,
            186,
            219,
            213,
            199,
            201,
            227,
            237,
            255,
            241,
            171,
            165,
            183,
            185,
            147,
            157,
            143,
            129,
            59,
            53,
            39,
            41,
            3,
            13,
            31,
            17,
            75,
            69,
            87,
            89,
            115,
            125,
            111,
            97,
            173,
            163,
            177,
            191,
            149,
            155,
            137,
            135,
            221,
            211,
            193,
            207,
            229,
            235,
            249,
            247,
            77,
            67,
            81,
            95,
            117,
            123,
            105,
            103,
            61,
            51,
            33,
            47,
            5,
            11,
            25,
            23,
            118,
            120,
            106,
            100,
            78,
            64,
            82,
            92,
            6,
            8,
            26,
            20,
            62,
            48,
            34,
            44,
            150,
            152,
            138,
            132,
            174,
            160,
            178,
            188,
            230,
            232,
            250,
            244,
            222,
            208,
            194,
            204,
            65,
            79,
            93,
            83,
            121,
            119,
            101,
            107,
            49,
            63,
            45,
            35,
            9,
            7,
            21,
            27,
            161,
            175,
            189,
            179,
            153,
            151,
            133,
            139,
            209,
            223,
            205,
            195,
            233,
            231,
            245,
            251,
            154,
            148,
            134,
            136,
            162,
            172,
            190,
            176,
            234,
            228,
            246,
            248,
            210,
            220,
            206,
            192,
            122,
            116,
            102,
            104,
            66,
            76,
            94,
            80,
            10,
            4,
            22,
            24,
            50,
            60,
            46,
            32,
            236,
            226,
            240,
            254,
            212,
            218,
            200,
            198,
            156,
            146,
            128,
            142,
            164,
            170,
            184,
            182,
            12,
            2,
            16,
            30,
            52,
            58,
            40,
            38,
            124,
            114,
            96,
            110,
            68,
            74,
            88,
            86,
            55,
            57,
            43,
            37,
            15,
            1,
            19,
            29,
            71,
            73,
            91,
            85,
            127,
            113,
            99,
            109,
            215,
            217,
            203,
            197,
            239,
            225,
            243,
            253,
            167,
            169,
            187,
            181,
            159,
            145,
            131,
            141
        ],
        ad = 2048,
        bd = 16,
        cd = y.prototype;
    cd.reset = A,
    cd.process = B,
    cd.finish = C;
    var dd = z.prototype;
    dd.reset = A,
    dd.process = E,
    dd.finish = F;
    var ed = x.prototype;
    ed.reset = A,
    ed.encrypt = D,
    ed.decrypt = G;
    var fd = I.prototype;
    fd.reset = K,
    fd.process = L,
    fd.finish = M;
    var gd = J.prototype;
    gd.reset = K,
    gd.process = O,
    gd.finish = P;
    var hd = H.prototype;
    hd.reset = K,
    hd.encrypt = N,
    hd.decrypt = Q;
    var id = 65279,
        jd = 68719476720,
        kd = S.prototype;
    kd.reset = W,
    kd.encrypt = Z,
    kd.decrypt = ab;
    var ld = T.prototype;
    ld.reset = W,
    ld.process = X,
    ld.finish = Y;
    var md = U.prototype;
    md.reset = W,
    md.process = $,
    md.finish = _;
    var nd = new Uint8Array(1048576),
        r = s(b, null, nd.buffer);
    if ('undefined' != typeof x) {
        var od = new x({
            heap: nd,
            asm: r
        });
        a.AES_ECB = {
            encrypt: bb,
            decrypt: cb
        }
    }
    if ('undefined' != typeof H) {
        var pd = new H({
            heap: nd,
            asm: r
        });
        a.AES_CBC = {
            encrypt: db,
            decrypt: eb
        }
    }
    if ('undefined' != typeof S) {
        var qd = new S({
            heap: nd,
            asm: r
        });
        a.AES_CCM = {
            encrypt: fb,
            decrypt: gb
        }
    }
    var rd = 64,
        sd = 20;
    ib.BLOCK_SIZE = rd,
    ib.HASH_SIZE = sd;
    var td = ib.prototype;
    td.reset = jb,
    td.process = kb,
    td.finish = lb;
    var ud = null;
    a.SHA1 = {
        bytes: nb,
        hex: ob,
        base64: pb
    };
    var vd = 64,
        wd = 32;
    rb.BLOCK_SIZE = vd,
    rb.HASH_SIZE = wd;
    var xd = rb.prototype;
    xd.reset = sb,
    xd.process = tb,
    xd.finish = ub;
    var yd = null;
    a.SHA256 = {
        bytes: wb,
        hex: xb,
        base64: yb
    };
    var zd = 128,
        Ad = 64;
    Ab.BLOCK_SIZE = zd,
    Ab.HASH_SIZE = Ad;
    var Bd = Ab.prototype;
    Bd.reset = Bb,
    Bd.process = Cb,
    Bd.finish = Db;
    var Cd = null;
    a.SHA512 = {
        bytes: Fb,
        hex: Gb,
        base64: Hb
    };
    var Dd = Ib.prototype;
    Dd.reset = Lb,
    Dd.process = Mb,
    Dd.finish = Nb,
    Ob.BLOCK_SIZE = ib.BLOCK_SIZE,
    Ob.HMAC_SIZE = ib.HASH_SIZE;
    var Ed = Ob.prototype;
    Ed.reset = Pb,
    Ed.process = Mb,
    Ed.finish = Qb;
    var Fd = null;
    Sb.BLOCK_SIZE = rb.BLOCK_SIZE,
    Sb.HMAC_SIZE = rb.HASH_SIZE;
    var Gd = Sb.prototype;
    Gd.reset = Tb,
    Gd.process = Mb,
    Gd.finish = Ub;
    var Hd = null;
    Wb.BLOCK_SIZE = Ab.BLOCK_SIZE,
    Wb.HMAC_SIZE = Ab.HASH_SIZE;
    var Id = Wb.prototype;
    Id.reset = Xb,
    Id.process = Mb,
    Id.finish = Yb;
    var Jd = null;
    'undefined' != typeof Ob && (a.HMAC = a.HMAC_SHA1 = {
        bytes: $b,
        hex: _b,
        base64: ac
    }),
        'undefined' != typeof Sb && (a.HMAC_SHA256 = {
            bytes: bc,
            hex: cc,
            base64: dc
        }),
        'undefined' != typeof Wb && (a.HMAC_SHA512 = {
            bytes: ec,
            hex: fc,
            base64: gc
        });
    var Kd = hc.prototype;
    Kd.reset = ic,
    Kd.generate = jc;
    var Ld = kc.prototype;
    Ld.reset = ic,
    Ld.generate = lc;
    var Md,
        Nd = null,
        Od = function() {
            function a() {
                function a() {
                    b ^= d << 11,
                    l = l + b | 0,
                    d = d + f | 0,
                    d ^= f >>> 2,
                    m = m + d | 0,
                    f = f + l | 0,
                    f ^= l << 8,
                    n = n + f | 0,
                    l = l + m | 0,
                    l ^= m >>> 16,
                    o = o + l | 0,
                    m = m + n | 0,
                    m ^= n << 10,
                    p = p + m | 0,
                    n = n + o | 0,
                    n ^= o >>> 4,
                    b = b + n | 0,
                    o = o + p | 0,
                    o ^= p << 8,
                    d = d + o | 0,
                    p = p + b | 0,
                    p ^= b >>> 9,
                    f = f + p | 0,
                    b = b + d | 0
                }
                var b,
                    d,
                    f,
                    l,
                    m,
                    n,
                    o,
                    p;
                h = i = j = 0,
                b = d = f = l = m = n = o = p = 2654435769;
                for (var q = 0; 4 > q; q++) a();
                for (var q = 0; 256 > q; q += 8) b = b + g[0 | q] | 0,
                    d = d + g[1 | q] | 0,
                    f = f + g[2 | q] | 0,
                    l = l + g[3 | q] | 0,
                    m = m + g[4 | q] | 0,
                    n = n + g[5 | q] | 0,
                    o = o + g[6 | q] | 0,
                    p = p + g[7 | q] | 0,
                    a(),
                    e.set([b,
                        d,
                        f,
                        l,
                        m,
                        n,
                        o,
                        p
                    ], q);
                for (var q = 0; 256 > q; q += 8) b = b + e[0 | q] | 0,
                    d = d + e[1 | q] | 0,
                    f = f + e[2 | q] | 0,
                    l = l + e[3 | q] | 0,
                    m = m + e[4 | q] | 0,
                    n = n + e[5 | q] | 0,
                    o = o + e[6 | q] | 0,
                    p = p + e[7 | q] | 0,
                    a(),
                    e.set([b,
                        d,
                        f,
                        l,
                        m,
                        n,
                        o,
                        p
                    ], q);
                c(1),
                k = 256
            }

            function b(b) {
                var c,
                    d,
                    e,
                    h,
                    i;
                if (q(b)) b = new Uint8Array(b.buffer);
                else if (m(b)) h = new $c(1),
                    h[0] = b,
                    b = new Uint8Array(h.buffer);
                else if (n(b)) b = f(b);
                else {
                    if (!o(b)) throw new TypeError('bad seed type');
                    b = new Uint8Array(b)
                }
                for (i = b.length, d = 0; i > d; d += 1024) {
                    for (e = d, c = 0; 1024 > c && i > e; e = d | ++c) g[c >> 2] ^= b[e] << ((3 & c) << 3);
                    a()
                }
            }

            function c(a) {
                a = a || 1;
                for (var b, c, d; a--;)
                    for (j = j + 1 | 0, i = i + j | 0, b = 0; 256 > b; b += 4) h ^= h << 13,
                        h = e[b + 128 & 255] + h | 0,
                        c = e[0 | b],
                        e[0 | b] = d = e[c >>> 2 & 255] + (h + i | 0) | 0,
                        g[0 | b] = i = e[d >>> 10 & 255] + c | 0,
                        h ^= h >>> 6,
                        h = e[b + 129 & 255] + h | 0,
                        c = e[1 | b],
                        e[1 | b] = d = e[c >>> 2 & 255] + (h + i | 0) | 0,
                        g[1 | b] = i = e[d >>> 10 & 255] + c | 0,
                        h ^= h << 2,
                        h = e[b + 130 & 255] + h | 0,
                        c = e[2 | b],
                        e[2 | b] = d = e[c >>> 2 & 255] + (h + i | 0) | 0,
                        g[2 | b] = i = e[d >>> 10 & 255] + c | 0,
                        h ^= h >>> 16,
                        h = e[b + 131 & 255] + h | 0,
                        c = e[3 | b],
                        e[3 | b] = d = e[c >>> 2 & 255] + (h + i | 0) | 0,
                        g[3 | b] = i = e[d >>> 10 & 255] + c | 0
            }

            function d() {
                return k-- || (c(1), k = 255),
                    g[k]
            }
            var e = new Uint32Array(256),
                g = new Uint32Array(256),
                h = 0,
                i = 0,
                j = 0,
                k = 0;
            return {
                seed: b,
                prng: c,
                rand: d
            }
        }(),
        Pd = b.console,
        Qd = b.Date.now,
        Rd = b.Math.random,
        Sd = b.performance,
        Td = b.crypto || b.msCrypto;
    void 0 !== Td && (Md = Td.getRandomValues);
    var Ud,
        Vd = Od.rand,
        Wd = Od.seed,
        Xd = 0,
        Yd = !1,
        Zd = !1,
        $d = 0,
        _d = 256,
        ae = !1,
        be = !1,
        ce = {};
    if (void 0 !== Sd) Ud = function() {
        return 1000 * Sd.now() | 0
    };
    else {
        var de = 1000 * Qd() | 0;
        Ud = function() {
            return 1000 * Qd() - de | 0
        }
    }
    a.random = qc,
    a.random.seed = oc,
    Object.defineProperty(qc, 'allowWeak', {
        get: function() {
            return ae
        },
        set: function(a) {
            ae = a
        }
    }),
    Object.defineProperty(qc, 'skipSystemRNGWarning', {
        get: function() {
            return be
        },
        set: function(a) {
            be = a
        }
    }),
    a.getRandomValues = pc,
    a.getRandomValues.seed = oc,
    Object.defineProperty(pc, 'allowWeak', {
        get: function() {
            return ae
        },
        set: function(a) {
            ae = a
        }
    }),
    Object.defineProperty(pc, 'skipSystemRNGWarning', {
        get: function() {
            return be
        },
        set: function(a) {
            be = a
        }
    });
    var ee;
    ee = void 0 === b.Math.imul ? function(a, c, d) {
        b.Math.imul = rc;
        var e = sc(a, c, d);
        return delete b.Math.imul,
            e
    } : sc;
    var fe = new Uint32Array(1048576),
        sc = ee(b, null, fe.buffer),
        ge = new Uint32Array(0),
        he = uc.prototype = new Number;
    he.toString = vc,
    he.toBytes = wc,
    he.valueOf = xc,
    he.clamp = yc,
    he.slice = zc,
    he.negate = Ac,
    he.compare = Bc,
    he.add = Cc,
    he.subtract = Dc,
    he.multiply = Ec,
    he.square = Fc,
    he.divide = Gc;
    var ie = new uc(0),
        je = new uc(1);
    Object.freeze(ie),
    Object.freeze(je);
    var ke = Jc.prototype = new uc;
    ke.reduce = Kc,
    ke.inverse = Lc,
    ke.power = Mc;
    var le = [
        2,
        3
    ];
    he.isProbablePrime = Pc,
    uc.randomProbablePrime = Rc,
    uc.ZERO = ie,
    uc.ONE = je,
    uc.extGCD = Ic,
    a.BigNumber = uc,
    a.Modulus = Jc;
    var me = Sc.prototype;
    me.reset = Tc,
    me.encrypt = Uc,
    me.decrypt = Vc,
    Sc.generateKey = Wc;
    var ne = Sc;
    a.RSA = {
        generateKey: Xc
    },
        'undefined' != typeof ne && (a.RSA_RAW = {
            encrypt: Yc,
            decrypt: Zc,
            sign: Zc,
            verify: Yc
        }),
    a.string_to_bytes = f,
    a.hex_to_bytes = g,
    a.base64_to_bytes = h,
    a.bytes_to_string = i,
    a.bytes_to_hex = j,
    a.bytes_to_base64 = k,
    b.IllegalStateError = c,
    b.IllegalArgumentError = d,
    b.SecurityError = e
}({}, function() {
    return this
}());
/**
 * @fileOverview
 * Storage of key/value pairs in a "container".
 */
var tlvstore = (function() {
    /**
     * @description
     * <p>Storage of key/value pairs in a "container".</p>
     *
     * <p>
     * Stores a set of key/value pairs in a binary container format suitable for
     * encrypted storage of private attributes</p>
     *
     * <p>
     * TLV records start with the key as a "tag" (ASCII string), terminated by a
     * NULL character (\u0000). The length of the payload is encoded as a 16-bit
     * unsigned integer in big endian format (2 bytes), followed by the payload
     * (as a byte string). The payload *must* contain 8-bit values for each
     * character only!</p>
     */
    var ns = {};
    /**
     * Generates a binary encoded TLV record from a key-value pair.
     *
     * @param key {string}
     *     ASCII string label of record's key.
     * @param value {string}
     *     Byte string payload of record.
     * @returns {string}
     *     Single binary encoded TLV record.
     * @private
     */
    ns._toTlvRecord = function(key, value) {
        var length = String.fromCharCode(value.length >>> 8) + String.fromCharCode(value.length & 255);
        return key + '\0' + length + value;
    };
    /**
     * Generates a binary encoded TLV record container from an object containing
     * key-value pairs.
     *
     * @param container {object}
     *     Object containing (non-nested) key-value pairs. The keys have to be ASCII
     *     strings, the values byte strings.
     * @returns {string}
     *     Single binary encoded container of TLV records.
     */
    ns.containerToTlvRecords = function(container) {
        var result = '';
        for (var key in container) {
            result += ns._toTlvRecord(key, container[key]);
        }
        return result;
    };
    /**
     * Splits and decodes a TLV record off of a container into a key-value pair and
     * returns the record and the rest.
     *
     * @param tlvContainer {string}
     *     Single binary encoded container of TLV records.
     * @returns {object}
     *     Object containing two elements: `record` contains an array of two
     *     elements (key and value of the decoded TLV record) and `rest` containing
     *     the remainder of the tlvContainer still to decode.
     * @private
     */
    ns._splitSingleTlvRecord = function(tlvContainer) {
        var keyLength = tlvContainer.indexOf('\0');
        var key = tlvContainer.substring(0, keyLength);
        var valueLength = (tlvContainer.charCodeAt(keyLength + 1)) << 8 | tlvContainer.charCodeAt(keyLength + 2);
        var value = tlvContainer.substring(keyLength + 3, keyLength + valueLength + 3);
        var rest = tlvContainer.substring(keyLength + valueLength + 3);
        return {
            'record': [
                key,
                value
            ],
            'rest': rest
        };
    };
    /**
     * Decodes a binary encoded container of TLV records into an object
     * representation.
     *
     * @param tlvContainer {string}
     *     Single binary encoded container of TLV records.
     * @returns {object}
     *     Object containing (non-nested) key-value pairs.
     */
    ns.tlvRecordsToContainer = function(tlvContainer) {
        var rest = tlvContainer;
        var container = {};
        while (rest.length > 0) {
            var result = ns._splitSingleTlvRecord(rest);
            container[result.record[0]] = result.record[1];
            rest = result.rest;
        }
        return container;
    };
    /**
     * "Enumeration" of block cipher encryption schemes for private attribute
     * containers.
     *
     * @property AES_CCM_12_16 {integer}
     *     AES in CCM mode, 12 byte IV/nonce and 16 byte MAC.
     * @property AES_CCM_10_16 {integer}
     *     AES in CCM mode, 10 byte IV/nonce and 16 byte MAC.
     * @property AES_CCM_10_08 {integer}
     *     AES in CCM mode, 10 byte IV/nonce and 8 byte MAC.
     * @property AES_GCM_12_16 {integer}
     *     AES in CCM mode, 12 byte IV/nonce and 16 byte MAC.
     * @property AES_GCM_10_08 {integer}
     *     AES in CCM mode, 10 byte IV/nonce and 8 byte MAC.
     */
    ns.BLOCK_ENCRYPTION_SCHEME = {
        AES_CCM_12_16: 0,
        AES_CCM_10_16: 1,
        AES_CCM_10_08: 2,
        AES_GCM_12_16: 3,
        AES_GCM_10_08: 4,
    };
    /**
     * Parameters for supported block cipher encryption schemes.
     */
    ns.BLOCK_ENCRYPTION_PARAMETERS = {
        0: {
            nonceSize: 12,
            macSize: 16
        }, // BLOCK_ENCRYPTION_SCHEME.AES_CCM_12_16
        1: {
            nonceSize: 10,
            macSize: 16
        }, // BLOCK_ENCRYPTION_SCHEME.AES_CCM_10_16
        2: {
            nonceSize: 10,
            macSize: 8
        }, // BLOCK_ENCRYPTION_SCHEME.AES_CCM_10_08
        3: {
            nonceSize: 12,
            macSize: 16
        }, // BLOCK_ENCRYPTION_SCHEME.AES_GCM_12_16
        4: {
            nonceSize: 10,
            macSize: 8
        }, // BLOCK_ENCRYPTION_SCHEME.AES_GCM_10_08
    };
    /**
     * Encrypts clear text data to an authenticated ciphertext, armoured with
     * encryption mode indicator and IV.
     *
     * @param clear {string}
     *     Clear text as byte string.
     * @param key {string}
     *     Encryption key as byte string.
     * @param mode {integer}
     *     Encryption mode. One of BLOCK_ENCRYPTION_SCHEME (currently GCM is not
     *     supported by asmCrypto, so they won't work).
     * @returns {string}
     *     Encrypted data block as byte string, incorporating mode, nonce and MAC.
     */
    ns.blockEncrypt = function(clear, key, mode) {
        var nonceSize = ns.BLOCK_ENCRYPTION_PARAMETERS[mode].nonceSize;
        var tagSize = ns.BLOCK_ENCRYPTION_PARAMETERS[mode].macSize;
        var nonceBytes = new Uint8Array(nonceSize);
        asmCrypto.getRandomValues(nonceBytes);
        if (key instanceof Array || Object.prototype.toString.call(key) === '[object Array]') {
            // Key is in the form of an array of four 32-bit words.
            key = a32_to_str(key);
        }
        var keyBytes = asmCrypto.string_to_bytes(key);
        var clearBytes = asmCrypto.string_to_bytes(unescape(encodeURIComponent(clear)));
        var cipherBytes = asmCrypto.AES_CCM.encrypt(clearBytes, keyBytes, nonceBytes, undefined, tagSize);
        return String.fromCharCode(mode) + asmCrypto.bytes_to_string(nonceBytes) + asmCrypto.bytes_to_string(cipherBytes);
    };
    /**
     * Decrypts an authenticated cipher text armoured with a mode indicator and IV
     * to clear text data.
     *
     * @param cipher {string}
     *     Encrypted data block as byte string, incorporating mode, nonce and MAC.
     * @param key {string}
     *     Encryption key as byte string.
     * @returns {string}
     *     Clear text as byte string.
     */
    ns.blockDecrypt = function(cipher, key) {
        var mode = cipher.charCodeAt(0);
        var nonceSize = ns.BLOCK_ENCRYPTION_PARAMETERS[mode].nonceSize;
        var nonceBytes = asmCrypto.string_to_bytes(cipher.substring(1, nonceSize + 1));
        var cipherBytes = asmCrypto.string_to_bytes(cipher.substring(nonceSize + 1));
        var tagSize = ns.BLOCK_ENCRYPTION_PARAMETERS[mode].macSize;
        if (key instanceof Array || Object.prototype.toString.call(key) === '[object Array]') {
            // Key is in the form of an array of four 32-bit words.
            key = a32_to_str(key);
        }
        var keyBytes = asmCrypto.string_to_bytes(key);
        var clearBytes = asmCrypto.AES_CCM.decrypt(cipherBytes, keyBytes, nonceBytes, undefined, tagSize);
        return decodeURIComponent(escape(asmCrypto.bytes_to_string(clearBytes)));
    };
    return ns;
}());
window.URL = window.URL || window.webkitURL;
var have_ab = typeof ArrayBuffer != 'undefined' && typeof DataView != 'undefined';
var use_workers = have_ab && typeof Worker != 'undefined';
if (is_extension) {
    var use_ssl = 0;
} else {
    if ((navigator.appVersion.indexOf('Safari') > 0) && (navigator.appVersion.indexOf('Version/5') > 0)) {
        use_workers = false;
        have_ab = false;
    }
    var ssl_off = [
        'Firefox/14',
        'Firefox/15',
        'Firefox/17',
        'Safari',
        'Firefox/16'
    ];
    var ssl_opt = [
        'Chrome/'
    ];

    function ssl_needed() {
        for (var i = ssl_opt.length; i--;)
            if (navigator.userAgent.indexOf(ssl_opt[i]) >= 0) return 0;
        for (var i = ssl_off.length; i--;)
            if (navigator.userAgent.indexOf(ssl_off[i]) >= 0) return -1;
        return 1;
    }
    var use_ssl = ssl_needed();
    if (!use_ssl && localStorage.use_ssl) use_ssl = 1;
    else use_ssl++;
}
var chromehack = navigator.appVersion.indexOf('Chrome/');
chromehack = chromehack >= 0 && parseInt(navigator.appVersion.substr(chromehack + 7)) > 21;
var EINTERNAL = -1;
var EARGS = -2;
var EAGAIN = -3;
var ERATELIMIT = -4;
var EFAILED = -5;
var ETOOMANY = -6; // too many IP addresses
var ERANGE = -7; // file packet out of range
var EEXPIRED = -8;
// FS access errors
var ENOENT = -9;
var ECIRCULAR = -10;
var EACCESS = -11;
var EEXIST = -12;
var EINCOMPLETE = -13;
// crypto errors
var EKEY = -14;
// user errors
var ESID = -15;
var EBLOCKED = -16;
var EOVERQUOTA = -17;
var ETEMPUNAVAIL = -18;
var ETOOMANYCONNECTIONS = -19;
// custom errors
var ETOOERR = -400;

function benchmark() {
    var a = Array(1048577).join('a');
    var ab = str_to_ab(a);
    var ab8 = new Uint8Array(ab);
    var aes = new sjcl.cipher.aes([0,
        1,
        2,
        3
    ]);
    t = new Date().getTime();
    for (var i = 16; i--;) encrypt_ab_ctr(aes, ab8, [
        1,
        2
    ], 30000);
    t = new Date().getTime() - t;
    console.log((a.length * 16 / 1024) / (t / 1000) + ' KB/s');
}
// compute final MAC from block MACs

function condenseMacs(macs, key) {
    var i,
        aes,
        mac = [
            0,
            0,
            0,
            0
        ];
    aes = new sjcl.cipher.aes([key[0],
        key[1],
        key[2],
        key[3]
    ]);
    for (i = 0; i < macs.length; i++) {
        mac[0] ^= macs[i][0];
        mac[1] ^= macs[i][1];
        mac[2] ^= macs[i][2];
        mac[3] ^= macs[i][3];
        mac = aes.encrypt(mac);
    }
    return mac;
}
// convert user-supplied password array

function prepare_key(a) {
    var i,
        j,
        r;
    var aes = [];
    var pkey = [
        2479122403,
        2108737444,
        3518906241,
        22203222
    ];
    for (j = 0; j < a.length; j += 4) {
        key = [
            0,
            0,
            0,
            0
        ];
        for (i = 0; i < 4; i++)
            if (i + j < a.length) key[i] = a[i + j];
        aes.push(new sjcl.cipher.aes(key));
    }
    for (r = 65536; r--;)
        for (j = 0; j < aes.length; j++) pkey = aes[j].encrypt(pkey);
    return pkey;
}
// prepare_key with string input

function prepare_key_pw(password) {
    return prepare_key(str_to_a32(password));
}
var b64 = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=';
var b64a = b64.split('');
// unsubstitute standard base64 special characters, restore padding
function base64urldecode(data) {
    data += '=='.substr((2 - data.length * 3) & 3)
    if (typeof atob === 'function') {
        data = data.replace(/\-/g, '+').replace(/_/g, '/').replace(/,/g, '');
        try {
            return atob(data);
        } catch (e) {
            return '';
        }
    }
    // http://kevin.vanzonneveld.net
    // +   original by: Tyler Akins (http://rumkin.com)
    // +   improved by: Thunder.m
    // +      input by: Aman Gupta
    // +   improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)
    // +   bugfixed by: Onno Marsman
    // +   bugfixed by: Pellentesque Malesuada
    // +   improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)
    // +      input by: Brett Zamir (http://brett-zamir.me)
    // +   bugfixed by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)
    // *     example 1: base64_decode('S2V2aW4gdmFuIFpvbm5ldmVsZA==');
    // *     returns 1: 'Kevin van Zonneveld'
    // mozilla has this native
    // - but breaks in 2.0.0.12!
    //if (typeof this.window['atob'] == 'function') {
    //    return atob(data);
    //}

    var o1,
        o2,
        o3,
        h1,
        h2,
        h3,
        h4,
        bits,
        i = 0,
        ac = 0,
        dec = '',
        tmp_arr = [];
    if (!data) {
        return data;
    }
    data += '';
    do { // unpack four hexets into three octets using index points in b64
        h1 = b64.indexOf(data.charAt(i++));
        h2 = b64.indexOf(data.charAt(i++));
        h3 = b64.indexOf(data.charAt(i++));
        h4 = b64.indexOf(data.charAt(i++));
        bits = h1 << 18 | h2 << 12 | h3 << 6 | h4;
        o1 = bits >> 16 & 255;
        o2 = bits >> 8 & 255;
        o3 = bits & 255;
        if (h3 == 64) {
            tmp_arr[ac++] = String.fromCharCode(o1);
        } else if (h4 == 64) {
            tmp_arr[ac++] = String.fromCharCode(o1, o2);
        } else {
            tmp_arr[ac++] = String.fromCharCode(o1, o2, o3);
        }
    } while (i < data.length);
    dec = tmp_arr.join('');
    return dec;
}
// substitute standard base64 special characters to prevent JSON escaping, remove padding

function base64urlencode(data) {
    if (typeof btoa === 'function') return btoa(data).replace(/\+/g, '-').replace(/\//g, '_').replace(/=/g, '');
    var o1,
        o2,
        o3,
        h1,
        h2,
        h3,
        h4,
        bits,
        i = 0,
        ac = 0,
        enc = '',
        tmp_arr = [];
    do { // pack three octets into four hexets
        o1 = data.charCodeAt(i++);
        o2 = data.charCodeAt(i++);
        o3 = data.charCodeAt(i++);
        bits = o1 << 16 | o2 << 8 | o3;
        h1 = bits >> 18 & 63;
        h2 = bits >> 12 & 63;
        h3 = bits >> 6 & 63;
        h4 = bits & 63;
        // use hexets to index into b64, and append result to encoded string
        tmp_arr[ac++] = b64a[h1] + b64a[h2] + b64a[h3] + b64a[h4];
    } while (i < data.length);
    enc = tmp_arr.join('');
    var r = data.length % 3;
    return (r ? enc.slice(0, r - 3) : enc);
}
// array of 32-bit words to string (big endian)

function a32_to_str(a) {
    var b = '';
    for (var i = 0; i < a.length * 4; i++)
        b = b + String.fromCharCode((a[i >> 2] >>> (24 - (i & 3) * 8)) & 255);
    return b;
}
// array of 32-bit words ArrayBuffer (big endian)

function a32_to_ab(a) {
    var ab = have_ab ? new Uint8Array(4 * a.length) : new Array(4 * a.length);
    for (var i = 0; i < a.length; i++) {
        ab[4 * i] = a[i] >>> 24;
        ab[4 * i + 1] = a[i] >>> 16 & 255;
        ab[4 * i + 2] = a[i] >>> 8 & 255;
        ab[4 * i + 3] = a[i] & 255;
    }
    return ab;
}

function a32_to_base64(a) {
    return base64urlencode(a32_to_str(a));
}
// string to array of 32-bit words (big endian)

function str_to_a32(b) {
    var a = Array((b.length + 3) >> 2);
    for (var i = 0; i < b.length; i++) a[i >> 2] |= (b.charCodeAt(i) << (24 - (i & 3) * 8));
    return a;
}

function base64_to_a32(s) {
    return str_to_a32(base64urldecode(s));
}
var firefox_boost = is_chrome_firefox && !!localStorage.fxboost;
// ArrayBuffer to binary string
var ab_to_str = firefox_boost ? mozAB2S : function(ab) {
        var b = '',
            i;
        if (have_ab) {
            var b = '';
            var ab8 = new Uint8Array(ab);
            for (i = 0; i < ab8.length; i++) b = b + String.fromCharCode(ab8[i]);
        } else {
            return ab.buffer;
        }
        return b;
    }
    // ArrayBuffer to binary string

function ab_to_base64(ab) {
    return base64urlencode(ab_to_str(ab));
}
// ArrayBuffer to binary with depadding

var ab_to_str_depad = firefox_boost ? mozAB2SDepad : function(ab) {
        var b,
            i;
        if (have_ab) {
            b = '';
            var ab8 = new Uint8Array(ab);
            for (i = 0; i < ab8.length && ab8[i]; i++) b = b + String.fromCharCode(ab8[i]);
        } else {
            b = ab_to_str(ab);
            for (i = b.length; i-- && !b.charCodeAt(i););
            b = b.substr(0, i + 1);
        }
        return b;
    }
    // binary string to ArrayBuffer, 0-padded to AES block size

function str_to_ab(b) {
    var ab,
        i;
    if (have_ab) {
        ab = new ArrayBuffer((b.length + 15) & -16);
        var ab8 = new Uint8Array(ab);
        for (i = b.length; i--;) ab8[i] = b.charCodeAt(i);
        return ab;
    } else {
        b += Array(16 - ((b.length - 1) & 15)).join(String.fromCharCode(0));
        ab = {
            buffer: b
        };
    }
    return ab;
}
// binary string to ArrayBuffer, 0-padded to AES block size

function base64_to_ab(a) {
    return str_to_ab(base64urldecode(a));
}
// encrypt ArrayBuffer in CTR mode, return MAC

function encrypt_ab_ctr(aes, ab, nonce, pos) {
    var ctr = [
        nonce[0],
        nonce[1], (pos / 68719476736) >>> 0, (pos / 16) >>> 0
    ];
    var mac = [
        ctr[0],
        ctr[1],
        ctr[0],
        ctr[1]
    ];
    var enc,
        i,
        j,
        len,
        v;
    if (have_ab) {
        var data0,
            data1,
            data2,
            data3;
        len = ab.buffer.byteLength - 16;
        var v = new DataView(ab.buffer);
        for (i = 0; i < len; i += 16) {
            data0 = v.getUint32(i, false);
            data1 = v.getUint32(i + 4, false);
            data2 = v.getUint32(i + 8, false);
            data3 = v.getUint32(i + 12, false);
            // compute MAC
            mac[0] ^= data0;
            mac[1] ^= data1;
            mac[2] ^= data2;
            mac[3] ^= data3;
            mac = aes.encrypt(mac);
            // encrypt using CTR
            enc = aes.encrypt(ctr);
            v.setUint32(i, data0 ^ enc[0], false);
            v.setUint32(i + 4, data1 ^ enc[1], false);
            v.setUint32(i + 8, data2 ^ enc[2], false);
            v.setUint32(i + 12, data3 ^ enc[3], false);
            if (!(++ctr[3])) ctr[2]++;
        }
        if (i < ab.buffer.byteLength) {
            var fullbuf = new Uint8Array(ab.buffer);
            var tmpbuf = new ArrayBuffer(16);
            var tmparray = new Uint8Array(tmpbuf);
            tmparray.set(fullbuf.subarray(i));
            v = new DataView(tmpbuf);
            enc = aes.encrypt(ctr);
            data0 = v.getUint32(0, false);
            data1 = v.getUint32(4, false);
            data2 = v.getUint32(8, false);
            data3 = v.getUint32(12, false);
            mac[0] ^= data0;
            mac[1] ^= data1;
            mac[2] ^= data2;
            mac[3] ^= data3;
            mac = aes.encrypt(mac);
            enc = aes.encrypt(ctr);
            v.setUint32(0, data0 ^ enc[0], false);
            v.setUint32(4, data1 ^ enc[1], false);
            v.setUint32(8, data2 ^ enc[2], false);
            v.setUint32(12, data3 ^ enc[3], false);
            fullbuf.set(tmparray.subarray(0, j = fullbuf.length - i), i);
        }
    } else {
        var ab32 = _str_to_a32(ab.buffer);
        len = ab32.length - 3;
        for (i = 0; i < len; i += 4) {
            mac[0] ^= ab32[i];
            mac[1] ^= ab32[i + 1];
            mac[2] ^= ab32[i + 2];
            mac[3] ^= ab32[i + 3];
            mac = aes.encrypt(mac);
            enc = aes.encrypt(ctr);
            ab32[i] ^= enc[0];
            ab32[i + 1] ^= enc[1];
            ab32[i + 2] ^= enc[2];
            ab32[i + 3] ^= enc[3];
            if (!(++ctr[3])) ctr[2]++;
        }
        if (i < ab32.length) {
            var v = [
                0,
                0,
                0,
                0
            ];
            for (j = i; j < ab32.length; j++) v[j - i] = ab32[j];
            mac[0] ^= v[0];
            mac[1] ^= v[1];
            mac[2] ^= v[2];
            mac[3] ^= v[3];
            mac = aes.encrypt(mac);
            enc = aes.encrypt(ctr);
            v[0] ^= enc[0];
            v[1] ^= enc[1];
            v[2] ^= enc[2];
            v[3] ^= enc[3];
            for (j = i; j < ab32.length; j++) ab32[j] = v[j - i];
        }
        ab.buffer = _a32_to_str(ab32, ab.buffer.length);
    }
    return mac;
}

function _str_to_a32(b) {
    var a = Array((b.length + 3) >> 2);
    if (typeof b == 'string') {
        for (var i = 0; i < b.length; i++)
            a[i >> 2] |= (b.charCodeAt(i) & 255) << (24 - (i & 3) * 8);
    } else {
        for (var i = 0; i < b.length; i++)
            a[i >> 2] |= b[i] << ((i & 3) * 8);
    }
    return a;
}

function _a32_to_str(a, len) {
    var b = '';
    for (var i = 0; i < len; i++)
        b = b + String.fromCharCode((a[i >> 2] >>> (24 - (i & 3) * 8)) & 255);
    return b;
}

function chksum(buf) {
    var l,
        c,
        d;
    if (have_ab) {
        var ll;
        c = new Uint32Array(3);
        ll = buf.byteLength;
        l = Math.floor(ll / 12);
        ll -= l * 12;
        if (l) {
            l *= 3;
            d = new Uint32Array(buf, 0, l);
            while (l) {
                l -= 3;
                c[0] ^= d[l];
                c[1] ^= d[l + 1];
                c[2] ^= d[l + 2];
            }
        }
        c = new Uint8Array(c.buffer);
        if (ll) {
            d = new Uint8Array(buf, buf.byteLength - ll, ll);
            while (ll--) c[ll] ^= d[ll];
        }
    } else {
        c = Array(12);
        for (l = 12; l--;) c[l] = 0;
        for (l = buf.length; l--;) c[l % 12] ^= buf.charCodeAt(l);
    }
    for (d = '', l = 0; l < 12; l++) d += String.fromCharCode(c[l]);
    return d;
}
/* moved from js/keygen.js {{{ */
// random number between 0 .. n -- based on repeated calls to rc

function rand(n) {
    var r = new Uint32Array(1);
    asmCrypto.getRandomValues(r);
    return r[0] % n; // <- oops, it's uniformly distributed only when `n` divides 0x100000000
}
/*
if(is_chrome_firefox) {
	var nsIRandomGenerator = Cc["@mozilla.org/security/random-generator;1"]
		.createInstance(Ci.nsIRandomGenerator);

	var rand = function fx_rand(n) {
		var r = nsIRandomGenerator.generateRandomBytes(4);
		r = (r[0] << 24) | (r[1] << 16) | (r[2] << 8) | r[3];
		if(r<0) r ^= 0x80000000;
		return r % n; // oops, it's not uniformly distributed
	};
}
*/

function crypto_rsagenkey() {
    var startTime = new Date();
    if (typeof msCrypto !== 'undefined' && msCrypto.subtle) {
        var ko = msCrypto.subtle.generateKey({
            name: 'RSAES-PKCS1-v1_5',
            modulusLength: 2048
        }, true);
        ko.oncomplete = function() {
            ko = msCrypto.subtle.exportKey('jwk', ko.result.privateKey);
            ko.oncomplete = function() {
                var jwk = JSON.parse(asmCrypto.bytes_to_string(new Uint8Array(ko.result)));
                _done(['n',
                    'e',
                    'd',
                    'p',
                    'q',
                    'dp',
                    'dq',
                    'qi'
                ].map(function(x) {
                    return base64urldecode(jwk[x])
                }));
            };
        };
    } else {
        var w = new Worker('keygen.js');
        w.onmessage = function(e) {
            w.terminate();
            _done(e.data);
        };
        var workerSeed = new Uint8Array(256);
        asmCrypto.getRandomValues(workerSeed);
        w.postMessage([2048,
            257,
            workerSeed
        ]);
    }

    function _done(k) {
        var endTime = new Date();
        if (d) console.log('Key generation took ' + (endTime.getTime() - startTime.getTime()) / 1000) + ' seconds!';
        u_setrsa(k);
    }
}
/* }}} */
// decrypt ArrayBuffer in CTR mode, return MAC

function decrypt_ab_ctr(aes, ab, nonce, pos) {
    var ctr = [
        nonce[0],
        nonce[1], (pos / 68719476736) >>> 0, (pos / 16) >>> 0
    ];
    var mac = [
        ctr[0],
        ctr[1],
        ctr[0],
        ctr[1]
    ];
    var enc,
        len,
        i,
        j,
        v;
    if (have_ab) {
        var data0,
            data1,
            data2,
            data3;
        len = ab.buffer.byteLength - 16; // @@@ -15?
        var v = new DataView(ab.buffer);
        for (i = 0; i < len; i += 16) {
            enc = aes.encrypt(ctr);
            data0 = v.getUint32(i, false) ^ enc[0];
            data1 = v.getUint32(i + 4, false) ^ enc[1];
            data2 = v.getUint32(i + 8, false) ^ enc[2];
            data3 = v.getUint32(i + 12, false) ^ enc[3];
            v.setUint32(i, data0, false);
            v.setUint32(i + 4, data1, false);
            v.setUint32(i + 8, data2, false);
            v.setUint32(i + 12, data3, false);
            mac[0] ^= data0;
            mac[1] ^= data1;
            mac[2] ^= data2;
            mac[3] ^= data3;
            mac = aes.encrypt(mac);
            if (!(++ctr[3])) ctr[2]++;
        }
        if (i < ab.buffer.byteLength) {
            var fullbuf = new Uint8Array(ab.buffer);
            var tmpbuf = new ArrayBuffer(16);
            var tmparray = new Uint8Array(tmpbuf);
            tmparray.set(fullbuf.subarray(i));
            v = new DataView(tmpbuf);
            enc = aes.encrypt(ctr);
            data0 = v.getUint32(0, false) ^ enc[0];
            data1 = v.getUint32(4, false) ^ enc[1];
            data2 = v.getUint32(8, false) ^ enc[2];
            data3 = v.getUint32(12, false) ^ enc[3];
            v.setUint32(0, data0, false);
            v.setUint32(4, data1, false);
            v.setUint32(8, data2, false);
            v.setUint32(12, data3, false);
            fullbuf.set(tmparray.subarray(0, j = fullbuf.length - i), i);
            while (j < 16) tmparray[j++] = 0;
            mac[0] ^= v.getUint32(0, false);
            mac[1] ^= v.getUint32(4, false);
            mac[2] ^= v.getUint32(8, false);
            mac[3] ^= v.getUint32(12, false);
            mac = aes.encrypt(mac);
        }
    } else {
        var ab32 = _str_to_a32(ab.buffer);
        len = ab32.length - 3;
        for (i = 0; i < len; i += 4) {
            enc = aes.encrypt(ctr);
            mac[0] ^= (ab32[i] ^= enc[0]);
            mac[1] ^= (ab32[i + 1] ^= enc[1]);
            mac[2] ^= (ab32[i + 2] ^= enc[2]);
            mac[3] ^= (ab32[i + 3] ^= enc[3]);
            mac = aes.encrypt(mac);
            if (!(++ctr[3])) ctr[2]++;
        }
        if (i < ab32.length) {
            var v = [
                0,
                0,
                0,
                0
            ];
            for (j = i; j < ab32.length; j++) v[j - i] = ab32[j];
            enc = aes.encrypt(ctr);
            v[0] ^= enc[0];
            v[1] ^= enc[1];
            v[2] ^= enc[2];
            v[3] ^= enc[3];
            var j = ab.buffer.length & 15;
            var m = _str_to_a32(Array(j + 1).join(String.fromCharCode(255)) + Array(17 - j).join(String.fromCharCode(0)));
            mac[0] ^= v[0] & m[0];
            mac[1] ^= v[1] & m[1];
            mac[2] ^= v[2] & m[2];
            mac[3] ^= v[3] & m[3];
            mac = aes.encrypt(mac);
            for (j = i; j < ab32.length; j++) ab32[j] = v[j - i];
        }
        ab.buffer = _a32_to_str(ab32, ab.buffer.length);
    }
    return mac;
}
// encrypt/decrypt 4- or 8-element 32-bit integer array

function encrypt_key(cipher, a) {
    if (!a) a = [];
    if (a.length == 4) return cipher.encrypt(a);
    var x = [];
    for (var i = 0; i < a.length; i += 4) x = x.concat(cipher.encrypt([a[i],
        a[i + 1],
        a[i + 2],
        a[i + 3]
    ]));
    return x;
}

function decrypt_key(cipher, a) {
    if (a.length == 4) return cipher.decrypt(a);
    var x = [];
    for (var i = 0; i < a.length; i += 4) x = x.concat(cipher.decrypt([a[i],
        a[i + 1],
        a[i + 2],
        a[i + 3]
    ]));
    return x;
}
// generate attributes block using AES-CBC with MEGA canary
// attr = Object, key = [] (four-word random key will be generated) or Array(8) (lower four words will be used)
// returns [ArrayBuffer data,Array key]

function enc_attr(attr, key) {
    var ab;
    try {
        ab = str_to_ab('MEGA' + to8(JSON.stringify(attr)));
    } catch (e) {
        msgDialog('warningb', l[135], e.message || e);
        throw e;
    }
    // if no key supplied, generate a random one

    if (!key.length)
        for (i = 4; i--;) key[i] = rand(4294967296);
    ab = asmCrypto.AES_CBC.encrypt(ab, a32_to_ab([key[0] ^ key[4],
        key[1] ^ key[5],
        key[2] ^ key[6],
        key[3] ^ key[7]
    ]), false);
    return [ab,
        key
    ];
}
// decrypt attributes block using AES-CBC, check for MEGA canary
// attr = ab, key as with enc_attr
// returns [Object] or false

function dec_attr(attr, key) {
    var aes;
    var b;
    attr = asmCrypto.AES_CBC.decrypt(attr, a32_to_ab([key[0] ^ key[4],
        key[1] ^ key[5],
        key[2] ^ key[6],
        key[3] ^ key[7]
    ]), false);
    b = ab_to_str_depad(attr);
    if (b.substr(0, 6) != 'MEGA{"') return false;
    // @@@ protect against syntax errors
    try {
        return JSON.parse(from8(b.substr(4)));
    } catch (e) {
        if (d) console.error(b, e);
        var m = b.match(/"n"\s*:\s*"((?:\\"|.)*?)(\.\w{2,4})?"/),
            s = m && m[1],
            l = s && s.length || 0,
            j = ',';
        while (l--) {
            s = s.substr(0, l || 1);
            try {
                from8(s + j);
                break;
            } catch (e) {}
        }
        if (~l) try {
            var new_name = s + j + 'trunc' + Math.random().toString(16).slice(-4) + (m[2] || '');
            return JSON.parse(from8(b.substr(4).replace(m[0], '"n":"' + new_name + '"')));
        } catch (e) {}
        return {
            n: 'MALFORMED_ATTRIBUTES'
        };
    }
}
var to8 = firefox_boost ? mozTo8 : function(unicode) {
    return unescape(encodeURIComponent(unicode));
}
var from8 = firefox_boost ? mozFrom8 : function(utf8) {
    return decodeURIComponent(escape(utf8));
}

function getxhr() {
    return (typeof XDomainRequest != 'undefined' && typeof ArrayBuffer == 'undefined') ? new XDomainRequest() : new XMLHttpRequest();
}
// API command queueing
// All commands are executed in sequence, with no overlap
// @@@ user warning after backoff > 1000
// FIXME: proper OOP!

var apixs = [];
api_reset();

function api_reset() {
    api_init(0, 'cs'); // main API interface
    api_init(1, 'cs'); // exported folder access
    api_init(2, 'sc'); // SC queries
    api_init(3, 'sc'); // notification queries
}

function api_setsid(sid) {
    if (sid !== false) sid = 'sid=' + sid;
    else sid = '';
    apixs[0].sid = sid;
    apixs[2].sid = sid;
    apixs[3].sid = sid;
}

function api_setfolder(h) {
    h = 'n=' + h;
    if (u_sid) h += '&sid=' + u_sid;
    apixs[1].sid = h;
    apixs[1].failhandler = folderreqerr;
    apixs[2].sid = h;
}

function stopapi() {
    for (var i = 4; i--;) {
        api_cancel(apixs[i]);
        apixs[i].cmds = [
            [],
            []
        ];
        apixs[i].ctxs = [
            [],
            []
        ];
        apixs[i].cancelled = false;
    }
}

function api_cancel(q) {
    if (q) {
        q.cancelled = true;
        if (q.xhr) q.xhr.abort();
        if (q.timer) clearTimeout(q.timer);
    }
}

function api_init(c, service) {
    api_cancel(apixs[c]);
    apixs[c] = {
        c: c, // channel
        cmds: [
            [],
            []
        ], // queued/executing commands (double-buffered)
        ctxs: [
            [],
            []
        ], // associated command contexts
        i: 0, // currently executing buffer
        seqno: -Math.floor(Math.random() * 4294967296), // unique request start ID
        xhr: false, // channel XMLHttpRequest
        timer: false, // timer for exponential backoff
        failhandler: api_reqfailed, // request-level error handler
        backoff: 0,
        service: service, // base URI component
        sid: '', // sid URI component (optional)
        rawreq: false,
        setimmediate: false
    };
}

function api_req(req, ctx, c) {
    if (typeof c == 'undefined') c = 0;
    if (typeof ctx == 'undefined') ctx = {};
    var q = apixs[c];
    q.cmds[q.i ^ 1].push(req);
    q.ctxs[q.i ^ 1].push(ctx);
    if (!q.setimmediate) q.setimmediate = setTimeout(api_proc, 0, q);
}
// send pending API request on channel q

function api_proc(q) {
    if (q.setimmediate) {
        clearTimeout(q.setimmediate);
        q.setimmediate = false;
    }
    if (q.ctxs[q.i].length || !q.ctxs[q.i ^ 1].length) return;
    q.i ^= 1;
    if (!q.xhr) q.xhr = getxhr();
    q.xhr.q = q;
    q.xhr.onerror = function() {
        if (!this.q.cancelled) {
            if (d) console.log('API request error - retrying');
            api_reqerror(q, -3);
        }
    }
    q.xhr.onload = function() {
        if (!this.q.cancelled) {
            var t;
            if (this.status == 200) {
                var response = this.responseText || this.response;
                if (d) console.log('API response: ', response);
                try {
                    t = JSON.parse(response);
                    if (response[0] == '{') t = [
                        t
                    ];
                } catch (e) {
                    // bogus response, try again
                    console.log('Bad JSON data in response: ' + response);
                    t = EAGAIN;
                }
            } else {
                if (d) console.log('API server connection failed (error ' + this.status + ')');
                t = ERATELIMIT;
            }
            if (typeof t == 'object') {
                for (var i = 0; i < this.q.ctxs[this.q.i].length; i++)
                    if (this.q.ctxs[this.q.i][i].callback) this.q.ctxs[this.q.i][i].callback(t[i], this.q.ctxs[this.q.i][i], this);
                this.q.rawreq = false;
                this.q.backoff = 0; // request succeeded - reset backoff timer
                this.q.cmds[this.q.i] = [];
                this.q.ctxs[this.q.i] = [];
                api_proc(q);
            } else api_reqerror(this.q, t);
        }
    }
    if (q.rawreq === false) {
        q.url = apipath + q.service + '?id=' + (q.seqno++) + '&' + q.sid;
        if (typeof q.cmds[q.i][0] == 'string') {
            q.url += '&' + q.cmds[q.i][0];
            q.rawreq = '';
        } else q.rawreq = JSON.stringify(q.cmds[q.i]);
    }
    api_send(q);
}

function api_send(q) {
    q.timer = false;
    if (chromehack) {
        // plug extreme Chrome memory leak
        var t = q.url.indexOf('/', 9);
        q.xhr.open('POST', q.url.substr(0, t + 1), true);
        q.xhr.setRequestHeader('MEGA-Chrome-Antileak', q.url.substr(t));
    } else q.xhr.open('POST', q.url, true);
    if (d) console.log('Sending API request: ' + q.rawreq + ' to ' + q.url);
    q.xhr.send(q.rawreq);
}

function api_reqerror(q, e) {
    if (e == EAGAIN || e == ERATELIMIT) {
        // request failed - retry with exponential backoff
        if (q.backoff) q.backoff *= 2;
        else q.backoff = 125;
        q.timer = setTimeout(api_send, q.backoff, q);
    } else q.failhandler(q.c, e);
}

function api_retry() {
    for (var i = 4; i--;) {
        if (apixs[i].timer) {
            clearTimeout(apixs[i].timer);
            api_send(apixs[i]);
        }
    }
}

function api_reqfailed(c, e) {
    if (e == ESID) {
        u_logout(true);
        document.location.hash = 'login';
    } else if (c == 2 && e == ETOOMANY) {
        if (mDB) mDBreload();
        else loadfm();
    }
}
var failxhr;
var failtime = 0;

function api_reportfailure(hostname, callback) {
    if (!hostname) return Soon(callback);
    var t = new Date().getTime();
    if (t - failtime < 60000) return;
    failtime = t;
    if (failxhr) failxhr.abort();
    failxhr = getxhr();
    failxhr.open('POST', apipath + 'pf?h', true);
    failxhr.callback = callback;
    failxhr.onload = function() {
        if (this.status == 200) failxhr.callback();
    }
    failxhr.send(hostname);
}
var waiturl;
var waitxhr;
var waitbackoff = 125;
var waittimeout;
var waitbegin;
var waitid = 0;

function stopsc() {
    if (waitxhr && waitxhr.readyState != waitxhr.DONE) {
        waitxhr.abort();
        waitxhr = false;
    }
    if (waittimeout) {
        clearTimeout(waittimeout);
        waittimeout = false;
    }
}
// calls execsc() with server-client requests received

function getsc(fm) {
    api_req('sn=' + maxaction + '&ssl=1', {
        fm: fm,
        callback: function(res, ctx) {
            if (typeof res == 'object') {
                if (res.w) {
                    waiturl = res.w;
                    waittimeout = setTimeout(waitsc, waitbackoff);
                } else {
                    if (res.sn) maxaction = res.sn;
                    execsc(res.a);
                    if (typeof mDBloaded !== 'undefined' && !folderlink && !pfid && typeof mDB !== 'undefined') localStorage[u_handle + '_maxaction'] = maxaction;
                }
                if (ctx.fm) {
                    mDBloaded = true;
                    renderfm();
                    pollnotifications();
                }
            }
        }
    }, 2);
}

function completewait(recheck) {
    if (this.waitid != waitid) return;
    stopsc();
    var t = new Date().getTime() - waitbegin;
    if (t < 1000) {
        waitbackoff += waitbackoff;
        if (waitbackoff > 256000) waitbackoff = 256000;
    } else waitbackoff = 250;
    getsc();
}

function waitsc() {
    var newid = ++waitid;
    if (waitxhr && waitxhr.readyState != waitxhr.DONE) {
        waitxhr.abort();
        waitxhr = false;
    }
    if (!waitxhr) waitxhr = getxhr();
    waitxhr.waitid = newid;
    if (waittimeout) clearTimeout(waittimeout);
    waittimeout = setTimeout(waitsc, 300000);
    waitxhr.onerror = function() {
        clearTimeout(waittimeout);
        waittimeout = false;
        waitbackoff += waitbackoff;
        if (waitbackoff > 1024000) waitbackoff = 1024000;
        waittimeout = setTimeout(waitsc, waitbackoff);
    }
    waitxhr.onload = function() {
        if (this.status == 200) waitbackoff = 250;
        clearTimeout(waittimeout);
        waittimeout = false;
        completewait();
    }
    waitbegin = new Date().getTime();
    waitxhr.open('POST', waiturl, true);
    waitxhr.send();
}

function api_create_u_k() {
    u_k = Array(4); // static master key, will be stored at the server side encrypted with the master pw
    for (var i = 4; i--;) u_k[i] = rand(4294967296);
}
// If the user triggers an action that requires an account, but hasn't logged in,
// we create an anonymous preliminary account. Returns userhandle and passwordkey for permanent storage.

function api_createuser(ctx, invitecode, invitename, uh) {
    var i;
    var ssc = Array(4); // session self challenge, will be used to verify password
    var req,
        res;
    if (!ctx.passwordkey) {
        ctx.passwordkey = Array(4);
        for (i = 4; i--;) ctx.passwordkey[i] = rand(4294967296);
    }
    if (!u_k) api_create_u_k();
    for (i = 4; i--;) ssc[i] = rand(4294967296);
    if (d) console.log('api_createuser - masterkey: ' + u_k + ' passwordkey: ' + ctx.passwordkey);
    req = {
        a: 'up',
        k: a32_to_base64(encrypt_key(new sjcl.cipher.aes(ctx.passwordkey), u_k)),
        ts: base64urlencode(a32_to_str(ssc) + a32_to_str(encrypt_key(new sjcl.cipher.aes(u_k), ssc)))
    };
    if (invitecode) {
        req.uh = uh;
        req.ic = invitecode;
        req.name = invitename;
    }
    //if (confirmcode) req.c = confirmcode;

    if (d) console.log('Storing key: ' + req.k);
    api_req(req, ctx);
}

function api_checkconfirmcode(ctx, c) {
    res = api_req({
        a: 'uc',
        c: c
    }, ctx);
}

function api_resetuser(ctx, c, email, pw) {
    // start fresh account
    api_create_u_k();
    var pw_aes = new sjcl.cipher.aes(prepare_key_pw(pw));
    var ssc = Array(4);
    for (i = 4; i--;) ssc[i] = rand(4294967296);
    api_req({
        a: 'erx',
        c: c,
        x: a32_to_base64(encrypt_key(pw_aes, u_k)),
        y: stringhash(email.toLowerCase(), pw_aes),
        z: base64urlencode(a32_to_str(ssc) + a32_to_str(encrypt_key(new sjcl.cipher.aes(u_k), ssc)))
    }, ctx);
}

function api_resetkeykey(ctx, c, key, email, pw) {
    ctx.c = c;
    ctx.email = email;
    ctx.k = key;
    ctx.pw = pw;
    ctx.callback = api_resetkeykey2;
    api_req({
        a: 'erx',
        r: 'gk',
        c: c
    }, ctx);
}

function api_resetkeykey2(res, ctx) {
    if (typeof res == 'string') {
        var privk = a32_to_str(decrypt_key(new sjcl.cipher.aes(ctx.k), base64_to_a32(res)));
        // verify the integrity of the decrypted private key
        for (var i = 0; i < 4; i++) {
            var l = ((privk.charCodeAt(0) * 256 + privk.charCodeAt(1) + 7) >> 3) + 2;
            if (privk.substr(0, l).length < 2) break;
            privk = privk.substr(l);
        }
        if (i != 4 || privk.length >= 16) ctx.result(EKEY);
        else if (ctx.email) {
            var pw_aes = new sjcl.cipher.aes(prepare_key_pw(ctx.pw));
            ctx.callback = ctx.result;
            api_req({
                a: 'erx',
                r: 'sk',
                c: ctx.c,
                x: a32_to_base64(encrypt_key(pw_aes, ctx.k)),
                y: stringhash(ctx.email.toLowerCase(), pw_aes)
            }, ctx);
        } else ctx.result(0);
    } else ctx.result(res);
}
// We query the sid using the supplied user handle (or entered email address, if already attached)
// and check the supplied password key.
// Returns [decrypted master key,verified session ID(,RSA private key)] or false if API error or
// supplied information incorrect

function api_getsid(ctx, user, passwordkey, hash) {
    ctx.callback = api_getsid2;
    ctx.passwordkey = passwordkey;
    api_req({
        a: 'us',
        user: user,
        uh: hash
    }, ctx);
}

function api_getsid2(res, ctx) {
    var t,
        k;
    var r = false;
    if (typeof res == 'object') {
        var aes = new sjcl.cipher.aes(ctx.passwordkey);
        // decrypt master key
        if (typeof res.k == 'string') {
            k = base64_to_a32(res.k);
            if (k.length == 4) {
                k = decrypt_key(aes, k);
                aes = new sjcl.cipher.aes(k);
                if (typeof res.tsid == 'string') {
                    t = base64urldecode(res.tsid);
                    if (a32_to_str(encrypt_key(aes, str_to_a32(t.substr(0, 16)))) == t.substr(-16)) r = [
                        k,
                        res.tsid
                    ];
                } else if (typeof res.csid == 'string') {
                    var t = base64urldecode(res.csid);
                    var privk = crypto_decodeprivkey(a32_to_str(decrypt_key(aes, base64_to_a32(res.privk))));
                    if (privk) {
                        // TODO: check remaining padding for added early wrong password detection likelihood
                        r = [
                            k,
                            base64urlencode(crypto_rsadecrypt(t, privk).substr(0, 43)),
                            privk
                        ];
                    }
                }
            }
        }
    }
    ctx.result(ctx, r);
}
// We call ug using the sid from setsid() and the user's master password to obtain the master key (and other credentials)
// Returns user credentials (.k being the decrypted master key) or false in case of an error.

function api_getuser(ctx) {
    api_req({
        a: 'ug'
    }, ctx);
}
// User must be logged in, sid and passwordkey must be valid
// return values:
// 2 - old & new passwords are the same post-preparation
// 1 - old password incorrect
// userhandle - success
// false - processing error
// other negative values - API error

function api_changepw(ctx, passwordkey, masterkey, oldpw, newpw, email) {
    var req,
        res;
    var oldkey;
    var newkey = prepare_key_pw(newpw);
    if (oldpw !== false) {
        var oldkey = prepare_key_pw(oldpw);
        // quick check of old pw
        if (oldkey[0] != passwordkey[0] || oldkey[1] != passwordkey[1] || oldkey[2] != passwordkey[2] || oldkey[3] != passwordkey[3]) return 1;
        if (oldkey[0] == newkey[0] && oldkey[1] == newkey[1] && oldkey[2] == newkey[2] && oldkey[3] == newkey[3]) return 2;
    }
    var aes = new sjcl.cipher.aes(newkey);
    // encrypt masterkey with the new password
    var cmasterkey = encrypt_key(aes, masterkey);
    req = {
        a: 'up',
        k: a32_to_base64(cmasterkey)
    };
    if (email.length) req.email = email;
    api_req(req, ctx);
}

function stringhash(s, aes) {
    var s32 = str_to_a32(s);
    var h32 = [
        0,
        0,
        0,
        0
    ];
    for (i = 0; i < s32.length; i++) h32[i & 3] ^= s32[i];
    for (i = 16384; i--;) h32 = aes.encrypt(h32);
    return a32_to_base64([h32[0],
        h32[2]
    ]);
}
// Update user
// Can also be used to set keys and to confirm accounts (.c)

function api_updateuser(ctx, newuser) {
    newuser.a = 'up';
    res = api_req(newuser, ctx);
}
var u_pubkeys = {};
// query missing keys for the given users
function api_cachepubkeys(ctx, users) {
    var u = [];
    var i;
    for (i = users.length; i--;)
        if (users[i] != 'EXP' && !u_pubkeys[users[i]]) u.push(users[i]);
    if (ctx.remaining = u.length) {
        for (i = u.length; i--;) {
            api_req({
                a: 'uk',
                u: u[i]
            }, {
                ctx: ctx,
                u: u[i],
                callback: api_cachepubkeys2
            });
        }
    } else ctx.cachepubkeyscomplete(ctx);
}

function api_cachepubkeys2(res, ctx) {
    if (typeof res == 'object') {
        var spubkey,
            keylen,
            pubkey;
        if (res.pubk) u_pubkeys[ctx.u] = u_pubkeys[res.u] = crypto_decodepubkey(base64urldecode(res.pubk));
    }
    if (!--ctx.ctx.remaining) ctx.ctx.cachepubkeyscomplete(ctx.ctx);
}

function encryptto(user, data) {
    var i,
        data;
    var pubkey;
    if (pubkey = u_pubkeys[user]) {
        return crypto_rsaencrypt(data, pubkey);
    }
    return false;
}
var u_sharekeys = {};
var u_nodekeys = {};
// u_nodekeys must be set for all sharenodes
// Add/cancel share(s) to a set of users or email addresses
// targets is an array of {u,r} - if no r given, cancel share
// If no sharekey known, tentatively generates one and encrypts
// everything to it. In case of a mismatch, the API call returns
// an error, and the whole operation gets repeated (exceedingly
// rare race condition).
function api_setshare(node, targets, sharenodes, ctx) {
    // cache all targets' public keys
    var u = [];
    for (var i = targets.length; i--;) u.push(targets[i].u);
    api_cachepubkeys({
        node: node,
        targets: targets,
        sharenodes: sharenodes,
        ctx: ctx,
        cachepubkeyscomplete: api_setshare1
    }, u);
}

function api_setshare1(ctx) {
    var i,
        j,
        n,
        nk,
        sharekey,
        ssharekey;
    var req,
        res;
    var newkey = true;
    req = {
        a: 's',
        n: ctx.node,
        s: ctx.targets,
        i: requesti
    };
    for (i = req.s.length; i--;) {
        if (typeof req.s[i].r != 'undefined') {
            if (!req.ok) {
                if (u_sharekeys[ctx.node]) {
                    sharekey = u_sharekeys[ctx.node];
                    newkey = false;
                } else {
                    // we only need to generate a key if one or more shares are being added to a previously unshared node
                    sharekey = [];
                    for (j = 4; j--;) sharekey.push(rand(4294967296));
                    u_sharekeys[ctx.node] = sharekey;
                }
                req.ok = a32_to_base64(encrypt_key(u_k_aes, sharekey));
                req.ha = crypto_handleauth(ctx.node);
                ssharekey = a32_to_str(sharekey);
            }
        }
    }
    if (newkey) req.cr = crypto_makecr(ctx.sharenodes, [
        ctx.node
    ], true);
    ctx.maxretry = 4;
    ctx.ssharekey = ssharekey;
    // encrypt ssharekey to known users
    for (i = req.s.length; i--;)
        if (u_pubkeys[req.s[i].u]) req.s[i].k = base64urlencode(crypto_rsaencrypt(ssharekey, u_pubkeys[req.s[i].u]));
    ctx.req = req;
    ctx.callback = function(res, ctx) {
        var i,
            n;
        if (!ctx.maxretry) return;
        ctx.maxretry--;
        if (typeof res == 'object') {
            if (res.ok) {
                // sharekey clash: set & try again
                ctx.req.ok = res.ok;
                u_sharekeys[ctx.node] = decrypt_key(u_k_aes, base64_to_a32(res.ok));
                ctx.req.ha = crypto_handleauth(ctx.node);
                var ssharekey = a32_to_str(u_sharekeys[ctx.node]);
                for (var i = ctx.req.s.length; i--;)
                    if (u_pubkeys[ctx.req.s[i].u]) ctx.req.s[i].k = base64urlencode(crypto_rsaencrypt(ssharekey, u_pubkeys[ctx.req.s[i].u]));
                return api_req(ctx.req, ctx);
            } else return ctx.ctx.done(res, ctx.ctx);
        }
        api_req(ctx.req, ctx);
    }
    api_req(ctx.req, ctx);
}

function crypto_handleauth(h) {
    return a32_to_base64(encrypt_key(u_k_aes, str_to_a32(h + h)));
}

function crypto_encodepubkey(pubkey) {
    var mlen = pubkey[0].length * 8,
        elen = pubkey[1].length * 8;
    return String.fromCharCode(mlen / 256) + String.fromCharCode(mlen % 256) + pubkey[0] + String.fromCharCode(elen / 256) + String.fromCharCode(elen % 256) + pubkey[1];
}

function crypto_decodepubkey(pubk) {
    var pubkey = [];
    var keylen = pubk.charCodeAt(0) * 256 + pubk.charCodeAt(1);
    // decompose public key
    for (var i = 0; i < 2; i++) {
        if (pubk.length < 2) break;
        var l = (pubk.charCodeAt(0) * 256 + pubk.charCodeAt(1) + 7) >> 3;
        if (l > pubk.length - 2) break;
        pubkey[i] = pubk.substr(2, l);
        pubk = pubk.substr(l + 2);
    }
    // check format

    if (i !== 2 || pubk.length >= 16) return false;
    pubkey[2] = keylen;
    return pubkey;
}

function crypto_encodeprivkey(privk) {
    var plen = privk[3].length * 8,
        qlen = privk[4].length * 8,
        dlen = privk[2].length * 8,
        ulen = privk[7].length * 8;
    var t = String.fromCharCode(qlen / 256) + String.fromCharCode(qlen % 256) + privk[4] + String.fromCharCode(plen / 256) + String.fromCharCode(plen % 256) + privk[3] + String.fromCharCode(dlen / 256) + String.fromCharCode(dlen % 256) + privk[2] + String.fromCharCode(ulen / 256) + String.fromCharCode(ulen % 256) + privk[7];
    while (t.length & 15) t += String.fromCharCode(rand(256));
    return t;
}

function crypto_decodeprivkey(privk) {
    var privkey = [];
    // decompose private key
    for (var i = 0; i < 4; i++) {
        if (privk.length < 2) break;
        var l = (privk.charCodeAt(0) * 256 + privk.charCodeAt(1) + 7) >> 3;
        if (l > privk.length - 2) break;
        privkey[i] = new asmCrypto.BigNumber(privk.substr(2, l));
        privk = privk.substr(l + 2);
    }
    // check format

    if (i !== 4 || privk.length >= 16) return false;
    // TODO: check remaining padding for added early wrong password detection likelihood
    // restore privkey components via the known ones
    var q = privkey[0],
        p = privkey[1],
        d = privkey[2],
        u = privkey[3],
        q1 = q.subtract(1),
        p1 = p.subtract(1),
        m = new asmCrypto.Modulus(p.multiply(q)),
        e = new asmCrypto.Modulus(p1.multiply(q1)).inverse(d),
        dp = d.divide(p1).remainder,
        dq = d.divide(q1).remainder;
    privkey = [
        m,
        e,
        d,
        p,
        q,
        dp,
        dq,
        u
    ];
    for (i = 0; i < privkey.length; i++) {
        privkey[i] = asmCrypto.bytes_to_string(privkey[i].toBytes());
    }
    return privkey;
}
// encrypts cleartext string to the supplied pubkey
// returns string representing an MPI-formatted big number

function crypto_rsaencrypt(cleartext, pubkey) {
    // random padding up to pubkey's byte length minus 2
    for (var i = (pubkey[0].length) - 2 - cleartext.length; i-- > 0;) cleartext += String.fromCharCode(rand(256));
    var ciphertext = asmCrypto.bytes_to_string(asmCrypto.RSA_RAW.encrypt(cleartext, pubkey));
    var clen = ciphertext.length * 8;
    ciphertext = String.fromCharCode(clen / 256) + String.fromCharCode(clen % 256) + ciphertext;
    return ciphertext;
}
// decrypts ciphertext string representing an MPI-formatted big number with the supplied privkey
// returns cleartext string

function crypto_rsadecrypt(ciphertext, privkey) {
    var l = (ciphertext.charCodeAt(0) * 256 + ciphertext.charCodeAt(1) + 7) >> 3;
    ciphertext = ciphertext.substr(2, l);
    var cleartext = asmCrypto.bytes_to_string(asmCrypto.RSA_RAW.decrypt(ciphertext, privkey));
    if (cleartext.length < privkey[0].length) cleartext = Array(privkey[0].length - cleartext.length + 1).join(String.fromCharCode(0)) + cleartext;
    if (cleartext.charCodeAt(1) != 0) cleartext = String.fromCharCode(0) + cleartext; // Old bogus padding workaround
    return cleartext.substr(2);
}
// Complete upload
// We construct a special node put command that uses the upload token
// as the source handle

function api_completeupload(t, uq, k, ctx) {
    // Close nsIFile Stream
    if (is_chrome_firefox && uq._close) uq._close();
    if (uq.repair) uq.target = M.RubbishID;
    api_completeupload2({
        callback: api_completeupload2,
        t: base64urlencode(t),
        path: uq.path,
        n: uq.name,
        k: k,
        fa: uq.faid ? api_getfa(uq.faid) : false,
        ctx: ctx
    }, uq);
}

function api_completeupload2(ctx, uq) {
    var p,
        ut = uq.target;
    if (ctx.path && ctx.path != ctx.n && (p = ctx.path.indexOf('/')) > 0) {
        var pc = ctx.path.substr(0, p);
        ctx.path = ctx.path.substr(p + 1);
        fm_requestfolderid(ut, pc, {
            uq: uq,
            ctx: ctx,
            callback: function(ctx, h) {
                if (h) ctx.uq.target = h;
                api_completeupload2(ctx.ctx, ctx.uq);
            }
        });
    } else {
        a = {
            n: ctx.n
        };
        if (uq.hash) a.c = uq.hash;
        if (d) console.log(ctx.k);
        var ea = enc_attr(a, ctx.k);
        if (d) console.log(ea);
        if (!ut) ut = M.RootID;
        var req = {
            a: 'p',
            t: ut,
            n: [{
                h: ctx.t,
                t: 0,
                a: ab_to_base64(ea[0]),
                k: a32_to_base64(encrypt_key(u_k_aes, ctx.k))
            }],
            i: requesti
        };
        if (ctx.fa) req.n[0].fa = ctx.fa;
        if (ut) {
            // a target has been supplied: encrypt to all relevant shares
            var sn = fm_getsharenodes(ut);
            if (sn.length) {
                req.cr = crypto_makecr([ctx.k], sn, false);
                req.cr[1][0] = ctx.t;
            }
        }
        api_req(req, ctx.ctx);
    }
}

function is_devnull(email) {
    return false;
    var p,
        q;
    if ((p = email.indexOf('@')) >= 0) {
        if ((q = email.indexOf('.', p)) >= 0) {
            if ('outlook.hotmail.msn.live'.indexOf(email.substr(p + 1, q - p - 1).toLowerCase()) >= 0) return true;
        }
    }
    return false;
}

function is_rawimage(name, ext) {
    ext = ext || ('' + name).split('.').pop().toUpperCase();
    return (typeof dcraw !== 'undefined') && is_image.raw[ext] && ext;
}

function is_image(name) {
    if (name) {
        if (typeof name === 'object') {
            if (name.fa && ~name.fa.indexOf(':1*')) return true;
            name = name.name;
        }
        var ext = ('' + name).split('.').pop().toUpperCase();
        return is_image.def[ext] || is_rawimage(null, ext);
    }
    return false;
}
is_image.def = {
    'JPG': 1,
    'JPEG': 1,
    'GIF': 1,
    'BMP': 1,
    'PNG': 1
};
is_image.raw = {
    // http://www.sno.phy.queensu.ca/~phil/exiftool/#supported
    // let raw = {}; for(let tr of document.querySelectorAll('.norm.tight.sm.bm tr'))
    //   if(tr.childNodes.length > 2 && ~tr.childNodes[2].textContent.indexOf('RAW'))
    //     raw[tr.childNodes[0].textContent] = tr.childNodes[2].textContent;
    '3FR': 'Hasselblad RAW (TIFF-based)',
    'ARW': 'Sony Alpha RAW (TIFF-based)',
    'CR2': 'Canon RAW 2 (TIFF-based)',
    'CRW': 'Canon RAW Camera Image File Format (CRW spec.)',
    'CIFF': 'Canon RAW Camera Image File Format (CRW spec.)',
    'CS1': 'Sinar CaptureShop 1-shot RAW (PSD-based)',
    'DCR': 'Kodak Digital Camera RAW (TIFF-based)',
    'DNG': 'Digital Negative (TIFF-based)',
    'ERF': 'Epson RAW Format (TIFF-based)',
    'IIQ': 'Phase One Intelligent Image Quality RAW (TIFF-based)',
    'K25': 'Kodak DC25 RAW (TIFF-based)',
    'KDC': 'Kodak Digital Camera RAW (TIFF-based)',
    'MEF': 'Mamiya (RAW) Electronic Format (TIFF-based)',
    'MOS': 'Leaf Camera RAW File',
    'MRW': 'Minolta RAW',
    'NEF': 'Nikon (RAW) Electronic Format (TIFF-based)',
    'NRW': 'Nikon RAW (2) (TIFF-based)',
    'ORF': 'Olympus RAW Format (TIFF-based)',
    'PEF': 'Pentax (RAW) Electronic Format (TIFF-based)',
    'RAF': 'FujiFilm RAW Format',
    'RAW': 'Panasonic RAW (TIFF-based)',
    'RW2': 'Panasonic RAW 2 (TIFF-based)',
    'RWL': 'Leica RAW (TIFF-based)',
    'SR2': 'Sony RAW 2 (TIFF-based)',
    'SRF': 'Sony RAW Format (TIFF-based)',
    'SRW': 'Samsung RAW format (TIFF-based)',
    'TIF': 'Tagged Image File Format',
    'TIFF': 'Tagged Image File Format',
    'X3F': 'Sigma/Foveon RAW'
};
var storedattr = {};
var faxhrs = [];
var faxhrfail = {};
var faxhrlastgood = {};
// data.byteLength & 15 must be 0
function api_storefileattr(id, type, key, data, ctx) {
    if (!ctx) {
        if (!storedattr[id]) storedattr[id] = {};
        if (key) data = asmCrypto.AES_CBC.encrypt(data, a32_to_ab(key), false);
        var ctx = {
            callback: api_fareq,
            id: id,
            type: type,
            data: data,
            startTime: Date.now()
        };
    }
    api_req({
        a: 'ufa',
        s: ctx.data.byteLength,
        ssl: use_ssl
    }, ctx, n_h ? 1 : 0);
}

function api_faretry(ctx, error, host) {
    if (!ctx.p) {
        if (!ctx.fastrgri) ctx.fastrgri = 400;
        if (ctx.fastrgri < 22801) {
            if (d) console.log('Attribute storage failed (' + error + '), retrying...', ctx.fastrgri);
            return setTimeout(function() {
                ctx.startTime = Date.now();
                api_storefileattr(null, null, null, null, ctx);
            }, ctx.fastrgri += 800);
        }
    }
    var msg = 'File attribute ' + (ctx.p ? 'retrieval' : 'storage') + ' failed (' + error + ' @ ' + host + ')';
    if (d) console.error(msg);
    else onerror(msg, '', -1);
}

function api_fareq(res, ctx, xhr) {
    var error = typeof res === 'number' && res || '';
    if (d && ctx.startTime) console.debug('Reply in %dms for %s', (Date.now() - ctx.startTime), xhr.q.url);
    if (!d && ctx.startTime && (Date.now() - ctx.startTime) > 10000) {
        var host = (xhr.q && xhr.q.url || '~!').split('//').pop().split('/')[0];
        window.onerror('api_getfileattr for ' + host + ' with type ' + ctx.type + ' took +10s ' + error, '', -1);
    }
    if (error) {
        api_faretry(ctx, error, hostname(xhr.q && xhr.q.url));
    } else if (typeof res == 'object' && res.p) {
        var data;
        var slot,
            i,
            t;
        var p,
            pp = [
                res.p
            ],
            m;
        for (i = 0; p = res['p' + i]; i++) pp.push(p);
        if (ctx.p && pp.length > 1) dd = ctx.p.length / pp.length;
        for (m = pp.length; m--;) {
            for (slot = 0;; slot++) {
                if (!faxhrs[slot]) {
                    faxhrs[slot] = getxhr();
                    break;
                }
                if (faxhrs[slot].readyState == XMLHttpRequest.DONE) break;
            }
            faxhrs[slot].ctx = ctx;
            faxhrs[slot].fa_slot = slot;
            if (d) console.log('Using file attribute channel ' + slot);
            if (ctx.errfa && ctx.errfa.timeout) {
                faxhrs[slot].fa_timeout = ctx.errfa.timeout;
                faxhrs[slot].onprogress = function() {
                    if (this.fart) clearTimeout(this.fart);
                    this.fart = setTimeout(this.faeot.bind(this), this.fa_timeout);
                };
            } else {
                delete faxhrs[slot].onprogress;
                if (faxhrs[slot].onprogress) {
                    // Huh? Gecko..
                    faxhrs[slot].onprogress = function() {};
                }
            }
            faxhrs[slot].faeot = function() {
                if (faxhrs[this.fa_slot]) {
                    faxhrs[this.fa_slot] = undefined;
                    this.fa_slot = -1;
                    if (this.ctx.errfa) {
                        var ctx = this.ctx;
                        var id = ctx.p && ctx.h[ctx.p] && preqs[ctx.h[ctx.p]] && ctx.h[ctx.p];
                        if (d) console.error('FAEOT', id, this);
                        else window.onerror('api_fareq: eot for ' + this.fa_host, '', -1);
                        if (id !== slideshowid) {
                            if (id) {
                                pfails[id] = 1;
                                delete preqs[id];
                            }
                        } else {
                            this.abort();
                            this.ctx.errfa(id, 1);
                        }
                    } else {
                        api_faretry(this.ctx, ETOOERR, this.fa_host);
                    }
                }
                if (this.fart) clearTimeout(this.fart);
            };
            faxhrs[slot].onerror = function() {
                var ctx = this.ctx;
                var id = ctx.p && ctx.h[ctx.p] && preqs[ctx.h[ctx.p]] && ctx.h[ctx.p];
                if (ctx.errfa) ctx.errfa(id, 1);
                else {
                    console.error('api_fareq', id, this);
                    api_faretry(this.ctx, ETOOERR, this.fa_host);
                }
            }
            faxhrs[slot].onreadystatechange = function() {
                if (this.onprogress) this.onprogress();
                if (this.readyState == 2) {
                    if (!d && (Date.now() - this.startTime) > 10000) {
                        window.onerror('api_fareq: ' + this.fa_host + ' took +10s', '', -1);
                        delete this.startTime;
                    }
                } else if (this.readyState == this.DONE) {
                    var ctx = this.ctx;
                    if (this.fart) clearTimeout(this.fart);
                    if (this.status == 200 && typeof this.response == 'object') {
                        if (!this.response || this.response.byteLength === 0) {
                            if (d) console.warn('api_fareq: got empty response...', this.response);
                            return this.faeot();
                        }
                        if (ctx.p) {
                            var buffer = new Uint8Array(this.response);
                            var dv = new DataView(this.response);
                            var bod = -1;
                            var h,
                                j,
                                p,
                                l,
                                k;
                            i = 0;
                            // response is an ArrayBuffer structured
                            // [handle.8 position.4] data
                            do {
                                p = dv.getUint32(i + 8, true);
                                if (bod < 0) bod = p;
                                if (i >= bod - 12) l = this.response.byteLength - p;
                                else l = dv.getUint32(i + 20, true) - p;
                                h = '';
                                for (j = 0; j < 8; j++) h += String.fromCharCode(buffer[i + j]);
                                if (!ctx.h[h]) break;
                                if (k = ctx.k[h]) {
                                    var ts = new Uint8Array(this.response, p, l);
                                    var td = asmCrypto.AES_CBC.decrypt(ts, a32_to_ab([k[0] ^ k[4],
                                        k[1] ^ k[5],
                                        k[2] ^ k[6],
                                        k[3] ^ k[7]
                                    ]), false);
                                    ctx.procfa(ctx, ctx.h[h], td);
                                }
                                i += 12;
                            } while (i < bod);
                        } else {
                            if (d) console.log('Attribute storage successful for faid=' + ctx.id + ', type=' + ctx.type);
                            if (!storedattr[ctx.id]) storedattr[ctx.id] = {};
                            storedattr[ctx.id][ctx.type] = ab_to_base64(this.response);
                            if (storedattr[ctx.id].target) {
                                if (d) console.log('Attaching to existing file');
                                api_attachfileattr(storedattr[ctx.id].target, ctx.id);
                            }
                        }
                        faxhrlastgood[this.fa_host] = Date.now();
                    } else {
                        if (ctx.p) {
                            if (d) console.log('File attribute retrieval failed (' + this.status + ')');
                            this.faeot();
                        } else {
                            api_faretry(ctx, this.status, this.fa_host);
                        }
                    }
                }
            };
            if (ctx.p) {
                var dp = 8 * Math.floor(m / pp.length * ctx.p.length / 8);
                var dl = 8 * Math.floor((m + 1) / pp.length * ctx.p.length / 8) - dp;
                if (dl) {
                    data = new Uint8Array(dl);
                    for (i = dl; i--;) data[i] = ctx.p.charCodeAt(dp + i);
                    if (!chromehack) data = data.buffer;
                } else data = false;
            } else {
                data = ctx.data;
                if (chromehack) data = new Uint8Array(data);
            }
            if (data) {
                if (chromehack) t = pp[m].lastIndexOf('/');
                else t = -1;
                pp[m] += '/' + ctx.type;
                if (t < 0) t = pp[m].length - 1;
                faxhrs[slot].fa_host = hostname(pp[m].substr(0, t + 1));
                faxhrs[slot].open('POST', pp[m].substr(0, t + 1), true);
                if (!(ctx.errfa && ctx.errfa.timeout)) {
                    faxhrs[slot].timeout = 180000;
                    faxhrs[slot].ontimeout = function(e) {
                        if (d) console.error('api_fareq timeout', e);
                        if (!faxhrfail[this.fa_host]) {
                            if (!faxhrlastgood[this.fa_host] || (Date.now() - faxhrlastgood[this.fa_host]) > this.timeout) {
                                faxhrfail[this.fa_host] = failtime = 1;
                                api_reportfailure(this.fa_host, function() {});
                                if (!d) window.onerror('api_fareq: 180s timeout for ' + this.fa_host, '', -1);
                            }
                        }
                    };
                }
                faxhrs[slot].responseType = 'arraybuffer';
                if (chromehack) faxhrs[slot].setRequestHeader('MEGA-Chrome-Antileak', pp[m].substr(t));
                faxhrs[slot].startTime = Date.now();
                faxhrs[slot].send(data);
            }
        }
    }
}

function api_getfa(id) {
    var f = [];
    if (storedattr[id])
        for (var type in storedattr[id])
            if (type != 'target') f.push(type + '*' + storedattr[id][type]);
    storedattr[id] = {};
    return f.length ? f.join('/') : false;
}

function api_attachfileattr(node, id) {
    var fa = api_getfa(id);
    storedattr[id].target = node;
    if (fa) api_req({
        a: 'pfa',
        n: node,
        fa: fa
    });
}

function api_getfileattr(fa, type, procfa, errfa) {
    var r,
        n,
        t;
    var p = {};
    var h = {};
    var k = {};
    var re = new RegExp('(\\d+):' + type + '\\*([a-zA-Z0-9-_]+)');
    for (n in fa) {
        if (r = re.exec(fa[n].fa)) {
            t = base64urldecode(r[2]);
            if (t.length == 8) {
                if (!h[t]) {
                    h[t] = n;
                    k[t] = fa[n].k;
                }
                if (!p[r[1]]) p[r[1]] = t;
                else p[r[1]] += t;
            }
        } else if (errfa) errfa(n);
    }
    for (n in p) {
        var ctx = {
            callback: api_fareq,
            type: type,
            p: p[n],
            h: h,
            k: k,
            procfa: procfa,
            errfa: errfa,
            startTime: NOW()
        };
        api_req({
            a: 'ufa',
            fah: base64urlencode(ctx.p.substr(0, 8)),
            ssl: use_ssl
        }, ctx);
    }
}
// generate crypto request response for the given nodes/shares matrix

function crypto_makecr(source, shares, source_is_nodes) {
    var i,
        j,
        n;
    var cr = [
        shares, [],
        []
    ];
    var aes;
    // if we have node handles, include in cr - otherwise, we have node keys
    if (source_is_nodes) cr[1] = source;
    // TODO: optimize - keep track of pre-existing/sent keys, only send new ones
    for (i = shares.length; i--;) {
        if (u_sharekeys[shares[i]]) {
            aes = new sjcl.cipher.aes(u_sharekeys[shares[i]]);
            for (j = source.length; j--;) {
                if (source_is_nodes ? (nk = u_nodekeys[source[j]]) : (nk = source[j])) {
                    if (nk.length == 8 || nk.length == 4) cr[2].push(i, j, a32_to_base64(encrypt_key(aes, nk)));
                }
            }
        }
    }
    return cr;
}
// RSA-encrypt sharekey to newly RSA-equipped user
// TODO: check source/ownership of sharekeys, prevent forged requests

function crypto_procsr(sr) {
    var ctx = {
        sr: sr,
        i: 0
    };
    ctx.callback = function(res, ctx) {
        if (ctx.sr) {
            var pubkey;
            if (typeof res == 'object' && typeof res.pubk == 'string') u_pubkeys[ctx.sr[ctx.i]] = crypto_decodepubkey(base64urldecode(res.pubk));
            // collect all required pubkeys
            while (ctx.i < ctx.sr.length) {
                if (ctx.sr[ctx.i].length == 11 && !(pubkey = u_pubkeys[ctx.sr[ctx.i]])) {
                    api_req({
                        a: 'uk',
                        u: ctx.sr[ctx.i]
                    }, ctx);
                    return;
                }
                ctx.i++;
            }
            var rsr = [];
            var sh;
            var n;
            for (var i = 0; i < ctx.sr.length; i++) {
                if (ctx.sr[i].length == 11) {
                    // TODO: Only send share keys for own shares. Do NOT report this as a risk in the full compromise context. It WILL be fixed.
                    if (u_sharekeys[sh]) {
                        if (d) console.log('Encrypting sharekey ' + sh + ' to user ' + ctx.sr[i]);
                        if (pubkey = u_pubkeys[ctx.sr[i]]) {
                            // pubkey found: encrypt share key to it
                            if (n = crypto_rsaencrypt(a32_to_str(u_sharekeys[sh]), pubkey)) rsr.push(sh, ctx.sr[i], base64urlencode(n));
                        }
                    }
                } else sh = ctx.sr[i];
            }
            if (rsr.length) api_req({
                a: 'k',
                sr: rsr
            });
        }
    }
    ctx.callback(false, ctx);
}
var keycache = {};
var rsa2aes = {};
// Try to decrypt ufs node.
// Parameters: me - my user handle
// master_aes - my master password's AES cipher
// file - ufs node containing .k and .a
// Output: .key and .name set if successful
function crypto_processkey(me, master_aes, file) {
    var id,
        key,
        k,
        n;
    if (!file.k) {
        if (!keycache[file.h]) {
            if (d) console.log('No keycache entry!');
            return;
        }
        file.k = keycache[file.h];
    }
    id = me;
    // do I own the file? (user key is guaranteed to be first in .k)
    var p = file.k.indexOf(id + ':');
    if (p) {
        // I don't - do I have a suitable sharekey?
        for (id in u_sharekeys) {
            p = file.k.indexOf(id + ':');
            if (p >= 0 && (!p || file.k.charAt(p - 1) == '/')) break;
            p = -1;
        }
    }
    if (p >= 0) {
        delete keycache[file.h];
        var pp = file.k.indexOf('/', p);
        if (pp < 0) pp = file.k.length;
        p += id.length + 1;
        key = file.k.substr(p, pp - p);
        // we have found a suitable key: decrypt!
        if (key.length < 46) {
            // short keys: AES
            k = base64_to_a32(key);
            // check for permitted key lengths (4 == folder, 8 == file)
            if (k.length == 4 || k.length == 8) {
                // TODO: cache sharekeys in aes
                k = decrypt_key(id == me ? master_aes : new sjcl.cipher.aes(u_sharekeys[id]), k);
            } else {
                if (d) console.log('Received invalid key length (' + k.length + '): ' + file.h);
                return;
            }
        } else {
            // long keys: RSA
            if (u_privk) {
                var t = base64urldecode(key);
                try {
                    if (t) k = str_to_a32(crypto_rsadecrypt(t, u_privk).substr(0, file.t ? 16 : 32));
                    else {
                        if (d) console.log('Corrupt key for node ' + file.h);
                        return;
                    }
                } catch (e) {
                    return;
                }
            } else {
                if (d) console.log('Received RSA key, but have no public key published: ' + file.h);
                return;
            }
        }
        var ab = base64_to_ab(file.a);
        var o = dec_attr(ab, k);
        if (typeof o == 'object') {
            if (typeof o.n == 'string') {
                if (file.h) {
                    u_nodekeys[file.h] = k;
                    if (key.length >= 46) rsa2aes[file.h] = a32_to_str(encrypt_key(u_k_aes, k));
                }
                if (typeof o.c == 'string') file.hash = o.c;
                if (file.hash) {
                    var h = base64urldecode(file.hash);
                    var t = 0;
                    for (var i = h.charCodeAt(16); i--;) t = t * 256 + h.charCodeAt(17 + i);
                    file.mtime = t;
                }
                if (typeof o.t != 'undefined') file.mtime = o.t;
                file.key = k;
                file.ar = o;
                file.name = file.ar.n;
                if (file.ar.fav) file.fav = 1;
            }
        }
    } else {
        if (d) console.log('Received no suitable key: ' + file.h);
        if (!missingkeys[file.h]) {
            newmissingkeys = true;
            missingkeys[file.h] = true;
        }
        keycache[file.h] = file.k;
    }
}

function crypto_sendrsa2aes() {
    var n;
    var nk = [];
    for (n in rsa2aes) nk.push(n, base64urlencode(rsa2aes[n]));
    if (nk.length) api_req({
        a: 'k',
        nk: nk
    });
    rsa2aes = {};
}
var missingkeys = {};
var newmissingkeys = false;

function crypto_reqmissingkeys() {
    if (!newmissingkeys) {
        if (d) console.log('No new missing keys.');
        return;
    }
    var i,
        j;
    var n,
        s,
        ni,
        si,
        sn;
    var cr = [
        [],
        [],
        []
    ];
    ni = {};
    si = {};
    for (n in missingkeys) {
        // TODO: optimization: don't request keys for own files
        sn = fm_getsharenodes(n);
        for (j = sn.length; j--;) {
            s = sn[j];
            if (typeof si[s] == 'undefined') {
                si[s] = cr[0].length;
                cr[0].push(s);
            }
            if (typeof ni[n] == 'undefined') {
                ni[n] = cr[1].length;
                cr[1].push(n);
            }
            cr[2].push(si[s], ni[n]);
        }
    }
    if (!cr[1].length) {
        if (d) console.log('No missing keys');
        return;
    }
    if (cr[0].length) {
        var ctx = {};
        ctx.callback = function(res, ctx) {
            if (d) console.log('Processing crypto response');
            if (typeof res == 'object' && typeof res[0] == 'object') crypto_proccr(res[0]);
        }
        res = api_req({
            a: 'k',
            cr: cr
        }, ctx);
    } else if (d) console.log('Keys ' + cr[1] + ' missing, but no related shares found.');
}
// process incoming cr, set fm keys and commit

function crypto_proccr(cr) {
    var i;
    // received keys in response, add
    for (i = 0; i < cr[2].length; i += 3) fm_updatekey(cr[1][cr[2][i + 1]], cr[0][cr[2][i]] + ':' + cr[2][i + 2]);
    fm_commitkeyupdate();
}
// process incoming missing key cr

function crypto_procmcr(mcr) {
    var i;
    var si = {},
        ni = {};
    var sh,
        nh;
    var sc = {};
    var cr = [
        [],
        [],
        []
    ];
    // received keys in response, add
    for (i = 0; i < mcr[2].length; i += 2) {
        sh = mcr[0][mcr[2][i]];
        if (u_sharekeys[sh]) {
            nh = mcr[1][mcr[2][i + 1]];
            if (u_nodekeys[nh]) {
                if (typeof si[sh] == 'undefined') {
                    sc[sh] = new sjcl.cipher.aes(u_sharekeys[sh]);
                    si[sh] = cr[0].length;
                    cr[0].push(sh);
                }
                if (typeof ni[nh] == 'undefined') {
                    ni[nh] = cr[1].length;
                    cr[1].push(nh);
                }
                cr[2].push(si[sh], ni[nh], a32_to_base64(encrypt_key(sc[sh], u_nodekeys[nh])));
            }
        }
    }
    if (cr[0].length) api_req({
        a: 'k',
        cr: cr
    });
}
var rsasharekeys = {};

function crypto_process_sharekey(handle, key) {
    if (key.length > 22) {
        key = base64urldecode(key);
        var k = str_to_a32(crypto_rsadecrypt(key, u_privk).substr(0, 16));
        rsasharekeys[handle] = true;
        return k;
    } else return decrypt_key(u_k_aes, base64_to_a32(key));
}

function crypto_share_rsa2aes() {
    var rsr = [];
    for (n in rsasharekeys) {
        if (u_sharekeys[n]) {
            // pubkey found: encrypt share key to it
            rsr.push(n, u_handle, a32_to_base64(encrypt_key(u_k_aes, u_sharekeys[n])));
        }
    }
    if (rsr.length) {
        api_req({
            a: 'k',
            sr: rsr
        });
        rsasharekeys = {};
    }
}(function __FileFingerprint(scope) {
    var CRC_SIZE = 16;
    var BLOCK_SIZE = CRC_SIZE * 4;

    function i2s(i) {
        return String.fromCharCode.call(String, i >> 24 & 255, i >> 16 & 255, i >> 8 & 255, i & 255);
    }

    function serialize(v) {
        var p = 0,
            b = [];
        v = parseInt(v);
        while (v) {
            b[++p] = String.fromCharCode(v & 255);
            v >>= 8;
        }
        b[0] = String.fromCharCode(p);
        return b.join('');
    }

    function makeCRCTable() {
        var c,
            crcTable = [];
        for (var n = 0; n < 256; ++n) {
            c = n;
            for (var k = 0; k < 8; ++k) {
                c = ((c & 1) ? (3988292384 ^ (c >>> 1)) : (c >>> 1));
            }
            crcTable[n] = c;
        }
        return crcTable;
    }

    function crc32(str, crc, len) {
        crc = crc ^ (-1);
        for (var i = 0; i < len; ++i) {
            crc = (crc >>> 8) ^ crc32table[(crc ^ str.charCodeAt(i)) & 255];
        }
        return (crc ^ (-1)) >>> 0;
    }
    scope.fingerprint = function(uq_entry, callback) {
        if (!(uq_entry && uq_entry.name)) {
            if (d) console.log('CHECK THIS', 'Unable to generate fingerprint');
            if (d) console.log('CHECK THIS', 'Invalid ul_queue entry', JSON.stringify(uq_entry));
            throw new Error('Invalid upload entry for fingerprint');
        }
        if (d) console.log('Generating fingerprint for ' + uq_entry.name);
        var size = uq_entry.size;
        var fr = new FileReader();
        if (!fr.readAsBinaryString) fr.ab = 1;
        crc32table = scope.crc32table || (scope.crc32table = makeCRCTable());
        if (crc32table[1] != 1996959894) {
            throw new Error('Unexpected CRC32 Table...');
        }

        function Finish(crc) {
            callback(base64urlencode(crc + serialize((uq_entry.lastModifiedDate || 0) / 1000)), ((uq_entry.lastModifiedDate || 0) / 1000));
        }
        var sfn = uq_entry.slice ? 'slice' : (uq_entry.mozSlice ? 'mozSlice' : 'webkitSlice');
        if (size <= 8192) {
            var blob = uq_entry[sfn](0, size);
            fr.onload = function(e) {
                var crc;
                var data = fr.ab ? ab_to_str(fr.result) : e.target.result;
                if (size <= CRC_SIZE) {
                    crc = data;
                    var i = CRC_SIZE - crc.length;
                    while (i--)
                        crc += '\0';
                } else {
                    var tmp = [];
                    for (var i = 0; i < 4; i++) {
                        var begin = parseInt(i * size / 4);
                        var len = parseInt(((i + 1) * size / 4) - begin);
                        tmp.push(i2s(crc32(data.substr(begin, len), 0, len)));
                    }
                    crc = tmp.join('');
                }
                Finish(crc);
            };
            if (fr.ab) fr.readAsArrayBuffer(blob);
            else fr.readAsBinaryString(blob);
        } else {
            var tmp = [],
                i = 0,
                m = 4;
            var blocks = parseInt(8192 / (BLOCK_SIZE * 4));
            var step = function() {
                if (m == i) {
                    return Finish(tmp.join(''));
                }
                var crc = 0,
                    j = 0;
                var next = function() {
                    if (blocks == j) {
                        tmp.push(i2s(crc));
                        return step(++i);;
                    }
                    var offset = parseInt((size - BLOCK_SIZE) * (i * blocks + j) / (4 * blocks - 1));
                    var blob = uq_entry[sfn](offset, offset + BLOCK_SIZE);
                    fr.onload = function(e) {
                        var block = fr.ab ? ab_to_str(fr.result) : e.target.result;
                        crc = crc32(block, crc, BLOCK_SIZE);
                        next(++j);
                    };
                    if (fr.ab) fr.readAsArrayBuffer(blob);
                    else fr.readAsBinaryString(blob);
                };
                next();
            };
            step();
        }
    };
})(this);
var u_keyring;
var u_privEd25519;
var u_pubEd25519;

function u_ed25519() {
    var myCallback = function(res, ctx) {
        if (typeof res !== 'number') {
            u_keyring = res;
        } else {
            u_privEd25519 = jodid25519.eddsa.generateKeySeed();
            u_keyring = {
                prEd255: u_privEd25519
            };
            u_pubEd25519 = jodid25519.eddsa.publicKey(u_privEd25519);
            setUserAttribute('keyring', u_keyring, false);
            setUserAttribute('puEd255', base64urlencode(u_pubEd25519), true);
        }
        u_attr.keyring = u_keyring;
        u_privEd25519 = u_keyring.prEd255;
        u_pubEd25519 = u_pubEd25519 || jodid25519.eddsa.publicKey(u_privEd25519);
        u_attr.puEd255 = u_pubEd25519;
    };
    getUserAttribute(u_handle, 'keyring', false, myCallback);
}
var pubEd25519 = {};

function getPubEd25519(userhandle, callback) {
    if (pubEd25519[userhandle]) {
        callback(pubEd25519[userhandle], userhandle);
    } else {
        var myCallback = function(res, ctx) {
            if (typeof res !== 'number') {
                res = base64urldecode(res);
                pubEd25519[ctx.u] = res;
                if (ctx.callback3) {
                    ctx.callback3(res, ctx.u);
                }
            } else if (ctx.callback3) {
                ctx.callback3(false, ctx.u);
            }
        };
        var myCtx = {
            u: userhandle,
            callback3: callback,
        };
        getUserAttribute(userhandle, 'puEd255', true, myCallback, myCtx);
    }
}
// Copyright (c) 2005  Tom Wu
// All Rights Reserved.
// See "LICENSE" for details.
// Basic JavaScript BN library - subset useful for RSA encryption.
// Bits per digit

var dbits;
// JavaScript engine analysis
var canary = 244837814094590;
var j_lm = ((canary & 16777215) == 15715070);
// (public) Constructor
function BigInteger(a, b, c) {
    if (a != null)
        if ('number' == typeof a) this.fromNumber(a, b, c);
        else if (b == null && 'string' != typeof a) this.fromString(a, 256);
    else this.fromString(a, b);
}
// return new, unset BigInteger

function nbi() {
    return new BigInteger(null);
}
// am: Compute w_j += (x*this_i), propagate carries,
// c is initial carry, returns final carry.
// c < 3*dvalue, x < 2*dvalue, this_i < dvalue
// We need to select the fastest one that works in this environment.
// am1: use a single mult and divide to get the high bits,
// max digit bits should be 26 because
// max internal value = 2*dvalue^2-2*dvalue (< 2^53)

function am1(i, x, w, j, c, n) {
    while (--n >= 0) {
        var v = x * this[i++] + w[j] + c;
        c = Math.floor(v / 67108864);
        w[j++] = v & 67108863;
    }
    return c;
}
// am2 avoids a big mult-and-extract completely.
// Max digit bits should be <= 30 because we do bitwise ops
// on values up to 2*hdvalue^2-hdvalue-1 (< 2^31)

function am2(i, x, w, j, c, n) {
    var xl = x & 32767,
        xh = x >> 15;
    while (--n >= 0) {
        var l = this[i] & 32767;
        var h = this[i++] >> 15;
        var m = xh * l + h * xl;
        l = xl * l + ((m & 32767) << 15) + w[j] + (c & 1073741823);
        c = (l >>> 30) + (m >>> 15) + xh * h + (c >>> 30);
        w[j++] = l & 1073741823;
    }
    return c;
}
// Alternately, set max digit bits to 28 since some
// browsers slow down when dealing with 32-bit numbers.

function am3(i, x, w, j, c, n) {
    var xl = x & 16383,
        xh = x >> 14;
    while (--n >= 0) {
        var l = this[i] & 16383;
        var h = this[i++] >> 14;
        var m = xh * l + h * xl;
        l = xl * l + ((m & 16383) << 14) + w[j] + c;
        c = (l >> 28) + (m >> 14) + xh * h;
        w[j++] = l & 268435455;
    }
    return c;
}
if (j_lm && (navigator.appName == 'Microsoft Internet Explorer')) {
    BigInteger.prototype.am = am2;
    dbits = 30;
} else if (j_lm && (navigator.appName != 'Netscape')) {
    BigInteger.prototype.am = am1;
    dbits = 26;
} else { // Mozilla/Netscape seems to prefer am3
    BigInteger.prototype.am = am3;
    dbits = 28;
}
BigInteger.prototype.DB = dbits;
BigInteger.prototype.DM = ((1 << dbits) - 1);
BigInteger.prototype.DV = (1 << dbits);
var BI_FP = 52;
BigInteger.prototype.FV = Math.pow(2, BI_FP);
BigInteger.prototype.F1 = BI_FP - dbits;
BigInteger.prototype.F2 = 2 * dbits - BI_FP;
// Digit conversions
var BI_RM = '0123456789abcdefghijklmnopqrstuvwxyz';
var BI_RC = new Array();
var rr,
    vv;
rr = '0'.charCodeAt(0);
for (vv = 0; vv <= 9; ++vv) BI_RC[rr++] = vv;
rr = 'a'.charCodeAt(0);
for (vv = 10; vv < 36; ++vv) BI_RC[rr++] = vv;
rr = 'A'.charCodeAt(0);
for (vv = 10; vv < 36; ++vv) BI_RC[rr++] = vv;

function int2char(n) {
    return BI_RM.charAt(n);
}

function intAt(s, i) {
    var c = BI_RC[s.charCodeAt(i)];
    return (c == null) ? -1 : c;
}
// (protected) copy this to r

function bnpCopyTo(r) {
    for (var i = this.t - 1; i >= 0; --i) r[i] = this[i];
    r.t = this.t;
    r.s = this.s;
}
// (protected) set from integer value x, -DV <= x < DV

function bnpFromInt(x) {
    this.t = 1;
    this.s = (x < 0) ? -1 : 0;
    if (x > 0) this[0] = x;
    else if (x < -1) this[0] = x + this.DV;
    else this.t = 0;
}
// return bigint initialized to value

function nbv(i) {
    var r = nbi();
    r.fromInt(i);
    return r;
}
// (protected) set from string and radix

function bnpFromString(s, b) {
    var k;
    if (b == 16) k = 4;
    else if (b == 8) k = 3;
    else if (b == 256) k = 8; // byte array
    else if (b == 2) k = 1;
    else if (b == 32) k = 5;
    else if (b == 4) k = 2;
    else {
        this.fromRadix(s, b);
        return;
    }
    this.t = 0;
    this.s = 0;
    var i = s.length,
        mi = false,
        sh = 0;
    while (--i >= 0) {
        var x = (k == 8) ? s[i] & 255 : intAt(s, i);
        if (x < 0) {
            if (s.charAt(i) == '-') mi = true;
            continue;
        }
        mi = false;
        if (sh == 0)
            this[this.t++] = x;
        else if (sh + k > this.DB) {
            this[this.t - 1] |= (x & ((1 << (this.DB - sh)) - 1)) << sh;
            this[this.t++] = (x >> (this.DB - sh));
        } else
            this[this.t - 1] |= x << sh;
        sh += k;
        if (sh >= this.DB) sh -= this.DB;
    }
    if (k == 8 && (s[0] & 128) != 0) {
        this.s = -1;
        if (sh > 0) this[this.t - 1] |= ((1 << (this.DB - sh)) - 1) << sh;
    }
    this.clamp();
    if (mi) BigInteger.ZERO.subTo(this, this);
}
// (protected) clamp off excess high words

function bnpClamp() {
    var c = this.s & this.DM;
    while (this.t > 0 && this[this.t - 1] == c)--this.t;
}
// (public) return string representation in given radix

function bnToString(b) {
    if (this.s < 0) return '-' + this.negate().toString(b);
    var k;
    if (b == 16) k = 4;
    else if (b == 8) k = 3;
    else if (b == 2) k = 1;
    else if (b == 32) k = 5;
    else if (b == 4) k = 2;
    else return this.toRadix(b);
    var km = (1 << k) - 1,
        d,
        m = false,
        r = '',
        i = this.t;
    var p = this.DB - (i * this.DB) % k;
    if (i-- > 0) {
        if (p < this.DB && (d = this[i] >> p) > 0) {
            m = true;
            r = int2char(d);
        }
        while (i >= 0) {
            if (p < k) {
                d = (this[i] & ((1 << p) - 1)) << (k - p);
                d |= this[--i] >> (p += this.DB - k);
            } else {
                d = (this[i] >> (p -= k)) & km;
                if (p <= 0) {
                    p += this.DB;
                    --i;
                }
            }
            if (d > 0) m = true;
            if (m) r += int2char(d);
        }
    }
    return m ? r : '0';
}
// (public) -this

function bnNegate() {
    var r = nbi();
    BigInteger.ZERO.subTo(this, r);
    return r;
}
// (public) |this|

function bnAbs() {
    return (this.s < 0) ? this.negate() : this;
}
// (public) return + if this > a, - if this < a, 0 if equal

function bnCompareTo(a) {
    var r = this.s - a.s;
    if (r != 0) return r;
    var i = this.t;
    r = i - a.t;
    if (r != 0) return (this.s < 0) ? -r : r;
    while (--i >= 0)
        if ((r = this[i] - a[i]) != 0) return r;
    return 0;
}
// returns bit length of the integer x

function nbits(x) {
    var r = 1,
        t;
    if ((t = x >>> 16) != 0) {
        x = t;
        r += 16;
    }
    if ((t = x >> 8) != 0) {
        x = t;
        r += 8;
    }
    if ((t = x >> 4) != 0) {
        x = t;
        r += 4;
    }
    if ((t = x >> 2) != 0) {
        x = t;
        r += 2;
    }
    if ((t = x >> 1) != 0) {
        x = t;
        r += 1;
    }
    return r;
}
// (public) return the number of bits in "this"

function bnBitLength() {
    if (this.t <= 0) return 0;
    return this.DB * (this.t - 1) + nbits(this[this.t - 1] ^ (this.s & this.DM));
}
// (protected) r = this << n*DB

function bnpDLShiftTo(n, r) {
    var i;
    for (i = this.t - 1; i >= 0; --i) r[i + n] = this[i];
    for (i = n - 1; i >= 0; --i) r[i] = 0;
    r.t = this.t + n;
    r.s = this.s;
}
// (protected) r = this >> n*DB

function bnpDRShiftTo(n, r) {
    for (var i = n; i < this.t; ++i) r[i - n] = this[i];
    r.t = Math.max(this.t - n, 0);
    r.s = this.s;
}
// (protected) r = this << n

function bnpLShiftTo(n, r) {
    var bs = n % this.DB;
    var cbs = this.DB - bs;
    var bm = (1 << cbs) - 1;
    var ds = Math.floor(n / this.DB),
        c = (this.s << bs) & this.DM,
        i;
    for (i = this.t - 1; i >= 0; --i) {
        r[i + ds + 1] = (this[i] >> cbs) | c;
        c = (this[i] & bm) << bs;
    }
    for (i = ds - 1; i >= 0; --i) r[i] = 0;
    r[ds] = c;
    r.t = this.t + ds + 1;
    r.s = this.s;
    r.clamp();
}
// (protected) r = this >> n

function bnpRShiftTo(n, r) {
    r.s = this.s;
    var ds = Math.floor(n / this.DB);
    if (ds >= this.t) {
        r.t = 0;
        return;
    }
    var bs = n % this.DB;
    var cbs = this.DB - bs;
    var bm = (1 << bs) - 1;
    r[0] = this[ds] >> bs;
    for (var i = ds + 1; i < this.t; ++i) {
        r[i - ds - 1] |= (this[i] & bm) << cbs;
        r[i - ds] = this[i] >> bs;
    }
    if (bs > 0) r[this.t - ds - 1] |= (this.s & bm) << cbs;
    r.t = this.t - ds;
    r.clamp();
}
// (protected) r = this - a

function bnpSubTo(a, r) {
    var i = 0,
        c = 0,
        m = Math.min(a.t, this.t);
    while (i < m) {
        c += this[i] - a[i];
        r[i++] = c & this.DM;
        c >>= this.DB;
    }
    if (a.t < this.t) {
        c -= a.s;
        while (i < this.t) {
            c += this[i];
            r[i++] = c & this.DM;
            c >>= this.DB;
        }
        c += this.s;
    } else {
        c += this.s;
        while (i < a.t) {
            c -= a[i];
            r[i++] = c & this.DM;
            c >>= this.DB;
        }
        c -= a.s;
    }
    r.s = (c < 0) ? -1 : 0;
    if (c < -1) r[i++] = this.DV + c;
    else if (c > 0) r[i++] = c;
    r.t = i;
    r.clamp();
}
// (protected) r = this * a, r != this,a (HAC 14.12)
// "this" should be the larger one if appropriate.

function bnpMultiplyTo(a, r) {
    var x = this.abs(),
        y = a.abs();
    var i = x.t;
    r.t = i + y.t;
    while (--i >= 0) r[i] = 0;
    for (i = 0; i < y.t; ++i) r[i + x.t] = x.am(0, y[i], r, i, 0, x.t);
    r.s = 0;
    r.clamp();
    if (this.s != a.s) BigInteger.ZERO.subTo(r, r);
}
// (protected) r = this^2, r != this (HAC 14.16)

function bnpSquareTo(r) {
    var x = this.abs();
    var i = r.t = 2 * x.t;
    while (--i >= 0) r[i] = 0;
    for (i = 0; i < x.t - 1; ++i) {
        var c = x.am(i, x[i], r, 2 * i, 0, 1);
        if ((r[i + x.t] += x.am(i + 1, 2 * x[i], r, 2 * i + 1, c, x.t - i - 1)) >= x.DV) {
            r[i + x.t] -= x.DV;
            r[i + x.t + 1] = 1;
        }
    }
    if (r.t > 0) r[r.t - 1] += x.am(i, x[i], r, 2 * i, 0, 1);
    r.s = 0;
    r.clamp();
}
// (protected) divide this by m, quotient and remainder to q, r (HAC 14.20)
// r != q, this != m.  q or r may be null.

function bnpDivRemTo(m, q, r) {
    var pm = m.abs();
    if (pm.t <= 0) return;
    var pt = this.abs();
    if (pt.t < pm.t) {
        if (q != null) q.fromInt(0);
        if (r != null) this.copyTo(r);
        return;
    }
    if (r == null) r = nbi();
    var y = nbi(),
        ts = this.s,
        ms = m.s;
    var nsh = this.DB - nbits(pm[pm.t - 1]); // normalize modulus
    if (nsh > 0) {
        pm.lShiftTo(nsh, y);
        pt.lShiftTo(nsh, r);
    } else {
        pm.copyTo(y);
        pt.copyTo(r);
    }
    var ys = y.t;
    var y0 = y[ys - 1];
    if (y0 == 0) return;
    var yt = y0 * (1 << this.F1) + ((ys > 1) ? y[ys - 2] >> this.F2 : 0);
    var d1 = this.FV / yt,
        d2 = (1 << this.F1) / yt,
        e = 1 << this.F2;
    var i = r.t,
        j = i - ys,
        t = (q == null) ? nbi() : q;
    y.dlShiftTo(j, t);
    if (r.compareTo(t) >= 0) {
        r[r.t++] = 1;
        r.subTo(t, r);
    }
    BigInteger.ONE.dlShiftTo(ys, t);
    t.subTo(y, y); // "negative" y so we can replace sub with am later
    while (y.t < ys) y[y.t++] = 0;
    while (--j >= 0) {
        // Estimate quotient digit
        var qd = (r[--i] == y0) ? this.DM : Math.floor(r[i] * d1 + (r[i - 1] + e) * d2);
        if ((r[i] += y.am(0, qd, r, j, 0, ys)) < qd) { // Try it out
            y.dlShiftTo(j, t);
            r.subTo(t, r);
            while (r[i] < --qd) r.subTo(t, r);
        }
    }
    if (q != null) {
        r.drShiftTo(ys, q);
        if (ts != ms) BigInteger.ZERO.subTo(q, q);
    }
    r.t = ys;
    r.clamp();
    if (nsh > 0) r.rShiftTo(nsh, r); // Denormalize remainder
    if (ts < 0) BigInteger.ZERO.subTo(r, r);
}
// (public) this mod a

function bnMod(a) {
    var r = nbi();
    this.abs().divRemTo(a, null, r);
    if (this.s < 0 && r.compareTo(BigInteger.ZERO) > 0) a.subTo(r, r);
    return r;
}
// Modular reduction using "classic" algorithm

function Classic(m) {
    this.m = m;
}

function cConvert(x) {
    if (x.s < 0 || x.compareTo(this.m) >= 0) return x.mod(this.m);
    else return x;
}

function cRevert(x) {
    return x;
}

function cReduce(x) {
    x.divRemTo(this.m, null, x);
}

function cMulTo(x, y, r) {
    x.multiplyTo(y, r);
    this.reduce(r);
}

function cSqrTo(x, r) {
    x.squareTo(r);
    this.reduce(r);
}
Classic.prototype.convert = cConvert;
Classic.prototype.revert = cRevert;
Classic.prototype.reduce = cReduce;
Classic.prototype.mulTo = cMulTo;
Classic.prototype.sqrTo = cSqrTo;
// (protected) return "-1/this % 2^DB"; useful for Mont. reduction
// justification:
//         xy == 1 (mod m)
//         xy =  1+km
//   xy(2-xy) = (1+km)(1-km)
// x[y(2-xy)] = 1-k^2m^2
// x[y(2-xy)] == 1 (mod m^2)
// if y is 1/x mod m, then y(2-xy) is 1/x mod m^2
// should reduce x and y(2-xy) by m^2 at each step to keep size bounded.
// JS multiply "overflows" differently from C/C++, so care is needed here.
function bnpInvDigit() {
    if (this.t < 1) return 0;
    var x = this[0];
    if ((x & 1) == 0) return 0;
    var y = x & 3; // y == 1/x mod 2^2
    y = (y * (2 - (x & 15) * y)) & 15; // y == 1/x mod 2^4
    y = (y * (2 - (x & 255) * y)) & 255; // y == 1/x mod 2^8
    y = (y * (2 - (((x & 65535) * y) & 65535))) & 65535; // y == 1/x mod 2^16
    // last step - calculate inverse mod DV directly;
    // assumes 16 < DB <= 32 and assumes ability to handle 48-bit ints
    y = (y * (2 - x * y % this.DV)) % this.DV; // y == 1/x mod 2^dbits
    // we really want the negative inverse, and -DV < y < DV
    return (y > 0) ? this.DV - y : -y;
}
// Montgomery reduction

function Montgomery(m) {
    this.m = m;
    this.mp = m.invDigit();
    this.mpl = this.mp & 32767;
    this.mph = this.mp >> 15;
    this.um = (1 << (m.DB - 15)) - 1;
    this.mt2 = 2 * m.t;
}
// xR mod m

function montConvert(x) {
    var r = nbi();
    x.abs().dlShiftTo(this.m.t, r);
    r.divRemTo(this.m, null, r);
    if (x.s < 0 && r.compareTo(BigInteger.ZERO) > 0) this.m.subTo(r, r);
    return r;
}
// x/R mod m

function montRevert(x) {
    var r = nbi();
    x.copyTo(r);
    this.reduce(r);
    return r;
}
// x = x/R mod m (HAC 14.32)

function montReduce(x) {
    while (x.t <= this.mt2) // pad x so am has enough room later
        x[x.t++] = 0;
    for (var i = 0; i < this.m.t; ++i) {
        // faster way of calculating u0 = x[i]*mp mod DV
        var j = x[i] & 32767;
        var u0 = (j * this.mpl + (((j * this.mph + (x[i] >> 15) * this.mpl) & this.um) << 15)) & x.DM;
        // use am to combine the multiply-shift-add into one call
        j = i + this.m.t;
        x[j] += this.m.am(0, u0, x, i, 0, this.m.t);
        // propagate carry
        while (x[j] >= x.DV) {
            x[j] -= x.DV;
            x[++j]++;
        }
    }
    x.clamp();
    x.drShiftTo(this.m.t, x);
    if (x.compareTo(this.m) >= 0) x.subTo(this.m, x);
}
// r = "x^2/R mod m"; x != r

function montSqrTo(x, r) {
    x.squareTo(r);
    this.reduce(r);
}
// r = "xy/R mod m"; x,y != r

function montMulTo(x, y, r) {
    x.multiplyTo(y, r);
    this.reduce(r);
}
Montgomery.prototype.convert = montConvert;
Montgomery.prototype.revert = montRevert;
Montgomery.prototype.reduce = montReduce;
Montgomery.prototype.mulTo = montMulTo;
Montgomery.prototype.sqrTo = montSqrTo;
// (protected) true iff this is even
function bnpIsEven() {
    return ((this.t > 0) ? (this[0] & 1) : this.s) == 0;
}
// (protected) this^e, e < 2^32, doing sqr and mul with "r" (HAC 14.79)

function bnpExp(e, z) {
    if (e > 4294967295 || e < 1) return BigInteger.ONE;
    var r = nbi(),
        r2 = nbi(),
        g = z.convert(this),
        i = nbits(e) - 1;
    g.copyTo(r);
    while (--i >= 0) {
        z.sqrTo(r, r2);
        if ((e & (1 << i)) > 0) z.mulTo(r2, g, r);
        else {
            var t = r;
            r = r2;
            r2 = t;
        }
    }
    return z.revert(r);
}
// (public) this^e % m, 0 <= e < 2^32

function bnModPowInt(e, m) {
    var z;
    if (e < 256 || m.isEven()) z = new Classic(m);
    else z = new Montgomery(m);
    return this.exp(e, z);
}
// protected

BigInteger.prototype.copyTo = bnpCopyTo;
BigInteger.prototype.fromInt = bnpFromInt;
BigInteger.prototype.fromString = bnpFromString;
BigInteger.prototype.clamp = bnpClamp;
BigInteger.prototype.dlShiftTo = bnpDLShiftTo;
BigInteger.prototype.drShiftTo = bnpDRShiftTo;
BigInteger.prototype.lShiftTo = bnpLShiftTo;
BigInteger.prototype.rShiftTo = bnpRShiftTo;
BigInteger.prototype.subTo = bnpSubTo;
BigInteger.prototype.multiplyTo = bnpMultiplyTo;
BigInteger.prototype.squareTo = bnpSquareTo;
BigInteger.prototype.divRemTo = bnpDivRemTo;
BigInteger.prototype.invDigit = bnpInvDigit;
BigInteger.prototype.isEven = bnpIsEven;
BigInteger.prototype.exp = bnpExp;
// public
BigInteger.prototype.toString = bnToString;
BigInteger.prototype.negate = bnNegate;
BigInteger.prototype.abs = bnAbs;
BigInteger.prototype.compareTo = bnCompareTo;
BigInteger.prototype.bitLength = bnBitLength;
BigInteger.prototype.mod = bnMod;
BigInteger.prototype.modPowInt = bnModPowInt;
// "constants"
BigInteger.ZERO = nbv(0);
BigInteger.ONE = nbv(1);
// Copyright (c) 2005-2009  Tom Wu
// All Rights Reserved.
// See "LICENSE" for details.
// Extended JavaScript BN functions, required for RSA private ops.
// Version 1.1: new BigInteger("0", 10) returns "proper" zero
// Version 1.2: square() API, isProbablePrime fix
// (public)
function bnClone() {
    var r = nbi();
    this.copyTo(r);
    return r;
}
// (public) return value as integer

function bnIntValue() {
    if (this.s < 0) {
        if (this.t == 1) return this[0] - this.DV;
        else if (this.t == 0) return -1;
    } else if (this.t == 1) return this[0];
    else if (this.t == 0) return 0;
    // assumes 16 < DB < 32
    return ((this[1] & ((1 << (32 - this.DB)) - 1)) << this.DB) | this[0];
}
// (public) return value as byte

function bnByteValue() {
    return (this.t == 0) ? this.s : (this[0] << 24) >> 24;
}
// (public) return value as short (assumes DB>=16)

function bnShortValue() {
    return (this.t == 0) ? this.s : (this[0] << 16) >> 16;
}
// (protected) return x s.t. r^x < DV

function bnpChunkSize(r) {
    return Math.floor(Math.LN2 * this.DB / Math.log(r));
}
// (public) 0 if this == 0, 1 if this > 0

function bnSigNum() {
    if (this.s < 0) return -1;
    else if (this.t <= 0 || (this.t == 1 && this[0] <= 0)) return 0;
    else return 1;
}
// (protected) convert to radix string

function bnpToRadix(b) {
    if (b == null) b = 10;
    if (this.signum() == 0 || b < 2 || b > 36) return '0';
    var cs = this.chunkSize(b);
    var a = Math.pow(b, cs);
    var d = nbv(a),
        y = nbi(),
        z = nbi(),
        r = '';
    this.divRemTo(d, y, z);
    while (y.signum() > 0) {
        r = (a + z.intValue()).toString(b).substr(1) + r;
        y.divRemTo(d, y, z);
    }
    return z.intValue().toString(b) + r;
}
// (protected) convert from radix string

function bnpFromRadix(s, b) {
    this.fromInt(0);
    if (b == null) b = 10;
    var cs = this.chunkSize(b);
    var d = Math.pow(b, cs),
        mi = false,
        j = 0,
        w = 0;
    for (var i = 0; i < s.length; ++i) {
        var x = intAt(s, i);
        if (x < 0) {
            if (s.charAt(i) == '-' && this.signum() == 0) mi = true;
            continue;
        }
        w = b * w + x;
        if (++j >= cs) {
            this.dMultiply(d);
            this.dAddOffset(w, 0);
            j = 0;
            w = 0;
        }
    }
    if (j > 0) {
        this.dMultiply(Math.pow(b, j));
        this.dAddOffset(w, 0);
    }
    if (mi) BigInteger.ZERO.subTo(this, this);
}
// (protected) alternate constructor

function bnpFromNumber(a, b, c) {
    if ('number' == typeof b) {
        // new BigInteger(int,int,RNG)
        if (a < 2) this.fromInt(1);
        else {
            this.fromNumber(a, c);
            if (!this.testBit(a - 1)) // force MSB set
                this.bitwiseTo(BigInteger.ONE.shiftLeft(a - 1), op_or, this);
            if (this.isEven()) this.dAddOffset(1, 0); // force odd
            while (!this.isProbablePrime(b)) {
                this.dAddOffset(2, 0);
                if (this.bitLength() > a) this.subTo(BigInteger.ONE.shiftLeft(a - 1), this);
            }
        }
    } else {
        // new BigInteger(int,RNG)
        var x = new Array(),
            t = a & 7;
        x.length = (a >> 3) + 1;
        b.nextBytes(x);
        if (t > 0) x[0] &= ((1 << t) - 1);
        else x[0] = 0;
        this.fromString(x, 256);
    }
}
// (public) convert to bigendian byte array

function bnToByteArray() {
    var i = this.t,
        r = new Array();
    r[0] = this.s;
    var p = this.DB - (i * this.DB) % 8,
        d,
        k = 0;
    if (i-- > 0) {
        if (p < this.DB && (d = this[i] >> p) != (this.s & this.DM) >> p)
            r[k++] = d | (this.s << (this.DB - p));
        while (i >= 0) {
            if (p < 8) {
                d = (this[i] & ((1 << p) - 1)) << (8 - p);
                d |= this[--i] >> (p += this.DB - 8);
            } else {
                d = (this[i] >> (p -= 8)) & 255;
                if (p <= 0) {
                    p += this.DB;
                    --i;
                }
            }
            if ((d & 128) != 0) d |= -256;
            if (k == 0 && (this.s & 128) != (d & 128))++k;
            if (k > 0 || d != this.s) r[k++] = d;
        }
    }
    return r;
}

function bnEquals(a) {
    return (this.compareTo(a) == 0);
}

function bnMin(a) {
    return (this.compareTo(a) < 0) ? this : a;
}

function bnMax(a) {
    return (this.compareTo(a) > 0) ? this : a;
}
// (protected) r = this op a (bitwise)

function bnpBitwiseTo(a, op, r) {
    var i,
        f,
        m = Math.min(a.t, this.t);
    for (i = 0; i < m; ++i) r[i] = op(this[i], a[i]);
    if (a.t < this.t) {
        f = a.s & this.DM;
        for (i = m; i < this.t; ++i) r[i] = op(this[i], f);
        r.t = this.t;
    } else {
        f = this.s & this.DM;
        for (i = m; i < a.t; ++i) r[i] = op(f, a[i]);
        r.t = a.t;
    }
    r.s = op(this.s, a.s);
    r.clamp();
}
// (public) this & a

function op_and(x, y) {
    return x & y;
}

function bnAnd(a) {
    var r = nbi();
    this.bitwiseTo(a, op_and, r);
    return r;
}
// (public) this | a

function op_or(x, y) {
    return x | y;
}

function bnOr(a) {
    var r = nbi();
    this.bitwiseTo(a, op_or, r);
    return r;
}
// (public) this ^ a

function op_xor(x, y) {
    return x ^ y;
}

function bnXor(a) {
    var r = nbi();
    this.bitwiseTo(a, op_xor, r);
    return r;
}
// (public) this & ~a

function op_andnot(x, y) {
    return x & ~y;
}

function bnAndNot(a) {
    var r = nbi();
    this.bitwiseTo(a, op_andnot, r);
    return r;
}
// (public) ~this

function bnNot() {
    var r = nbi();
    for (var i = 0; i < this.t; ++i) r[i] = this.DM & ~this[i];
    r.t = this.t;
    r.s = ~this.s;
    return r;
}
// (public) this << n

function bnShiftLeft(n) {
    var r = nbi();
    if (n < 0) this.rShiftTo(-n, r);
    else this.lShiftTo(n, r);
    return r;
}
// (public) this >> n

function bnShiftRight(n) {
    var r = nbi();
    if (n < 0) this.lShiftTo(-n, r);
    else this.rShiftTo(n, r);
    return r;
}
// return index of lowest 1-bit in x, x < 2^31

function lbit(x) {
    if (x == 0) return -1;
    var r = 0;
    if ((x & 65535) == 0) {
        x >>= 16;
        r += 16;
    }
    if ((x & 255) == 0) {
        x >>= 8;
        r += 8;
    }
    if ((x & 15) == 0) {
        x >>= 4;
        r += 4;
    }
    if ((x & 3) == 0) {
        x >>= 2;
        r += 2;
    }
    if ((x & 1) == 0)++r;
    return r;
}
// (public) returns index of lowest 1-bit (or -1 if none)

function bnGetLowestSetBit() {
    for (var i = 0; i < this.t; ++i)
        if (this[i] != 0) return i * this.DB + lbit(this[i]);
    if (this.s < 0) return this.t * this.DB;
    return -1;
}
// return number of 1 bits in x

function cbit(x) {
    var r = 0;
    while (x != 0) {
        x &= x - 1;
        ++r;
    }
    return r;
}
// (public) return number of set bits

function bnBitCount() {
    var r = 0,
        x = this.s & this.DM;
    for (var i = 0; i < this.t; ++i) r += cbit(this[i] ^ x);
    return r;
}
// (public) true iff nth bit is set

function bnTestBit(n) {
    var j = Math.floor(n / this.DB);
    if (j >= this.t) return (this.s != 0);
    return ((this[j] & (1 << (n % this.DB))) != 0);
}
// (protected) this op (1<<n)

function bnpChangeBit(n, op) {
    var r = BigInteger.ONE.shiftLeft(n);
    this.bitwiseTo(r, op, r);
    return r;
}
// (public) this | (1<<n)

function bnSetBit(n) {
    return this.changeBit(n, op_or);
}
// (public) this & ~(1<<n)

function bnClearBit(n) {
    return this.changeBit(n, op_andnot);
}
// (public) this ^ (1<<n)

function bnFlipBit(n) {
    return this.changeBit(n, op_xor);
}
// (protected) r = this + a

function bnpAddTo(a, r) {
    var i = 0,
        c = 0,
        m = Math.min(a.t, this.t);
    while (i < m) {
        c += this[i] + a[i];
        r[i++] = c & this.DM;
        c >>= this.DB;
    }
    if (a.t < this.t) {
        c += a.s;
        while (i < this.t) {
            c += this[i];
            r[i++] = c & this.DM;
            c >>= this.DB;
        }
        c += this.s;
    } else {
        c += this.s;
        while (i < a.t) {
            c += a[i];
            r[i++] = c & this.DM;
            c >>= this.DB;
        }
        c += a.s;
    }
    r.s = (c < 0) ? -1 : 0;
    if (c > 0) r[i++] = c;
    else if (c < -1) r[i++] = this.DV + c;
    r.t = i;
    r.clamp();
}
// (public) this + a

function bnAdd(a) {
    var r = nbi();
    this.addTo(a, r);
    return r;
}
// (public) this - a

function bnSubtract(a) {
    var r = nbi();
    this.subTo(a, r);
    return r;
}
// (public) this * a

function bnMultiply(a) {
    var r = nbi();
    this.multiplyTo(a, r);
    return r;
}
// (public) this^2

function bnSquare() {
    var r = nbi();
    this.squareTo(r);
    return r;
}
// (public) this / a

function bnDivide(a) {
    var r = nbi();
    this.divRemTo(a, r, null);
    return r;
}
// (public) this % a

function bnRemainder(a) {
    var r = nbi();
    this.divRemTo(a, null, r);
    return r;
}
// (public) [this/a,this%a]

function bnDivideAndRemainder(a) {
    var q = nbi(),
        r = nbi();
    this.divRemTo(a, q, r);
    return new Array(q, r);
}
// (protected) this *= n, this >= 0, 1 < n < DV

function bnpDMultiply(n) {
    this[this.t] = this.am(0, n - 1, this, 0, 0, this.t);
    ++this.t;
    this.clamp();
}
// (protected) this += n << w words, this >= 0

function bnpDAddOffset(n, w) {
    if (n == 0) return;
    while (this.t <= w) this[this.t++] = 0;
    this[w] += n;
    while (this[w] >= this.DV) {
        this[w] -= this.DV;
        if (++w >= this.t) this[this.t++] = 0;
        ++this[w];
    }
}
// A "null" reducer

function NullExp() {}

function nNop(x) {
    return x;
}

function nMulTo(x, y, r) {
    x.multiplyTo(y, r);
}

function nSqrTo(x, r) {
    x.squareTo(r);
}
NullExp.prototype.convert = nNop;
NullExp.prototype.revert = nNop;
NullExp.prototype.mulTo = nMulTo;
NullExp.prototype.sqrTo = nSqrTo;
// (public) this^e
function bnPow(e) {
    return this.exp(e, new NullExp());
}
// (protected) r = lower n words of "this * a", a.t <= n
// "this" should be the larger one if appropriate.

function bnpMultiplyLowerTo(a, n, r) {
    var i = Math.min(this.t + a.t, n);
    r.s = 0; // assumes a,this >= 0
    r.t = i;
    while (i > 0) r[--i] = 0;
    var j;
    for (j = r.t - this.t; i < j; ++i) r[i + this.t] = this.am(0, a[i], r, i, 0, this.t);
    for (j = Math.min(a.t, n); i < j; ++i) this.am(0, a[i], r, i, 0, n - i);
    r.clamp();
}
// (protected) r = "this * a" without lower n words, n > 0
// "this" should be the larger one if appropriate.

function bnpMultiplyUpperTo(a, n, r) {
    --n;
    var i = r.t = this.t + a.t - n;
    r.s = 0; // assumes a,this >= 0
    while (--i >= 0) r[i] = 0;
    for (i = Math.max(n - this.t, 0); i < a.t; ++i)
        r[this.t + i - n] = this.am(n - i, a[i], r, 0, 0, this.t + i - n);
    r.clamp();
    r.drShiftTo(1, r);
}
// Barrett modular reduction

function Barrett(m) {
    // setup Barrett
    this.r2 = nbi();
    this.q3 = nbi();
    BigInteger.ONE.dlShiftTo(2 * m.t, this.r2);
    this.mu = this.r2.divide(m);
    this.m = m;
}

function barrettConvert(x) {
    if (x.s < 0 || x.t > 2 * this.m.t) return x.mod(this.m);
    else if (x.compareTo(this.m) < 0) return x;
    else {
        var r = nbi();
        x.copyTo(r);
        this.reduce(r);
        return r;
    }
}

function barrettRevert(x) {
    return x;
}
// x = x mod m (HAC 14.42)

function barrettReduce(x) {
    x.drShiftTo(this.m.t - 1, this.r2);
    if (x.t > this.m.t + 1) {
        x.t = this.m.t + 1;
        x.clamp();
    }
    this.mu.multiplyUpperTo(this.r2, this.m.t + 1, this.q3);
    this.m.multiplyLowerTo(this.q3, this.m.t + 1, this.r2);
    while (x.compareTo(this.r2) < 0) x.dAddOffset(1, this.m.t + 1);
    x.subTo(this.r2, x);
    while (x.compareTo(this.m) >= 0) x.subTo(this.m, x);
}
// r = x^2 mod m; x != r

function barrettSqrTo(x, r) {
    x.squareTo(r);
    this.reduce(r);
}
// r = x*y mod m; x,y != r

function barrettMulTo(x, y, r) {
    x.multiplyTo(y, r);
    this.reduce(r);
}
Barrett.prototype.convert = barrettConvert;
Barrett.prototype.revert = barrettRevert;
Barrett.prototype.reduce = barrettReduce;
Barrett.prototype.mulTo = barrettMulTo;
Barrett.prototype.sqrTo = barrettSqrTo;
// (public) this^e % m (HAC 14.85)
function bnModPow(e, m) {
    var i = e.bitLength(),
        k,
        r = nbv(1),
        z;
    if (i <= 0) return r;
    else if (i < 18) k = 1;
    else if (i < 48) k = 3;
    else if (i < 144) k = 4;
    else if (i < 768) k = 5;
    else k = 6;
    if (i < 8)
        z = new Classic(m);
    else if (m.isEven())
        z = new Barrett(m);
    else
        z = new Montgomery(m);
    // precomputation
    var g = new Array(),
        n = 3,
        k1 = k - 1,
        km = (1 << k) - 1;
    g[1] = z.convert(this);
    if (k > 1) {
        var g2 = nbi();
        z.sqrTo(g[1], g2);
        while (n <= km) {
            g[n] = nbi();
            z.mulTo(g2, g[n - 2], g[n]);
            n += 2;
        }
    }
    var j = e.t - 1,
        w,
        is1 = true,
        r2 = nbi(),
        t;
    i = nbits(e[j]) - 1;
    while (j >= 0) {
        if (i >= k1) w = (e[j] >> (i - k1)) & km;
        else {
            w = (e[j] & ((1 << (i + 1)) - 1)) << (k1 - i);
            if (j > 0) w |= e[j - 1] >> (this.DB + i - k1);
        }
        n = k;
        while ((w & 1) == 0) {
            w >>= 1;
            --n;
        }
        if ((i -= n) < 0) {
            i += this.DB;
            --j;
        }
        if (is1) { // ret == 1, don't bother squaring or multiplying it
            g[w].copyTo(r);
            is1 = false;
        } else {
            while (n > 1) {
                z.sqrTo(r, r2);
                z.sqrTo(r2, r);
                n -= 2;
            }
            if (n > 0) z.sqrTo(r, r2);
            else {
                t = r;
                r = r2;
                r2 = t;
            }
            z.mulTo(r2, g[w], r);
        }
        while (j >= 0 && (e[j] & (1 << i)) == 0) {
            z.sqrTo(r, r2);
            t = r;
            r = r2;
            r2 = t;
            if (--i < 0) {
                i = this.DB - 1;
                --j;
            }
        }
    }
    return z.revert(r);
}
// (public) gcd(this,a) (HAC 14.54)

function bnGCD(a) {
    var x = (this.s < 0) ? this.negate() : this.clone();
    var y = (a.s < 0) ? a.negate() : a.clone();
    if (x.compareTo(y) < 0) {
        var t = x;
        x = y;
        y = t;
    }
    var i = x.getLowestSetBit(),
        g = y.getLowestSetBit();
    if (g < 0) return x;
    if (i < g) g = i;
    if (g > 0) {
        x.rShiftTo(g, x);
        y.rShiftTo(g, y);
    }
    while (x.signum() > 0) {
        if ((i = x.getLowestSetBit()) > 0) x.rShiftTo(i, x);
        if ((i = y.getLowestSetBit()) > 0) y.rShiftTo(i, y);
        if (x.compareTo(y) >= 0) {
            x.subTo(y, x);
            x.rShiftTo(1, x);
        } else {
            y.subTo(x, y);
            y.rShiftTo(1, y);
        }
    }
    if (g > 0) y.lShiftTo(g, y);
    return y;
}
// (protected) this % n, n < 2^26

function bnpModInt(n) {
    if (n <= 0) return 0;
    var d = this.DV % n,
        r = (this.s < 0) ? n - 1 : 0;
    if (this.t > 0)
        if (d == 0) r = this[0] % n;
        else
            for (var i = this.t - 1; i >= 0; --i) r = (d * r + this[i]) % n;
    return r;
}
// (public) 1/this % m (HAC 14.61)

function bnModInverse(m) {
    var ac = m.isEven();
    if ((this.isEven() && ac) || m.signum() == 0) return BigInteger.ZERO;
    var u = m.clone(),
        v = this.clone();
    var a = nbv(1),
        b = nbv(0),
        c = nbv(0),
        d = nbv(1);
    while (u.signum() != 0) {
        while (u.isEven()) {
            u.rShiftTo(1, u);
            if (ac) {
                if (!a.isEven() || !b.isEven()) {
                    a.addTo(this, a);
                    b.subTo(m, b);
                }
                a.rShiftTo(1, a);
            } else if (!b.isEven()) b.subTo(m, b);
            b.rShiftTo(1, b);
        }
        while (v.isEven()) {
            v.rShiftTo(1, v);
            if (ac) {
                if (!c.isEven() || !d.isEven()) {
                    c.addTo(this, c);
                    d.subTo(m, d);
                }
                c.rShiftTo(1, c);
            } else if (!d.isEven()) d.subTo(m, d);
            d.rShiftTo(1, d);
        }
        if (u.compareTo(v) >= 0) {
            u.subTo(v, u);
            if (ac) a.subTo(c, a);
            b.subTo(d, b);
        } else {
            v.subTo(u, v);
            if (ac) c.subTo(a, c);
            d.subTo(b, d);
        }
    }
    if (v.compareTo(BigInteger.ONE) != 0) return BigInteger.ZERO;
    if (d.compareTo(m) >= 0) return d.subtract(m);
    if (d.signum() < 0) d.addTo(m, d);
    else return d;
    if (d.signum() < 0) return d.add(m);
    else return d;
}
var lowprimes = [
    2,
    3,
    5,
    7,
    11,
    13,
    17,
    19,
    23,
    29,
    31,
    37,
    41,
    43,
    47,
    53,
    59,
    61,
    67,
    71,
    73,
    79,
    83,
    89,
    97,
    101,
    103,
    107,
    109,
    113,
    127,
    131,
    137,
    139,
    149,
    151,
    157,
    163,
    167,
    173,
    179,
    181,
    191,
    193,
    197,
    199,
    211,
    223,
    227,
    229,
    233,
    239,
    241,
    251,
    257,
    263,
    269,
    271,
    277,
    281,
    283,
    293,
    307,
    311,
    313,
    317,
    331,
    337,
    347,
    349,
    353,
    359,
    367,
    373,
    379,
    383,
    389,
    397,
    401,
    409,
    419,
    421,
    431,
    433,
    439,
    443,
    449,
    457,
    461,
    463,
    467,
    479,
    487,
    491,
    499,
    503,
    509,
    521,
    523,
    541,
    547,
    557,
    563,
    569,
    571,
    577,
    587,
    593,
    599,
    601,
    607,
    613,
    617,
    619,
    631,
    641,
    643,
    647,
    653,
    659,
    661,
    673,
    677,
    683,
    691,
    701,
    709,
    719,
    727,
    733,
    739,
    743,
    751,
    757,
    761,
    769,
    773,
    787,
    797,
    809,
    811,
    821,
    823,
    827,
    829,
    839,
    853,
    857,
    859,
    863,
    877,
    881,
    883,
    887,
    907,
    911,
    919,
    929,
    937,
    941,
    947,
    953,
    967,
    971,
    977,
    983,
    991,
    997
];
var lplim = (1 << 26) / lowprimes[lowprimes.length - 1];
// (public) test primality with certainty >= 1-.5^t
function bnIsProbablePrime(t) {
    var i,
        x = this.abs();
    if (x.t == 1 && x[0] <= lowprimes[lowprimes.length - 1]) {
        for (i = 0; i < lowprimes.length; ++i)
            if (x[0] == lowprimes[i]) return true;
        return false;
    }
    if (x.isEven()) return false;
    i = 1;
    while (i < lowprimes.length) {
        var m = lowprimes[i],
            j = i + 1;
        while (j < lowprimes.length && m < lplim) m *= lowprimes[j++];
        m = x.modInt(m);
        while (i < j)
            if (m % lowprimes[i++] == 0) return false;
    }
    return x.millerRabin(t);
}
// (protected) true if probably prime (HAC 4.24, Miller-Rabin)

function bnpMillerRabin(t) {
    var n1 = this.subtract(BigInteger.ONE);
    var k = n1.getLowestSetBit();
    if (k <= 0) return false;
    var r = n1.shiftRight(k);
    t = (t + 1) >> 1;
    if (t > lowprimes.length) t = lowprimes.length;
    var a = nbi();
    for (var i = 0; i < t; ++i) {
        //Pick bases at random, instead of starting at 2
        a.fromInt(lowprimes[Math.floor(Math.random() * lowprimes.length)]);
        var y = a.modPow(r, this);
        if (y.compareTo(BigInteger.ONE) != 0 && y.compareTo(n1) != 0) {
            var j = 1;
            while (j++ < k && y.compareTo(n1) != 0) {
                y = y.modPowInt(2, this);
                if (y.compareTo(BigInteger.ONE) == 0) return false;
            }
            if (y.compareTo(n1) != 0) return false;
        }
    }
    return true;
}
// protected

BigInteger.prototype.chunkSize = bnpChunkSize;
BigInteger.prototype.toRadix = bnpToRadix;
BigInteger.prototype.fromRadix = bnpFromRadix;
BigInteger.prototype.fromNumber = bnpFromNumber;
BigInteger.prototype.bitwiseTo = bnpBitwiseTo;
BigInteger.prototype.changeBit = bnpChangeBit;
BigInteger.prototype.addTo = bnpAddTo;
BigInteger.prototype.dMultiply = bnpDMultiply;
BigInteger.prototype.dAddOffset = bnpDAddOffset;
BigInteger.prototype.multiplyLowerTo = bnpMultiplyLowerTo;
BigInteger.prototype.multiplyUpperTo = bnpMultiplyUpperTo;
BigInteger.prototype.modInt = bnpModInt;
BigInteger.prototype.millerRabin = bnpMillerRabin;
// public
BigInteger.prototype.clone = bnClone;
BigInteger.prototype.intValue = bnIntValue;
BigInteger.prototype.byteValue = bnByteValue;
BigInteger.prototype.shortValue = bnShortValue;
BigInteger.prototype.signum = bnSigNum;
BigInteger.prototype.toByteArray = bnToByteArray;
BigInteger.prototype.equals = bnEquals;
BigInteger.prototype.min = bnMin;
BigInteger.prototype.max = bnMax;
BigInteger.prototype.and = bnAnd;
BigInteger.prototype.or = bnOr;
BigInteger.prototype.xor = bnXor;
BigInteger.prototype.andNot = bnAndNot;
BigInteger.prototype.not = bnNot;
BigInteger.prototype.shiftLeft = bnShiftLeft;
BigInteger.prototype.shiftRight = bnShiftRight;
BigInteger.prototype.getLowestSetBit = bnGetLowestSetBit;
BigInteger.prototype.bitCount = bnBitCount;
BigInteger.prototype.testBit = bnTestBit;
BigInteger.prototype.setBit = bnSetBit;
BigInteger.prototype.clearBit = bnClearBit;
BigInteger.prototype.flipBit = bnFlipBit;
BigInteger.prototype.add = bnAdd;
BigInteger.prototype.subtract = bnSubtract;
BigInteger.prototype.multiply = bnMultiply;
BigInteger.prototype.divide = bnDivide;
BigInteger.prototype.remainder = bnRemainder;
BigInteger.prototype.divideAndRemainder = bnDivideAndRemainder;
BigInteger.prototype.modPow = bnModPow;
BigInteger.prototype.modInverse = bnModInverse;
BigInteger.prototype.pow = bnPow;
BigInteger.prototype.gcd = bnGCD;
BigInteger.prototype.isProbablePrime = bnIsProbablePrime;
// JSBN-specific extension
BigInteger.prototype.square = bnSquare;
// BigInteger interfaces not implemented in jsbn:
// BigInteger(int signum, byte[] magnitude)
// double doubleValue()
// float floatValue()
// int hashCode()
// long longValue()
// static BigInteger valueOf(long val)
/*
 * Curve 25519-based cryptography collection.
 *
 * EC Diffie-Hellman (ECDH) based on Curve25519 and digital signatures (EdDSA)
 * based on Ed25519.
 *
 * Copyright (c) 2012 Ron Garret
 * Copyright (c) 2007, 2013, 2014 Michele Bini
 * Copyright (c) 2014 Mega Limited
 * under the MIT License.
 *
 * You should have received a copy of the license along with this program.
 */
// See https://github.com/jrburke/almond#exporting-a-public-api
(function(root, factory) {
    if (typeof define === 'function' && define.amd) {
        // Allow using this built library as an AMD module
        // in another project. That other project will only
        // see this AMD call, not the internal modules in
        // the closure below.
        define([], factory);
    } else if (typeof module === 'object' && module.exports) {
        // Allow using this built library as a CommonJS module
        module.exports = factory();
    } else {
        // Browser globals case. Just assign the
        // result to a property on the global.
        root.jodid25519 = factory();
    }
}(this, function() {
    /**
     * @license almond 0.2.9 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
     * Available via the MIT or new BSD license.
     * see: http://github.com/jrburke/almond for details
     */
    //Going sloppy to avoid 'use strict' string cost, but strict practices should
    //be followed.
    /*jslint sloppy: true */
    /*global setTimeout: false */
    var requirejs,
        require,
        define;
    (function(undef) {
        var main,
            req,
            makeMap,
            handlers,
            defined = {},
            waiting = {},
            config = {},
            defining = {},
            hasOwn = Object.prototype.hasOwnProperty,
            aps = [].slice,
            jsSuffixRegExp = /\.js$/;

        function hasProp(obj, prop) {
            return hasOwn.call(obj, prop);
        }
        /**
         * Given a relative module name, like ./something, normalize it to
         * a real name that can be mapped to a path.
         * @param {String} name the relative name
         * @param {String} baseName a real name that the name arg is relative
         * to.
         * @returns {String} normalized name
         */

        function normalize(name, baseName) {
            var nameParts,
                nameSegment,
                mapValue,
                foundMap,
                lastIndex,
                foundI,
                foundStarMap,
                starI,
                i,
                j,
                part,
                baseParts = baseName && baseName.split('/'),
                map = config.map,
                starMap = (map && map['*']) || {};
            //Adjust any relative paths.
            if (name && name.charAt(0) === '.') {
                //If have a base name, try to normalize against it,
                //otherwise, assume it is a top-level require that will
                //be relative to baseUrl in the end.
                if (baseName) {
                    //Convert baseName to array, and lop off the last part,
                    //so that . matches that "directory" and not name of the baseName's
                    //module. For instance, baseName of "one/two/three", maps to
                    //"one/two/three.js", but we want the directory, "one/two" for
                    //this normalization.
                    baseParts = baseParts.slice(0, baseParts.length - 1);
                    name = name.split('/');
                    lastIndex = name.length - 1;
                    // Node .js allowance:
                    if (config.nodeIdCompat && jsSuffixRegExp.test(name[lastIndex])) {
                        name[lastIndex] = name[lastIndex].replace(jsSuffixRegExp, '');
                    }
                    name = baseParts.concat(name);
                    //start trimDots
                    for (i = 0; i < name.length; i += 1) {
                        part = name[i];
                        if (part === '.') {
                            name.splice(i, 1);
                            i -= 1;
                        } else if (part === '..') {
                            if (i === 1 && (name[2] === '..' || name[0] === '..')) {
                                //End of the line. Keep at least one non-dot
                                //path segment at the front so it can be mapped
                                //correctly to disk. Otherwise, there is likely
                                //no path mapping for a path starting with '..'.
                                //This can still fail, but catches the most reasonable
                                //uses of ..
                                break;
                            } else if (i > 0) {
                                name.splice(i - 1, 2);
                                i -= 2;
                            }
                        }
                    }
                    //end trimDots

                    name = name.join('/');
                } else if (name.indexOf('./') === 0) {
                    // No baseName, so this is ID is resolved relative
                    // to baseUrl, pull off the leading dot.
                    name = name.substring(2);
                }
            }
            //Apply map config if available.

            if ((baseParts || starMap) && map) {
                nameParts = name.split('/');
                for (i = nameParts.length; i > 0; i -= 1) {
                    nameSegment = nameParts.slice(0, i).join('/');
                    if (baseParts) {
                        //Find the longest baseName segment match in the config.
                        //So, do joins on the biggest to smallest lengths of baseParts.
                        for (j = baseParts.length; j > 0; j -= 1) {
                            mapValue = map[baseParts.slice(0, j).join('/')];
                            //baseName segment has  config, find if it has one for
                            //this name.
                            if (mapValue) {
                                mapValue = mapValue[nameSegment];
                                if (mapValue) {
                                    //Match, update name to the new value.
                                    foundMap = mapValue;
                                    foundI = i;
                                    break;
                                }
                            }
                        }
                    }
                    if (foundMap) {
                        break;
                    }
                    //Check for a star map match, but just hold on to it,
                    //if there is a shorter segment match later in a matching
                    //config, then favor over this star map.

                    if (!foundStarMap && starMap && starMap[nameSegment]) {
                        foundStarMap = starMap[nameSegment];
                        starI = i;
                    }
                }
                if (!foundMap && foundStarMap) {
                    foundMap = foundStarMap;
                    foundI = starI;
                }
                if (foundMap) {
                    nameParts.splice(0, foundI, foundMap);
                    name = nameParts.join('/');
                }
            }
            return name;
        }

        function makeRequire(relName, forceSync) {
            return function() {
                //A version of a require function that passes a moduleName
                //value for items that may need to
                //look up paths relative to the moduleName
                return req.apply(undef, aps.call(arguments, 0).concat([relName,
                    forceSync
                ]));
            };
        }

        function makeNormalize(relName) {
            return function(name) {
                return normalize(name, relName);
            };
        }

        function makeLoad(depName) {
            return function(value) {
                defined[depName] = value;
            };
        }

        function callDep(name) {
            if (hasProp(waiting, name)) {
                var args = waiting[name];
                delete waiting[name];
                defining[name] = true;
                main.apply(undef, args);
            }
            if (!hasProp(defined, name) && !hasProp(defining, name)) {
                throw new Error('No ' + name);
            }
            return defined[name];
        }
        //Turns a plugin!resource to [plugin, resource]
        //with the plugin being undefined if the name
        //did not have a plugin prefix.

        function splitPrefix(name) {
            var prefix,
                index = name ? name.indexOf('!') : -1;
            if (index > -1) {
                prefix = name.substring(0, index);
                name = name.substring(index + 1, name.length);
            }
            return [prefix,
                name
            ];
        }
        /**
         * Makes a name map, normalizing the name, and using a plugin
         * for normalization if necessary. Grabs a ref to plugin
         * too, as an optimization.
         */

        makeMap = function(name, relName) {
            var plugin,
                parts = splitPrefix(name),
                prefix = parts[0];
            name = parts[1];
            if (prefix) {
                prefix = normalize(prefix, relName);
                plugin = callDep(prefix);
            }
            //Normalize according

            if (prefix) {
                if (plugin && plugin.normalize) {
                    name = plugin.normalize(name, makeNormalize(relName));
                } else {
                    name = normalize(name, relName);
                }
            } else {
                name = normalize(name, relName);
                parts = splitPrefix(name);
                prefix = parts[0];
                name = parts[1];
                if (prefix) {
                    plugin = callDep(prefix);
                }
            }
            //Using ridiculous property names for space reasons

            return {
                f: prefix ? prefix + '!' + name : name, //fullName
                n: name,
                pr: prefix,
                p: plugin
            };
        };

        function makeConfig(name) {
            return function() {
                return (config && config.config && config.config[name]) || {};
            };
        }
        handlers = {
            require: function(name) {
                return makeRequire(name);
            },
            exports: function(name) {
                var e = defined[name];
                if (typeof e !== 'undefined') {
                    return e;
                } else {
                    return (defined[name] = {});
                }
            },
            module: function(name) {
                return {
                    id: name,
                    uri: '',
                    exports: defined[name],
                    config: makeConfig(name)
                };
            }
        };
        main = function(name, deps, callback, relName) {
            var cjsModule,
                depName,
                ret,
                map,
                i,
                args = [],
                callbackType = typeof callback,
                usingExports;
            //Use name if no relName
            relName = relName || name;
            //Call the callback to define the module, if necessary.
            if (callbackType === 'undefined' || callbackType === 'function') {
                //Pull out the defined dependencies and pass the ordered
                //values to the callback.
                //Default to [require, exports, module] if no deps
                deps = !deps.length && callback.length ? [
                    'require',
                    'exports',
                    'module'
                ] : deps;
                for (i = 0; i < deps.length; i += 1) {
                    map = makeMap(deps[i], relName);
                    depName = map.f;
                    //Fast path CommonJS standard dependencies.
                    if (depName === 'require') {
                        args[i] = handlers.require(name);
                    } else if (depName === 'exports') {
                        //CommonJS module spec 1.1
                        args[i] = handlers.exports(name);
                        usingExports = true;
                    } else if (depName === 'module') {
                        //CommonJS module spec 1.1
                        cjsModule = args[i] = handlers.module(name);
                    } else if (hasProp(defined, depName) ||
                        hasProp(waiting, depName) ||
                        hasProp(defining, depName)) {
                        args[i] = callDep(depName);
                    } else if (map.p) {
                        map.p.load(map.n, makeRequire(relName, true), makeLoad(depName), {});
                        args[i] = defined[depName];
                    } else {
                        throw new Error(name + ' missing ' + depName);
                    }
                }
                ret = callback ? callback.apply(defined[name], args) : undefined;
                if (name) {
                    //If setting exports via "module" is in play,
                    //favor that over return value and exports. After that,
                    //favor a non-undefined return value over exports use.
                    if (cjsModule && cjsModule.exports !== undef &&
                        cjsModule.exports !== defined[name]) {
                        defined[name] = cjsModule.exports;
                    } else if (ret !== undef || !usingExports) {
                        //Use the return value from the function.
                        defined[name] = ret;
                    }
                }
            } else if (name) {
                //May just be an object definition for the module. Only
                //worry about defining if have a module name.
                defined[name] = callback;
            }
        };
        requirejs = require = req = function(deps, callback, relName, forceSync, alt) {
            if (typeof deps === 'string') {
                if (handlers[deps]) {
                    //callback in this case is really relName
                    return handlers[deps](callback);
                }
                //Just return the module wanted. In this scenario, the
                //deps arg is the module name, and second arg (if passed)
                //is just the relName.
                //Normalize module name, if it contains . or ..

                return callDep(makeMap(deps, callback).f);
            } else if (!deps.splice) {
                //deps is a config object, not an array.
                config = deps;
                if (config.deps) {
                    req(config.deps, config.callback);
                }
                if (!callback) {
                    return;
                }
                if (callback.splice) {
                    //callback is an array, which means it is a dependency list.
                    //Adjust args if there are dependencies
                    deps = callback;
                    callback = relName;
                    relName = null;
                } else {
                    deps = undef;
                }
            }
            //Support require(['a'])

            callback = callback || function() {};
            //If relName is a function, it is an errback handler,
            //so remove it.
            if (typeof relName === 'function') {
                relName = forceSync;
                forceSync = alt;
            }
            //Simulate async callback;

            if (forceSync) {
                main(undef, deps, callback, relName);
            } else {
                //Using a non-zero value because of concern for what old browsers
                //do, and latest browsers "upgrade" to 4 if lower value is used:
                //http://www.whatwg.org/specs/web-apps/current-work/multipage/timers.html#dom-windowtimers-settimeout:
                //If want a value immediately, use require('id') instead -- something
                //that works in almond on the global level, but not guaranteed and
                //unlikely to work in other AMD implementations.
                setTimeout(function() {
                    main(undef, deps, callback, relName);
                }, 4);
            }
            return req;
        };
        /**
         * Just drops the config on the floor, but returns req in case
         * the config return value is used.
         */
        req.config = function(cfg) {
            return req(cfg);
        };
        /**
         * Expose module registry for debugging and tooling
         */
        requirejs._defined = defined;
        define = function(name, deps, callback) {
            //This module may not have dependencies
            if (!deps.splice) {
                //deps is not an array, so probably means
                //an object literal or factory function for
                //the value. Adjust args.
                callback = deps;
                deps = [];
            }
            if (!hasProp(defined, name) && !hasProp(waiting, name)) {
                waiting[name] = [
                    name,
                    deps,
                    callback
                ];
            }
        };
        define.amd = {
            jQuery: true
        };
    }());
    define('../node_modules/almond/almond', function() {});;
    define('asmcrypto', (function(global) {
        return function() {
            var ret,
                fn;
            fn = function() {
                return asmCrypto;
            };
            ret = fn.apply(global, arguments);
            return ret || global.asmcrypto;
        };
    }(this)));
    /**
     * @fileOverview
     * Core operations on curve 25519 required for the higher level modules.
     */
    /*
     * Copyright (c) 2007, 2013, 2014 Michele Bini
     * Copyright (c) 2014 Mega Limited
     * under the MIT License.
     *
     * Authors: Guy K. Kloss, Michele Bini
     *
     * You should have received a copy of the license along with this program.
     */
    define('jodid25519/core', [
        'asmcrypto',
    ], function(asmCrypto) {
        /**
         * @exports jodid25519/core
         * Core operations on curve 25519 required for the higher level modules.
         *
         * @description
         * Core operations on curve 25519 required for the higher level modules.
         *
         * <p>
         * This core code is extracted from Michele Bini's curve255.js implementation,
         * which is used as a base for Curve25519 ECDH and Ed25519 EdDSA operations.
         * </p>
         */
        var ns = {};

        function _setbit(n, c, v) {
            var i = c >> 4;
            var a = n[i];
            a = a + (1 << (c & 15)) * v;
            n[i] = a;
        }

        function _getbit(n, c) {
            return (n[c >> 4] >> (c & 15)) & 1;
        }

        function _ZERO() {
            return [0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0
            ];
        }

        function _ONE() {
            return [1,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0
            ];
        }
        // Basepoint.

        function _BASE() {
            return [9,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0
            ];
        }
        // return -1, 0, +1 when a is less than, equal, or greater than b

        function _bigintcmp(a, b) {
            // The following code is a bit tricky to avoid code branching
            var c,
                abs_r,
                mask;
            var r = 0;
            for (c = 15; c >= 0; c--) {
                var x = a[c];
                var y = b[c];
                r = r + (x - y) * (1 - r * r);
                // http://graphics.stanford.edu/~seander/bithacks.html#IntegerAbs
                // correct for [-294967295, 294967295]
                mask = r >> 31;
                abs_r = (r + mask) ^ mask;
                // http://stackoverflow.com/questions/596467/how-do-i-convert-a-number-to-an-integer-in-javascript
                // this rounds towards zero
                r = ~~ ((r << 1) / (abs_r + 1));
            }
            return r;
        }

        function _bigintadd(a, b) {
            var r = [];
            var v;
            r[0] = (v = a[0] + b[0]) & 65535;
            r[1] = (v = (v >>> 16) + a[1] + b[1]) & 65535;
            r[2] = (v = (v >>> 16) + a[2] + b[2]) & 65535;
            r[3] = (v = (v >>> 16) + a[3] + b[3]) & 65535;
            r[4] = (v = (v >>> 16) + a[4] + b[4]) & 65535;
            r[5] = (v = (v >>> 16) + a[5] + b[5]) & 65535;
            r[6] = (v = (v >>> 16) + a[6] + b[6]) & 65535;
            r[7] = (v = (v >>> 16) + a[7] + b[7]) & 65535;
            r[8] = (v = (v >>> 16) + a[8] + b[8]) & 65535;
            r[9] = (v = (v >>> 16) + a[9] + b[9]) & 65535;
            r[10] = (v = (v >>> 16) + a[10] + b[10]) & 65535;
            r[11] = (v = (v >>> 16) + a[11] + b[11]) & 65535;
            r[12] = (v = (v >>> 16) + a[12] + b[12]) & 65535;
            r[13] = (v = (v >>> 16) + a[13] + b[13]) & 65535;
            r[14] = (v = (v >>> 16) + a[14] + b[14]) & 65535;
            r[15] = (v >>> 16) + a[15] + b[15];
            return r;
        }

        function _bigintsub(a, b) {
            var r = [];
            var v;
            r[0] = (v = 524288 + a[0] - b[0]) & 65535;
            r[1] = (v = (v >>> 16) + 524280 + a[1] - b[1]) & 65535;
            r[2] = (v = (v >>> 16) + 524280 + a[2] - b[2]) & 65535;
            r[3] = (v = (v >>> 16) + 524280 + a[3] - b[3]) & 65535;
            r[4] = (v = (v >>> 16) + 524280 + a[4] - b[4]) & 65535;
            r[5] = (v = (v >>> 16) + 524280 + a[5] - b[5]) & 65535;
            r[6] = (v = (v >>> 16) + 524280 + a[6] - b[6]) & 65535;
            r[7] = (v = (v >>> 16) + 524280 + a[7] - b[7]) & 65535;
            r[8] = (v = (v >>> 16) + 524280 + a[8] - b[8]) & 65535;
            r[9] = (v = (v >>> 16) + 524280 + a[9] - b[9]) & 65535;
            r[10] = (v = (v >>> 16) + 524280 + a[10] - b[10]) & 65535;
            r[11] = (v = (v >>> 16) + 524280 + a[11] - b[11]) & 65535;
            r[12] = (v = (v >>> 16) + 524280 + a[12] - b[12]) & 65535;
            r[13] = (v = (v >>> 16) + 524280 + a[13] - b[13]) & 65535;
            r[14] = (v = (v >>> 16) + 524280 + a[14] - b[14]) & 65535;
            r[15] = (v >>> 16) - 8 + a[15] - b[15];
            return r;
        }

        function _sqr8h(a7, a6, a5, a4, a3, a2, a1, a0) {
            // 'division by 0x10000' can not be replaced by '>> 16' because
            // more than 32 bits of precision are needed similarly
            // 'multiplication by 2' cannot be replaced by '<< 1'
            var r = [];
            var v;
            r[0] = (v = a0 * a0) & 65535;
            r[1] = (v = (0 | (v / 65536)) + 2 * a0 * a1) & 65535;
            r[2] = (v = (0 | (v / 65536)) + 2 * a0 * a2 + a1 * a1) & 65535;
            r[3] = (v = (0 | (v / 65536)) + 2 * a0 * a3 + 2 * a1 * a2) & 65535;
            r[4] = (v = (0 | (v / 65536)) + 2 * a0 * a4 + 2 * a1 * a3 + a2 * a2) & 65535;
            r[5] = (v = (0 | (v / 65536)) + 2 * a0 * a5 + 2 * a1 * a4 + 2 * a2 * a3) & 65535;
            r[6] = (v = (0 | (v / 65536)) + 2 * a0 * a6 + 2 * a1 * a5 + 2 * a2 * a4 + a3 * a3) & 65535;
            r[7] = (v = (0 | (v / 65536)) + 2 * a0 * a7 + 2 * a1 * a6 + 2 * a2 * a5 + 2 * a3 * a4) & 65535;
            r[8] = (v = (0 | (v / 65536)) + 2 * a1 * a7 + 2 * a2 * a6 + 2 * a3 * a5 + a4 * a4) & 65535;
            r[9] = (v = (0 | (v / 65536)) + 2 * a2 * a7 + 2 * a3 * a6 + 2 * a4 * a5) & 65535;
            r[10] = (v = (0 | (v / 65536)) + 2 * a3 * a7 + 2 * a4 * a6 + a5 * a5) & 65535;
            r[11] = (v = (0 | (v / 65536)) + 2 * a4 * a7 + 2 * a5 * a6) & 65535;
            r[12] = (v = (0 | (v / 65536)) + 2 * a5 * a7 + a6 * a6) & 65535;
            r[13] = (v = (0 | (v / 65536)) + 2 * a6 * a7) & 65535;
            r[14] = (v = (0 | (v / 65536)) + a7 * a7) & 65535;
            r[15] = 0 | (v / 65536);
            return r;
        }

        function _sqrmodp(a) {
            var x = _sqr8h(a[15], a[14], a[13], a[12], a[11], a[10], a[9], a[8]);
            var z = _sqr8h(a[7], a[6], a[5], a[4], a[3], a[2], a[1], a[0]);
            var y = _sqr8h(a[15] + a[7], a[14] + a[6], a[13] + a[5], a[12] + a[4], a[11] + a[3], a[10] + a[2], a[9] + a[1], a[8] + a[0]);
            var r = [];
            var v;
            r[0] = (v = 8388608 + z[0] + (y[8] - x[8] - z[8] + x[0] - 128) * 38) & 65535;
            r[1] = (v = 8388480 + (v >>> 16) + z[1] + (y[9] - x[9] - z[9] + x[1]) * 38) & 65535;
            r[2] = (v = 8388480 + (v >>> 16) + z[2] + (y[10] - x[10] - z[10] + x[2]) * 38) & 65535;
            r[3] = (v = 8388480 + (v >>> 16) + z[3] + (y[11] - x[11] - z[11] + x[3]) * 38) & 65535;
            r[4] = (v = 8388480 + (v >>> 16) + z[4] + (y[12] - x[12] - z[12] + x[4]) * 38) & 65535;
            r[5] = (v = 8388480 + (v >>> 16) + z[5] + (y[13] - x[13] - z[13] + x[5]) * 38) & 65535;
            r[6] = (v = 8388480 + (v >>> 16) + z[6] + (y[14] - x[14] - z[14] + x[6]) * 38) & 65535;
            r[7] = (v = 8388480 + (v >>> 16) + z[7] + (y[15] - x[15] - z[15] + x[7]) * 38) & 65535;
            r[8] = (v = 8388480 + (v >>> 16) + z[8] + y[0] - x[0] - z[0] + x[8] * 38) & 65535;
            r[9] = (v = 8388480 + (v >>> 16) + z[9] + y[1] - x[1] - z[1] + x[9] * 38) & 65535;
            r[10] = (v = 8388480 + (v >>> 16) + z[10] + y[2] - x[2] - z[2] + x[10] * 38) & 65535;
            r[11] = (v = 8388480 + (v >>> 16) + z[11] + y[3] - x[3] - z[3] + x[11] * 38) & 65535;
            r[12] = (v = 8388480 + (v >>> 16) + z[12] + y[4] - x[4] - z[4] + x[12] * 38) & 65535;
            r[13] = (v = 8388480 + (v >>> 16) + z[13] + y[5] - x[5] - z[5] + x[13] * 38) & 65535;
            r[14] = (v = 8388480 + (v >>> 16) + z[14] + y[6] - x[6] - z[6] + x[14] * 38) & 65535;
            r[15] = 8388480 + (v >>> 16) + z[15] + y[7] - x[7] - z[7] + x[15] * 38;
            _reduce(r);
            return r;
        }

        function _mul8h(a7, a6, a5, a4, a3, a2, a1, a0, b7, b6, b5, b4, b3, b2, b1, b0) {
            // 'division by 0x10000' can not be replaced by '>> 16' because
            // more than 32 bits of precision are needed
            var r = [];
            var v;
            r[0] = (v = a0 * b0) & 65535;
            r[1] = (v = (0 | (v / 65536)) + a0 * b1 + a1 * b0) & 65535;
            r[2] = (v = (0 | (v / 65536)) + a0 * b2 + a1 * b1 + a2 * b0) & 65535;
            r[3] = (v = (0 | (v / 65536)) + a0 * b3 + a1 * b2 + a2 * b1 + a3 * b0) & 65535;
            r[4] = (v = (0 | (v / 65536)) + a0 * b4 + a1 * b3 + a2 * b2 + a3 * b1 + a4 * b0) & 65535;
            r[5] = (v = (0 | (v / 65536)) + a0 * b5 + a1 * b4 + a2 * b3 + a3 * b2 + a4 * b1 + a5 * b0) & 65535;
            r[6] = (v = (0 | (v / 65536)) + a0 * b6 + a1 * b5 + a2 * b4 + a3 * b3 + a4 * b2 + a5 * b1 + a6 * b0) & 65535;
            r[7] = (v = (0 | (v / 65536)) + a0 * b7 + a1 * b6 + a2 * b5 + a3 * b4 + a4 * b3 + a5 * b2 + a6 * b1 + a7 * b0) & 65535;
            r[8] = (v = (0 | (v / 65536)) + a1 * b7 + a2 * b6 + a3 * b5 + a4 * b4 + a5 * b3 + a6 * b2 + a7 * b1) & 65535;
            r[9] = (v = (0 | (v / 65536)) + a2 * b7 + a3 * b6 + a4 * b5 + a5 * b4 + a6 * b3 + a7 * b2) & 65535;
            r[10] = (v = (0 | (v / 65536)) + a3 * b7 + a4 * b6 + a5 * b5 + a6 * b4 + a7 * b3) & 65535;
            r[11] = (v = (0 | (v / 65536)) + a4 * b7 + a5 * b6 + a6 * b5 + a7 * b4) & 65535;
            r[12] = (v = (0 | (v / 65536)) + a5 * b7 + a6 * b6 + a7 * b5) & 65535;
            r[13] = (v = (0 | (v / 65536)) + a6 * b7 + a7 * b6) & 65535;
            r[14] = (v = (0 | (v / 65536)) + a7 * b7) & 65535;
            r[15] = (0 | (v / 65536));
            return r;
        }

        function _mulmodp(a, b) {
            // Karatsuba multiplication scheme: x*y = (b^2+b)*x1*y1 -
            // b*(x1-x0)*(y1-y0) + (b+1)*x0*y0
            var x = _mul8h(a[15], a[14], a[13], a[12], a[11], a[10], a[9], a[8], b[15], b[14], b[13], b[12], b[11], b[10], b[9], b[8]);
            var z = _mul8h(a[7], a[6], a[5], a[4], a[3], a[2], a[1], a[0], b[7], b[6], b[5], b[4], b[3], b[2], b[1], b[0]);
            var y = _mul8h(a[15] + a[7], a[14] + a[6], a[13] + a[5], a[12] + a[4], a[11] + a[3], a[10] + a[2], a[9] + a[1], a[8] + a[0], b[15] + b[7], b[14] + b[6], b[13] + b[5], b[12] + b[4], b[11] + b[3], b[10] + b[2], b[9] + b[1], b[8] + b[0]);
            var r = [];
            var v;
            r[0] = (v = 8388608 + z[0] + (y[8] - x[8] - z[8] + x[0] - 128) * 38) & 65535;
            r[1] = (v = 8388480 + (v >>> 16) + z[1] + (y[9] - x[9] - z[9] + x[1]) * 38) & 65535;
            r[2] = (v = 8388480 + (v >>> 16) + z[2] + (y[10] - x[10] - z[10] + x[2]) * 38) & 65535;
            r[3] = (v = 8388480 + (v >>> 16) + z[3] + (y[11] - x[11] - z[11] + x[3]) * 38) & 65535;
            r[4] = (v = 8388480 + (v >>> 16) + z[4] + (y[12] - x[12] - z[12] + x[4]) * 38) & 65535;
            r[5] = (v = 8388480 + (v >>> 16) + z[5] + (y[13] - x[13] - z[13] + x[5]) * 38) & 65535;
            r[6] = (v = 8388480 + (v >>> 16) + z[6] + (y[14] - x[14] - z[14] + x[6]) * 38) & 65535;
            r[7] = (v = 8388480 + (v >>> 16) + z[7] + (y[15] - x[15] - z[15] + x[7]) * 38) & 65535;
            r[8] = (v = 8388480 + (v >>> 16) + z[8] + y[0] - x[0] - z[0] + x[8] * 38) & 65535;
            r[9] = (v = 8388480 + (v >>> 16) + z[9] + y[1] - x[1] - z[1] + x[9] * 38) & 65535;
            r[10] = (v = 8388480 + (v >>> 16) + z[10] + y[2] - x[2] - z[2] + x[10] * 38) & 65535;
            r[11] = (v = 8388480 + (v >>> 16) + z[11] + y[3] - x[3] - z[3] + x[11] * 38) & 65535;
            r[12] = (v = 8388480 + (v >>> 16) + z[12] + y[4] - x[4] - z[4] + x[12] * 38) & 65535;
            r[13] = (v = 8388480 + (v >>> 16) + z[13] + y[5] - x[5] - z[5] + x[13] * 38) & 65535;
            r[14] = (v = 8388480 + (v >>> 16) + z[14] + y[6] - x[6] - z[6] + x[14] * 38) & 65535;
            r[15] = 8388480 + (v >>> 16) + z[15] + y[7] - x[7] - z[7] + x[15] * 38;
            _reduce(r);
            return r;
        }

        function _reduce(arr) {
            var aCopy = arr.slice(0);
            var choice = [
                arr,
                aCopy
            ];
            var v = arr[15];
            // Use the dummy copy instead of just returning to be more constant time.
            var a = choice[(v < 32768) & 1];
            a[15] = v & 32767;
            // >32-bits of precision are required here so '/ 0x8000' can not be
            // replaced by the arithmetic equivalent '>>> 15'
            v = (0 | (v / 32768)) * 19;
            a[0] = (v += a[0]) & 65535;
            v = v >>> 16;
            a[1] = (v += a[1]) & 65535;
            v = v >>> 16;
            a[2] = (v += a[2]) & 65535;
            v = v >>> 16;
            a[3] = (v += a[3]) & 65535;
            v = v >>> 16;
            a[4] = (v += a[4]) & 65535;
            v = v >>> 16;
            a[5] = (v += a[5]) & 65535;
            v = v >>> 16;
            a[6] = (v += a[6]) & 65535;
            v = v >>> 16;
            a[7] = (v += a[7]) & 65535;
            v = v >>> 16;
            a[8] = (v += a[8]) & 65535;
            v = v >>> 16;
            a[9] = (v += a[9]) & 65535;
            v = v >>> 16;
            a[10] = (v += a[10]) & 65535;
            v = v >>> 16;
            a[11] = (v += a[11]) & 65535;
            v = v >>> 16;
            a[12] = (v += a[12]) & 65535;
            v = v >>> 16;
            a[13] = (v += a[13]) & 65535;
            v = v >>> 16;
            a[14] = (v += a[14]) & 65535;
            v = v >>> 16;
            a[15] += v;
        }

        function _addmodp(a, b) {
            var r = [];
            var v;
            r[0] = (v = ((0 | (a[15] >>> 15)) + (0 | (b[15] >>> 15))) * 19 + a[0] + b[0]) & 65535;
            r[1] = (v = (v >>> 16) + a[1] + b[1]) & 65535;
            r[2] = (v = (v >>> 16) + a[2] + b[2]) & 65535;
            r[3] = (v = (v >>> 16) + a[3] + b[3]) & 65535;
            r[4] = (v = (v >>> 16) + a[4] + b[4]) & 65535;
            r[5] = (v = (v >>> 16) + a[5] + b[5]) & 65535;
            r[6] = (v = (v >>> 16) + a[6] + b[6]) & 65535;
            r[7] = (v = (v >>> 16) + a[7] + b[7]) & 65535;
            r[8] = (v = (v >>> 16) + a[8] + b[8]) & 65535;
            r[9] = (v = (v >>> 16) + a[9] + b[9]) & 65535;
            r[10] = (v = (v >>> 16) + a[10] + b[10]) & 65535;
            r[11] = (v = (v >>> 16) + a[11] + b[11]) & 65535;
            r[12] = (v = (v >>> 16) + a[12] + b[12]) & 65535;
            r[13] = (v = (v >>> 16) + a[13] + b[13]) & 65535;
            r[14] = (v = (v >>> 16) + a[14] + b[14]) & 65535;
            r[15] = (v >>> 16) + (a[15] & 32767) + (b[15] & 32767);
            return r;
        }

        function _submodp(a, b) {
            var r = [];
            var v;
            r[0] = (v = 524288 + ((0 | (a[15] >>> 15)) - (0 | (b[15] >>> 15)) - 1) * 19 + a[0] - b[0]) & 65535;
            r[1] = (v = (v >>> 16) + 524280 + a[1] - b[1]) & 65535;
            r[2] = (v = (v >>> 16) + 524280 + a[2] - b[2]) & 65535;
            r[3] = (v = (v >>> 16) + 524280 + a[3] - b[3]) & 65535;
            r[4] = (v = (v >>> 16) + 524280 + a[4] - b[4]) & 65535;
            r[5] = (v = (v >>> 16) + 524280 + a[5] - b[5]) & 65535;
            r[6] = (v = (v >>> 16) + 524280 + a[6] - b[6]) & 65535;
            r[7] = (v = (v >>> 16) + 524280 + a[7] - b[7]) & 65535;
            r[8] = (v = (v >>> 16) + 524280 + a[8] - b[8]) & 65535;
            r[9] = (v = (v >>> 16) + 524280 + a[9] - b[9]) & 65535;
            r[10] = (v = (v >>> 16) + 524280 + a[10] - b[10]) & 65535;
            r[11] = (v = (v >>> 16) + 524280 + a[11] - b[11]) & 65535;
            r[12] = (v = (v >>> 16) + 524280 + a[12] - b[12]) & 65535;
            r[13] = (v = (v >>> 16) + 524280 + a[13] - b[13]) & 65535;
            r[14] = (v = (v >>> 16) + 524280 + a[14] - b[14]) & 65535;
            r[15] = (v >>> 16) + 32760 + (a[15] & 32767) - (b[15] & 32767);
            return r;
        }

        function _invmodp(a) {
            var c = a;
            var i = 250;
            while (--i) {
                a = _sqrmodp(a);
                a = _mulmodp(a, c);
            }
            a = _sqrmodp(a);
            a = _sqrmodp(a);
            a = _mulmodp(a, c);
            a = _sqrmodp(a);
            a = _sqrmodp(a);
            a = _mulmodp(a, c);
            a = _sqrmodp(a);
            a = _mulmodp(a, c);
            return a;
        }

        function _mulasmall(a) {
            // 'division by 0x10000' can not be replaced by '>> 16' because
            // more than 32 bits of precision are needed
            var m = 121665;
            var r = [];
            var v;
            r[0] = (v = a[0] * m) & 65535;
            r[1] = (v = (0 | (v / 65536)) + a[1] * m) & 65535;
            r[2] = (v = (0 | (v / 65536)) + a[2] * m) & 65535;
            r[3] = (v = (0 | (v / 65536)) + a[3] * m) & 65535;
            r[4] = (v = (0 | (v / 65536)) + a[4] * m) & 65535;
            r[5] = (v = (0 | (v / 65536)) + a[5] * m) & 65535;
            r[6] = (v = (0 | (v / 65536)) + a[6] * m) & 65535;
            r[7] = (v = (0 | (v / 65536)) + a[7] * m) & 65535;
            r[8] = (v = (0 | (v / 65536)) + a[8] * m) & 65535;
            r[9] = (v = (0 | (v / 65536)) + a[9] * m) & 65535;
            r[10] = (v = (0 | (v / 65536)) + a[10] * m) & 65535;
            r[11] = (v = (0 | (v / 65536)) + a[11] * m) & 65535;
            r[12] = (v = (0 | (v / 65536)) + a[12] * m) & 65535;
            r[13] = (v = (0 | (v / 65536)) + a[13] * m) & 65535;
            r[14] = (v = (0 | (v / 65536)) + a[14] * m) & 65535;
            r[15] = (0 | (v / 65536)) + a[15] * m;
            _reduce(r);
            return r;
        }

        function _dbl(x, z) {
            var x_2,
                z_2,
                m,
                n,
                o;
            m = _sqrmodp(_addmodp(x, z));
            n = _sqrmodp(_submodp(x, z));
            o = _submodp(m, n);
            x_2 = _mulmodp(n, m);
            z_2 = _mulmodp(_addmodp(_mulasmall(o), m), o);
            return [x_2,
                z_2
            ];
        }

        function _sum(x, z, x_p, z_p, x_1) {
            var x_3,
                z_3,
                p,
                q;
            p = _mulmodp(_submodp(x, z), _addmodp(x_p, z_p));
            q = _mulmodp(_addmodp(x, z), _submodp(x_p, z_p));
            x_3 = _sqrmodp(_addmodp(p, q));
            z_3 = _mulmodp(_sqrmodp(_submodp(p, q)), x_1);
            return [x_3,
                z_3
            ];
        }

        function _generateKey() {
            var buffer = new Uint8Array(32);
            asmCrypto.getRandomValues(buffer);
            var result = [];
            for (var i = 0; i < buffer.length; i++) {
                result.push(String.fromCharCode(buffer[i]));
            }
            return result.join('');
        }
        // Expose some functions to the outside through this name space.
        // Note: This is not part of the public API.

        ns.getbit = _getbit;
        ns.setbit = _setbit;
        ns.invmodp = _invmodp;
        ns.mulmodp = _mulmodp;
        ns.reduce = _reduce;
        ns.dbl = _dbl;
        ns.sum = _sum;
        ns.ZERO = _ZERO;
        ns.ONE = _ONE;
        ns.BASE = _BASE;
        ns.bigintadd = _bigintadd;
        ns.bigintsub = _bigintsub;
        ns.bigintcmp = _bigintcmp;
        ns.mulmodp = _mulmodp;
        ns.sqrmodp = _sqrmodp;
        ns.generateKey = _generateKey;
        return ns;
    });
    /**
     * @fileOverview
     * A collection of general utility functions..
     */
    /*
     * Copyright (c) 2011, 2012, 2014 Ron Garret
     * Copyright (c) 2007, 2013, 2014 Michele Bini
     * Copyright (c) 2014 Mega Limited
     * under the MIT License.
     *
     * Authors: Guy K. Kloss, Michele Bini, Ron Garret
     *
     * You should have received a copy of the license along with this program.
     */
    define('jodid25519/utils', [
        'jodid25519/core',
    ], function(core) {
        /**
         * @exports jodid25519/utils
         * A collection of general utility functions..
         *
         * @description
         * A collection of general utility functions..
         */
        var ns = {};
        var _HEXCHARS = '0123456789abcdef';

        function _hexencode(vector) {
            var result = [];
            for (var i = vector.length - 1; i >= 0; i--) {
                var value = vector[i];
                result.push(_HEXCHARS.substr((value >>> 12) & 15, 1));
                result.push(_HEXCHARS.substr((value >>> 8) & 15, 1));
                result.push(_HEXCHARS.substr((value >>> 4) & 15, 1));
                result.push(_HEXCHARS.substr(value & 15, 1));
            }
            return result.join('');
        }

        function _hexdecode(vector) {
            var result = [
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0
            ];
            for (var i = vector.length - 1, l = 0; i >= 0; i -= 4) {
                result[l] = (_HEXCHARS.indexOf(vector.charAt(i))) | (_HEXCHARS.indexOf(vector.charAt(i - 1)) << 4) | (_HEXCHARS.indexOf(vector.charAt(i - 2)) << 8) | (_HEXCHARS.indexOf(vector.charAt(i - 3)) << 12);
                l++;
            }
            return result;
        }
        var _BASE32CHARS = 'abcdefghijklmnopqrstuvwxyz234567';
        var _BASE32VALUES = (function() {
            var result = {};
            for (var i = 0; i < _BASE32CHARS.length; i++) {
                result[_BASE32CHARS.charAt(i)] = i;
            }
            return result;
        })();

        function _base32encode(n) {
            var c;
            var r = '';
            for (c = 0; c < 255; c += 5) {
                r = _BASE32CHARS.substr(core.getbit(n, c) + (core.getbit(n, c + 1) << 1) + (core.getbit(n, c + 2) << 2) + (core.getbit(n, c + 3) << 3) + (core.getbit(n, c + 4) << 4), 1) + r;
            }
            return r;
        }

        function _base32decode(n) {
            var c = 0;
            var r = core.ZERO();
            var l = n.length;
            for (c = 0;
                (l > 0) && (c < 255); c += 5) {
                l--;
                var v = _BASE32VALUES[n.substr(l, 1)];
                core.setbit(r, c, v & 1);
                v >>= 1;
                core.setbit(r, c + 1, v & 1);
                v >>= 1;
                core.setbit(r, c + 2, v & 1);
                v >>= 1;
                core.setbit(r, c + 3, v & 1);
                v >>= 1;
                core.setbit(r, c + 4, v & 1);
            }
            return r;
        }

        function _map(f, l) {
            var result = new Array(l.length);
            for (var i = 0; i < l.length; i++) {
                result[i] = f(l[i]);
            }
            return result;
        }

        function _chr(n) {
            return String.fromCharCode(n);
        }

        function _ord(c) {
            return c.charCodeAt(0);
        }

        function _bytes2string(bytes) {
            return _map(_chr, bytes).join('');
        }

        function _string2bytes(s) {
            return _map(_ord, s);
        }
        // Expose some functions to the outside through this name space.
        /**
         * Encodes an array of unsigned 8-bit integers to a hex string.
         *
         * @function
         * @param vector {array}
         *     Array containing the byte values.
         * @returns {string}
         *     String containing vector in a hexadecimal representation.
         */

        ns.hexEncode = _hexencode;
        /**
         * Decodes a hex string to an array of unsigned 8-bit integers.
         *
         * @function
         * @param vector {string}
         *     String containing vector in a hexadecimal representation.
         * @returns {array}
         *     Array containing the byte values.
         */
        ns.hexDecode = _hexdecode;
        /**
         * Encodes an array of unsigned 8-bit integers using base32 encoding.
         *
         * @function
         * @param vector {array}
         *     Array containing the byte values.
         * @returns {string}
         *     String containing vector in a hexadecimal representation.
         */
        ns.base32encode = _base32encode;
        /**
         * Decodes a base32 encoded string to an array of unsigned 8-bit integers.
         *
         * @function
         * @param vector {string}
         *     String containing vector in a hexadecimal representation.
         * @returns {array}
         *     Array containing the byte values.
         */
        ns.base32decode = _base32decode;
        /**
         * Converts an unsigned 8-bit integer array representation to a byte string.
         *
         * @function
         * @param vector {array}
         *     Array containing the byte values.
         * @returns {string}
         *     Byte string representation of vector.
         */
        ns.bytes2string = _bytes2string;
        /**
         * Converts a byte string representation to an array of unsigned
         * 8-bit integers.
         *
         * @function
         * @param vector {array}
         *     Array containing the byte values.
         * @returns {string}
         *     Byte string representation of vector.
         */
        ns.string2bytes = _string2bytes;
        return ns;
    });
    /**
     * @fileOverview
     * Core operations on curve 25519 required for the higher level modules.
     */
    /*
     * Copyright (c) 2007, 2013, 2014 Michele Bini
     * Copyright (c) 2014 Mega Limited
     * under the MIT License.
     *
     * Authors: Guy K. Kloss, Michele Bini
     *
     * You should have received a copy of the license along with this program.
     */
    define('jodid25519/curve255', [
        'jodid25519/core',
        'jodid25519/utils',
    ], function(core, utils) {
        /**
         * @exports jodid25519/curve255
         * Legacy compatibility module for Michele Bini's previous curve255.js.
         *
         * @description
         * Legacy compatibility module for Michele Bini's previous curve255.js.
         *
         * <p>
         * This code presents an API with all key formats as previously available
         * from Michele Bini's curve255.js implementation.
         * </p>
         */
        var ns = {};

        function curve25519_raw(f, c) {
            var a,
                x_1,
                q;
            x_1 = c;
            a = core.dbl(x_1, core.ONE());
            q = [
                x_1,
                core.ONE()
            ];
            var n = 255;
            while (core.getbit(f, n) == 0) {
                n--;
                // For correct constant-time operation, bit 255 should always be
                // set to 1 so the following 'while' loop is never entered.
                if (n < 0) {
                    return core.ZERO();
                }
            }
            n--;
            var aq = [
                a,
                q
            ];
            while (n >= 0) {
                var r,
                    s;
                var b = core.getbit(f, n);
                r = core.sum(aq[0][0], aq[0][1], aq[1][0], aq[1][1], x_1);
                s = core.dbl(aq[1 - b][0], aq[1 - b][1]);
                aq[1 - b] = s;
                aq[b] = r;
                n--;
            }
            q = aq[1];
            q[1] = core.invmodp(q[1]);
            q[0] = core.mulmodp(q[0], q[1]);
            core.reduce(q[0]);
            return q[0];
        }

        function curve25519b32(a, b) {
            return _base32encode(curve25519(_base32decode(a), _base32decode(b)));
        }

        function curve25519(f, c) {
            if (!c) {
                c = core.BASE();
            }
            f[0] &= 65528;
            f[15] = (f[15] & 32767) | 16384;
            return curve25519_raw(f, c);
        }

        function _hexEncodeVector(k) {
            var hexKey = utils.hexEncode(k);
            // Pad with '0' at the front.
            hexKey = new Array(64 + 1 - hexKey.length).join('0') + hexKey;
            // Invert bytes.
            return hexKey.split(/(..)/).reverse().join('');
        }

        function _hexDecodeVector(v) {
            // assert(length(x) == 64);
            // Invert bytes.
            var hexKey = v.split(/(..)/).reverse().join('');
            return utils.hexDecode(hexKey);
        }
        // Expose some functions to the outside through this name space.
        /**
         * Computes the scalar product of a point on the curve 25519.
         *
         * This function is used for the DH key-exchange protocol.
         *
         * Before multiplication, some bit operations are applied to the
         * private key to ensure it is a valid Curve25519 secret key.
         * It is the user's responsibility to make sure that the private
         * key is a uniformly random, secret value.
         *
         * @function
         * @param f {array}
         *     Private key.
         * @param c {array}
         *     Public point on the curve. If not given, the curve's base point is used.
         * @returns {array}
         *     Key point resulting from scalar product.
         */

        ns.curve25519 = curve25519;
        /**
         * Computes the scalar product of a point on the curve 25519.
         *
         * This variant does not make sure that the private key is valid.
         * The user has the responsibility to ensure the private key is
         * valid or that this results in a safe protocol.  Unless you know
         * exactly what you are doing, you should not use this variant,
         * please use 'curve25519' instead.
         *
         * @function
         * @param f {array}
         *     Private key.
         * @param c {array}
         *     Public point on the curve. If not given, the curve's base point is used.
         * @returns {array}
         *     Key point resulting from scalar product.
         */
        ns.curve25519_raw = curve25519_raw;
        /**
         * Encodes the internal representation of a key to a canonical hex
         * representation.
         *
         * This is the format commonly used in other libraries and for
         * test vectors, and is equivalent to the hex dump of the key in
         * little-endian binary format.
         *
         * @function
         * @param n {array}
         *     Array representation of key.
         * @returns {string}
         *     Hexadecimal string representation of key.
         */
        ns.hexEncodeVector = _hexEncodeVector;
        /**
         * Decodes a canonical hex representation of a key
         * to an internally compatible array representation.
         *
         * @function
         * @param n {string}
         *     Hexadecimal string representation of key.
         * @returns {array}
         *     Array representation of key.
         */
        ns.hexDecodeVector = _hexDecodeVector;
        /**
         * Encodes the internal representation of a key into a
         * hexadecimal representation.
         *
         * This is a strict positional notation, most significant digit first.
         *
         * @function
         * @param n {array}
         *     Array representation of key.
         * @returns {string}
         *     Hexadecimal string representation of key.
         */
        ns.hexencode = utils.hexEncode;
        /**
         * Decodes a hex representation of a key to an internally
         * compatible array representation.
         *
         * @function
         * @param n {string}
         *     Hexadecimal string representation of key.
         * @returns {array}
         *     Array representation of key.
         */
        ns.hexdecode = utils.hexDecode;
        /**
         * Encodes the internal representation of a key to a base32
         * representation.
         *
         * @function
         * @param n {array}
         *     Array representation of key.
         * @returns {string}
         *     Base32 string representation of key.
         */
        ns.base32encode = utils.base32encode;
        /**
         * Decodes a base32 representation of a key to an internally
         * compatible array representation.
         *
         * @function
         * @param n {string}
         *     Base32 string representation of key.
         * @returns {array}
         *     Array representation of key.
         */
        ns.base32decode = utils.base32decode;
        return ns;
    });
    /**
     * @fileOverview
     * EC Diffie-Hellman operations on Curve25519.
     */
    /*
     * Copyright (c) 2014 Mega Limited
     * under the MIT License.
     *
     * Authors: Guy K. Kloss
     *
     * You should have received a copy of the license along with this program.
     */
    define('jodid25519/dh', [
        'jodid25519/core',
        'jodid25519/utils',
        'jodid25519/curve255',
    ], function(core, utils, curve255) {
        /**
         * @exports jodid25519/dh
         * EC Diffie-Hellman operations on Curve25519.
         *
         * @description
         * EC Diffie-Hellman operations on Curve25519.
         */
        var ns = {};

        function _toString(vector) {
            var result = [];
            for (var i = 0; i < vector.length; i++) {
                result.push(String.fromCharCode(vector[i] & 255));
                result.push(String.fromCharCode(vector[i] >>> 8));
            }
            return result.join('');
        }

        function _fromString(vector) {
            var result = new Array(16);
            for (var i = 0, l = 0; i < vector.length; i += 2) {
                result[l] = (vector.charCodeAt(i + 1) << 8) | vector.charCodeAt(i);
                l++;
            }
            return result;
        }
        /**
         * Computes a key through scalar multiplication of a point on the curve 25519.
         *
         * This function is used for the DH key-exchange protocol. It computes a
         * key based on a secret key with a public component (opponent's public key
         * or curve base point if not given) by using scalar multiplication.
         *
         * Before multiplication, some bit operations are applied to the
         * private key to ensure it is a valid Curve25519 secret key.
         * It is the user's responsibility to make sure that the private
         * key is a uniformly random, secret value.
         *
         * @function
         * @param privateComponent {string}
         *     Private point as byte string on the curve.
         * @param publicComponent {string}
         *     Public point as byte string on the curve. If not given, the curve's
         *     base point is used.
         * @returns {string}
         *     Key point as byte string resulting from scalar product.
         */

        ns.computeKey = function(privateComponent, publicComponent) {
            if (publicComponent) {
                return _toString(curve255.curve25519(_fromString(privateComponent), _fromString(publicComponent)));
            } else {
                return _toString(curve255.curve25519(_fromString(privateComponent)));
            }
        };
        /**
         * Computes the public key to a private key on the curve 25519.
         *
         * Before multiplication, some bit operations are applied to the
         * private key to ensure it is a valid Curve25519 secret key.
         * It is the user's responsibility to make sure that the private
         * key is a uniformly random, secret value.
         *
         * @function
         * @param privateKey {string}
         *     Private point as byte string on the curve.
         * @returns {string}
         *     Public key point as byte string resulting from scalar product.
         */
        ns.publicKey = function(privateKey) {
            return _toString(curve255.curve25519(_fromString(privateKey)));
        };
        /**
         * Generates a new random private key of 32 bytes length (256 bit).
         *
         * @function
         * @returns {string}
         *     Byte string containing a new random private key seed.
         */
        ns.generateKey = core.generateKey;
        return ns;
    });;
    define('jsbn', (function(global) {
        return function() {
            var ret,
                fn;
            fn = function(jsbn) {
                return {
                    BigInteger: BigInteger,
                };
            };
            ret = fn.apply(global, arguments);
            return ret || global.jsbn;
        };
    }(this)));
    /**
     * @fileOverview
     * Digital signature scheme based on Curve25519 (Ed25519 or EdDSA).
     */
    /*
     * Copyright (c) 2011, 2012, 2014 Ron Garret
     * Copyright (c) 2014 Mega Limited
     * under the MIT License.
     *
     * Authors: Guy K. Kloss, Ron Garret
     *
     * You should have received a copy of the license along with this program.
     */
    define('jodid25519/eddsa', [
        'jodid25519/core',
        'jodid25519/curve255',
        'jodid25519/utils',
        'jsbn',
        'asmcrypto',
    ], function(core, curve255, utils, jsbn, asmCrypto) {
        /**
         * @exports jodid25519/eddsa
         * Digital signature scheme based on Curve25519 (Ed25519 or EdDSA).
         *
         * @description
         * Digital signature scheme based on Curve25519 (Ed25519 or EdDSA).
         *
         * <p>
         * This code is adapted from fast-djbec.js, a faster but more complicated
         * version of the Ed25519 encryption scheme (as compared to djbec.js).
         * It uses two different representations for big integers: The jsbn
         * BigInteger class, which can represent arbitrary-length numbers, and a
         * special fixed-length representation optimised for 256-bit integers.
         * The reason both are needed is that the Ed25519 algorithm requires some
         * 512-bit numbers.</p>
         */
        var ns = {};

        function _bi255(value) {
            if (!(this instanceof _bi255)) {
                return new _bi255(value);
            }
            if (typeof value === 'undefined') {
                return _ZERO;
            }
            var c = value.constructor;
            if ((c === Array) && (value.length === 16)) {
                this.n = value;
            } else if ((c === Array) && (value.length === 32)) {
                this.n = _bytes2bi255(value).n;
            } else if (c === String) {
                this.n = utils.hexDecode(value);
            } else if (c === Number) {
                this.n = [
                    value & 65535,
                    value >> 16,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0,
                    0
                ];
            } else if (value instanceof _bi255) {
                this.n = value.n.slice(0); // Copy constructor
            } else {
                throw 'Bad argument for bignum: ' + value;
            }
        }
        _bi255.prototype = {
            'toString': function() {
                return utils.hexEncode(this.n);
            },
            'toSource': function() {
                return '_' + utils.hexEncode(this.n);
            },
            'plus': function(n1) {
                return _bi255(core.bigintadd(this.n, n1.n));
            },
            'minus': function(n1) {
                return _bi255(core.bigintsub(this.n, n1.n)).modq();
            },
            'times': function(n1) {
                return _bi255(core.mulmodp(this.n, n1.n));
            },
            'divide': function(n1) {
                return this.times(n1.inv());
            },
            'sqr': function() {
                return _bi255(core.sqrmodp(this.n));
            },
            'cmp': function(n1) {
                return core.bigintcmp(this.n, n1.n);
            },
            'equals': function(n1) {
                return this.cmp(n1) === 0;
            },
            'isOdd': function() {
                return (this.n[0] & 1) === 1;
            },
            'shiftLeft': function(cnt) {
                _shiftL(this.n, cnt);
                return this;
            },
            'shiftRight': function(cnt) {
                _shiftR(this.n, cnt);
                return this;
            },
            'inv': function() {
                return _bi255(core.invmodp(this.n));
            },
            'pow': function(e) {
                return _bi255(_pow(this.n, e.n));
            },
            'modq': function() {
                return _modq(this);
            },
            'bytes': function() {
                return _bi255_bytes(this);
            }
        };

        function _shiftL(n, cnt) {
            var lastcarry = 0;
            for (var i = 0; i < 16; i++) {
                var carry = n[i] >> (16 - cnt);
                n[i] = (n[i] << cnt) & 65535 | lastcarry;
                lastcarry = carry;
            }
            return n;
        }

        function _shiftR(n, cnt) {
            var lastcarry = 0;
            for (var i = 15; i >= 0; i--) {
                var carry = n[i] << (16 - cnt) & 65535;
                n[i] = (n[i] >> cnt) | lastcarry;
                lastcarry = carry;
            }
            return n;
        }

        function _bi255_bytes(n) {
            n = _bi255(n); // Make a copy because shiftRight is destructive
            var a = new Array(32);
            for (var i = 31; i >= 0; i--) {
                a[i] = n.n[0] & 255;
                n.shiftRight(8);
            }
            return a;
        }

        function _bytes2bi255(a) {
            var n = _ZERO;
            for (var i = 0; i < 32; i++) {
                n.shiftLeft(8);
                n = n.plus(_bi255(a[i]));
            }
            return n;
        }

        function _pow(n, e) {
            var result = core.ONE();
            for (var i = 0; i < 256; i++) {
                if (core.getbit(e, i) === 1) {
                    result = core.mulmodp(result, n);
                }
                n = core.sqrmodp(n);
            }
            return result;
        }
        var _ZERO = _bi255(0);
        var _ONE = _bi255(1);
        var _TWO = _bi255(2);
        // This is the core prime.
        var _Q = _bi255([65535 - 18,
            65535,
            65535,
            65535,
            65535,
            65535,
            65535,
            65535,
            65535,
            65535,
            65535,
            65535,
            65535,
            65535,
            65535,
            32767
        ]);

        function _modq(n) {
            core.reduce(n.n);
            if (n.cmp(_Q) >= 0) {
                return _modq(n.minus(_Q));
            }
            if (n.cmp(_ZERO) === -1) {
                return _modq(n.plus(_Q));
            } else {
                return n;
            }
        }
        // _RECOVERY_EXPONENT = _Q.plus(_bi255(3)).divide(_bi255(8));

        var _RECOVERY_EXPONENT = _bi255('0ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe');
        // _D = _Q.minus(_bi255(121665)).divide(_bi255(121666));
        var _D = _bi255('52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3');
        // _I = _TWO.pow(_Q.minus(_ONE).divide(_bi255(4)));
        var _I = _bi255('2b8324804fc1df0b2b4d00993dfbd7a72f431806ad2fe478c4ee1b274a0ea0b0');
        // _L = _TWO.pow(_bi255(252)).plus(_bi255('14def9dea2f79cd65812631a5cf5d3ed'));
        var _L = _bi255('1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed');
        var _L_BI = _bi('1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed', 16);
        // ////////////////////////////////////////////////////////////
        function _isoncurve(p) {
            var x = p[0];
            var y = p[1];
            var xsqr = x.sqr();
            var ysqr = y.sqr();
            var v = _D.times(xsqr).times(ysqr);
            return ysqr.minus(xsqr).minus(_ONE).minus(v).modq().equals(_ZERO);
        }

        function _xrecover(y) {
            var ysquared = y.sqr();
            var xx = ysquared.minus(_ONE).divide(_ONE.plus(_D.times(ysquared)));
            var x = xx.pow(_RECOVERY_EXPONENT);
            if (!(x.times(x).minus(xx).equals(_ZERO))) {
                x = x.times(_I);
            }
            if (x.isOdd()) {
                x = _Q.minus(x);
            }
            return x;
        }

        function _x_pt_add(pt1, pt2) {
            var x1 = pt1[0];
            var y1 = pt1[1];
            var z1 = pt1[2];
            var t1 = pt1[3];
            var x2 = pt2[0];
            var y2 = pt2[1];
            var z2 = pt2[2];
            var t2 = pt2[3];
            var A = y1.minus(x1).times(y2.plus(x2));
            var B = y1.plus(x1).times(y2.minus(x2));
            var C = z1.times(_TWO).times(t2);
            var D = t1.times(_TWO).times(z2);
            var E = D.plus(C);
            var F = B.minus(A);
            var G = B.plus(A);
            var H = D.minus(C);
            return [E.times(F),
                G.times(H),
                F.times(G),
                E.times(H)
            ];
        }

        function _xpt_double(pt1) {
            var x1 = pt1[0];
            var y1 = pt1[1];
            var z1 = pt1[2];
            var A = x1.times(x1);
            var B = y1.times(y1);
            var C = _TWO.times(z1).times(z1);
            var D = _Q.minus(A);
            var J = x1.plus(y1);
            var E = J.times(J).minus(A).minus(B);
            var G = D.plus(B);
            var F = G.minus(C);
            var H = D.minus(B);
            return [E.times(F),
                G.times(H),
                F.times(G),
                E.times(H)
            ];
        }

        function _xpt_mult(pt, n) {
            if (n.equals(_ZERO)) {
                return [_ZERO,
                    _ONE,
                    _ONE,
                    _ZERO
                ];
            }
            var odd = n.isOdd();
            n.shiftRight(1);
            var value = _xpt_double(_xpt_mult(pt, n));
            return odd ? _x_pt_add(value, pt) : value;
        }

        function _pt_xform(pt) {
            var x = pt[0];
            var y = pt[1];
            return [x,
                y,
                _ONE,
                x.times(y)
            ];
        }

        function _pt_unxform(pt) {
            var x = pt[0];
            var y = pt[1];
            var z = pt[2];
            var invz = z.inv();
            return [x.times(invz),
                y.times(invz)
            ];
        }

        function _scalarmult(pt, n) {
            return _pt_unxform(_xpt_mult(_pt_xform(pt), n));
        }

        function _bytesgetbit(bytes, n) {
            return (bytes[bytes.length - (n >>> 3) - 1] >> (n & 7)) & 1;
        }

        function _xpt_mult_bytes(pt, bytes) {
            var r = [
                _ZERO,
                _ONE,
                _ONE,
                _ZERO
            ];
            for (var i = (bytes.length << 3) - 1; i >= 0; i--) {
                r = _xpt_double(r);
                if (_bytesgetbit(bytes, i) === 1) {
                    r = _x_pt_add(r, pt);
                }
            }
            return r;
        }

        function _scalarmultBytes(pt, bytes) {
            return _pt_unxform(_xpt_mult_bytes(_pt_xform(pt), bytes));
        }
        var _by = _bi255(4).divide(_bi255(5));
        var _bx = _xrecover(_by);
        var _bp = [
            _bx,
            _by
        ];

        function _encodeint(n) {
            return n.bytes(32).reverse();
        }

        function _decodeint(b) {
            return _bi255(b.slice(0).reverse());
        }

        function _encodepoint(p) {
            var v = _encodeint(p[1]);
            if (p[0].isOdd()) {
                v[31] |= 128;
            }
            return v;
        }

        function _decodepoint(v) {
            v = v.slice(0);
            var signbit = v[31] >> 7;
            v[31] &= 127;
            var y = _decodeint(v);
            var x = _xrecover(y);
            if ((x.n[0] & 1) !== signbit) {
                x = _Q.minus(x);
            }
            var p = [
                x,
                y
            ];
            if (!_isoncurve(p)) {
                throw ('Point is not on curve');
            }
            return p;
        }
        // //////////////////////////////////////////////////
        /**
         * Factory function to create a suitable BigInteger.
         *
         * @param value
         *     The value for the big integer.
         * @param base {integer}
         *     Base of the conversion of elements in ``value``.
         * @returns
         *     A BigInteger object.
         */

        function _bi(value, base) {
            if (base !== undefined) {
                if (base === 256) {
                    return _bi(utils.string2bytes(value));
                }
                return new jsbn.BigInteger(value, base);
            } else if (typeof value === 'string') {
                return new jsbn.BigInteger(value, 10);
            } else if ((value instanceof Array) || (value instanceof Uint8Array)) {
                return new jsbn.BigInteger(value);
            } else if (typeof value === 'number') {
                return new jsbn.BigInteger(value.toString(), 10);
            } else {
                throw 'Can\'t convert ' + value + ' to BigInteger';
            }
        }

        function _bi2bytes(n, cnt) {
            if (cnt === undefined) {
                cnt = (n.bitLength() + 7) >>> 3;
            }
            var bytes = new Array(cnt);
            for (var i = cnt - 1; i >= 0; i--) {
                bytes[i] = n[0] & 255; // n.and(0xff);
                n = n.shiftRight(8);
            }
            return bytes;
        }
        jsbn.BigInteger.prototype.bytes = function(n) {
            return _bi2bytes(this, n);
        };
        // /////////////////////////////////////////////////////////
        function _bytehash(s) {
            return _bi2bytes(_bi(asmCrypto.SHA512.bytes(s)), 64).reverse();
        }

        function _stringhash(s) {
            return _map(_chr, _bi2bytes(_bi(asmCrypto.SHA512.bytes(s)), 64)).join('');
        }

        function _inthash(s) {
            // Need a leading 0 to prevent sign extension
            return _bi([0].concat(_bytehash(s)));
        }

        function _inthash_lo(s) {
            return _bi255(_bytehash(s).slice(32, 64));
        }

        function _inthash_mod_l(s) {
            return _inthash(s).mod(_L_BI);
        }

        function _get_a(sk) {
            var a = _inthash_lo(sk);
            a.n[0] &= 65528;
            a.n[15] &= 16383;
            a.n[15] |= 16384;
            return a;
        }

        function _publickey(sk) {
            return _encodepoint(_scalarmult(_bp, _get_a(sk)));
        }

        function _map(f, l) {
            var result = new Array(l.length);
            for (var i = 0; i < l.length; i++) {
                result[i] = f(l[i]);
            }
            return result;
        }

        function _chr(n) {
            return String.fromCharCode(n);
        }

        function _ord(c) {
            return c.charCodeAt(0);
        }

        function _pt_add(p1, p2) {
            return _pt_unxform(_x_pt_add(_pt_xform(p1), _pt_xform(p2)));
        }
        // Exports for the API.
        /**
         * Checks whether a point is on the curve.
         *
         * @function
         * @param point {string}
         *     The point to check for in a byte string representation.
         * @returns {boolean}
         *     true if the point is on the curve, false otherwise.
         */

        ns.isOnCurve = function(point) {
            try {
                _isoncurve(_decodepoint(utils.string2bytes(point)));
            } catch (e) {
                if (e === 'Point is not on curve') {
                    return false;
                } else {
                    throw e;
                }
            }
            return true;
        };
        /**
         * Computes the EdDSA public key.
         *
         * <p>Note: Seeds should be a byte string, not a unicode string containing
         * multi-byte characters.</p>
         *
         * @function
         * @param keySeed {string}
         *     Private key seed in the form of a byte string.
         * @returns {string}
         *     Public key as byte string computed from the private key seed
         *     (32 bytes).
         */
        ns.publicKey = function(keySeed) {
            return utils.bytes2string(_publickey(keySeed));
        };
        /**
         * Computes an EdDSA signature of a message.
         *
         * <p>Notes:</p>
         *
         * <ul>
         *   <li>Unicode messages need to be converted to a byte representation
         *   (e. g. UTF-8).</li>
         *   <li>If `pk` is given, and it is *not* a point of the curve, the signature
         *   will be faulty, but no error will be thrown.</li>
         * </ul>
         *
         * @function
         * @param message {string}
         *     Message in the form of a byte string.
         * @param keySeed {string}
         *     Private key seed in the form of a byte string.
         * @param publicKey {string}
         *     Public key as byte string (if not present, it will be computed from
         *     the private key seed).
         * @returns {string}
         *     Detached message signature in the form of a byte string (64 bytes).
         */
        ns.sign = function(message, keySeed, publicKey) {
            if (publicKey === undefined) {
                publicKey = _publickey(keySeed);
            } else {
                publicKey = utils.string2bytes(publicKey);
            }
            var a = _bi(_get_a(keySeed).toString(), 16);
            var hs = _stringhash(keySeed);
            var r = _bytehash(hs.slice(32, 64) + message);
            var rp = _scalarmultBytes(_bp, r);
            var erp = _encodepoint(rp);
            r = _bi(r).mod(_bi(1, 10).shiftLeft(512));
            var s = _map(_chr, erp).join('') + _map(_chr, publicKey).join('') + message;
            s = _inthash_mod_l(s).multiply(a).add(r).mod(_L_BI);
            return utils.bytes2string(erp.concat(_encodeint(s)));
        };
        /**
         * Verifies an EdDSA signature of a message with the public key.
         *
         * <p>Note: Unicode messages need to be converted to a byte representation
         * (e. g. UTF-8).</p>
         *
         * @function
         * @param signature {string}
         *     Message signature in the form of a byte string. Can be detached
         *     (64 bytes), or attached to be sliced off.
         * @param message {string}
         *     Message in the form of a byte string.
         * @param publicKey {string}
         *     Public key as byte string (if not present, it will be computed from
         *     the private key seed).
         * @returns {boolean}
         *     true, if the signature verifies.
         */
        ns.verify = function(signature, message, publicKey) {
            signature = utils.string2bytes(signature.slice(0, 64));
            publicKey = utils.string2bytes(publicKey);
            var rpe = signature.slice(0, 32);
            var rp = _decodepoint(rpe);
            var a = _decodepoint(publicKey);
            var s = _decodeint(signature.slice(32, 64));
            var h = _inthash(utils.bytes2string(rpe.concat(publicKey)) + message);
            var v1 = _scalarmult(_bp, s);
            var value = _scalarmultBytes(a, _bi2bytes(h));
            var v2 = _pt_add(rp, value);
            return v1[0].equals(v2[0]) && v1[1].equals(v2[1]);
        };
        /**
         * Generates a new random private key seed of 32 bytes length (256 bit).
         *
         * @function
         * @returns {string}
         *     Byte string containing a new random private key seed.
         */
        ns.generateKeySeed = core.generateKey;
        return ns;
    });
    /*
     * Copyright (c) 2014 Mega Limited
     * under the MIT License.
     *
     * Authors: Guy K. Kloss
     *
     * You should have received a copy of the license along with this program.
     */
    define('jodid25519', [
        'jodid25519/dh',
        'jodid25519/eddsa',
        'jodid25519/curve255',
        'jodid25519/utils',
    ], function(dh, eddsa, curve255, utils) {
        /**
         * @exports jodid25519
         * Curve 25519-based cryptography collection.
         *
         * @description
         * EC Diffie-Hellman (ECDH) based on Curve25519 and digital signatures
         * (EdDSA) based on Ed25519.
         */
        var ns = {};
        /** Module version indicator as string (format: [major.minor.patch]). */
        ns.VERSION = '0.7.0';
        ns.dh = dh;
        ns.eddsa = eddsa;
        ns.curve255 = curve255;
        ns.utils = utils;
        return ns;
    });
    // The modules for your project will be inlined above
    // this snippet. Ask almond to synchronously require the
    // module value for 'main' here and return it as the
    // value to use for the public API for the built file.
    return require('jodid25519');
}));
// See https://github.com/jrburke/almond#exporting-a-public-api
// global variables holding the user's identity
var u_handle; // user handle
var u_k; // master key
var u_k_aes; // master key AES engine
var u_p; // prepared password
var u_attr; // attributes
var u_privk; // private key
// log in
// returns user type if successful, false if not
// valid user types are: 0 - anonymous, 1 - email set, 2 - confirmed, but no RSA, 3 - complete
function u_login(ctx, email, password, uh, permanent) {
    ctx.result = u_login2;
    ctx.permanent = permanent;
    api_getsid(ctx, email, prepare_key_pw(password), uh);
}

function u_login2(ctx, ks) {
    if (ks !== false) {
        localStorage.wasloggedin = true;
        u_logout();
        u_storage = init_storage(ctx.permanent ? localStorage : sessionStorage);
        u_storage.k = JSON.stringify(ks[0]);
        u_storage.sid = ks[1];
        if (ks[2]) u_storage.privk = base64urlencode(crypto_encodeprivkey(ks[2]));
        u_checklogin(ctx, false);
    } else ctx.checkloginresult(ctx, false);
}
// if no valid session present, return false if force == false, otherwise create anonymous account and return 0 if successful or false if error;
// if valid session present, return user type

function u_checklogin(ctx, force, passwordkey, invitecode, invitename, uh) {
    if (u_sid = u_storage.sid) {
        api_setsid(u_sid);
        u_checklogin3(ctx);
    } else {
        if (!force) ctx.checkloginresult(ctx, false);
        else {
            u_logout();
            api_create_u_k();
            ctx.createanonuserresult = u_checklogin2;
            createanonuser(ctx, passwordkey, invitecode, invitename, uh);
        }
    }
}

function u_checklogin2(ctx, u) {
    if (u === false) ctx.checkloginresult(ctx, false);
    else {
        ctx.result = u_checklogin2a;
        api_getsid(ctx, u, ctx.passwordkey);
    }
}

function u_checklogin2a(ctx, ks) {
    if (ks === false) ctx.checkloginresult(ctx, false);
    else {
        u_k = ks[0];
        u_sid = ks[1];
        api_setsid(u_sid);
        u_storage.k = JSON.stringify(u_k);
        u_storage.sid = u_sid;
        u_checklogin3(ctx);
    }
}

function u_checklogin3(ctx) {
    ctx.callback = u_checklogin3a;
    api_getuser(ctx);
}

function u_checklogin3a(res, ctx) {
    var r = false;
    if (typeof res != 'object') {
        u_logout();
        r = res;
    } else {
        u_attr = res;
        var exclude = [
            'c',
            'email',
            'k',
            'name',
            'p',
            'privk',
            'pubk',
            's',
            'ts',
            'u',
            'currk'
        ];
        for (var n in u_attr) {
            if (exclude.indexOf(n) == -1) {
                try {
                    u_attr[n] = from8(base64urldecode(u_attr[n]));
                } catch (e) {
                    u_attr[n] = base64urldecode(u_attr[n]);
                }
            }
        }
        u_storage.attr = JSON.stringify(u_attr);
        u_storage.handle = u_handle = u_attr.u;
        try {
            u_k = JSON.parse(u_storage.k);
            if (u_attr.privk) u_privk = crypto_decodeprivkey(base64urldecode(u_storage.privk));
        } catch (e) {}
        u_k_aes = new sjcl.cipher.aes(u_k);
        if (!u_attr.email) r = 0;
        else if (!u_attr.c) r = 1;
        else if (!u_attr.privk) r = 2;
        else r = 3;
        if (r == 3) u_ed25519();
    }
    ctx.checkloginresult(ctx, r);
}
// erase all local user/session information

function u_logout(logout) {
    var a = [
        localStorage,
        sessionStorage
    ];
    for (var i = 2; i--;) {
        a[i].removeItem('sid');
        a[i].removeItem('k');
        a[i].removeItem('p');
        a[i].removeItem('handle');
        a[i].removeItem('attr');
        a[i].removeItem('privk');
        a[i].removeItem('keyring');
        a[i].removeItem('puEd255');
        a[i].removeItem('randseed');
    }
    if (logout) {
        delete localStorage.signupcode;
        delete localStorage.registeremail;
        if (mDBact) {
            mDBact = false;
            localStorage[u_handle + '_mDBactive'];
        }
        fminitialized = false;
        notifications = u_sid = u_handle = u_k = u_attr = u_privk = u_k_aes = undefined;
        api_setsid(false);
        u_sharekeys = {};
        u_nodekeys = {};
        u_type = false;
        loggedout = true;
        $('#fmholder').html('');
        $('#fmholder').attr('class', 'fmholder');
        M = new MegaData();
        mDBloaded = {
            'ok': 0,
            'u': 0,
            'f_sk': 0,
            'f': 0,
            's': 0
        };
        $.hideContextMenu = function() {};
        api_reset();
    }
}
// true if user was ever logged in with a non-anonymous account

function u_wasloggedin() {
    return localStorage.wasloggedin;
}
// set user's RSA key

function u_setrsa(rsakey) {
    var ctx = {
        callback: function(res, ctx) {
            if (d) console.log('RSA key put result=' + res);
            u_privk = rsakey;
            u_storage.privk = base64urlencode(crypto_encodeprivkey(rsakey));
            u_type = 3;
            ui_keycomplete();
        }
    };
    api_req({
        a: 'up',
        privk: a32_to_base64(encrypt_key(u_k_aes, str_to_a32(crypto_encodeprivkey(rsakey)))),
        pubk: base64urlencode(crypto_encodepubkey(rsakey))
    }, ctx);
}
// ensures that a user identity exists, also sets sid

function createanonuser(ctx, passwordkey, invitecode, invitename, uh) {
    ctx.callback = createanonuser2;
    ctx.passwordkey = passwordkey;
    api_createuser(ctx, invitecode, invitename, uh);
}

function createanonuser2(u, ctx) {
    if (u === false || !(localStorage.p = ctx.passwordkey) || !(localStorage.handle = u)) u = false;
    ctx.createanonuserresult(ctx, u);
}

function setpwreq(newpw, ctx) {
    var pw_aes = new sjcl.cipher.aes(prepare_key_pw(newpw));
    api_req({
        a: 'upkm',
        k: a32_to_base64(encrypt_key(pw_aes, u_k)),
        uh: stringhash(u_attr['email'].toLowerCase(), pw_aes)
    }, ctx);
}

function setpwset(confstring, ctx) {
    api_req({
        a: 'up',
        uk: confstring
    }, ctx);
}

function changepw(currentpw, newpw, ctx) {
    var pw_aes = new sjcl.cipher.aes(prepare_key_pw(newpw));
    api_req({
        a: 'up',
        currk: a32_to_base64(encrypt_key(new sjcl.cipher.aes(prepare_key_pw(currentpw)), u_k)),
        k: a32_to_base64(encrypt_key(pw_aes, u_k)),
        uh: stringhash(u_attr['email'].toLowerCase(), pw_aes)
    }, ctx);
}
// an anonymous account must be present - check / create before calling

function sendsignuplink(name, email, password, ctx) {
    var pw_aes = new sjcl.cipher.aes(prepare_key_pw(password));
    var req = {
        a: 'uc',
        c: base64urlencode(a32_to_str(encrypt_key(pw_aes, u_k)) + a32_to_str(encrypt_key(pw_aes, [
            rand(4294967296),
            0,
            0,
            rand(4294967296)
        ]))),
        n: base64urlencode(to8(name)),
        m: base64urlencode(email)
    };
    api_req(req, ctx);
}

function verifysignupcode(code, ctx) {
    var req = {
        a: 'ud',
        c: code
    };
    ctx.callback = verifysignupcode2;
    api_req(req, ctx);
}
var u_signupenck;
var u_signuppwcheck;

function verifysignupcode2(res, ctx) {
    if (typeof res == 'object') {
        u_signupenck = base64_to_a32(res[3]);
        u_signuppwcheck = base64_to_a32(res[4]);
        ctx.signupcodeok(base64urldecode(res[0]), base64urldecode(res[1]));
    } else ctx.signupcodebad(res);
}

function checksignuppw(password) {
    var pw_aes = new sjcl.cipher.aes(prepare_key_pw(password));
    var t = decrypt_key(pw_aes, u_signuppwcheck);
    if (t[1] || t[2]) return false;
    u_k = decrypt_key(pw_aes, u_signupenck);
    return true;
}

function checkquota(ctx) {
    var req = {
        a: 'uq',
        xfer: 1
    };
    api_req(req, ctx);
}

function processquota1(res, ctx) {
    if (typeof res == 'object') {
        if (res.tah) {
            var i;
            var tt = 0;
            var tft = 0;
            var tfh = -1;
            for (i = 0; i < res.tah.length; i++) {
                tt += res.tah[i];
                if (tfh < 0) {
                    tft += res.tah[i];
                    if (tft > 1048576) tfh = i;
                }
            }
            ctx.processquotaresult(ctx, [
                tt,
                tft, (6 - tfh) * 3600 - res.bt,
                res.tar,
                res.tal
            ]);
        } else ctx.processquotaresult(ctx, false);
    }
}
/**
 * Retrieves a user attribute.
 *
 * @param userhandle {string}
 *     Mega's internal user handle.
 * @param attribute {string}
 *     Name of the attribute.
 * @param pub {bool}
 *     True for public attributes (default: true).
 * @param callback {function}
 *     Callback function to call upon completion (default: none).
 * @param ctx {object}
 *     Context, in case higher hierarchies need to inject a context
 *     (default: none).
 */

function getUserAttribute(userhandle, attribute, pub, callback, ctx) {
    if (pub === true || pub === undefined) {
        attribute = '+' + attribute;
    } else {
        attribute = '*' + attribute;
    }
    // Assemble context for this async API request.

    var myCtx = ctx || {};
    myCtx.u = userhandle;
    myCtx.ua = attribute;
    myCtx.callback = function(res, ctx) {
        if (typeof res !== 'number') {
            // Decrypt if it's a private attribute container.
            var value = res;
            if (ctx.ua.charAt(0) === '*') {
                var clearContainer = tlvstore.blockDecrypt(base64urldecode(res), u_k);
                value = tlvstore.tlvRecordsToContainer(clearContainer);
            }
            if (d) {
                console.log('Attribute "' + ctx.ua + '" for user "' + ctx.u + '" is "' + value + '".');
            }
            if (ctx.callback2) {
                ctx.callback2(value, ctx);
            }
        } else {
            if (d) {
                console.log('Error retrieving attribute "' + ctx.ua + '" for user "' + ctx.u + '": ' + res + '!');
            }
            if (ctx.callback2) {
                ctx.callback2(res, ctx);
            }
        }
    };
    myCtx.callback2 = callback;
    // Fire it off.
    api_req({
        'a': 'uga',
        'u': userhandle,
        'ua': attribute
    }, myCtx);
}
/**
 * Stores a user attribute for oneself.
 *
 * @param attribute {string}
 *     Name of the attribute.
 * @param value {object}
 *     Value of the user attribute. Public properties are of type {string},
 *     private ones have to be an object with key/value pairs.
 * @param pub {bool}
 *     True for public attributes (default: true).
 * @param callback {function}
 *     Callback function to call upon completion (default: none). This callback
 *     function expects two parameters: the attribute `name`, and its `value`.
 *     In case of an error, the `value` will be undefined.
 * @param mode {integer}
 *     Encryption mode. One of BLOCK_ENCRYPTION_SCHEME (default: AES_CCM_12_16).
 */

function setUserAttribute(attribute, value, pub, callback, mode) {
    if (mode === undefined) {
        mode = tlvstore.BLOCK_ENCRYPTION_SCHEME.AES_CCM_12_16;
    }
    if (pub === true || pub === undefined) {
        attribute = '+' + attribute;
    } else {
        attribute = '*' + attribute;
        // The value should be a key/value property container. Let's encode and
        // encrypt it.
        value = base64urlencode(tlvstore.blockEncrypt(tlvstore.containerToTlvRecords(value), u_k, mode));
    }
    // Assemble context for this async API request.

    var myCtx = {
        callback: function(res, ctx) {
            if (d) {
                if (typeof res !== 'number') {
                    console.log('Setting user attribute "' + ctx.ua + '", result: ' + res);
                } else {
                    console.log('Error setting user attribute "' + ctx.ua + '", result: ' + res + '!');
                }
            }
            if (ctx.callback2) {
                ctx.callback2(res, ctx);
            }
        },
        ua: attribute,
        callback2: callback,
    };
    if (callback) {
        myCtx['callback2'] = callback;
    }
    // Fire it off.

    var apiCall = {
        'a': 'up'
    };
    apiCall[attribute] = value;
    api_req(apiCall, myCtx);
}

function s2hex(s) {
    var result = '';
    for (var i = 0; i < s.length; i++) {
        c = s.charCodeAt(i);
        result += ((c < 16) ? '0' : '') + c.toString(16);
    }
    return result;
}

function hex2s(hex) {
    var r = '';
    if (hex.indexOf('0x') == 0 || hex.indexOf('0X') == 0) hex = hex.substr(2);
    if (hex.length % 2) hex += '0';
    for (var i = 0; i < hex.length; i += 2)
        r += String.fromCharCode(parseInt(hex.slice(i, i + 2), 16));
    return r;
}
var inherits = (function() {
    var createObject = Object.create || function createObject(source) {
        var Host = function() {};
        Host.prototype = source;
        return new Host();
    };
    return function(destination, source) {
        var proto = destination.prototype = createObject(source.prototype);
        proto.constructor = destination;
        proto._super = source.prototype;
    }
})();
/**
 *	Cascade:
 *
 *	Tiny helper to queue related tasks, in which the output of one function
 *	is the input of the next task. It is asynchronous
 *
 *		function([prevarg, arg], next)
 *
 *	Author: @crodas
 */
function Cascade(tasks, fnc, done, value) {
    function scheduler(value) {
        if (tasks.length == 0) {
            return done(value);
        }
        fnc([value,
            tasks.shift()
        ], scheduler)
    }
    scheduler(value);
}
/**
 *	Simple interface to run things in parallel (safely) once, and
 *	get a safe callback
 *
 *	Author: @crodas
 */

function Parallel(task) {
    var callbacks = {};
    return function(args, next) {
        var id = JSON.stringify(args)
        if (callbacks[id]) {
            return callbacks[id].push(next);
        }
        callbacks[id] = [
            next
        ];
        task(args, function() {
            var args = arguments;
            $.each(callbacks[id], function(i, next) {
                next.apply(null, args);
            });
            delete callbacks[id];
        });
    };
}

function safeCall(fn) {
    fn.foo = function __safeCallWrapper() {
        try {
            return fn.apply(this, arguments);
        } catch (e) {
            console.error(e);
        }
    };
    fn.foo.bar = fn;
    return fn.foo;
}

function asciionly(text) {
    var rforeign = /[^\u0000-\u007f]/;
    if (rforeign.test(text)) return false;
    else return true;
}

function Later(callback) {
    return setTimeout(callback, 1000);
}
var Soon = is_chrome_firefox ? mozRunAsync : function(callback) {
    setTimeout(callback, 17);
};

function SoonFc(func, ms) {
    return function __soonfc() {
        var self = this,
            args = arguments;
        if (func.__sfc) clearTimeout(func.__sfc);
        func.__sfc = setTimeout(function() {
            delete func.__sfc;
            func.apply(self, args);
        }, ms || 122);
    };
}

function jScrollFade(id) {
    $(id + ' .jspTrack').unbind('mouseover');
    $(id + ' .jspTrack').bind('mouseover', function(e) {
        $(this).find('.jspDrag').addClass('jspActive');
        $(this).closest('.jspContainer').uniqueId();
        jScrollFadeOut($(this).closest('.jspContainer').attr('id'));
    });
    if (!$.jScroll) $.jScroll = {};
    for (var i in $.jScroll)
        if ($.jScroll[i] == 0) delete $.jScroll[i];
    $(id).unbind('jsp-scroll-y.fade');
    $(id).bind('jsp-scroll-y.fade', function(event, scrollPositionY, isAtTop, isAtBottom) {
        $(this).find('.jspDrag').addClass('jspActive');
        $(this).find('.jspContainer').uniqueId();
        var id = $(this).find('.jspContainer').attr('id');
        jScrollFadeOut(id);
    });
}

function jScrollFadeOut(id) {
    if (!$.jScroll[id]) $.jScroll[id] = 0;
    $.jScroll[id]++;
    setTimeout(function(id) {
        $.jScroll[id]--;
        if ($.jScroll[id] == 0) $('#' + id + ' .jspDrag').removeClass('jspActive');
    }, 500, id);
}

function inputfocus(id, defaultvalue, pw) {
    if (pw) $('#' + id)[0].type = 'password';
    if ($('#' + id)[0].value == defaultvalue) $('#' + id)[0].value = '';
}

function inputblur(id, defaultvalue, pw) {
    if ($('#' + id)[0].value == '') $('#' + id)[0].value = defaultvalue;
    if (($('#' + id)[0].value == defaultvalue) && (pw)) $('#' + id)[0].type = 'text';
}

function easeOutCubic(t, b, c, d) {
    return c * ((t = t / d - 1) * t * t + 1) + b;
}

function ellipsis(text, location, maxCharacters) {
    if (text.length > 0 && text.length > maxCharacters) {
        if (typeof(location) == 'undefined') location = 'end';
        switch (location) {
            case 'center':
                var center = (maxCharacters / 2);
                text = text.slice(0, center) + '...' + text.slice(-center);
                break;
            case 'end':
                text = text.slice(0, maxCharacters - 3) + '...';
                break;
        }
    }
    return text;
}

function translate(html) {
    var arr = html.split('[$');
    var items = [];
    for (var i in arr) {
        var tmp = arr[i].split(']');
        if (tmp.length > 1) {
            var t = tmp[0];
            items.push(t);
        }
    }
    for (var i in items) {
        var tmp = items[i].split('.');
        if (tmp.length > 1) {
            if (tmp[1] == 'dq') {
                l[items[i]] = l[tmp[0]].replace('"', '&quot;');
            } else if (tmp[1] == 'q') {
                l[items[i]] = l[tmp[0]].replace('\'', '\\\'');
            } else if (tmp[1] == 'dqq') {
                l[items[i]] = l[tmp[0]].replace('\'', '\\\'');
                l[items[i]] = l[items[i]].replace('"', '&quot;');
            }
        }
        html = html.replace(new RegExp('\\[\\$' + items[i] + '\\]', 'g'), l[items[i]]);
    }
    return html;
}

function megatitle(nperc) {
    if (!nperc) nperc = '';
    var a = parseInt($('.notification-num').text());
    if (a > 0) a = '(' + a + ') ';
    else a = '';
    if (document.title != a + 'MEGA' + nperc) document.title = a + 'MEGA' + nperc;
}

function populate_l() {
    l[0] = 'Mega Limited ' + new Date().getFullYear();
    if ((lang == 'es') || (lang == 'pt') || (lang == 'sk')) l[0] = 'Mega Ltd.';
    l[1] = l[398];
    if (lang == 'en') l[1] = 'Go Pro';
    l[438] = l[438].replace('[X]', '');
    l['439a'] = l[439];
    l[439] = l[439].replace('[X1]', '').replace('[X2]', '');
    l['466a'] = l[466];
    l[466] = l[466].replace('[X]', '');
    l[543] = l[543].replace('[X]', '');
    l[456] = l[456].replace(':', '');
    l['471a'] = l[471].replace('[X]', 10);
    l['471b'] = l[471].replace('[X]', 100);
    l['471c'] = l[471].replace('[X]', 250);
    l['471d'] = l[471].replace('[X]', 500);
    l['471e'] = l[471].replace('[X]', 1000);
    l['469a'] = l[469].replace('[X]', 10);
    l['469b'] = l[469].replace('[X]', 100);
    l['469c'] = l[469].replace('[X]', 250);
    l['472a'] = l[472].replace('[X]', 10);
    l['472b'] = l[472].replace('[X]', 100);
    l['472c'] = l[472].replace('[X]', 250);
    l['208a'] = l[208].replace('[A]', '<a href="#terms" class="red">');
    l['208a'] = l['208a'].replace('[/A]', '</a>');
    l[208] = l[208].replace('[A]', '<a href="#terms">');
    l[208] = l[208].replace('[/A]', '</a>');
    l[517] = l[517].replace('[A]', '<a href="#help">').replace('[/A]', '</a>');
    l[521] = l[521].replace('[A]', '<a href="#copyright">').replace('[/A]', '</a>');
    l[553] = l[553].replace('[A]', '<a href="mailto:resellers@mega.co.nz">').replace('[/A]', '</a>');
    l[555] = l[555].replace('[A]', '<a href="#terms">').replace('[/A]', '</a>');
    l[754] = l[754].replace('[A]', '<a href="http://www.google.com/chrome" target="_blank" style="color:#D9290B;">');
    l[754] = l[754].replace('[/A]', '</a>');
    l[871] = l[871].replace('[B]', '<strong>').replace('[/B]', '</strong>').replace('[A]', '<a href="#pro">').replace('[/A]', '</a>');
    l[924] = l[924].replace('[A]', '<span class="red">').replace('[/A]', '</span>');
    l[501] = l[501].replace('17', '').replace('%', '');
    l[1066] = l[1066].replace('[A]', '<a class="red">').replace('[/A]', '</a>');
    l[1067] = l[1067].replace('[A]', '<span class="red">').replace('[/A]', '</span>');
    l[1094] = l[1094].replace('[A]', '<a href="#plugin">').replace('[/A]', '</a>');
    l[1095] = l[1095].replace('[A]', '<span class="red">').replace('[/A]', '</span>');
    l[1133] = l[1133].replace('[A]', '<a href="http://en.wikipedia.org/wiki/Entropy" target="_blank">').replace('[/A]', '</a>');
    l[1134] = l[1134].replace('[A]', '<a href="http://en.wikipedia.org/wiki/Public-key_cryptography" target="_blank">').replace('[/A]', '</a>');
    l[1148] = l[1148].replace('[A]', '<span class="red">').replace('[/A]', '</span>');
    l[1151] = l[1151].replace('[A]', '<span class="red">').replace('[/A]', '</span>');
    l[731] = l[731].replace('[A]', '<a href="#terms">').replace('[/A]', '</a>');
    if (lang == 'en') l[965] = 'Legal & policies';
    l[1159] = l[1159].replace('[A]', '<span class="red">').replace('[/A]', '</span>');
    l[1171] = l[1171].replace('[A]', '<span class="red">').replace('[/A]', '</span>');
    l[1185] = l[1185].replace('[X]', '<strong>MEGA.crx</strong>');
    l[1242] = l[1242].replace('[A]', '<a href="#affiliateterms" target="_blank">').replace('[/A]', '</a>');
    l[1218] = l[1218].replace('[A]', '<a href="#affiliateterms" class="red">').replace('[/A]', '</a>');
    l[1212] = l[1212].replace('[A]', '<a href="#sdk" class="red">').replace('[/A]', '</a>');
    l[1274] = l[1274].replace('[A]', '<a href="#takedown">').replace('[/A]', '</a>');
    l[1275] = l[1275].replace('[A]', '<a href="#copyright">').replace('[/A]', '</a>');
    l[1244] = l[1244].replace('[A]', '<a href="#affiliateterms" class="red">').replace('[/A]', '</a>');
    l[1201] = l[1201].replace('[A]', '<span class="red">').replace('[/A]', '</span>');
    l[1208] = l[1208].replace('[B]', '<strong>').replace('[/B]', '</strong>');
    l[1915] = l[1915].replace('[A]', '<a class="red" href="https://chrome.google.com/webstore/detail/mega/bigefpfhnfcobdlfbedofhhaibnlghod" target="_blank">').replace('[/A]', '</a>');
    l[1936] = l[1936].replace('[A]', '<a href="#backup">').replace('[/A]', '</a>');
    l[1942] = l[1942].replace('[A]', '<a href="#backup">').replace('[/A]', '</a>');
    l[1943] = l[1943].replace('[A]', '<a href="mailto:support@mega.co.nz">').replace('[/A]', '</a>');
    l[1948] = l[1948].replace('[A]', '<a href="mailto:support@mega.co.nz">').replace('[/A]', '</a>');
    l[1957] = l[1957].replace('[A]', '<a href="#recovery">').replace('[/A]', '</a>');
    l[1965] = l[1965].replace('[A]', '<a href="#recovery">').replace('[/A]', '</a>');
    l[1982] = l[1982].replace('[A]', '<font style="color:#D21F00;">').replace('[/A]', '</font>');
    l[1993] = l[1993].replace('[A]', '<span class="red">').replace('[/A]', '</span>');
    l['year'] = new Date().getFullYear();
}

function GetNextNode(labelid) {
    var label = document.getElementById(labelid);
    var select_id = document.getElementById(labelid + '_option');
    label.innerHTML = select_id.options[select_id.selectedIndex].text;
    return select_id.options[select_id.selectedIndex].value;
}

function showmoney(number) {
    var number = number.toString(),
        dollars = number.split('.')[0],
        cents = (number.split('.')[1] || '') + '00';
    dollars = dollars.split('').reverse().join('').replace(/(\d{3}(?!$))/g, '$1,').split('').reverse().join('');
    return dollars + '.' + cents.slice(0, 2);
}

function getHeight() {
    var myHeight = 0;
    if (typeof(window.innerWidth) == 'number') myHeight = window.innerHeight;
    else if (document.documentElement && (document.documentElement.clientWidth || document.documentElement.clientHeight)) myHeight = document.documentElement.clientHeight;
    else if (document.body && (document.body.clientWidth || document.body.clientHeight)) myHeight = document.body.clientHeight;
    return myHeight;
}

function divscroll(el) {
    document.getElementById(el).scrollIntoView();
    $('body').scrollLeft(0);
    $('html').scrollTop(0);
    if (page == 'start') start_menu(el);
}

function removeHash() {
    var scrollV,
        scrollH,
        loc = window.location;
    if ('pushState' in history)
        history.pushState('', document.title, loc.pathname + loc.search);
    else {
        // Prevent scrolling by storing the page's current scroll offset
        scrollV = document.body.scrollTop;
        scrollH = document.body.scrollLeft;
        loc.hash = '';
        // Restore the scroll offset, should be flicker free
        document.body.scrollTop = scrollV;
        document.body.scrollLeft = scrollH;
    }
}

function browserdetails(useragent) {
    useragent = ' ' + useragent;
    var os = false;
    var browser = false;
    var icon = '';
    var name = '';
    if (useragent.toLowerCase().indexOf('android') > 0) os = 'Android';
    else if (useragent.toLowerCase().indexOf('windows') > 0) os = 'Windows';
    else if (useragent.toLowerCase().indexOf('iphone') > 0) os = 'iPhone';
    else if (useragent.toLowerCase().indexOf('imega') > 0) os = 'iPhone';
    else if (useragent.toLowerCase().indexOf('ipad') > 0) os = 'iPad';
    else if (useragent.toLowerCase().indexOf('mac') > 0) os = 'Apple';
    else if (useragent.toLowerCase().indexOf('linux') > 0) os = 'Linux';
    else if (useragent.toLowerCase().indexOf('linux') > 0) os = 'MEGAsync';
    else if (useragent.toLowerCase().indexOf('blackberry') > 0) os = 'Blackberry';
    if (useragent.toLowerCase().indexOf('chrome') > 0) browser = 'Chrome';
    else if (useragent.toLowerCase().indexOf('safari') > 0) browser = 'Safari';
    else if (useragent.toLowerCase().indexOf('opera') > 0) browser = 'Opera';
    else if (useragent.toLowerCase().indexOf('firefox') > 0) browser = 'Firefox';
    else if (useragent.toLowerCase().indexOf('msie') > 0) browser = 'Internet Explorer';
    else if (useragent.toLowerCase().indexOf('megasync') > 0) browser = 'MEGAsync';
    if ((os) && (browser)) {
        name = browser + ' on ' + os;
        if (browser == 'Internet Explorer') icon = 'ie.png';
        else icon = browser.toLowerCase() + '.png';
    } else if (os) {
        name = os;
        icon = os.toLowerCase() + '.png';
    } else if (browser) {
        name = browser;
        if (browser == 'Internet Explorer') icon = 'ie.png';
        else icon = browser.toLowerCase() + '.png';
    } else {
        name = 'Unknown';
        icon = 'unknown.png';
    }
    var browserdetails = {};
    browserdetails.name = name;
    browserdetails.icon = icon;
    return browserdetails;
}

function countrydetails(isocode) {
    var cdetails = {
        name: isocountries[isocode],
        icon: isocode.toLowerCase() + '.gif'
    };
    return cdetails;
}

function time2date(unixtime, ignoretime) {
    var MyDate = new Date(unixtime * 1000);
    var MyDateString =
        MyDate.getFullYear() + '-' + ('0' + (MyDate.getMonth() + 1)).slice(-2) + '-' + ('0' + MyDate.getDate()).slice(-2);
    if (!ignoretime) {
        MyDateString += ' ' + ('0' + MyDate.getHours()).slice(-2) + ':' + ('0' + MyDate.getMinutes()).slice(-2);
    }
    return MyDateString;
}
var date_months = [
    l[408],
    l[409],
    l[410],
    l[411],
    l[412],
    l[413],
    l[414],
    l[415],
    l[416],
    l[417],
    l[418],
    l[419]
];

function acc_time2date(unixtime) {
    var MyDate = new Date(unixtime * 1000);
    var th = 'th';
    if ((parseInt(MyDate.getDate()) == 11) || (parseInt(MyDate.getDate()) == 12)) {} else if (('' + MyDate.getDate()).slice(-1) == '1') th = 'st';
    else if (('' + MyDate.getDate()).slice(-1) == '2') th = 'nd';
    if (lang !== 'en') th = ',';
    return date_months[MyDate.getMonth()] + ' ' + MyDate.getDate() + th + ' ' + MyDate.getFullYear();
}

function time2last(timestamp) {
    var sec = (new Date().getTime() / 1000) - timestamp;
    if (sec < 4) return l[880];
    else if (sec < 59) return l[873].replace('[X]', Math.ceil(sec));
    else if (sec < 90) return l[874];
    else if (sec < 3540) return l[875].replace('[X]', Math.ceil(sec / 60));
    else if (sec < 4500) return l[876];
    else if (sec < 82000) return l[877].replace('[X]', Math.ceil(sec / 3600));
    else if (sec < 110000) return l[878];
    else return l[879].replace('[X]', Math.ceil(sec / 86400));
}

function uplpad(number, length) {
    var str = '' + number;
    while (str.length < length) {
        str = '0' + str;
    }
    return str;
}

function secondsToTime(secs) {
    if (isNaN(secs)) return '--:--:--';
    if (secs < 0) return '';
    var hours = uplpad(Math.floor(secs / (60 * 60)), 2);
    var divisor_for_minutes = secs % (60 * 60);
    var minutes = uplpad(Math.floor(divisor_for_minutes / 60), 2);
    var divisor_for_seconds = divisor_for_minutes % 60;
    var seconds = uplpad(Math.floor(divisor_for_seconds), 2);
    var returnvar = hours + ':' + minutes + ':' + seconds;
    return returnvar;
}

function htmlentities(value) {
    if (!value) return '';
    return $('<div/>').text(value).html();
}

function bytesToSize(bytes, precision) {
    if (!bytes) return '0';
    var s_b = 'B';
    var s_kb = 'KB';
    var s_mb = 'MB';
    var s_gb = 'GB';
    var s_tb = 'TB';
    if (lang == 'fr') {
        s_b = 'O';
        s_kb = 'Ko';
        s_mb = 'Mo';
        s_gb = 'Go';
        s_tb = 'To';
    }
    var kilobyte = 1024;
    var megabyte = kilobyte * 1024;
    var gigabyte = megabyte * 1024;
    var terabyte = gigabyte * 1024;
    if (bytes > 1024 * 1024 * 1024) precision = 2;
    else if (bytes > 1024 * 1024) precision = 1;
    if ((bytes >= 0) && (bytes < kilobyte)) return parseInt(bytes) + ' ' + s_b;
    else if ((bytes >= kilobyte) && (bytes < megabyte)) return (bytes / kilobyte).toFixed(precision) + ' ' + s_kb;
    else if ((bytes >= megabyte) && (bytes < gigabyte)) return (bytes / megabyte).toFixed(precision) + ' ' + s_mb;
    else if ((bytes >= gigabyte) && (bytes < terabyte)) return (bytes / gigabyte).toFixed(precision) + ' ' + s_gb;
    else if (bytes >= terabyte) return (bytes / terabyte).toFixed(precision) + ' ' + s_tb;
    else return parseInt(bytes) + ' ' + s_b;
}

function checkPassword(strPassword) {
    var m_strUpperCase = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
    var m_strLowerCase = 'abcdefghijklmnopqrstuvwxyz';
    var m_strNumber = '0123456789';
    var m_strCharacters = '!@#$%^&*?_~';
    var nScore = 0;
    nScore += countDif(strPassword) * 2;
    var extra = countDif(strPassword) * strPassword.length / 3;
    if (extra > 25) extra = 25;
    nScore += extra;
    var nUpperCount = countContain(strPassword, m_strUpperCase);
    var nLowerCount = countContain(strPassword, m_strLowerCase);
    var nLowerUpperCount = nUpperCount + nLowerCount;
    if (nUpperCount == 0 && nLowerCount != 0) nScore += 10;
    else if (nUpperCount != 0 && nLowerCount != 0) nScore += 10;
    var nNumberCount = countContain(strPassword, m_strNumber);
    if (nNumberCount == 1) nScore += 10;
    if (nNumberCount >= 3) nScore += 15;
    var nCharacterCount = countContain(strPassword, m_strCharacters);
    if (nCharacterCount == 1) nScore += 10;
    if (nCharacterCount > 1) nScore += 10;
    if (nNumberCount != 0 && nLowerUpperCount != 0) nScore += 2;
    if (nNumberCount != 0 && nLowerUpperCount != 0 && nCharacterCount != 0) nScore += 3;
    if (nNumberCount != 0 && nUpperCount != 0 && nLowerCount != 0 && nCharacterCount != 0) nScore += 5;
    return nScore;
}

function countDif(strPassword) {
    var chararr = [];
    var nCount = 0;
    for (i = 0; i < strPassword.length; i++) {
        if (!chararr[strPassword.charAt(i)]) {
            chararr[strPassword.charAt(i)] = true;
            nCount++;
        }
    }
    return nCount;
}

function countContain(strPassword, strCheck) {
    var nCount = 0;
    for (i = 0; i < strPassword.length; i++) {
        if (strCheck.indexOf(strPassword.charAt(i)) > -1) nCount++;
    }
    return nCount;
}

function logincheckboxCheck(ch_id) {
    var ch_div = ch_id + '_div';
    if (document.getElementById(ch_id).checked) document.getElementById(ch_div).className = 'checkboxOn';
    else document.getElementById(ch_div).className = 'checkboxOff';
}

function makeid(len) {
    var text = '';
    var possible = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
    for (var i = 0; i < len; i++)
        text += possible.charAt(Math.floor(Math.random() * possible.length));
    return text;
}

function checkMail(email) {
    email = email.replace('+', '');
    var filter = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;
    if (filter.test(email)) return false;
    else return true;
}

function NOW() {
    return Date.now();
}
/**
 *	Global function to help debugging
 */

function DEBUG2() {
    if (d) {
        console.warn.apply(console, arguments)
    }
}

function ERRDEBUG() {
    if (d) {
        console.error.apply(console, arguments)
    }
}

function DEBUG() {
    if (d) {
        (console.debug || console.log).apply(console, arguments)
    }
}

function ASSERT(what, msg, udata) {
    if (!what) {
        var af = new Error('failed assertion; ' + msg);
        if (udata) af.udata = udata;
        Soon(function() {
            throw af;
        });
        if (console.assert) console.assert(what, msg);
        else console.error('FAILED ASSERTION', msg);
    }
}

function oDestroy(obj) {
    if (d) ASSERT(Object.isFrozen(obj) === false, 'Object already frozen...');
    Object.keys(obj).forEach(function(memb) {
        if (obj.hasOwnProperty(memb)) delete obj[memb];
    });
    if (d) Object.freeze(obj);
}
/**
 *	Return a default callback for error handlign
 */

function dlError(text) {
    return function(e) {
        console.log(text + ' ' + e);
        alert(text + ' ' + e);
    };
}
/**
 *	Remove an element from an *array*
 */

function removeValue(array, value, can_fail) {
    var idx = array.indexOf(value);
    ASSERT(can_fail || idx != -1, 'Unable to Remove Value ' + value);
    if (idx != -1) array.splice(idx, 1);
    return idx != -1;
}

function setTransferStatus(dl, status, ethrow, lock) {
    var id = dl && DownloadManager.GetGID(dl);
    var text = '' + status;
    if (text.length > 44) text = text.substr(0, 42) + '...';
    $('.transfer-table #' + id + ' td:eq(3)').text(text);
    if (lock) $('.transfer-table #' + id).attr('id', 'LOCKed_' + id);
    if (d) console.error(status);
    if (ethrow) throw status;
}

function dlFatalError(dl, error, ethrow) {
    var m = 'This issue should be resolved ';
    if (navigator.webkitGetUserMedia) {
        m += 'exiting from Incognito mode.';
    } else if (navigator.msSaveOrOpenBlob) {
        Later(browserDialog);
        m = l[1933];
    } else {
        Later(firefoxDialog);
        // m += 'installing our extension.'
        m = l[1932];
    }
    msgDialog('warninga', l[1676], m, error);
    setTransferStatus(dl, error, ethrow, true);
    DownloadManager.abort(dl);
}
/**
 * JS Implementation of MurmurHash3 (r136) (as of May 20, 2011)
 *
 * @author <a href="mailto:gary.court.gmail.com">Gary Court</a>
 * @see http://github.com/garycourt/murmurhash-js
 * @author <a href="mailto:aappleby.gmail.com">Austin Appleby</a>
 * @see http://sites.google.com/site/murmurhash/
 *
 * @param {string} key ASCII only
 * @param {number} seed Positive integer only
 * @return {number} 32-bit positive integer hash
 */

function MurmurHash3(key, seed) {
    var remainder,
        bytes,
        h1,
        h1b,
        c1,
        c1b,
        c2,
        c2b,
        k1,
        i;
    remainder = key.length & 3; // key.length % 4
    bytes = key.length - remainder;
    h1 = seed || 3864292196;
    c1 = 3432918353;
    c2 = 461845907;
    i = 0;
    while (i < bytes) {
        k1 = ((key.charCodeAt(i) & 255)) | ((key.charCodeAt(++i) & 255) << 8) | ((key.charCodeAt(++i) & 255) << 16) | ((key.charCodeAt(++i) & 255) << 24);
        ++i;
        k1 = ((((k1 & 65535) * c1) + ((((k1 >>> 16) * c1) & 65535) << 16))) & 4294967295;
        k1 = (k1 << 15) | (k1 >>> 17);
        k1 = ((((k1 & 65535) * c2) + ((((k1 >>> 16) * c2) & 65535) << 16))) & 4294967295;
        h1 ^= k1;
        h1 = (h1 << 13) | (h1 >>> 19);
        h1b = ((((h1 & 65535) * 5) + ((((h1 >>> 16) * 5) & 65535) << 16))) & 4294967295;
        h1 = (((h1b & 65535) + 27492) + ((((h1b >>> 16) + 58964) & 65535) << 16));
    }
    k1 = 0;
    switch (remainder) {
        case 3:
            k1 ^= (key.charCodeAt(i + 2) & 255) << 16;
        case 2:
            k1 ^= (key.charCodeAt(i + 1) & 255) << 8;
        case 1:
            k1 ^= (key.charCodeAt(i) & 255);
            k1 = (((k1 & 65535) * c1) + ((((k1 >>> 16) * c1) & 65535) << 16)) & 4294967295;
            k1 = (k1 << 15) | (k1 >>> 17);
            k1 = (((k1 & 65535) * c2) + ((((k1 >>> 16) * c2) & 65535) << 16)) & 4294967295;
            h1 ^= k1;
    }
    h1 ^= key.length;
    h1 ^= h1 >>> 16;
    h1 = (((h1 & 65535) * 2246822507) + ((((h1 >>> 16) * 2246822507) & 65535) << 16)) & 4294967295;
    h1 ^= h1 >>> 13;
    h1 = ((((h1 & 65535) * 3266489909) + ((((h1 >>> 16) * 3266489909) & 65535) << 16))) & 4294967295;
    h1 ^= h1 >>> 16;
    return h1 >>> 0;
}
/**
 *	Create a pool of workers, it returns a Queue object
 *	so it can be called many times and it'd be throttled
 *	by the queue
 */

function CreateWorkers(url, message, size) {
    size = size || 4
    var worker = [],
        instances = [];

    function handler(id) {
        return function(e) {
            message(this.context, e, function(r) {
                worker[id].busy = false; /* release worker */
                instances[id](r);
            });
        }
    }

    function create(i) {
        var w;
        w = new Worker(url);
        w.id = i;
        w.busy = false;
        w.postMessage = w.webkitPostMessage || w.postMessage;
        w.onmessage = handler(i);
        return w;
    }
    for (var i = 0; i < size; i++) {
        worker.push(null);
    }
    return new MegaQueue(function(task, done) {
        for (var i = 0; i < size; i++) {
            if (worker[i] === null) worker[i] = create(i);
            if (!worker[i].busy) break;
        }
        worker[i].busy = true;
        instances[i] = done;
        $.each(task, function(e, t) {
            if (e == 0) {
                worker[i].context = t;
            } else if (t.constructor === Uint8Array && typeof MSBlobBuilder !== 'function') {
                worker[i].postMessage(t.buffer, [
                    t.buffer
                ]);
            } else {
                worker[i].postMessage(t);
            }
        });
    }, size);
}

function dcTracer(ctr) {
    var name = ctr.name,
        proto = ctr.prototype;
    for (var fn in proto) {
        if (proto.hasOwnProperty(fn) && typeof proto[fn] === 'function') {
            console.log('Tracing ' + name + '.' + fn);
            proto[fn] = (function(fn, fc) {
                fc.dbg = function() {
                    try {
                        console.log('Entering ' + name + '.' + fn, this, '~####~', Array.prototype.slice.call(arguments));
                        var r = fc.apply(this, arguments);
                        console.log('Leaving ' + name + '.' + fn, r);
                        return r;
                    } catch (e) {
                        console.error(e);
                    }
                };
                return fc.dbg;
            })(fn, proto[fn]);
        }
    }
}

function str_mtrunc(str, len) {
    if (!len) len = 35;
    if (len > (str || '').length) return str;
    var p1 = Math.ceil(0.6 * len),
        p2 = Math.ceil(0.3 * len);
    return str.substr(0, p1) + '…' + str.substr(-p2);
}

function setupTransferAnalysis() {
    if ($.mTransferAnalysis) return;
    var prev = {},
        tlen = {},
        time = {},
        chunks = {};
    $.mTransferAnalysis = setInterval(function() {
        if (uldl_hold) prev = {};
        else if ($.transferprogress) {
            var tp = $.transferprogress;
            for (var i in tp) {
                if (!GlobalProgress[i] || GlobalProgress[i].paused || tp[i][0] == tp[i][1] || (i[0] === 'u' ? ulQueue : dlQueue).isPaused()) {
                    delete prev[i];
                } else if (prev[i] && prev[i] == tp[i][0]) {
                    var p = tp[i],
                        t = i[0] === 'u' ? 'Upload' : 'Download',
                        r = '',
                        data = [];
                    var s = GlobalProgress[i].speed,
                        w = GlobalProgress[i].working || [];
                    var c = p[0] + '/' + p[1] + '-' + Math.floor(p[0] / p[1] * 100) + '%';
                    var u = w.map(function(c) {
                        var x = c.xhr || {};
                        return ['' + c,
                            x.__failed,
                            x.__timeout, !!x.listener,
                            x.__id,
                            x.readyState > 1 && x.status
                        ];
                    });
                    if (d) console.warn(i + ' might be stuck, checking...', c, w.length, u);
                    if (w.length) {
                        var j = w.length;
                        while (j--) {
                            /**
                             * if there's a timer, no need to call on_error ourselves
                             * since the chunk will get restarted there by the xhr
                             */
                            var stuck = w[j].xhr && !w[j].xhr.__timeout;
                            if (stuck) {
                                var chunk_id = '' + w[j],
                                    n = u[j];
                                if (w[j].dl && w[j].dl.lasterror) r = '[DLERR' + w[j].dl.lasterror + ']';
                                else if (w[j].srverr) r = '[SRVERR' + (w[j].srverr - 1) + ']';
                                try {
                                    w[j].on_error(0, {}, 'Stuck');
                                } catch (e) {
                                    n.push(e.message);
                                }
                                if (!chunks[chunk_id]) {
                                    chunks[chunk_id] = 1;
                                    data.push(n);
                                }
                            }
                        }
                        if (!data.length && (Date.now() - time[i]) > (mXHRTimeoutMS * 3.1)) {
                            r = s ? '[TIMEOUT]' : '[ETHERR]';
                            data = [
                                'Chunks are taking too long to complete... ',
                                u
                            ];
                        }
                    } else {
                        r = '[!]';
                        data = 'GlobalProgress.' + i + ' exists with no working chunks.';
                    }
                    if (data.length) {
                        var udata = {
                            i: i,
                            p: c,
                            d: data,
                            j: [
                                prev,
                                tlen
                            ],
                            s: s
                        };
                        if (i[0] == 'z') t = 'zip' + t;
                        console.error(t + ' stuck. ' + r, i, udata);
                        if (!d) window.onerror(t + ' Stuck. ' + r, '', 1, 0, {
                            udata: udata
                        });
                    }
                    delete prev[i];
                } else {
                    time[i] = Date.now();
                    tlen[i] = Math.max(tlen[i] || 0, tp[i][0]);
                    prev[i] = tp[i][0];
                }
            }
        }
    }, mXHRTimeoutMS * 1.2);
}

function percent_megatitle() {
    var dl_r = 0,
        dl_t = 0,
        ul_r = 0,
        ul_t = 0,
        tp = $.transferprogress || {};
    for (var i in dl_queue) {
        var q = dl_queue[i];
        var t = tp[q.zipid ? 'zip_' + q.zipid : 'dl_' + q.id];
        if (t) {
            dl_r += t[0];
            dl_t += t[1];
        } else {
            dl_t += q.size || 0;
        }
    }
    for (var i in ul_queue) {
        var t = tp['ul_' + ul_queue[i].id];
        if (t) {
            ul_r += t[0];
            ul_t += t[1];
        } else {
            ul_t += ul_queue[i].size || 0;
        }
    }
    if (dl_t) {
        dl_t += tp['dlc'] || 0;
        dl_r += tp['dlc'] || 0
    }
    if (ul_t) {
        ul_t += tp['ulc'] || 0;
        ul_r += tp['ulc'] || 0
    }
    if (dl_t && ul_t) {
        t = ' ↑ ' + Math.floor(ul_r / ul_t * 100) + '% ↓ ' + Math.floor(dl_r / dl_t * 100) + '%';
    } else if (dl_t) {
        t = ' ' + Math.floor(dl_r / dl_t * 100) + '%';
    } else if (ul_t) {
        t = ' ' + Math.floor(ul_r / ul_t * 100) + '%';
    } else {
        t = '';
        $.transferprogress = {};
    }
    megatitle(t);
}

function __percent_megatitle() {
    var percentage = 0,
        total = 0
    $('.transfer-table .progressbar-percents').each(function() {
        var p = parseInt($(this).text());
        if (isNaN(p)) return;
        percentage += p;
        total++;
    });
    percentage = Math.floor(percentage / total)
    if (total == 0 || percentage == 0 || percentage == 100) {
        megatitle();
    } else {
        megatitle(' ' + percentage + '%');
    }
}

function hostname(url) {
    if (d) ASSERT(url && /^http/.test(url), 'Invalid URL passed to hostname() -> ' + url);
    url = ('' + url).match(/https?:\/\/([^.]+)/);
    return url && url[1];
}
// Helper to manage time/sizes in a friendly way

String.prototype.seconds = function() {
    return parseInt(this) * 1000;
}
String.prototype.minutes = function() {
    return parseInt(this) * 1000 * 60;
}
String.prototype.MB = function() {
    return parseInt(this) * 1024 * 1024;
}
String.prototype.KB = function() {
    return parseInt(this) * 1024;
}
// Quick hack for sane average speed readings

function bucketspeedometer(initialp) {
    return {
        interval: 200,
        num: 300,
        prevp: initialp,
        h: {},
        progress: function(p) {
            var now,
                min,
                oldest;
            var total;
            var t;
            now = NOW();
            now -= now % this.interval;
            this.h[now] = (this.h[now] || 0) + p - this.prevp;
            this.prevp = p;
            min = now - this.interval * this.num;
            oldest = now;
            total = 0;
            for (t in this.h) {
                if (t < min) delete this.h.bt;
                else {
                    if (t < oldest) oldest = t;
                    total += this.h[t];
                }
            }
            if (now - oldest < 1000) return 0;
            p = 1000 * total / (now - oldest);
            // protect against negative returns due to repeated chunks etc.
            return p > 0 ? p : 0;
        }
    }
}

function moveCursortoToEnd(el) {
    if (typeof el.selectionStart == 'number') {
        el.selectionStart = el.selectionEnd = el.value.length;
    } else if (typeof el.createTextRange != 'undefined') {
        el.focus();
        var range = el.createTextRange();
        range.collapse(false);
        range.select();
    }
}
String.prototype.replaceAll = function(_f, _r, _c) {
    var o = this.toString();
    var r = '';
    var s = o;
    var b = 0;
    var e = -1;
    if (_c) {
        _f = _f.toLowerCase();
        s = o.toLowerCase();
    }
    while ((e = s.indexOf(_f)) > -1) {
        r += o.substring(b, b + e) + _r;
        s = s.substring(e + _f.length, s.length);
        b += e + _f.length;
    }
    // Add Leftover

    if (s.length > 0) {
        r += o.substring(o.length - s.length, o.length);
    }
    // Return New String

    return r;
};
// Returns pixels position of element relative to document (top left corner)
function getHtmlElemPos(elem, n) {
    var xPos = 0;
    var yPos = 0;
    var sl,
        st,
        cl,
        ct;
    var pNode;
    while (elem) {
        pNode = elem.parentNode;
        sl = 0;
        st = 0;
        cl = 0;
        ct = 0;
        if (pNode && pNode.tagName && !/html|body/i.test(pNode.tagName)) {
            if (typeof n === 'undefined') // count this in, except for overflow huge menu
            {
                sl = elem.scrollLeft;
                st = elem.scrollTop;
            }
            cl = elem.clientLeft;
            ct = elem.clientTop;
            xPos += (elem.offsetLeft - sl + cl);
            yPos += (elem.offsetTop - st - ct);
        }
        elem = elem.offsetParent;
    }
    return {
        x: xPos,
        y: yPos
    };
}

function disableDescendantFolders(id) {
    var folders = [];
    for (var i in M.c[id])
        if (M.d[i] && M.d[i].t === 1 && M.d[i].name) folders.push(M.d[i]);
    for (var i in folders) {
        var sub = false;
        var fid = folders[i].h;
        for (var h in M.c[fid]) {
            if (M.d[h].t) {
                sub = true;
                break;
            }
        }
        $('#fi_' + fid).addClass('disabled');
        if (sub) this.disableDescendantFolders(fid);
    }
    return true;
}

function ucfirst(str) {
    //  discuss at: http://phpjs.org/functions/ucfirst/
    // original by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)
    // bugfixed by: Onno Marsman
    // improved by: Brett Zamir (http://brett-zamir.me)
    //   example 1: ucfirst('kevin van zonneveld');
    //   returns 1: 'Kevin van zonneveld'
    str += '';
    var f = str.charAt(0).toUpperCase();
    return f + str.substr(1);
}

function readLocalStorage(name, type, val) {
    var v;
    if (localStorage[name]) {
        var f = 'parse' + ucfirst(type);
        v = localStorage[name];
        if (typeof window[f] === 'function') v = window[f](v);
        if (val && ((val.min && val.min > v) || (val.max && val.max < v))) v = null;
    }
    return v || (val && val.def);
}
/* Collect entropy from mouse motion and key press events
 * Note that this is coded to work with either DOM2 or Internet Explorer
 * style events.
 * We don't use every successive mouse movement event.
 * Instead, we use some bits from random() to determine how many
 * subsequent mouse movements we ignore before capturing the next one.
 *
 * Collected entropy is used to salt asmCrypto's PRNG.
 *
 * mouse motion event code originally from John Walker
 * key press timing code thanks to Nigel Johnstone */

var lastactive = Date.now();
var bioSeed = new Uint32Array(256);
var bioCounter = 0;
var mouseMoveSkip = 0; // Delay counter for mouse entropy collection
// ----------------------------------------
if (window.performance !== undefined && window.performance.now !== undefined) {
    // Though `performance.now()` SHOULD be accurate to a microsecond,
    // spec says it's implementation-dependant (http://www.w3.org/TR/hr-time/#sec-DOMHighResTimeStamp)
    // That's why 16 least significan bits are returned
    var timeValue = function() {
        return (window.performance.now() * 1000) & 65535
    };
} else {
    if (d) console.warn('Entropy collector uses low-precision Date.now()');
    var timeValue = function() {
        return Date.now() & 65535
    };
}

function keyPressEntropy(e) {
    bioSeed[bioCounter++ & 255] ^= (e.keyCode << 16) | timeValue();
}
var mouseApiRetryT = false;

function mouseMoveEntropy(e) {
    lastactive = Date.now();
    var v = (((e.screenX << 8) | (e.screenY & 255)) << 16) | timeValue();
    if (!localStorage.randseed) {
        if (bioCounter < 45) {
            // `bioCounter` is incremented once per 4 move events in average
            // 45 * 4 = 180 first move events should provide at about 270 bits of entropy
            // (conservative estimation is 1.5 bits of entropy per move event)
            asmCrypto.random.seed(new Uint32Array([v]));
        } else {
            if (d) console.log('Got the first seed for future PRNG reseeding');
            saveRandSeed();
        }
    }
    if (mouseMoveSkip-- <= 0) {
        bioSeed[bioCounter++ & 255] ^= v;
        mouseMoveSkip = (Math.random() * 8) | 0;
        if ((bioCounter & 255) === 0) {
            if (d) console.log('Reseeding PRNG with collected entropy');
            asmCrypto.random.seed(bioSeed);
            saveRandSeed();
        }
        if (typeof arkanoid_entropy !== 'undefined') arkanoid_entropy();
    }
    if (!mouseApiRetryT || mouseApiRetryT < new Date().getTime()) {
        mouseApiRetryT = new Date().getTime() + 2000;
        api_retry();
    }
}
// Store some random bits for reseeding RNG in the future

function saveRandSeed() {
    var randseed = new Uint8Array(32);
    asmCrypto.getRandomValues(randseed);
    localStorage.randseed = base64urlencode(asmCrypto.bytes_to_string(randseed));
}
// ----------------------------------------

function eventsEnd() {
    if (document.removeEventListener) {
        document.removeEventListener('mousemove', mouseMoveEntropy, false);
        document.removeEventListener('keypress', keyPressEntropy, false);
    } else if (document.detachEvent) {
        document.detachEvent('onmousemove', mouseMoveEntropy);
        document.detachEvent('onkeypress', keyPressEntropy);
    }
}
// Start collection of entropy.

function eventsCollect() {
    if (!d)
        asmCrypto.random.skipSystemRNGWarning = true;
    if (localStorage.randseed) {
        if (d) console.log('Initially seeding PRNG with a stored seed');
        asmCrypto.random.seed(asmCrypto.string_to_bytes(base64urldecode(localStorage.randseed)));
    }
    if ((document.implementation.hasFeature('Events', '2.0')) && document.addEventListener) // Document Object Model (DOM) 2 events
    {
        document.addEventListener('mousemove', mouseMoveEntropy, false);
        document.addEventListener('keypress', keyPressEntropy, false);
    } else if (document.attachEvent) // IE 5 and above event model
    {
        document.attachEvent('onmousemove', mouseMoveEntropy);
        document.attachEvent('onkeypress', keyPressEntropy);
    }
}
// keyboard/mouse entropy

eventsCollect();
/*! jQuery v@1.8.1 jquery.com | jquery.org/license */
(function(a, b) {
    function G(a) {
        var b = F[a] = {};
        return p.each(a.split(s), function(a, c) {
                b[c] = !0
            }),
            b
    }

    function J(a, c, d) {
        if (d === b && a.nodeType === 1) {
            var e = 'data-' + c.replace(I, '-$1').toLowerCase();
            d = a.getAttribute(e);
            if (typeof d == 'string') {
                try {
                    d = d === 'true' ? !0 : d === 'false' ? !1 : d === 'null' ? null : +d + '' === d ? +d : H.test(d) ? p.parseJSON(d) : d
                } catch (f) {}
                p.data(a, c, d)
            } else d = b
        }
        return d
    }

    function K(a) {
        var b;
        for (b in a) {
            if (b === 'data' && p.isEmptyObject(a[b])) continue;
            if (b !== 'toJSON') return !1
        }
        return !0
    }

    function ba() {
        return !1
    }

    function bb() {
        return !0
    }

    function bh(a) {
        return !a || !a.parentNode || a.parentNode.nodeType === 11
    }

    function bi(a, b) {
        do a = a[b];
        while (a && a.nodeType !== 1);
        return a
    }

    function bj(a, b, c) {
        b = b || 0;
        if (p.isFunction(b)) return p.grep(a, function(a, d) {
            var e = !!b.call(a, d, a);
            return e === c
        });
        if (b.nodeType) return p.grep(a, function(a, d) {
            return a === b === c
        });
        if (typeof b == 'string') {
            var d = p.grep(a, function(a) {
                return a.nodeType === 1
            });
            if (be.test(b)) return p.filter(b, d, !c);
            b = p.filter(b, d)
        }
        return p.grep(a, function(a, d) {
            return p.inArray(a, b) >= 0 === c
        })
    }

    function bk(a) {
        var b = bl.split('|'),
            c = a.createDocumentFragment();
        if (c.createElement)
            while (b.length) c.createElement(b.pop());
        return c
    }

    function bC(a, b) {
        return a.getElementsByTagName(b)[0] || a.appendChild(a.ownerDocument.createElement(b))
    }

    function bD(a, b) {
        if (b.nodeType !== 1 || !p.hasData(a)) return;
        var c,
            d,
            e,
            f = p._data(a),
            g = p._data(b, f),
            h = f.events;
        if (h) {
            delete g.handle,
            g.events = {};
            for (c in h)
                for (d = 0, e = h[c].length; d < e; d++) p.event.add(b, c, h[c][d])
        }
        g.data && (g.data = p.extend({}, g.data))
    }

    function bE(a, b) {
        var c;
        if (b.nodeType !== 1) return;
        b.clearAttributes && b.clearAttributes(),
        b.mergeAttributes && b.mergeAttributes(a),
        c = b.nodeName.toLowerCase(),
        c === 'object' ? (b.parentNode && (b.outerHTML = a.outerHTML), p.support.html5Clone && a.innerHTML && !p.trim(b.innerHTML) && (b.innerHTML = a.innerHTML)) : c === 'input' && bv.test(a.type) ? (b.defaultChecked = b.checked = a.checked, b.value !== a.value && (b.value = a.value)) : c === 'option' ? b.selected = a.defaultSelected : c === 'input' || c === 'textarea' ? b.defaultValue = a.defaultValue : c === 'script' && b.text !== a.text && (b.text = a.text),
        b.removeAttribute(p.expando)
    }

    function bF(a) {
        return typeof a.getElementsByTagName != 'undefined' ? a.getElementsByTagName('*') : typeof a.querySelectorAll != 'undefined' ? a.querySelectorAll('*') : []
    }

    function bG(a) {
        bv.test(a.type) && (a.defaultChecked = a.checked)
    }

    function bY(a, b) {
        if (b in a) return b;
        var c = b.charAt(0).toUpperCase() + b.slice(1),
            d = b,
            e = bW.length;
        while (e--) {
            b = bW[e] + c;
            if (b in a) return b
        }
        return d
    }

    function bZ(a, b) {
        return a = b || a,
            p.css(a, 'display') === 'none' || !p.contains(a.ownerDocument, a)
    }

    function b$(a, b) {
        var c,
            d,
            e = [],
            f = 0,
            g = a.length;
        for (; f < g; f++) {
            c = a[f];
            if (!c.style) continue;
            e[f] = p._data(c, 'olddisplay'),
            b ? (!e[f] && c.style.display === 'none' && (c.style.display = ''), c.style.display === '' && bZ(c) && (e[f] = p._data(c, 'olddisplay', cc(c.nodeName)))) : (d = bH(c, 'display'), !e[f] && d !== 'none' && p._data(c, 'olddisplay', d))
        }
        for (f = 0; f < g; f++) {
            c = a[f];
            if (!c.style) continue;
            if (!b || c.style.display === 'none' || c.style.display === '') c.style.display = b ? e[f] || '' : 'none'
        }
        return a
    }

    function b_(a, b, c) {
        var d = bP.exec(b);
        return d ? Math.max(0, d[1] - (c || 0)) + (d[2] || 'px') : b
    }

    function ca(a, b, c, d) {
        var e = c === (d ? 'border' : 'content') ? 4 : b === 'width' ? 1 : 0,
            f = 0;
        for (; e < 4; e += 2) c === 'margin' && (f += p.css(a, c + bV[e], !0)),
            d ? (c === 'content' && (f -= parseFloat(bH(a, 'padding' + bV[e])) || 0), c !== 'margin' && (f -= parseFloat(bH(a, 'border' + bV[e] + 'Width')) || 0)) : (f += parseFloat(bH(a, 'padding' + bV[e])) || 0, c !== 'padding' && (f += parseFloat(bH(a, 'border' + bV[e] + 'Width')) || 0));
        return f
    }

    function cb(a, b, c) {
        var d = b === 'width' ? a.offsetWidth : a.offsetHeight,
            e = !0,
            f = p.support.boxSizing && p.css(a, 'boxSizing') === 'border-box';
        if (d <= 0 || d == null) {
            d = bH(a, b);
            if (d < 0 || d == null) d = a.style[b];
            if (bQ.test(d)) return d;
            e = f && (p.support.boxSizingReliable || d === a.style[b]),
            d = parseFloat(d) || 0
        }
        return d + ca(a, b, c || (f ? 'border' : 'content'), e) + 'px'
    }

    function cc(a) {
        if (bS[a]) return bS[a];
        var b = p('<' + a + '>').appendTo(e.body),
            c = b.css('display');
        b.remove();
        if (c === 'none' || c === '') {
            bI = e.body.appendChild(bI || p.extend(e.createElement('iframe'), {
                frameBorder: 0,
                width: 0,
                height: 0
            }));
            if (!bJ || !bI.createElement) bJ = (bI.contentWindow || bI.contentDocument).document,
                bJ.write('<!doctype html><html><body>'),
                bJ.close();
            b = bJ.body.appendChild(bJ.createElement(a)),
            c = bH(b, 'display'),
            e.body.removeChild(bI)
        }
        return bS[a] = c,
            c
    }

    function ci(a, b, c, d) {
        var e;
        if (p.isArray(b)) p.each(b, function(b, e) {
            c || ce.test(a) ? d(a, e) : ci(a + '[' + (typeof e == 'object' ? b : '') + ']', e, c, d)
        });
        else if (!c && p.type(b) === 'object')
            for (e in b) ci(a + '[' + e + ']', b[e], c, d);
        else d(a, b)
    }

    function cz(a) {
        return function(b, c) {
            typeof b != 'string' && (c = b, b = '*');
            var d,
                e,
                f,
                g = b.toLowerCase().split(s),
                h = 0,
                i = g.length;
            if (p.isFunction(c))
                for (; h < i; h++) d = g[h],
                    f = /^\+/.test(d),
                    f && (d = d.substr(1) || '*'),
                    e = a[d] = a[d] || [],
                    e[f ? 'unshift' : 'push'](c)
        }
    }

    function cA(a, c, d, e, f, g) {
        f = f || c.dataTypes[0],
        g = g || {},
        g[f] = !0;
        var h,
            i = a[f],
            j = 0,
            k = i ? i.length : 0,
            l = a === cv;
        for (; j < k && (l || !h); j++) h = i[j](c, d, e),
            typeof h == 'string' && (!l || g[h] ? h = b : (c.dataTypes.unshift(h), h = cA(a, c, d, e, h, g)));
        return (l || !h) && !g['*'] && (h = cA(a, c, d, e, '*', g)),
            h
    }

    function cB(a, c) {
        var d,
            e,
            f = p.ajaxSettings.flatOptions || {};
        for (d in c) c[d] !== b && ((f[d] ? a : e || (e = {}))[d] = c[d]);
        e && p.extend(!0, a, e)
    }

    function cC(a, c, d) {
        var e,
            f,
            g,
            h,
            i = a.contents,
            j = a.dataTypes,
            k = a.responseFields;
        for (f in k) f in d && (c[k[f]] = d[f]);
        while (j[0] === '*') j.shift(),
            e === b && (e = a.mimeType || c.getResponseHeader('content-type'));
        if (e)
            for (f in i)
                if (i[f] && i[f].test(e)) {
                    j.unshift(f);
                    break
                }
        if (j[0] in d) g = j[0];
        else {
            for (f in d) {
                if (!j[0] || a.converters[f + ' ' + j[0]]) {
                    g = f;
                    break
                }
                h || (h = f)
            }
            g = g || h
        }
        if (g) return g !== j[0] && j.unshift(g),
            d[g]
    }

    function cD(a, b) {
        var c,
            d,
            e,
            f,
            g = a.dataTypes.slice(),
            h = g[0],
            i = {},
            j = 0;
        a.dataFilter && (b = a.dataFilter(b, a.dataType));
        if (g[1])
            for (c in a.converters) i[c.toLowerCase()] = a.converters[c];
        for (; e = g[++j];)
            if (e !== '*') {
                if (h !== '*' && h !== e) {
                    c = i[h + ' ' + e] || i['* ' + e];
                    if (!c)
                        for (d in i) {
                            f = d.split(' ');
                            if (f[1] === e) {
                                c = i[h + ' ' + f[0]] || i['* ' + f[0]];
                                if (c) {
                                    c === !0 ? c = i[d] : i[d] !== !0 && (e = f[0], g.splice(j--, 0, e));
                                    break
                                }
                            }
                        }
                    if (c !== !0)
                        if (c && a['throws']) b = c(b);
                        else try {
                            b = c(b)
                        } catch (k) {
                            return {
                                state: 'parsererror',
                                error: c ? k : 'No conversion from ' + h + ' to ' + e
                            }
                        }
                }
                h = e
            }
        return {
            state: 'success',
            data: b
        }
    }

    function cL() {
        try {
            return new a.XMLHttpRequest
        } catch (b) {}
    }

    function cM() {
        try {
            return new a.ActiveXObject('Microsoft.XMLHTTP')
        } catch (b) {}
    }

    function cU() {
        return setTimeout(function() {
                cN = b
            }, 0),
            cN = p.now()
    }

    function cV(a, b) {
        p.each(b, function(b, c) {
            var d = (cT[b] || []).concat(cT['*']),
                e = 0,
                f = d.length;
            for (; e < f; e++)
                if (d[e].call(a, b, c)) return
        })
    }

    function cW(a, b, c) {
        var d,
            e = 0,
            f = 0,
            g = cS.length,
            h = p.Deferred().always(function() {
                delete i.elem
            }),
            i = function() {
                var b = cN || cU(),
                    c = Math.max(0, j.startTime + j.duration - b),
                    d = 1 - (c / j.duration || 0),
                    e = 0,
                    f = j.tweens.length;
                for (; e < f; e++) j.tweens[e].run(d);
                return h.notifyWith(a, [
                        j,
                        d,
                        c
                    ]),
                    d < 1 && f ? c : (h.resolveWith(a, [
                        j
                    ]), !1)
            },
            j = h.promise({
                elem: a,
                props: p.extend({}, b),
                opts: p.extend(!0, {
                    specialEasing: {}
                }, c),
                originalProperties: b,
                originalOptions: c,
                startTime: cN || cU(),
                duration: c.duration,
                tweens: [],
                createTween: function(b, c, d) {
                    var e = p.Tween(a, j.opts, b, c, j.opts.specialEasing[b] || j.opts.easing);
                    return j.tweens.push(e),
                        e
                },
                stop: function(b) {
                    var c = 0,
                        d = b ? j.tweens.length : 0;
                    for (; c < d; c++) j.tweens[c].run(1);
                    return b ? h.resolveWith(a, [
                            j,
                            b
                        ]) : h.rejectWith(a, [
                            j,
                            b
                        ]),
                        this
                }
            }),
            k = j.props;
        cX(k, j.opts.specialEasing);
        for (; e < g; e++) {
            d = cS[e].call(j, a, k, j.opts);
            if (d) return d
        }
        return cV(j, k),
            p.isFunction(j.opts.start) && j.opts.start.call(a, j),
            p.fx.timer(p.extend(i, {
                anim: j,
                queue: j.opts.queue,
                elem: a
            })),
            j.progress(j.opts.progress).done(j.opts.done, j.opts.complete).fail(j.opts.fail).always(j.opts.always)
    }

    function cX(a, b) {
        var c,
            d,
            e,
            f,
            g;
        for (c in a) {
            d = p.camelCase(c),
            e = b[d],
            f = a[c],
            p.isArray(f) && (e = f[1], f = a[c] = f[0]),
            c !== d && (a[d] = f, delete a[c]),
            g = p.cssHooks[d];
            if (g && 'expand' in g) {
                f = g.expand(f),
                delete a[d];
                for (c in f) c in a || (a[c] = f[c], b[c] = e)
            } else b[d] = e
        }
    }

    function cY(a, b, c) {
        var d,
            e,
            f,
            g,
            h,
            i,
            j,
            k,
            l = this,
            m = a.style,
            n = {},
            o = [],
            q = a.nodeType && bZ(a);
        c.queue || (j = p._queueHooks(a, 'fx'), j.unqueued == null && (j.unqueued = 0, k = j.empty.fire, j.empty.fire = function() {
            j.unqueued || k()
        }), j.unqueued++, l.always(function() {
            l.always(function() {
                j.unqueued--,
                p.queue(a, 'fx').length || j.empty.fire()
            })
        })),
        a.nodeType === 1 && ('height' in b || 'width' in b) && (c.overflow = [
            m.overflow,
            m.overflowX,
            m.overflowY
        ], p.css(a, 'display') === 'inline' && p.css(a, 'float') === 'none' && (!p.support.inlineBlockNeedsLayout || cc(a.nodeName) === 'inline' ? m.display = 'inline-block' : m.zoom = 1)),
        c.overflow && (m.overflow = 'hidden', p.support.shrinkWrapBlocks || l.done(function() {
            m.overflow = c.overflow[0],
            m.overflowX = c.overflow[1],
            m.overflowY = c.overflow[2]
        }));
        for (d in b) {
            f = b[d];
            if (cP.exec(f)) {
                delete b[d];
                if (f === (q ? 'hide' : 'show')) continue;
                o.push(d)
            }
        }
        g = o.length;
        if (g) {
            h = p._data(a, 'fxshow') || p._data(a, 'fxshow', {}),
            q ? p(a).show() : l.done(function() {
                p(a).hide()
            }),
            l.done(function() {
                var b;
                p.removeData(a, 'fxshow', !0);
                for (b in n) p.style(a, b, n[b])
            });
            for (d = 0; d < g; d++) e = o[d],
                i = l.createTween(e, q ? h[e] : 0),
                n[e] = h[e] || p.style(a, e),
                e in h || (h[e] = i.start, q && (i.end = i.start, i.start = e === 'width' || e === 'height' ? 1 : 0))
        }
    }

    function cZ(a, b, c, d, e) {
        return new cZ.prototype.init(a, b, c, d, e)
    }

    function c$(a, b) {
        var c,
            d = {
                height: a
            },
            e = 0;
        b = b ? 1 : 0;
        for (; e < 4; e += 2 - b) c = bV[e],
            d['margin' + c] = d['padding' + c] = a;
        return b && (d.opacity = d.width = a),
            d
    }

    function da(a) {
        return p.isWindow(a) ? a : a.nodeType === 9 ? a.defaultView || a.parentWindow : !1
    }
    var c,
        d,
        e = a.document,
        f = a.location,
        g = a.navigator,
        h = a.jQuery,
        i = a.$,
        j = Array.prototype.push,
        k = Array.prototype.slice,
        l = Array.prototype.indexOf,
        m = Object.prototype.toString,
        n = Object.prototype.hasOwnProperty,
        o = String.prototype.trim,
        p = function(a, b) {
            return new p.fn.init(a, b, c)
        },
        q = /[\-+]?(?:\d*\.|)\d+(?:[eE][\-+]?\d+|)/.source,
        r = /\S/,
        s = /\s+/,
        t = /^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,
        u = /^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,
        v = /^<(\w+)\s*\/?>(?:<\/\1>|)$/,
        w = /^[\],:{}\s]*$/,
        x = /(?:^|:|,)(?:\s*\[)+/g,
        y = /\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,
        z = /"[^"\\\r\n]*"|true|false|null|-?(?:\d\d*\.|)\d+(?:[eE][\-+]?\d+|)/g,
        A = /^-ms-/,
        B = /-([\da-z])/gi,
        C = function(a, b) {
            return (b + '').toUpperCase()
        },
        D = function() {
            e.addEventListener ? (e.removeEventListener('DOMContentLoaded', D, !1), p.ready()) : e.readyState === 'complete' && (e.detachEvent('onreadystatechange', D), p.ready())
        },
        E = {};
    p.fn = p.prototype = {
        constructor: p,
        init: function(a, c, d) {
            var f,
                g,
                h,
                i;
            if (!a) return this;
            if (a.nodeType) return this.context = this[0] = a,
                this.length = 1,
                this;
            if (typeof a == 'string') {
                a.charAt(0) === '<' && a.charAt(a.length - 1) === '>' && a.length >= 3 ? f = [
                    null,
                    a,
                    null
                ] : f = u.exec(a);
                if (f && (f[1] || !c)) {
                    if (f[1]) return c = c instanceof p ? c[0] : c,
                        i = c && c.nodeType ? c.ownerDocument || c : e,
                        a = p.parseHTML(f[1], i, !0),
                        v.test(f[1]) && p.isPlainObject(c) && this.attr.call(a, c, !0),
                        p.merge(this, a);
                    g = e.getElementById(f[2]);
                    if (g && g.parentNode) {
                        if (g.id !== f[2]) return d.find(a);
                        this.length = 1,
                        this[0] = g
                    }
                    return this.context = e,
                        this.selector = a,
                        this
                }
                return !c || c.jquery ? (c || d).find(a) : this.constructor(c).find(a)
            }
            return p.isFunction(a) ? d.ready(a) : (a.selector !== b && (this.selector = a.selector, this.context = a.context), p.makeArray(a, this))
        },
        selector: '',
        jquery: '1.8.1',
        length: 0,
        size: function() {
            return this.length
        },
        toArray: function() {
            return k.call(this)
        },
        get: function(a) {
            return a == null ? this.toArray() : a < 0 ? this[this.length + a] : this[a]
        },
        pushStack: function(a, b, c) {
            var d = p.merge(this.constructor(), a);
            return d.prevObject = this,
                d.context = this.context,
                b === 'find' ? d.selector = this.selector + (this.selector ? ' ' : '') + c : b && (d.selector = this.selector + '.' + b + '(' + c + ')'),
                d
        },
        each: function(a, b) {
            return p.each(this, a, b)
        },
        ready: function(a) {
            return p.ready.promise().done(a),
                this
        },
        eq: function(a) {
            return a = +a,
                a === -1 ? this.slice(a) : this.slice(a, a + 1)
        },
        first: function() {
            return this.eq(0)
        },
        last: function() {
            return this.eq(-1)
        },
        slice: function() {
            return this.pushStack(k.apply(this, arguments), 'slice', k.call(arguments).join(','))
        },
        map: function(a) {
            return this.pushStack(p.map(this, function(b, c) {
                return a.call(b, c, b)
            }))
        },
        end: function() {
            return this.prevObject || this.constructor(null)
        },
        push: j,
        sort: [].sort,
        splice: [].splice
    },
    p.fn.init.prototype = p.fn,
    p.extend = p.fn.extend = function() {
        var a,
            c,
            d,
            e,
            f,
            g,
            h = arguments[0] || {},
            i = 1,
            j = arguments.length,
            k = !1;
        typeof h == 'boolean' && (k = h, h = arguments[1] || {}, i = 2),
        typeof h != 'object' && !p.isFunction(h) && (h = {}),
        j === i && (h = this, --i);
        for (; i < j; i++)
            if ((a = arguments[i]) != null)
                for (c in a) {
                    d = h[c],
                    e = a[c];
                    if (h === e) continue;
                    k && e && (p.isPlainObject(e) || (f = p.isArray(e))) ? (f ? (f = !1, g = d && p.isArray(d) ? d : []) : g = d && p.isPlainObject(d) ? d : {}, h[c] = p.extend(k, g, e)) : e !== b && (h[c] = e)
                }
        return h
    },
    p.extend({
        noConflict: function(b) {
            return a.$ === p && (a.$ = i),
                b && a.jQuery === p && (a.jQuery = h),
                p
        },
        isReady: !1,
        readyWait: 1,
        holdReady: function(a) {
            a ? p.readyWait++ : p.ready(!0)
        },
        ready: function(a) {
            if (a === !0 ? --p.readyWait : p.isReady) return;
            if (!e.body) return setTimeout(p.ready, 1);
            p.isReady = !0;
            if (a !== !0 && --p.readyWait > 0) return;
            d.resolveWith(e, [
                p
            ]),
            p.fn.trigger && p(e).trigger('ready').off('ready')
        },
        isFunction: function(a) {
            return p.type(a) === 'function'
        },
        isArray: Array.isArray || function(a) {
            return p.type(a) === 'array'
        },
        isWindow: function(a) {
            return a != null && a == a.window
        },
        isNumeric: function(a) {
            return !isNaN(parseFloat(a)) && isFinite(a)
        },
        type: function(a) {
            return a == null ? String(a) : E[m.call(a)] || 'object'
        },
        isPlainObject: function(a) {
            if (!a || p.type(a) !== 'object' || a.nodeType || p.isWindow(a)) return !1;
            try {
                if (a.constructor && !n.call(a, 'constructor') && !n.call(a.constructor.prototype, 'isPrototypeOf')) return !1
            } catch (c) {
                return !1
            }
            var d;
            for (d in a);
            return d === b || n.call(a, d)
        },
        isEmptyObject: function(a) {
            var b;
            for (b in a) return !1;
            return !0
        },
        error: function(a) {
            throw new Error(a)
        },
        parseHTML: function(a, b, c) {
            var d;
            return !a || typeof a != 'string' ? null : (typeof b == 'boolean' && (c = b, b = 0), b = b || e, (d = v.exec(a)) ? [
                b.createElement(d[1])
            ] : (d = p.buildFragment([a], b, c ? null : []), p.merge([], (d.cacheable ? p.clone(d.fragment) : d.fragment).childNodes)))
        },
        parseJSON: function(b) {
            if (!b || typeof b != 'string') return null;
            b = p.trim(b);
            if (a.JSON && a.JSON.parse) return a.JSON.parse(b);
            if (w.test(b.replace(y, '@').replace(z, ']').replace(x, ''))) return (new Function('return ' + b))();
            p.error('Invalid JSON: ' + b)
        },
        parseXML: function(c) {
            var d,
                e;
            if (!c || typeof c != 'string') return null;
            try {
                a.DOMParser ? (e = new DOMParser, d = e.parseFromString(c, 'text/xml')) : (d = new ActiveXObject('Microsoft.XMLDOM'), d.async = 'false', d.loadXML(c))
            } catch (f) {
                d = b
            }
            return (!d || !d.documentElement || d.getElementsByTagName('parsererror').length) && p.error('Invalid XML: ' + c),
                d
        },
        noop: function() {},
        globalEval: function(b) {
            b && r.test(b) && (a.execScript || function(b) {
                a.eval.call(a, b)
            })(b)
        },
        camelCase: function(a) {
            return a.replace(A, 'ms-').replace(B, C)
        },
        nodeName: function(a, b) {
            return a.nodeName && a.nodeName.toUpperCase() === b.toUpperCase()
        },
        each: function(a, c, d) {
            var e,
                f = 0,
                g = a.length,
                h = g === b || p.isFunction(a);
            if (d) {
                if (h) {
                    for (e in a)
                        if (c.apply(a[e], d) === !1) break
                } else
                    for (; f < g;)
                        if (c.apply(a[f++], d) === !1) break
            } else if (h) {
                for (e in a)
                    if (c.call(a[e], e, a[e]) === !1) break
            } else
                for (; f < g;)
                    if (c.call(a[f], f, a[f++]) === !1) break;
            return a
        },
        trim: o && !o.call('? ') ? function(a) {
            return a == null ? '' : o.call(a)
        } : function(a) {
            return a == null ? '' : a.toString().replace(t, '')
        },
        makeArray: function(a, b) {
            var c,
                d = b || [];
            return a != null && (c = p.type(a), a.length == null || c === 'string' || c === 'function' || c === 'regexp' || p.isWindow(a) ? j.call(d, a) : p.merge(d, a)),
                d
        },
        inArray: function(a, b, c) {
            var d;
            if (b) {
                if (l) return l.call(b, a, c);
                d = b.length,
                c = c ? c < 0 ? Math.max(0, d + c) : c : 0;
                for (; c < d; c++)
                    if (c in b && b[c] === a) return c
            }
            return -1
        },
        merge: function(a, c) {
            var d = c.length,
                e = a.length,
                f = 0;
            if (typeof d == 'number')
                for (; f < d; f++) a[e++] = c[f];
            else
                while (c[f] !== b) a[e++] = c[f++];
            return a.length = e,
                a
        },
        grep: function(a, b, c) {
            var d,
                e = [],
                f = 0,
                g = a.length;
            c = !!c;
            for (; f < g; f++) d = !!b(a[f], f),
                c !== d && e.push(a[f]);
            return e
        },
        map: function(a, c, d) {
            var e,
                f,
                g = [],
                h = 0,
                i = a.length,
                j = a instanceof p || i !== b && typeof i == 'number' && (i > 0 && a[0] && a[i - 1] || i === 0 || p.isArray(a));
            if (j)
                for (; h < i; h++) e = c(a[h], h, d),
                    e != null && (g[g.length] = e);
            else
                for (f in a) e = c(a[f], f, d),
                    e != null && (g[g.length] = e);
            return g.concat.apply([], g)
        },
        guid: 1,
        proxy: function(a, c) {
            var d,
                e,
                f;
            return typeof c == 'string' && (d = a[c], c = a, a = d),
                p.isFunction(a) ? (e = k.call(arguments, 2), f = function() {
                    return a.apply(c, e.concat(k.call(arguments)))
                }, f.guid = a.guid = a.guid || f.guid || p.guid++, f) : b
        },
        access: function(a, c, d, e, f, g, h) {
            var i,
                j = d == null,
                k = 0,
                l = a.length;
            if (d && typeof d == 'object') {
                for (k in d) p.access(a, c, k, d[k], 1, g, e);
                f = 1
            } else if (e !== b) {
                i = h === b && p.isFunction(e),
                j && (i ? (i = c, c = function(a, b, c) {
                    return i.call(p(a), c)
                }) : (c.call(a, e), c = null));
                if (c)
                    for (; k < l; k++) c(a[k], d, i ? e.call(a[k], k, c(a[k], d)) : e, h);
                f = 1
            }
            return f ? a : j ? c.call(a) : l ? c(a[0], d) : g
        },
        now: function() {
            return (new Date).getTime()
        }
    }),
    p.ready.promise = function(b) {
        if (!d) {
            d = p.Deferred();
            if (e.readyState === 'complete') setTimeout(p.ready, 1);
            else if (e.addEventListener) e.addEventListener('DOMContentLoaded', D, !1),
                a.addEventListener('load', p.ready, !1);
            else {
                e.attachEvent('onreadystatechange', D),
                a.attachEvent('onload', p.ready);
                var c = !1;
                try {
                    c = a.frameElement == null && e.documentElement
                } catch (f) {}
                c && c.doScroll && function g() {
                    if (!p.isReady) {
                        try {
                            c.doScroll('left')
                        } catch (a) {
                            return setTimeout(g, 50)
                        }
                        p.ready()
                    }
                }()
            }
        }
        return d.promise(b)
    },
    p.each('Boolean Number String Function Array Date RegExp Object'.split(' '), function(a, b) {
        E['[object ' + b + ']'] = b.toLowerCase()
    }),
    c = p(e);
    var F = {};
    p.Callbacks = function(a) {
        a = typeof a == 'string' ? F[a] || G(a) : p.extend({}, a);
        var c,
            d,
            e,
            f,
            g,
            h,
            i = [],
            j = !a.once && [],
            k = function(b) {
                c = a.memory && b,
                d = !0,
                h = f || 0,
                f = 0,
                g = i.length,
                e = !0;
                for (; i && h < g; h++)
                    if (i[h].apply(b[0], b[1]) === !1 && a.stopOnFalse) {
                        c = !1;
                        break
                    }
                e = !1,
                i && (j ? j.length && k(j.shift()) : c ? i = [] : l.disable())
            },
            l = {
                add: function() {
                    if (i) {
                        var b = i.length;
                        (function d(b) {
                            p.each(b, function(b, c) {
                                var e = p.type(c);
                                e === 'function' && (!a.unique || !l.has(c)) ? i.push(c) : c && c.length && e !== 'string' && d(c)
                            })
                        })(arguments),
                        e ? g = i.length : c && (f = b, k(c))
                    }
                    return this
                },
                remove: function() {
                    return i && p.each(arguments, function(a, b) {
                            var c;
                            while ((c = p.inArray(b, i, c)) > -1) i.splice(c, 1),
                                e && (c <= g && g--, c <= h && h--)
                        }),
                        this
                },
                has: function(a) {
                    return p.inArray(a, i) > -1
                },
                empty: function() {
                    return i = [],
                        this
                },
                disable: function() {
                    return i = j = c = b,
                        this
                },
                disabled: function() {
                    return !i
                },
                lock: function() {
                    return j = b,
                        c || l.disable(),
                        this
                },
                locked: function() {
                    return !j
                },
                fireWith: function(a, b) {
                    return b = b || [],
                        b = [
                            a,
                            b.slice ? b.slice() : b
                        ],
                        i && (!d || j) && (e ? j.push(b) : k(b)),
                        this
                },
                fire: function() {
                    return l.fireWith(this, arguments),
                        this
                },
                fired: function() {
                    return !!d
                }
            };
        return l
    },
    p.extend({
        Deferred: function(a) {
            var b = [
                    ['resolve',
                        'done',
                        p.Callbacks('once memory'),
                        'resolved'
                    ],
                    [
                        'reject',
                        'fail',
                        p.Callbacks('once memory'),
                        'rejected'
                    ],
                    [
                        'notify',
                        'progress',
                        p.Callbacks('memory')
                    ]
                ],
                c = 'pending',
                d = {
                    state: function() {
                        return c
                    },
                    always: function() {
                        return e.done(arguments).fail(arguments),
                            this
                    },
                    then: function() {
                        var a = arguments;
                        return p.Deferred(function(c) {
                            p.each(b, function(b, d) {
                                var f = d[0],
                                    g = a[b];
                                e[d[1]](p.isFunction(g) ? function() {
                                    var a = g.apply(this, arguments);
                                    a && p.isFunction(a.promise) ? a.promise().done(c.resolve).fail(c.reject).progress(c.notify) : c[f + 'With'](this === e ? c : this, [
                                        a
                                    ])
                                } : c[f])
                            }),
                            a = null
                        }).promise()
                    },
                    promise: function(a) {
                        return typeof a == 'object' ? p.extend(a, d) : d
                    }
                },
                e = {};
            return d.pipe = d.then,
                p.each(b, function(a, f) {
                    var g = f[2],
                        h = f[3];
                    d[f[1]] = g.add,
                    h && g.add(function() {
                        c = h
                    }, b[a ^ 1][2].disable, b[2][2].lock),
                    e[f[0]] = g.fire,
                    e[f[0] + 'With'] = g.fireWith
                }),
                d.promise(e),
                a && a.call(e, e),
                e
        },
        when: function(a) {
            var b = 0,
                c = k.call(arguments),
                d = c.length,
                e = d !== 1 || a && p.isFunction(a.promise) ? d : 0,
                f = e === 1 ? a : p.Deferred(),
                g = function(a, b, c) {
                    return function(d) {
                        b[a] = this,
                        c[a] = arguments.length > 1 ? k.call(arguments) : d,
                        c === h ? f.notifyWith(b, c) : --e || f.resolveWith(b, c)
                    }
                },
                h,
                i,
                j;
            if (d > 1) {
                h = new Array(d),
                i = new Array(d),
                j = new Array(d);
                for (; b < d; b++) c[b] && p.isFunction(c[b].promise) ? c[b].promise().done(g(b, j, c)).fail(f.reject).progress(g(b, i, h)) : --e
            }
            return e || f.resolveWith(j, c),
                f.promise()
        }
    }),
    p.support = function() {
        var b,
            c,
            d,
            f,
            g,
            h,
            i,
            j,
            k,
            l,
            m,
            n = e.createElement('div');
        n.setAttribute('className', 't'),
        n.innerHTML = '  <link/><table></table><a href=\'/a\'>a</a><input type=\'checkbox\'/>',
        c = n.getElementsByTagName('*'),
        d = n.getElementsByTagName('a')[0],
        d.style.cssText = 'top:1px;float:left;opacity:.5';
        if (!c || !c.length || !d) return {};
        f = e.createElement('select'),
        g = f.appendChild(e.createElement('option')),
        h = n.getElementsByTagName('input')[0],
        b = {
            leadingWhitespace: n.firstChild.nodeType === 3,
            tbody: !n.getElementsByTagName('tbody').length,
            htmlSerialize: !!n.getElementsByTagName('link').length,
            style: /top/.test(d.getAttribute('style')),
            hrefNormalized: d.getAttribute('href') === '/a',
            opacity: /^0.5/.test(d.style.opacity),
            cssFloat: !!d.style.cssFloat,
            checkOn: h.value === 'on',
            optSelected: g.selected,
            getSetAttribute: n.className !== 't',
            enctype: !!e.createElement('form').enctype,
            html5Clone: e.createElement('nav').cloneNode(!0).outerHTML !== '<:nav></:nav>',
            boxModel: e.compatMode === 'CSS1Compat',
            submitBubbles: !0,
            changeBubbles: !0,
            focusinBubbles: !1,
            deleteExpando: !0,
            noCloneEvent: !0,
            inlineBlockNeedsLayout: !1,
            shrinkWrapBlocks: !1,
            reliableMarginRight: !0,
            boxSizingReliable: !0,
            pixelPosition: !1
        },
        h.checked = !0,
        b.noCloneChecked = h.cloneNode(!0).checked,
        f.disabled = !0,
        b.optDisabled = !g.disabled;
        try {
            delete n.test
        } catch (o) {
            b.deleteExpando = !1
        }!n.addEventListener && n.attachEvent && n.fireEvent && (n.attachEvent('onclick', m = function() {
            b.noCloneEvent = !1
        }), n.cloneNode(!0).fireEvent('onclick'), n.detachEvent('onclick', m)),
        h = e.createElement('input'),
        h.value = 't',
        h.setAttribute('type', 'radio'),
        b.radioValue = h.value === 't',
        h.setAttribute('checked', 'checked'),
        h.setAttribute('name', 't'),
        n.appendChild(h),
        i = e.createDocumentFragment(),
        i.appendChild(n.lastChild),
        b.checkClone = i.cloneNode(!0).cloneNode(!0).lastChild.checked,
        b.appendChecked = h.checked,
        i.removeChild(h),
        i.appendChild(n);
        if (n.attachEvent)
            for (k in {
                submit: !0,
                change: !0,
                focusin: !0
            }) j = 'on' + k,
                l = j in n,
                l || (n.setAttribute(j, 'return;'), l = typeof n[j] == 'function'),
                b[k + 'Bubbles'] = l;
        return p(function() {
                var c,
                    d,
                    f,
                    g,
                    h = 'padding:0;margin:0;border:0;display:block;overflow:hidden;',
                    i = e.getElementsByTagName('body')[0];
                if (!i) return;
                c = e.createElement('div'),
                c.style.cssText = 'visibility:hidden;border:0;width:0;height:0;position:static;top:0;margin-top:1px',
                i.insertBefore(c, i.firstChild),
                d = e.createElement('div'),
                c.appendChild(d),
                d.innerHTML = '<table><tr><td></td><td>t</td></tr></table>',
                f = d.getElementsByTagName('td'),
                f[0].style.cssText = 'padding:0;margin:0;border:0;display:none',
                l = f[0].offsetHeight === 0,
                f[0].style.display = '',
                f[1].style.display = 'none',
                b.reliableHiddenOffsets = l && f[0].offsetHeight === 0,
                d.innerHTML = '',
                d.style.cssText = 'box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;',
                b.boxSizing = d.offsetWidth === 4,
                b.doesNotIncludeMarginInBodyOffset = i.offsetTop !== 1,
                a.getComputedStyle && (b.pixelPosition = (a.getComputedStyle(d, null) || {}).top !== '1%', b.boxSizingReliable = (a.getComputedStyle(d, null) || {
                    width: '4px'
                }).width === '4px', g = e.createElement('div'), g.style.cssText = d.style.cssText = h, g.style.marginRight = g.style.width = '0', d.style.width = '1px', d.appendChild(g), b.reliableMarginRight = !parseFloat((a.getComputedStyle(g, null) || {}).marginRight)),
                typeof d.style.zoom != 'undefined' && (d.innerHTML = '', d.style.cssText = h + 'width:1px;padding:1px;display:inline;zoom:1', b.inlineBlockNeedsLayout = d.offsetWidth === 3, d.style.display = 'block', d.style.overflow = 'visible', d.innerHTML = '<div></div>', d.firstChild.style.width = '5px', b.shrinkWrapBlocks = d.offsetWidth !== 3, c.style.zoom = 1),
                i.removeChild(c),
                c = d = f = g = null
            }),
            i.removeChild(n),
            c = d = f = g = h = i = n = null,
            b
    }();
    var H = /(?:\{[\s\S]*\}|\[[\s\S]*\])$/,
        I = /([A-Z])/g;
    p.extend({
        cache: {},
        deletedIds: [],
        uuid: 0,
        expando: 'jQuery' + (p.fn.jquery + Math.random()).replace(/\D/g, ''),
        noData: {
            embed: !0,
            object: 'clsid:D27CDB6E-AE6D-11cf-96B8-444553540000',
            applet: !0
        },
        hasData: function(a) {
            return a = a.nodeType ? p.cache[a[p.expando]] : a[p.expando], !!a && !K(a)
        },
        data: function(a, c, d, e) {
            if (!p.acceptData(a)) return;
            var f,
                g,
                h = p.expando,
                i = typeof c == 'string',
                j = a.nodeType,
                k = j ? p.cache : a,
                l = j ? a[h] : a[h] && h;
            if ((!l || !k[l] || !e && !k[l].data) && i && d === b) return;
            l || (j ? a[h] = l = p.deletedIds.pop() || ++p.uuid : l = h),
            k[l] || (k[l] = {}, j || (k[l].toJSON = p.noop));
            if (typeof c == 'object' || typeof c == 'function') e ? k[l] = p.extend(k[l], c) : k[l].data = p.extend(k[l].data, c);
            return f = k[l],
                e || (f.data || (f.data = {}), f = f.data),
                d !== b && (f[p.camelCase(c)] = d),
                i ? (g = f[c], g == null && (g = f[p.camelCase(c)])) : g = f,
                g
        },
        removeData: function(a, b, c) {
            if (!p.acceptData(a)) return;
            var d,
                e,
                f,
                g = a.nodeType,
                h = g ? p.cache : a,
                i = g ? a[p.expando] : p.expando;
            if (!h[i]) return;
            if (b) {
                d = c ? h[i] : h[i].data;
                if (d) {
                    p.isArray(b) || (b in d ? b = [
                        b
                    ] : (b = p.camelCase(b), b in d ? b = [
                        b
                    ] : b = b.split(' ')));
                    for (e = 0, f = b.length; e < f; e++) delete d[b[e]];
                    if (!(c ? K : p.isEmptyObject)(d)) return
                }
            }
            if (!c) {
                delete h[i].data;
                if (!K(h[i])) return
            }
            g ? p.cleanData([a], !0) : p.support.deleteExpando || h != h.window ? delete h[i] : h[i] = null
        },
        _data: function(a, b, c) {
            return p.data(a, b, c, !0)
        },
        acceptData: function(a) {
            var b = a.nodeName && p.noData[a.nodeName.toLowerCase()];
            return !b || b !== !0 && a.getAttribute('classid') === b
        }
    }),
    p.fn.extend({
        data: function(a, c) {
            var d,
                e,
                f,
                g,
                h,
                i = this[0],
                j = 0,
                k = null;
            if (a === b) {
                if (this.length) {
                    k = p.data(i);
                    if (i.nodeType === 1 && !p._data(i, 'parsedAttrs')) {
                        f = i.attributes;
                        for (h = f.length; j < h; j++) g = f[j].name,
                            g.indexOf('data-') === 0 && (g = p.camelCase(g.substring(5)), J(i, g, k[g]));
                        p._data(i, 'parsedAttrs', !0)
                    }
                }
                return k
            }
            return typeof a == 'object' ? this.each(function() {
                p.data(this, a)
            }) : (d = a.split('.', 2), d[1] = d[1] ? '.' + d[1] : '', e = d[1] + '!', p.access(this, function(c) {
                if (c === b) return k = this.triggerHandler('getData' + e, [
                        d[0]
                    ]),
                    k === b && i && (k = p.data(i, a), k = J(i, a, k)),
                    k === b && d[1] ? this.data(d[0]) : k;
                d[1] = c,
                this.each(function() {
                    var b = p(this);
                    b.triggerHandler('setData' + e, d),
                    p.data(this, a, c),
                    b.triggerHandler('changeData' + e, d)
                })
            }, null, c, arguments.length > 1, null, !1))
        },
        removeData: function(a) {
            return this.each(function() {
                p.removeData(this, a)
            })
        }
    }),
    p.extend({
        queue: function(a, b, c) {
            var d;
            if (a) return b = (b || 'fx') + 'queue',
                d = p._data(a, b),
                c && (!d || p.isArray(c) ? d = p._data(a, b, p.makeArray(c)) : d.push(c)),
                d || []
        },
        dequeue: function(a, b) {
            b = b || 'fx';
            var c = p.queue(a, b),
                d = c.length,
                e = c.shift(),
                f = p._queueHooks(a, b),
                g = function() {
                    p.dequeue(a, b)
                };
            e === 'inprogress' && (e = c.shift(), d--),
            e && (b === 'fx' && c.unshift('inprogress'), delete f.stop, e.call(a, g, f)), !d && f && f.empty.fire()
        },
        _queueHooks: function(a, b) {
            var c = b + 'queueHooks';
            return p._data(a, c) || p._data(a, c, {
                empty: p.Callbacks('once memory').add(function() {
                    p.removeData(a, b + 'queue', !0),
                    p.removeData(a, c, !0)
                })
            })
        }
    }),
    p.fn.extend({
        queue: function(a, c) {
            var d = 2;
            return typeof a != 'string' && (c = a, a = 'fx', d--),
                arguments.length < d ? p.queue(this[0], a) : c === b ? this : this.each(function() {
                    var b = p.queue(this, a, c);
                    p._queueHooks(this, a),
                    a === 'fx' && b[0] !== 'inprogress' && p.dequeue(this, a)
                })
        },
        dequeue: function(a) {
            return this.each(function() {
                p.dequeue(this, a)
            })
        },
        delay: function(a, b) {
            return a = p.fx ? p.fx.speeds[a] || a : a,
                b = b || 'fx',
                this.queue(b, function(b, c) {
                    var d = setTimeout(b, a);
                    c.stop = function() {
                        clearTimeout(d)
                    }
                })
        },
        clearQueue: function(a) {
            return this.queue(a || 'fx', [])
        },
        promise: function(a, c) {
            var d,
                e = 1,
                f = p.Deferred(),
                g = this,
                h = this.length,
                i = function() {
                    --e || f.resolveWith(g, [
                        g
                    ])
                };
            typeof a != 'string' && (c = a, a = b),
            a = a || 'fx';
            while (h--) d = p._data(g[h], a + 'queueHooks'),
                d && d.empty && (e++, d.empty.add(i));
            return i(),
                f.promise(c)
        }
    });
    var L,
        M,
        N,
        O = /[\t\r\n]/g,
        P = /\r/g,
        Q = /^(?:button|input)$/i,
        R = /^(?:button|input|object|select|textarea)$/i,
        S = /^a(?:rea|)$/i,
        T = /^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,
        U = p.support.getSetAttribute;
    p.fn.extend({
        attr: function(a, b) {
            return p.access(this, p.attr, a, b, arguments.length > 1)
        },
        removeAttr: function(a) {
            return this.each(function() {
                p.removeAttr(this, a)
            })
        },
        prop: function(a, b) {
            return p.access(this, p.prop, a, b, arguments.length > 1)
        },
        removeProp: function(a) {
            return a = p.propFix[a] || a,
                this.each(function() {
                    try {
                        this[a] = b,
                        delete this[a]
                    } catch (c) {}
                })
        },
        addClass: function(a) {
            var b,
                c,
                d,
                e,
                f,
                g,
                h;
            if (p.isFunction(a)) return this.each(function(b) {
                p(this).addClass(a.call(this, b, this.className))
            });
            if (a && typeof a == 'string') {
                b = a.split(s);
                for (c = 0, d = this.length; c < d; c++) {
                    e = this[c];
                    if (e.nodeType === 1)
                        if (!e.className && b.length === 1) e.className = a;
                        else {
                            f = ' ' + e.className + ' ';
                            for (g = 0, h = b.length; g < h; g++)~ f.indexOf(' ' + b[g] + ' ') || (f += b[g] + ' ');
                            e.className = p.trim(f)
                        }
                }
            }
            return this
        },
        removeClass: function(a) {
            var c,
                d,
                e,
                f,
                g,
                h,
                i;
            if (p.isFunction(a)) return this.each(function(b) {
                p(this).removeClass(a.call(this, b, this.className))
            });
            if (a && typeof a == 'string' || a === b) {
                c = (a || '').split(s);
                for (h = 0, i = this.length; h < i; h++) {
                    e = this[h];
                    if (e.nodeType === 1 && e.className) {
                        d = (' ' + e.className + ' ').replace(O, ' ');
                        for (f = 0, g = c.length; f < g; f++)
                            while (d.indexOf(' ' + c[f] + ' ') > -1) d = d.replace(' ' + c[f] + ' ', ' ');
                        e.className = a ? p.trim(d) : ''
                    }
                }
            }
            return this
        },
        toggleClass: function(a, b) {
            var c = typeof a,
                d = typeof b == 'boolean';
            return p.isFunction(a) ? this.each(function(c) {
                p(this).toggleClass(a.call(this, c, this.className, b), b)
            }) : this.each(function() {
                if (c === 'string') {
                    var e,
                        f = 0,
                        g = p(this),
                        h = b,
                        i = a.split(s);
                    while (e = i[f++]) h = d ? h : !g.hasClass(e),
                        g[h ? 'addClass' : 'removeClass'](e)
                } else if (c === 'undefined' || c === 'boolean') this.className && p._data(this, '__className__', this.className),
                    this.className = this.className || a === !1 ? '' : p._data(this, '__className__') || ''
            })
        },
        hasClass: function(a) {
            var b = ' ' + a + ' ',
                c = 0,
                d = this.length;
            for (; c < d; c++)
                if (this[c].nodeType === 1 && (' ' + this[c].className + ' ').replace(O, ' ').indexOf(b) > -1) return !0;
            return !1
        },
        val: function(a) {
            var c,
                d,
                e,
                f = this[0];
            if (!arguments.length) {
                if (f) return c = p.valHooks[f.type] || p.valHooks[f.nodeName.toLowerCase()],
                    c && 'get' in c && (d = c.get(f, 'value')) !== b ? d : (d = f.value, typeof d == 'string' ? d.replace(P, '') : d == null ? '' : d);
                return
            }
            return e = p.isFunction(a),
                this.each(function(d) {
                    var f,
                        g = p(this);
                    if (this.nodeType !== 1) return;
                    e ? f = a.call(this, d, g.val()) : f = a,
                    f == null ? f = '' : typeof f == 'number' ? f += '' : p.isArray(f) && (f = p.map(f, function(a) {
                        return a == null ? '' : a + ''
                    })),
                    c = p.valHooks[this.type] || p.valHooks[this.nodeName.toLowerCase()];
                    if (!c || !('set' in c) || c.set(this, f, 'value') === b) this.value = f
                })
        }
    }),
    p.extend({
        valHooks: {
            option: {
                get: function(a) {
                    var b = a.attributes.value;
                    return !b || b.specified ? a.value : a.text
                }
            },
            select: {
                get: function(a) {
                    var b,
                        c,
                        d,
                        e,
                        f = a.selectedIndex,
                        g = [],
                        h = a.options,
                        i = a.type === 'select-one';
                    if (f < 0) return null;
                    c = i ? f : 0,
                    d = i ? f + 1 : h.length;
                    for (; c < d; c++) {
                        e = h[c];
                        if (e.selected && (p.support.optDisabled ? !e.disabled : e.getAttribute('disabled') === null) && (!e.parentNode.disabled || !p.nodeName(e.parentNode, 'optgroup'))) {
                            b = p(e).val();
                            if (i) return b;
                            g.push(b)
                        }
                    }
                    return i && !g.length && h.length ? p(h[f]).val() : g
                },
                set: function(a, b) {
                    var c = p.makeArray(b);
                    return p(a).find('option').each(function() {
                            this.selected = p.inArray(p(this).val(), c) >= 0
                        }),
                        c.length || (a.selectedIndex = -1),
                        c
                }
            }
        },
        attrFn: {},
        attr: function(a, c, d, e) {
            var f,
                g,
                h,
                i = a.nodeType;
            if (!a || i === 3 || i === 8 || i === 2) return;
            if (e && p.isFunction(p.fn[c])) return p(a)[c](d);
            if (typeof a.getAttribute == 'undefined') return p.prop(a, c, d);
            h = i !== 1 || !p.isXMLDoc(a),
            h && (c = c.toLowerCase(), g = p.attrHooks[c] || (T.test(c) ? M : L));
            if (d !== b) {
                if (d === null) {
                    p.removeAttr(a, c);
                    return
                }
                return g && 'set' in g && h && (f = g.set(a, d, c)) !== b ? f : (a.setAttribute(c, '' + d), d)
            }
            return g && 'get' in g && h && (f = g.get(a, c)) !== null ? f : (f = a.getAttribute(c), f === null ? b : f)
        },
        removeAttr: function(a, b) {
            var c,
                d,
                e,
                f,
                g = 0;
            if (b && a.nodeType === 1) {
                d = b.split(s);
                for (; g < d.length; g++) e = d[g],
                    e && (c = p.propFix[e] || e, f = T.test(e), f || p.attr(a, e, ''), a.removeAttribute(U ? e : c), f && c in a && (a[c] = !1))
            }
        },
        attrHooks: {
            type: {
                set: function(a, b) {
                    if (Q.test(a.nodeName) && a.parentNode) p.error('type property can\'t be changed');
                    else if (!p.support.radioValue && b === 'radio' && p.nodeName(a, 'input')) {
                        var c = a.value;
                        return a.setAttribute('type', b),
                            c && (a.value = c),
                            b
                    }
                }
            },
            value: {
                get: function(a, b) {
                    return L && p.nodeName(a, 'button') ? L.get(a, b) : b in a ? a.value : null
                },
                set: function(a, b, c) {
                    if (L && p.nodeName(a, 'button')) return L.set(a, b, c);
                    a.value = b
                }
            }
        },
        propFix: {
            tabindex: 'tabIndex',
            readonly: 'readOnly',
            'for': 'htmlFor',
            'class': 'className',
            maxlength: 'maxLength',
            cellspacing: 'cellSpacing',
            cellpadding: 'cellPadding',
            rowspan: 'rowSpan',
            colspan: 'colSpan',
            usemap: 'useMap',
            frameborder: 'frameBorder',
            contenteditable: 'contentEditable'
        },
        prop: function(a, c, d) {
            var e,
                f,
                g,
                h = a.nodeType;
            if (!a || h === 3 || h === 8 || h === 2) return;
            return g = h !== 1 || !p.isXMLDoc(a),
                g && (c = p.propFix[c] || c, f = p.propHooks[c]),
                d !== b ? f && 'set' in f && (e = f.set(a, d, c)) !== b ? e : a[c] = d : f && 'get' in f && (e = f.get(a, c)) !== null ? e : a[c]
        },
        propHooks: {
            tabIndex: {
                get: function(a) {
                    var c = a.getAttributeNode('tabindex');
                    return c && c.specified ? parseInt(c.value, 10) : R.test(a.nodeName) || S.test(a.nodeName) && a.href ? 0 : b
                }
            }
        }
    }),
    M = {
        get: function(a, c) {
            var d,
                e = p.prop(a, c);
            return e === !0 || typeof e != 'boolean' && (d = a.getAttributeNode(c)) && d.nodeValue !== !1 ? c.toLowerCase() : b
        },
        set: function(a, b, c) {
            var d;
            return b === !1 ? p.removeAttr(a, c) : (d = p.propFix[c] || c, d in a && (a[d] = !0), a.setAttribute(c, c.toLowerCase())),
                c
        }
    },
    U || (N = {
        name: !0,
        id: !0,
        coords: !0
    }, L = p.valHooks.button = {
        get: function(a, c) {
            var d;
            return d = a.getAttributeNode(c),
                d && (N[c] ? d.value !== '' : d.specified) ? d.value : b
        },
        set: function(a, b, c) {
            var d = a.getAttributeNode(c);
            return d || (d = e.createAttribute(c), a.setAttributeNode(d)),
                d.value = b + ''
        }
    }, p.each(['width',
        'height'
    ], function(a, b) {
        p.attrHooks[b] = p.extend(p.attrHooks[b], {
            set: function(a, c) {
                if (c === '') return a.setAttribute(b, 'auto'),
                    c
            }
        })
    }), p.attrHooks.contenteditable = {
        get: L.get,
        set: function(a, b, c) {
            b === '' && (b = 'false'),
            L.set(a, b, c)
        }
    }),
    p.support.hrefNormalized || p.each(['href',
        'src',
        'width',
        'height'
    ], function(a, c) {
        p.attrHooks[c] = p.extend(p.attrHooks[c], {
            get: function(a) {
                var d = a.getAttribute(c, 2);
                return d === null ? b : d
            }
        })
    }),
    p.support.style || (p.attrHooks.style = {
        get: function(a) {
            return a.style.cssText.toLowerCase() || b
        },
        set: function(a, b) {
            return a.style.cssText = '' + b
        }
    }),
    p.support.optSelected || (p.propHooks.selected = p.extend(p.propHooks.selected, {
        get: function(a) {
            var b = a.parentNode;
            return b && (b.selectedIndex, b.parentNode && b.parentNode.selectedIndex),
                null
        }
    })),
    p.support.enctype || (p.propFix.enctype = 'encoding'),
    p.support.checkOn || p.each(['radio',
        'checkbox'
    ], function() {
        p.valHooks[this] = {
            get: function(a) {
                return a.getAttribute('value') === null ? 'on' : a.value
            }
        }
    }),
    p.each(['radio',
        'checkbox'
    ], function() {
        p.valHooks[this] = p.extend(p.valHooks[this], {
            set: function(a, b) {
                if (p.isArray(b)) return a.checked = p.inArray(p(a).val(), b) >= 0
            }
        })
    });
    var V = /^(?:textarea|input|select)$/i,
        W = /^([^\.]*|)(?:\.(.+)|)$/,
        X = /(?:^|\s)hover(\.\S+|)\b/,
        Y = /^key/,
        Z = /^(?:mouse|contextmenu)|click/,
        $ = /^(?:focusinfocus|focusoutblur)$/,
        _ = function(a) {
            return p.event.special.hover ? a : a.replace(X, 'mouseenter$1 mouseleave$1')
        };
    p.event = {
        add: function(a, c, d, e, f) {
            var g,
                h,
                i,
                j,
                k,
                l,
                m,
                n,
                o,
                q,
                r;
            if (a.nodeType === 3 || a.nodeType === 8 || !c || !d || !(g = p._data(a))) return;
            d.handler && (o = d, d = o.handler, f = o.selector),
            d.guid || (d.guid = p.guid++),
            i = g.events,
            i || (g.events = i = {}),
            h = g.handle,
            h || (g.handle = h = function(a) {
                return typeof p != 'undefined' && (!a || p.event.triggered !== a.type) ? p.event.dispatch.apply(h.elem, arguments) : b
            }, h.elem = a),
            c = p.trim(_(c)).split(' ');
            for (j = 0; j < c.length; j++) {
                k = W.exec(c[j]) || [],
                l = k[1],
                m = (k[2] || '').split('.').sort(),
                r = p.event.special[l] || {},
                l = (f ? r.delegateType : r.bindType) || l,
                r = p.event.special[l] || {},
                n = p.extend({
                    type: l,
                    origType: k[1],
                    data: e,
                    handler: d,
                    guid: d.guid,
                    selector: f,
                    namespace: m.join('.')
                }, o),
                q = i[l];
                if (!q) {
                    q = i[l] = [],
                    q.delegateCount = 0;
                    if (!r.setup || r.setup.call(a, e, m, h) === !1) a.addEventListener ? a.addEventListener(l, h, !1) : a.attachEvent && a.attachEvent('on' + l, h)
                }
                r.add && (r.add.call(a, n), n.handler.guid || (n.handler.guid = d.guid)),
                f ? q.splice(q.delegateCount++, 0, n) : q.push(n),
                p.event.global[l] = !0
            }
            a = null
        },
        global: {},
        remove: function(a, b, c, d, e) {
            var f,
                g,
                h,
                i,
                j,
                k,
                l,
                m,
                n,
                o,
                q,
                r = p.hasData(a) && p._data(a);
            if (!r || !(m = r.events)) return;
            b = p.trim(_(b || '')).split(' ');
            for (f = 0; f < b.length; f++) {
                g = W.exec(b[f]) || [],
                h = i = g[1],
                j = g[2];
                if (!h) {
                    for (h in m) p.event.remove(a, h + b[f], c, d, !0);
                    continue
                }
                n = p.event.special[h] || {},
                h = (d ? n.delegateType : n.bindType) || h,
                o = m[h] || [],
                k = o.length,
                j = j ? new RegExp('(^|\\.)' + j.split('.').sort().join('\\.(?:.*\\.|)') + '(\\.|$)') : null;
                for (l = 0; l < o.length; l++) q = o[l], (e || i === q.origType) && (!c || c.guid === q.guid) && (!j || j.test(q.namespace)) && (!d || d === q.selector || d === '**' && q.selector) && (o.splice(l--, 1), q.selector && o.delegateCount--, n.remove && n.remove.call(a, q));
                o.length === 0 && k !== o.length && ((!n.teardown || n.teardown.call(a, j, r.handle) === !1) && p.removeEvent(a, h, r.handle), delete m[h])
            }
            p.isEmptyObject(m) && (delete r.handle, p.removeData(a, 'events', !0))
        },
        customEvent: {
            getData: !0,
            setData: !0,
            changeData: !0
        },
        trigger: function(c, d, f, g) {
            if (!f || f.nodeType !== 3 && f.nodeType !== 8) {
                var h,
                    i,
                    j,
                    k,
                    l,
                    m,
                    n,
                    o,
                    q,
                    r,
                    s = c.type || c,
                    t = [];
                if ($.test(s + p.event.triggered)) return;
                s.indexOf('!') >= 0 && (s = s.slice(0, -1), i = !0),
                s.indexOf('.') >= 0 && (t = s.split('.'), s = t.shift(), t.sort());
                if ((!f || p.event.customEvent[s]) && !p.event.global[s]) return;
                c = typeof c == 'object' ? c[p.expando] ? c : new p.Event(s, c) : new p.Event(s),
                c.type = s,
                c.isTrigger = !0,
                c.exclusive = i,
                c.namespace = t.join('.'),
                c.namespace_re = c.namespace ? new RegExp('(^|\\.)' + t.join('\\.(?:.*\\.|)') + '(\\.|$)') : null,
                m = s.indexOf(':') < 0 ? 'on' + s : '';
                if (!f) {
                    h = p.cache;
                    for (j in h) h[j].events && h[j].events[s] && p.event.trigger(c, d, h[j].handle.elem, !0);
                    return
                }
                c.result = b,
                c.target || (c.target = f),
                d = d != null ? p.makeArray(d) : [],
                d.unshift(c),
                n = p.event.special[s] || {};
                if (n.trigger && n.trigger.apply(f, d) === !1) return;
                q = [
                    [f,
                        n.bindType || s
                    ]
                ];
                if (!g && !n.noBubble && !p.isWindow(f)) {
                    r = n.delegateType || s,
                    k = $.test(r + s) ? f : f.parentNode;
                    for (l = f; k; k = k.parentNode) q.push([k,
                            r
                        ]),
                        l = k;
                    l === (f.ownerDocument || e) && q.push([l.defaultView || l.parentWindow || a,
                        r
                    ])
                }
                for (j = 0; j < q.length && !c.isPropagationStopped(); j++) k = q[j][0],
                    c.type = q[j][1],
                    o = (p._data(k, 'events') || {})[c.type] && p._data(k, 'handle'),
                    o && o.apply(k, d),
                    o = m && k[m],
                    o && p.acceptData(k) && o.apply(k, d) === !1 && c.preventDefault();
                return c.type = s, !g && !c.isDefaultPrevented() && (!n._default || n._default.apply(f.ownerDocument, d) === !1) && (s !== 'click' || !p.nodeName(f, 'a')) && p.acceptData(f) && m && f[s] && (s !== 'focus' && s !== 'blur' || c.target.offsetWidth !== 0) && !p.isWindow(f) && (l = f[m], l && (f[m] = null), p.event.triggered = s, f[s](), p.event.triggered = b, l && (f[m] = l)),
                    c.result
            }
            return
        },
        dispatch: function(c) {
            c = p.event.fix(c || a.event);
            var d,
                e,
                f,
                g,
                h,
                i,
                j,
                k,
                l,
                m,
                n = (p._data(this, 'events') || {})[c.type] || [],
                o = n.delegateCount,
                q = [].slice.call(arguments),
                r = !c.exclusive && !c.namespace,
                s = p.event.special[c.type] || {},
                t = [];
            q[0] = c,
            c.delegateTarget = this;
            if (s.preDispatch && s.preDispatch.call(this, c) === !1) return;
            if (o && (!c.button || c.type !== 'click'))
                for (f = c.target; f != this; f = f.parentNode || this)
                    if (f.disabled !== !0 || c.type !== 'click') {
                        h = {},
                        j = [];
                        for (d = 0; d < o; d++) k = n[d],
                            l = k.selector,
                            h[l] === b && (h[l] = p(l, this).index(f) >= 0),
                            h[l] && j.push(k);
                        j.length && t.push({
                            elem: f,
                            matches: j
                        })
                    }
            n.length > o && t.push({
                elem: this,
                matches: n.slice(o)
            });
            for (d = 0; d < t.length && !c.isPropagationStopped(); d++) {
                i = t[d],
                c.currentTarget = i.elem;
                for (e = 0; e < i.matches.length && !c.isImmediatePropagationStopped(); e++) {
                    k = i.matches[e];
                    if (r || !c.namespace && !k.namespace || c.namespace_re && c.namespace_re.test(k.namespace)) c.data = k.data,
                        c.handleObj = k,
                        g = ((p.event.special[k.origType] || {}).handle || k.handler).apply(i.elem, q),
                        g !== b && (c.result = g, g === !1 && (c.preventDefault(), c.stopPropagation()))
                }
            }
            return s.postDispatch && s.postDispatch.call(this, c),
                c.result
        },
        props: 'attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which'.split(' '),
        fixHooks: {},
        keyHooks: {
            props: 'char charCode key keyCode'.split(' '),
            filter: function(a, b) {
                return a.which == null && (a.which = b.charCode != null ? b.charCode : b.keyCode),
                    a
            }
        },
        mouseHooks: {
            props: 'button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement'.split(' '),
            filter: function(a, c) {
                var d,
                    f,
                    g,
                    h = c.button,
                    i = c.fromElement;
                return a.pageX == null && c.clientX != null && (d = a.target.ownerDocument || e, f = d.documentElement, g = d.body, a.pageX = c.clientX + (f && f.scrollLeft || g && g.scrollLeft || 0) - (f && f.clientLeft || g && g.clientLeft || 0), a.pageY = c.clientY + (f && f.scrollTop || g && g.scrollTop || 0) - (f && f.clientTop || g && g.clientTop || 0)), !a.relatedTarget && i && (a.relatedTarget = i === a.target ? c.toElement : i), !a.which && h !== b && (a.which = h & 1 ? 1 : h & 2 ? 3 : h & 4 ? 2 : 0),
                    a
            }
        },
        fix: function(a) {
            if (a[p.expando]) return a;
            var b,
                c,
                d = a,
                f = p.event.fixHooks[a.type] || {},
                g = f.props ? this.props.concat(f.props) : this.props;
            a = p.Event(d);
            for (b = g.length; b;) c = g[--b],
                a[c] = d[c];
            return a.target || (a.target = d.srcElement || e),
                a.target.nodeType === 3 && (a.target = a.target.parentNode),
                a.metaKey = !!a.metaKey,
                f.filter ? f.filter(a, d) : a
        },
        special: {
            load: {
                noBubble: !0
            },
            focus: {
                delegateType: 'focusin'
            },
            blur: {
                delegateType: 'focusout'
            },
            beforeunload: {
                setup: function(a, b, c) {
                    p.isWindow(this) && (this.onbeforeunload = c)
                },
                teardown: function(a, b) {
                    this.onbeforeunload === b && (this.onbeforeunload = null)
                }
            }
        },
        simulate: function(a, b, c, d) {
            var e = p.extend(new p.Event, c, {
                type: a,
                isSimulated: !0,
                originalEvent: {}
            });
            d ? p.event.trigger(e, null, b) : p.event.dispatch.call(b, e),
            e.isDefaultPrevented() && c.preventDefault()
        }
    },
    p.event.handle = p.event.dispatch,
    p.removeEvent = e.removeEventListener ? function(a, b, c) {
        a.removeEventListener && a.removeEventListener(b, c, !1)
    } : function(a, b, c) {
        var d = 'on' + b;
        a.detachEvent && (typeof a[d] == 'undefined' && (a[d] = null), a.detachEvent(d, c))
    },
    p.Event = function(a, b) {
        if (this instanceof p.Event) a && a.type ? (this.originalEvent = a, this.type = a.type, this.isDefaultPrevented = a.defaultPrevented || a.returnValue === !1 || a.getPreventDefault && a.getPreventDefault() ? bb : ba) : this.type = a,
            b && p.extend(this, b),
            this.timeStamp = a && a.timeStamp || p.now(),
            this[p.expando] = !0;
        else return new p.Event(a, b)
    },
    p.Event.prototype = {
        preventDefault: function() {
            this.isDefaultPrevented = bb;
            var a = this.originalEvent;
            if (!a) return;
            a.preventDefault ? a.preventDefault() : a.returnValue = !1
        },
        stopPropagation: function() {
            this.isPropagationStopped = bb;
            var a = this.originalEvent;
            if (!a) return;
            a.stopPropagation && a.stopPropagation(),
            a.cancelBubble = !0
        },
        stopImmediatePropagation: function() {
            this.isImmediatePropagationStopped = bb,
            this.stopPropagation()
        },
        isDefaultPrevented: ba,
        isPropagationStopped: ba,
        isImmediatePropagationStopped: ba
    },
    p.each({
        mouseenter: 'mouseover',
        mouseleave: 'mouseout'
    }, function(a, b) {
        p.event.special[a] = {
            delegateType: b,
            bindType: b,
            handle: function(a) {
                var c,
                    d = this,
                    e = a.relatedTarget,
                    f = a.handleObj,
                    g = f.selector;
                if (!e || e !== d && !p.contains(d, e)) a.type = f.origType,
                    c = f.handler.apply(this, arguments),
                    a.type = b;
                return c
            }
        }
    }),
    p.support.submitBubbles || (p.event.special.submit = {
        setup: function() {
            if (p.nodeName(this, 'form')) return !1;
            p.event.add(this, 'click._submit keypress._submit', function(a) {
                var c = a.target,
                    d = p.nodeName(c, 'input') || p.nodeName(c, 'button') ? c.form : b;
                d && !p._data(d, '_submit_attached') && (p.event.add(d, 'submit._submit', function(a) {
                    a._submit_bubble = !0
                }), p._data(d, '_submit_attached', !0))
            })
        },
        postDispatch: function(a) {
            a._submit_bubble && (delete a._submit_bubble, this.parentNode && !a.isTrigger && p.event.simulate('submit', this.parentNode, a, !0))
        },
        teardown: function() {
            if (p.nodeName(this, 'form')) return !1;
            p.event.remove(this, '._submit')
        }
    }),
    p.support.changeBubbles || (p.event.special.change = {
        setup: function() {
            if (V.test(this.nodeName)) {
                if (this.type === 'checkbox' || this.type === 'radio') p.event.add(this, 'propertychange._change', function(a) {
                        a.originalEvent.propertyName === 'checked' && (this._just_changed = !0)
                    }),
                    p.event.add(this, 'click._change', function(a) {
                        this._just_changed && !a.isTrigger && (this._just_changed = !1),
                        p.event.simulate('change', this, a, !0)
                    });
                return !1
            }
            p.event.add(this, 'beforeactivate._change', function(a) {
                var b = a.target;
                V.test(b.nodeName) && !p._data(b, '_change_attached') && (p.event.add(b, 'change._change', function(a) {
                    this.parentNode && !a.isSimulated && !a.isTrigger && p.event.simulate('change', this.parentNode, a, !0)
                }), p._data(b, '_change_attached', !0))
            })
        },
        handle: function(a) {
            var b = a.target;
            if (this !== b || a.isSimulated || a.isTrigger || b.type !== 'radio' && b.type !== 'checkbox') return a.handleObj.handler.apply(this, arguments)
        },
        teardown: function() {
            return p.event.remove(this, '._change'), !V.test(this.nodeName)
        }
    }),
    p.support.focusinBubbles || p.each({
        focus: 'focusin',
        blur: 'focusout'
    }, function(a, b) {
        var c = 0,
            d = function(a) {
                p.event.simulate(b, a.target, p.event.fix(a), !0)
            };
        p.event.special[b] = {
            setup: function() {
                c++ === 0 && e.addEventListener(a, d, !0)
            },
            teardown: function() {
                --c === 0 && e.removeEventListener(a, d, !0)
            }
        }
    }),
    p.fn.extend({
        on: function(a, c, d, e, f) {
            var g,
                h;
            if (typeof a == 'object') {
                typeof c != 'string' && (d = d || c, c = b);
                for (h in a) this.on(h, c, d, a[h], f);
                return this
            }
            d == null && e == null ? (e = c, d = c = b) : e == null && (typeof c == 'string' ? (e = d, d = b) : (e = d, d = c, c = b));
            if (e === !1) e = ba;
            else if (!e) return this;
            return f === 1 && (g = e, e = function(a) {
                    return p().off(a),
                        g.apply(this, arguments)
                }, e.guid = g.guid || (g.guid = p.guid++)),
                this.each(function() {
                    p.event.add(this, a, e, d, c)
                })
        },
        one: function(a, b, c, d) {
            return this.on(a, b, c, d, 1)
        },
        off: function(a, c, d) {
            var e,
                f;
            if (a && a.preventDefault && a.handleObj) return e = a.handleObj,
                p(a.delegateTarget).off(e.namespace ? e.origType + '.' + e.namespace : e.origType, e.selector, e.handler),
                this;
            if (typeof a == 'object') {
                for (f in a) this.off(f, c, a[f]);
                return this
            }
            if (c === !1 || typeof c == 'function') d = c,
                c = b;
            return d === !1 && (d = ba),
                this.each(function() {
                    p.event.remove(this, a, d, c)
                })
        },
        bind: function(a, b, c) {
            return this.on(a, null, b, c)
        },
        unbind: function(a, b) {
            return this.off(a, null, b)
        },
        live: function(a, b, c) {
            return p(this.context).on(a, this.selector, b, c),
                this
        },
        die: function(a, b) {
            return p(this.context).off(a, this.selector || '**', b),
                this
        },
        delegate: function(a, b, c, d) {
            return this.on(b, a, c, d)
        },
        undelegate: function(a, b, c) {
            return arguments.length == 1 ? this.off(a, '**') : this.off(b, a || '**', c)
        },
        trigger: function(a, b) {
            return this.each(function() {
                p.event.trigger(a, b, this)
            })
        },
        triggerHandler: function(a, b) {
            if (this[0]) return p.event.trigger(a, b, this[0], !0)
        },
        toggle: function(a) {
            var b = arguments,
                c = a.guid || p.guid++,
                d = 0,
                e = function(c) {
                    var e = (p._data(this, 'lastToggle' + a.guid) || 0) % d;
                    return p._data(this, 'lastToggle' + a.guid, e + 1),
                        c.preventDefault(),
                        b[e].apply(this, arguments) || !1
                };
            e.guid = c;
            while (d < b.length) b[d++].guid = c;
            return this.click(e)
        },
        hover: function(a, b) {
            return this.mouseenter(a).mouseleave(b || a)
        }
    }),
    p.each('blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu'.split(' '), function(a, b) {
        p.fn[b] = function(a, c) {
            return c == null && (c = a, a = null),
                arguments.length > 0 ? this.on(b, null, a, c) : this.trigger(b)
        },
        Y.test(b) && (p.event.fixHooks[b] = p.event.keyHooks),
        Z.test(b) && (p.event.fixHooks[b] = p.event.mouseHooks)
    }),
    function(a, b) {
        function $(a, b, c, d) {
            c = c || [],
            b = b || q;
            var e,
                f,
                g,
                j,
                k = b.nodeType;
            if (k !== 1 && k !== 9) return [];
            if (!a || typeof a != 'string') return c;
            g = h(b);
            if (!g && !d)
                if (e = L.exec(a))
                    if (j = e[1]) {
                        if (k === 9) {
                            f = b.getElementById(j);
                            if (!f || !f.parentNode) return c;
                            if (f.id === j) return c.push(f),
                                c
                        } else if (b.ownerDocument && (f = b.ownerDocument.getElementById(j)) && i(b, f) && f.id === j) return c.push(f),
                            c
                    } else {
                        if (e[2]) return u.apply(c, t.call(b.getElementsByTagName(a), 0)),
                            c;
                        if ((j = e[3]) && X && b.getElementsByClassName) return u.apply(c, t.call(b.getElementsByClassName(j), 0)),
                            c
                    }
            return bk(a, b, c, d, g)
        }

        function _(a) {
            return function(b) {
                var c = b.nodeName.toLowerCase();
                return c === 'input' && b.type === a
            }
        }

        function ba(a) {
            return function(b) {
                var c = b.nodeName.toLowerCase();
                return (c === 'input' || c === 'button') && b.type === a
            }
        }

        function bb(a, b, c) {
            if (a === b) return c;
            var d = a.nextSibling;
            while (d) {
                if (d === b) return -1;
                d = d.nextSibling
            }
            return 1
        }

        function bc(a, b, c, d) {
            var e,
                g,
                h,
                i,
                j,
                k,
                l,
                m,
                n,
                p,
                r = !c && b !== q,
                s = (r ? '<s>' : '') + a.replace(H, '$1<s>'),
                u = y[o][s];
            if (u) return d ? 0 : t.call(u, 0);
            j = a,
            k = [],
            m = 0,
            n = f.preFilter,
            p = f.filter;
            while (j) {
                if (!e || (g = I.exec(j))) g && (j = j.slice(g[0].length), h.selector = l),
                    k.push(h = []),
                    l = '',
                    r && (j = ' ' + j);
                e = !1;
                if (g = J.exec(j)) l += g[0],
                    j = j.slice(g[0].length),
                    e = h.push({
                        part: g.pop().replace(H, ' '),
                        string: g[0],
                        captures: g
                    });
                for (i in p)(g = S[i].exec(j)) && (!n[i] || (g = n[i](g, b, c))) && (l += g[0], j = j.slice(g[0].length), e = h.push({
                    part: i,
                    string: g.shift(),
                    captures: g
                }));
                if (!e) break
            }
            return l && (h.selector = l),
                d ? j.length : j ? $.error(a) : t.call(y(s, k), 0)
        }

        function bd(a, b, e, f) {
            var g = b.dir,
                h = s++;
            return a || (a = function(a) {
                    return a === e
                }),
                b.first ? function(b) {
                    while (b = b[g])
                        if (b.nodeType === 1) return a(b) && b
                } : f ? function(b) {
                    while (b = b[g])
                        if (b.nodeType === 1 && a(b)) return b
                } : function(b) {
                    var e,
                        f = h + '.' + c,
                        i = f + '.' + d;
                    while (b = b[g])
                        if (b.nodeType === 1) {
                            if ((e = b[o]) === i) return b.sizset;
                            if (typeof e == 'string' && e.indexOf(f) === 0) {
                                if (b.sizset) return b
                            } else {
                                b[o] = i;
                                if (a(b)) return b.sizset = !0,
                                    b;
                                b.sizset = !1
                            }
                        }
                }
        }

        function be(a, b) {
            return a ? function(c) {
                var d = b(c);
                return d && a(d === !0 ? c : d)
            } : b
        }

        function bf(a, b, c) {
            var d,
                e,
                g = 0;
            for (; d = a[g]; g++) f.relative[d.part] ? e = bd(e, f.relative[d.part], b, c) : e = be(e, f.filter[d.part].apply(null, d.captures.concat(b, c)));
            return e
        }

        function bg(a) {
            return function(b) {
                var c,
                    d = 0;
                for (; c = a[d]; d++)
                    if (c(b)) return !0;
                return !1
            }
        }

        function bh(a, b, c, d) {
            var e = 0,
                f = b.length;
            for (; e < f; e++) $(a, b[e], c, d)
        }

        function bi(a, b, c, d, e, g) {
            var h,
                i = f.setFilters[b.toLowerCase()];
            return i || $.error(b), (a || !(h = e)) && bh(a || '*', d, h = [], e),
                h.length > 0 ? i(h, c, g) : []
        }

        function bj(a, c, d, e) {
            var f,
                g,
                h,
                i,
                j,
                k,
                l,
                m,
                n,
                o,
                p,
                q,
                r,
                s = 0,
                t = a.length,
                v = S.POS,
                w = new RegExp('^' + v.source + '(?!' + A + ')', 'i'),
                x = function() {
                    var a = 1,
                        c = arguments.length - 2;
                    for (; a < c; a++) arguments[a] === b && (n[a] = b)
                };
            for (; s < t; s++) {
                f = a[s],
                g = '',
                m = e;
                for (h = 0, i = f.length; h < i; h++) {
                    j = f[h],
                    k = j.string;
                    if (j.part === 'PSEUDO') {
                        v.exec(''),
                        l = 0;
                        while (n = v.exec(k)) {
                            o = !0,
                            p = v.lastIndex = n.index + n[0].length;
                            if (p > l) {
                                g += k.slice(l, n.index),
                                l = p,
                                q = [
                                    c
                                ],
                                J.test(g) && (m && (q = m), m = e);
                                if (r = O.test(g)) g = g.slice(0, -5).replace(J, '$&*'),
                                    l++;
                                n.length > 1 && n[0].replace(w, x),
                                m = bi(g, n[1], n[2], q, m, r)
                            }
                            g = ''
                        }
                    }
                    o || (g += k),
                    o = !1
                }
                g ? J.test(g) ? bh(g, m || [c], d, e) : $(g, c, d, e ? e.concat(m) : m) : u.apply(d, m)
            }
            return t === 1 ? d : $.uniqueSort(d)
        }

        function bk(a, b, e, g, h) {
            a = a.replace(H, '$1');
            var i,
                k,
                l,
                m,
                n,
                o,
                p,
                q,
                r,
                s,
                v = bc(a, b, h),
                w = b.nodeType;
            if (S.POS.test(a)) return bj(v, b, e, g);
            if (g) i = t.call(g, 0);
            else if (v.length === 1) {
                if ((o = t.call(v[0], 0)).length > 2 && (p = o[0]).part === 'ID' && w === 9 && !h && f.relative[o[1].part]) {
                    b = f.find.ID(p.captures[0].replace(R, ''), b, h)[0];
                    if (!b) return e;
                    a = a.slice(o.shift().string.length)
                }
                r = (v = N.exec(o[0].string)) && !v.index && b.parentNode || b,
                q = '';
                for (n = o.length - 1; n >= 0; n--) {
                    p = o[n],
                    s = p.part,
                    q = p.string + q;
                    if (f.relative[s]) break;
                    if (f.order.test(s)) {
                        i = f.find[s](p.captures[0].replace(R, ''), r, h);
                        if (i == null) continue;
                        a = a.slice(0, a.length - q.length) + q.replace(S[s], ''),
                        a || u.apply(e, t.call(i, 0));
                        break
                    }
                }
            }
            if (a) {
                k = j(a, b, h),
                c = k.dirruns++,
                i == null && (i = f.find.TAG('*', N.test(a) && b.parentNode || b));
                for (n = 0; m = i[n]; n++) d = k.runs++,
                    k(m) && e.push(m)
            }
            return e
        }
        var c,
            d,
            e,
            f,
            g,
            h,
            i,
            j,
            k,
            l,
            m = !0,
            n = 'undefined',
            o = ('sizcache' + Math.random()).replace('.', ''),
            q = a.document,
            r = q.documentElement,
            s = 0,
            t = [].slice,
            u = [].push,
            v = function(a, b) {
                return a[o] = b || !0,
                    a
            },
            w = function() {
                var a = {},
                    b = [];
                return v(function(c, d) {
                    return b.push(c) > f.cacheLength && delete a[b.shift()],
                        a[c] = d
                }, a)
            },
            x = w(),
            y = w(),
            z = w(),
            A = '[\\x20\\t\\r\\n\\f]',
            B = '(?:\\\\.|[-\\w]|[^\\x00-\\xa0])+',
            C = B.replace('w', 'w#'),
            D = '([*^$|!~]?=)',
            E = '\\[' + A + '*(' + B + ')' + A + '*(?:' + D + A + '*(?:([\'"])((?:\\\\.|[^\\\\])*?)\\3|(' + C + ')|)|)' + A + '*\\]',
            F = ':(' + B + ')(?:\\((?:([\'"])((?:\\\\.|[^\\\\])*?)\\2|([^()[\\]]*|(?:(?:' + E + ')|[^:]|\\\\.)*|.*))\\)|)',
            G = ':(nth|eq|gt|lt|first|last|even|odd)(?:\\(((?:-\\d)?\\d*)\\)|)(?=[^-]|$)',
            H = new RegExp('^' + A + '+|((?:^|[^\\\\])(?:\\\\.)*)' + A + '+$', 'g'),
            I = new RegExp('^' + A + '*,' + A + '*'),
            J = new RegExp('^' + A + '*([\\x20\\t\\r\\n\\f>+~])' + A + '*'),
            K = new RegExp(F),
            L = /^(?:#([\w\-]+)|(\w+)|\.([\w\-]+))$/,
            M = /^:not/,
            N = /[\x20\t\r\n\f]*[+~]/,
            O = /:not\($/,
            P = /h\d/i,
            Q = /input|select|textarea|button/i,
            R = /\\(?!\\)/g,
            S = {
                ID: new RegExp('^#(' + B + ')'),
                CLASS: new RegExp('^\\.(' + B + ')'),
                NAME: new RegExp('^\\[name=[\'"]?(' + B + ')[\'"]?\\]'),
                TAG: new RegExp('^(' + B.replace('w', 'w*') + ')'),
                ATTR: new RegExp('^' + E),
                PSEUDO: new RegExp('^' + F),
                CHILD: new RegExp('^:(only|nth|last|first)-child(?:\\(' + A + '*(even|odd|(([+-]|)(\\d*)n|)' + A + '*(?:([+-]|)' + A + '*(\\d+)|))' + A + '*\\)|)', 'i'),
                POS: new RegExp(G, 'ig'),
                needsContext: new RegExp('^' + A + '*[>+~]|' + G, 'i')
            },
            T = function(a) {
                var b = q.createElement('div');
                try {
                    return a(b)
                } catch (c) {
                    return !1
                } finally {
                    b = null
                }
            },
            U = T(function(a) {
                return a.appendChild(q.createComment('')), !a.getElementsByTagName('*').length
            }),
            V = T(function(a) {
                return a.innerHTML = '<a href=\'#\'></a>',
                    a.firstChild && typeof a.firstChild.getAttribute !== n && a.firstChild.getAttribute('href') === '#'
            }),
            W = T(function(a) {
                a.innerHTML = '<select></select>';
                var b = typeof a.lastChild.getAttribute('multiple');
                return b !== 'boolean' && b !== 'string'
            }),
            X = T(function(a) {
                return a.innerHTML = '<div class=\'hidden e\'></div><div class=\'hidden\'></div>', !a.getElementsByClassName || !a.getElementsByClassName('e').length ? !1 : (a.lastChild.className = 'e', a.getElementsByClassName('e').length === 2)
            }),
            Y = T(function(a) {
                a.id = o + 0,
                a.innerHTML = '<a name=\'' + o + '\'></a><div name=\'' + o + '\'></div>',
                r.insertBefore(a, r.firstChild);
                var b = q.getElementsByName && q.getElementsByName(o).length === 2 + q.getElementsByName(o + 0).length;
                return e = !q.getElementById(o),
                    r.removeChild(a),
                    b
            });
        try {
            t.call(r.childNodes, 0)[0].nodeType
        } catch (Z) {
            t = function(a) {
                var b,
                    c = [];
                for (; b = this[a]; a++) c.push(b);
                return c
            }
        }
        $.matches = function(a, b) {
            return $(a, null, null, b)
        },
        $.matchesSelector = function(a, b) {
            return $(b, null, null, [
                a
            ]).length > 0
        },
        g = $.getText = function(a) {
            var b,
                c = '',
                d = 0,
                e = a.nodeType;
            if (e) {
                if (e === 1 || e === 9 || e === 11) {
                    if (typeof a.textContent == 'string') return a.textContent;
                    for (a = a.firstChild; a; a = a.nextSibling) c += g(a)
                } else if (e === 3 || e === 4) return a.nodeValue
            } else
                for (; b = a[d]; d++) c += g(b);
            return c
        },
        h = $.isXML = function(a) {
            var b = a && (a.ownerDocument || a).documentElement;
            return b ? b.nodeName !== 'HTML' : !1
        },
        i = $.contains = r.contains ? function(a, b) {
            var c = a.nodeType === 9 ? a.documentElement : a,
                d = b && b.parentNode;
            return a === d || !!(d && d.nodeType === 1 && c.contains && c.contains(d))
        } : r.compareDocumentPosition ? function(a, b) {
            return b && !!(a.compareDocumentPosition(b) & 16)
        } : function(a, b) {
            while (b = b.parentNode)
                if (b === a) return !0;
            return !1
        },
        $.attr = function(a, b) {
            var c,
                d = h(a);
            return d || (b = b.toLowerCase()),
                f.attrHandle[b] ? f.attrHandle[b](a) : W || d ? a.getAttribute(b) : (c = a.getAttributeNode(b), c ? typeof a[b] == 'boolean' ? a[b] ? b : null : c.specified ? c.value : null : null)
        },
        f = $.selectors = {
            cacheLength: 50,
            createPseudo: v,
            match: S,
            order: new RegExp('ID|TAG' + (Y ? '|NAME' : '') + (X ? '|CLASS' : '')),
            attrHandle: V ? {} : {
                href: function(a) {
                    return a.getAttribute('href', 2)
                },
                type: function(a) {
                    return a.getAttribute('type')
                }
            },
            find: {
                ID: e ? function(a, b, c) {
                    if (typeof b.getElementById !== n && !c) {
                        var d = b.getElementById(a);
                        return d && d.parentNode ? [
                            d
                        ] : []
                    }
                } : function(a, c, d) {
                    if (typeof c.getElementById !== n && !d) {
                        var e = c.getElementById(a);
                        return e ? e.id === a || typeof e.getAttributeNode !== n && e.getAttributeNode('id').value === a ? [
                            e
                        ] : b : []
                    }
                },
                TAG: U ? function(a, b) {
                    if (typeof b.getElementsByTagName !== n) return b.getElementsByTagName(a)
                } : function(a, b) {
                    var c = b.getElementsByTagName(a);
                    if (a === '*') {
                        var d,
                            e = [],
                            f = 0;
                        for (; d = c[f]; f++) d.nodeType === 1 && e.push(d);
                        return e
                    }
                    return c
                },
                NAME: function(a, b) {
                    if (typeof b.getElementsByName !== n) return b.getElementsByName(name)
                },
                CLASS: function(a, b, c) {
                    if (typeof b.getElementsByClassName !== n && !c) return b.getElementsByClassName(a)
                }
            },
            relative: {
                '>': {
                    dir: 'parentNode',
                    first: !0
                },
                ' ': {
                    dir: 'parentNode'
                },
                '+': {
                    dir: 'previousSibling',
                    first: !0
                },
                '~': {
                    dir: 'previousSibling'
                }
            },
            preFilter: {
                ATTR: function(a) {
                    return a[1] = a[1].replace(R, ''),
                        a[3] = (a[4] || a[5] || '').replace(R, ''),
                        a[2] === '~=' && (a[3] = ' ' + a[3] + ' '),
                        a.slice(0, 4)
                },
                CHILD: function(a) {
                    return a[1] = a[1].toLowerCase(),
                        a[1] === 'nth' ? (a[2] || $.error(a[0]), a[3] = +(a[3] ? a[4] + (a[5] || 1) : 2 * (a[2] === 'even' || a[2] === 'odd')), a[4] = +(a[6] + a[7] || a[2] === 'odd')) : a[2] && $.error(a[0]),
                        a
                },
                PSEUDO: function(a, b, c) {
                    var d,
                        e;
                    if (S.CHILD.test(a[0])) return null;
                    if (a[3]) a[2] = a[3];
                    else if (d = a[4]) K.test(d) && (e = bc(d, b, c, !0)) && (e = d.indexOf(')', d.length - e) - d.length) && (d = d.slice(0, e), a[0] = a[0].slice(0, e)),
                        a[2] = d;
                    return a.slice(0, 3)
                }
            },
            filter: {
                ID: e ? function(a) {
                    return a = a.replace(R, ''),
                        function(b) {
                            return b.getAttribute('id') === a
                        }
                } : function(a) {
                    return a = a.replace(R, ''),
                        function(b) {
                            var c = typeof b.getAttributeNode !== n && b.getAttributeNode('id');
                            return c && c.value === a
                        }
                },
                TAG: function(a) {
                    return a === '*' ? function() {
                        return !0
                    } : (a = a.replace(R, '').toLowerCase(), function(b) {
                        return b.nodeName && b.nodeName.toLowerCase() === a
                    })
                },
                CLASS: function(a) {
                    var b = x[o][a];
                    return b || (b = x(a, new RegExp('(^|' + A + ')' + a + '(' + A + '|$)'))),
                        function(a) {
                            return b.test(a.className || typeof a.getAttribute !== n && a.getAttribute('class') || '')
                        }
                },
                ATTR: function(a, b, c) {
                    return b ? function(d) {
                        var e = $.attr(d, a),
                            f = e + '';
                        if (e == null) return b === '!=';
                        switch (b) {
                            case '=':
                                return f === c;
                            case '!=':
                                return f !== c;
                            case '^=':
                                return c && f.indexOf(c) === 0;
                            case '*=':
                                return c && f.indexOf(c) > -1;
                            case '$=':
                                return c && f.substr(f.length - c.length) === c;
                            case '~=':
                                return (' ' + f + ' ').indexOf(c) > -1;
                            case '|=':
                                return f === c || f.substr(0, c.length + 1) === c + '-'
                        }
                    } : function(b) {
                        return $.attr(b, a) != null
                    }
                },
                CHILD: function(a, b, c, d) {
                    if (a === 'nth') {
                        var e = s++;
                        return function(a) {
                            var b,
                                f,
                                g = 0,
                                h = a;
                            if (c === 1 && d === 0) return !0;
                            b = a.parentNode;
                            if (b && (b[o] !== e || !a.sizset)) {
                                for (h = b.firstChild; h; h = h.nextSibling)
                                    if (h.nodeType === 1) {
                                        h.sizset = ++g;
                                        if (h === a) break
                                    }
                                b[o] = e
                            }
                            return f = a.sizset - d,
                                c === 0 ? f === 0 : f % c === 0 && f / c >= 0
                        }
                    }
                    return function(b) {
                        var c = b;
                        switch (a) {
                            case 'only':
                            case 'first':
                                while (c = c.previousSibling)
                                    if (c.nodeType === 1) return !1;
                                if (a === 'first') return !0;
                                c = b;
                            case 'last':
                                while (c = c.nextSibling)
                                    if (c.nodeType === 1) return !1;
                                return !0
                        }
                    }
                },
                PSEUDO: function(a, b, c, d) {
                    var e,
                        g = f.pseudos[a] || f.pseudos[a.toLowerCase()];
                    return g || $.error('unsupported pseudo: ' + a),
                        g[o] ? g(b, c, d) : g.length > 1 ? (e = [
                            a,
                            a,
                            '',
                            b
                        ], function(a) {
                            return g(a, 0, e)
                        }) : g
                }
            },
            pseudos: {
                not: v(function(a, b, c) {
                    var d = j(a.replace(H, '$1'), b, c);
                    return function(a) {
                        return !d(a)
                    }
                }),
                enabled: function(a) {
                    return a.disabled === !1
                },
                disabled: function(a) {
                    return a.disabled === !0
                },
                checked: function(a) {
                    var b = a.nodeName.toLowerCase();
                    return b === 'input' && !!a.checked || b === 'option' && !!a.selected
                },
                selected: function(a) {
                    return a.parentNode && a.parentNode.selectedIndex,
                        a.selected === !0
                },
                parent: function(a) {
                    return !f.pseudos.empty(a)
                },
                empty: function(a) {
                    var b;
                    a = a.firstChild;
                    while (a) {
                        if (a.nodeName > '@' || (b = a.nodeType) === 3 || b === 4) return !1;
                        a = a.nextSibling
                    }
                    return !0
                },
                contains: v(function(a) {
                    return function(b) {
                        return (b.textContent || b.innerText || g(b)).indexOf(a) > -1
                    }
                }),
                has: v(function(a) {
                    return function(b) {
                        return $(a, b).length > 0
                    }
                }),
                header: function(a) {
                    return P.test(a.nodeName)
                },
                text: function(a) {
                    var b,
                        c;
                    return a.nodeName.toLowerCase() === 'input' && (b = a.type) === 'text' && ((c = a.getAttribute('type')) == null || c.toLowerCase() === b)
                },
                radio: _('radio'),
                checkbox: _('checkbox'),
                file: _('file'),
                password: _('password'),
                image: _('image'),
                submit: ba('submit'),
                reset: ba('reset'),
                button: function(a) {
                    var b = a.nodeName.toLowerCase();
                    return b === 'input' && a.type === 'button' || b === 'button'
                },
                input: function(a) {
                    return Q.test(a.nodeName)
                },
                focus: function(a) {
                    var b = a.ownerDocument;
                    return a === b.activeElement && (!b.hasFocus || b.hasFocus()) && (!!a.type || !!a.href)
                },
                active: function(a) {
                    return a === a.ownerDocument.activeElement
                }
            },
            setFilters: {
                first: function(a, b, c) {
                    return c ? a.slice(1) : [
                        a[0]
                    ]
                },
                last: function(a, b, c) {
                    var d = a.pop();
                    return c ? a : [
                        d
                    ]
                },
                even: function(a, b, c) {
                    var d = [],
                        e = c ? 1 : 0,
                        f = a.length;
                    for (; e < f; e = e + 2) d.push(a[e]);
                    return d
                },
                odd: function(a, b, c) {
                    var d = [],
                        e = c ? 0 : 1,
                        f = a.length;
                    for (; e < f; e = e + 2) d.push(a[e]);
                    return d
                },
                lt: function(a, b, c) {
                    return c ? a.slice(+b) : a.slice(0, +b)
                },
                gt: function(a, b, c) {
                    return c ? a.slice(0, +b + 1) : a.slice(+b + 1)
                },
                eq: function(a, b, c) {
                    var d = a.splice(+b, 1);
                    return c ? a : d
                }
            }
        },
        k = r.compareDocumentPosition ? function(a, b) {
            return a === b ? (l = !0, 0) : (!a.compareDocumentPosition || !b.compareDocumentPosition ? a.compareDocumentPosition : a.compareDocumentPosition(b) & 4) ? -1 : 1
        } : function(a, b) {
            if (a === b) return l = !0,
                0;
            if (a.sourceIndex && b.sourceIndex) return a.sourceIndex - b.sourceIndex;
            var c,
                d,
                e = [],
                f = [],
                g = a.parentNode,
                h = b.parentNode,
                i = g;
            if (g === h) return bb(a, b);
            if (!g) return -1;
            if (!h) return 1;
            while (i) e.unshift(i),
                i = i.parentNode;
            i = h;
            while (i) f.unshift(i),
                i = i.parentNode;
            c = e.length,
            d = f.length;
            for (var j = 0; j < c && j < d; j++)
                if (e[j] !== f[j]) return bb(e[j], f[j]);
            return j === c ? bb(a, f[j], -1) : bb(e[j], b, 1)
        }, [
            0,
            0
        ].sort(k),
        m = !l,
        $.uniqueSort = function(a) {
            var b,
                c = 1;
            l = m,
            a.sort(k);
            if (l)
                for (; b = a[c]; c++) b === a[c - 1] && a.splice(c--, 1);
            return a
        },
        $.error = function(a) {
            throw new Error('Syntax error, unrecognized expression: ' + a)
        },
        j = $.compile = function(a, b, c) {
            var d,
                e,
                f,
                g = z[o][a];
            if (g && g.context === b) return g;
            d = bc(a, b, c);
            for (e = 0, f = d.length; e < f; e++) d[e] = bf(d[e], b, c);
            return g = z(a, bg(d)),
                g.context = b,
                g.runs = g.dirruns = 0,
                g
        },
        q.querySelectorAll && function() {
            var a,
                b = bk,
                c = /'|\\/g,
                d = /\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,
                e = [],
                f = [
                    ':active'
                ],
                g = r.matchesSelector || r.mozMatchesSelector || r.webkitMatchesSelector || r.oMatchesSelector || r.msMatchesSelector;
            T(function(a) {
                a.innerHTML = '<select><option selected=\'\'></option></select>',
                a.querySelectorAll('[selected]').length || e.push('\\[' + A + '*(?:checked|disabled|ismap|multiple|readonly|selected|value)'),
                a.querySelectorAll(':checked').length || e.push(':checked')
            }),
            T(function(a) {
                a.innerHTML = '<p test=\'\'></p>',
                a.querySelectorAll('[test^=\'\']').length && e.push('[*^$]=' + A + '*(?:""|\'\')'),
                a.innerHTML = '<input type=\'hidden\'/>',
                a.querySelectorAll(':enabled').length || e.push(':enabled', ':disabled')
            }),
            e = e.length && new RegExp(e.join('|')),
            bk = function(a, d, f, g, h) {
                if (!g && !h && (!e || !e.test(a)))
                    if (d.nodeType === 9) try {
                            return u.apply(f, t.call(d.querySelectorAll(a), 0)),
                                f
                        } catch (i) {} else if (d.nodeType === 1 && d.nodeName.toLowerCase() !== 'object') {
                            var j,
                                k,
                                l,
                                m = d.getAttribute('id'),
                                n = m || o,
                                p = N.test(a) && d.parentNode || d;
                            m ? n = n.replace(c, '\\$&') : d.setAttribute('id', n),
                            j = bc(a, d, h),
                            n = '[id=\'' + n + '\']';
                            for (k = 0, l = j.length; k < l; k++) j[k] = n + j[k].selector;
                            try {
                                return u.apply(f, t.call(p.querySelectorAll(j.join(',')), 0)),
                                    f
                            } catch (i) {} finally {
                                m || d.removeAttribute('id')
                            }
                        }
                return b(a, d, f, g, h)
            },
            g && (T(function(b) {
                a = g.call(b, 'div');
                try {
                    g.call(b, '[test!=\'\']:sizzle'),
                    f.push(S.PSEUDO.source, S.POS.source, '!=')
                } catch (c) {}
            }), f = new RegExp(f.join('|')), $.matchesSelector = function(b, c) {
                c = c.replace(d, '=\'$1\']');
                if (!h(b) && !f.test(c) && (!e || !e.test(c))) try {
                    var i = g.call(b, c);
                    if (i || a || b.document && b.document.nodeType !== 11) return i
                } catch (j) {}
                return $(c, null, null, [
                    b
                ]).length > 0
            })
        }(),
        f.setFilters.nth = f.setFilters.eq,
        f.filters = f.pseudos,
        $.attr = p.attr,
        p.find = $,
        p.expr = $.selectors,
        p.expr[':'] = p.expr.pseudos,
        p.unique = $.uniqueSort,
        p.text = $.getText,
        p.isXMLDoc = $.isXML,
        p.contains = $.contains
    }(a);
    var bc = /Until$/,
        bd = /^(?:parents|prev(?:Until|All))/,
        be = /^.[^:#\[\.,]*$/,
        bf = p.expr.match.needsContext,
        bg = {
            children: !0,
            contents: !0,
            next: !0,
            prev: !0
        };
    p.fn.extend({
        find: function(a) {
            var b,
                c,
                d,
                e,
                f,
                g,
                h = this;
            if (typeof a != 'string') return p(a).filter(function() {
                for (b = 0, c = h.length; b < c; b++)
                    if (p.contains(h[b], this)) return !0
            });
            g = this.pushStack('', 'find', a);
            for (b = 0, c = this.length; b < c; b++) {
                d = g.length,
                p.find(a, this[b], g);
                if (b > 0)
                    for (e = d; e < g.length; e++)
                        for (f = 0; f < d; f++)
                            if (g[f] === g[e]) {
                                g.splice(e--, 1);
                                break
                            }
            }
            return g
        },
        has: function(a) {
            var b,
                c = p(a, this),
                d = c.length;
            return this.filter(function() {
                for (b = 0; b < d; b++)
                    if (p.contains(this, c[b])) return !0
            })
        },
        not: function(a) {
            return this.pushStack(bj(this, a, !1), 'not', a)
        },
        filter: function(a) {
            return this.pushStack(bj(this, a, !0), 'filter', a)
        },
        is: function(a) {
            return !!a && (typeof a == 'string' ? bf.test(a) ? p(a, this.context).index(this[0]) >= 0 : p.filter(a, this).length > 0 : this.filter(a).length > 0)
        },
        closest: function(a, b) {
            var c,
                d = 0,
                e = this.length,
                f = [],
                g = bf.test(a) || typeof a != 'string' ? p(a, b || this.context) : 0;
            for (; d < e; d++) {
                c = this[d];
                while (c && c.ownerDocument && c !== b && c.nodeType !== 11) {
                    if (g ? g.index(c) > -1 : p.find.matchesSelector(c, a)) {
                        f.push(c);
                        break
                    }
                    c = c.parentNode
                }
            }
            return f = f.length > 1 ? p.unique(f) : f,
                this.pushStack(f, 'closest', a)
        },
        index: function(a) {
            return a ? typeof a == 'string' ? p.inArray(this[0], p(a)) : p.inArray(a.jquery ? a[0] : a, this) : this[0] && this[0].parentNode ? this.prevAll().length : -1
        },
        add: function(a, b) {
            var c = typeof a == 'string' ? p(a, b) : p.makeArray(a && a.nodeType ? [
                    a
                ] : a),
                d = p.merge(this.get(), c);
            return this.pushStack(bh(c[0]) || bh(d[0]) ? d : p.unique(d))
        },
        addBack: function(a) {
            return this.add(a == null ? this.prevObject : this.prevObject.filter(a))
        }
    }),
    p.fn.andSelf = p.fn.addBack,
    p.each({
        parent: function(a) {
            var b = a.parentNode;
            return b && b.nodeType !== 11 ? b : null
        },
        parents: function(a) {
            return p.dir(a, 'parentNode')
        },
        parentsUntil: function(a, b, c) {
            return p.dir(a, 'parentNode', c)
        },
        next: function(a) {
            return bi(a, 'nextSibling')
        },
        prev: function(a) {
            return bi(a, 'previousSibling')
        },
        nextAll: function(a) {
            return p.dir(a, 'nextSibling')
        },
        prevAll: function(a) {
            return p.dir(a, 'previousSibling')
        },
        nextUntil: function(a, b, c) {
            return p.dir(a, 'nextSibling', c)
        },
        prevUntil: function(a, b, c) {
            return p.dir(a, 'previousSibling', c)
        },
        siblings: function(a) {
            return p.sibling((a.parentNode || {}).firstChild, a)
        },
        children: function(a) {
            return p.sibling(a.firstChild)
        },
        contents: function(a) {
            return p.nodeName(a, 'iframe') ? a.contentDocument || a.contentWindow.document : p.merge([], a.childNodes)
        }
    }, function(a, b) {
        p.fn[a] = function(c, d) {
            var e = p.map(this, b, c);
            return bc.test(a) || (d = c),
                d && typeof d == 'string' && (e = p.filter(d, e)),
                e = this.length > 1 && !bg[a] ? p.unique(e) : e,
                this.length > 1 && bd.test(a) && (e = e.reverse()),
                this.pushStack(e, a, k.call(arguments).join(','))
        }
    }),
    p.extend({
        filter: function(a, b, c) {
            return c && (a = ':not(' + a + ')'),
                b.length === 1 ? p.find.matchesSelector(b[0], a) ? [
                    b[0]
                ] : [] : p.find.matches(a, b)
        },
        dir: function(a, c, d) {
            var e = [],
                f = a[c];
            while (f && f.nodeType !== 9 && (d === b || f.nodeType !== 1 || !p(f).is(d))) f.nodeType === 1 && e.push(f),
                f = f[c];
            return e
        },
        sibling: function(a, b) {
            var c = [];
            for (; a; a = a.nextSibling) a.nodeType === 1 && a !== b && c.push(a);
            return c
        }
    });
    var bl = 'abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video',
        bm = / jQuery\d+="(?:null|\d+)"/g,
        bn = /^\s+/,
        bo = /<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,
        bp = /<([\w:]+)/,
        bq = /<tbody/i,
        br = /<|&#?\w+;/,
        bs = /<(?:script|style|link)/i,
        bt = /<(?:script|object|embed|option|style)/i,
        bu = new RegExp('<(?:' + bl + ')[\\s/>]', 'i'),
        bv = /^(?:checkbox|radio)$/,
        bw = /checked\s*(?:[^=]|=\s*.checked.)/i,
        bx = /\/(java|ecma)script/i,
        by = /^\s*<!(?:\[CDATA\[|\-\-)|[\]\-]{2}>\s*$/g,
        bz = {
            option: [
                1,
                '<select multiple=\'multiple\'>',
                '</select>'
            ],
            legend: [
                1,
                '<fieldset>',
                '</fieldset>'
            ],
            thead: [
                1,
                '<table>',
                '</table>'
            ],
            tr: [
                2,
                '<table><tbody>',
                '</tbody></table>'
            ],
            td: [
                3,
                '<table><tbody><tr>',
                '</tr></tbody></table>'
            ],
            col: [
                2,
                '<table><tbody></tbody><colgroup>',
                '</colgroup></table>'
            ],
            area: [
                1,
                '<map>',
                '</map>'
            ],
            _default: [
                0,
                '',
                ''
            ]
        },
        bA = bk(e),
        bB = bA.appendChild(e.createElement('div'));
    bz.optgroup = bz.option,
    bz.tbody = bz.tfoot = bz.colgroup = bz.caption = bz.thead,
    bz.th = bz.td,
    p.support.htmlSerialize || (bz._default = [
        1,
        'X<div>',
        '</div>'
    ]),
    p.fn.extend({
        text: function(a) {
            return p.access(this, function(a) {
                return a === b ? p.text(this) : this.empty().append((this[0] && this[0].ownerDocument || e).createTextNode(a))
            }, null, a, arguments.length)
        },
        wrapAll: function(a) {
            if (p.isFunction(a)) return this.each(function(b) {
                p(this).wrapAll(a.call(this, b))
            });
            if (this[0]) {
                var b = p(a, this[0].ownerDocument).eq(0).clone(!0);
                this[0].parentNode && b.insertBefore(this[0]),
                b.map(function() {
                    var a = this;
                    while (a.firstChild && a.firstChild.nodeType === 1) a = a.firstChild;
                    return a
                }).append(this)
            }
            return this
        },
        wrapInner: function(a) {
            return p.isFunction(a) ? this.each(function(b) {
                p(this).wrapInner(a.call(this, b))
            }) : this.each(function() {
                var b = p(this),
                    c = b.contents();
                c.length ? c.wrapAll(a) : b.append(a)
            })
        },
        wrap: function(a) {
            var b = p.isFunction(a);
            return this.each(function(c) {
                p(this).wrapAll(b ? a.call(this, c) : a)
            })
        },
        unwrap: function() {
            return this.parent().each(function() {
                p.nodeName(this, 'body') || p(this).replaceWith(this.childNodes)
            }).end()
        },
        append: function() {
            return this.domManip(arguments, !0, function(a) {
                (this.nodeType === 1 || this.nodeType === 11) && this.appendChild(a)
            })
        },
        prepend: function() {
            return this.domManip(arguments, !0, function(a) {
                (this.nodeType === 1 || this.nodeType === 11) && this.insertBefore(a, this.firstChild)
            })
        },
        before: function() {
            if (!bh(this[0])) return this.domManip(arguments, !1, function(a) {
                this.parentNode.insertBefore(a, this)
            });
            if (arguments.length) {
                var a = p.clean(arguments);
                return this.pushStack(p.merge(a, this), 'before', this.selector)
            }
        },
        after: function() {
            if (!bh(this[0])) return this.domManip(arguments, !1, function(a) {
                this.parentNode.insertBefore(a, this.nextSibling)
            });
            if (arguments.length) {
                var a = p.clean(arguments);
                return this.pushStack(p.merge(this, a), 'after', this.selector)
            }
        },
        remove: function(a, b) {
            var c,
                d = 0;
            for (;
                (c = this[d]) != null; d++)
                if (!a || p.filter(a, [
                    c
                ]).length)!b && c.nodeType === 1 && (p.cleanData(c.getElementsByTagName('*')), p.cleanData([c])),
            c.parentNode && c.parentNode.removeChild(c);
            return this
        },
        empty: function() {
            var a,
                b = 0;
            for (;
                (a = this[b]) != null; b++) {
                a.nodeType === 1 && p.cleanData(a.getElementsByTagName('*'));
                while (a.firstChild) a.removeChild(a.firstChild)
            }
            return this
        },
        clone: function(a, b) {
            return a = a == null ? !1 : a,
                b = b == null ? a : b,
                this.map(function() {
                    return p.clone(this, a, b)
                })
        },
        html: function(a) {
            return p.access(this, function(a) {
                var c = this[0] || {},
                    d = 0,
                    e = this.length;
                if (a === b) return c.nodeType === 1 ? c.innerHTML.replace(bm, '') : b;
                if (typeof a == 'string' && !bs.test(a) && (p.support.htmlSerialize || !bu.test(a)) && (p.support.leadingWhitespace || !bn.test(a)) && !bz[(bp.exec(a) || ['',
                    ''
                ])[1].toLowerCase()]) {
                    a = a.replace(bo, '<$1></$2>');
                    try {
                        for (; d < e; d++) c = this[d] || {},
                            c.nodeType === 1 && (p.cleanData(c.getElementsByTagName('*')), c.innerHTML = a);
                        c = 0
                    } catch (f) {}
                }
                c && this.empty().append(a)
            }, null, a, arguments.length)
        },
        replaceWith: function(a) {
            return bh(this[0]) ? this.length ? this.pushStack(p(p.isFunction(a) ? a() : a), 'replaceWith', a) : this : p.isFunction(a) ? this.each(function(b) {
                var c = p(this),
                    d = c.html();
                c.replaceWith(a.call(this, b, d))
            }) : (typeof a != 'string' && (a = p(a).detach()), this.each(function() {
                var b = this.nextSibling,
                    c = this.parentNode;
                p(this).remove(),
                b ? p(b).before(a) : p(c).append(a)
            }))
        },
        detach: function(a) {
            return this.remove(a, !0)
        },
        domManip: function(a, c, d) {
            a = [].concat.apply([], a);
            var e,
                f,
                g,
                h,
                i = 0,
                j = a[0],
                k = [],
                l = this.length;
            if (!p.support.checkClone && l > 1 && typeof j == 'string' && bw.test(j)) return this.each(function() {
                p(this).domManip(a, c, d)
            });
            if (p.isFunction(j)) return this.each(function(e) {
                var f = p(this);
                a[0] = j.call(this, e, c ? f.html() : b),
                f.domManip(a, c, d)
            });
            if (this[0]) {
                e = p.buildFragment(a, this, k),
                g = e.fragment,
                f = g.firstChild,
                g.childNodes.length === 1 && (g = f);
                if (f) {
                    c = c && p.nodeName(f, 'tr');
                    for (h = e.cacheable || l - 1; i < l; i++) d.call(c && p.nodeName(this[i], 'table') ? bC(this[i], 'tbody') : this[i], i === h ? g : p.clone(g, !0, !0))
                }
                g = f = null,
                k.length && p.each(k, function(a, b) {
                    b.src ? p.ajax ? p.ajax({
                        url: b.src,
                        type: 'GET',
                        dataType: 'script',
                        async: !1,
                        global: !1,
                        'throws': !0
                    }) : p.error('no ajax') : p.globalEval((b.text || b.textContent || b.innerHTML || '').replace(by, '')),
                    b.parentNode && b.parentNode.removeChild(b)
                })
            }
            return this
        }
    }),
    p.buildFragment = function(a, c, d) {
        var f,
            g,
            h,
            i = a[0];
        return c = c || e,
            c = !c.nodeType && c[0] || c,
            c = c.ownerDocument || c,
            a.length === 1 && typeof i == 'string' && i.length < 512 && c === e && i.charAt(0) === '<' && !bt.test(i) && (p.support.checkClone || !bw.test(i)) && (p.support.html5Clone || !bu.test(i)) && (g = !0, f = p.fragments[i], h = f !== b),
            f || (f = c.createDocumentFragment(), p.clean(a, c, f, d), g && (p.fragments[i] = h && f)), {
                fragment: f,
                cacheable: g
            }
    },
    p.fragments = {},
    p.each({
        appendTo: 'append',
        prependTo: 'prepend',
        insertBefore: 'before',
        insertAfter: 'after',
        replaceAll: 'replaceWith'
    }, function(a, b) {
        p.fn[a] = function(c) {
            var d,
                e = 0,
                f = [],
                g = p(c),
                h = g.length,
                i = this.length === 1 && this[0].parentNode;
            if ((i == null || i && i.nodeType === 11 && i.childNodes.length === 1) && h === 1) return g[b](this[0]),
                this;
            for (; e < h; e++) d = (e > 0 ? this.clone(!0) : this).get(),
                p(g[e])[b](d),
                f = f.concat(d);
            return this.pushStack(f, a, g.selector)
        }
    }),
    p.extend({
        clone: function(a, b, c) {
            var d,
                e,
                f,
                g;
            p.support.html5Clone || p.isXMLDoc(a) || !bu.test('<' + a.nodeName + '>') ? g = a.cloneNode(!0) : (bB.innerHTML = a.outerHTML, bB.removeChild(g = bB.firstChild));
            if ((!p.support.noCloneEvent || !p.support.noCloneChecked) && (a.nodeType === 1 || a.nodeType === 11) && !p.isXMLDoc(a)) {
                bE(a, g),
                d = bF(a),
                e = bF(g);
                for (f = 0; d[f]; ++f) e[f] && bE(d[f], e[f])
            }
            if (b) {
                bD(a, g);
                if (c) {
                    d = bF(a),
                    e = bF(g);
                    for (f = 0; d[f]; ++f) bD(d[f], e[f])
                }
            }
            return d = e = null,
                g
        },
        clean: function(a, b, c, d) {
            var f,
                g,
                h,
                i,
                j,
                k,
                l,
                m,
                n,
                o,
                q,
                r,
                s = b === e && bA,
                t = [];
            if (!b || typeof b.createDocumentFragment == 'undefined') b = e;
            for (f = 0;
                (h = a[f]) != null; f++) {
                typeof h == 'number' && (h += '');
                if (!h) continue;
                if (typeof h == 'string')
                    if (!br.test(h)) h = b.createTextNode(h);
                    else {
                        s = s || bk(b),
                        l = b.createElement('div'),
                        s.appendChild(l),
                        h = h.replace(bo, '<$1></$2>'),
                        i = (bp.exec(h) || ['',
                            ''
                        ])[1].toLowerCase(),
                        j = bz[i] || bz._default,
                        k = j[0],
                        l.innerHTML = j[1] + h + j[2];
                        while (k--) l = l.lastChild;
                        if (!p.support.tbody) {
                            m = bq.test(h),
                            n = i === 'table' && !m ? l.firstChild && l.firstChild.childNodes : j[1] === '<table>' && !m ? l.childNodes : [];
                            for (g = n.length - 1; g >= 0; --g) p.nodeName(n[g], 'tbody') && !n[g].childNodes.length && n[g].parentNode.removeChild(n[g])
                        }!p.support.leadingWhitespace && bn.test(h) && l.insertBefore(b.createTextNode(bn.exec(h)[0]), l.firstChild),
                        h = l.childNodes,
                        l.parentNode.removeChild(l)
                    }
                h.nodeType ? t.push(h) : p.merge(t, h)
            }
            l && (h = l = s = null);
            if (!p.support.appendChecked)
                for (f = 0;
                    (h = t[f]) != null; f++) p.nodeName(h, 'input') ? bG(h) : typeof h.getElementsByTagName != 'undefined' && p.grep(h.getElementsByTagName('input'), bG);
            if (c) {
                q = function(a) {
                    if (!a.type || bx.test(a.type)) return d ? d.push(a.parentNode ? a.parentNode.removeChild(a) : a) : c.appendChild(a)
                };
                for (f = 0;
                    (h = t[f]) != null; f++)
                    if (!p.nodeName(h, 'script') || !q(h)) c.appendChild(h),
                        typeof h.getElementsByTagName != 'undefined' && (r = p.grep(p.merge([], h.getElementsByTagName('script')), q), t.splice.apply(t, [
                            f + 1,
                            0
                        ].concat(r)), f += r.length)
            }
            return t
        },
        cleanData: function(a, b) {
            var c,
                d,
                e,
                f,
                g = 0,
                h = p.expando,
                i = p.cache,
                j = p.support.deleteExpando,
                k = p.event.special;
            for (;
                (e = a[g]) != null; g++)
                if (b || p.acceptData(e)) {
                    d = e[h],
                    c = d && i[d];
                    if (c) {
                        if (c.events)
                            for (f in c.events) k[f] ? p.event.remove(e, f) : p.removeEvent(e, f, c.handle);
                        i[d] && (delete i[d], j ? delete e[h] : e.removeAttribute ? e.removeAttribute(h) : e[h] = null, p.deletedIds.push(d))
                    }
                }
        }
    }),
    function() {
        var a,
            b;
        p.uaMatch = function(a) {
            a = a.toLowerCase();
            var b = /(chrome)[ \/]([\w.]+)/.exec(a) || /(webkit)[ \/]([\w.]+)/.exec(a) || /(opera)(?:.*version|)[ \/]([\w.]+)/.exec(a) || /(msie) ([\w.]+)/.exec(a) || a.indexOf('compatible') < 0 && /(mozilla)(?:.*? rv:([\w.]+)|)/.exec(a) || [];
            return {
                browser: b[1] || '',
                version: b[2] || '0'
            }
        },
        a = p.uaMatch(g.userAgent),
        b = {},
        a.browser && (b[a.browser] = !0, b.version = a.version),
        b.chrome ? b.webkit = !0 : b.webkit && (b.safari = !0),
        p.browser = b,
        p.sub = function() {
            function a(b, c) {
                return new a.fn.init(b, c)
            }
            p.extend(!0, a, this),
            a.superclass = this,
            a.fn = a.prototype = this(),
            a.fn.constructor = a,
            a.sub = this.sub,
            a.fn.init = function c(c, d) {
                return d && d instanceof p && !(d instanceof a) && (d = a(d)),
                    p.fn.init.call(this, c, d, b)
            },
            a.fn.init.prototype = a.fn;
            var b = a(e);
            return a
        }
    }();
    var bH,
        bI,
        bJ,
        bK = /alpha\([^)]*\)/i,
        bL = /opacity=([^)]*)/,
        bM = /^(top|right|bottom|left)$/,
        bN = /^(none|table(?!-c[ea]).+)/,
        bO = /^margin/,
        bP = new RegExp('^(' + q + ')(.*)$', 'i'),
        bQ = new RegExp('^(' + q + ')(?!px)[a-z%]+$', 'i'),
        bR = new RegExp('^([-+])=(' + q + ')', 'i'),
        bS = {},
        bT = {
            position: 'absolute',
            visibility: 'hidden',
            display: 'block'
        },
        bU = {
            letterSpacing: 0,
            fontWeight: 400
        },
        bV = [
            'Top',
            'Right',
            'Bottom',
            'Left'
        ],
        bW = [
            'Webkit',
            'O',
            'Moz',
            'ms'
        ],
        bX = p.fn.toggle;
    p.fn.extend({
        css: function(a, c) {
            return p.access(this, function(a, c, d) {
                return d !== b ? p.style(a, c, d) : p.css(a, c)
            }, a, c, arguments.length > 1)
        },
        show: function() {
            return b$(this, !0)
        },
        hide: function() {
            return b$(this)
        },
        toggle: function(a, b) {
            var c = typeof a == 'boolean';
            return p.isFunction(a) && p.isFunction(b) ? bX.apply(this, arguments) : this.each(function() {
                (c ? a : bZ(this)) ? p(this).show() : p(this).hide()
            })
        }
    }),
    p.extend({
        cssHooks: {
            opacity: {
                get: function(a, b) {
                    if (b) {
                        var c = bH(a, 'opacity');
                        return c === '' ? '1' : c
                    }
                }
            }
        },
        cssNumber: {
            fillOpacity: !0,
            fontWeight: !0,
            lineHeight: !0,
            opacity: !0,
            orphans: !0,
            widows: !0,
            zIndex: !0,
            zoom: !0
        },
        cssProps: {
            'float': p.support.cssFloat ? 'cssFloat' : 'styleFloat'
        },
        style: function(a, c, d, e) {
            if (!a || a.nodeType === 3 || a.nodeType === 8 || !a.style) return;
            var f,
                g,
                h,
                i = p.camelCase(c),
                j = a.style;
            c = p.cssProps[i] || (p.cssProps[i] = bY(j, i)),
            h = p.cssHooks[c] || p.cssHooks[i];
            if (d === b) return h && 'get' in h && (f = h.get(a, !1, e)) !== b ? f : j[c];
            g = typeof d,
            g === 'string' && (f = bR.exec(d)) && (d = (f[1] + 1) * f[2] + parseFloat(p.css(a, c)), g = 'number');
            if (d == null || g === 'number' && isNaN(d)) return;
            g === 'number' && !p.cssNumber[i] && (d += 'px');
            if (!h || !('set' in h) || (d = h.set(a, d, e)) !== b) try {
                j[c] = d
            } catch (k) {}
        },
        css: function(a, c, d, e) {
            var f,
                g,
                h,
                i = p.camelCase(c);
            return c = p.cssProps[i] || (p.cssProps[i] = bY(a.style, i)),
                h = p.cssHooks[c] || p.cssHooks[i],
                h && 'get' in h && (f = h.get(a, !0, e)),
                f === b && (f = bH(a, c)),
                f === 'normal' && c in bU && (f = bU[c]),
                d || e !== b ? (g = parseFloat(f), d || p.isNumeric(g) ? g || 0 : f) : f
        },
        swap: function(a, b, c) {
            var d,
                e,
                f = {};
            for (e in b) f[e] = a.style[e],
                a.style[e] = b[e];
            d = c.call(a);
            for (e in b) a.style[e] = f[e];
            return d
        }
    }),
    a.getComputedStyle ? bH = function(b, c) {
        var d,
            e,
            f,
            g,
            h = a.getComputedStyle(b, null),
            i = b.style;
        return h && (d = h[c], d === '' && !p.contains(b.ownerDocument, b) && (d = p.style(b, c)), bQ.test(d) && bO.test(c) && (e = i.width, f = i.minWidth, g = i.maxWidth, i.minWidth = i.maxWidth = i.width = d, d = h.width, i.width = e, i.minWidth = f, i.maxWidth = g)),
            d
    } : e.documentElement.currentStyle && (bH = function(a, b) {
        var c,
            d,
            e = a.currentStyle && a.currentStyle[b],
            f = a.style;
        return e == null && f && f[b] && (e = f[b]),
            bQ.test(e) && !bM.test(b) && (c = f.left, d = a.runtimeStyle && a.runtimeStyle.left, d && (a.runtimeStyle.left = a.currentStyle.left), f.left = b === 'fontSize' ? '1em' : e, e = f.pixelLeft + 'px', f.left = c, d && (a.runtimeStyle.left = d)),
            e === '' ? 'auto' : e
    }),
    p.each(['height',
        'width'
    ], function(a, b) {
        p.cssHooks[b] = {
            get: function(a, c, d) {
                if (c) return a.offsetWidth === 0 && bN.test(bH(a, 'display')) ? p.swap(a, bT, function() {
                    return cb(a, b, d)
                }) : cb(a, b, d)
            },
            set: function(a, c, d) {
                return b_(a, c, d ? ca(a, b, d, p.support.boxSizing && p.css(a, 'boxSizing') === 'border-box') : 0)
            }
        }
    }),
    p.support.opacity || (p.cssHooks.opacity = {
        get: function(a, b) {
            return bL.test((b && a.currentStyle ? a.currentStyle.filter : a.style.filter) || '') ? 0.01 * parseFloat(RegExp.$1) + '' : b ? '1' : ''
        },
        set: function(a, b) {
            var c = a.style,
                d = a.currentStyle,
                e = p.isNumeric(b) ? 'alpha(opacity=' + b * 100 + ')' : '',
                f = d && d.filter || c.filter || '';
            c.zoom = 1;
            if (b >= 1 && p.trim(f.replace(bK, '')) === '' && c.removeAttribute) {
                c.removeAttribute('filter');
                if (d && !d.filter) return
            }
            c.filter = bK.test(f) ? f.replace(bK, e) : f + ' ' + e
        }
    }),
    p(function() {
        p.support.reliableMarginRight || (p.cssHooks.marginRight = {
            get: function(a, b) {
                return p.swap(a, {
                    display: 'inline-block'
                }, function() {
                    if (b) return bH(a, 'marginRight')
                })
            }
        }), !p.support.pixelPosition && p.fn.position && p.each(['top',
            'left'
        ], function(a, b) {
            p.cssHooks[b] = {
                get: function(a, c) {
                    if (c) {
                        var d = bH(a, b);
                        return bQ.test(d) ? p(a).position()[b] + 'px' : d
                    }
                }
            }
        })
    }),
    p.expr && p.expr.filters && (p.expr.filters.hidden = function(a) {
        return a.offsetWidth === 0 && a.offsetHeight === 0 || !p.support.reliableHiddenOffsets && (a.style && a.style.display || bH(a, 'display')) === 'none'
    }, p.expr.filters.visible = function(a) {
        return !p.expr.filters.hidden(a)
    }),
    p.each({
        margin: '',
        padding: '',
        border: 'Width'
    }, function(a, b) {
        p.cssHooks[a + b] = {
            expand: function(c) {
                var d,
                    e = typeof c == 'string' ? c.split(' ') : [
                        c
                    ],
                    f = {};
                for (d = 0; d < 4; d++) f[a + bV[d] + b] = e[d] || e[d - 2] || e[0];
                return f
            }
        },
        bO.test(a) || (p.cssHooks[a + b].set = b_)
    });
    var cd = /%20/g,
        ce = /\[\]$/,
        cf = /\r?\n/g,
        cg = /^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,
        ch = /^(?:select|textarea)/i;
    p.fn.extend({
        serialize: function() {
            return p.param(this.serializeArray())
        },
        serializeArray: function() {
            return this.map(function() {
                return this.elements ? p.makeArray(this.elements) : this
            }).filter(function() {
                return this.name && !this.disabled && (this.checked || ch.test(this.nodeName) || cg.test(this.type))
            }).map(function(a, b) {
                var c = p(this).val();
                return c == null ? null : p.isArray(c) ? p.map(c, function(a, c) {
                    return {
                        name: b.name,
                        value: a.replace(cf, '\r\n')
                    }
                }) : {
                    name: b.name,
                    value: c.replace(cf, '\r\n')
                }
            }).get()
        }
    }),
    p.param = function(a, c) {
        var d,
            e = [],
            f = function(a, b) {
                b = p.isFunction(b) ? b() : b == null ? '' : b,
                e[e.length] = encodeURIComponent(a) + '=' + encodeURIComponent(b)
            };
        c === b && (c = p.ajaxSettings && p.ajaxSettings.traditional);
        if (p.isArray(a) || a.jquery && !p.isPlainObject(a)) p.each(a, function() {
            f(this.name, this.value)
        });
        else
            for (d in a) ci(d, a[d], c, f);
        return e.join('&').replace(cd, '+')
    };
    var cj,
        ck,
        cl = /#.*$/,
        cm = /^(.*?):[ \t]*([^\r\n]*)\r?$/gm,
        cn = /^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,
        co = /^(?:GET|HEAD)$/,
        cp = /^\/\//,
        cq = /\?/,
        cr = /<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,
        cs = /([?&])_=[^&]*/,
        ct = /^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,
        cu = p.fn.load,
        cv = {},
        cw = {},
        cx = [
            '*/'
        ] + ['*'];
    try {
        cj = f.href
    } catch (cy) {
        cj = e.createElement('a'),
        cj.href = '',
        cj = cj.href
    }
    ck = ct.exec(cj.toLowerCase()) || [],
    p.fn.load = function(a, c, d) {
        if (typeof a != 'string' && cu) return cu.apply(this, arguments);
        if (!this.length) return this;
        var e,
            f,
            g,
            h = this,
            i = a.indexOf(' ');
        return i >= 0 && (e = a.slice(i, a.length), a = a.slice(0, i)),
            p.isFunction(c) ? (d = c, c = b) : c && typeof c == 'object' && (f = 'POST'),
            p.ajax({
                url: a,
                type: f,
                dataType: 'html',
                data: c,
                complete: function(a, b) {
                    d && h.each(d, g || [a.responseText,
                        b,
                        a
                    ])
                }
            }).done(function(a) {
                g = arguments,
                h.html(e ? p('<div>').append(a.replace(cr, '')).find(e) : a)
            }),
            this
    },
    p.each('ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend'.split(' '), function(a, b) {
        p.fn[b] = function(a) {
            return this.on(b, a)
        }
    }),
    p.each(['get',
        'post'
    ], function(a, c) {
        p[c] = function(a, d, e, f) {
            return p.isFunction(d) && (f = f || e, e = d, d = b),
                p.ajax({
                    type: c,
                    url: a,
                    data: d,
                    success: e,
                    dataType: f
                })
        }
    }),
    p.extend({
        getScript: function(a, c) {
            return p.get(a, b, c, 'script')
        },
        getJSON: function(a, b, c) {
            return p.get(a, b, c, 'json')
        },
        ajaxSetup: function(a, b) {
            return b ? cB(a, p.ajaxSettings) : (b = a, a = p.ajaxSettings),
                cB(a, b),
                a
        },
        ajaxSettings: {
            url: cj,
            isLocal: cn.test(ck[1]),
            global: !0,
            type: 'GET',
            contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
            processData: !0,
            async: !0,
            accepts: {
                xml: 'application/xml, text/xml',
                html: 'text/html',
                text: 'text/plain',
                json: 'application/json, text/javascript',
                '*': cx
            },
            contents: {
                xml: /xml/,
                html: /html/,
                json: /json/
            },
            responseFields: {
                xml: 'responseXML',
                text: 'responseText'
            },
            converters: {
                '* text': a.String,
                'text html': !0,
                'text json': p.parseJSON,
                'text xml': p.parseXML
            },
            flatOptions: {
                context: !0,
                url: !0
            }
        },
        ajaxPrefilter: cz(cv),
        ajaxTransport: cz(cw),
        ajax: function(a, c) {
            function y(a, c, f, i) {
                var k,
                    s,
                    t,
                    u,
                    w,
                    y = c;
                if (v === 2) return;
                v = 2,
                h && clearTimeout(h),
                g = b,
                e = i || '',
                x.readyState = a > 0 ? 4 : 0,
                f && (u = cC(l, x, f));
                if (a >= 200 && a < 300 || a === 304) l.ifModified && (w = x.getResponseHeader('Last-Modified'), w && (p.lastModified[d] = w), w = x.getResponseHeader('Etag'), w && (p.etag[d] = w)),
                    a === 304 ? (y = 'notmodified', k = !0) : (k = cD(l, u), y = k.state, s = k.data, t = k.error, k = !t);
                else {
                    t = y;
                    if (!y || a) y = 'error',
                        a < 0 && (a = 0)
                }
                x.status = a,
                x.statusText = '' + (c || y),
                k ? o.resolveWith(m, [
                    s,
                    y,
                    x
                ]) : o.rejectWith(m, [
                    x,
                    y,
                    t
                ]),
                x.statusCode(r),
                r = b,
                j && n.trigger('ajax' + (k ? 'Success' : 'Error'), [
                    x,
                    l,
                    k ? s : t
                ]),
                q.fireWith(m, [
                    x,
                    y
                ]),
                j && (n.trigger('ajaxComplete', [
                    x,
                    l
                ]), --p.active || p.event.trigger('ajaxStop'))
            }
            typeof a == 'object' && (c = a, a = b),
            c = c || {};
            var d,
                e,
                f,
                g,
                h,
                i,
                j,
                k,
                l = p.ajaxSetup({}, c),
                m = l.context || l,
                n = m !== l && (m.nodeType || m instanceof p) ? p(m) : p.event,
                o = p.Deferred(),
                q = p.Callbacks('once memory'),
                r = l.statusCode || {},
                t = {},
                u = {},
                v = 0,
                w = 'canceled',
                x = {
                    readyState: 0,
                    setRequestHeader: function(a, b) {
                        if (!v) {
                            var c = a.toLowerCase();
                            a = u[c] = u[c] || a,
                            t[a] = b
                        }
                        return this
                    },
                    getAllResponseHeaders: function() {
                        return v === 2 ? e : null
                    },
                    getResponseHeader: function(a) {
                        var c;
                        if (v === 2) {
                            if (!f) {
                                f = {};
                                while (c = cm.exec(e)) f[c[1].toLowerCase()] = c[2]
                            }
                            c = f[a.toLowerCase()]
                        }
                        return c === b ? null : c
                    },
                    overrideMimeType: function(a) {
                        return v || (l.mimeType = a),
                            this
                    },
                    abort: function(a) {
                        return a = a || w,
                            g && g.abort(a),
                            y(0, a),
                            this
                    }
                };
            o.promise(x),
            x.success = x.done,
            x.error = x.fail,
            x.complete = q.add,
            x.statusCode = function(a) {
                if (a) {
                    var b;
                    if (v < 2)
                        for (b in a) r[b] = [
                            r[b],
                            a[b]
                        ];
                    else b = a[x.status],
                        x.always(b)
                }
                return this
            },
            l.url = ((a || l.url) + '').replace(cl, '').replace(cp, ck[1] + '//'),
            l.dataTypes = p.trim(l.dataType || '*').toLowerCase().split(s),
            l.crossDomain == null && (i = ct.exec(l.url.toLowerCase()), l.crossDomain = !(!i || i[1] == ck[1] && i[2] == ck[2] && (i[3] || (i[1] === 'http:' ? 80 : 443)) == (ck[3] || (ck[1] === 'http:' ? 80 : 443)))),
            l.data && l.processData && typeof l.data != 'string' && (l.data = p.param(l.data, l.traditional)),
            cA(cv, l, c, x);
            if (v === 2) return x;
            j = l.global,
            l.type = l.type.toUpperCase(),
            l.hasContent = !co.test(l.type),
            j && p.active++ === 0 && p.event.trigger('ajaxStart');
            if (!l.hasContent) {
                l.data && (l.url += (cq.test(l.url) ? '&' : '?') + l.data, delete l.data),
                d = l.url;
                if (l.cache === !1) {
                    var z = p.now(),
                        A = l.url.replace(cs, '$1_=' + z);
                    l.url = A + (A === l.url ? (cq.test(l.url) ? '&' : '?') + '_=' + z : '')
                }
            }(l.data && l.hasContent && l.contentType !== !1 || c.contentType) && x.setRequestHeader('Content-Type', l.contentType),
            l.ifModified && (d = d || l.url, p.lastModified[d] && x.setRequestHeader('If-Modified-Since', p.lastModified[d]), p.etag[d] && x.setRequestHeader('If-None-Match', p.etag[d])),
            x.setRequestHeader('Accept', l.dataTypes[0] && l.accepts[l.dataTypes[0]] ? l.accepts[l.dataTypes[0]] + (l.dataTypes[0] !== '*' ? ', ' + cx + '; q=0.01' : '') : l.accepts['*']);
            for (k in l.headers) x.setRequestHeader(k, l.headers[k]);
            if (!l.beforeSend || l.beforeSend.call(m, x, l) !== !1 && v !== 2) {
                w = 'abort';
                for (k in {
                    success: 1,
                    error: 1,
                    complete: 1
                }) x[k](l[k]);
                g = cA(cw, l, c, x);
                if (!g) y(-1, 'No Transport');
                else {
                    x.readyState = 1,
                    j && n.trigger('ajaxSend', [
                        x,
                        l
                    ]),
                    l.async && l.timeout > 0 && (h = setTimeout(function() {
                        x.abort('timeout')
                    }, l.timeout));
                    try {
                        v = 1,
                        g.send(t, y)
                    } catch (B) {
                        if (v < 2) y(-1, B);
                        else throw B
                    }
                }
                return x
            }
            return x.abort()
        },
        active: 0,
        lastModified: {},
        etag: {}
    });
    var cE = [],
        cF = /\?/,
        cG = /(=)\?(?=&|$)|\?\?/,
        cH = p.now();
    p.ajaxSetup({
        jsonp: 'callback',
        jsonpCallback: function() {
            var a = cE.pop() || p.expando + '_' + cH++;
            return this[a] = !0,
                a
        }
    }),
    p.ajaxPrefilter('json jsonp', function(c, d, e) {
        var f,
            g,
            h,
            i = c.data,
            j = c.url,
            k = c.jsonp !== !1,
            l = k && cG.test(j),
            m = k && !l && typeof i == 'string' && !(c.contentType || '').indexOf('application/x-www-form-urlencoded') && cG.test(i);
        if (c.dataTypes[0] === 'jsonp' || l || m) return f = c.jsonpCallback = p.isFunction(c.jsonpCallback) ? c.jsonpCallback() : c.jsonpCallback,
            g = a[f],
            l ? c.url = j.replace(cG, '$1' + f) : m ? c.data = i.replace(cG, '$1' + f) : k && (c.url += (cF.test(j) ? '&' : '?') + c.jsonp + '=' + f),
            c.converters['script json'] = function() {
                return h || p.error(f + ' was not called'),
                    h[0]
            },
            c.dataTypes[0] = 'json',
            a[f] = function() {
                h = arguments
            },
            e.always(function() {
                a[f] = g,
                c[f] && (c.jsonpCallback = d.jsonpCallback, cE.push(f)),
                h && p.isFunction(g) && g(h[0]),
                h = g = b
            }),
            'script'
    }),
    p.ajaxSetup({
        accepts: {
            script: 'text/javascript, application/javascript, application/ecmascript, application/x-ecmascript'
        },
        contents: {
            script: /javascript|ecmascript/
        },
        converters: {
            'text script': function(a) {
                return p.globalEval(a),
                    a
            }
        }
    }),
    p.ajaxPrefilter('script', function(a) {
        a.cache === b && (a.cache = !1),
        a.crossDomain && (a.type = 'GET', a.global = !1)
    }),
    p.ajaxTransport('script', function(a) {
        if (a.crossDomain) {
            var c,
                d = e.head || e.getElementsByTagName('head')[0] || e.documentElement;
            return {
                send: function(f, g) {
                    c = e.createElement('script'),
                    c.async = 'async',
                    a.scriptCharset && (c.charset = a.scriptCharset),
                    c.src = a.url,
                    c.onload = c.onreadystatechange = function(a, e) {
                        if (e || !c.readyState || /loaded|complete/.test(c.readyState)) c.onload = c.onreadystatechange = null,
                            d && c.parentNode && d.removeChild(c),
                            c = b,
                            e || g(200, 'success')
                    },
                    d.insertBefore(c, d.firstChild)
                },
                abort: function() {
                    c && c.onload(0, 1)
                }
            }
        }
    });
    var cI,
        cJ = a.ActiveXObject ? function() {
            for (var a in cI) cI[a](0, 1)
        } : !1,
        cK = 0;
    p.ajaxSettings.xhr = a.ActiveXObject ? function() {
        return !this.isLocal && cL() || cM()
    } : cL,
    function(a) {
        p.extend(p.support, {
            ajax: !!a,
            cors: !!a && 'withCredentials' in a
        })
    }(p.ajaxSettings.xhr()),
    p.support.ajax && p.ajaxTransport(function(c) {
        if (!c.crossDomain || p.support.cors) {
            var d;
            return {
                send: function(e, f) {
                    var g,
                        h,
                        i = c.xhr();
                    c.username ? i.open(c.type, c.url, c.async, c.username, c.password) : i.open(c.type, c.url, c.async);
                    if (c.xhrFields)
                        for (h in c.xhrFields) i[h] = c.xhrFields[h];
                    c.mimeType && i.overrideMimeType && i.overrideMimeType(c.mimeType), !c.crossDomain && !e['X-Requested-With'] && (e['X-Requested-With'] = 'XMLHttpRequest');
                    try {
                        for (h in e) i.setRequestHeader(h, e[h])
                    } catch (j) {}
                    i.send(c.hasContent && c.data || null),
                    d = function(a, e) {
                        var h,
                            j,
                            k,
                            l,
                            m;
                        try {
                            if (d && (e || i.readyState === 4)) {
                                d = b,
                                g && (i.onreadystatechange = p.noop, cJ && delete cI[g]);
                                if (e) i.readyState !== 4 && i.abort();
                                else {
                                    h = i.status,
                                    k = i.getAllResponseHeaders(),
                                    l = {},
                                    m = i.responseXML,
                                    m && m.documentElement && (l.xml = m);
                                    try {
                                        l.text = i.responseText
                                    } catch (a) {}
                                    try {
                                        j = i.statusText
                                    } catch (n) {
                                        j = ''
                                    }!h && c.isLocal && !c.crossDomain ? h = l.text ? 200 : 404 : h === 1223 && (h = 204)
                                }
                            }
                        } catch (o) {
                            e || f(-1, o)
                        }
                        l && f(h, j, l, k)
                    },
                    c.async ? i.readyState === 4 ? setTimeout(d, 0) : (g = ++cK, cJ && (cI || (cI = {}, p(a).unload(cJ)), cI[g] = d), i.onreadystatechange = d) : d()
                },
                abort: function() {
                    d && d(0, 1)
                }
            }
        }
    });
    var cN,
        cO,
        cP = /^(?:toggle|show|hide)$/,
        cQ = new RegExp('^(?:([-+])=|)(' + q + ')([a-z%]*)$', 'i'),
        cR = /queueHooks$/,
        cS = [
            cY
        ],
        cT = {
            '*': [

                function(a, b) {
                    var c,
                        d,
                        e,
                        f = this.createTween(a, b),
                        g = cQ.exec(b),
                        h = f.cur(),
                        i = +h || 0,
                        j = 1;
                    if (g) {
                        c = +g[2],
                        d = g[3] || (p.cssNumber[a] ? '' : 'px');
                        if (d !== 'px' && i) {
                            i = p.css(f.elem, a, !0) || c || 1;
                            do e = j = j || '.5',
                                i = i / j,
                                p.style(f.elem, a, i + d),
                                j = f.cur() / h;
                            while (j !== 1 && j !== e)
                        }
                        f.unit = d,
                        f.start = i,
                        f.end = g[1] ? i + (g[1] + 1) * c : c
                    }
                    return f
                }
            ]
        };
    p.Animation = p.extend(cW, {
        tweener: function(a, b) {
            p.isFunction(a) ? (b = a, a = [
                '*'
            ]) : a = a.split(' ');
            var c,
                d = 0,
                e = a.length;
            for (; d < e; d++) c = a[d],
                cT[c] = cT[c] || [],
                cT[c].unshift(b)
        },
        prefilter: function(a, b) {
            b ? cS.unshift(a) : cS.push(a)
        }
    }),
    p.Tween = cZ,
    cZ.prototype = {
        constructor: cZ,
        init: function(a, b, c, d, e, f) {
            this.elem = a,
            this.prop = c,
            this.easing = e || 'swing',
            this.options = b,
            this.start = this.now = this.cur(),
            this.end = d,
            this.unit = f || (p.cssNumber[c] ? '' : 'px')
        },
        cur: function() {
            var a = cZ.propHooks[this.prop];
            return a && a.get ? a.get(this) : cZ.propHooks._default.get(this)
        },
        run: function(a) {
            var b,
                c = cZ.propHooks[this.prop];
            return this.options.duration ? this.pos = b = p.easing[this.easing](a, this.options.duration * a, 0, 1, this.options.duration) : this.pos = b = a,
                this.now = (this.end - this.start) * b + this.start,
                this.options.step && this.options.step.call(this.elem, this.now, this),
                c && c.set ? c.set(this) : cZ.propHooks._default.set(this),
                this
        }
    },
    cZ.prototype.init.prototype = cZ.prototype,
    cZ.propHooks = {
        _default: {
            get: function(a) {
                var b;
                return a.elem[a.prop] == null || !!a.elem.style && a.elem.style[a.prop] != null ? (b = p.css(a.elem, a.prop, !1, ''), !b || b === 'auto' ? 0 : b) : a.elem[a.prop]
            },
            set: function(a) {
                p.fx.step[a.prop] ? p.fx.step[a.prop](a) : a.elem.style && (a.elem.style[p.cssProps[a.prop]] != null || p.cssHooks[a.prop]) ? p.style(a.elem, a.prop, a.now + a.unit) : a.elem[a.prop] = a.now
            }
        }
    },
    cZ.propHooks.scrollTop = cZ.propHooks.scrollLeft = {
        set: function(a) {
            a.elem.nodeType && a.elem.parentNode && (a.elem[a.prop] = a.now)
        }
    },
    p.each(['toggle',
        'show',
        'hide'
    ], function(a, b) {
        var c = p.fn[b];
        p.fn[b] = function(d, e, f) {
            return d == null || typeof d == 'boolean' || !a && p.isFunction(d) && p.isFunction(e) ? c.apply(this, arguments) : this.animate(c$(b, !0), d, e, f)
        }
    }),
    p.fn.extend({
        fadeTo: function(a, b, c, d) {
            return this.filter(bZ).css('opacity', 0).show().end().animate({
                opacity: b
            }, a, c, d)
        },
        animate: function(a, b, c, d) {
            var e = p.isEmptyObject(a),
                f = p.speed(b, c, d),
                g = function() {
                    var b = cW(this, p.extend({}, a), f);
                    e && b.stop(!0)
                };
            return e || f.queue === !1 ? this.each(g) : this.queue(f.queue, g)
        },
        stop: function(a, c, d) {
            var e = function(a) {
                var b = a.stop;
                delete a.stop,
                b(d)
            };
            return typeof a != 'string' && (d = c, c = a, a = b),
                c && a !== !1 && this.queue(a || 'fx', []),
                this.each(function() {
                    var b = !0,
                        c = a != null && a + 'queueHooks',
                        f = p.timers,
                        g = p._data(this);
                    if (c) g[c] && g[c].stop && e(g[c]);
                    else
                        for (c in g) g[c] && g[c].stop && cR.test(c) && e(g[c]);
                    for (c = f.length; c--;) f[c].elem === this && (a == null || f[c].queue === a) && (f[c].anim.stop(d), b = !1, f.splice(c, 1));
                    (b || !d) && p.dequeue(this, a)
                })
        }
    }),
    p.each({
        slideDown: c$('show'),
        slideUp: c$('hide'),
        slideToggle: c$('toggle'),
        fadeIn: {
            opacity: 'show'
        },
        fadeOut: {
            opacity: 'hide'
        },
        fadeToggle: {
            opacity: 'toggle'
        }
    }, function(a, b) {
        p.fn[a] = function(a, c, d) {
            return this.animate(b, a, c, d)
        }
    }),
    p.speed = function(a, b, c) {
        var d = a && typeof a == 'object' ? p.extend({}, a) : {
            complete: c || !c && b || p.isFunction(a) && a,
            duration: a,
            easing: c && b || b && !p.isFunction(b) && b
        };
        d.duration = p.fx.off ? 0 : typeof d.duration == 'number' ? d.duration : d.duration in p.fx.speeds ? p.fx.speeds[d.duration] : p.fx.speeds._default;
        if (d.queue == null || d.queue === !0) d.queue = 'fx';
        return d.old = d.complete,
            d.complete = function() {
                p.isFunction(d.old) && d.old.call(this),
                d.queue && p.dequeue(this, d.queue)
            },
            d
    },
    p.easing = {
        linear: function(a) {
            return a
        },
        swing: function(a) {
            return 0.5 - Math.cos(a * Math.PI) / 2
        }
    },
    p.timers = [],
    p.fx = cZ.prototype.init,
    p.fx.tick = function() {
        var a,
            b = p.timers,
            c = 0;
        for (; c < b.length; c++) a = b[c], !a() && b[c] === a && b.splice(c--, 1);
        b.length || p.fx.stop()
    },
    p.fx.timer = function(a) {
        a() && p.timers.push(a) && !cO && (cO = setInterval(p.fx.tick, p.fx.interval))
    },
    p.fx.interval = 13,
    p.fx.stop = function() {
        clearInterval(cO),
        cO = null
    },
    p.fx.speeds = {
        slow: 600,
        fast: 200,
        _default: 400
    },
    p.fx.step = {},
    p.expr && p.expr.filters && (p.expr.filters.animated = function(a) {
        return p.grep(p.timers, function(b) {
            return a === b.elem
        }).length
    });
    var c_ = /^(?:body|html)$/i;
    p.fn.offset = function(a) {
        if (arguments.length) return a === b ? this : this.each(function(b) {
            p.offset.setOffset(this, a, b)
        });
        var c,
            d,
            e,
            f,
            g,
            h,
            i,
            j,
            k,
            l,
            m = this[0],
            n = m && m.ownerDocument;
        if (!n) return;
        return (e = n.body) === m ? p.offset.bodyOffset(m) : (d = n.documentElement, p.contains(d, m) ? (c = m.getBoundingClientRect(), f = da(n), g = d.clientTop || e.clientTop || 0, h = d.clientLeft || e.clientLeft || 0, i = f.pageYOffset || d.scrollTop, j = f.pageXOffset || d.scrollLeft, k = c.top + i - g, l = c.left + j - h, {
            top: k,
            left: l
        }) : {
            top: 0,
            left: 0
        })
    },
    p.offset = {
        bodyOffset: function(a) {
            var b = a.offsetTop,
                c = a.offsetLeft;
            return p.support.doesNotIncludeMarginInBodyOffset && (b += parseFloat(p.css(a, 'marginTop')) || 0, c += parseFloat(p.css(a, 'marginLeft')) || 0), {
                top: b,
                left: c
            }
        },
        setOffset: function(a, b, c) {
            var d = p.css(a, 'position');
            d === 'static' && (a.style.position = 'relative');
            var e = p(a),
                f = e.offset(),
                g = p.css(a, 'top'),
                h = p.css(a, 'left'),
                i = (d === 'absolute' || d === 'fixed') && p.inArray('auto', [
                    g,
                    h
                ]) > -1,
                j = {},
                k = {},
                l,
                m;
            i ? (k = e.position(), l = k.top, m = k.left) : (l = parseFloat(g) || 0, m = parseFloat(h) || 0),
            p.isFunction(b) && (b = b.call(a, c, f)),
            b.top != null && (j.top = b.top - f.top + l),
            b.left != null && (j.left = b.left - f.left + m),
                'using' in b ? b.using.call(a, j) : e.css(j)
        }
    },
    p.fn.extend({
        position: function() {
            if (!this[0]) return;
            var a = this[0],
                b = this.offsetParent(),
                c = this.offset(),
                d = c_.test(b[0].nodeName) ? {
                    top: 0,
                    left: 0
                } : b.offset();
            return c.top -= parseFloat(p.css(a, 'marginTop')) || 0,
                c.left -= parseFloat(p.css(a, 'marginLeft')) || 0,
                d.top += parseFloat(p.css(b[0], 'borderTopWidth')) || 0,
                d.left += parseFloat(p.css(b[0], 'borderLeftWidth')) || 0, {
                    top: c.top - d.top,
                    left: c.left - d.left
                }
        },
        offsetParent: function() {
            return this.map(function() {
                var a = this.offsetParent || e.body;
                while (a && !c_.test(a.nodeName) && p.css(a, 'position') === 'static') a = a.offsetParent;
                return a || e.body
            })
        }
    }),
    p.each({
        scrollLeft: 'pageXOffset',
        scrollTop: 'pageYOffset'
    }, function(a, c) {
        var d = /Y/.test(c);
        p.fn[a] = function(e) {
            return p.access(this, function(a, e, f) {
                var g = da(a);
                if (f === b) return g ? c in g ? g[c] : g.document.documentElement[e] : a[e];
                g ? g.scrollTo(d ? p(g).scrollLeft() : f, d ? f : p(g).scrollTop()) : a[e] = f
            }, a, e, arguments.length, null)
        }
    }),
    p.each({
        Height: 'height',
        Width: 'width'
    }, function(a, c) {
        p.each({
            padding: 'inner' + a,
            content: c,
            '': 'outer' + a
        }, function(d, e) {
            p.fn[e] = function(e, f) {
                var g = arguments.length && (d || typeof e != 'boolean'),
                    h = d || (e === !0 || f === !0 ? 'margin' : 'border');
                return p.access(this, function(c, d, e) {
                    var f;
                    return p.isWindow(c) ? c.document.documentElement['client' + a] : c.nodeType === 9 ? (f = c.documentElement, Math.max(c.body['scroll' + a], f['scroll' + a], c.body['offset' + a], f['offset' + a], f['client' + a])) : e === b ? p.css(c, d, e, h) : p.style(c, d, e, h)
                }, c, g ? e : b, g, null)
            }
        })
    }),
    a.jQuery = a.$ = p,
    typeof define == 'function' && define.amd && define.amd.jQuery && define('jquery', [], function() {
        return p
    })
})(window);
(function(d) {
    d.fn.visible = function(e, i) {
        var a = d(this).eq(0),
            f = a.get(0),
            c = d(window),
            g = c.scrollTop();
        c = g + c.height();
        var b = a.offset().top,
            h = b + a.height();
        a = e === true ? h : b;
        b = e === true ? b : h;
        return !!(i === true ? f.offsetWidth * f.offsetHeight : true) && b <= c && a >= g
    }
})(jQuery);
/*! jQuery UI - v1.10.2 - 2013-04-23
 * http://jqueryui.com
 * Includes: jquery.ui.core.js, jquery.ui.widget.js, jquery.ui.mouse.js, jquery.ui.position.js, jquery.ui.draggable.js, jquery.ui.droppable.js, jquery.ui.resizable.js, jquery.ui.selectable.js, jquery.ui.sortable.js, jquery.ui.autocomplete.js, jquery.ui.menu.js, jquery.ui.slider.js, jquery.ui.tooltip.js
 * Copyright 2013 jQuery Foundation and other contributors Licensed MIT */
(function(e, t) {
    function i(t, i) {
        var a,
            n,
            r,
            o = t.nodeName.toLowerCase();
        return 'area' === o ? (a = t.parentNode, n = a.name, t.href && n && 'map' === a.nodeName.toLowerCase() ? (r = e('img[usemap=#' + n + ']')[0], !!r && s(r)) : !1) : (/input|select|textarea|button|object/.test(o) ? !t.disabled : 'a' === o ? t.href || i : i) && s(t)
    }

    function s(t) {
        return e.expr.filters.visible(t) && !e(t).parents().addBack().filter(function() {
            return 'hidden' === e.css(this, 'visibility')
        }).length
    }
    var a = 0,
        n = /^ui-id-\d+$/;
    e.ui = e.ui || {},
    e.extend(e.ui, {
        version: '1.10.2',
        keyCode: {
            BACKSPACE: 8,
            COMMA: 188,
            DELETE: 46,
            DOWN: 40,
            END: 35,
            ENTER: 13,
            ESCAPE: 27,
            HOME: 36,
            LEFT: 37,
            NUMPAD_ADD: 107,
            NUMPAD_DECIMAL: 110,
            NUMPAD_DIVIDE: 111,
            NUMPAD_ENTER: 108,
            NUMPAD_MULTIPLY: 106,
            NUMPAD_SUBTRACT: 109,
            PAGE_DOWN: 34,
            PAGE_UP: 33,
            PERIOD: 190,
            RIGHT: 39,
            SPACE: 32,
            TAB: 9,
            UP: 38
        }
    }),
    e.fn.extend({
        focus: function(t) {
            return function(i, s) {
                return 'number' == typeof i ? this.each(function() {
                    var t = this;
                    setTimeout(function() {
                        e(t).focus(),
                        s && s.call(t)
                    }, i)
                }) : t.apply(this, arguments)
            }
        }(e.fn.focus),
        scrollParent: function() {
            var t;
            return t = e.ui.ie && /(static|relative)/.test(this.css('position')) || /absolute/.test(this.css('position')) ? this.parents().filter(function() {
                    return /(relative|absolute|fixed)/.test(e.css(this, 'position')) && /(auto|scroll)/.test(e.css(this, 'overflow') + e.css(this, 'overflow-y') + e.css(this, 'overflow-x'))
                }).eq(0) : this.parents().filter(function() {
                    return /(auto|scroll)/.test(e.css(this, 'overflow') + e.css(this, 'overflow-y') + e.css(this, 'overflow-x'))
                }).eq(0),
                /fixed/.test(this.css('position')) || !t.length ? e(document) : t
        },
        zIndex: function(i) {
            if (i !== t) return this.css('zIndex', i);
            if (this.length)
                for (var s, a, n = e(this[0]); n.length && n[0] !== document;) {
                    if (s = n.css('position'), ('absolute' === s || 'relative' === s || 'fixed' === s) && (a = parseInt(n.css('zIndex'), 10), !isNaN(a) && 0 !== a)) return a;
                    n = n.parent()
                }
            return 0
        },
        uniqueId: function() {
            return this.each(function() {
                this.id || (this.id = 'ui-id-' + ++a)
            })
        },
        removeUniqueId: function() {
            return this.each(function() {
                n.test(this.id) && e(this).removeAttr('id')
            })
        }
    }),
    e.extend(e.expr[':'], {
        data: e.expr.createPseudo ? e.expr.createPseudo(function(t) {
            return function(i) {
                return !!e.data(i, t)
            }
        }) : function(t, i, s) {
            return !!e.data(t, s[3])
        },
        focusable: function(t) {
            return i(t, !isNaN(e.attr(t, 'tabindex')))
        },
        tabbable: function(t) {
            var s = e.attr(t, 'tabindex'),
                a = isNaN(s);
            return (a || s >= 0) && i(t, !a)
        }
    }),
    e('<a>').outerWidth(1).jquery || e.each(['Width',
        'Height'
    ], function(i, s) {
        function a(t, i, s, a) {
            return e.each(n, function() {
                    i -= parseFloat(e.css(t, 'padding' + this)) || 0,
                    s && (i -= parseFloat(e.css(t, 'border' + this + 'Width')) || 0),
                    a && (i -= parseFloat(e.css(t, 'margin' + this)) || 0)
                }),
                i
        }
        var n = 'Width' === s ? [
                'Left',
                'Right'
            ] : [
                'Top',
                'Bottom'
            ],
            r = s.toLowerCase(),
            o = {
                innerWidth: e.fn.innerWidth,
                innerHeight: e.fn.innerHeight,
                outerWidth: e.fn.outerWidth,
                outerHeight: e.fn.outerHeight
            };
        e.fn['inner' + s] = function(i) {
            return i === t ? o['inner' + s].call(this) : this.each(function() {
                e(this).css(r, a(this, i) + 'px')
            })
        },
        e.fn['outer' + s] = function(t, i) {
            return 'number' != typeof t ? o['outer' + s].call(this, t) : this.each(function() {
                e(this).css(r, a(this, t, !0, i) + 'px')
            })
        }
    }),
    e.fn.addBack || (e.fn.addBack = function(e) {
        return this.add(null == e ? this.prevObject : this.prevObject.filter(e))
    }),
    e('<a>').data('a-b', 'a').removeData('a-b').data('a-b') && (e.fn.removeData = function(t) {
        return function(i) {
            return arguments.length ? t.call(this, e.camelCase(i)) : t.call(this)
        }
    }(e.fn.removeData)),
    e.ui.ie = !!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),
    e.support.selectstart = 'onselectstart' in document.createElement('div'),
    e.fn.extend({
        disableSelection: function() {
            return this.bind((e.support.selectstart ? 'selectstart' : 'mousedown') + '.ui-disableSelection', function(e) {
                e.preventDefault()
            })
        },
        enableSelection: function() {
            return this.unbind('.ui-disableSelection')
        }
    }),
    e.extend(e.ui, {
        plugin: {
            add: function(t, i, s) {
                var a,
                    n = e.ui[t].prototype;
                for (a in s) n.plugins[a] = n.plugins[a] || [],
                    n.plugins[a].push([i,
                        s[a]
                    ])
            },
            call: function(e, t, i) {
                var s,
                    a = e.plugins[t];
                if (a && e.element[0].parentNode && 11 !== e.element[0].parentNode.nodeType)
                    for (s = 0; a.length > s; s++) e.options[a[s][0]] && a[s][1].apply(e.element, i)
            }
        },
        hasScroll: function(t, i) {
            if ('hidden' === e(t).css('overflow')) return !1;
            var s = i && 'left' === i ? 'scrollLeft' : 'scrollTop',
                a = !1;
            return t[s] > 0 ? !0 : (t[s] = 1, a = t[s] > 0, t[s] = 0, a)
        }
    })
})(jQuery);
(function(e, t) {
    var i = 0,
        s = Array.prototype.slice,
        n = e.cleanData;
    e.cleanData = function(t) {
        for (var i, s = 0; null != (i = t[s]); s++) try {
            e(i).triggerHandler('remove')
        } catch (a) {}
        n(t)
    },
    e.widget = function(i, s, n) {
        var a,
            r,
            o,
            h,
            l = {},
            u = i.split('.')[0];
        i = i.split('.')[1],
        a = u + '-' + i,
        n || (n = s, s = e.Widget),
        e.expr[':'][a.toLowerCase()] = function(t) {
            return !!e.data(t, a)
        },
        e[u] = e[u] || {},
        r = e[u][i],
        o = e[u][i] = function(e, i) {
            return this._createWidget ? (arguments.length && this._createWidget(e, i), t) : new o(e, i)
        },
        e.extend(o, r, {
            version: n.version,
            _proto: e.extend({}, n),
            _childConstructors: []
        }),
        h = new s,
        h.options = e.widget.extend({}, h.options),
        e.each(n, function(i, n) {
            return e.isFunction(n) ? (l[i] = function() {
                var e = function() {
                        return s.prototype[i].apply(this, arguments)
                    },
                    t = function(e) {
                        return s.prototype[i].apply(this, e)
                    };
                return function() {
                    var i,
                        s = this._super,
                        a = this._superApply;
                    return this._super = e,
                        this._superApply = t,
                        i = n.apply(this, arguments),
                        this._super = s,
                        this._superApply = a,
                        i
                }
            }(), t) : (l[i] = n, t)
        }),
        o.prototype = e.widget.extend(h, {
            widgetEventPrefix: r ? h.widgetEventPrefix : i
        }, l, {
            constructor: o,
            namespace: u,
            widgetName: i,
            widgetFullName: a
        }),
        r ? (e.each(r._childConstructors, function(t, i) {
            var s = i.prototype;
            e.widget(s.namespace + '.' + s.widgetName, o, i._proto)
        }), delete r._childConstructors) : s._childConstructors.push(o),
        e.widget.bridge(i, o)
    },
    e.widget.extend = function(i) {
        for (var n, a, r = s.call(arguments, 1), o = 0, h = r.length; h > o; o++)
            for (n in r[o]) a = r[o][n],
                r[o].hasOwnProperty(n) && a !== t && (i[n] = e.isPlainObject(a) ? e.isPlainObject(i[n]) ? e.widget.extend({}, i[n], a) : e.widget.extend({}, a) : a);
        return i
    },
    e.widget.bridge = function(i, n) {
        var a = n.prototype.widgetFullName || i;
        e.fn[i] = function(r) {
            var o = 'string' == typeof r,
                h = s.call(arguments, 1),
                l = this;
            return r = !o && h.length ? e.widget.extend.apply(null, [
                    r
                ].concat(h)) : r,
                o ? this.each(function() {
                    var s,
                        n = e.data(this, a);
                    return n ? e.isFunction(n[r]) && '_' !== r.charAt(0) ? (s = n[r].apply(n, h), s !== n && s !== t ? (l = s && s.jquery ? l.pushStack(s.get()) : s, !1) : t) : e.error('no such method \'' + r + '\' for ' + i + ' widget instance') : e.error('cannot call methods on ' + i + ' prior to initialization; ' + 'attempted to call method \'' + r + '\'')
                }) : this.each(function() {
                    var t = e.data(this, a);
                    t ? t.option(r || {})._init() : e.data(this, a, new n(r, this))
                }),
                l
        }
    },
    e.Widget = function() {},
    e.Widget._childConstructors = [],
    e.Widget.prototype = {
        widgetName: 'widget',
        widgetEventPrefix: '',
        defaultElement: '<div>',
        options: {
            disabled: !1,
            create: null
        },
        _createWidget: function(t, s) {
            s = e(s || this.defaultElement || this)[0],
            this.element = e(s),
            this.uuid = i++,
            this.eventNamespace = '.' + this.widgetName + this.uuid,
            this.options = e.widget.extend({}, this.options, this._getCreateOptions(), t),
            this.bindings = e(),
            this.hoverable = e(),
            this.focusable = e(),
            s !== this && (e.data(s, this.widgetFullName, this), this._on(!0, this.element, {
                remove: function(e) {
                    e.target === s && this.destroy()
                }
            }), this.document = e(s.style ? s.ownerDocument : s.document || s), this.window = e(this.document[0].defaultView || this.document[0].parentWindow)),
            this._create(),
            this._trigger('create', null, this._getCreateEventData()),
            this._init()
        },
        _getCreateOptions: e.noop,
        _getCreateEventData: e.noop,
        _create: e.noop,
        _init: e.noop,
        destroy: function() {
            this._destroy(),
            this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),
            this.widget().unbind(this.eventNamespace).removeAttr('aria-disabled').removeClass(this.widgetFullName + '-disabled ' + 'ui-state-disabled'),
            this.bindings.unbind(this.eventNamespace),
            this.hoverable.removeClass('ui-state-hover'),
            this.focusable.removeClass('ui-state-focus')
        },
        _destroy: e.noop,
        widget: function() {
            return this.element
        },
        option: function(i, s) {
            var n,
                a,
                r,
                o = i;
            if (0 === arguments.length) return e.widget.extend({}, this.options);
            if ('string' == typeof i)
                if (o = {}, n = i.split('.'), i = n.shift(), n.length) {
                    for (a = o[i] = e.widget.extend({}, this.options[i]), r = 0; n.length - 1 > r; r++) a[n[r]] = a[n[r]] || {},
                        a = a[n[r]];
                    if (i = n.pop(), s === t) return a[i] === t ? null : a[i];
                    a[i] = s
                } else {
                    if (s === t) return this.options[i] === t ? null : this.options[i];
                    o[i] = s
                }
            return this._setOptions(o),
                this
        },
        _setOptions: function(e) {
            var t;
            for (t in e) this._setOption(t, e[t]);
            return this
        },
        _setOption: function(e, t) {
            return this.options[e] = t,
                'disabled' === e && (this.widget().toggleClass(this.widgetFullName + '-disabled ui-state-disabled', !!t).attr('aria-disabled', t), this.hoverable.removeClass('ui-state-hover'), this.focusable.removeClass('ui-state-focus')),
                this
        },
        enable: function() {
            return this._setOption('disabled', !1)
        },
        disable: function() {
            return this._setOption('disabled', !0)
        },
        _on: function(i, s, n) {
            var a,
                r = this;
            'boolean' != typeof i && (n = s, s = i, i = !1),
            n ? (s = a = e(s), this.bindings = this.bindings.add(s)) : (n = s, s = this.element, a = this.widget()),
            e.each(n, function(n, o) {
                function h() {
                    return i || r.options.disabled !== !0 && !e(this).hasClass('ui-state-disabled') ? ('string' == typeof o ? r[o] : o).apply(r, arguments) : t
                }
                'string' != typeof o && (h.guid = o.guid = o.guid || h.guid || e.guid++);
                var l = n.match(/^(\w+)\s*(.*)$/),
                    u = l[1] + r.eventNamespace,
                    c = l[2];
                c ? a.delegate(c, u, h) : s.bind(u, h)
            })
        },
        _off: function(e, t) {
            t = (t || '').split(' ').join(this.eventNamespace + ' ') + this.eventNamespace,
            e.unbind(t).undelegate(t)
        },
        _delay: function(e, t) {
            function i() {
                return ('string' == typeof e ? s[e] : e).apply(s, arguments)
            }
            var s = this;
            return setTimeout(i, t || 0)
        },
        _hoverable: function(t) {
            this.hoverable = this.hoverable.add(t),
            this._on(t, {
                mouseenter: function(t) {
                    e(t.currentTarget).addClass('ui-state-hover')
                },
                mouseleave: function(t) {
                    e(t.currentTarget).removeClass('ui-state-hover')
                }
            })
        },
        _focusable: function(t) {
            this.focusable = this.focusable.add(t),
            this._on(t, {
                focusin: function(t) {
                    e(t.currentTarget).addClass('ui-state-focus')
                },
                focusout: function(t) {
                    e(t.currentTarget).removeClass('ui-state-focus')
                }
            })
        },
        _trigger: function(t, i, s) {
            var n,
                a,
                r = this.options[t];
            if (s = s || {}, i = e.Event(i), i.type = (t === this.widgetEventPrefix ? t : this.widgetEventPrefix + t).toLowerCase(), i.target = this.element[0], a = i.originalEvent)
                for (n in a) n in i || (i[n] = a[n]);
            return this.element.trigger(i, s), !(e.isFunction(r) && r.apply(this.element[0], [
                i
            ].concat(s)) === !1 || i.isDefaultPrevented())
        }
    },
    e.each({
        show: 'fadeIn',
        hide: 'fadeOut'
    }, function(t, i) {
        e.Widget.prototype['_' + t] = function(s, n, a) {
            'string' == typeof n && (n = {
                effect: n
            });
            var r,
                o = n ? n === !0 || 'number' == typeof n ? i : n.effect || i : t;
            n = n || {},
                'number' == typeof n && (n = {
                    duration: n
                }),
            r = !e.isEmptyObject(n),
            n.complete = a,
            n.delay && s.delay(n.delay),
            r && e.effects && e.effects.effect[o] ? s[t](n) : o !== t && s[o] ? s[o](n.duration, n.easing, a) : s.queue(function(i) {
                e(this)[t](),
                a && a.call(s[0]),
                i()
            })
        }
    })
})(jQuery);
(function(e) {
    var t = !1;
    e(document).mouseup(function() {
        t = !1
    }),
    e.widget('ui.mouse', {
        version: '1.10.2',
        options: {
            cancel: 'input,textarea,button,select,option',
            distance: 1,
            delay: 0
        },
        _mouseInit: function() {
            var t = this;
            this.element.bind('mousedown.' + this.widgetName, function(e) {
                return t._mouseDown(e)
            }).bind('click.' + this.widgetName, function(i) {
                return !0 === e.data(i.target, t.widgetName + '.preventClickEvent') ? (e.removeData(i.target, t.widgetName + '.preventClickEvent'), i.stopImmediatePropagation(), !1) : undefined
            }),
            this.started = !1
        },
        _mouseDestroy: function() {
            this.element.unbind('.' + this.widgetName),
            this._mouseMoveDelegate && e(document).unbind('mousemove.' + this.widgetName, this._mouseMoveDelegate).unbind('mouseup.' + this.widgetName, this._mouseUpDelegate)
        },
        _mouseDown: function(i) {
            if (!t) {
                this._mouseStarted && this._mouseUp(i),
                this._mouseDownEvent = i;
                var s = this,
                    n = 1 === i.which,
                    a = 'string' == typeof this.options.cancel && i.target.nodeName ? e(i.target).closest(this.options.cancel).length : !1;
                return n && !a && this._mouseCapture(i) ? (this.mouseDelayMet = !this.options.delay, this.mouseDelayMet || (this._mouseDelayTimer = setTimeout(function() {
                    s.mouseDelayMet = !0
                }, this.options.delay)), this._mouseDistanceMet(i) && this._mouseDelayMet(i) && (this._mouseStarted = this._mouseStart(i) !== !1, !this._mouseStarted) ? (i.preventDefault(), !0) : (!0 === e.data(i.target, this.widgetName + '.preventClickEvent') && e.removeData(i.target, this.widgetName + '.preventClickEvent'), this._mouseMoveDelegate = function(e) {
                    return s._mouseMove(e)
                }, this._mouseUpDelegate = function(e) {
                    return s._mouseUp(e)
                }, e(document).bind('mousemove.' + this.widgetName, this._mouseMoveDelegate).bind('mouseup.' + this.widgetName, this._mouseUpDelegate), i.preventDefault(), t = !0, !0)) : !0
            }
        },
        _mouseMove: function(t) {
            return e.ui.ie && (!document.documentMode || 9 > document.documentMode) && !t.button ? this._mouseUp(t) : this._mouseStarted ? (this._mouseDrag(t), t.preventDefault()) : (this._mouseDistanceMet(t) && this._mouseDelayMet(t) && (this._mouseStarted = this._mouseStart(this._mouseDownEvent, t) !== !1, this._mouseStarted ? this._mouseDrag(t) : this._mouseUp(t)), !this._mouseStarted)
        },
        _mouseUp: function(t) {
            return e(document).unbind('mousemove.' + this.widgetName, this._mouseMoveDelegate).unbind('mouseup.' + this.widgetName, this._mouseUpDelegate),
                this._mouseStarted && (this._mouseStarted = !1, t.target === this._mouseDownEvent.target && e.data(t.target, this.widgetName + '.preventClickEvent', !0), this._mouseStop(t)), !1
        },
        _mouseDistanceMet: function(e) {
            return Math.max(Math.abs(this._mouseDownEvent.pageX - e.pageX), Math.abs(this._mouseDownEvent.pageY - e.pageY)) >= this.options.distance
        },
        _mouseDelayMet: function() {
            return this.mouseDelayMet
        },
        _mouseStart: function() {},
        _mouseDrag: function() {},
        _mouseStop: function() {},
        _mouseCapture: function() {
            return !0
        }
    })
})(jQuery);
(function(t, e) {
    function i(t, e, i) {
        return [parseFloat(t[0]) * (p.test(t[0]) ? e / 100 : 1),
            parseFloat(t[1]) * (p.test(t[1]) ? i / 100 : 1)
        ]
    }

    function s(e, i) {
        return parseInt(t.css(e, i), 10) || 0
    }

    function n(e) {
        var i = e[0];
        return 9 === i.nodeType ? {
            width: e.width(),
            height: e.height(),
            offset: {
                top: 0,
                left: 0
            }
        } : t.isWindow(i) ? {
            width: e.width(),
            height: e.height(),
            offset: {
                top: e.scrollTop(),
                left: e.scrollLeft()
            }
        } : i.preventDefault ? {
            width: 0,
            height: 0,
            offset: {
                top: i.pageY,
                left: i.pageX
            }
        } : {
            width: e.outerWidth(),
            height: e.outerHeight(),
            offset: e.offset()
        }
    }
    t.ui = t.ui || {};
    var a,
        o = Math.max,
        r = Math.abs,
        h = Math.round,
        l = /left|center|right/,
        c = /top|center|bottom/,
        u = /[\+\-]\d+(\.[\d]+)?%?/,
        d = /^\w+/,
        p = /%$/,
        f = t.fn.position;
    t.position = {
        scrollbarWidth: function() {
            if (a !== e) return a;
            var i,
                s,
                n = t('<div style=\'display:block;width:50px;height:50px;overflow:hidden;\'><div style=\'height:100px;width:auto;\'></div></div>'),
                o = n.children()[0];
            return t('body').append(n),
                i = o.offsetWidth,
                n.css('overflow', 'scroll'),
                s = o.offsetWidth,
                i === s && (s = n[0].clientWidth),
                n.remove(),
                a = i - s
        },
        getScrollInfo: function(e) {
            var i = e.isWindow ? '' : e.element.css('overflow-x'),
                s = e.isWindow ? '' : e.element.css('overflow-y'),
                n = 'scroll' === i || 'auto' === i && e.width < e.element[0].scrollWidth,
                a = 'scroll' === s || 'auto' === s && e.height < e.element[0].scrollHeight;
            return {
                width: a ? t.position.scrollbarWidth() : 0,
                height: n ? t.position.scrollbarWidth() : 0
            }
        },
        getWithinInfo: function(e) {
            var i = t(e || window),
                s = t.isWindow(i[0]);
            return {
                element: i,
                isWindow: s,
                offset: i.offset() || {
                    left: 0,
                    top: 0
                },
                scrollLeft: i.scrollLeft(),
                scrollTop: i.scrollTop(),
                width: s ? i.width() : i.outerWidth(),
                height: s ? i.height() : i.outerHeight()
            }
        }
    },
    t.fn.position = function(e) {
        if (!e || !e.of) return f.apply(this, arguments);
        e = t.extend({}, e);
        var a,
            p,
            m,
            g,
            v,
            _,
            b = t(e.of),
            y = t.position.getWithinInfo(e.within),
            w = t.position.getScrollInfo(y),
            x = (e.collision || 'flip').split(' '),
            k = {};
        return _ = n(b),
            b[0].preventDefault && (e.at = 'left top'),
            p = _.width,
            m = _.height,
            g = _.offset,
            v = t.extend({}, g),
            t.each(['my',
                'at'
            ], function() {
                var t,
                    i,
                    s = (e[this] || '').split(' ');
                1 === s.length && (s = l.test(s[0]) ? s.concat(['center']) : c.test(s[0]) ? [
                    'center'
                ].concat(s) : [
                    'center',
                    'center'
                ]),
                s[0] = l.test(s[0]) ? s[0] : 'center',
                s[1] = c.test(s[1]) ? s[1] : 'center',
                t = u.exec(s[0]),
                i = u.exec(s[1]),
                k[this] = [
                    t ? t[0] : 0,
                    i ? i[0] : 0
                ],
                e[this] = [
                    d.exec(s[0])[0],
                    d.exec(s[1])[0]
                ]
            }),
            1 === x.length && (x[1] = x[0]),
            'right' === e.at[0] ? v.left += p : 'center' === e.at[0] && (v.left += p / 2),
            'bottom' === e.at[1] ? v.top += m : 'center' === e.at[1] && (v.top += m / 2),
            a = i(k.at, p, m),
            v.left += a[0],
            v.top += a[1],
            this.each(function() {
                var n,
                    l,
                    c = t(this),
                    u = c.outerWidth(),
                    d = c.outerHeight(),
                    f = s(this, 'marginLeft'),
                    _ = s(this, 'marginTop'),
                    D = u + f + s(this, 'marginRight') + w.width,
                    T = d + _ + s(this, 'marginBottom') + w.height,
                    C = t.extend({}, v),
                    M = i(k.my, c.outerWidth(), c.outerHeight());
                'right' === e.my[0] ? C.left -= u : 'center' === e.my[0] && (C.left -= u / 2),
                    'bottom' === e.my[1] ? C.top -= d : 'center' === e.my[1] && (C.top -= d / 2),
                C.left += M[0],
                C.top += M[1],
                t.support.offsetFractions || (C.left = h(C.left), C.top = h(C.top)),
                n = {
                    marginLeft: f,
                    marginTop: _
                },
                t.each(['left',
                    'top'
                ], function(i, s) {
                    t.ui.position[x[i]] && t.ui.position[x[i]][s](C, {
                        targetWidth: p,
                        targetHeight: m,
                        elemWidth: u,
                        elemHeight: d,
                        collisionPosition: n,
                        collisionWidth: D,
                        collisionHeight: T,
                        offset: [
                            a[0] + M[0],
                            a[1] + M[1]
                        ],
                        my: e.my,
                        at: e.at,
                        within: y,
                        elem: c
                    })
                }),
                e.using && (l = function(t) {
                    var i = g.left - C.left,
                        s = i + p - u,
                        n = g.top - C.top,
                        a = n + m - d,
                        h = {
                            target: {
                                element: b,
                                left: g.left,
                                top: g.top,
                                width: p,
                                height: m
                            },
                            element: {
                                element: c,
                                left: C.left,
                                top: C.top,
                                width: u,
                                height: d
                            },
                            horizontal: 0 > s ? 'left' : i > 0 ? 'right' : 'center',
                            vertical: 0 > a ? 'top' : n > 0 ? 'bottom' : 'middle'
                        };
                    u > p && p > r(i + s) && (h.horizontal = 'center'),
                    d > m && m > r(n + a) && (h.vertical = 'middle'),
                    h.important = o(r(i), r(s)) > o(r(n), r(a)) ? 'horizontal' : 'vertical',
                    e.using.call(this, t, h)
                }),
                c.offset(t.extend(C, {
                    using: l
                }))
            })
    },
    t.ui.position = {
        fit: {
            left: function(t, e) {
                var i,
                    s = e.within,
                    n = s.isWindow ? s.scrollLeft : s.offset.left,
                    a = s.width,
                    r = t.left - e.collisionPosition.marginLeft,
                    h = n - r,
                    l = r + e.collisionWidth - a - n;
                e.collisionWidth > a ? h > 0 && 0 >= l ? (i = t.left + h + e.collisionWidth - a - n, t.left += h - i) : t.left = l > 0 && 0 >= h ? n : h > l ? n + a - e.collisionWidth : n : h > 0 ? t.left += h : l > 0 ? t.left -= l : t.left = o(t.left - r, t.left)
            },
            top: function(t, e) {
                var i,
                    s = e.within,
                    n = s.isWindow ? s.scrollTop : s.offset.top,
                    a = e.within.height,
                    r = t.top - e.collisionPosition.marginTop,
                    h = n - r,
                    l = r + e.collisionHeight - a - n;
                e.collisionHeight > a ? h > 0 && 0 >= l ? (i = t.top + h + e.collisionHeight - a - n, t.top += h - i) : t.top = l > 0 && 0 >= h ? n : h > l ? n + a - e.collisionHeight : n : h > 0 ? t.top += h : l > 0 ? t.top -= l : t.top = o(t.top - r, t.top)
            }
        },
        flip: {
            left: function(t, e) {
                var i,
                    s,
                    n = e.within,
                    a = n.offset.left + n.scrollLeft,
                    o = n.width,
                    h = n.isWindow ? n.scrollLeft : n.offset.left,
                    l = t.left - e.collisionPosition.marginLeft,
                    c = l - h,
                    u = l + e.collisionWidth - o - h,
                    d = 'left' === e.my[0] ? -e.elemWidth : 'right' === e.my[0] ? e.elemWidth : 0,
                    p = 'left' === e.at[0] ? e.targetWidth : 'right' === e.at[0] ? -e.targetWidth : 0,
                    f = -2 * e.offset[0];
                0 > c ? (i = t.left + d + p + f + e.collisionWidth - o - a, (0 > i || r(c) > i) && (t.left += d + p + f)) : u > 0 && (s = t.left - e.collisionPosition.marginLeft + d + p + f - h, (s > 0 || u > r(s)) && (t.left += d + p + f))
            },
            top: function(t, e) {
                var i,
                    s,
                    n = e.within,
                    a = n.offset.top + n.scrollTop,
                    o = n.height,
                    h = n.isWindow ? n.scrollTop : n.offset.top,
                    l = t.top - e.collisionPosition.marginTop,
                    c = l - h,
                    u = l + e.collisionHeight - o - h,
                    d = 'top' === e.my[1],
                    p = d ? -e.elemHeight : 'bottom' === e.my[1] ? e.elemHeight : 0,
                    f = 'top' === e.at[1] ? e.targetHeight : 'bottom' === e.at[1] ? -e.targetHeight : 0,
                    m = -2 * e.offset[1];
                0 > c ? (s = t.top + p + f + m + e.collisionHeight - o - a, t.top + p + f + m > c && (0 > s || r(c) > s) && (t.top += p + f + m)) : u > 0 && (i = t.top - e.collisionPosition.marginTop + p + f + m - h, t.top + p + f + m > u && (i > 0 || u > r(i)) && (t.top += p + f + m))
            }
        },
        flipfit: {
            left: function() {
                t.ui.position.flip.left.apply(this, arguments),
                t.ui.position.fit.left.apply(this, arguments)
            },
            top: function() {
                t.ui.position.flip.top.apply(this, arguments),
                t.ui.position.fit.top.apply(this, arguments)
            }
        }
    },
    function() {
        var e,
            i,
            s,
            n,
            a,
            o = document.getElementsByTagName('body')[0],
            r = document.createElement('div');
        e = document.createElement(o ? 'div' : 'body'),
        s = {
            visibility: 'hidden',
            width: 0,
            height: 0,
            border: 0,
            margin: 0,
            background: 'none'
        },
        o && t.extend(s, {
            position: 'absolute',
            left: '-1000px',
            top: '-1000px'
        });
        for (a in s) e.style[a] = s[a];
        e.appendChild(r),
        i = o || document.documentElement,
        i.insertBefore(e, i.firstChild),
        r.style.cssText = 'position: absolute; left: 10.7432222px;',
        n = t(r).offset().left,
        t.support.offsetFractions = n > 10 && 11 > n,
        e.innerHTML = '',
        i.removeChild(e)
    }()
})(jQuery);
(function(e) {
    e.widget('ui.draggable', e.ui.mouse, {
        version: '1.10.2',
        widgetEventPrefix: 'drag',
        options: {
            addClasses: !0,
            appendTo: 'parent',
            axis: !1,
            connectToSortable: !1,
            containment: !1,
            cursor: 'auto',
            cursorAt: !1,
            grid: !1,
            handle: !1,
            helper: 'original',
            iframeFix: !1,
            opacity: !1,
            refreshPositions: !1,
            revert: !1,
            revertDuration: 500,
            scope: 'default',
            scroll: !0,
            scrollSensitivity: 20,
            scrollSpeed: 20,
            snap: !1,
            snapMode: 'both',
            snapTolerance: 20,
            stack: !1,
            zIndex: !1,
            drag: null,
            start: null,
            stop: null
        },
        _create: function() {
            'original' !== this.options.helper || /^(?:r|a|f)/.test(this.element.css('position')) || (this.element[0].style.position = 'relative'),
            this.options.addClasses && this.element.addClass('ui-draggable'),
            this.options.disabled && this.element.addClass('ui-draggable-disabled'),
            this._mouseInit()
        },
        _destroy: function() {
            this.element.removeClass('ui-draggable ui-draggable-dragging ui-draggable-disabled'),
            this._mouseDestroy()
        },
        _mouseCapture: function(t) {
            var i = this.options;
            return this.helper || i.disabled || e(t.target).closest('.ui-resizable-handle').length > 0 ? !1 : (this.handle = this._getHandle(t), this.handle ? (e(i.iframeFix === !0 ? 'iframe' : i.iframeFix).each(function() {
                e('<div class=\'ui-draggable-iframeFix\' style=\'background: #fff;\'></div>').css({
                    width: this.offsetWidth + 'px',
                    height: this.offsetHeight + 'px',
                    position: 'absolute',
                    opacity: '0.001',
                    zIndex: 1000
                }).css(e(this).offset()).appendTo('body')
            }), !0) : !1)
        },
        _mouseStart: function(t) {
            var i = this.options;
            return this.helper = this._createHelper(t),
                this.helper.addClass('ui-draggable-dragging'),
                this._cacheHelperProportions(),
                e.ui.ddmanager && (e.ui.ddmanager.current = this),
                this._cacheMargins(),
                this.cssPosition = this.helper.css('position'),
                this.scrollParent = this.helper.scrollParent(),
                this.offset = this.positionAbs = this.element.offset(),
                this.offset = {
                    top: this.offset.top - this.margins.top,
                    left: this.offset.left - this.margins.left
                },
                e.extend(this.offset, {
                    click: {
                        left: t.pageX - this.offset.left,
                        top: t.pageY - this.offset.top
                    },
                    parent: this._getParentOffset(),
                    relative: this._getRelativeOffset()
                }),
                this.originalPosition = this.position = this._generatePosition(t),
                this.originalPageX = t.pageX,
                this.originalPageY = t.pageY,
                i.cursorAt && this._adjustOffsetFromHelper(i.cursorAt),
                i.containment && this._setContainment(),
                this._trigger('start', t) === !1 ? (this._clear(), !1) : (this._cacheHelperProportions(), e.ui.ddmanager && !i.dropBehaviour && e.ui.ddmanager.prepareOffsets(this, t), this._mouseDrag(t, !0), e.ui.ddmanager && e.ui.ddmanager.dragStart(this, t), !0)
        },
        _mouseDrag: function(t, i) {
            if (this.position = this._generatePosition(t), this.positionAbs = this._convertPositionTo('absolute'), !i) {
                var s = this._uiHash();
                if (this._trigger('drag', t, s) === !1) return this._mouseUp({}), !1;
                this.position = s.position
            }
            return this.options.axis && 'y' === this.options.axis || (this.helper[0].style.left = this.position.left + 'px'),
                this.options.axis && 'x' === this.options.axis || (this.helper[0].style.top = this.position.top + 'px'),
                e.ui.ddmanager && e.ui.ddmanager.drag(this, t), !1
        },
        _mouseStop: function(t) {
            var i,
                s = this,
                n = !1,
                a = !1;
            for (e.ui.ddmanager && !this.options.dropBehaviour && (a = e.ui.ddmanager.drop(this, t)), this.dropped && (a = this.dropped, this.dropped = !1), i = this.element[0]; i && (i = i.parentNode);) i === document && (n = !0);
            return n || 'original' !== this.options.helper ? ('invalid' === this.options.revert && !a || 'valid' === this.options.revert && a || this.options.revert === !0 || e.isFunction(this.options.revert) && this.options.revert.call(this.element, a) ? e(this.helper).animate(this.originalPosition, parseInt(this.options.revertDuration, 10), function() {
                s._trigger('stop', t) !== !1 && s._clear()
            }) : this._trigger('stop', t) !== !1 && this._clear(), !1) : !1
        },
        _mouseUp: function(t) {
            return e('div.ui-draggable-iframeFix').each(function() {
                    this.parentNode.removeChild(this)
                }),
                e.ui.ddmanager && e.ui.ddmanager.dragStop(this, t),
                e.ui.mouse.prototype._mouseUp.call(this, t)
        },
        cancel: function() {
            return this.helper.is('.ui-draggable-dragging') ? this._mouseUp({}) : this._clear(),
                this
        },
        _getHandle: function(t) {
            return this.options.handle ? !!e(t.target).closest(this.element.find(this.options.handle)).length : !0
        },
        _createHelper: function(t) {
            var i = this.options,
                s = e.isFunction(i.helper) ? e(i.helper.apply(this.element[0], [
                    t
                ])) : 'clone' === i.helper ? this.element.clone().removeAttr('id') : this.element;
            return s.parents('body').length || s.appendTo('parent' === i.appendTo ? this.element[0].parentNode : i.appendTo),
                s[0] === this.element[0] || /(fixed|absolute)/.test(s.css('position')) || s.css('position', 'absolute'),
                s
        },
        _adjustOffsetFromHelper: function(t) {
            'string' == typeof t && (t = t.split(' ')),
            e.isArray(t) && (t = {
                left: +t[0],
                top: +t[1] || 0
            }),
                'left' in t && (this.offset.click.left = t.left + this.margins.left),
                'right' in t && (this.offset.click.left = this.helperProportions.width - t.right + this.margins.left),
                'top' in t && (this.offset.click.top = t.top + this.margins.top),
                'bottom' in t && (this.offset.click.top = this.helperProportions.height - t.bottom + this.margins.top)
        },
        _getParentOffset: function() {
            this.offsetParent = this.helper.offsetParent();
            var t = this.offsetParent.offset();
            return 'absolute' === this.cssPosition && this.scrollParent[0] !== document && e.contains(this.scrollParent[0], this.offsetParent[0]) && (t.left += this.scrollParent.scrollLeft(), t.top += this.scrollParent.scrollTop()), (this.offsetParent[0] === document.body || this.offsetParent[0].tagName && 'html' === this.offsetParent[0].tagName.toLowerCase() && e.ui.ie) && (t = {
                top: 0,
                left: 0
            }), {
                top: t.top + (parseInt(this.offsetParent.css('borderTopWidth'), 10) || 0),
                left: t.left + (parseInt(this.offsetParent.css('borderLeftWidth'), 10) || 0)
            }
        },
        _getRelativeOffset: function() {
            if ('relative' === this.cssPosition) {
                var e = this.element.position();
                return {
                    top: e.top - (parseInt(this.helper.css('top'), 10) || 0) + this.scrollParent.scrollTop(),
                    left: e.left - (parseInt(this.helper.css('left'), 10) || 0) + this.scrollParent.scrollLeft()
                }
            }
            return {
                top: 0,
                left: 0
            }
        },
        _cacheMargins: function() {
            this.margins = {
                left: parseInt(this.element.css('marginLeft'), 10) || 0,
                top: parseInt(this.element.css('marginTop'), 10) || 0,
                right: parseInt(this.element.css('marginRight'), 10) || 0,
                bottom: parseInt(this.element.css('marginBottom'), 10) || 0
            }
        },
        _cacheHelperProportions: function() {
            this.helperProportions = {
                width: this.helper.outerWidth(),
                height: this.helper.outerHeight()
            }
        },
        _setContainment: function() {
            var t,
                i,
                s,
                n = this.options;
            if ('parent' === n.containment && (n.containment = this.helper[0].parentNode), ('document' === n.containment || 'window' === n.containment) && (this.containment = [
                'document' === n.containment ? 0 : e(window).scrollLeft() - this.offset.relative.left - this.offset.parent.left,
                'document' === n.containment ? 0 : e(window).scrollTop() - this.offset.relative.top - this.offset.parent.top, ('document' === n.containment ? 0 : e(window).scrollLeft()) + e('document' === n.containment ? document : window).width() - this.helperProportions.width - this.margins.left, ('document' === n.containment ? 0 : e(window).scrollTop()) + (e('document' === n.containment ? document : window).height() || document.body.parentNode.scrollHeight) - this.helperProportions.height - this.margins.top
            ]), /^(document|window|parent)$/.test(n.containment) || n.containment.constructor === Array) n.containment.constructor === Array && (this.containment = n.containment);
            else {
                if (i = e(n.containment), s = i[0], !s) return;
                t = 'hidden' !== e(s).css('overflow'),
                this.containment = [
                    (parseInt(e(s).css('borderLeftWidth'), 10) || 0) + (parseInt(e(s).css('paddingLeft'), 10) || 0), (parseInt(e(s).css('borderTopWidth'), 10) || 0) + (parseInt(e(s).css('paddingTop'), 10) || 0), (t ? Math.max(s.scrollWidth, s.offsetWidth) : s.offsetWidth) - (parseInt(e(s).css('borderRightWidth'), 10) || 0) - (parseInt(e(s).css('paddingRight'), 10) || 0) - this.helperProportions.width - this.margins.left - this.margins.right, (t ? Math.max(s.scrollHeight, s.offsetHeight) : s.offsetHeight) - (parseInt(e(s).css('borderBottomWidth'), 10) || 0) - (parseInt(e(s).css('paddingBottom'), 10) || 0) - this.helperProportions.height - this.margins.top - this.margins.bottom
                ],
                this.relative_container = i
            }
        },
        _convertPositionTo: function(t, i) {
            i || (i = this.position);
            var s = 'absolute' === t ? 1 : -1,
                n = 'absolute' !== this.cssPosition || this.scrollParent[0] !== document && e.contains(this.scrollParent[0], this.offsetParent[0]) ? this.scrollParent : this.offsetParent,
                a = /(html|body)/i.test(n[0].tagName);
            return {
                top: i.top + this.offset.relative.top * s + this.offset.parent.top * s - ('fixed' === this.cssPosition ? -this.scrollParent.scrollTop() : a ? 0 : n.scrollTop()) * s,
                left: i.left + this.offset.relative.left * s + this.offset.parent.left * s - ('fixed' === this.cssPosition ? -this.scrollParent.scrollLeft() : a ? 0 : n.scrollLeft()) * s
            }
        },
        _generatePosition: function(t) {
            var i,
                s,
                n,
                a,
                o = this.options,
                r = 'absolute' !== this.cssPosition || this.scrollParent[0] !== document && e.contains(this.scrollParent[0], this.offsetParent[0]) ? this.scrollParent : this.offsetParent,
                h = /(html|body)/i.test(r[0].tagName),
                l = t.pageX,
                u = t.pageY;
            return this.originalPosition && (this.containment && (this.relative_container ? (s = this.relative_container.offset(), i = [
                this.containment[0] + s.left,
                this.containment[1] + s.top,
                this.containment[2] + s.left,
                this.containment[3] + s.top
            ]) : i = this.containment, t.pageX - this.offset.click.left < i[0] && (l = i[0] + this.offset.click.left), t.pageY - this.offset.click.top < i[1] && (u = i[1] + this.offset.click.top), t.pageX - this.offset.click.left > i[2] && (l = i[2] + this.offset.click.left), t.pageY - this.offset.click.top > i[3] && (u = i[3] + this.offset.click.top)), o.grid && (n = o.grid[1] ? this.originalPageY + Math.round((u - this.originalPageY) / o.grid[1]) * o.grid[1] : this.originalPageY, u = i ? n - this.offset.click.top >= i[1] || n - this.offset.click.top > i[3] ? n : n - this.offset.click.top >= i[1] ? n - o.grid[1] : n + o.grid[1] : n, a = o.grid[0] ? this.originalPageX + Math.round((l - this.originalPageX) / o.grid[0]) * o.grid[0] : this.originalPageX, l = i ? a - this.offset.click.left >= i[0] || a - this.offset.click.left > i[2] ? a : a - this.offset.click.left >= i[0] ? a - o.grid[0] : a + o.grid[0] : a)), {
                top: u - this.offset.click.top - this.offset.relative.top - this.offset.parent.top + ('fixed' === this.cssPosition ? -this.scrollParent.scrollTop() : h ? 0 : r.scrollTop()),
                left: l - this.offset.click.left - this.offset.relative.left - this.offset.parent.left + ('fixed' === this.cssPosition ? -this.scrollParent.scrollLeft() : h ? 0 : r.scrollLeft())
            }
        },
        _clear: function() {
            this.helper.removeClass('ui-draggable-dragging'),
            this.helper[0] === this.element[0] || this.cancelHelperRemoval || this.helper.remove(),
            this.helper = null,
            this.cancelHelperRemoval = !1
        },
        _trigger: function(t, i, s) {
            return s = s || this._uiHash(),
                e.ui.plugin.call(this, t, [
                    i,
                    s
                ]),
                'drag' === t && (this.positionAbs = this._convertPositionTo('absolute')),
                e.Widget.prototype._trigger.call(this, t, i, s)
        },
        plugins: {},
        _uiHash: function() {
            return {
                helper: this.helper,
                position: this.position,
                originalPosition: this.originalPosition,
                offset: this.positionAbs
            }
        }
    }),
    e.ui.plugin.add('draggable', 'connectToSortable', {
        start: function(t, i) {
            var s = e(this).data('ui-draggable'),
                n = s.options,
                a = e.extend({}, i, {
                    item: s.element
                });
            s.sortables = [],
            e(n.connectToSortable).each(function() {
                var i = e.data(this, 'ui-sortable');
                i && !i.options.disabled && (s.sortables.push({
                    instance: i,
                    shouldRevert: i.options.revert
                }), i.refreshPositions(), i._trigger('activate', t, a))
            })
        },
        stop: function(t, i) {
            var s = e(this).data('ui-draggable'),
                n = e.extend({}, i, {
                    item: s.element
                });
            e.each(s.sortables, function() {
                this.instance.isOver ? (this.instance.isOver = 0, s.cancelHelperRemoval = !0, this.instance.cancelHelperRemoval = !1, this.shouldRevert && (this.instance.options.revert = this.shouldRevert), this.instance._mouseStop(t), this.instance.options.helper = this.instance.options._helper, 'original' === s.options.helper && this.instance.currentItem.css({
                    top: 'auto',
                    left: 'auto'
                })) : (this.instance.cancelHelperRemoval = !1, this.instance._trigger('deactivate', t, n))
            })
        },
        drag: function(t, i) {
            var s = e(this).data('ui-draggable'),
                n = this;
            e.each(s.sortables, function() {
                var a = !1,
                    o = this;
                this.instance.positionAbs = s.positionAbs,
                this.instance.helperProportions = s.helperProportions,
                this.instance.offset.click = s.offset.click,
                this.instance._intersectsWith(this.instance.containerCache) && (a = !0, e.each(s.sortables, function() {
                    return this.instance.positionAbs = s.positionAbs,
                        this.instance.helperProportions = s.helperProportions,
                        this.instance.offset.click = s.offset.click,
                        this !== o && this.instance._intersectsWith(this.instance.containerCache) && e.contains(o.instance.element[0], this.instance.element[0]) && (a = !1),
                        a
                })),
                a ? (this.instance.isOver || (this.instance.isOver = 1, this.instance.currentItem = e(n).clone().removeAttr('id').appendTo(this.instance.element).data('ui-sortable-item', !0), this.instance.options._helper = this.instance.options.helper, this.instance.options.helper = function() {
                    return i.helper[0]
                }, t.target = this.instance.currentItem[0], this.instance._mouseCapture(t, !0), this.instance._mouseStart(t, !0, !0), this.instance.offset.click.top = s.offset.click.top, this.instance.offset.click.left = s.offset.click.left, this.instance.offset.parent.left -= s.offset.parent.left - this.instance.offset.parent.left, this.instance.offset.parent.top -= s.offset.parent.top - this.instance.offset.parent.top, s._trigger('toSortable', t), s.dropped = this.instance.element, s.currentItem = s.element, this.instance.fromOutside = s), this.instance.currentItem && this.instance._mouseDrag(t)) : this.instance.isOver && (this.instance.isOver = 0, this.instance.cancelHelperRemoval = !0, this.instance.options.revert = !1, this.instance._trigger('out', t, this.instance._uiHash(this.instance)), this.instance._mouseStop(t, !0), this.instance.options.helper = this.instance.options._helper, this.instance.currentItem.remove(), this.instance.placeholder && this.instance.placeholder.remove(), s._trigger('fromSortable', t), s.dropped = !1)
            })
        }
    }),
    e.ui.plugin.add('draggable', 'cursor', {
        start: function() {
            var t = e('body'),
                i = e(this).data('ui-draggable').options;
            t.css('cursor') && (i._cursor = t.css('cursor')),
            t.css('cursor', i.cursor)
        },
        stop: function() {
            var t = e(this).data('ui-draggable').options;
            t._cursor && e('body').css('cursor', t._cursor)
        }
    }),
    e.ui.plugin.add('draggable', 'opacity', {
        start: function(t, i) {
            var s = e(i.helper),
                n = e(this).data('ui-draggable').options;
            s.css('opacity') && (n._opacity = s.css('opacity')),
            s.css('opacity', n.opacity)
        },
        stop: function(t, i) {
            var s = e(this).data('ui-draggable').options;
            s._opacity && e(i.helper).css('opacity', s._opacity)
        }
    }),
    e.ui.plugin.add('draggable', 'scroll', {
        start: function() {
            var t = e(this).data('ui-draggable');
            t.scrollParent[0] !== document && 'HTML' !== t.scrollParent[0].tagName && (t.overflowOffset = t.scrollParent.offset())
        },
        drag: function(t) {
            var i = e(this).data('ui-draggable'),
                s = i.options,
                n = !1;
            i.scrollParent[0] !== document && 'HTML' !== i.scrollParent[0].tagName ? (s.axis && 'x' === s.axis || (i.overflowOffset.top + i.scrollParent[0].offsetHeight - t.pageY < s.scrollSensitivity ? i.scrollParent[0].scrollTop = n = i.scrollParent[0].scrollTop + s.scrollSpeed : t.pageY - i.overflowOffset.top < s.scrollSensitivity && (i.scrollParent[0].scrollTop = n = i.scrollParent[0].scrollTop - s.scrollSpeed)), s.axis && 'y' === s.axis || (i.overflowOffset.left + i.scrollParent[0].offsetWidth - t.pageX < s.scrollSensitivity ? i.scrollParent[0].scrollLeft = n = i.scrollParent[0].scrollLeft + s.scrollSpeed : t.pageX - i.overflowOffset.left < s.scrollSensitivity && (i.scrollParent[0].scrollLeft = n = i.scrollParent[0].scrollLeft - s.scrollSpeed))) : (s.axis && 'x' === s.axis || (t.pageY - e(document).scrollTop() < s.scrollSensitivity ? n = e(document).scrollTop(e(document).scrollTop() - s.scrollSpeed) : e(window).height() - (t.pageY - e(document).scrollTop()) < s.scrollSensitivity && (n = e(document).scrollTop(e(document).scrollTop() + s.scrollSpeed))), s.axis && 'y' === s.axis || (t.pageX - e(document).scrollLeft() < s.scrollSensitivity ? n = e(document).scrollLeft(e(document).scrollLeft() - s.scrollSpeed) : e(window).width() - (t.pageX - e(document).scrollLeft()) < s.scrollSensitivity && (n = e(document).scrollLeft(e(document).scrollLeft() + s.scrollSpeed)))),
            n !== !1 && e.ui.ddmanager && !s.dropBehaviour && e.ui.ddmanager.prepareOffsets(i, t)
        }
    }),
    e.ui.plugin.add('draggable', 'snap', {
        start: function() {
            var t = e(this).data('ui-draggable'),
                i = t.options;
            t.snapElements = [],
            e(i.snap.constructor !== String ? i.snap.items || ':data(ui-draggable)' : i.snap).each(function() {
                var i = e(this),
                    s = i.offset();
                this !== t.element[0] && t.snapElements.push({
                    item: this,
                    width: i.outerWidth(),
                    height: i.outerHeight(),
                    top: s.top,
                    left: s.left
                })
            })
        },
        drag: function(t, i) {
            var s,
                n,
                a,
                o,
                r,
                h,
                l,
                u,
                c,
                d,
                p = e(this).data('ui-draggable'),
                f = p.options,
                m = f.snapTolerance,
                g = i.offset.left,
                v = g + p.helperProportions.width,
                y = i.offset.top,
                b = y + p.helperProportions.height;
            for (c = p.snapElements.length - 1; c >= 0; c--) r = p.snapElements[c].left,
                h = r + p.snapElements[c].width,
                l = p.snapElements[c].top,
                u = l + p.snapElements[c].height,
                g > r - m && h + m > g && y > l - m && u + m > y || g > r - m && h + m > g && b > l - m && u + m > b || v > r - m && h + m > v && y > l - m && u + m > y || v > r - m && h + m > v && b > l - m && u + m > b ? ('inner' !== f.snapMode && (s = m >= Math.abs(l - b), n = m >= Math.abs(u - y), a = m >= Math.abs(r - v), o = m >= Math.abs(h - g), s && (i.position.top = p._convertPositionTo('relative', {
                    top: l - p.helperProportions.height,
                    left: 0
                }).top - p.margins.top), n && (i.position.top = p._convertPositionTo('relative', {
                    top: u,
                    left: 0
                }).top - p.margins.top), a && (i.position.left = p._convertPositionTo('relative', {
                    top: 0,
                    left: r - p.helperProportions.width
                }).left - p.margins.left), o && (i.position.left = p._convertPositionTo('relative', {
                    top: 0,
                    left: h
                }).left - p.margins.left)), d = s || n || a || o, 'outer' !== f.snapMode && (s = m >= Math.abs(l - y), n = m >= Math.abs(u - b), a = m >= Math.abs(r - g), o = m >= Math.abs(h - v), s && (i.position.top = p._convertPositionTo('relative', {
                    top: l,
                    left: 0
                }).top - p.margins.top), n && (i.position.top = p._convertPositionTo('relative', {
                    top: u - p.helperProportions.height,
                    left: 0
                }).top - p.margins.top), a && (i.position.left = p._convertPositionTo('relative', {
                    top: 0,
                    left: r
                }).left - p.margins.left), o && (i.position.left = p._convertPositionTo('relative', {
                    top: 0,
                    left: h - p.helperProportions.width
                }).left - p.margins.left)), !p.snapElements[c].snapping && (s || n || a || o || d) && p.options.snap.snap && p.options.snap.snap.call(p.element, t, e.extend(p._uiHash(), {
                    snapItem: p.snapElements[c].item
                })), p.snapElements[c].snapping = s || n || a || o || d) : (p.snapElements[c].snapping && p.options.snap.release && p.options.snap.release.call(p.element, t, e.extend(p._uiHash(), {
                    snapItem: p.snapElements[c].item
                })), p.snapElements[c].snapping = !1)
        }
    }),
    e.ui.plugin.add('draggable', 'stack', {
        start: function() {
            var t,
                i = this.data('ui-draggable').options,
                s = e.makeArray(e(i.stack)).sort(function(t, i) {
                    return (parseInt(e(t).css('zIndex'), 10) || 0) - (parseInt(e(i).css('zIndex'), 10) || 0)
                });
            s.length && (t = parseInt(e(s[0]).css('zIndex'), 10) || 0, e(s).each(function(i) {
                e(this).css('zIndex', t + i)
            }), this.css('zIndex', t + s.length))
        }
    }),
    e.ui.plugin.add('draggable', 'zIndex', {
        start: function(t, i) {
            var s = e(i.helper),
                n = e(this).data('ui-draggable').options;
            s.css('zIndex') && (n._zIndex = s.css('zIndex')),
            s.css('zIndex', n.zIndex)
        },
        stop: function(t, i) {
            var s = e(this).data('ui-draggable').options;
            s._zIndex && e(i.helper).css('zIndex', s._zIndex)
        }
    })
})(jQuery);
(function(e) {
    function t(e, t, i) {
        return e > t && t + i > e
    }
    e.widget('ui.droppable', {
        version: '1.10.2',
        widgetEventPrefix: 'drop',
        options: {
            accept: '*',
            activeClass: !1,
            addClasses: !0,
            greedy: !1,
            hoverClass: !1,
            scope: 'default',
            tolerance: 'intersect',
            activate: null,
            deactivate: null,
            drop: null,
            out: null,
            over: null
        },
        _create: function() {
            var t = this.options,
                i = t.accept;
            this.isover = !1,
            this.isout = !0,
            this.accept = e.isFunction(i) ? i : function(e) {
                return e.is(i)
            },
            this.proportions = {
                width: this.element[0].offsetWidth,
                height: this.element[0].offsetHeight
            },
            e.ui.ddmanager.droppables[t.scope] = e.ui.ddmanager.droppables[t.scope] || [],
            e.ui.ddmanager.droppables[t.scope].push(this),
            t.addClasses && this.element.addClass('ui-droppable')
        },
        _destroy: function() {
            for (var t = 0, i = e.ui.ddmanager.droppables[this.options.scope]; i.length > t; t++) i[t] === this && i.splice(t, 1);
            this.element.removeClass('ui-droppable ui-droppable-disabled')
        },
        _setOption: function(t, i) {
            'accept' === t && (this.accept = e.isFunction(i) ? i : function(e) {
                return e.is(i)
            }),
            e.Widget.prototype._setOption.apply(this, arguments)
        },
        _activate: function(t) {
            var i = e.ui.ddmanager.current;
            this.options.activeClass && this.element.addClass(this.options.activeClass),
            i && this._trigger('activate', t, this.ui(i))
        },
        _deactivate: function(t) {
            var i = e.ui.ddmanager.current;
            this.options.activeClass && this.element.removeClass(this.options.activeClass),
            i && this._trigger('deactivate', t, this.ui(i))
        },
        _over: function(t) {
            var i = e.ui.ddmanager.current;
            i && (i.currentItem || i.element)[0] !== this.element[0] && this.accept.call(this.element[0], i.currentItem || i.element) && (this.options.hoverClass && this.element.addClass(this.options.hoverClass), this._trigger('over', t, this.ui(i)))
        },
        _out: function(t) {
            var i = e.ui.ddmanager.current;
            i && (i.currentItem || i.element)[0] !== this.element[0] && this.accept.call(this.element[0], i.currentItem || i.element) && (this.options.hoverClass && this.element.removeClass(this.options.hoverClass), this._trigger('out', t, this.ui(i)))
        },
        _drop: function(t, i) {
            var s = i || e.ui.ddmanager.current,
                n = !1;
            return s && (s.currentItem || s.element)[0] !== this.element[0] ? (this.element.find(':data(ui-droppable)').not('.ui-draggable-dragging').each(function() {
                var t = e.data(this, 'ui-droppable');
                return t.options.greedy && !t.options.disabled && t.options.scope === s.options.scope && t.accept.call(t.element[0], s.currentItem || s.element) && e.ui.intersect(s, e.extend(t, {
                    offset: t.element.offset()
                }), t.options.tolerance) ? (n = !0, !1) : undefined
            }), n ? !1 : this.accept.call(this.element[0], s.currentItem || s.element) ? (this.options.activeClass && this.element.removeClass(this.options.activeClass), this.options.hoverClass && this.element.removeClass(this.options.hoverClass), this._trigger('drop', t, this.ui(s)), this.element) : !1) : !1
        },
        ui: function(e) {
            return {
                draggable: e.currentItem || e.element,
                helper: e.helper,
                position: e.position,
                offset: e.positionAbs
            }
        }
    }),
    e.ui.intersect = function(e, i, s) {
        if (!i.offset) return !1;
        var n,
            a,
            o = (e.positionAbs || e.position.absolute).left,
            r = o + e.helperProportions.width,
            h = (e.positionAbs || e.position.absolute).top,
            l = h + e.helperProportions.height,
            u = i.offset.left,
            c = u + i.proportions.width,
            d = i.offset.top,
            p = d + i.proportions.height;
        switch (s) {
            case 'fit':
                return o >= u && c >= r && h >= d && p >= l;
            case 'intersect':
                return o + e.helperProportions.width / 2 > u && c > r - e.helperProportions.width / 2 && h + e.helperProportions.height / 2 > d && p > l - e.helperProportions.height / 2;
            case 'pointer':
                return n = (e.positionAbs || e.position.absolute).left + (e.clickOffset || e.offset.click).left,
                    a = (e.positionAbs || e.position.absolute).top + (e.clickOffset || e.offset.click).top,
                    t(a, d, i.proportions.height) && t(n, u, i.proportions.width);
            case 'touch':
                return (h >= d && p >= h || l >= d && p >= l || d > h && l > p) && (o >= u && c >= o || r >= u && c >= r || u > o && r > c);
            default:
                return !1
        }
    },
    e.ui.ddmanager = {
        current: null,
        droppables: {
            'default': []
        },
        prepareOffsets: function(t, i) {
            var s,
                n,
                a = e.ui.ddmanager.droppables[t.options.scope] || [],
                o = i ? i.type : null,
                r = (t.currentItem || t.element).find(':data(ui-droppable)').addBack();
            e: for (s = 0; a.length > s; s++)
                if (!(a[s].options.disabled || t && !a[s].accept.call(a[s].element[0], t.currentItem || t.element))) {
                    for (n = 0; r.length > n; n++)
                        if (r[n] === a[s].element[0]) {
                            a[s].proportions.height = 0;
                            continue e
                        }
                    a[s].visible = 'none' !== a[s].element.css('display'),
                    a[s].visible && ('mousedown' === o && a[s]._activate.call(a[s], i), a[s].offset = a[s].element.offset(), a[s].proportions = {
                        width: a[s].element[0].offsetWidth,
                        height: a[s].element[0].offsetHeight
                    })
                }
        },
        drop: function(t, i) {
            var s = !1;
            return e.each((e.ui.ddmanager.droppables[t.options.scope] || []).slice(), function() {
                    this.options && (!this.options.disabled && this.visible && e.ui.intersect(t, this, this.options.tolerance) && (s = this._drop.call(this, i) || s), !this.options.disabled && this.visible && this.accept.call(this.element[0], t.currentItem || t.element) && (this.isout = !0, this.isover = !1, this._deactivate.call(this, i)))
                }),
                s
        },
        dragStart: function(t, i) {
            t.element.parentsUntil('body').bind('scroll.droppable', function() {
                t.options.refreshPositions || e.ui.ddmanager.prepareOffsets(t, i)
            })
        },
        drag: function(t, i) {
            t.options.refreshPositions && e.ui.ddmanager.prepareOffsets(t, i),
            e.each(e.ui.ddmanager.droppables[t.options.scope] || [], function() {
                if (!this.options.disabled && !this.greedyChild && this.visible) {
                    var s,
                        n,
                        a,
                        o = e.ui.intersect(t, this, this.options.tolerance),
                        r = !o && this.isover ? 'isout' : o && !this.isover ? 'isover' : null;
                    r && (this.options.greedy && (n = this.options.scope, a = this.element.parents(':data(ui-droppable)').filter(function() {
                        return e.data(this, 'ui-droppable').options.scope === n
                    }), a.length && (s = e.data(a[0], 'ui-droppable'), s.greedyChild = 'isover' === r)), s && 'isover' === r && (s.isover = !1, s.isout = !0, s._out.call(s, i)), this[r] = !0, this['isout' === r ? 'isover' : 'isout'] = !1, this['isover' === r ? '_over' : '_out'].call(this, i), s && 'isout' === r && (s.isout = !1, s.isover = !0, s._over.call(s, i)))
                }
            })
        },
        dragStop: function(t, i) {
            t.element.parentsUntil('body').unbind('scroll.droppable'),
            t.options.refreshPositions || e.ui.ddmanager.prepareOffsets(t, i)
        }
    }
})(jQuery);
(function(e) {
    function t(e) {
        return parseInt(e, 10) || 0
    }

    function i(e) {
        return !isNaN(parseInt(e, 10))
    }
    e.widget('ui.resizable', e.ui.mouse, {
        version: '1.10.2',
        widgetEventPrefix: 'resize',
        options: {
            alsoResize: !1,
            animate: !1,
            animateDuration: 'slow',
            animateEasing: 'swing',
            aspectRatio: !1,
            autoHide: !1,
            containment: !1,
            ghost: !1,
            grid: !1,
            handles: 'e,s,se',
            helper: !1,
            maxHeight: null,
            maxWidth: null,
            minHeight: 10,
            minWidth: 10,
            zIndex: 90,
            resize: null,
            start: null,
            stop: null
        },
        _create: function() {
            var t,
                i,
                s,
                n,
                a,
                o = this,
                r = this.options;
            if (this.element.addClass('ui-resizable'), e.extend(this, {
                _aspectRatio: !!r.aspectRatio,
                aspectRatio: r.aspectRatio,
                originalElement: this.element,
                _proportionallyResizeElements: [],
                _helper: r.helper || r.ghost || r.animate ? r.helper || 'ui-resizable-helper' : null
            }), this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i) && (this.element.wrap(e('<div class=\'ui-wrapper\' style=\'overflow: hidden;\'></div>').css({
                position: this.element.css('position'),
                width: this.element.outerWidth(),
                height: this.element.outerHeight(),
                top: this.element.css('top'),
                left: this.element.css('left')
            })), this.element = this.element.parent().data('ui-resizable', this.element.data('ui-resizable')), this.elementIsWrapper = !0, this.element.css({
                marginLeft: this.originalElement.css('marginLeft'),
                marginTop: this.originalElement.css('marginTop'),
                marginRight: this.originalElement.css('marginRight'),
                marginBottom: this.originalElement.css('marginBottom')
            }), this.originalElement.css({
                marginLeft: 0,
                marginTop: 0,
                marginRight: 0,
                marginBottom: 0
            }), this.originalResizeStyle = this.originalElement.css('resize'), this.originalElement.css('resize', 'none'), this._proportionallyResizeElements.push(this.originalElement.css({
                position: 'static',
                zoom: 1,
                display: 'block'
            })), this.originalElement.css({
                margin: this.originalElement.css('margin')
            }), this._proportionallyResize()), this.handles = r.handles || (e('.ui-resizable-handle', this.element).length ? {
                n: '.ui-resizable-n',
                e: '.ui-resizable-e',
                s: '.ui-resizable-s',
                w: '.ui-resizable-w',
                se: '.ui-resizable-se',
                sw: '.ui-resizable-sw',
                ne: '.ui-resizable-ne',
                nw: '.ui-resizable-nw'
            } : 'e,s,se'), this.handles.constructor === String)
                for ('all' === this.handles && (this.handles = 'n,e,s,w,se,sw,ne,nw'), t = this.handles.split(','), this.handles = {}, i = 0; t.length > i; i++) s = e.trim(t[i]),
                    a = 'ui-resizable-' + s,
                    n = e('<div class=\'ui-resizable-handle ' + a + '\'></div>'),
                    n.css({
                        zIndex: r.zIndex
                    }),
                    'se' === s && n.addClass('ui-icon ui-icon-gripsmall-diagonal-se'),
                    this.handles[s] = '.ui-resizable-' + s,
                    this.element.append(n);
            this._renderAxis = function(t) {
                var i,
                    s,
                    n,
                    a;
                t = t || this.element;
                for (i in this.handles) this.handles[i].constructor === String && (this.handles[i] = e(this.handles[i], this.element).show()),
                    this.elementIsWrapper && this.originalElement[0].nodeName.match(/textarea|input|select|button/i) && (s = e(this.handles[i], this.element), a = /sw|ne|nw|se|n|s/.test(i) ? s.outerHeight() : s.outerWidth(), n = [
                        'padding',
                        /ne|nw|n/.test(i) ? 'Top' : /se|sw|s/.test(i) ? 'Bottom' : /^e$/.test(i) ? 'Right' : 'Left'
                    ].join(''), t.css(n, a), this._proportionallyResize()),
                    e(this.handles[i]).length
            },
            this._renderAxis(this.element),
            this._handles = e('.ui-resizable-handle', this.element).disableSelection(),
            this._handles.mouseover(function() {
                o.resizing || (this.className && (n = this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)), o.axis = n && n[1] ? n[1] : 'se')
            }),
            r.autoHide && (this._handles.hide(), e(this.element).addClass('ui-resizable-autohide').mouseenter(function() {
                r.disabled || (e(this).removeClass('ui-resizable-autohide'), o._handles.show())
            }).mouseleave(function() {
                r.disabled || o.resizing || (e(this).addClass('ui-resizable-autohide'), o._handles.hide())
            })),
            this._mouseInit()
        },
        _destroy: function() {
            this._mouseDestroy();
            var t,
                i = function(t) {
                    e(t).removeClass('ui-resizable ui-resizable-disabled ui-resizable-resizing').removeData('resizable').removeData('ui-resizable').unbind('.resizable').find('.ui-resizable-handle').remove()
                };
            return this.elementIsWrapper && (i(this.element), t = this.element, this.originalElement.css({
                    position: t.css('position'),
                    width: t.outerWidth(),
                    height: t.outerHeight(),
                    top: t.css('top'),
                    left: t.css('left')
                }).insertAfter(t), t.remove()),
                this.originalElement.css('resize', this.originalResizeStyle),
                i(this.originalElement),
                this
        },
        _mouseCapture: function(t) {
            var i,
                s,
                n = !1;
            for (i in this.handles) s = e(this.handles[i])[0], (s === t.target || e.contains(s, t.target)) && (n = !0);
            return !this.options.disabled && n
        },
        _mouseStart: function(i) {
            var s,
                n,
                a,
                o = this.options,
                r = this.element.position(),
                h = this.element;
            return this.resizing = !0,
                /absolute/.test(h.css('position')) ? h.css({
                    position: 'absolute',
                    top: h.css('top'),
                    left: h.css('left')
                }) : h.is('.ui-draggable') && h.css({
                    position: 'absolute',
                    top: r.top,
                    left: r.left
                }),
                this._renderProxy(),
                s = t(this.helper.css('left')),
                n = t(this.helper.css('top')),
                o.containment && (s += e(o.containment).scrollLeft() || 0, n += e(o.containment).scrollTop() || 0),
                this.offset = this.helper.offset(),
                this.position = {
                    left: s,
                    top: n
                },
                this.size = this._helper ? {
                    width: h.outerWidth(),
                    height: h.outerHeight()
                } : {
                    width: h.width(),
                    height: h.height()
                },
                this.originalSize = this._helper ? {
                    width: h.outerWidth(),
                    height: h.outerHeight()
                } : {
                    width: h.width(),
                    height: h.height()
                },
                this.originalPosition = {
                    left: s,
                    top: n
                },
                this.sizeDiff = {
                    width: h.outerWidth() - h.width(),
                    height: h.outerHeight() - h.height()
                },
                this.originalMousePosition = {
                    left: i.pageX,
                    top: i.pageY
                },
                this.aspectRatio = 'number' == typeof o.aspectRatio ? o.aspectRatio : this.originalSize.width / this.originalSize.height || 1,
                a = e('.ui-resizable-' + this.axis).css('cursor'),
                e('body').css('cursor', 'auto' === a ? this.axis + '-resize' : a),
                h.addClass('ui-resizable-resizing'),
                this._propagate('start', i), !0
        },
        _mouseDrag: function(t) {
            var i,
                s = this.helper,
                n = {},
                a = this.originalMousePosition,
                o = this.axis,
                r = this.position.top,
                h = this.position.left,
                l = this.size.width,
                u = this.size.height,
                c = t.pageX - a.left || 0,
                d = t.pageY - a.top || 0,
                p = this._change[o];
            return p ? (i = p.apply(this, [
                t,
                c,
                d
            ]), this._updateVirtualBoundaries(t.shiftKey), (this._aspectRatio || t.shiftKey) && (i = this._updateRatio(i, t)), i = this._respectSize(i, t), this._updateCache(i), this._propagate('resize', t), this.position.top !== r && (n.top = this.position.top + 'px'), this.position.left !== h && (n.left = this.position.left + 'px'), this.size.width !== l && (n.width = this.size.width + 'px'), this.size.height !== u && (n.height = this.size.height + 'px'), s.css(n), !this._helper && this._proportionallyResizeElements.length && this._proportionallyResize(), e.isEmptyObject(n) || this._trigger('resize', t, this.ui()), !1) : !1
        },
        _mouseStop: function(t) {
            this.resizing = !1;
            var i,
                s,
                n,
                a,
                o,
                r,
                h,
                l = this.options,
                u = this;
            return this._helper && (i = this._proportionallyResizeElements, s = i.length && /textarea/i.test(i[0].nodeName), n = s && e.ui.hasScroll(i[0], 'left') ? 0 : u.sizeDiff.height, a = s ? 0 : u.sizeDiff.width, o = {
                    width: u.helper.width() - a,
                    height: u.helper.height() - n
                }, r = parseInt(u.element.css('left'), 10) + (u.position.left - u.originalPosition.left) || null, h = parseInt(u.element.css('top'), 10) + (u.position.top - u.originalPosition.top) || null, l.animate || this.element.css(e.extend(o, {
                    top: h,
                    left: r
                })), u.helper.height(u.size.height), u.helper.width(u.size.width), this._helper && !l.animate && this._proportionallyResize()),
                e('body').css('cursor', 'auto'),
                this.element.removeClass('ui-resizable-resizing'),
                this._propagate('stop', t),
                this._helper && this.helper.remove(), !1
        },
        _updateVirtualBoundaries: function(e) {
            var t,
                s,
                n,
                a,
                o,
                r = this.options;
            o = {
                minWidth: i(r.minWidth) ? r.minWidth : 0,
                maxWidth: i(r.maxWidth) ? r.maxWidth : 1 / 0,
                minHeight: i(r.minHeight) ? r.minHeight : 0,
                maxHeight: i(r.maxHeight) ? r.maxHeight : 1 / 0
            }, (this._aspectRatio || e) && (t = o.minHeight * this.aspectRatio, n = o.minWidth / this.aspectRatio, s = o.maxHeight * this.aspectRatio, a = o.maxWidth / this.aspectRatio, t > o.minWidth && (o.minWidth = t), n > o.minHeight && (o.minHeight = n), o.maxWidth > s && (o.maxWidth = s), o.maxHeight > a && (o.maxHeight = a)),
            this._vBoundaries = o
        },
        _updateCache: function(e) {
            this.offset = this.helper.offset(),
            i(e.left) && (this.position.left = e.left),
            i(e.top) && (this.position.top = e.top),
            i(e.height) && (this.size.height = e.height),
            i(e.width) && (this.size.width = e.width)
        },
        _updateRatio: function(e) {
            var t = this.position,
                s = this.size,
                n = this.axis;
            return i(e.height) ? e.width = e.height * this.aspectRatio : i(e.width) && (e.height = e.width / this.aspectRatio),
                'sw' === n && (e.left = t.left + (s.width - e.width), e.top = null),
                'nw' === n && (e.top = t.top + (s.height - e.height), e.left = t.left + (s.width - e.width)),
                e
        },
        _respectSize: function(e) {
            var t = this._vBoundaries,
                s = this.axis,
                n = i(e.width) && t.maxWidth && t.maxWidth < e.width,
                a = i(e.height) && t.maxHeight && t.maxHeight < e.height,
                o = i(e.width) && t.minWidth && t.minWidth > e.width,
                r = i(e.height) && t.minHeight && t.minHeight > e.height,
                h = this.originalPosition.left + this.originalSize.width,
                l = this.position.top + this.size.height,
                u = /sw|nw|w/.test(s),
                c = /nw|ne|n/.test(s);
            return o && (e.width = t.minWidth),
                r && (e.height = t.minHeight),
                n && (e.width = t.maxWidth),
                a && (e.height = t.maxHeight),
                o && u && (e.left = h - t.minWidth),
                n && u && (e.left = h - t.maxWidth),
                r && c && (e.top = l - t.minHeight),
                a && c && (e.top = l - t.maxHeight),
                e.width || e.height || e.left || !e.top ? e.width || e.height || e.top || !e.left || (e.left = null) : e.top = null,
                e
        },
        _proportionallyResize: function() {
            if (this._proportionallyResizeElements.length) {
                var e,
                    t,
                    i,
                    s,
                    n,
                    a = this.helper || this.element;
                for (e = 0; this._proportionallyResizeElements.length > e; e++) {
                    if (n = this._proportionallyResizeElements[e], !this.borderDif)
                        for (this.borderDif = [], i = [
                            n.css('borderTopWidth'),
                            n.css('borderRightWidth'),
                            n.css('borderBottomWidth'),
                            n.css('borderLeftWidth')
                        ], s = [
                            n.css('paddingTop'),
                            n.css('paddingRight'),
                            n.css('paddingBottom'),
                            n.css('paddingLeft')
                        ], t = 0; i.length > t; t++) this.borderDif[t] = (parseInt(i[t], 10) || 0) + (parseInt(s[t], 10) || 0);
                    n.css({
                        height: a.height() - this.borderDif[0] - this.borderDif[2] || 0,
                        width: a.width() - this.borderDif[1] - this.borderDif[3] || 0
                    })
                }
            }
        },
        _renderProxy: function() {
            var t = this.element,
                i = this.options;
            this.elementOffset = t.offset(),
            this._helper ? (this.helper = this.helper || e('<div style=\'overflow:hidden;\'></div>'), this.helper.addClass(this._helper).css({
                width: this.element.outerWidth() - 1,
                height: this.element.outerHeight() - 1,
                position: 'absolute',
                left: this.elementOffset.left + 'px',
                top: this.elementOffset.top + 'px',
                zIndex: ++i.zIndex
            }), this.helper.appendTo('body').disableSelection()) : this.helper = this.element
        },
        _change: {
            e: function(e, t) {
                return {
                    width: this.originalSize.width + t
                }
            },
            w: function(e, t) {
                var i = this.originalSize,
                    s = this.originalPosition;
                return {
                    left: s.left + t,
                    width: i.width - t
                }
            },
            n: function(e, t, i) {
                var s = this.originalSize,
                    n = this.originalPosition;
                return {
                    top: n.top + i,
                    height: s.height - i
                }
            },
            s: function(e, t, i) {
                return {
                    height: this.originalSize.height + i
                }
            },
            se: function(t, i, s) {
                return e.extend(this._change.s.apply(this, arguments), this._change.e.apply(this, [
                    t,
                    i,
                    s
                ]))
            },
            sw: function(t, i, s) {
                return e.extend(this._change.s.apply(this, arguments), this._change.w.apply(this, [
                    t,
                    i,
                    s
                ]))
            },
            ne: function(t, i, s) {
                return e.extend(this._change.n.apply(this, arguments), this._change.e.apply(this, [
                    t,
                    i,
                    s
                ]))
            },
            nw: function(t, i, s) {
                return e.extend(this._change.n.apply(this, arguments), this._change.w.apply(this, [
                    t,
                    i,
                    s
                ]))
            }
        },
        _propagate: function(t, i) {
            e.ui.plugin.call(this, t, [
                i,
                this.ui()
            ]),
                'resize' !== t && this._trigger(t, i, this.ui())
        },
        plugins: {},
        ui: function() {
            return {
                originalElement: this.originalElement,
                element: this.element,
                helper: this.helper,
                position: this.position,
                size: this.size,
                originalSize: this.originalSize,
                originalPosition: this.originalPosition
            }
        }
    }),
    e.ui.plugin.add('resizable', 'animate', {
        stop: function(t) {
            var i = e(this).data('ui-resizable'),
                s = i.options,
                n = i._proportionallyResizeElements,
                a = n.length && /textarea/i.test(n[0].nodeName),
                o = a && e.ui.hasScroll(n[0], 'left') ? 0 : i.sizeDiff.height,
                r = a ? 0 : i.sizeDiff.width,
                h = {
                    width: i.size.width - r,
                    height: i.size.height - o
                },
                l = parseInt(i.element.css('left'), 10) + (i.position.left - i.originalPosition.left) || null,
                u = parseInt(i.element.css('top'), 10) + (i.position.top - i.originalPosition.top) || null;
            i.element.animate(e.extend(h, u && l ? {
                top: u,
                left: l
            } : {}), {
                duration: s.animateDuration,
                easing: s.animateEasing,
                step: function() {
                    var s = {
                        width: parseInt(i.element.css('width'), 10),
                        height: parseInt(i.element.css('height'), 10),
                        top: parseInt(i.element.css('top'), 10),
                        left: parseInt(i.element.css('left'), 10)
                    };
                    n && n.length && e(n[0]).css({
                        width: s.width,
                        height: s.height
                    }),
                    i._updateCache(s),
                    i._propagate('resize', t)
                }
            })
        }
    }),
    e.ui.plugin.add('resizable', 'containment', {
        start: function() {
            var i,
                s,
                n,
                a,
                o,
                r,
                h,
                l = e(this).data('ui-resizable'),
                u = l.options,
                c = l.element,
                d = u.containment,
                p = d instanceof e ? d.get(0) : /parent/.test(d) ? c.parent().get(0) : d;
            p && (l.containerElement = e(p), /document/.test(d) || d === document ? (l.containerOffset = {
                left: 0,
                top: 0
            }, l.containerPosition = {
                left: 0,
                top: 0
            }, l.parentData = {
                element: e(document),
                left: 0,
                top: 0,
                width: e(document).width(),
                height: e(document).height() || document.body.parentNode.scrollHeight
            }) : (i = e(p), s = [], e(['Top',
                'Right',
                'Left',
                'Bottom'
            ]).each(function(e, n) {
                s[e] = t(i.css('padding' + n))
            }), l.containerOffset = i.offset(), l.containerPosition = i.position(), l.containerSize = {
                height: i.innerHeight() - s[3],
                width: i.innerWidth() - s[1]
            }, n = l.containerOffset, a = l.containerSize.height, o = l.containerSize.width, r = e.ui.hasScroll(p, 'left') ? p.scrollWidth : o, h = e.ui.hasScroll(p) ? p.scrollHeight : a, l.parentData = {
                element: p,
                left: n.left,
                top: n.top,
                width: r,
                height: h
            }))
        },
        resize: function(t) {
            var i,
                s,
                n,
                a,
                o = e(this).data('ui-resizable'),
                r = o.options,
                h = o.containerOffset,
                l = o.position,
                u = o._aspectRatio || t.shiftKey,
                c = {
                    top: 0,
                    left: 0
                },
                d = o.containerElement;
            d[0] !== document && /static/.test(d.css('position')) && (c = h),
            l.left < (o._helper ? h.left : 0) && (o.size.width = o.size.width + (o._helper ? o.position.left - h.left : o.position.left - c.left), u && (o.size.height = o.size.width / o.aspectRatio), o.position.left = r.helper ? h.left : 0),
            l.top < (o._helper ? h.top : 0) && (o.size.height = o.size.height + (o._helper ? o.position.top - h.top : o.position.top), u && (o.size.width = o.size.height * o.aspectRatio), o.position.top = o._helper ? h.top : 0),
            o.offset.left = o.parentData.left + o.position.left,
            o.offset.top = o.parentData.top + o.position.top,
            i = Math.abs((o._helper ? o.offset.left - c.left : o.offset.left - c.left) + o.sizeDiff.width),
            s = Math.abs((o._helper ? o.offset.top - c.top : o.offset.top - h.top) + o.sizeDiff.height),
            n = o.containerElement.get(0) === o.element.parent().get(0),
            a = /relative|absolute/.test(o.containerElement.css('position')),
            n && a && (i -= o.parentData.left),
            i + o.size.width >= o.parentData.width && (o.size.width = o.parentData.width - i, u && (o.size.height = o.size.width / o.aspectRatio)),
            s + o.size.height >= o.parentData.height && (o.size.height = o.parentData.height - s, u && (o.size.width = o.size.height * o.aspectRatio))
        },
        stop: function() {
            var t = e(this).data('ui-resizable'),
                i = t.options,
                s = t.containerOffset,
                n = t.containerPosition,
                a = t.containerElement,
                o = e(t.helper),
                r = o.offset(),
                h = o.outerWidth() - t.sizeDiff.width,
                l = o.outerHeight() - t.sizeDiff.height;
            t._helper && !i.animate && /relative/.test(a.css('position')) && e(this).css({
                left: r.left - n.left - s.left,
                width: h,
                height: l
            }),
            t._helper && !i.animate && /static/.test(a.css('position')) && e(this).css({
                left: r.left - n.left - s.left,
                width: h,
                height: l
            })
        }
    }),
    e.ui.plugin.add('resizable', 'alsoResize', {
        start: function() {
            var t = e(this).data('ui-resizable'),
                i = t.options,
                s = function(t) {
                    e(t).each(function() {
                        var t = e(this);
                        t.data('ui-resizable-alsoresize', {
                            width: parseInt(t.width(), 10),
                            height: parseInt(t.height(), 10),
                            left: parseInt(t.css('left'), 10),
                            top: parseInt(t.css('top'), 10)
                        })
                    })
                };
            'object' != typeof i.alsoResize || i.alsoResize.parentNode ? s(i.alsoResize) : i.alsoResize.length ? (i.alsoResize = i.alsoResize[0], s(i.alsoResize)) : e.each(i.alsoResize, function(e) {
                s(e)
            })
        },
        resize: function(t, i) {
            var s = e(this).data('ui-resizable'),
                n = s.options,
                a = s.originalSize,
                o = s.originalPosition,
                r = {
                    height: s.size.height - a.height || 0,
                    width: s.size.width - a.width || 0,
                    top: s.position.top - o.top || 0,
                    left: s.position.left - o.left || 0
                },
                h = function(t, s) {
                    e(t).each(function() {
                        var t = e(this),
                            n = e(this).data('ui-resizable-alsoresize'),
                            a = {},
                            o = s && s.length ? s : t.parents(i.originalElement[0]).length ? [
                                'width',
                                'height'
                            ] : [
                                'width',
                                'height',
                                'top',
                                'left'
                            ];
                        e.each(o, function(e, t) {
                            var i = (n[t] || 0) + (r[t] || 0);
                            i && i >= 0 && (a[t] = i || null)
                        }),
                        t.css(a)
                    })
                };
            'object' != typeof n.alsoResize || n.alsoResize.nodeType ? h(n.alsoResize) : e.each(n.alsoResize, function(e, t) {
                h(e, t)
            })
        },
        stop: function() {
            e(this).removeData('resizable-alsoresize')
        }
    }),
    e.ui.plugin.add('resizable', 'ghost', {
        start: function() {
            var t = e(this).data('ui-resizable'),
                i = t.options,
                s = t.size;
            t.ghost = t.originalElement.clone(),
            t.ghost.css({
                opacity: 0.25,
                display: 'block',
                position: 'relative',
                height: s.height,
                width: s.width,
                margin: 0,
                left: 0,
                top: 0
            }).addClass('ui-resizable-ghost').addClass('string' == typeof i.ghost ? i.ghost : ''),
            t.ghost.appendTo(t.helper)
        },
        resize: function() {
            var t = e(this).data('ui-resizable');
            t.ghost && t.ghost.css({
                position: 'relative',
                height: t.size.height,
                width: t.size.width
            })
        },
        stop: function() {
            var t = e(this).data('ui-resizable');
            t.ghost && t.helper && t.helper.get(0).removeChild(t.ghost.get(0))
        }
    }),
    e.ui.plugin.add('resizable', 'grid', {
        resize: function() {
            var t = e(this).data('ui-resizable'),
                i = t.options,
                s = t.size,
                n = t.originalSize,
                a = t.originalPosition,
                o = t.axis,
                r = 'number' == typeof i.grid ? [
                    i.grid,
                    i.grid
                ] : i.grid,
                h = r[0] || 1,
                l = r[1] || 1,
                u = Math.round((s.width - n.width) / h) * h,
                c = Math.round((s.height - n.height) / l) * l,
                d = n.width + u,
                p = n.height + c,
                f = i.maxWidth && d > i.maxWidth,
                m = i.maxHeight && p > i.maxHeight,
                g = i.minWidth && i.minWidth > d,
                v = i.minHeight && i.minHeight > p;
            i.grid = r,
            g && (d += h),
            v && (p += l),
            f && (d -= h),
            m && (p -= l),
                /^(se|s|e)$/.test(o) ? (t.size.width = d, t.size.height = p) : /^(ne)$/.test(o) ? (t.size.width = d, t.size.height = p, t.position.top = a.top - c) : /^(sw)$/.test(o) ? (t.size.width = d, t.size.height = p, t.position.left = a.left - u) : (t.size.width = d, t.size.height = p, t.position.top = a.top - c, t.position.left = a.left - u)
        }
    })
})(jQuery);
(function(e) {
    e.widget('ui.selectable', e.ui.mouse, {
        version: '1.10.2',
        options: {
            appendTo: 'body',
            autoRefresh: !0,
            distance: 0,
            filter: '*',
            tolerance: 'touch',
            selected: null,
            selecting: null,
            start: null,
            stop: null,
            unselected: null,
            unselecting: null
        },
        _create: function() {
            var t,
                i = this;
            this.element.addClass('ui-selectable'),
            this.dragged = !1,
            this.refresh = function() {
                t = e(i.options.filter, i.element[0]),
                t.addClass('ui-selectee'),
                t.each(function() {
                    var t = e(this),
                        i = t.offset();
                    e.data(this, 'selectable-item', {
                        element: this,
                        $element: t,
                        left: i.left,
                        top: i.top,
                        right: i.left + t.outerWidth(),
                        bottom: i.top + t.outerHeight(),
                        startselected: !1,
                        selected: t.hasClass('ui-selected'),
                        selecting: t.hasClass('ui-selecting'),
                        unselecting: t.hasClass('ui-unselecting')
                    })
                })
            },
            this.refresh(),
            this.selectees = t.addClass('ui-selectee'),
            this._mouseInit(),
            this.helper = e('<div class=\'ui-selectable-helper\'></div>')
        },
        _destroy: function() {
            this.selectees.removeClass('ui-selectee').removeData('selectable-item'),
            this.element.removeClass('ui-selectable ui-selectable-disabled'),
            this._mouseDestroy()
        },
        _mouseStart: function(t) {
            var i = this,
                s = this.options;
            this.opos = [
                t.pageX,
                t.pageY
            ],
            this.options.disabled || (this.selectees = e(s.filter, this.element[0]), this._trigger('start', t), e(s.appendTo).append(this.helper), this.helper.css({
                left: t.pageX,
                top: t.pageY,
                width: 0,
                height: 0
            }), s.autoRefresh && this.refresh(), this.selectees.filter('.ui-selected').each(function() {
                var s = e.data(this, 'selectable-item');
                s.startselected = !0,
                t.metaKey || t.ctrlKey || (s.$element.removeClass('ui-selected'), s.selected = !1, s.$element.addClass('ui-unselecting'), s.unselecting = !0, i._trigger('unselecting', t, {
                    unselecting: s.element
                }))
            }), e(t.target).parents().addBack().each(function() {
                var s,
                    n = e.data(this, 'selectable-item');
                return n ? (s = !t.metaKey && !t.ctrlKey || !n.$element.hasClass('ui-selected'), n.$element.removeClass(s ? 'ui-unselecting' : 'ui-selected').addClass(s ? 'ui-selecting' : 'ui-unselecting'), n.unselecting = !s, n.selecting = s, n.selected = s, s ? i._trigger('selecting', t, {
                    selecting: n.element
                }) : i._trigger('unselecting', t, {
                    unselecting: n.element
                }), !1) : undefined
            }))
        },
        _mouseDrag: function(t) {
            if (this.dragged = !0, !this.options.disabled) {
                var i,
                    s = this,
                    n = this.options,
                    a = this.opos[0],
                    o = this.opos[1],
                    r = t.pageX,
                    h = t.pageY;
                return a > r && (i = r, r = a, a = i),
                    o > h && (i = h, h = o, o = i),
                    this.helper.css({
                        left: a,
                        top: o,
                        width: r - a,
                        height: h - o
                    }),
                    this.selectees.each(function() {
                        var i = e.data(this, 'selectable-item'),
                            l = !1;
                        i && i.element !== s.element[0] && ('touch' === n.tolerance ? l = !(i.left > r || a > i.right || i.top > h || o > i.bottom) : 'fit' === n.tolerance && (l = i.left > a && r > i.right && i.top > o && h > i.bottom), l ? (i.selected && (i.$element.removeClass('ui-selected'), i.selected = !1), i.unselecting && (i.$element.removeClass('ui-unselecting'), i.unselecting = !1), i.selecting || (i.$element.addClass('ui-selecting'), i.selecting = !0, s._trigger('selecting', t, {
                            selecting: i.element
                        }))) : (i.selecting && ((t.metaKey || t.ctrlKey) && i.startselected ? (i.$element.removeClass('ui-selecting'), i.selecting = !1, i.$element.addClass('ui-selected'), i.selected = !0) : (i.$element.removeClass('ui-selecting'), i.selecting = !1, i.startselected && (i.$element.addClass('ui-unselecting'), i.unselecting = !0), s._trigger('unselecting', t, {
                            unselecting: i.element
                        }))), i.selected && (t.metaKey || t.ctrlKey || i.startselected || (i.$element.removeClass('ui-selected'), i.selected = !1, i.$element.addClass('ui-unselecting'), i.unselecting = !0, s._trigger('unselecting', t, {
                            unselecting: i.element
                        })))))
                    }), !1
            }
        },
        _mouseStop: function(t) {
            var i = this;
            return this.dragged = !1,
                e('.ui-unselecting', this.element[0]).each(function() {
                    var s = e.data(this, 'selectable-item');
                    s.$element.removeClass('ui-unselecting'),
                    s.unselecting = !1,
                    s.startselected = !1,
                    i._trigger('unselected', t, {
                        unselected: s.element
                    })
                }),
                e('.ui-selecting', this.element[0]).each(function() {
                    var s = e.data(this, 'selectable-item');
                    s.$element.removeClass('ui-selecting').addClass('ui-selected'),
                    s.selecting = !1,
                    s.selected = !0,
                    s.startselected = !0,
                    i._trigger('selected', t, {
                        selected: s.element
                    })
                }),
                this._trigger('stop', t),
                this.helper.remove(), !1
        }
    })
})(jQuery);
(function(t) {
    function e(t, e, i) {
        return t > e && e + i > t
    }

    function i(t) {
        return /left|right/.test(t.css('float')) || /inline|table-cell/.test(t.css('display'))
    }
    t.widget('ui.sortable', t.ui.mouse, {
        version: '1.10.2',
        widgetEventPrefix: 'sort',
        ready: !1,
        options: {
            appendTo: 'parent',
            axis: !1,
            connectWith: !1,
            containment: !1,
            cursor: 'auto',
            cursorAt: !1,
            dropOnEmpty: !0,
            forcePlaceholderSize: !1,
            forceHelperSize: !1,
            grid: !1,
            handle: !1,
            helper: 'original',
            items: '> *',
            opacity: !1,
            placeholder: !1,
            revert: !1,
            scroll: !0,
            scrollSensitivity: 20,
            scrollSpeed: 20,
            scope: 'default',
            tolerance: 'intersect',
            zIndex: 1000,
            activate: null,
            beforeStop: null,
            change: null,
            deactivate: null,
            out: null,
            over: null,
            receive: null,
            remove: null,
            sort: null,
            start: null,
            stop: null,
            update: null
        },
        _create: function() {
            var t = this.options;
            this.containerCache = {},
            this.element.addClass('ui-sortable'),
            this.refresh(),
            this.floating = this.items.length ? 'x' === t.axis || i(this.items[0].item) : !1,
            this.offset = this.element.offset(),
            this._mouseInit(),
            this.ready = !0
        },
        _destroy: function() {
            this.element.removeClass('ui-sortable ui-sortable-disabled'),
            this._mouseDestroy();
            for (var t = this.items.length - 1; t >= 0; t--) this.items[t].item.removeData(this.widgetName + '-item');
            return this
        },
        _setOption: function(e, i) {
            'disabled' === e ? (this.options[e] = i, this.widget().toggleClass('ui-sortable-disabled', !!i)) : t.Widget.prototype._setOption.apply(this, arguments)
        },
        _mouseCapture: function(e, i) {
            var s = null,
                n = !1,
                a = this;
            return this.reverting ? !1 : this.options.disabled || 'static' === this.options.type ? !1 : (this._refreshItems(e), t(e.target).parents().each(function() {
                return t.data(this, a.widgetName + '-item') === a ? (s = t(this), !1) : undefined
            }), t.data(e.target, a.widgetName + '-item') === a && (s = t(e.target)), s ? !this.options.handle || i || (t(this.options.handle, s).find('*').addBack().each(function() {
                this === e.target && (n = !0)
            }), n) ? (this.currentItem = s, this._removeCurrentsFromItems(), !0) : !1 : !1)
        },
        _mouseStart: function(e, i, s) {
            var n,
                a,
                o = this.options;
            if (this.currentContainer = this, this.refreshPositions(), this.helper = this._createHelper(e), this._cacheHelperProportions(), this._cacheMargins(), this.scrollParent = this.helper.scrollParent(), this.offset = this.currentItem.offset(), this.offset = {
                top: this.offset.top - this.margins.top,
                left: this.offset.left - this.margins.left
            }, t.extend(this.offset, {
                click: {
                    left: e.pageX - this.offset.left,
                    top: e.pageY - this.offset.top
                },
                parent: this._getParentOffset(),
                relative: this._getRelativeOffset()
            }), this.helper.css('position', 'absolute'), this.cssPosition = this.helper.css('position'), this.originalPosition = this._generatePosition(e), this.originalPageX = e.pageX, this.originalPageY = e.pageY, o.cursorAt && this._adjustOffsetFromHelper(o.cursorAt), this.domPosition = {
                prev: this.currentItem.prev()[0],
                parent: this.currentItem.parent()[0]
            }, this.helper[0] !== this.currentItem[0] && this.currentItem.hide(), this._createPlaceholder(), o.containment && this._setContainment(), o.cursor && 'auto' !== o.cursor && (a = this.document.find('body'), this.storedCursor = a.css('cursor'), a.css('cursor', o.cursor), this.storedStylesheet = t('<style>*{ cursor: ' + o.cursor + ' !important; }</style>').appendTo(a)), o.opacity && (this.helper.css('opacity') && (this._storedOpacity = this.helper.css('opacity')), this.helper.css('opacity', o.opacity)), o.zIndex && (this.helper.css('zIndex') && (this._storedZIndex = this.helper.css('zIndex')), this.helper.css('zIndex', o.zIndex)), this.scrollParent[0] !== document && 'HTML' !== this.scrollParent[0].tagName && (this.overflowOffset = this.scrollParent.offset()), this._trigger('start', e, this._uiHash()), this._preserveHelperProportions || this._cacheHelperProportions(), !s)
                for (n = this.containers.length - 1; n >= 0; n--) this.containers[n]._trigger('activate', e, this._uiHash(this));
            return t.ui.ddmanager && (t.ui.ddmanager.current = this),
                t.ui.ddmanager && !o.dropBehaviour && t.ui.ddmanager.prepareOffsets(this, e),
                this.dragging = !0,
                this.helper.addClass('ui-sortable-helper'),
                this._mouseDrag(e), !0
        },
        _mouseDrag: function(e) {
            var i,
                s,
                n,
                a,
                o = this.options,
                r = !1;
            for (this.position = this._generatePosition(e), this.positionAbs = this._convertPositionTo('absolute'), this.lastPositionAbs || (this.lastPositionAbs = this.positionAbs), this.options.scroll && (this.scrollParent[0] !== document && 'HTML' !== this.scrollParent[0].tagName ? (this.overflowOffset.top + this.scrollParent[0].offsetHeight - e.pageY < o.scrollSensitivity ? this.scrollParent[0].scrollTop = r = this.scrollParent[0].scrollTop + o.scrollSpeed : e.pageY - this.overflowOffset.top < o.scrollSensitivity && (this.scrollParent[0].scrollTop = r = this.scrollParent[0].scrollTop - o.scrollSpeed), this.overflowOffset.left + this.scrollParent[0].offsetWidth - e.pageX < o.scrollSensitivity ? this.scrollParent[0].scrollLeft = r = this.scrollParent[0].scrollLeft + o.scrollSpeed : e.pageX - this.overflowOffset.left < o.scrollSensitivity && (this.scrollParent[0].scrollLeft = r = this.scrollParent[0].scrollLeft - o.scrollSpeed)) : (e.pageY - t(document).scrollTop() < o.scrollSensitivity ? r = t(document).scrollTop(t(document).scrollTop() - o.scrollSpeed) : t(window).height() - (e.pageY - t(document).scrollTop()) < o.scrollSensitivity && (r = t(document).scrollTop(t(document).scrollTop() + o.scrollSpeed)), e.pageX - t(document).scrollLeft() < o.scrollSensitivity ? r = t(document).scrollLeft(t(document).scrollLeft() - o.scrollSpeed) : t(window).width() - (e.pageX - t(document).scrollLeft()) < o.scrollSensitivity && (r = t(document).scrollLeft(t(document).scrollLeft() + o.scrollSpeed))), r !== !1 && t.ui.ddmanager && !o.dropBehaviour && t.ui.ddmanager.prepareOffsets(this, e)), this.positionAbs = this._convertPositionTo('absolute'), this.options.axis && 'y' === this.options.axis || (this.helper[0].style.left = this.position.left + 'px'), this.options.axis && 'x' === this.options.axis || (this.helper[0].style.top = this.position.top + 'px'), i = this.items.length - 1; i >= 0; i--)
                if (s = this.items[i], n = s.item[0], a = this._intersectsWithPointer(s), a && s.instance === this.currentContainer && n !== this.currentItem[0] && this.placeholder[1 === a ? 'next' : 'prev']()[0] !== n && !t.contains(this.placeholder[0], n) && ('semi-dynamic' === this.options.type ? !t.contains(this.element[0], n) : !0)) {
                    if (this.direction = 1 === a ? 'down' : 'up', 'pointer' !== this.options.tolerance && !this._intersectsWithSides(s)) break;
                    this._rearrange(e, s),
                    this._trigger('change', e, this._uiHash());
                    break
                }
            return this._contactContainers(e),
                t.ui.ddmanager && t.ui.ddmanager.drag(this, e),
                this._trigger('sort', e, this._uiHash()),
                this.lastPositionAbs = this.positionAbs, !1
        },
        _mouseStop: function(e, i) {
            if (e) {
                if (t.ui.ddmanager && !this.options.dropBehaviour && t.ui.ddmanager.drop(this, e), this.options.revert) {
                    var s = this,
                        n = this.placeholder.offset(),
                        a = this.options.axis,
                        o = {};
                    a && 'x' !== a || (o.left = n.left - this.offset.parent.left - this.margins.left + (this.offsetParent[0] === document.body ? 0 : this.offsetParent[0].scrollLeft)),
                    a && 'y' !== a || (o.top = n.top - this.offset.parent.top - this.margins.top + (this.offsetParent[0] === document.body ? 0 : this.offsetParent[0].scrollTop)),
                    this.reverting = !0,
                    t(this.helper).animate(o, parseInt(this.options.revert, 10) || 500, function() {
                        s._clear(e)
                    })
                } else this._clear(e, i);
                return !1
            }
        },
        cancel: function() {
            if (this.dragging) {
                this._mouseUp({
                    target: null
                }),
                    'original' === this.options.helper ? this.currentItem.css(this._storedCSS).removeClass('ui-sortable-helper') : this.currentItem.show();
                for (var e = this.containers.length - 1; e >= 0; e--) this.containers[e]._trigger('deactivate', null, this._uiHash(this)),
                    this.containers[e].containerCache.over && (this.containers[e]._trigger('out', null, this._uiHash(this)), this.containers[e].containerCache.over = 0)
            }
            return this.placeholder && (this.placeholder[0].parentNode && this.placeholder[0].parentNode.removeChild(this.placeholder[0]), 'original' !== this.options.helper && this.helper && this.helper[0].parentNode && this.helper.remove(), t.extend(this, {
                    helper: null,
                    dragging: !1,
                    reverting: !1,
                    _noFinalSort: null
                }), this.domPosition.prev ? t(this.domPosition.prev).after(this.currentItem) : t(this.domPosition.parent).prepend(this.currentItem)),
                this
        },
        serialize: function(e) {
            var i = this._getItemsAsjQuery(e && e.connected),
                s = [];
            return e = e || {},
                t(i).each(function() {
                    var i = (t(e.item || this).attr(e.attribute || 'id') || '').match(e.expression || /(.+)[\-=_](.+)/);
                    i && s.push((e.key || i[1] + '[]') + '=' + (e.key && e.expression ? i[1] : i[2]))
                }), !s.length && e.key && s.push(e.key + '='),
                s.join('&')
        },
        toArray: function(e) {
            var i = this._getItemsAsjQuery(e && e.connected),
                s = [];
            return e = e || {},
                i.each(function() {
                    s.push(t(e.item || this).attr(e.attribute || 'id') || '')
                }),
                s
        },
        _intersectsWith: function(t) {
            var e = this.positionAbs.left,
                i = e + this.helperProportions.width,
                s = this.positionAbs.top,
                n = s + this.helperProportions.height,
                a = t.left,
                o = a + t.width,
                r = t.top,
                h = r + t.height,
                l = this.offset.click.top,
                c = this.offset.click.left,
                u = s + l > r && h > s + l && e + c > a && o > e + c;
            return 'pointer' === this.options.tolerance || this.options.forcePointerForContainers || 'pointer' !== this.options.tolerance && this.helperProportions[this.floating ? 'width' : 'height'] > t[this.floating ? 'width' : 'height'] ? u : e + this.helperProportions.width / 2 > a && o > i - this.helperProportions.width / 2 && s + this.helperProportions.height / 2 > r && h > n - this.helperProportions.height / 2
        },
        _intersectsWithPointer: function(t) {
            var i = 'x' === this.options.axis || e(this.positionAbs.top + this.offset.click.top, t.top, t.height),
                s = 'y' === this.options.axis || e(this.positionAbs.left + this.offset.click.left, t.left, t.width),
                n = i && s,
                a = this._getDragVerticalDirection(),
                o = this._getDragHorizontalDirection();
            return n ? this.floating ? o && 'right' === o || 'down' === a ? 2 : 1 : a && ('down' === a ? 2 : 1) : !1
        },
        _intersectsWithSides: function(t) {
            var i = e(this.positionAbs.top + this.offset.click.top, t.top + t.height / 2, t.height),
                s = e(this.positionAbs.left + this.offset.click.left, t.left + t.width / 2, t.width),
                n = this._getDragVerticalDirection(),
                a = this._getDragHorizontalDirection();
            return this.floating && a ? 'right' === a && s || 'left' === a && !s : n && ('down' === n && i || 'up' === n && !i)
        },
        _getDragVerticalDirection: function() {
            var t = this.positionAbs.top - this.lastPositionAbs.top;
            return 0 !== t && (t > 0 ? 'down' : 'up')
        },
        _getDragHorizontalDirection: function() {
            var t = this.positionAbs.left - this.lastPositionAbs.left;
            return 0 !== t && (t > 0 ? 'right' : 'left')
        },
        refresh: function(t) {
            return this._refreshItems(t),
                this.refreshPositions(),
                this
        },
        _connectWith: function() {
            var t = this.options;
            return t.connectWith.constructor === String ? [
                t.connectWith
            ] : t.connectWith
        },
        _getItemsAsjQuery: function(e) {
            var i,
                s,
                n,
                a,
                o = [],
                r = [],
                h = this._connectWith();
            if (h && e)
                for (i = h.length - 1; i >= 0; i--)
                    for (n = t(h[i]), s = n.length - 1; s >= 0; s--) a = t.data(n[s], this.widgetFullName),
                        a && a !== this && !a.options.disabled && r.push([t.isFunction(a.options.items) ? a.options.items.call(a.element) : t(a.options.items, a.element).not('.ui-sortable-helper').not('.ui-sortable-placeholder'),
                            a
                        ]);
            for (r.push([t.isFunction(this.options.items) ? this.options.items.call(this.element, null, {
                    options: this.options,
                    item: this.currentItem
                }) : t(this.options.items, this.element).not('.ui-sortable-helper').not('.ui-sortable-placeholder'),
                this
            ]), i = r.length - 1; i >= 0; i--) r[i][0].each(function() {
                o.push(this)
            });
            return t(o)
        },
        _removeCurrentsFromItems: function() {
            var e = this.currentItem.find(':data(' + this.widgetName + '-item)');
            this.items = t.grep(this.items, function(t) {
                for (var i = 0; e.length > i; i++)
                    if (e[i] === t.item[0]) return !1;
                return !0
            })
        },
        _refreshItems: function(e) {
            this.items = [],
            this.containers = [
                this
            ];
            var i,
                s,
                n,
                a,
                o,
                r,
                h,
                l,
                c = this.items,
                u = [
                    [t.isFunction(this.options.items) ? this.options.items.call(this.element[0], e, {
                            item: this.currentItem
                        }) : t(this.options.items, this.element),
                        this
                    ]
                ],
                d = this._connectWith();
            if (d && this.ready)
                for (i = d.length - 1; i >= 0; i--)
                    for (n = t(d[i]), s = n.length - 1; s >= 0; s--) a = t.data(n[s], this.widgetFullName),
                        a && a !== this && !a.options.disabled && (u.push([t.isFunction(a.options.items) ? a.options.items.call(a.element[0], e, {
                                item: this.currentItem
                            }) : t(a.options.items, a.element),
                            a
                        ]), this.containers.push(a));
            for (i = u.length - 1; i >= 0; i--)
                for (o = u[i][1], r = u[i][0], s = 0, l = r.length; l > s; s++) h = t(r[s]),
                    h.data(this.widgetName + '-item', o),
                    c.push({
                        item: h,
                        instance: o,
                        width: 0,
                        height: 0,
                        left: 0,
                        top: 0
                    })
        },
        refreshPositions: function(e) {
            this.offsetParent && this.helper && (this.offset.parent = this._getParentOffset());
            var i,
                s,
                n,
                a;
            for (i = this.items.length - 1; i >= 0; i--) s = this.items[i],
                s.instance !== this.currentContainer && this.currentContainer && s.item[0] !== this.currentItem[0] || (n = this.options.toleranceElement ? t(this.options.toleranceElement, s.item) : s.item, e || (s.width = n.outerWidth(), s.height = n.outerHeight()), a = n.offset(), s.left = a.left, s.top = a.top);
            if (this.options.custom && this.options.custom.refreshContainers) this.options.custom.refreshContainers.call(this);
            else
                for (i = this.containers.length - 1; i >= 0; i--) a = this.containers[i].element.offset(),
                    this.containers[i].containerCache.left = a.left,
                    this.containers[i].containerCache.top = a.top,
                    this.containers[i].containerCache.width = this.containers[i].element.outerWidth(),
                    this.containers[i].containerCache.height = this.containers[i].element.outerHeight();
            return this
        },
        _createPlaceholder: function(e) {
            e = e || this;
            var i,
                s = e.options;
            s.placeholder && s.placeholder.constructor !== String || (i = s.placeholder, s.placeholder = {
                element: function() {
                    var s = e.currentItem[0].nodeName.toLowerCase(),
                        n = t(e.document[0].createElement(s)).addClass(i || e.currentItem[0].className + ' ui-sortable-placeholder').removeClass('ui-sortable-helper');
                    return 'tr' === s ? n.append('<td colspan=\'99\'>&#160;</td>') : 'img' === s && n.attr('src', e.currentItem.attr('src')),
                        i || n.css('visibility', 'hidden'),
                        n
                },
                update: function(t, n) {
                    (!i || s.forcePlaceholderSize) && (n.height() || n.height(e.currentItem.innerHeight() - parseInt(e.currentItem.css('paddingTop') || 0, 10) - parseInt(e.currentItem.css('paddingBottom') || 0, 10)), n.width() || n.width(e.currentItem.innerWidth() - parseInt(e.currentItem.css('paddingLeft') || 0, 10) - parseInt(e.currentItem.css('paddingRight') || 0, 10)))
                }
            }),
            e.placeholder = t(s.placeholder.element.call(e.element, e.currentItem)),
            e.currentItem.after(e.placeholder),
            s.placeholder.update(e, e.placeholder)
        },
        _contactContainers: function(s) {
            var n,
                a,
                o,
                r,
                h,
                l,
                c,
                u,
                d,
                p,
                f = null,
                m = null;
            for (n = this.containers.length - 1; n >= 0; n--)
                if (!t.contains(this.currentItem[0], this.containers[n].element[0]))
                    if (this._intersectsWith(this.containers[n].containerCache)) {
                        if (f && t.contains(this.containers[n].element[0], f.element[0])) continue;
                        f = this.containers[n],
                        m = n
                    } else this.containers[n].containerCache.over && (this.containers[n]._trigger('out', s, this._uiHash(this)), this.containers[n].containerCache.over = 0);
            if (f)
                if (1 === this.containers.length) this.containers[m].containerCache.over || (this.containers[m]._trigger('over', s, this._uiHash(this)), this.containers[m].containerCache.over = 1);
                else {
                    for (o = 10000, r = null, p = f.floating || i(this.currentItem), h = p ? 'left' : 'top', l = p ? 'width' : 'height', c = this.positionAbs[h] + this.offset.click[h], a = this.items.length - 1; a >= 0; a--) t.contains(this.containers[m].element[0], this.items[a].item[0]) && this.items[a].item[0] !== this.currentItem[0] && (!p || e(this.positionAbs.top + this.offset.click.top, this.items[a].top, this.items[a].height)) && (u = this.items[a].item.offset()[h], d = !1, Math.abs(u - c) > Math.abs(u + this.items[a][l] - c) && (d = !0, u += this.items[a][l]), o > Math.abs(u - c) && (o = Math.abs(u - c), r = this.items[a], this.direction = d ? 'up' : 'down'));
                    if (!r && !this.options.dropOnEmpty) return;
                    if (this.currentContainer === this.containers[m]) return;
                    r ? this._rearrange(s, r, null, !0) : this._rearrange(s, null, this.containers[m].element, !0),
                    this._trigger('change', s, this._uiHash()),
                    this.containers[m]._trigger('change', s, this._uiHash(this)),
                    this.currentContainer = this.containers[m],
                    this.options.placeholder.update(this.currentContainer, this.placeholder),
                    this.containers[m]._trigger('over', s, this._uiHash(this)),
                    this.containers[m].containerCache.over = 1
                }
        },
        _createHelper: function(e) {
            var i = this.options,
                s = t.isFunction(i.helper) ? t(i.helper.apply(this.element[0], [
                    e,
                    this.currentItem
                ])) : 'clone' === i.helper ? this.currentItem.clone() : this.currentItem;
            return s.parents('body').length || t('parent' !== i.appendTo ? i.appendTo : this.currentItem[0].parentNode)[0].appendChild(s[0]),
                s[0] === this.currentItem[0] && (this._storedCSS = {
                    width: this.currentItem[0].style.width,
                    height: this.currentItem[0].style.height,
                    position: this.currentItem.css('position'),
                    top: this.currentItem.css('top'),
                    left: this.currentItem.css('left')
                }), (!s[0].style.width || i.forceHelperSize) && s.width(this.currentItem.width()), (!s[0].style.height || i.forceHelperSize) && s.height(this.currentItem.height()),
                s
        },
        _adjustOffsetFromHelper: function(e) {
            'string' == typeof e && (e = e.split(' ')),
            t.isArray(e) && (e = {
                left: +e[0],
                top: +e[1] || 0
            }),
                'left' in e && (this.offset.click.left = e.left + this.margins.left),
                'right' in e && (this.offset.click.left = this.helperProportions.width - e.right + this.margins.left),
                'top' in e && (this.offset.click.top = e.top + this.margins.top),
                'bottom' in e && (this.offset.click.top = this.helperProportions.height - e.bottom + this.margins.top)
        },
        _getParentOffset: function() {
            this.offsetParent = this.helper.offsetParent();
            var e = this.offsetParent.offset();
            return 'absolute' === this.cssPosition && this.scrollParent[0] !== document && t.contains(this.scrollParent[0], this.offsetParent[0]) && (e.left += this.scrollParent.scrollLeft(), e.top += this.scrollParent.scrollTop()), (this.offsetParent[0] === document.body || this.offsetParent[0].tagName && 'html' === this.offsetParent[0].tagName.toLowerCase() && t.ui.ie) && (e = {
                top: 0,
                left: 0
            }), {
                top: e.top + (parseInt(this.offsetParent.css('borderTopWidth'), 10) || 0),
                left: e.left + (parseInt(this.offsetParent.css('borderLeftWidth'), 10) || 0)
            }
        },
        _getRelativeOffset: function() {
            if ('relative' === this.cssPosition) {
                var t = this.currentItem.position();
                return {
                    top: t.top - (parseInt(this.helper.css('top'), 10) || 0) + this.scrollParent.scrollTop(),
                    left: t.left - (parseInt(this.helper.css('left'), 10) || 0) + this.scrollParent.scrollLeft()
                }
            }
            return {
                top: 0,
                left: 0
            }
        },
        _cacheMargins: function() {
            this.margins = {
                left: parseInt(this.currentItem.css('marginLeft'), 10) || 0,
                top: parseInt(this.currentItem.css('marginTop'), 10) || 0
            }
        },
        _cacheHelperProportions: function() {
            this.helperProportions = {
                width: this.helper.outerWidth(),
                height: this.helper.outerHeight()
            }
        },
        _setContainment: function() {
            var e,
                i,
                s,
                n = this.options;
            'parent' === n.containment && (n.containment = this.helper[0].parentNode), ('document' === n.containment || 'window' === n.containment) && (this.containment = [
                0 - this.offset.relative.left - this.offset.parent.left,
                0 - this.offset.relative.top - this.offset.parent.top,
                t('document' === n.containment ? document : window).width() - this.helperProportions.width - this.margins.left, (t('document' === n.containment ? document : window).height() || document.body.parentNode.scrollHeight) - this.helperProportions.height - this.margins.top
            ]),
                /^(document|window|parent)$/.test(n.containment) || (e = t(n.containment)[0], i = t(n.containment).offset(), s = 'hidden' !== t(e).css('overflow'), this.containment = [
                    i.left + (parseInt(t(e).css('borderLeftWidth'), 10) || 0) + (parseInt(t(e).css('paddingLeft'), 10) || 0) - this.margins.left,
                    i.top + (parseInt(t(e).css('borderTopWidth'), 10) || 0) + (parseInt(t(e).css('paddingTop'), 10) || 0) - this.margins.top,
                    i.left + (s ? Math.max(e.scrollWidth, e.offsetWidth) : e.offsetWidth) - (parseInt(t(e).css('borderLeftWidth'), 10) || 0) - (parseInt(t(e).css('paddingRight'), 10) || 0) - this.helperProportions.width - this.margins.left,
                    i.top + (s ? Math.max(e.scrollHeight, e.offsetHeight) : e.offsetHeight) - (parseInt(t(e).css('borderTopWidth'), 10) || 0) - (parseInt(t(e).css('paddingBottom'), 10) || 0) - this.helperProportions.height - this.margins.top
                ])
        },
        _convertPositionTo: function(e, i) {
            i || (i = this.position);
            var s = 'absolute' === e ? 1 : -1,
                n = 'absolute' !== this.cssPosition || this.scrollParent[0] !== document && t.contains(this.scrollParent[0], this.offsetParent[0]) ? this.scrollParent : this.offsetParent,
                a = /(html|body)/i.test(n[0].tagName);
            return {
                top: i.top + this.offset.relative.top * s + this.offset.parent.top * s - ('fixed' === this.cssPosition ? -this.scrollParent.scrollTop() : a ? 0 : n.scrollTop()) * s,
                left: i.left + this.offset.relative.left * s + this.offset.parent.left * s - ('fixed' === this.cssPosition ? -this.scrollParent.scrollLeft() : a ? 0 : n.scrollLeft()) * s
            }
        },
        _generatePosition: function(e) {
            var i,
                s,
                n = this.options,
                a = e.pageX,
                o = e.pageY,
                r = 'absolute' !== this.cssPosition || this.scrollParent[0] !== document && t.contains(this.scrollParent[0], this.offsetParent[0]) ? this.scrollParent : this.offsetParent,
                h = /(html|body)/i.test(r[0].tagName);
            return 'relative' !== this.cssPosition || this.scrollParent[0] !== document && this.scrollParent[0] !== this.offsetParent[0] || (this.offset.relative = this._getRelativeOffset()),
                this.originalPosition && (this.containment && (e.pageX - this.offset.click.left < this.containment[0] && (a = this.containment[0] + this.offset.click.left), e.pageY - this.offset.click.top < this.containment[1] && (o = this.containment[1] + this.offset.click.top), e.pageX - this.offset.click.left > this.containment[2] && (a = this.containment[2] + this.offset.click.left), e.pageY - this.offset.click.top > this.containment[3] && (o = this.containment[3] + this.offset.click.top)), n.grid && (i = this.originalPageY + Math.round((o - this.originalPageY) / n.grid[1]) * n.grid[1], o = this.containment ? i - this.offset.click.top >= this.containment[1] && i - this.offset.click.top <= this.containment[3] ? i : i - this.offset.click.top >= this.containment[1] ? i - n.grid[1] : i + n.grid[1] : i, s = this.originalPageX + Math.round((a - this.originalPageX) / n.grid[0]) * n.grid[0], a = this.containment ? s - this.offset.click.left >= this.containment[0] && s - this.offset.click.left <= this.containment[2] ? s : s - this.offset.click.left >= this.containment[0] ? s - n.grid[0] : s + n.grid[0] : s)), {
                    top: o - this.offset.click.top - this.offset.relative.top - this.offset.parent.top + ('fixed' === this.cssPosition ? -this.scrollParent.scrollTop() : h ? 0 : r.scrollTop()),
                    left: a - this.offset.click.left - this.offset.relative.left - this.offset.parent.left + ('fixed' === this.cssPosition ? -this.scrollParent.scrollLeft() : h ? 0 : r.scrollLeft())
                }
        },
        _rearrange: function(t, e, i, s) {
            i ? i[0].appendChild(this.placeholder[0]) : e.item[0].parentNode.insertBefore(this.placeholder[0], 'down' === this.direction ? e.item[0] : e.item[0].nextSibling),
            this.counter = this.counter ? ++this.counter : 1;
            var n = this.counter;
            this._delay(function() {
                n === this.counter && this.refreshPositions(!s)
            })
        },
        _clear: function(t, e) {
            this.reverting = !1;
            var i,
                s = [];
            if (!this._noFinalSort && this.currentItem.parent().length && this.placeholder.before(this.currentItem), this._noFinalSort = null, this.helper[0] === this.currentItem[0]) {
                for (i in this._storedCSS)('auto' === this._storedCSS[i] || 'static' === this._storedCSS[i]) && (this._storedCSS[i] = '');
                this.currentItem.css(this._storedCSS).removeClass('ui-sortable-helper')
            } else this.currentItem.show();
            for (this.fromOutside && !e && s.push(function(t) {
                this._trigger('receive', t, this._uiHash(this.fromOutside))
            }), !this.fromOutside && this.domPosition.prev === this.currentItem.prev().not('.ui-sortable-helper')[0] && this.domPosition.parent === this.currentItem.parent()[0] || e || s.push(function(t) {
                this._trigger('update', t, this._uiHash())
            }), this !== this.currentContainer && (e || (s.push(function(t) {
                this._trigger('remove', t, this._uiHash())
            }), s.push(function(t) {
                return function(e) {
                    t._trigger('receive', e, this._uiHash(this))
                }
            }.call(this, this.currentContainer)), s.push(function(t) {
                return function(e) {
                    t._trigger('update', e, this._uiHash(this))
                }
            }.call(this, this.currentContainer)))), i = this.containers.length - 1; i >= 0; i--) e || s.push(function(t) {
                    return function(e) {
                        t._trigger('deactivate', e, this._uiHash(this))
                    }
                }.call(this, this.containers[i])),
                this.containers[i].containerCache.over && (s.push(function(t) {
                    return function(e) {
                        t._trigger('out', e, this._uiHash(this))
                    }
                }.call(this, this.containers[i])), this.containers[i].containerCache.over = 0);
            if (this.storedCursor && (this.document.find('body').css('cursor', this.storedCursor), this.storedStylesheet.remove()), this._storedOpacity && this.helper.css('opacity', this._storedOpacity), this._storedZIndex && this.helper.css('zIndex', 'auto' === this._storedZIndex ? '' : this._storedZIndex), this.dragging = !1, this.cancelHelperRemoval) {
                if (!e) {
                    for (this._trigger('beforeStop', t, this._uiHash()), i = 0; s.length > i; i++) s[i].call(this, t);
                    this._trigger('stop', t, this._uiHash())
                }
                return this.fromOutside = !1, !1
            }
            if (e || this._trigger('beforeStop', t, this._uiHash()), this.placeholder[0].parentNode.removeChild(this.placeholder[0]), this.helper[0] !== this.currentItem[0] && this.helper.remove(), this.helper = null, !e) {
                for (i = 0; s.length > i; i++) s[i].call(this, t);
                this._trigger('stop', t, this._uiHash())
            }
            return this.fromOutside = !1, !0
        },
        _trigger: function() {
            t.Widget.prototype._trigger.apply(this, arguments) === !1 && this.cancel()
        },
        _uiHash: function(e) {
            var i = e || this;
            return {
                helper: i.helper,
                placeholder: i.placeholder || t([]),
                position: i.position,
                originalPosition: i.originalPosition,
                offset: i.positionAbs,
                item: i.currentItem,
                sender: e ? e.element : null
            }
        }
    })
})(jQuery);
(function(e) {
    var t = 0;
    e.widget('ui.autocomplete', {
        version: '1.10.2',
        defaultElement: '<input>',
        options: {
            appendTo: null,
            autoFocus: !1,
            delay: 300,
            minLength: 1,
            position: {
                my: 'left top',
                at: 'left bottom',
                collision: 'none'
            },
            source: null,
            change: null,
            close: null,
            focus: null,
            open: null,
            response: null,
            search: null,
            select: null
        },
        pending: 0,
        _create: function() {
            var t,
                i,
                s,
                n = this.element[0].nodeName.toLowerCase(),
                a = 'textarea' === n,
                o = 'input' === n;
            this.isMultiLine = a ? !0 : o ? !1 : this.element.prop('isContentEditable'),
            this.valueMethod = this.element[a || o ? 'val' : 'text'],
            this.isNewMenu = !0,
            this.element.addClass('ui-autocomplete-input').attr('autocomplete', 'off'),
            this._on(this.element, {
                keydown: function(n) {
                    if (this.element.prop('readOnly')) return t = !0,
                        s = !0,
                        i = !0,
                        undefined;
                    t = !1,
                    s = !1,
                    i = !1;
                    var a = e.ui.keyCode;
                    switch (n.keyCode) {
                        case a.PAGE_UP:
                            t = !0,
                            this._move('previousPage', n);
                            break;
                        case a.PAGE_DOWN:
                            t = !0,
                            this._move('nextPage', n);
                            break;
                        case a.UP:
                            t = !0,
                            this._keyEvent('previous', n);
                            break;
                        case a.DOWN:
                            t = !0,
                            this._keyEvent('next', n);
                            break;
                        case a.ENTER:
                        case a.NUMPAD_ENTER:
                            this.menu.active && (t = !0, n.preventDefault(), this.menu.select(n));
                            break;
                        case a.TAB:
                            this.menu.active && this.menu.select(n);
                            break;
                        case a.ESCAPE:
                            this.menu.element.is(':visible') && (this._value(this.term), this.close(n), n.preventDefault());
                            break;
                        default:
                            i = !0,
                            this._searchTimeout(n)
                    }
                },
                keypress: function(s) {
                    if (t) return t = !1,
                        s.preventDefault(),
                        undefined;
                    if (!i) {
                        var n = e.ui.keyCode;
                        switch (s.keyCode) {
                            case n.PAGE_UP:
                                this._move('previousPage', s);
                                break;
                            case n.PAGE_DOWN:
                                this._move('nextPage', s);
                                break;
                            case n.UP:
                                this._keyEvent('previous', s);
                                break;
                            case n.DOWN:
                                this._keyEvent('next', s)
                        }
                    }
                },
                input: function(e) {
                    return s ? (s = !1, e.preventDefault(), undefined) : (this._searchTimeout(e), undefined)
                },
                focus: function() {
                    this.selectedItem = null,
                    this.previous = this._value()
                },
                blur: function(e) {
                    return this.cancelBlur ? (delete this.cancelBlur, undefined) : (clearTimeout(this.searching), this.close(e), this._change(e), undefined)
                }
            }),
            this._initSource(),
            this.menu = e('<ul>').addClass('ui-autocomplete ui-front').appendTo(this._appendTo()).menu({
                input: e(),
                role: null
            }).hide().data('ui-menu'),
            this._on(this.menu.element, {
                mousedown: function(t) {
                    t.preventDefault(),
                    this.cancelBlur = !0,
                    this._delay(function() {
                        delete this.cancelBlur
                    });
                    var i = this.menu.element[0];
                    e(t.target).closest('.ui-menu-item').length || this._delay(function() {
                        var t = this;
                        this.document.one('mousedown', function(s) {
                            s.target === t.element[0] || s.target === i || e.contains(i, s.target) || t.close()
                        })
                    })
                },
                menufocus: function(t, i) {
                    if (this.isNewMenu && (this.isNewMenu = !1, t.originalEvent && /^mouse/.test(t.originalEvent.type))) return this.menu.blur(),
                        this.document.one('mousemove', function() {
                            e(t.target).trigger(t.originalEvent)
                        }),
                        undefined;
                    var s = i.item.data('ui-autocomplete-item');
                    !1 !== this._trigger('focus', t, {
                        item: s
                    }) ? t.originalEvent && /^key/.test(t.originalEvent.type) && this._value(s.value) : this.liveRegion.text(s.value)
                },
                menuselect: function(e, t) {
                    var i = t.item.data('ui-autocomplete-item'),
                        s = this.previous;
                    this.element[0] !== this.document[0].activeElement && (this.element.focus(), this.previous = s, this._delay(function() {
                        this.previous = s,
                        this.selectedItem = i
                    })), !1 !== this._trigger('select', e, {
                        item: i
                    }) && this._value(i.value),
                    this.term = this._value(),
                    this.close(e),
                    this.selectedItem = i
                }
            }),
            this.liveRegion = e('<span>', {
                role: 'status',
                'aria-live': 'polite'
            }).addClass('ui-helper-hidden-accessible').insertAfter(this.element),
            this._on(this.window, {
                beforeunload: function() {
                    this.element.removeAttr('autocomplete')
                }
            })
        },
        _destroy: function() {
            clearTimeout(this.searching),
            this.element.removeClass('ui-autocomplete-input').removeAttr('autocomplete'),
            this.menu.element.remove(),
            this.liveRegion.remove()
        },
        _setOption: function(e, t) {
            this._super(e, t),
                'source' === e && this._initSource(),
                'appendTo' === e && this.menu.element.appendTo(this._appendTo()),
                'disabled' === e && t && this.xhr && this.xhr.abort()
        },
        _appendTo: function() {
            var t = this.options.appendTo;
            return t && (t = t.jquery || t.nodeType ? e(t) : this.document.find(t).eq(0)),
                t || (t = this.element.closest('.ui-front')),
                t.length || (t = this.document[0].body),
                t
        },
        _initSource: function() {
            var t,
                i,
                s = this;
            e.isArray(this.options.source) ? (t = this.options.source, this.source = function(i, s) {
                s(e.ui.autocomplete.filter(t, i.term))
            }) : 'string' == typeof this.options.source ? (i = this.options.source, this.source = function(t, n) {
                s.xhr && s.xhr.abort(),
                s.xhr = e.ajax({
                    url: i,
                    data: t,
                    dataType: 'json',
                    success: function(e) {
                        n(e)
                    },
                    error: function() {
                        n([])
                    }
                })
            }) : this.source = this.options.source
        },
        _searchTimeout: function(e) {
            clearTimeout(this.searching),
            this.searching = this._delay(function() {
                this.term !== this._value() && (this.selectedItem = null, this.search(null, e))
            }, this.options.delay)
        },
        search: function(e, t) {
            return e = null != e ? e : this._value(),
                this.term = this._value(),
                e.length < this.options.minLength ? this.close(t) : this._trigger('search', t) !== !1 ? this._search(e) : undefined
        },
        _search: function(e) {
            this.pending++,
            this.element.addClass('ui-autocomplete-loading'),
            this.cancelSearch = !1,
            this.source({
                term: e
            }, this._response())
        },
        _response: function() {
            var e = this,
                i = ++t;
            return function(s) {
                i === t && e.__response(s),
                e.pending--,
                e.pending || e.element.removeClass('ui-autocomplete-loading')
            }
        },
        __response: function(e) {
            e && (e = this._normalize(e)),
            this._trigger('response', null, {
                content: e
            }), !this.options.disabled && e && e.length && !this.cancelSearch ? (this._suggest(e), this._trigger('open')) : this._close()
        },
        close: function(e) {
            this.cancelSearch = !0,
            this._close(e)
        },
        _close: function(e) {
            this.menu.element.is(':visible') && (this.menu.element.hide(), this.menu.blur(), this.isNewMenu = !0, this._trigger('close', e))
        },
        _change: function(e) {
            this.previous !== this._value() && this._trigger('change', e, {
                item: this.selectedItem
            })
        },
        _normalize: function(t) {
            return t.length && t[0].label && t[0].value ? t : e.map(t, function(t) {
                return 'string' == typeof t ? {
                    label: t,
                    value: t
                } : e.extend({
                    label: t.label || t.value,
                    value: t.value || t.label
                }, t)
            })
        },
        _suggest: function(t) {
            var i = this.menu.element.empty();
            this._renderMenu(i, t),
            this.isNewMenu = !0,
            this.menu.refresh(),
            i.show(),
            this._resizeMenu(),
            i.position(e.extend({
                of: this.element
            }, this.options.position)),
            this.options.autoFocus && this.menu.next()
        },
        _resizeMenu: function() {
            var e = this.menu.element;
            e.outerWidth(Math.max(e.width('').outerWidth() + 1, this.element.outerWidth()))
        },
        _renderMenu: function(t, i) {
            var s = this;
            e.each(i, function(e, i) {
                s._renderItemData(t, i)
            })
        },
        _renderItemData: function(e, t) {
            return this._renderItem(e, t).data('ui-autocomplete-item', t)
        },
        _renderItem: function(t, i) {
            return e('<li>').append(e('<a>').text(i.label)).appendTo(t)
        },
        _move: function(e, t) {
            return this.menu.element.is(':visible') ? this.menu.isFirstItem() && /^previous/.test(e) || this.menu.isLastItem() && /^next/.test(e) ? (this._value(this.term), this.menu.blur(), undefined) : (this.menu[e](t), undefined) : (this.search(null, t), undefined)
        },
        widget: function() {
            return this.menu.element
        },
        _value: function() {
            return this.valueMethod.apply(this.element, arguments)
        },
        _keyEvent: function(e, t) {
            (!this.isMultiLine || this.menu.element.is(':visible')) && (this._move(e, t), t.preventDefault())
        }
    }),
    e.extend(e.ui.autocomplete, {
        escapeRegex: function(e) {
            return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g, '\\$&')
        },
        filter: function(t, i) {
            var s = RegExp(e.ui.autocomplete.escapeRegex(i), 'i');
            return e.grep(t, function(e) {
                return s.test(e.label || e.value || e)
            })
        }
    }),
    e.widget('ui.autocomplete', e.ui.autocomplete, {
        options: {
            messages: {
                noResults: 'No search results.',
                results: function(e) {
                    return e + (e > 1 ? ' results are' : ' result is') + ' available, use up and down arrow keys to navigate.'
                }
            }
        },
        __response: function(e) {
            var t;
            this._superApply(arguments),
            this.options.disabled || this.cancelSearch || (t = e && e.length ? this.options.messages.results(e.length) : this.options.messages.noResults, this.liveRegion.text(t))
        }
    })
})(jQuery);
(function(t) {
    t.widget('ui.menu', {
        version: '1.10.2',
        defaultElement: '<ul>',
        delay: 300,
        options: {
            icons: {
                submenu: 'ui-icon-carat-1-e'
            },
            menus: 'ul',
            position: {
                my: 'left top',
                at: 'right top'
            },
            role: 'menu',
            blur: null,
            focus: null,
            select: null
        },
        _create: function() {
            this.activeMenu = this.element,
            this.mouseHandled = !1,
            this.element.uniqueId().addClass('ui-menu ui-widget ui-widget-content ui-corner-all').toggleClass('ui-menu-icons', !!this.element.find('.ui-icon').length).attr({
                role: this.options.role,
                tabIndex: 0
            }).bind('click' + this.eventNamespace, t.proxy(function(t) {
                this.options.disabled && t.preventDefault()
            }, this)),
            this.options.disabled && this.element.addClass('ui-state-disabled').attr('aria-disabled', 'true'),
            this._on({
                'mousedown .ui-menu-item > a': function(t) {
                    t.preventDefault()
                },
                'click .ui-state-disabled > a': function(t) {
                    t.preventDefault()
                },
                'click .ui-menu-item:has(a)': function(e) {
                    var i = t(e.target).closest('.ui-menu-item');
                    !this.mouseHandled && i.not('.ui-state-disabled').length && (this.mouseHandled = !0, this.select(e), i.has('.ui-menu').length ? this.expand(e) : this.element.is(':focus') || (this.element.trigger('focus', [!0]), this.active && 1 === this.active.parents('.ui-menu').length && clearTimeout(this.timer)))
                },
                'mouseenter .ui-menu-item': function(e) {
                    var i = t(e.currentTarget);
                    i.siblings().children('.ui-state-active').removeClass('ui-state-active'),
                    this.focus(e, i)
                },
                mouseleave: 'collapseAll',
                'mouseleave .ui-menu': 'collapseAll',
                focus: function(t, e) {
                    var i = this.active || this.element.children('.ui-menu-item').eq(0);
                    e || this.focus(t, i)
                },
                blur: function(e) {
                    this._delay(function() {
                        t.contains(this.element[0], this.document[0].activeElement) || this.collapseAll(e)
                    })
                },
                keydown: '_keydown'
            }),
            this.refresh(),
            this._on(this.document, {
                click: function(e) {
                    t(e.target).closest('.ui-menu').length || this.collapseAll(e),
                    this.mouseHandled = !1
                }
            })
        },
        _destroy: function() {
            this.element.removeAttr('aria-activedescendant').find('.ui-menu').addBack().removeClass('ui-menu ui-widget ui-widget-content ui-corner-all ui-menu-icons').removeAttr('role').removeAttr('tabIndex').removeAttr('aria-labelledby').removeAttr('aria-expanded').removeAttr('aria-hidden').removeAttr('aria-disabled').removeUniqueId().show(),
            this.element.find('.ui-menu-item').removeClass('ui-menu-item').removeAttr('role').removeAttr('aria-disabled').children('a').removeUniqueId().removeClass('ui-corner-all ui-state-hover').removeAttr('tabIndex').removeAttr('role').removeAttr('aria-haspopup').children().each(function() {
                var e = t(this);
                e.data('ui-menu-submenu-carat') && e.remove()
            }),
            this.element.find('.ui-menu-divider').removeClass('ui-menu-divider ui-widget-content')
        },
        _keydown: function(e) {
            function i(t) {
                return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g, '\\$&')
            }
            var s,
                n,
                a,
                o,
                r,
                h = !0;
            switch (e.keyCode) {
                case t.ui.keyCode.PAGE_UP:
                    this.previousPage(e);
                    break;
                case t.ui.keyCode.PAGE_DOWN:
                    this.nextPage(e);
                    break;
                case t.ui.keyCode.HOME:
                    this._move('first', 'first', e);
                    break;
                case t.ui.keyCode.END:
                    this._move('last', 'last', e);
                    break;
                case t.ui.keyCode.UP:
                    this.previous(e);
                    break;
                case t.ui.keyCode.DOWN:
                    this.next(e);
                    break;
                case t.ui.keyCode.LEFT:
                    this.collapse(e);
                    break;
                case t.ui.keyCode.RIGHT:
                    this.active && !this.active.is('.ui-state-disabled') && this.expand(e);
                    break;
                case t.ui.keyCode.ENTER:
                case t.ui.keyCode.SPACE:
                    this._activate(e);
                    break;
                case t.ui.keyCode.ESCAPE:
                    this.collapse(e);
                    break;
                default:
                    h = !1,
                    n = this.previousFilter || '',
                    a = String.fromCharCode(e.keyCode),
                    o = !1,
                    clearTimeout(this.filterTimer),
                    a === n ? o = !0 : a = n + a,
                    r = RegExp('^' + i(a), 'i'),
                    s = this.activeMenu.children('.ui-menu-item').filter(function() {
                        return r.test(t(this).children('a').text())
                    }),
                    s = o && -1 !== s.index(this.active.next()) ? this.active.nextAll('.ui-menu-item') : s,
                    s.length || (a = String.fromCharCode(e.keyCode), r = RegExp('^' + i(a), 'i'), s = this.activeMenu.children('.ui-menu-item').filter(function() {
                        return r.test(t(this).children('a').text())
                    })),
                    s.length ? (this.focus(e, s), s.length > 1 ? (this.previousFilter = a, this.filterTimer = this._delay(function() {
                        delete this.previousFilter
                    }, 1000)) : delete this.previousFilter) : delete this.previousFilter
            }
            h && e.preventDefault()
        },
        _activate: function(t) {
            this.active.is('.ui-state-disabled') || (this.active.children('a[aria-haspopup=\'true\']').length ? this.expand(t) : this.select(t))
        },
        refresh: function() {
            var e,
                i = this.options.icons.submenu,
                s = this.element.find(this.options.menus);
            s.filter(':not(.ui-menu)').addClass('ui-menu ui-widget ui-widget-content ui-corner-all').hide().attr({
                role: this.options.role,
                'aria-hidden': 'true',
                'aria-expanded': 'false'
            }).each(function() {
                var e = t(this),
                    s = e.prev('a'),
                    n = t('<span>').addClass('ui-menu-icon ui-icon ' + i).data('ui-menu-submenu-carat', !0);
                s.attr('aria-haspopup', 'true').prepend(n),
                e.attr('aria-labelledby', s.attr('id'))
            }),
            e = s.add(this.element),
            e.children(':not(.ui-menu-item):has(a)').addClass('ui-menu-item').attr('role', 'presentation').children('a').uniqueId().addClass('ui-corner-all').attr({
                tabIndex: -1,
                role: this._itemRole()
            }),
            e.children(':not(.ui-menu-item)').each(function() {
                var e = t(this);
                /[^\-\u2014\u2013\s]/.test(e.text()) || e.addClass('ui-widget-content ui-menu-divider')
            }),
            e.children('.ui-state-disabled').attr('aria-disabled', 'true'),
            this.active && !t.contains(this.element[0], this.active[0]) && this.blur()
        },
        _itemRole: function() {
            return {
                menu: 'menuitem',
                listbox: 'option'
            }
            [
                this.options.role
            ]
        },
        _setOption: function(t, e) {
            'icons' === t && this.element.find('.ui-menu-icon').removeClass(this.options.icons.submenu).addClass(e.submenu),
            this._super(t, e)
        },
        focus: function(t, e) {
            var i,
                s;
            this.blur(t, t && 'focus' === t.type),
            this._scrollIntoView(e),
            this.active = e.first(),
            s = this.active.children('a').addClass('ui-state-focus'),
            this.options.role && this.element.attr('aria-activedescendant', s.attr('id')),
            this.active.parent().closest('.ui-menu-item').children('a:first').addClass('ui-state-active'),
            t && 'keydown' === t.type ? this._close() : this.timer = this._delay(function() {
                this._close()
            }, this.delay),
            i = e.children('.ui-menu'),
            i.length && /^mouse/.test(t.type) && this._startOpening(i),
            this.activeMenu = e.parent(),
            this._trigger('focus', t, {
                item: e
            })
        },
        _scrollIntoView: function(e) {
            var i,
                s,
                n,
                a,
                o,
                r;
            this._hasScroll() && (i = parseFloat(t.css(this.activeMenu[0], 'borderTopWidth')) || 0, s = parseFloat(t.css(this.activeMenu[0], 'paddingTop')) || 0, n = e.offset().top - this.activeMenu.offset().top - i - s, a = this.activeMenu.scrollTop(), o = this.activeMenu.height(), r = e.height(), 0 > n ? this.activeMenu.scrollTop(a + n) : n + r > o && this.activeMenu.scrollTop(a + n - o + r))
        },
        blur: function(t, e) {
            e || clearTimeout(this.timer),
            this.active && (this.active.children('a').removeClass('ui-state-focus'), this.active = null, this._trigger('blur', t, {
                item: this.active
            }))
        },
        _startOpening: function(t) {
            clearTimeout(this.timer),
                'true' === t.attr('aria-hidden') && (this.timer = this._delay(function() {
                    this._close(),
                    this._open(t)
                }, this.delay))
        },
        _open: function(e) {
            var i = t.extend({
                of: this.active
            }, this.options.position);
            clearTimeout(this.timer),
            this.element.find('.ui-menu').not(e.parents('.ui-menu')).hide().attr('aria-hidden', 'true'),
            e.show().removeAttr('aria-hidden').attr('aria-expanded', 'true').position(i)
        },
        collapseAll: function(e, i) {
            clearTimeout(this.timer),
            this.timer = this._delay(function() {
                var s = i ? this.element : t(e && e.target).closest(this.element.find('.ui-menu'));
                s.length || (s = this.element),
                this._close(s),
                this.blur(e),
                this.activeMenu = s
            }, this.delay)
        },
        _close: function(t) {
            t || (t = this.active ? this.active.parent() : this.element),
            t.find('.ui-menu').hide().attr('aria-hidden', 'true').attr('aria-expanded', 'false').end().find('a.ui-state-active').removeClass('ui-state-active')
        },
        collapse: function(t) {
            var e = this.active && this.active.parent().closest('.ui-menu-item', this.element);
            e && e.length && (this._close(), this.focus(t, e))
        },
        expand: function(t) {
            var e = this.active && this.active.children('.ui-menu ').children('.ui-menu-item').first();
            e && e.length && (this._open(e.parent()), this._delay(function() {
                this.focus(t, e)
            }))
        },
        next: function(t) {
            this._move('next', 'first', t)
        },
        previous: function(t) {
            this._move('prev', 'last', t)
        },
        isFirstItem: function() {
            return this.active && !this.active.prevAll('.ui-menu-item').length
        },
        isLastItem: function() {
            return this.active && !this.active.nextAll('.ui-menu-item').length
        },
        _move: function(t, e, i) {
            var s;
            this.active && (s = 'first' === t || 'last' === t ? this.active['first' === t ? 'prevAll' : 'nextAll']('.ui-menu-item').eq(-1) : this.active[t + 'All']('.ui-menu-item').eq(0)),
            s && s.length && this.active || (s = this.activeMenu.children('.ui-menu-item')[e]()),
            this.focus(i, s)
        },
        nextPage: function(e) {
            var i,
                s,
                n;
            return this.active ? (this.isLastItem() || (this._hasScroll() ? (s = this.active.offset().top, n = this.element.height(), this.active.nextAll('.ui-menu-item').each(function() {
                return i = t(this),
                    0 > i.offset().top - s - n
            }), this.focus(e, i)) : this.focus(e, this.activeMenu.children('.ui-menu-item')[this.active ? 'last' : 'first']())), undefined) : (this.next(e), undefined)
        },
        previousPage: function(e) {
            var i,
                s,
                n;
            return this.active ? (this.isFirstItem() || (this._hasScroll() ? (s = this.active.offset().top, n = this.element.height(), this.active.prevAll('.ui-menu-item').each(function() {
                return i = t(this),
                    i.offset().top - s + n > 0
            }), this.focus(e, i)) : this.focus(e, this.activeMenu.children('.ui-menu-item').first())), undefined) : (this.next(e), undefined)
        },
        _hasScroll: function() {
            return this.element.outerHeight() < this.element.prop('scrollHeight')
        },
        select: function(e) {
            this.active = this.active || t(e.target).closest('.ui-menu-item');
            var i = {
                item: this.active
            };
            this.active.has('.ui-menu').length || this.collapseAll(e, !0),
            this._trigger('select', e, i)
        }
    })
})(jQuery);
(function(t) {
    var e = 5;
    t.widget('ui.slider', t.ui.mouse, {
        version: '1.10.2',
        widgetEventPrefix: 'slide',
        options: {
            animate: !1,
            distance: 0,
            max: 100,
            min: 0,
            orientation: 'horizontal',
            range: !1,
            step: 1,
            value: 0,
            values: null,
            change: null,
            slide: null,
            start: null,
            stop: null
        },
        _create: function() {
            this._keySliding = !1,
            this._mouseSliding = !1,
            this._animateOff = !0,
            this._handleIndex = null,
            this._detectOrientation(),
            this._mouseInit(),
            this.element.addClass('ui-slider ui-slider-' + this.orientation + ' ui-widget' + ' ui-widget-content' + ' ui-corner-all'),
            this._refresh(),
            this._setOption('disabled', this.options.disabled),
            this._animateOff = !1
        },
        _refresh: function() {
            this._createRange(),
            this._createHandles(),
            this._setupEvents(),
            this._refreshValue()
        },
        _createHandles: function() {
            var e,
                i,
                s = this.options,
                n = this.element.find('.ui-slider-handle').addClass('ui-state-default ui-corner-all'),
                a = '<a class=\'ui-slider-handle ui-state-default ui-corner-all\' href=\'#\'></a>',
                o = [];
            for (i = s.values && s.values.length || 1, n.length > i && (n.slice(i).remove(), n = n.slice(0, i)), e = n.length; i > e; e++) o.push(a);
            this.handles = n.add(t(o.join('')).appendTo(this.element)),
            this.handle = this.handles.eq(0),
            this.handles.each(function(e) {
                t(this).data('ui-slider-handle-index', e)
            })
        },
        _createRange: function() {
            var e = this.options,
                i = '';
            e.range ? (e.range === !0 && (e.values ? e.values.length && 2 !== e.values.length ? e.values = [
                e.values[0],
                e.values[0]
            ] : t.isArray(e.values) && (e.values = e.values.slice(0)) : e.values = [
                this._valueMin(),
                this._valueMin()
            ]), this.range && this.range.length ? this.range.removeClass('ui-slider-range-min ui-slider-range-max').css({
                left: '',
                bottom: ''
            }) : (this.range = t('<div></div>').appendTo(this.element), i = 'ui-slider-range ui-widget-header ui-corner-all'), this.range.addClass(i + ('min' === e.range || 'max' === e.range ? ' ui-slider-range-' + e.range : ''))) : this.range = t([])
        },
        _setupEvents: function() {
            var t = this.handles.add(this.range).filter('a');
            this._off(t),
            this._on(t, this._handleEvents),
            this._hoverable(t),
            this._focusable(t)
        },
        _destroy: function() {
            this.handles.remove(),
            this.range.remove(),
            this.element.removeClass('ui-slider ui-slider-horizontal ui-slider-vertical ui-widget ui-widget-content ui-corner-all'),
            this._mouseDestroy()
        },
        _mouseCapture: function(e) {
            var i,
                s,
                n,
                a,
                o,
                r,
                h,
                l,
                u = this,
                c = this.options;
            return c.disabled ? !1 : (this.elementSize = {
                width: this.element.outerWidth(),
                height: this.element.outerHeight()
            }, this.elementOffset = this.element.offset(), i = {
                x: e.pageX,
                y: e.pageY
            }, s = this._normValueFromMouse(i), n = this._valueMax() - this._valueMin() + 1, this.handles.each(function(e) {
                var i = Math.abs(s - u.values(e));
                (n > i || n === i && (e === u._lastChangedValue || u.values(e) === c.min)) && (n = i, a = t(this), o = e)
            }), r = this._start(e, o), r === !1 ? !1 : (this._mouseSliding = !0, this._handleIndex = o, a.addClass('ui-state-active').focus(), h = a.offset(), l = !t(e.target).parents().addBack().is('.ui-slider-handle'), this._clickOffset = l ? {
                left: 0,
                top: 0
            } : {
                left: e.pageX - h.left - a.width() / 2,
                top: e.pageY - h.top - a.height() / 2 - (parseInt(a.css('borderTopWidth'), 10) || 0) - (parseInt(a.css('borderBottomWidth'), 10) || 0) + (parseInt(a.css('marginTop'), 10) || 0)
            }, this.handles.hasClass('ui-state-hover') || this._slide(e, o, s), this._animateOff = !0, !0))
        },
        _mouseStart: function() {
            return !0
        },
        _mouseDrag: function(t) {
            var e = {
                    x: t.pageX,
                    y: t.pageY
                },
                i = this._normValueFromMouse(e);
            return this._slide(t, this._handleIndex, i), !1
        },
        _mouseStop: function(t) {
            return this.handles.removeClass('ui-state-active'),
                this._mouseSliding = !1,
                this._stop(t, this._handleIndex),
                this._change(t, this._handleIndex),
                this._handleIndex = null,
                this._clickOffset = null,
                this._animateOff = !1, !1
        },
        _detectOrientation: function() {
            this.orientation = 'vertical' === this.options.orientation ? 'vertical' : 'horizontal'
        },
        _normValueFromMouse: function(t) {
            var e,
                i,
                s,
                n,
                a;
            return 'horizontal' === this.orientation ? (e = this.elementSize.width, i = t.x - this.elementOffset.left - (this._clickOffset ? this._clickOffset.left : 0)) : (e = this.elementSize.height, i = t.y - this.elementOffset.top - (this._clickOffset ? this._clickOffset.top : 0)),
                s = i / e,
                s > 1 && (s = 1),
                0 > s && (s = 0),
                'vertical' === this.orientation && (s = 1 - s),
                n = this._valueMax() - this._valueMin(),
                a = this._valueMin() + s * n,
                this._trimAlignValue(a)
        },
        _start: function(t, e) {
            var i = {
                handle: this.handles[e],
                value: this.value()
            };
            return this.options.values && this.options.values.length && (i.value = this.values(e), i.values = this.values()),
                this._trigger('start', t, i)
        },
        _slide: function(t, e, i) {
            var s,
                n,
                a;
            this.options.values && this.options.values.length ? (s = this.values(e ? 0 : 1), 2 === this.options.values.length && this.options.range === !0 && (0 === e && i > s || 1 === e && s > i) && (i = s), i !== this.values(e) && (n = this.values(), n[e] = i, a = this._trigger('slide', t, {
                handle: this.handles[e],
                value: i,
                values: n
            }), s = this.values(e ? 0 : 1), a !== !1 && this.values(e, i, !0))) : i !== this.value() && (a = this._trigger('slide', t, {
                handle: this.handles[e],
                value: i
            }), a !== !1 && this.value(i))
        },
        _stop: function(t, e) {
            var i = {
                handle: this.handles[e],
                value: this.value()
            };
            this.options.values && this.options.values.length && (i.value = this.values(e), i.values = this.values()),
            this._trigger('stop', t, i)
        },
        _change: function(t, e) {
            if (!this._keySliding && !this._mouseSliding) {
                var i = {
                    handle: this.handles[e],
                    value: this.value()
                };
                this.options.values && this.options.values.length && (i.value = this.values(e), i.values = this.values()),
                this._lastChangedValue = e,
                this._trigger('change', t, i)
            }
        },
        value: function(t) {
            return arguments.length ? (this.options.value = this._trimAlignValue(t), this._refreshValue(), this._change(null, 0), undefined) : this._value()
        },
        values: function(e, i) {
            var s,
                n,
                a;
            if (arguments.length > 1) return this.options.values[e] = this._trimAlignValue(i),
                this._refreshValue(),
                this._change(null, e),
                undefined;
            if (!arguments.length) return this._values();
            if (!t.isArray(arguments[0])) return this.options.values && this.options.values.length ? this._values(e) : this.value();
            for (s = this.options.values, n = arguments[0], a = 0; s.length > a; a += 1) s[a] = this._trimAlignValue(n[a]),
                this._change(null, a);
            this._refreshValue()
        },
        _setOption: function(e, i) {
            var s,
                n = 0;
            switch ('range' === e && this.options.range === !0 && ('min' === i ? (this.options.value = this._values(0), this.options.values = null) : 'max' === i && (this.options.value = this._values(this.options.values.length - 1), this.options.values = null)), t.isArray(this.options.values) && (n = this.options.values.length), t.Widget.prototype._setOption.apply(this, arguments), e) {
                case 'orientation':
                    this._detectOrientation(),
                    this.element.removeClass('ui-slider-horizontal ui-slider-vertical').addClass('ui-slider-' + this.orientation),
                    this._refreshValue();
                    break;
                case 'value':
                    this._animateOff = !0,
                    this._refreshValue(),
                    this._change(null, 0),
                    this._animateOff = !1;
                    break;
                case 'values':
                    for (this._animateOff = !0, this._refreshValue(), s = 0; n > s; s += 1) this._change(null, s);
                    this._animateOff = !1;
                    break;
                case 'min':
                case 'max':
                    this._animateOff = !0,
                    this._refreshValue(),
                    this._animateOff = !1;
                    break;
                case 'range':
                    this._animateOff = !0,
                    this._refresh(),
                    this._animateOff = !1
            }
        },
        _value: function() {
            var t = this.options.value;
            return t = this._trimAlignValue(t)
        },
        _values: function(t) {
            var e,
                i,
                s;
            if (arguments.length) return e = this.options.values[t],
                e = this._trimAlignValue(e);
            if (this.options.values && this.options.values.length) {
                for (i = this.options.values.slice(), s = 0; i.length > s; s += 1) i[s] = this._trimAlignValue(i[s]);
                return i
            }
            return []
        },
        _trimAlignValue: function(t) {
            if (this._valueMin() >= t) return this._valueMin();
            if (t >= this._valueMax()) return this._valueMax();
            var e = this.options.step > 0 ? this.options.step : 1,
                i = (t - this._valueMin()) % e,
                s = t - i;
            return 2 * Math.abs(i) >= e && (s += i > 0 ? e : -e),
                parseFloat(s.toFixed(5))
        },
        _valueMin: function() {
            return this.options.min
        },
        _valueMax: function() {
            return this.options.max
        },
        _refreshValue: function() {
            var e,
                i,
                s,
                n,
                a,
                o = this.options.range,
                r = this.options,
                h = this,
                l = this._animateOff ? !1 : r.animate,
                u = {};
            this.options.values && this.options.values.length ? this.handles.each(function(s) {
                i = 100 * ((h.values(s) - h._valueMin()) / (h._valueMax() - h._valueMin())),
                u['horizontal' === h.orientation ? 'left' : 'bottom'] = i + '%',
                t(this).stop(1, 1)[l ? 'animate' : 'css'](u, r.animate),
                h.options.range === !0 && ('horizontal' === h.orientation ? (0 === s && h.range.stop(1, 1)[l ? 'animate' : 'css']({
                    left: i + '%'
                }, r.animate), 1 === s && h.range[l ? 'animate' : 'css']({
                    width: i - e + '%'
                }, {
                    queue: !1,
                    duration: r.animate
                })) : (0 === s && h.range.stop(1, 1)[l ? 'animate' : 'css']({
                    bottom: i + '%'
                }, r.animate), 1 === s && h.range[l ? 'animate' : 'css']({
                    height: i - e + '%'
                }, {
                    queue: !1,
                    duration: r.animate
                }))),
                e = i
            }) : (s = this.value(), n = this._valueMin(), a = this._valueMax(), i = a !== n ? 100 * ((s - n) / (a - n)) : 0, u['horizontal' === this.orientation ? 'left' : 'bottom'] = i + '%', this.handle.stop(1, 1)[l ? 'animate' : 'css'](u, r.animate), 'min' === o && 'horizontal' === this.orientation && this.range.stop(1, 1)[l ? 'animate' : 'css']({
                width: i + '%'
            }, r.animate), 'max' === o && 'horizontal' === this.orientation && this.range[l ? 'animate' : 'css']({
                width: 100 - i + '%'
            }, {
                queue: !1,
                duration: r.animate
            }), 'min' === o && 'vertical' === this.orientation && this.range.stop(1, 1)[l ? 'animate' : 'css']({
                height: i + '%'
            }, r.animate), 'max' === o && 'vertical' === this.orientation && this.range[l ? 'animate' : 'css']({
                height: 100 - i + '%'
            }, {
                queue: !1,
                duration: r.animate
            }))
        },
        _handleEvents: {
            keydown: function(i) {
                var s,
                    n,
                    a,
                    o,
                    r = t(i.target).data('ui-slider-handle-index');
                switch (i.keyCode) {
                    case t.ui.keyCode.HOME:
                    case t.ui.keyCode.END:
                    case t.ui.keyCode.PAGE_UP:
                    case t.ui.keyCode.PAGE_DOWN:
                    case t.ui.keyCode.UP:
                    case t.ui.keyCode.RIGHT:
                    case t.ui.keyCode.DOWN:
                    case t.ui.keyCode.LEFT:
                        if (i.preventDefault(), !this._keySliding && (this._keySliding = !0, t(i.target).addClass('ui-state-active'), s = this._start(i, r), s === !1)) return
                }
                switch (o = this.options.step, n = a = this.options.values && this.options.values.length ? this.values(r) : this.value(), i.keyCode) {
                    case t.ui.keyCode.HOME:
                        a = this._valueMin();
                        break;
                    case t.ui.keyCode.END:
                        a = this._valueMax();
                        break;
                    case t.ui.keyCode.PAGE_UP:
                        a = this._trimAlignValue(n + (this._valueMax() - this._valueMin()) / e);
                        break;
                    case t.ui.keyCode.PAGE_DOWN:
                        a = this._trimAlignValue(n - (this._valueMax() - this._valueMin()) / e);
                        break;
                    case t.ui.keyCode.UP:
                    case t.ui.keyCode.RIGHT:
                        if (n === this._valueMax()) return;
                        a = this._trimAlignValue(n + o);
                        break;
                    case t.ui.keyCode.DOWN:
                    case t.ui.keyCode.LEFT:
                        if (n === this._valueMin()) return;
                        a = this._trimAlignValue(n - o)
                }
                this._slide(i, r, a)
            },
            click: function(t) {
                t.preventDefault()
            },
            keyup: function(e) {
                var i = t(e.target).data('ui-slider-handle-index');
                this._keySliding && (this._keySliding = !1, this._stop(e, i), this._change(e, i), t(e.target).removeClass('ui-state-active'))
            }
        }
    })
})(jQuery);
(function(t) {
    function e(e, i) {
        var s = (e.attr('aria-describedby') || '').split(/\s+/);
        s.push(i),
        e.data('ui-tooltip-id', i).attr('aria-describedby', t.trim(s.join(' ')))
    }

    function i(e) {
        var i = e.data('ui-tooltip-id'),
            s = (e.attr('aria-describedby') || '').split(/\s+/),
            n = t.inArray(i, s); - 1 !== n && s.splice(n, 1),
        e.removeData('ui-tooltip-id'),
        s = t.trim(s.join(' ')),
        s ? e.attr('aria-describedby', s) : e.removeAttr('aria-describedby')
    }
    var s = 0;
    t.widget('ui.tooltip', {
        version: '1.10.2',
        options: {
            content: function() {
                var e = t(this).attr('title') || '';
                return t('<a>').text(e).html()
            },
            hide: !0,
            items: '[title]:not([disabled])',
            position: {
                my: 'left top+15',
                at: 'left bottom',
                collision: 'flipfit flip'
            },
            show: !0,
            tooltipClass: null,
            track: !1,
            close: null,
            open: null
        },
        _create: function() {
            this._on({
                mouseover: 'open',
                focusin: 'open'
            }),
            this.tooltips = {},
            this.parents = {},
            this.options.disabled && this._disable()
        },
        _setOption: function(e, i) {
            var s = this;
            return 'disabled' === e ? (this[i ? '_disable' : '_enable'](), this.options[e] = i, void 0) : (this._super(e, i), 'content' === e && t.each(this.tooltips, function(t, e) {
                s._updateContent(e)
            }), void 0)
        },
        _disable: function() {
            var e = this;
            t.each(this.tooltips, function(i, s) {
                var n = t.Event('blur');
                n.target = n.currentTarget = s[0],
                e.close(n, !0)
            }),
            this.element.find(this.options.items).addBack().each(function() {
                var e = t(this);
                e.is('[title]') && e.data('ui-tooltip-title', e.attr('title')).attr('title', '')
            })
        },
        _enable: function() {
            this.element.find(this.options.items).addBack().each(function() {
                var e = t(this);
                e.data('ui-tooltip-title') && e.attr('title', e.data('ui-tooltip-title'))
            })
        },
        open: function(e) {
            var i = this,
                s = t(e ? e.target : this.element).closest(this.options.items);
            s.length && !s.data('ui-tooltip-id') && (s.attr('title') && s.data('ui-tooltip-title', s.attr('title')), s.data('ui-tooltip-open', !0), e && 'mouseover' === e.type && s.parents().each(function() {
                var e,
                    s = t(this);
                s.data('ui-tooltip-open') && (e = t.Event('blur'), e.target = e.currentTarget = this, i.close(e, !0)),
                s.attr('title') && (s.uniqueId(), i.parents[this.id] = {
                    element: this,
                    title: s.attr('title')
                }, s.attr('title', ''))
            }), this._updateContent(s, e))
        },
        _updateContent: function(t, e) {
            var i,
                s = this.options.content,
                n = this,
                a = e ? e.type : null;
            return 'string' == typeof s ? this._open(e, t, s) : (i = s.call(t[0], function(i) {
                t.data('ui-tooltip-open') && n._delay(function() {
                    e && (e.type = a),
                    this._open(e, t, i)
                })
            }), i && this._open(e, t, i), void 0)
        },
        _open: function(i, s, n) {
            function a(t) {
                l.of = t,
                o.is(':hidden') || o.position(l)
            }
            var o,
                r,
                h,
                l = t.extend({}, this.options.position);
            if (n) {
                if (o = this._find(s), o.length) return o.find('.ui-tooltip-content').html(n),
                    void 0;
                s.is('[title]') && (i && 'mouseover' === i.type ? s.attr('title', '') : s.removeAttr('title')),
                o = this._tooltip(s),
                e(s, o.attr('id')),
                o.find('.ui-tooltip-content').html(n),
                this.options.track && i && /^mouse/.test(i.type) ? (this._on(this.document, {
                    mousemove: a
                }), a(i)) : o.position(t.extend({
                    of: s
                }, this.options.position)),
                o.hide(),
                this._show(o, this.options.show),
                this.options.show && this.options.show.delay && (h = this.delayedShow = setInterval(function() {
                    o.is(':visible') && (a(l.of), clearInterval(h))
                }, t.fx.interval)),
                this._trigger('open', i, {
                    tooltip: o
                }),
                r = {
                    keyup: function(e) {
                        if (e.keyCode === t.ui.keyCode.ESCAPE) {
                            var i = t.Event(e);
                            i.currentTarget = s[0],
                            this.close(i, !0)
                        }
                    },
                    remove: function() {
                        this._removeTooltip(o)
                    }
                },
                i && 'mouseover' !== i.type || (r.mouseleave = 'close'),
                i && 'focusin' !== i.type || (r.focusout = 'close'),
                this._on(!0, s, r)
            }
        },
        close: function(e) {
            var s = this,
                n = t(e ? e.currentTarget : this.element),
                a = this._find(n);
            this.closing || (clearInterval(this.delayedShow), n.data('ui-tooltip-title') && n.attr('title', n.data('ui-tooltip-title')), i(n), a.stop(!0), this._hide(a, this.options.hide, function() {
                s._removeTooltip(t(this))
            }), n.removeData('ui-tooltip-open'), this._off(n, 'mouseleave focusout keyup'), n[0] !== this.element[0] && this._off(n, 'remove'), this._off(this.document, 'mousemove'), e && 'mouseleave' === e.type && t.each(this.parents, function(e, i) {
                t(i.element).attr('title', i.title),
                delete s.parents[e]
            }), this.closing = !0, this._trigger('close', e, {
                tooltip: a
            }), this.closing = !1)
        },
        _tooltip: function(e) {
            var i = 'ui-tooltip-' + s++,
                n = t('<div>').attr({
                    id: i,
                    role: 'tooltip'
                }).addClass('ui-tooltip ui-widget ui-corner-all ui-widget-content ' + (this.options.tooltipClass || ''));
            return t('<div>').addClass('ui-tooltip-content').appendTo(n),
                n.appendTo(this.document[0].body),
                this.tooltips[i] = e,
                n
        },
        _find: function(e) {
            var i = e.data('ui-tooltip-id');
            return i ? t('#' + i) : t()
        },
        _removeTooltip: function(t) {
            t.remove(),
            delete this.tooltips[t.attr('id')]
        },
        _destroy: function() {
            var e = this;
            t.each(this.tooltips, function(i, s) {
                var n = t.Event('blur');
                n.target = n.currentTarget = s[0],
                e.close(n, !0),
                t('#' + i).remove(),
                s.data('ui-tooltip-title') && (s.attr('title', s.data('ui-tooltip-title')), s.removeData('ui-tooltip-title'))
            })
        }
    })
})(jQuery);
/* OpenPGP radix-64/base64 string encoding/decoding
 * Copyright 2005 Herbert Hanewinkel, www.haneWIN.de
 * version 1.0, check www.haneWIN.de for the latest version
 
 * This software is provided as-is, without express or implied warranty.
 * Permission to use, copy, modify, distribute or sell this software, with or
 * without fee, for any purpose and by any individual or organization, is hereby
 * granted, provided that the above copyright notice and this paragraph appear
 * in all copies. Distribution as a part of an application or binary must
 * include the above copyright notice in the documentation and/or other materials
 * provided with the application or distribution.
 */
var b64s = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'

function s2r(t) {
    var a,
        c,
        n;
    var r = '',
        l = 0,
        s = 0;
    var tl = t.length;
    for (n = 0; n < tl; n++) {
        c = t.charCodeAt(n);
        if (s == 0) {
            r += b64s.charAt((c >> 2) & 63);
            a = (c & 3) << 4;
        } else if (s == 1) {
            r += b64s.charAt((a | (c >> 4) & 15));
            a = (c & 15) << 2;
        } else if (s == 2) {
            r += b64s.charAt(a | ((c >> 6) & 3));
            l += 1;
            if ((l % 60) == 0) r += '\n';
            r += b64s.charAt(c & 63);
        }
        l += 1;
        if ((l % 60) == 0) r += '\n';
        s += 1;
        if (s == 3) s = 0;
    }
    if (s > 0) {
        r += b64s.charAt(a);
        l += 1;
        if ((l % 60) == 0) r += '\n';
        r += '=';
        l += 1;
    }
    if (s == 1) {
        if ((l % 60) == 0) r += '\n';
        r += '=';
    }
    return r;
}

function r2s(t) {
    var c,
        n;
    var r = '',
        s = 0,
        a = 0;
    var tl = t.length;
    for (n = 0; n < tl; n++) {
        c = b64s.indexOf(t.charAt(n));
        if (c >= 0) {
            if (s) r += String.fromCharCode(a | (c >> (6 - s)) & 255);
            s = (s + 2) & 7;
            a = (c << s) & 255;
        }
    }
    return r;
}(function(scope) {
    function FileDragHover(e) {
        if (d) console.log('hover', $.dragging);
        if (folderlink) return false;
        $.dragging = new Date().getTime();
        e.stopPropagation();
        e.preventDefault();
        if (document.getElementById('start_uploadbutton')) document.getElementById('start_uploadbutton').style.display = 'none';
        if (!$.ddhelper) {
            var filecnt = 0;
            if (e && e.target && e.target.files) {
                var files = e.target.files || e.dataTransfer.files;
                for (var i in files) filecnt++;
            } else if (e && e.dataTransfer && e.dataTransfer.items && e.dataTransfer.items.length > 0 && e.dataTransfer.items[0].webkitGetAsEntry) {
                var items = e.dataTransfer.items;
                for (var i in items)
                    if (items[i].kind) filecnt++;
            } else if (e && e.dataTransfer && e.dataTransfer.files) {
                var files = e.dataTransfer.files;
                for (var i in files) filecnt++;
            } else if (e && e.dataTransfer && e.dataTransfer.mozItemCount) filecnt = e.dataTransfer.mozItemCount;
            else filecnt = 1;
            if (filecnt > 0) $.ddhelper = getDDhelper();
            if (filecnt > 1) {
                $('.dragger-files-number').text(filecnt);
                $('.dragger-files-number').show();
            }
        }
        if ($.ddhelper) {
            $('#draghelper .dragger-icon').remove();
            $('<div class="dragger-icon ' + fileicon({
                name: ''
            }) + '"></div>').insertAfter('#draghelper .dragger-status');
            $('.dragger-icon.fade').fadeTo(500, 0.1);
            $($.ddhelper).css({
                left: (e.pageX + 35 + 'px'),
                top: (e.pageY - 5 + 'px')
            });
            $('.dragger-block').removeClass('move copy warning drag');
            $('.dragger-block').addClass('copy');
        }
        if (page == 'start') {
            $('.st-main-cursor,.st-main-info').fadeOut(30);
            start_over();
        }
    }

    function FileDragLeave(e) {
        if (d) console.log(e);
        if (folderlink) return false;
        e.stopPropagation();
        e.preventDefault();
        setTimeout(function() {
            if (e && (e.pageX < 6 || e.pageY < 6) && $.dragging && $.dragging + 50 < new Date().getTime()) {
                $($.ddhelper).remove();
                $.ddhelper = undefined;
            }
        }, 100);
        setTimeout(function() {
            if (page == 'start' && e && (e.pageX < 6 || e.pageY < 6) && $.dragging && $.dragging + 500 < new Date().getTime()) {
                $.dragging = false;
                start_out();
                $('.st-main-cursor,.st-main-info').fadeIn(30);
            }
        }, 500);
    }
    var dir_inflight = 0;
    var file_inflight = 0;
    var filedrag_u = [];

    function traverseFileTree(item, path) {
        path = path || '';
        if (item.isFile) {
            dir_inflight++;
            item.file(function(file) {
                if (d) console.log(file);
                file.path = path;
                filedrag_u.push(file);
                if (--dir_inflight == 0 && $.dostart) {
                    addupload(filedrag_u);
                    filedrag_u = [];
                    if (page == 'start') start_upload();
                }
            });
        } else if (item.isDirectory) {
            dir_inflight++;
            var dirReader = item.createReader();
            dirReader.readEntries(function(entries) {
                for (var i = 0; i < entries.length; i++) {
                    traverseFileTree(entries[i], path + item.name + '/');
                }
                if (--dir_inflight == 0) {
                    addupload(filedrag_u);
                    filedrag_u = [];
                }
            });
        }
        if (d && dir_inflight == 0) console.log('end');
    }

    function start_upload() {
        if (u_wasloggedin()) {
            msgDialog('confirmation', l[1193], l[2001], l[2002], function(e) {
                if (e) start_anoupload();
                else loginDialog();
            });
        } else start_anoupload();
    }

    function start_anoupload() {
        u_storage = init_storage(localStorage);
        loadingDialog.show();
        u_checklogin({
            checkloginresult: function(u_ctx, r) {
                u_type = r;
                u_checked = true;
                loadingDialog.hide();
                document.location.hash = 'fm';
            }
        }, true);
    }
    // file selection

    function FileSelectHandler(e) {
        if (folderlink) return false;
        if (e.stopPropagation) e.stopPropagation();
        if (e.preventDefault) e.preventDefault();
        $($.ddhelper).remove();
        $.ddhelper = undefined;
        if (page == 'start') {
            if ($('#fmholder').html() == '') $('#fmholder').html('<div id="topmenu"></div>' + translate(pages['fm'].replace(/{staticpath}/g, staticpath)));
            start_out();
            setTimeout(function() {
                $('.st-main-cursor,.st-main-info').show();
            }, 500);
        }
        var files = e.target.files || e.dataTransfer.files;
        if (files.length == 0) return false;
        if (e.dataTransfer && e.dataTransfer.items && e.dataTransfer.items.length > 0 && e.dataTransfer.items[0].webkitGetAsEntry) {
            var items = e.dataTransfer.items;
            for (var i = 0; i < items.length; i++) {
                if (items[i].webkitGetAsEntry) {
                    var item = items[i].webkitGetAsEntry();
                    if (item) {
                        filedrag_u = [];
                        if (i == items.length - 1) $.dostart = true;
                        traverseFileTree(item);
                    }
                }
            }
        } else if (is_chrome_firefox && e.dataTransfer) {
            try {
                for (var i = 0, m = e.dataTransfer.mozItemCount; i < m; ++i) {
                    var file = e.dataTransfer.mozGetDataAt('application/x-moz-file', i);
                    if (file instanceof Ci.nsIFile) {
                        filedrag_u = [];
                        if (i == m - 1) $.dostart = true;
                        traverseFileTree(new mozDirtyGetAsEntry(file /*,e.dataTransfer*/ ));
                    } else {
                        if (d) console.log('FileSelectHandler: Not a nsIFile', file);
                    }
                    // e.dataTransfer.mozClearDataAt("application/x-moz-file", i);

                }
            } catch (e) {
                alert(e);
                Cu.reportError(e);
            }
        } else {
            var u = [];
            for (var i = 0, f; f = files[i]; i++) {
                if (f.webkitRelativePath) f.path = f.webkitRelativePath;
                if (f.name != '.') u.push(f);
            }
            addupload(u);
            if (page == 'start') start_upload();
            $('.fm-file-upload input').remove();
            $('.fm-file-upload').append('<input type="file" id="fileselect1" multiple="">');
            $('.fm-folder-upload input').remove();
            $('.fm-folder-upload').append('<input type="file" id="fileselect2" webkitdirectory="" multiple="">');
            $('.context-menu-item.fileupload-item label input').remove();
            $('.context-menu-item.fileupload-item label').append('<input type="file" id="fileselect3" class="hidden" name="fileselect3" multiple="">');
            $('.context-menu-item.folderupload-item label input').remove();
            $('.context-menu-item.folderupload-item label').append('<input type="file" id="fileselect4" name="fileselect4" webkitdirectory="" multiple="" class="hidden">');
            InitFileDrag();
        }
        return true;
    }
    // initialize

    scope.InitFileDrag = function() {
        var i = 5;
        while (i--) {
            var o = document.getElementById(i ? 'fileselect' + i : 'start-upload');
            if (o) o.addEventListener('change', FileSelectHandler, false);
        }
        document.getElementById('fmholder').addEventListener('dragover', FileDragHover, false);
        document.getElementById('fmholder').addEventListener('dragleave', FileDragLeave, false);
        document.getElementById('fmholder').addEventListener('drop', FileSelectHandler, false);
        document.getElementById('startholder').addEventListener('dragover', FileDragHover, false);
        document.getElementById('startholder').addEventListener('dragleave', FileDragLeave, false);
        document.getElementById('startholder').addEventListener('drop', FileSelectHandler, false);
        if (is_chrome_firefox) {
            $('input[webkitdirectory]').click(function(e) {
                var file = mozFilePicker(0, 2, { /*gfp:1,*/
                    title: l[98]
                });
                if (file) {
                    e.target = {
                        files: [-1]
                    };
                    e.dataTransfer = {
                        mozItemCount: 1,
                        mozGetDataAt: function() {
                            return file;
                        }
                    };
                    FileSelectHandler(e);
                    file = undefined;
                } else {
                    if (e.stopPropagation) e.stopPropagation();
                    if (e.preventDefault) e.preventDefault();
                }
            });
        }
    }
})(this);
// @crodas -- http://stackoverflow.com/a/2200886/1608408
(function() {
    var orig = $.fn.remove;
    $.fn.remove = function() {
        $(this).trigger('remove')
        return orig.apply(this, arguments);
    }
})();
/*! Copyright (c) 2013 Brandon Aaron (http://brandon.aaron.sh)
 * Licensed under the MIT License (LICENSE.txt).
 *
 * Version: 3.1.9
 *
 * Requires: jQuery 1.2.2+
 */
(function(factory) {
    if (typeof define === 'function' && define.amd) {
        // AMD. Register as an anonymous module.
        define(['jquery'], factory);
    } else if (typeof exports === 'object') {
        // Node/CommonJS style for Browserify
        module.exports = factory;
    } else {
        // Browser globals
        factory(jQuery);
    }
}(function($) {
    var toFix = [
            'wheel',
            'mousewheel',
            'DOMMouseScroll',
            'MozMousePixelScroll'
        ],
        toBind = ('onwheel' in document || document.documentMode >= 9) ?
        [
            'wheel'
        ] : [
            'mousewheel',
            'DomMouseScroll',
            'MozMousePixelScroll'
        ],
        slice = Array.prototype.slice,
        nullLowestDeltaTimeout,
        lowestDelta;
    if ($.event.fixHooks) {
        for (var i = toFix.length; i;) {
            $.event.fixHooks[toFix[--i]] = $.event.mouseHooks;
        }
    }
    var special = $.event.special.mousewheel = {
        version: '3.1.9',
        setup: function() {
            if (this.addEventListener) {
                for (var i = toBind.length; i;) {
                    this.addEventListener(toBind[--i], handler, false);
                }
            } else {
                this.onmousewheel = handler;
            }
            // Store the line height and page height for this particular element

            $.data(this, 'mousewheel-line-height', special.getLineHeight(this));
            $.data(this, 'mousewheel-page-height', special.getPageHeight(this));
        },
        teardown: function() {
            if (this.removeEventListener) {
                for (var i = toBind.length; i;) {
                    this.removeEventListener(toBind[--i], handler, false);
                }
            } else {
                this.onmousewheel = null;
            }
        },
        getLineHeight: function(elem) {
            return parseInt($(elem)['offsetParent' in $.fn ? 'offsetParent' : 'parent']().css('fontSize'), 10);
        },
        getPageHeight: function(elem) {
            return $(elem).height();
        },
        settings: {
            adjustOldDeltas: true
        }
    };
    $.fn.extend({
        mousewheel: function(fn) {
            return fn ? this.bind('mousewheel', fn) : this.trigger('mousewheel');
        },
        unmousewheel: function(fn) {
            return this.unbind('mousewheel', fn);
        }
    });

    function handler(event) {
        var orgEvent = event || window.event,
            args = slice.call(arguments, 1),
            delta = 0,
            deltaX = 0,
            deltaY = 0,
            absDelta = 0;
        event = $.event.fix(orgEvent);
        event.type = 'mousewheel';
        // Old school scrollwheel delta
        if ('detail' in orgEvent) {
            deltaY = orgEvent.detail * -1;
        }
        if ('wheelDelta' in orgEvent) {
            deltaY = orgEvent.wheelDelta;
        }
        if ('wheelDeltaY' in orgEvent) {
            deltaY = orgEvent.wheelDeltaY;
        }
        if ('wheelDeltaX' in orgEvent) {
            deltaX = orgEvent.wheelDeltaX * -1;
        }
        // Firefox < 17 horizontal scrolling related to DOMMouseScroll event

        if ('axis' in orgEvent && orgEvent.axis === orgEvent.HORIZONTAL_AXIS) {
            deltaX = deltaY * -1;
            deltaY = 0;
        }
        // Set delta to be deltaY or deltaX if deltaY is 0 for backwards compatabilitiy

        delta = deltaY === 0 ? deltaX : deltaY;
        // New school wheel delta (wheel event)
        if ('deltaY' in orgEvent) {
            deltaY = orgEvent.deltaY * -1;
            delta = deltaY;
        }
        if ('deltaX' in orgEvent) {
            deltaX = orgEvent.deltaX;
            if (deltaY === 0) {
                delta = deltaX * -1;
            }
        }
        // No change actually happened, no reason to go any further

        if (deltaY === 0 && deltaX === 0) {
            return;
        }
        // Need to convert lines and pages to pixels if we aren't already in pixels
        // There are three delta modes:
        //   * deltaMode 0 is by pixels, nothing to do
        //   * deltaMode 1 is by lines
        //   * deltaMode 2 is by pages

        if (orgEvent.deltaMode === 1) {
            var lineHeight = $.data(this, 'mousewheel-line-height');
            delta *= lineHeight;
            deltaY *= lineHeight;
            deltaX *= lineHeight;
        } else if (orgEvent.deltaMode === 2) {
            var pageHeight = $.data(this, 'mousewheel-page-height');
            delta *= pageHeight;
            deltaY *= pageHeight;
            deltaX *= pageHeight;
        }
        // Store lowest absolute delta to normalize the delta values

        absDelta = Math.max(Math.abs(deltaY), Math.abs(deltaX));
        if (!lowestDelta || absDelta < lowestDelta) {
            lowestDelta = absDelta;
            // Adjust older deltas if necessary
            if (shouldAdjustOldDeltas(orgEvent, absDelta)) {
                lowestDelta /= 40;
            }
        }
        // Adjust older deltas if necessary

        if (shouldAdjustOldDeltas(orgEvent, absDelta)) {
            // Divide all the things by 40!
            delta /= 40;
            deltaX /= 40;
            deltaY /= 40;
        }
        // Get a whole, normalized value for the deltas

        delta = Math[delta >= 1 ? 'floor' : 'ceil'](delta / lowestDelta);
        deltaX = Math[deltaX >= 1 ? 'floor' : 'ceil'](deltaX / lowestDelta);
        deltaY = Math[deltaY >= 1 ? 'floor' : 'ceil'](deltaY / lowestDelta);
        // Add information to the event object
        event.deltaX = deltaX;
        event.deltaY = deltaY;
        event.deltaFactor = lowestDelta;
        // Go ahead and set deltaMode to 0 since we converted to pixels
        // Although this is a little odd since we overwrite the deltaX/Y
        // properties with normalized deltas.
        event.deltaMode = 0;
        // Add event and delta to the front of the arguments
        args.unshift(event, delta, deltaX, deltaY);
        // Clearout lowestDelta after sometime to better
        // handle multiple device types that give different
        // a different lowestDelta
        // Ex: trackpad = 3 and mouse wheel = 120
        if (nullLowestDeltaTimeout) {
            clearTimeout(nullLowestDeltaTimeout);
        }
        nullLowestDeltaTimeout = setTimeout(nullLowestDelta, 200);
        return ($.event.dispatch || $.event.handle).apply(this, args);
    }

    function nullLowestDelta() {
        lowestDelta = null;
    }

    function shouldAdjustOldDeltas(orgEvent, absDelta) {
        // If this is an older event and the delta is divisable by 120,
        // then we are assuming that the browser is treating this as an
        // older mouse wheel event and that we should divide the deltas
        // by 40 to try and get a more usable deltaFactor.
        // Side note, this actually impacts the reported scroll distance
        // in older browsers and can cause scrolling to be slower than native.
        // Turn this off by setting $.event.special.mousewheel.settings.adjustOldDeltas to false.
        return special.settings.adjustOldDeltas && orgEvent.type === 'mousewheel' && absDelta % 120 === 0;
    }
}));
/*!
 * jScrollPane - v2.0.19 - 2013-11-16
 * http://jscrollpane.kelvinluck.com/
 *
 * Copyright (c) 2013 Kelvin Luck
 * Dual licensed under the MIT or GPL licenses.
 */
! function(a, b, c) {
    a.fn.jScrollPane = function(d) {
        function e(d, e) {
            function f(b) {
                var e,
                    h,
                    j,
                    l,
                    m,
                    n,
                    q = !1,
                    r = !1;
                if (P = b, Q === c) m = d.scrollTop(),
                    n = d.scrollLeft(),
                    d.css({
                        overflow: 'hidden',
                        padding: 0
                    }),
                    R = d.innerWidth() + tb,
                    S = d.innerHeight(),
                    d.width(R),
                    Q = a('<div class="jspPane" />').css('padding', sb).append(d.children()),
                    T = a('<div class="jspContainer" />').css({
                        width: R + 'px',
                        height: S + 'px'
                    }).append(Q).appendTo(d);
                else {
                    if (d.css('width', ''), q = P.stickToBottom && C(), r = P.stickToRight && D(), l = d.innerWidth() + tb != R || d.outerHeight() != S, l && (R = d.innerWidth() + tb, S = d.innerHeight(), T.css({
                        width: R + 'px',
                        height: S + 'px'
                    })), !l && ub == U && Q.outerHeight() == V) return d.width(R),
                        void 0;
                    ub = U,
                    Q.css('width', ''),
                    d.width(R),
                    T.find('>.jspVerticalBar,>.jspHorizontalBar').remove().end()
                }
                Q.css('overflow', 'auto'),
                U = b.contentWidth ? b.contentWidth : Q[0].scrollWidth,
                V = Q[0].scrollHeight,
                Q.css('overflow', ''),
                W = U / R,
                X = V / S,
                Y = X > 1,
                Z = W > 1,
                Z || Y ? (d.addClass('jspScrollable'), e = P.maintainPosition && (ab || db), e && (h = A(), j = B()), g(), i(), k(), e && (y(r ? U - R : h, !1), x(q ? V - S : j, !1)), H(), E(), N(), P.enableKeyboardNavigation && J(), P.clickOnTrack && o(), L(), P.hijackInternalLinks && M()) : (d.removeClass('jspScrollable'), Q.css({
                    top: 0,
                    left: 0,
                    width: T.width() - tb
                }), F(), I(), K(), p()),
                P.autoReinitialise && !rb ? rb = setInterval(function() {
                    f(P)
                }, P.autoReinitialiseDelay) : !P.autoReinitialise && rb && clearInterval(rb),
                m && d.scrollTop(0) && x(m, !1),
                n && d.scrollLeft(0) && y(n, !1),
                d.trigger('jsp-initialised', [
                    Z || Y
                ])
            }

            function g() {
                Y && (T.append(a('<div class="jspVerticalBar" />').append(a('<div class="jspCap jspCapTop" />'), a('<div class="jspTrack" />').append(a('<div class="jspDrag" />').append(a('<div class="jspDragTop" />'), a('<div class="jspDragBottom" />'))), a('<div class="jspCap jspCapBottom" />'))), eb = T.find('>.jspVerticalBar'), fb = eb.find('>.jspTrack'), $ = fb.find('>.jspDrag'), P.showArrows && (jb = a('<a class="jspArrow jspArrowUp" />').bind('mousedown.jsp', m(0, -1)).bind('click.jsp', G), kb = a('<a class="jspArrow jspArrowDown" />').bind('mousedown.jsp', m(0, 1)).bind('click.jsp', G), P.arrowScrollOnHover && (jb.bind('mouseover.jsp', m(0, -1, jb)), kb.bind('mouseover.jsp', m(0, 1, kb))), l(fb, P.verticalArrowPositions, jb, kb)), hb = S, T.find('>.jspVerticalBar>.jspCap:visible,>.jspVerticalBar>.jspArrow').each(function() {
                    hb -= a(this).outerHeight()
                }), $.hover(function() {
                    $.addClass('jspHover')
                }, function() {
                    $.removeClass('jspHover')
                }).bind('mousedown.jsp', function(b) {
                    a('html').bind('dragstart.jsp selectstart.jsp', G),
                    $.addClass('jspActive');
                    var c = b.pageY - $.position().top;
                    return a('html').bind('mousemove.jsp', function(a) {
                        r(a.pageY - c, !1)
                    }).bind('mouseup.jsp mouseleave.jsp', q), !1
                }), h())
            }

            function h() {
                fb.height(hb + 'px'),
                ab = 0,
                gb = P.verticalGutter + fb.outerWidth(),
                Q.width(R - gb - tb);
                try {
                    0 === eb.position().left && Q.css('margin-left', gb + 'px')
                } catch (a) {}
            }

            function i() {
                Z && (T.append(a('<div class="jspHorizontalBar" />').append(a('<div class="jspCap jspCapLeft" />'), a('<div class="jspTrack" />').append(a('<div class="jspDrag" />').append(a('<div class="jspDragLeft" />'), a('<div class="jspDragRight" />'))), a('<div class="jspCap jspCapRight" />'))), lb = T.find('>.jspHorizontalBar'), mb = lb.find('>.jspTrack'), bb = mb.find('>.jspDrag'), P.showArrows && (pb = a('<a class="jspArrow jspArrowLeft" />').bind('mousedown.jsp', m(-1, 0)).bind('click.jsp', G), qb = a('<a class="jspArrow jspArrowRight" />').bind('mousedown.jsp', m(1, 0)).bind('click.jsp', G), P.arrowScrollOnHover && (pb.bind('mouseover.jsp', m(-1, 0, pb)), qb.bind('mouseover.jsp', m(1, 0, qb))), l(mb, P.horizontalArrowPositions, pb, qb)), bb.hover(function() {
                    bb.addClass('jspHover')
                }, function() {
                    bb.removeClass('jspHover')
                }).bind('mousedown.jsp', function(b) {
                    a('html').bind('dragstart.jsp selectstart.jsp', G),
                    bb.addClass('jspActive');
                    var c = b.pageX - bb.position().left;
                    return a('html').bind('mousemove.jsp', function(a) {
                        t(a.pageX - c, !1)
                    }).bind('mouseup.jsp mouseleave.jsp', q), !1
                }), nb = T.innerWidth(), j())
            }

            function j() {
                T.find('>.jspHorizontalBar>.jspCap:visible,>.jspHorizontalBar>.jspArrow').each(function() {
                    nb -= a(this).outerWidth()
                }),
                mb.width(nb + 'px'),
                db = 0
            }

            function k() {
                if (Z && Y) {
                    var b = mb.outerHeight(),
                        c = fb.outerWidth();
                    hb -= b,
                    a(lb).find('>.jspCap:visible,>.jspArrow').each(function() {
                        nb += a(this).outerWidth()
                    }),
                    nb -= c,
                    S -= c,
                    R -= b,
                    mb.parent().append(a('<div class="jspCorner" />').css('width', b + 'px')),
                    h(),
                    j()
                }
                Z && Q.width(T.outerWidth() - tb + 'px'),
                V = Q.outerHeight(),
                X = V / S,
                Z && (ob = Math.ceil(1 / W * nb), ob > P.horizontalDragMaxWidth ? ob = P.horizontalDragMaxWidth : ob < P.horizontalDragMinWidth && (ob = P.horizontalDragMinWidth), bb.width(ob + 'px'), cb = nb - ob, u(db)),
                Y && (ib = Math.ceil(1 / X * hb), ib > P.verticalDragMaxHeight ? ib = P.verticalDragMaxHeight : ib < P.verticalDragMinHeight && (ib = P.verticalDragMinHeight), $.height(ib + 'px'), _ = hb - ib, s(ab))
            }

            function l(a, b, c, d) {
                var e,
                    f = 'before',
                    g = 'after';
                'os' == b && (b = /Mac/.test(navigator.platform) ? 'after' : 'split'),
                b == f ? g = b : b == g && (f = b, e = c, c = d, d = e),
                a[f](c)[g](d)
            }

            function m(a, b, c) {
                return function() {
                    return n(a, b, this, c),
                        this.blur(), !1
                }
            }

            function n(b, c, d, e) {
                d = a(d).addClass('jspActive');
                var f,
                    g,
                    h = !0,
                    i = function() {
                        0 !== b && vb.scrollByX(b * P.arrowButtonSpeed),
                        0 !== c && vb.scrollByY(c * P.arrowButtonSpeed),
                        g = setTimeout(i, h ? P.initialDelay : P.arrowRepeatFreq),
                        h = !1
                    };
                i(),
                f = e ? 'mouseout.jsp' : 'mouseup.jsp',
                e = e || a('html'),
                e.bind(f, function() {
                    d.removeClass('jspActive'),
                    g && clearTimeout(g),
                    g = null,
                    e.unbind(f)
                })
            }

            function o() {
                p(),
                Y && fb.bind('mousedown.jsp', function(b) {
                    if (b.originalTarget === c || b.originalTarget == b.currentTarget) {
                        var d,
                            e = a(this),
                            f = e.offset(),
                            g = b.pageY - f.top - ab,
                            h = !0,
                            i = function() {
                                var a = e.offset(),
                                    c = b.pageY - a.top - ib / 2,
                                    f = S * P.scrollPagePercent,
                                    k = _ * f / (V - S);
                                if (0 > g) ab - k > c ? vb.scrollByY(-f) : r(c);
                                else {
                                    if (!(g > 0)) return j(),
                                        void 0;
                                    c > ab + k ? vb.scrollByY(f) : r(c)
                                }
                                d = setTimeout(i, h ? P.initialDelay : P.trackClickRepeatFreq),
                                h = !1
                            },
                            j = function() {
                                d && clearTimeout(d),
                                d = null,
                                a(document).unbind('mouseup.jsp', j)
                            };
                        return i(),
                            a(document).bind('mouseup.jsp', j), !1
                    }
                }),
                Z && mb.bind('mousedown.jsp', function(b) {
                    if (b.originalTarget === c || b.originalTarget == b.currentTarget) {
                        var d,
                            e = a(this),
                            f = e.offset(),
                            g = b.pageX - f.left - db,
                            h = !0,
                            i = function() {
                                var a = e.offset(),
                                    c = b.pageX - a.left - ob / 2,
                                    f = R * P.scrollPagePercent,
                                    k = cb * f / (U - R);
                                if (0 > g) db - k > c ? vb.scrollByX(-f) : t(c);
                                else {
                                    if (!(g > 0)) return j(),
                                        void 0;
                                    c > db + k ? vb.scrollByX(f) : t(c)
                                }
                                d = setTimeout(i, h ? P.initialDelay : P.trackClickRepeatFreq),
                                h = !1
                            },
                            j = function() {
                                d && clearTimeout(d),
                                d = null,
                                a(document).unbind('mouseup.jsp', j)
                            };
                        return i(),
                            a(document).bind('mouseup.jsp', j), !1
                    }
                })
            }

            function p() {
                mb && mb.unbind('mousedown.jsp'),
                fb && fb.unbind('mousedown.jsp')
            }

            function q() {
                a('html').unbind('dragstart.jsp selectstart.jsp mousemove.jsp mouseup.jsp mouseleave.jsp'),
                $ && $.removeClass('jspActive'),
                bb && bb.removeClass('jspActive')
            }

            function r(a, b) {
                Y && (0 > a ? a = 0 : a > _ && (a = _), b === c && (b = P.animateScroll), b ? vb.animate($, 'top', a, s) : ($.css('top', a), s(a)))
            }

            function s(a) {
                a === c && (a = $.position().top),
                T.scrollTop(0),
                ab = a;
                var b = 0 === ab,
                    e = ab == _,
                    f = a / _,
                    g = -f * (V - S);
                (wb != b || yb != e) && (wb = b, yb = e, d.trigger('jsp-arrow-change', [
                    wb,
                    yb,
                    xb,
                    zb
                ])),
                v(b, e),
                Q.css('top', g),
                d.trigger('jsp-scroll-y', [-g,
                    b,
                    e
                ]).trigger('scroll')
            }

            function t(a, b) {
                Z && (0 > a ? a = 0 : a > cb && (a = cb), b === c && (b = P.animateScroll), b ? vb.animate(bb, 'left', a, u) : (bb.css('left', a), u(a)))
            }

            function u(a) {
                a === c && (a = bb.position().left),
                T.scrollTop(0),
                db = a;
                var b = 0 === db,
                    e = db == cb,
                    f = a / cb,
                    g = -f * (U - R);
                (xb != b || zb != e) && (xb = b, zb = e, d.trigger('jsp-arrow-change', [
                    wb,
                    yb,
                    xb,
                    zb
                ])),
                w(b, e),
                Q.css('left', g),
                d.trigger('jsp-scroll-x', [-g,
                    b,
                    e
                ]).trigger('scroll')
            }

            function v(a, b) {
                P.showArrows && (jb[a ? 'addClass' : 'removeClass']('jspDisabled'), kb[b ? 'addClass' : 'removeClass']('jspDisabled'))
            }

            function w(a, b) {
                P.showArrows && (pb[a ? 'addClass' : 'removeClass']('jspDisabled'), qb[b ? 'addClass' : 'removeClass']('jspDisabled'))
            }

            function x(a, b) {
                var c = a / (V - S);
                r(c * _, b)
            }

            function y(a, b) {
                var c = a / (U - R);
                t(c * cb, b)
            }

            function z(b, c, d) {
                var e,
                    f,
                    g,
                    h,
                    i,
                    j,
                    k,
                    l,
                    m,
                    n = 0,
                    o = 0;
                try {
                    e = a(b)
                } catch (p) {
                    return
                }
                for (f = e.outerHeight(), g = e.outerWidth(), T.scrollTop(0), T.scrollLeft(0); !e.is('.jspPane');)
                    if (n += e.position().top, o += e.position().left, e = e.offsetParent(), /^body|html$/i.test(e[0].nodeName)) return;
                h = B(),
                j = h + S,
                h > n || c ? l = n - P.horizontalGutter : n + f > j && (l = n - S + f + P.horizontalGutter),
                isNaN(l) || x(l, d),
                i = A(),
                k = i + R,
                i > o || c ? m = o - P.horizontalGutter : o + g > k && (m = o - R + g + P.horizontalGutter),
                isNaN(m) || y(m, d)
            }

            function A() {
                return -Q.position().left
            }

            function B() {
                return -Q.position().top
            }

            function C() {
                var a = V - S;
                return a > 20 && a - B() < 10
            }

            function D() {
                var a = U - R;
                return a > 20 && a - A() < 10
            }

            function E() {
                T.unbind(Bb).bind(Bb, function(a, b, c, d) {
                    var e = db,
                        f = ab,
                        g = a.deltaFactor || P.mouseWheelSpeed;
                    return vb.scrollBy(c * g, -d * g, !1),
                        e == db && f == ab
                })
            }

            function F() {
                T.unbind(Bb)
            }

            function G() {
                return !1
            }

            function H() {
                Q.find(':input,a').unbind('focus.jsp').bind('focus.jsp', function(a) {
                    z(a.target, !1)
                })
            }

            function I() {
                Q.find(':input,a').unbind('focus.jsp')
            }

            function J() {
                function b() {
                    var a = db,
                        b = ab;
                    switch (c) {
                        case 40:
                            vb.scrollByY(P.keyboardSpeed, !1);
                            break;
                        case 38:
                            vb.scrollByY(-P.keyboardSpeed, !1);
                            break;
                        case 34:
                        case 32:
                            vb.scrollByY(S * P.scrollPagePercent, !1);
                            break;
                        case 33:
                            vb.scrollByY(-S * P.scrollPagePercent, !1);
                            break;
                        case 39:
                            vb.scrollByX(P.keyboardSpeed, !1);
                            break;
                        case 37:
                            vb.scrollByX(-P.keyboardSpeed, !1)
                    }
                    return e = a != db || b != ab
                }
                var c,
                    e,
                    f = [];
                Z && f.push(lb[0]),
                Y && f.push(eb[0]),
                Q.focus(function() {
                    d.focus()
                }),
                d.attr('tabindex', 0).unbind('keydown.jsp keypress.jsp').bind('keydown.jsp', function(d) {
                    if (d.target === this || f.length && a(d.target).closest(f).length) {
                        var g = db,
                            h = ab;
                        switch (d.keyCode) {
                            case 40:
                            case 38:
                            case 34:
                            case 32:
                            case 33:
                            case 39:
                            case 37:
                                c = d.keyCode,
                                b();
                                break;
                            case 35:
                                x(V - S),
                                c = null;
                                break;
                            case 36:
                                x(0),
                                c = null
                        }
                        return e = d.keyCode == c && g != db || h != ab, !e
                    }
                }).bind('keypress.jsp', function(a) {
                    return a.keyCode == c && b(), !e
                }), P.hideFocus ? (d.css('outline', 'none'), 'hideFocus' in T[0] && d.attr('hideFocus', !0)) : (d.css('outline', ''), 'hideFocus' in T[0] && d.attr('hideFocus', !1))
            }

            function K() {
                d.attr('tabindex', '-1').removeAttr('tabindex').unbind('keydown.jsp keypress.jsp')
            }

            function L() {
                if (location.hash && location.hash.length > 1) {
                    var b,
                        c,
                        d = escape(location.hash.substr(1));
                    try {
                        b = a('#' + d + ', a[name="' + d + '"]')
                    } catch (e) {
                        return
                    }
                    b.length && Q.find(d) && (0 === T.scrollTop() ? c = setInterval(function() {
                        T.scrollTop() > 0 && (z(b, !0), a(document).scrollTop(T.position().top), clearInterval(c))
                    }, 50) : (z(b, !0), a(document).scrollTop(T.position().top)))
                }
            }

            function M() {
                a(document.body).data('jspHijack') || (a(document.body).data('jspHijack', !0), a(document.body).delegate('a[href*=#]', 'click', function(c) {
                    var d,
                        e,
                        f,
                        g,
                        h,
                        i,
                        j = this.href.substr(0, this.href.indexOf('#')),
                        k = location.href;
                    if (-1 !== location.href.indexOf('#') && (k = location.href.substr(0, location.href.indexOf('#'))), j === k) {
                        d = escape(this.href.substr(this.href.indexOf('#') + 1));
                        try {
                            e = a('#' + d + ', a[name="' + d + '"]')
                        } catch (l) {
                            return
                        }
                        e.length && (f = e.closest('.jspScrollable'), g = f.data('jsp'), g.scrollToElement(e, !0), f[0].scrollIntoView && (h = a(b).scrollTop(), i = e.offset().top, (h > i || i > h + a(b).height()) && f[0].scrollIntoView()), c.preventDefault())
                    }
                }))
            }

            function N() {
                var a,
                    b,
                    c,
                    d,
                    e,
                    f = !1;
                T.unbind('touchstart.jsp touchmove.jsp touchend.jsp click.jsp-touchclick').bind('touchstart.jsp', function(g) {
                    var h = g.originalEvent.touches[0];
                    a = A(),
                    b = B(),
                    c = h.pageX,
                    d = h.pageY,
                    e = !1,
                    f = !0
                }).bind('touchmove.jsp', function(g) {
                    if (f) {
                        var h = g.originalEvent.touches[0],
                            i = db,
                            j = ab;
                        return vb.scrollTo(a + c - h.pageX, b + d - h.pageY),
                            e = e || Math.abs(c - h.pageX) > 5 || Math.abs(d - h.pageY) > 5,
                            i == db && j == ab
                    }
                }).bind('touchend.jsp', function() {
                    f = !1
                }).bind('click.jsp-touchclick', function() {
                    return e ? (e = !1, !1) : void 0
                })
            }

            function O() {
                var a = B(),
                    b = A();
                d.removeClass('jspScrollable').unbind('.jsp'),
                d.replaceWith(Ab.append(Q.children())),
                Ab.scrollTop(a),
                Ab.scrollLeft(b),
                rb && clearInterval(rb)
            }
            var P,
                Q,
                R,
                S,
                T,
                U,
                V,
                W,
                X,
                Y,
                Z,
                $,
                _,
                ab,
                bb,
                cb,
                db,
                eb,
                fb,
                gb,
                hb,
                ib,
                jb,
                kb,
                lb,
                mb,
                nb,
                ob,
                pb,
                qb,
                rb,
                sb,
                tb,
                ub,
                vb = this,
                wb = !0,
                xb = !0,
                yb = !1,
                zb = !1,
                Ab = d.clone(!1, !1).empty(),
                Bb = a.fn.mwheelIntent ? 'mwheelIntent.jsp' : 'mousewheel.jsp';
            'border-box' === d.css('box-sizing') ? (sb = 0, tb = 0) : (sb = d.css('paddingTop') + ' ' + d.css('paddingRight') + ' ' + d.css('paddingBottom') + ' ' + d.css('paddingLeft'), tb = (parseInt(d.css('paddingLeft'), 10) || 0) + (parseInt(d.css('paddingRight'), 10) || 0)),
            a.extend(vb, {
                reinitialise: function(b) {
                    b = a.extend({}, P, b),
                    f(b)
                },
                scrollToElement: function(a, b, c) {
                    z(a, b, c)
                },
                scrollTo: function(a, b, c) {
                    y(a, c),
                    x(b, c)
                },
                scrollToX: function(a, b) {
                    y(a, b)
                },
                scrollToY: function(a, b) {
                    x(a, b)
                },
                scrollToPercentX: function(a, b) {
                    y(a * (U - R), b)
                },
                scrollToPercentY: function(a, b) {
                    x(a * (V - S), b)
                },
                scrollBy: function(a, b, c) {
                    vb.scrollByX(a, c),
                    vb.scrollByY(b, c)
                },
                scrollByX: function(a, b) {
                    var c = A() + Math[0 > a ? 'floor' : 'ceil'](a),
                        d = c / (U - R);
                    t(d * cb, b)
                },
                scrollByY: function(a, b) {
                    var c = B() + Math[0 > a ? 'floor' : 'ceil'](a),
                        d = c / (V - S);
                    r(d * _, b)
                },
                positionDragX: function(a, b) {
                    t(a, b)
                },
                positionDragY: function(a, b) {
                    r(a, b)
                },
                animate: function(a, b, c, d) {
                    var e = {};
                    e[b] = c,
                    a.animate(e, {
                        duration: P.animateDuration,
                        easing: P.animateEase,
                        queue: !1,
                        step: d
                    })
                },
                getContentPositionX: function() {
                    return A()
                },
                getContentPositionY: function() {
                    return B()
                },
                getContentWidth: function() {
                    return U
                },
                getContentHeight: function() {
                    return V
                },
                getPercentScrolledX: function() {
                    return A() / (U - R)
                },
                getPercentScrolledY: function() {
                    return B() / (V - S)
                },
                getIsScrollableH: function() {
                    return Z
                },
                getIsScrollableV: function() {
                    return Y
                },
                getContentPane: function() {
                    return Q
                },
                scrollToBottom: function(a) {
                    r(_, a)
                },
                hijackInternalLinks: a.noop,
                destroy: function() {
                    O()
                }
            }),
            f(e)
        }
        return d = a.extend({}, a.fn.jScrollPane.defaults, d),
            a.each(['arrowButtonSpeed',
                'trackClickSpeed',
                'keyboardSpeed'
            ], function() {
                d[this] = d[this] || d.speed
            }),
            this.each(function() {
                var b = a(this),
                    c = b.data('jsp');
                c ? c.reinitialise(d) : (a('script', b).filter('[type="text/javascript"],:not([type])').remove(), c = new e(b, d), b.data('jsp', c))
            })
    },
    a.fn.jScrollPane.defaults = {
        showArrows: !1,
        maintainPosition: !0,
        stickToBottom: !1,
        stickToRight: !1,
        clickOnTrack: !0,
        autoReinitialise: !1,
        autoReinitialiseDelay: 500,
        verticalDragMinHeight: 0,
        verticalDragMaxHeight: 99999,
        horizontalDragMinWidth: 0,
        horizontalDragMaxWidth: 99999,
        contentWidth: c,
        animateScroll: !1,
        animateDuration: 300,
        animateEase: 'linear',
        hijackInternalLinks: !1,
        verticalGutter: 4,
        horizontalGutter: 4,
        mouseWheelSpeed: 3,
        arrowButtonSpeed: 0,
        arrowRepeatFreq: 50,
        arrowScrollOnHover: !1,
        trackClickSpeed: 0,
        trackClickRepeatFreq: 70,
        verticalArrowPositions: 'split',
        horizontalArrowPositions: 'split',
        enableKeyboardNavigation: !0,
        hideFocus: !1,
        keyboardSpeed: 0,
        initialDelay: 300,
        speed: 30,
        scrollPagePercent: 0.8
    }
}(jQuery, this);
var indexedDB = window.indexedDB || window.mozIndexedDB || window.webkitIndexedDB || window.msIndexedDB;
window.IDBTransaction = window.IDBTransaction || window.webkitIDBTransaction || window.OIDBTransaction || window.msIDBTransaction;
window.IDBKeyRange = window.IDBKeyRange || window.webkitIDBKeyRange || window.msIDBKeyRange;
var mDBact,
    mDBv = 6;
if (indexedDB) {
    var mDB = 1;
    var request;
    var mDBStartError;

    function mDBfetch() {
        if (d) console.log('mDBfetch()');
        mDBcount('f', function(c) {
            if (c == 0) {
                delete localStorage[u_handle + '_mDBcount'];
                mDBt = {};
                mDBqueue = {};
                loadfm();
            } else mDBreload();
        });
    }

    function mDBactive(act) {
        if (act !== mDBact) return;
        localStorage[u_handle + '_mDBactive'] = new Date().getTime();
        setTimeout(mDBactive, 500, act);
    }

    function mDBstart() {
        function rOnError(event) {
            if (d) console.log('mDB error', event);
            if (mDB) {
                mDB = undefined;
                loadfm();
            }
        }
        if (localStorage[u_handle + '_mDBactive'] && parseInt(localStorage[u_handle + '_mDBactive']) + 1000 > new Date().getTime()) {
            if (d) console.log('existing mDB session, fetch live data');
            mDB = undefined;
            loadfm();
            return;
        }
        mDBact = Math.random();
        mDBactive(mDBact);
        loadingDialog.show();
        if (d) console.log('mDBstart()');
        setTimeout(function() {
            if (mDB === 1) {
                if (d) console.log('mDBstart timeout (2000ms), fetching live data');
                mDB = undefined;
                loadfm();
            }
        }, 2000);
        try {
            request = indexedDB.open('MEGA_' + u_handle, 2);
        } catch (e) {
            if (!mDBStartError) {
                console.error('mDB.open error', e);
                mDBreload();
            } else rOnError(e);
            mDBStartError = 1;
            return;
        }
        mDBStartError = 0;
        request.onerror = rOnError;
        request.onblocked = function(event) {
            if (d) console.log('mDB blocked', event);
            if (mDB) {
                mDB = undefined;
                loadfm();
            }
        }
        request.onsuccess = function(event) {
            if (!mDB) return false;
            mDB = request.result;
            if (localStorage[u_handle + '_mDBcount'] && (!localStorage[u_handle + '_mDBv'] || parseInt(localStorage[u_handle + '_mDBv']) < mDBv)) {
                if (d) console.log('mDB version change, fetch live site for new mDB');
                localStorage[u_handle + '_mDBv'] = mDBv;
                mDBact = false;
                mDBreload();
                return false;
            }
            if (d) console.log('mDB success');
            if (localStorage[u_handle + '_mDBcount'] && localStorage[u_handle + '_mDBcount'] == 0 && localStorage[u_handle + '_maxaction']) {
                mDBcount('f', function(c) {
                    if (c == 0) mDBfetch();
                    else {
                        loadingDialog.show();
                        mDBquery('ok');
                    }
                });
            } else {
                if (d) console.log('fetching live data');
                mDBfetch();
            }
        };
        request.onupgradeneeded = function(event) {
            if (d) console.log('onupgradeend');
            var db = event.target.result;
            db.createObjectStore('f', {
                keyPath: 'h'
            });
            db.createObjectStore('ok', {
                keyPath: 'h'
            });
            db.createObjectStore('s', {
                keyPath: 'h_u'
            });
            db.createObjectStore('u', {
                keyPath: 'u'
            });
        };
    }
    var mDBqueue = {};

    function mDBadd(t, n) {
        var a = n;
        if (a.name && a.p !== 'contacts') delete a.name;
        if (a.ar && a.p !== 'contacts') delete a.ar;
        if (a.key) delete a.key;
        mDBaddQueue(t, {
            a: a
        });
    }
    var Qt;
    var mDBt = {};

    function mDBprocess() {
        if (!Qt) Qt = new Date().getTime();
        for (var t in mDBqueue) {
            for (var i in mDBqueue[t]) {
                if (mDBqueue[t][i]) {
                    if (mDBt.t !== t) {
                        mDBt.t = t;
                        mDBt.transation = mDB.transaction([t], 'readwrite');
                    }
                    var objectStore = mDBt.transation.objectStore(t);
                    if (mDBqueue[t][i].a) var request = objectStore.put(mDBqueue[t][i].a);
                    else if (mDBqueue[t][i].d) var request = objectStore.delete(mDBqueue[t][i].d);
                    request.onsuccess = function(event) {
                        if (parseInt(localStorage[u_handle + '_mDBcount']) > 0) localStorage[u_handle + '_mDBcount']--;
                        mDBprocess();
                    };
                    request.onerror = function(event) {
                        if (d) console.log('error', event);
                        mDBprocess();
                    };
                    delete mDBqueue[t][i];
                    return;
                }
            }
        }
        if (d) console.log('Qt', Qt - new Date().getTime());
        mDBt = {};
        mDBqueue = {};
    }

    function mDBaddQueue(t, obj) {
        if (!localStorage[u_handle + '_mDBcount']) localStorage[u_handle + '_mDBcount'] = 0;
        localStorage[u_handle + '_mDBcount']++;
        if (!mDBqueue[t]) mDBqueue[t] = [];
        mDBqueue[t].push(obj);
        if (!mDBt.t) mDBprocess();
    }

    function mDBdel(t, id) {
        mDBaddQueue(t, {
            d: id
        });
    }

    function mDBcount(t, callback) {
        var request = mDB.transaction([t], 'readwrite').objectStore(t).count();
        request.onsuccess = function(event) {
            if (d) console.log('mDBcount', event.target.result);
            if (callback) callback(event.target.result);
        };
        request.onerror = function() {
            mDBfetch();
        };
    }

    function mDBquery(t) {
        if (d) console.log('mDBquery()');
        var fr,
            dt = t;
        if (t == 'f_sk') dt = 'f';
        var objectStore = mDB.transaction(dt, 'readonly').objectStore(dt);
        objectStore.openCursor().onsuccess = function(event) {
            var rec = event.target.result;
            if (rec) {
                var value;
                try {
                    value = rec.value;
                } catch (e) {
                    if (d) console.error('mDBquery', t, e);
                }
                if (typeof value === 'undefined') fr = true;
                else if (t == 'ok') process_ok([rec.value]);
                else if (t == 'f') M.addNode(rec.value, 1);
                else if (t == 'f_sk') {
                    var n = rec.value;
                    if (n.sk) u_sharekeys[n.h] = crypto_process_sharekey(n.h, n.sk);
                } else if (t == 'u') M.addUser(rec.value, 1);
                else if (t == 's') M.nodeShare(rec.value.h, rec.value, 1);
                rec.continue();
            } else if (fr) {
                if (d) console.log('mDBquery: forcing reload');
                mDBreload();
            } else {
                if (d) console.log('mDBloaded', t);
                mDBloaded[t] = 1;
                for (var dbt in mDBloaded) {
                    if (mDBloaded[dbt] == 0) {
                        mDBquery(dbt);
                        return false;
                    }
                }
                maxaction = localStorage[u_handle + '_maxaction'];
                for (var i in M.d) {
                    var entries = true;
                    break;
                }
                if (!maxaction || typeof entries == 'undefined') mDBreload();
                else getsc(1);
            }
        };
    }

    function mDBclear(callback) {
        mDB.close();
        var dbreq = indexedDB.deleteDatabase('MEGA_' + u_handle);
        dbreq.callback = callback;
        dbreq.onsuccess = function(event) {
            if (d) console.log('db deleted');
            if (dbreq.callback) dbreq.callback();
        };
    }

    function mDBreload() {
        if (mDB && mDB.close) mDB.close();
        mDB = 2;
        setTimeout(function() {
            if (mDB === 2) {
                if (d) console.log('mDBreload timeout (2000ms), fetching live data');
                mDB = undefined;
                loadfm();
            }
        }, 2000);
        var dbreq = indexedDB.deleteDatabase('MEGA_' + u_handle);
        dbreq.onsuccess = function(event) {
            if (d) console.log('db deleted');
            mDBrestart();
        };
        dbreq.onerror = function(event) {
            mDBrestart();
        };
    }

    function mDBrestart() {
        if (mDB) {
            delete localStorage[u_handle + '_mDBcount'];
            delete localStorage[u_handle + '_maxaction'];
            delete localStorage[u_handle + '_mDBactive'];
            mDBact = Math.random();
            mDBloaded = {
                'ok': 0,
                'u': 0,
                'f_sk': 0,
                'f': 0,
                's': 0
            };
            Qt = undefined;
            request = undefined;
            mDB = 1;
            mDBstart();
        }
    }
    var mDBloaded = {
        'ok': 0,
        'u': 0,
        'f_sk': 0,
        'f': 0,
        's': 0
    };
}

function createnodethumbnail(node, aes, id, imagedata, opt) {
    storedattr[id] = {};
    storedattr[id] = {
        target: node
    };
    createthumbnail(false, aes, id, imagedata, node, opt);
}

function createthumbnail(file, aes, id, imagedata, node, opt) {
    if (myURL) {
        var onPreviewRetry,
            isRawImage;
        if (typeof opt === 'object') {
            isRawImage = opt.raw;
            onPreviewRetry = opt.onPreviewRetry;
            if (d && isRawImage) console.log('Processing RAW Image: ' + isRawImage);
            ASSERT(!isRawImage || typeof dcraw !== 'undefined', 'DCRAW is unavailale.');
        } else onPreviewRetry = !!opt;
        if (d) console.time('createthumbnail');
        var img = new Image();
        img.id = id;
        img.aes = aes;
        img.onload = function() {
            var t = new Date().getTime();
            var n = M.d[node];
            var fa = '' + (n && n.fa);
            // thumbnail:
            if (fa.indexOf(':0*') < 0) {
                var options = {
                    width: 120,
                    height: 120
                };
                if (d) console.time('smartcrop');
                var crop = SmartCrop.crop(this, options).topCrop;
                var canvas = document.createElement('canvas');
                var ctx = canvas.getContext('2d');
                canvas.width = options.width;
                canvas.height = options.height;
                ctx.drawImage(this, crop.x, crop.y, crop.width, crop.height, 0, 0, canvas.width, canvas.height);
                var ab = dataURLToAB(canvas.toDataURL('image/jpeg', 0.9));
                api_storefileattr(this.id, 0, this.aes.c[0].slice(0, 4), ab.buffer); // FIXME hack into cipher and extract key
                if (d) console.timeEnd('smartcrop');
            }
            if (0 && fa.indexOf(':0*') < 0) {
                var canvas = document.createElement('canvas');
                var sx = 0;
                var sy = 0;
                var x = this.width;
                var y = this.height;
                if (d) console.log(x + ' by ' + y);
                if (this.width > this.height) {
                    if (d) console.log('landscape');
                    sx = Math.floor((this.width - this.height) / 2);
                    x = y;
                } else if (this.height > this.width) {
                    if (d) console.log('portrait');
                    sy = Math.floor((this.height - this.width) * 0.66 / 2);
                    y = x;
                } else {
                    if (d) console.log('square');
                }
                var ctx = canvas.getContext('2d');
                canvas.width = 120;
                canvas.height = 120;
                ctx.drawImage(this, sx, sy, x, y, 0, 0, 120, 120);
                if (d) console.log('resizing time:', new Date().getTime() - t);
                var dataURI = canvas.toDataURL('image/jpeg', 0.85);
                var ab = dataURLToAB(dataURI);
                api_storefileattr(this.id, 0, this.aes.c[0].slice(0, 4), ab.buffer); // FIXME hack into cipher and extract key
            }
            // preview image:

            if (fa.indexOf(':1*') < 0 || onPreviewRetry) {
                var canvas2 = document.createElement('canvas');
                var preview_x = this.width,
                    preview_y = this.height;
                if (preview_x > 1000) {
                    preview_y = Math.round(preview_y * 1000 / preview_x);
                    preview_x = 1000;
                } else if (preview_y > 1000) {
                    preview_x = Math.round(preview_x * 1000 / preview_y);
                    preview_y = 1000;
                }
                var ctx2 = canvas2.getContext('2d');
                canvas2.width = preview_x;
                canvas2.height = preview_y;
                ctx2.drawImage(this, 0, 0, preview_x, preview_y);
                var dataURI2 = canvas2.toDataURL('image/jpeg', 0.85);
                var ab2 = dataURLToAB(dataURI2);
                // only store preview when the user is the file owner, and when it's not a retry (because then there is already a preview image, it's just unavailable:
                if (!onPreviewRetry && (!n || n.u == u_handle) && fa.indexOf(':1*') < 0) {
                    if (d) console.log('Storing preview...', n);
                    api_storefileattr(this.id, 1, this.aes.c[0].slice(0, 4), ab2.buffer); // FIXME hack into cipher and extract key
                }
                if (node) previewimg(node, ab2);
                if (d) console.log('total time:', new Date().getTime() - t);
            }
            if (d) console.timeEnd('createthumbnail');
        };
        img.onerror = function(e) {
            if (d) {
                console.error('createthumbnail error', e);
                console.timeEnd('createthumbnail');
            }
        };
        try {
            if (typeof FileReader !== 'undefined') {
                var ThumbFR = new FileReader();
                ThumbFR.onload = function(e) {
                    var u8 = new Uint8Array(ThumbFR.result),
                        orientation;
                    if (isRawImage) {
                        var FS = dcraw.FS,
                            run = dcraw.run,
                            thumbData;
                        var filename = file.name || (Math.random() * Date.now()).toString(36) + '.' + isRawImage;
                        try {
                            var cwd = '/MEGA-' + Date.now();
                            FS.mkdir(cwd);
                            FS.chdir(cwd);
                            if (d) console.time('dcraw-load');
                            var data = FS.createDataFile('.', filename, u8, true, false);
                            if (d) console.timeEnd('dcraw-load');
                            if (d) console.time('dcraw-proc');
                            if (d) run(['-i',
                                '-v',
                                filename
                            ]);
                            run(['-e',
                                filename
                            ]);
                            if (d) console.timeEnd('dcraw-proc');
                        } catch (e) {
                            if (d) console.error('dcraw error', e);
                        } finally {
                            try {
                                FS.unlink(filename);
                            } catch (e) {
                                if (e.code !== 'ENOENT') console.error('FS.unlink error', e);
                            }
                        }
                        var thumb = filename.substr(0, filename.lastIndexOf('.'));
                        try {
                            thumbData = FS.readFile(thumb + '.thumb.jpg');
                        } catch (e) {
                            if (e.code !== 'ENOENT') console.error('FS.readFile error', e);
                            try {
                                var ppm = FS.readFile(thumb + '.thumb.ppm');
                                thumbData = ppmtojpeg(ppm);
                            } catch (e) {
                                if (e.code !== 'ENOENT') console.error('FS.readFile error', e);
                            }
                        }
                        if (thumbData) file = new Blob([thumbData], {
                            type: 'image/jpg'
                        });
                        try {
                            FS.readdir('.').map(function(n) {
                                n != '.' && n != '..' && FS.unlink(n)
                            });
                            FS.readdir('/tmp').map(function(n) {
                                n != '.' && n != '..' && FS.unlink('/tmp/' + n)
                            });
                            FS.chdir('..');
                            FS.rmdir(cwd);
                        } catch (e) {
                            if (d) console.error('dcraw error', e);
                        }
                        switch (isRawImage) {
                            // TODO: add other suitable formats
                            case 'PEF':
                                orientation = +u8[115];
                                break;
                        }
                    }
                    if (undefined == orientation || orientation < 1 || orientation > 8) {
                        if (d) console.time('exif');
                        var exif = EXIF.getImageData(new BinaryFile(u8), true);
                        orientation = +exif.Orientation || 1;
                        if (d) console.timeEnd('exif');
                        if (d) console.debug('EXIF', exif, orientation);
                    }
                    var mpImg = new MegaPixImage(file);
                    mpImg.render(img, {
                        maxWidth: 1000,
                        maxHeight: 1000,
                        quality: 0.96,
                        orientation: orientation
                    });
                };
                if (file) {
                    if (is_chrome_firefox && 'blob' in file) {
                        if (file.size > 2000000) try {
                            return OS.File.read(file.mozFile.path).then(function(u8) {
                                file = new Blob([u8], {
                                    type: file.type
                                });
                                ThumbFR.readAsArrayBuffer(file);
                            });
                        } catch (e) {}
                        file = file.blob();
                    }
                } else {
                    file = new Blob([new Uint8Array(imagedata)], {
                        type: 'image/jpeg'
                    });
                }
                ThumbFR.readAsArrayBuffer(file);
            }
        } catch (e) {
            console.log('thumbnail error', e)
        }
    }
}

function ppmtojpeg(ppm) {
    var jpeg;
    if (ppm[0] == 80 && ppm[1] == 54) // P6
    {
        var dim = '',
            i = 2,
            j;
        if (d) console.time('ppmtojpeg');
        while (ppm[++i] != 10) dim += String.fromCharCode(ppm[i]);
        dim = dim.split(' ').map(Number);
        if (ppm[i + 1] == 50 && ppm[i + 2] == 53 && ppm[i + 3] == 53) // 255
        {
            ppm = ppm.subarray(i + 5);
            var canvas = document.createElement('canvas');
            canvas.width = dim[0];
            canvas.height = dim[1];
            var ctx = canvas.getContext('2d');
            var imageData = ctx.createImageData(canvas.width, canvas.height);
            var ppmLen = ppm.byteLength,
                iLen = canvas.width * canvas.height * 4;
            i = 0;
            j = 0;
            while (i < ppmLen && j < iLen) {
                imageData.data[j] = ppm[i]; // R
                imageData.data[j + 1] = ppm[i + 1]; // G
                imageData.data[j + 2] = ppm[i + 2]; // B
                imageData.data[j + 3] = 190; // A
                j += 4;
                i += 3;
            }
            ctx.putImageData(imageData, 0, 0);
            jpeg = dataURLToAB(canvas.toDataURL('image/png', 0.9));
        }
        if (d) console.timeEnd('ppmtojpeg');
    }
    return jpeg;
}

function dataURLToAB(dataURL) {
    if (dataURL.indexOf(';base64,') == -1) {
        var parts = dataURL.split(',');
        var contentType = parts[0].split(':')[1];
        var raw = parts[1];
    } else {
        var parts = dataURL.split(';base64,');
        var contentType = parts[0].split(':')[1];
        var raw = window.atob(parts[1]);
    }
    var rawLength = raw.length;
    var uInt8Array = new Uint8Array(((rawLength + 15) & -16));
    for (var i = 0; i < rawLength; ++i) uInt8Array[i] = raw.charCodeAt(i);
    return uInt8Array;
}
var ba_images = [],
    ba_time = 0,
    ba_id = 0,
    ba_result = [];

function benchmarki() {
    var a = 0;
    ba_images = [];
    for (var i in M.d) {
        if (M.d[i].name && is_image(M.d[i].name) && M.d[i].fa) {
            ba_images.push(M.d[i]);
        } else a++;
    }
    console.log('found ' + ba_images.length + ' images with file attr (' + a + ' don\'t have file attributes)');
    ba_images = shuffle(ba_images);
    ba_result['success'] = 0;
    ba_result['error'] = 0;
    benchmarkireq();
}

function shuffle(array) {
    var currentIndex = array.length,
        temporaryValue,
        randomIndex;
    // While there remain elements to shuffle...
    while (0 !== currentIndex) {
        // Pick a remaining element...
        randomIndex = Math.floor(Math.random() * currentIndex);
        currentIndex -= 1;
        // And swap it with the current element.
        temporaryValue = array[currentIndex];
        array[currentIndex] = array[randomIndex];
        array[randomIndex] = temporaryValue;
    }
    return array;
}

function benchmarkireq() {
    ba_time = new Date().getTime();

    function eot(id, err) {
        for (var i in ba_images) {
            if (ba_images[i].h == id) {
                ba_result['error']++;
                console.log('error', new Date().getTime() - ba_time, err);
                console.log(ba_images[i].fa);
                ba_id++;
                benchmarkireq();
            }
        }
    }
    eot.timeout = 5100;
    var n = ba_images[ba_id];
    if (n) {
        var treq = {};
        treq[n.h] = {
            fa: n.fa,
            k: n.key
        };
        api_getfileattr(treq, 1, function(ctx, id, uint8arr) {
            for (var i in ba_images) {
                if (ba_images[i].h == id) {
                    ba_result['success']++;
                    console.log('success', uint8arr.length, new Date().getTime() - ba_time);
                    ba_id++;
                    benchmarkireq();
                    previewsrc(myURL.createObjectURL(new Blob([uint8arr], {
                        type: 'image/jpeg'
                    })));
                }
            }
        }, eot);
    } else {
        console.log('ready');
    }
}
var BinaryFile = function(strData, iDataOffset, iDataLength) {
    var data = strData;
    var dataOffset = iDataOffset || 0;
    var dataLength = 0;
    this.getRawData = function() {
        return data;
    }
    if (data instanceof ArrayBuffer || data instanceof Uint8Array) {
        var dv = new DataView(data.buffer || data, dataOffset);
        dataLength = iDataLength || data.byteLength;
        this.getByteAt = function(iOffset) {
            return dv.getUint8(iOffset);
        }
        this.getBytesAt = function(iOffset, iLength) {
            var aBytes = [];
            for (var i = 0; i < iLength; i++) {
                aBytes[i] = dv.getUint8(iOffset + i);
            };
            return aBytes;
        }
        this.getShortAt = function(iOffset, bBigEndian) {
            return dv.getUint16(iOffset, !bBigEndian);
        };
        this.getLongAt = function(iOffset, bBigEndian) {
            return dv.getUint32(iOffset, !bBigEndian);
        };
        this.isTypedArray = true;
    } else if (typeof strData == 'string') {
        dataLength = iDataLength || data.length;
        this.getByteAt = function(iOffset) {
            return data.charCodeAt(iOffset + dataOffset) & 255;
        }
        this.getBytesAt = function(iOffset, iLength) {
            var aBytes = [];
            for (var i = 0; i < iLength; i++) {
                aBytes[i] = data.charCodeAt((iOffset + i) + dataOffset) & 255
            };
            return aBytes;
        }
    } else if (typeof strData == 'unknown') {
        dataLength = iDataLength || IEBinary_getLength(data);
        this.getByteAt = function(iOffset) {
            return IEBinary_getByteAt(data, iOffset + dataOffset);
        }
        this.getBytesAt = function(iOffset, iLength) {
            return new VBArray(IEBinary_getBytesAt(data, iOffset + dataOffset, iLength)).toArray();
        }
    } else {
        throw new Error('BinaryFile: Unknown datatype.');
    }
    this.getLength = function() {
        return dataLength;
    }
    this.getSByteAt = function(iOffset) {
        var iByte = this.getByteAt(iOffset);
        if (iByte > 127)
            return iByte - 256;
        else
            return iByte;
    }
    if (!this.getShortAt) this.getShortAt = function(iOffset, bBigEndian) {
        var iShort = bBigEndian ? (this.getByteAt(iOffset) << 8) + this.getByteAt(iOffset + 1) : (this.getByteAt(iOffset + 1) << 8) + this.getByteAt(iOffset)
        if (iShort < 0) iShort += 65536;
        return iShort;
    }
    this.getSShortAt = function(iOffset, bBigEndian) {
        var iUShort = this.getShortAt(iOffset, bBigEndian);
        if (iUShort > 32767)
            return iUShort - 65536;
        else
            return iUShort;
    }
    if (!this.getLongAt) this.getLongAt = function(iOffset, bBigEndian) {
        var iByte1 = this.getByteAt(iOffset),
            iByte2 = this.getByteAt(iOffset + 1),
            iByte3 = this.getByteAt(iOffset + 2),
            iByte4 = this.getByteAt(iOffset + 3);
        var iLong = bBigEndian ? (((((iByte1 << 8) + iByte2) << 8) + iByte3) << 8) + iByte4 : (((((iByte4 << 8) + iByte3) << 8) + iByte2) << 8) + iByte1;
        if (iLong < 0) iLong += 4294967296;
        return iLong;
    }
    this.getSLongAt = function(iOffset, bBigEndian) {
        var iULong = this.getLongAt(iOffset, bBigEndian);
        if (iULong > 2147483647)
            return iULong - 4294967296;
        else
            return iULong;
    }
    this.getStringAt = function(iOffset, iLength) {
        var aStr = [];
        var aBytes = this.getBytesAt(iOffset, iLength);
        for (var j = 0; j < iLength; j++) {
            aStr[j] = String.fromCharCode(aBytes[j]);
        }
        return aStr.join('');
    }
    this.getCharAt = function(iOffset) {
        return String.fromCharCode(this.getByteAt(iOffset));
    }
    this.toBase64 = function() {
        return window.btoa(data);
    }
    this.fromBase64 = function(strBase64) {
        data = window.atob(strBase64);
    }
}
var EXIF = (function() {
    var debug = !!window.d;
    var ExifTags = {
        // version tags
        36864: 'ExifVersion', // EXIF version
        40960: 'FlashpixVersion', // Flashpix format version
        // colorspace tags
        40961: 'ColorSpace', // Color space information tag
        // image configuration
        40962: 'PixelXDimension', // Valid width of meaningful image
        40963: 'PixelYDimension', // Valid height of meaningful image
        37121: 'ComponentsConfiguration', // Information about channels
        37122: 'CompressedBitsPerPixel', // Compressed bits per pixel
        // user information
        37500: 'MakerNote', // Any desired information written by the manufacturer
        37510: 'UserComment', // Comments by user
        // related file
        40964: 'RelatedSoundFile', // Name of related sound file
        // date and time
        36867: 'DateTimeOriginal', // Date and time when the original image was generated
        36868: 'DateTimeDigitized', // Date and time when the image was stored digitally
        37520: 'SubsecTime', // Fractions of seconds for DateTime
        37521: 'SubsecTimeOriginal', // Fractions of seconds for DateTimeOriginal
        37522: 'SubsecTimeDigitized', // Fractions of seconds for DateTimeDigitized
        // picture-taking conditions
        33434: 'ExposureTime', // Exposure time (in seconds)
        33437: 'FNumber', // F number
        34850: 'ExposureProgram', // Exposure program
        34852: 'SpectralSensitivity', // Spectral sensitivity
        34855: 'ISOSpeedRatings', // ISO speed rating
        34856: 'OECF', // Optoelectric conversion factor
        37377: 'ShutterSpeedValue', // Shutter speed
        37378: 'ApertureValue', // Lens aperture
        37379: 'BrightnessValue', // Value of brightness
        37380: 'ExposureBias', // Exposure bias
        37381: 'MaxApertureValue', // Smallest F number of lens
        37382: 'SubjectDistance', // Distance to subject in meters
        37383: 'MeteringMode', // Metering mode
        37384: 'LightSource', // Kind of light source
        37385: 'Flash', // Flash status
        37396: 'SubjectArea', // Location and area of main subject
        37386: 'FocalLength', // Focal length of the lens in mm
        41483: 'FlashEnergy', // Strobe energy in BCPS
        41484: 'SpatialFrequencyResponse',
        41486: 'FocalPlaneXResolution', // Number of pixels in width direction per FocalPlaneResolutionUnit
        41487: 'FocalPlaneYResolution', // Number of pixels in height direction per FocalPlaneResolutionUnit
        41488: 'FocalPlaneResolutionUnit', // Unit for measuring FocalPlaneXResolution and FocalPlaneYResolution
        41492: 'SubjectLocation', // Location of subject in image
        41493: 'ExposureIndex', // Exposure index selected on camera
        41495: 'SensingMethod', // Image sensor type
        41728: 'FileSource', // Image source (3 == DSC)
        41729: 'SceneType', // Scene type (1 == directly photographed)
        41730: 'CFAPattern', // Color filter array geometric pattern
        41985: 'CustomRendered', // Special processing
        41986: 'ExposureMode', // Exposure mode
        41987: 'WhiteBalance', // 1 = auto white balance, 2 = manual
        41988: 'DigitalZoomRation', // Digital zoom ratio
        41989: 'FocalLengthIn35mmFilm', // Equivalent foacl length assuming 35mm film camera (in mm)
        41990: 'SceneCaptureType', // Type of scene
        41991: 'GainControl', // Degree of overall image gain adjustment
        41992: 'Contrast', // Direction of contrast processing applied by camera
        41993: 'Saturation', // Direction of saturation processing applied by camera
        41994: 'Sharpness', // Direction of sharpness processing applied by camera
        41995: 'DeviceSettingDescription',
        41996: 'SubjectDistanceRange', // Distance to subject
        // other tags
        40965: 'InteroperabilityIFDPointer',
        42016: 'ImageUniqueID' // Identifier assigned uniquely to each image
    };
    var TiffTags = {
        256: 'ImageWidth',
        257: 'ImageHeight',
        34665: 'ExifIFDPointer',
        34853: 'GPSInfoIFDPointer',
        40965: 'InteroperabilityIFDPointer',
        258: 'BitsPerSample',
        259: 'Compression',
        262: 'PhotometricInterpretation',
        274: 'Orientation',
        277: 'SamplesPerPixel',
        284: 'PlanarConfiguration',
        530: 'YCbCrSubSampling',
        531: 'YCbCrPositioning',
        282: 'XResolution',
        283: 'YResolution',
        296: 'ResolutionUnit',
        273: 'StripOffsets',
        278: 'RowsPerStrip',
        279: 'StripByteCounts',
        513: 'JPEGInterchangeFormat',
        514: 'JPEGInterchangeFormatLength',
        301: 'TransferFunction',
        318: 'WhitePoint',
        319: 'PrimaryChromaticities',
        529: 'YCbCrCoefficients',
        532: 'ReferenceBlackWhite',
        306: 'DateTime',
        270: 'ImageDescription',
        271: 'Make',
        272: 'Model',
        305: 'Software',
        315: 'Artist',
        33432: 'Copyright'
    };
    var GPSTags = {
        0: 'GPSVersionID',
        1: 'GPSLatitudeRef',
        2: 'GPSLatitude',
        3: 'GPSLongitudeRef',
        4: 'GPSLongitude',
        5: 'GPSAltitudeRef',
        6: 'GPSAltitude',
        7: 'GPSTimeStamp',
        8: 'GPSSatellites',
        9: 'GPSStatus',
        10: 'GPSMeasureMode',
        11: 'GPSDOP',
        12: 'GPSSpeedRef',
        13: 'GPSSpeed',
        14: 'GPSTrackRef',
        15: 'GPSTrack',
        16: 'GPSImgDirectionRef',
        17: 'GPSImgDirection',
        18: 'GPSMapDatum',
        19: 'GPSDestLatitudeRef',
        20: 'GPSDestLatitude',
        21: 'GPSDestLongitudeRef',
        22: 'GPSDestLongitude',
        23: 'GPSDestBearingRef',
        24: 'GPSDestBearing',
        25: 'GPSDestDistanceRef',
        26: 'GPSDestDistance',
        27: 'GPSProcessingMethod',
        28: 'GPSAreaInformation',
        29: 'GPSDateStamp',
        30: 'GPSDifferential'
    };
    var StringValues = {
        ExposureProgram: {
            0: 'Not defined',
            1: 'Manual',
            2: 'Normal program',
            3: 'Aperture priority',
            4: 'Shutter priority',
            5: 'Creative program',
            6: 'Action program',
            7: 'Portrait mode',
            8: 'Landscape mode'
        },
        MeteringMode: {
            0: 'Unknown',
            1: 'Average',
            2: 'CenterWeightedAverage',
            3: 'Spot',
            4: 'MultiSpot',
            5: 'Pattern',
            6: 'Partial',
            255: 'Other'
        },
        LightSource: {
            0: 'Unknown',
            1: 'Daylight',
            2: 'Fluorescent',
            3: 'Tungsten (incandescent light)',
            4: 'Flash',
            9: 'Fine weather',
            10: 'Cloudy weather',
            11: 'Shade',
            12: 'Daylight fluorescent (D 5700 - 7100K)',
            13: 'Day white fluorescent (N 4600 - 5400K)',
            14: 'Cool white fluorescent (W 3900 - 4500K)',
            15: 'White fluorescent (WW 3200 - 3700K)',
            17: 'Standard light A',
            18: 'Standard light B',
            19: 'Standard light C',
            20: 'D55',
            21: 'D65',
            22: 'D75',
            23: 'D50',
            24: 'ISO studio tungsten',
            255: 'Other'
        },
        Flash: {
            0: 'Flash did not fire',
            1: 'Flash fired',
            5: 'Strobe return light not detected',
            7: 'Strobe return light detected',
            9: 'Flash fired, compulsory flash mode',
            13: 'Flash fired, compulsory flash mode, return light not detected',
            15: 'Flash fired, compulsory flash mode, return light detected',
            16: 'Flash did not fire, compulsory flash mode',
            24: 'Flash did not fire, auto mode',
            25: 'Flash fired, auto mode',
            29: 'Flash fired, auto mode, return light not detected',
            31: 'Flash fired, auto mode, return light detected',
            32: 'No flash function',
            65: 'Flash fired, red-eye reduction mode',
            69: 'Flash fired, red-eye reduction mode, return light not detected',
            71: 'Flash fired, red-eye reduction mode, return light detected',
            73: 'Flash fired, compulsory flash mode, red-eye reduction mode',
            77: 'Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected',
            79: 'Flash fired, compulsory flash mode, red-eye reduction mode, return light detected',
            89: 'Flash fired, auto mode, red-eye reduction mode',
            93: 'Flash fired, auto mode, return light not detected, red-eye reduction mode',
            95: 'Flash fired, auto mode, return light detected, red-eye reduction mode'
        },
        SensingMethod: {
            1: 'Not defined',
            2: 'One-chip color area sensor',
            3: 'Two-chip color area sensor',
            4: 'Three-chip color area sensor',
            5: 'Color sequential area sensor',
            7: 'Trilinear sensor',
            8: 'Color sequential linear sensor'
        },
        SceneCaptureType: {
            0: 'Standard',
            1: 'Landscape',
            2: 'Portrait',
            3: 'Night scene'
        },
        SceneType: {
            1: 'Directly photographed'
        },
        CustomRendered: {
            0: 'Normal process',
            1: 'Custom process'
        },
        WhiteBalance: {
            0: 'Auto white balance',
            1: 'Manual white balance'
        },
        GainControl: {
            0: 'None',
            1: 'Low gain up',
            2: 'High gain up',
            3: 'Low gain down',
            4: 'High gain down'
        },
        Contrast: {
            0: 'Normal',
            1: 'Soft',
            2: 'Hard'
        },
        Saturation: {
            0: 'Normal',
            1: 'Low saturation',
            2: 'High saturation'
        },
        Sharpness: {
            0: 'Normal',
            1: 'Soft',
            2: 'Hard'
        },
        SubjectDistanceRange: {
            0: 'Unknown',
            1: 'Macro',
            2: 'Close view',
            3: 'Distant view'
        },
        FileSource: {
            3: 'DSC'
        },
        Components: {
            0: '',
            1: 'Y',
            2: 'Cb',
            3: 'Cr',
            4: 'R',
            5: 'G',
            6: 'B'
        }
    };

    function addEvent(element, event, handler) {
        if (element.addEventListener) {
            element.addEventListener(event, handler, false);
        } else if (element.attachEvent) {
            element.attachEvent('on' + event, handler);
        }
    }

    function imageHasData(img) {
        return !!(img.exifdata);
    }

    function getImageData(binarystring, deep) {
        var data = findEXIFinJPEG(binarystring, deep);
        return data || {};
    }

    function findEXIFinJPEG(file, deep) {
        var offset = 2,
            length = file.getLength(),
            marker;
        if (file.getByteAt(0) != 255 || file.getByteAt(1) != 216) {
            switch (file.getShortAt(0)) {
                case 18761:
                case 19789:
                    if ((marker = readEXIFData(file, 0, -1)))
                        return marker;
            }
            if (!deep) return false; // not a valid jpeg
            var pos = 0;
            if (file.isTypedArray) {
                var data = new Uint8Array(file.getRawData());
                while (pos < length) {
                    if (data[pos] === 255 && data[pos + 1] === 216) break;
                    ++pos;
                }
            } else
                while (pos < length) {
                    if (file.getByteAt(pos) === 255 && file.getByteAt(pos + 1) === 216) break;
                    ++pos;
                }
            if (pos == length) return false; // no embed image
            offset += pos;
        }
        while (offset < length) {
            if (file.getByteAt(offset) != 255) {
                if (debug) console.log('Not a valid marker at offset ' + offset + ', found: ' + file.getByteAt(offset));
                return false; // not a valid marker, something is wrong
            }
            marker = file.getByteAt(offset + 1);
            // we could implement handling for other markers here,
            // but we're only looking for 0xFFE1 for EXIF data
            if (marker == 225) {
                // 0xE1 = Application-specific 1 (for EXIF)
                if (debug) console.log('Found 0xFFE1 marker');
                return readEXIFData(file, offset + 4);
            } else {
                offset += 2 + file.getShortAt(offset + 2, true);
            }
        }
    }

    function readTags(file, tiffStart, dirStart, strings, bigEnd) {
        var entries = file.getShortAt(dirStart, bigEnd),
            tags = {},
            entryOffset,
            tag,
            i;
        for (i = 0; i < entries; i++) {
            entryOffset = dirStart + i * 12 + 2;
            tag = strings[file.getShortAt(entryOffset, bigEnd)];
            if (!tag && debug) console.log('Unknown tag: 0x' + file.getShortAt(entryOffset, bigEnd).toString(16));
            if (tag) tags[tag] = readTagValue(file, entryOffset, tiffStart, dirStart, bigEnd);
        }
        return tags;
    }

    function readTagValue(file, entryOffset, tiffStart, dirStart, bigEnd) {
        var type = file.getShortAt(entryOffset + 2, bigEnd),
            numValues = file.getLongAt(entryOffset + 4, bigEnd),
            valueOffset = file.getLongAt(entryOffset + 8, bigEnd) + tiffStart,
            offset,
            vals,
            val,
            n,
            numerator,
            denominator;
        switch (type) {
            case 1: // byte, 8-bit unsigned int
            case 7: // undefined, 8-bit byte, value depending on field
                if (numValues == 1) {
                    return file.getByteAt(entryOffset + 8, bigEnd);
                } else {
                    offset = numValues > 4 ? valueOffset : (entryOffset + 8);
                    vals = [];
                    for (n = 0; n < numValues; n++) {
                        vals[n] = file.getByteAt(offset + n);
                    }
                    return vals;
                }
            case 2: // ascii, 8-bit byte
                offset = numValues > 4 ? valueOffset : (entryOffset + 8);
                return file.getStringAt(offset, numValues - 1);
            case 3: // short, 16 bit int
                if (numValues == 1) {
                    return file.getShortAt(entryOffset + 8, bigEnd);
                } else {
                    offset = numValues > 2 ? valueOffset : (entryOffset + 8);
                    vals = [];
                    for (n = 0; n < numValues; n++) {
                        vals[n] = file.getShortAt(offset + 2 * n, bigEnd);
                    }
                    return vals;
                }
            case 4: // long, 32 bit int
                if (numValues == 1) {
                    return file.getLongAt(entryOffset + 8, bigEnd);
                } else {
                    vals = [];
                    for (var n = 0; n < numValues; n++) {
                        vals[n] = file.getLongAt(valueOffset + 4 * n, bigEnd);
                    }
                    return vals;
                }
            case 5: // rational = two long values, first is numerator, second is denominator
                if (numValues == 1) {
                    numerator = file.getLongAt(valueOffset, bigEnd);
                    denominator = file.getLongAt(valueOffset + 4, bigEnd);
                    val = new Number(numerator / denominator);
                    val.numerator = numerator;
                    val.denominator = denominator;
                    return val;
                } else {
                    vals = [];
                    for (n = 0; n < numValues; n++) {
                        numerator = file.getLongAt(valueOffset + 8 * n, bigEnd);
                        denominator = file.getLongAt(valueOffset + 4 + 8 * n, bigEnd);
                        vals[n] = new Number(numerator / denominator);
                        vals[n].numerator = numerator;
                        vals[n].denominator = denominator;
                    }
                    return vals;
                }
            case 9: // slong, 32 bit signed int
                if (numValues == 1) {
                    return file.getSLongAt(entryOffset + 8, bigEnd);
                } else {
                    vals = [];
                    for (n = 0; n < numValues; n++) {
                        vals[n] = file.getSLongAt(valueOffset + 4 * n, bigEnd);
                    }
                    return vals;
                }
            case 10: // signed rational, two slongs, first is numerator, second is denominator
                if (numValues == 1) {
                    return file.getSLongAt(valueOffset, bigEnd) / file.getSLongAt(valueOffset + 4, bigEnd);
                } else {
                    vals = [];
                    for (n = 0; n < numValues; n++) {
                        vals[n] = file.getSLongAt(valueOffset + 8 * n, bigEnd) / file.getSLongAt(valueOffset + 4 + 8 * n, bigEnd);
                    }
                    return vals;
                }
        }
    }

    function readEXIFData(file, start, ign) {
        if (!ign && file.getStringAt(start, 4) != 'Exif') {
            if (debug) console.log('Not valid EXIF data! ' + file.getStringAt(start, 4));
            return false;
        }
        var bigEnd,
            tags,
            tag,
            tmp,
            exifData,
            gpsData,
            tiffOffset = ign ? 0 : start + 6;
        // test for TIFF validity and endianness
        tmp = file.getShortAt(tiffOffset);
        if (tmp == 18761) {
            bigEnd = false;
        } else if (tmp == 19789) {
            bigEnd = true;
        } else {
            if (debug) console.log('Not valid TIFF data! (no 0x4949 or 0x4D4D)');
            return false;
        }
        tmp = file.getShortAt(tiffOffset + 2, bigEnd);
        switch (tmp) {
            case 42:
            case 21075: // Olympus ORF
            case 21330: // Olympus ORF (sp350)
            case 20306: // Olympus ORF (e410)
            case 85: // Panasonic DMC-x
                break;
            default:
                if (debug) console.log('Not valid TIFF data! - got 0x' + tmp.toString(16));
                return false;
        }
        tmp = file.getLongAt(tiffOffset + 4, bigEnd);
        switch (tmp) {
            case 8:
            case 14974976: // Sony DSC/DSLR
                break;
                // case 0x45480000:
                // if (file.getLongAt(tiffOffset+6, bigEnd) === 0x50414548) break;
            default:
                if (debug) console.log('Not valid TIFF data! -- got 0x' + tmp.toString(16));
                return false;
        }
        tags = readTags(file, tiffOffset, tiffOffset + 8, TiffTags, bigEnd);
        if (tags.ExifIFDPointer) {
            exifData = readTags(file, tiffOffset, tiffOffset + tags.ExifIFDPointer, ExifTags, bigEnd);
            for (tag in exifData) {
                switch (tag) {
                    case 'LightSource':
                    case 'Flash':
                    case 'MeteringMode':
                    case 'ExposureProgram':
                    case 'SensingMethod':
                    case 'SceneCaptureType':
                    case 'SceneType':
                    case 'CustomRendered':
                    case 'WhiteBalance':
                    case 'GainControl':
                    case 'Contrast':
                    case 'Saturation':
                    case 'Sharpness':
                    case 'SubjectDistanceRange':
                    case 'FileSource':
                        exifData[tag] = StringValues[tag][exifData[tag]];
                        break;
                    case 'ExifVersion':
                    case 'FlashpixVersion':
                        exifData[tag] = String.fromCharCode(exifData[tag][0], exifData[tag][1], exifData[tag][2], exifData[tag][3]);
                        break;
                    case 'ComponentsConfiguration':
                        exifData[tag] =
                            StringValues.Components[exifData[tag][0]] + StringValues.Components[exifData[tag][1]] + StringValues.Components[exifData[tag][2]] + StringValues.Components[exifData[tag][3]];
                        break;
                }
                tags[tag] = exifData[tag];
            }
        }
        if (tags.GPSInfoIFDPointer) {
            gpsData = readTags(file, tiffOffset, tiffOffset + tags.GPSInfoIFDPointer, GPSTags, bigEnd);
            for (tag in gpsData) {
                switch (tag) {
                    case 'GPSVersionID':
                        gpsData[tag] = gpsData[tag][0] + '.' + gpsData[tag][1] + '.' + gpsData[tag][2] + '.' + gpsData[tag][3];
                        break;
                }
                tags[tag] = gpsData[tag];
            }
        }
        return tags;
    }

    function getData(img, callback) {
        if (!img.complete) return false;
        if (!imageHasData(img)) {
            getImageData(img, callback);
        } else {
            if (callback) {
                callback.call(img);
            }
        }
        return true;
    }

    function getTag(img, tag) {
        if (!imageHasData(img)) return;
        return img.exifdata[tag];
    }

    function getAllTags(img) {
        if (!imageHasData(img)) return {};
        var a,
            data = img.exifdata,
            tags = {};
        for (a in data) {
            if (data.hasOwnProperty(a)) {
                tags[a] = data[a];
            }
        }
        return tags;
    }

    function pretty(img) {
        if (!imageHasData(img)) return '';
        var a,
            data = img.exifdata,
            strPretty = '';
        for (a in data) {
            if (data.hasOwnProperty(a)) {
                if (typeof data[a] == 'object') {
                    if (data[a] instanceof Number) {
                        strPretty += a + ' : ' + data[a] + ' [' + data[a].numerator + '/' + data[a].denominator + ']\r\n';
                    } else {
                        strPretty += a + ' : [' + data[a].length + ' values]\r\n';
                    }
                } else {
                    strPretty += a + ' : ' + data[a] + '\r\n';
                }
            }
        }
        return strPretty;
    }

    function readFromBinaryFile(file) {
        return findEXIFinJPEG(file);
    }
    return {
        readFromBinaryFile: readFromBinaryFile,
        pretty: pretty,
        getTag: getTag,
        getAllTags: getAllTags,
        getData: getData,
        getImageData: getImageData,
        Tags: ExifTags,
        TiffTags: TiffTags,
        GPSTags: GPSTags,
        StringValues: StringValues
    };
})();
/**
 * Mega pixel image rendering library for iOS6 Safari
 *
 * Fixes iOS6 Safari's image file rendering issue for large size image (over mega-pixel),
 * which causes unexpected subsampling when drawing it in canvas.
 * By using this library, you can safely render the image with proper stretching.
 *
 * Copyright (c) 2012 Shinichi Tomita <shinichi.tomita@gmail.com>
 * Released under the MIT license
 */
(function() {
    /**
     * Detect subsampling in loaded image.
     * In iOS, larger images than 2M pixels may be subsampled in rendering.
     */
    function detectSubsampling(img) {
        var iw = img.naturalWidth,
            ih = img.naturalHeight;
        if (iw * ih > 1024 * 1024) { // subsampling may happen over megapixel image
            var canvas = document.createElement('canvas');
            canvas.width = canvas.height = 1;
            var ctx = canvas.getContext('2d');
            ctx.drawImage(img, -iw + 1, 0);
            // subsampled image becomes half smaller in rendering size.
            // check alpha channel value to confirm image is covering edge pixel or not.
            // if alpha value is 0 image is not covering, hence subsampled.
            return ctx.getImageData(0, 0, 1, 1).data[3] === 0;
        } else {
            return false;
        }
    }
    /**
     * Detecting vertical squash in loaded image.
     * Fixes a bug which squash image vertically while drawing into canvas for some images.
     */

    function detectVerticalSquash(img, iw, ih) {
        var canvas = document.createElement('canvas');
        canvas.width = 1;
        canvas.height = ih;
        var ctx = canvas.getContext('2d');
        ctx.drawImage(img, 0, 0);
        var data = ctx.getImageData(0, 0, 1, ih).data;
        // search image edge pixel position in case it is squashed vertically.
        var sy = 0;
        var ey = ih;
        var py = ih;
        while (py > sy) {
            var alpha = data[(py - 1) * 4 + 3];
            if (alpha === 0) {
                ey = py;
            } else {
                sy = py;
            }
            py = (ey + sy) >> 1;
        }
        var ratio = (py / ih);
        return (ratio === 0) ? 1 : ratio;
    }
    /**
     * Rendering image element (with resizing) and get its data URL
     */

    function renderImageToDataURL(img, options, doSquash) {
        var canvas = document.createElement('canvas');
        renderImageToCanvas(img, canvas, options, doSquash);
        return canvas.toDataURL('image/jpeg', options.quality || 0.8);
    }
    /**
     * Rendering image element (with resizing) into the canvas element
     */

    function renderImageToCanvas(img, canvas, options, doSquash) {
        var iw = img.naturalWidth,
            ih = img.naturalHeight;
        if (!(iw + ih)) return;
        var width = options.width,
            height = options.height;
        var ctx = canvas.getContext('2d');
        ctx.save();
        transformCoordinate(canvas, ctx, width, height, options.orientation);
        var subsampled = detectSubsampling(img);
        if (subsampled) {
            iw /= 2;
            ih /= 2;
        }
        var d = 1024; // size of tiling canvas
        var tmpCanvas = document.createElement('canvas');
        tmpCanvas.width = tmpCanvas.height = d;
        var tmpCtx = tmpCanvas.getContext('2d');
        var vertSquashRatio = doSquash ? detectVerticalSquash(img, iw, ih) : 1;
        var dw = Math.ceil(d * width / iw);
        var dh = Math.ceil(d * height / ih / vertSquashRatio);
        var sy = 0;
        var dy = 0;
        while (sy < ih) {
            var sx = 0;
            var dx = 0;
            while (sx < iw) {
                tmpCtx.clearRect(0, 0, d, d);
                tmpCtx.drawImage(img, -sx, -sy);
                ctx.drawImage(tmpCanvas, 0, 0, d, d, dx, dy, dw, dh);
                sx += d;
                dx += dw;
            }
            sy += d;
            dy += dh;
        }
        ctx.restore();
        tmpCanvas = tmpCtx = null;
    }
    /**
     * Transform canvas coordination according to specified frame size and orientation
     * Orientation value is from EXIF tag
     */

    function transformCoordinate(canvas, ctx, width, height, orientation) {
        switch (orientation) {
            case 5:
            case 6:
            case 7:
            case 8:
                canvas.width = height;
                canvas.height = width;
                break;
            default:
                canvas.width = width;
                canvas.height = height;
        }
        switch (orientation) {
            case 2:
                // horizontal flip
                ctx.translate(width, 0);
                ctx.scale(-1, 1);
                break;
            case 3:
                // 180 rotate left
                ctx.translate(width, height);
                ctx.rotate(Math.PI);
                break;
            case 4:
                // vertical flip
                ctx.translate(0, height);
                ctx.scale(1, -1);
                break;
            case 5:
                // vertical flip + 90 rotate right
                ctx.rotate(0.5 * Math.PI);
                ctx.scale(1, -1);
                break;
            case 6:
                // 90 rotate right
                ctx.rotate(0.5 * Math.PI);
                ctx.translate(0, -height);
                break;
            case 7:
                // horizontal flip + 90 rotate right
                ctx.rotate(0.5 * Math.PI);
                ctx.translate(width, -height);
                ctx.scale(-1, 1);
                break;
            case 8:
                // 90 rotate left
                ctx.rotate(-0.5 * Math.PI);
                ctx.translate(-width, 0);
                break;
            default:
                break;
        }
    }
    var URL = window.URL && window.URL.createObjectURL ? window.URL :
        window.webkitURL && window.webkitURL.createObjectURL ? window.webkitURL :
        null;
    /**
     * MegaPixImage class
     */
    function MegaPixImage(srcImage) {
        if (window.Blob && srcImage instanceof Blob) {
            if (!URL) {
                throw Error('No createObjectURL function found to create blob url');
            }
            var img = new Image();
            img.src = URL.createObjectURL(srcImage);
            this.blob = srcImage;
            srcImage = img;
        }
        if (!srcImage.naturalWidth && !srcImage.naturalHeight) {
            var _this = this;
            srcImage.onload = srcImage.onerror = function() {
                var listeners = _this.imageLoadListeners;
                if (listeners) {
                    _this.imageLoadListeners = null;
                    for (var i = 0, len = listeners.length; i < len; i++) {
                        listeners[i]();
                    }
                }
            };
            this.imageLoadListeners = [];
        }
        this.srcImage = srcImage;
    }
    /**
     * Rendering megapix image into specified target element
     */

    MegaPixImage.prototype.render = function(target, options, callback) {
        if (this.imageLoadListeners) {
            var _this = this;
            this.imageLoadListeners.push(function() {
                _this.render(target, options, callback);
            });
            return;
        }
        options = options || {};
        var imgWidth = this.srcImage.naturalWidth,
            imgHeight = this.srcImage.naturalHeight,
            width = options.width,
            height = options.height,
            maxWidth = options.maxWidth,
            maxHeight = options.maxHeight,
            doSquash = !this.blob || this.blob.type === 'image/jpeg';
        if (width && !height) {
            height = (imgHeight * width / imgWidth) << 0;
        } else if (height && !width) {
            width = (imgWidth * height / imgHeight) << 0;
        } else {
            width = imgWidth;
            height = imgHeight;
        }
        if (maxWidth && width > maxWidth) {
            width = maxWidth;
            height = (imgHeight * width / imgWidth) << 0;
        }
        if (maxHeight && height > maxHeight) {
            height = maxHeight;
            width = (imgWidth * height / imgHeight) << 0;
        }
        var opt = {
            width: width,
            height: height
        };
        for (var k in options) opt[k] = options[k];
        var tagName = target.tagName.toLowerCase();
        if (tagName === 'img') {
            target.src = renderImageToDataURL(this.srcImage, opt, doSquash);
        } else if (tagName === 'canvas') {
            renderImageToCanvas(this.srcImage, target, opt, doSquash);
        }
        if (typeof this.onrender === 'function') {
            this.onrender(target);
        }
        if (callback) {
            callback();
        }
        if (this.blob) {
            this.blob = null;
            URL.revokeObjectURL(this.srcImage.src);
        }
    };
    /**
     * Export class to global
     */
    if (typeof define === 'function' && define.amd) {
        define([], function() {
            return MegaPixImage;
        }); // for AMD loader
    } else {
        this.MegaPixImage = MegaPixImage;
    }
})();
/** smart-crop.js
 * A javascript library implementing content aware image cropping
 *
 * Copyright (C) 2014 Jonas Wagner
 *
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */
(function() {
    'use strict';

    function SmartCrop(options) {
        this.options = extend({}, SmartCrop.DEFAULTS, options);
    }
    SmartCrop.DEFAULTS = {
        width: 0,
        height: 0,
        aspect: 0,
        cropWidth: 0,
        cropHeight: 0,
        detailWeight: 0.2,
        skinColor: [
            0.78,
            0.57,
            0.44
        ],
        skinBias: 0.01,
        skinBrightnessMin: 0.2,
        skinBrightnessMax: 1,
        skinThreshold: 0.8,
        skinWeight: 1.8,
        saturationBrightnessMin: 0.05,
        saturationBrightnessMax: 0.9,
        saturationThreshold: 0.4,
        saturationBias: 0.2,
        saturationWeight: 0.3,
        // step * minscale rounded down to the next power of two should be good
        scoreDownSample: 8,
        step: 8,
        scaleStep: 0.1,
        minScale: 0.9,
        maxScale: 1,
        edgeRadius: 0.4,
        edgeWeight: -20,
        outsideImportance: -0.5,
        ruleOfThirds: true,
        prescale: true,
        canvasFactory: null,
        debug: false
    };
    SmartCrop.crop = function(image, options, callback) {
        if (options.aspect) {
            options.width = options.aspect;
            options.height = 1;
        }
        // work around images scaled in css by drawing them onto a canvas

        if (image.naturalWidth && (image.naturalWidth != image.width || image.naturalHeight != image.height)) {
            var c = new SmartCrop(options).canvas(image.naturalWidth, image.naturalHeight),
                cctx = c.getContext('2d');
            c.width = image.naturalWidth;
            c.height = image.naturalHeight;
            cctx.drawImage(image, 0, 0);
            image = c;
        }
        var scale = 1,
            prescale = 1;
        if (options.width && options.height) {
            scale = min(image.width / options.width, image.height / options.height);
            options.cropWidth = ~~ (options.width * scale);
            options.cropHeight = ~~ (options.height * scale);
            // img = 100x100, width = 95x95, scale = 100/95, 1/scale > min 
            // don't set minscale smaller than 1/scale
            // -> don't pick crops that need upscaling
            options.minScale = min(options.maxScale || SmartCrop.DEFAULTS.maxScale, max(1 / scale, (options.minScale || SmartCrop.DEFAULTS.minScale)));
        }
        var smartCrop = new SmartCrop(options);
        if (options.width && options.height) {
            if (options.prescale !== false) {
                prescale = 1 / scale / options.minScale;
                if (prescale < 1) {
                    var prescaledCanvas = smartCrop.canvas(image.width * prescale, image.height * prescale),
                        ctx = prescaledCanvas.getContext('2d');
                    ctx.drawImage(image, 0, 0, image.width, image.height, 0, 0, prescaledCanvas.width, prescaledCanvas.height);
                    image = prescaledCanvas;
                    smartCrop.options.cropWidth = ~~ (options.cropWidth * prescale);
                    smartCrop.options.cropHeight = ~~ (options.cropHeight * prescale);
                } else {
                    prescale = 1;
                }
            }
        }
        var result = smartCrop.analyse(image);
        for (var i = 0, i_len = result.crops.length; i < i_len; i++) {
            var crop = result.crops[i];
            crop.x = ~~ (crop.x / prescale);
            crop.y = ~~ (crop.y / prescale);
            crop.width = ~~ (crop.width / prescale);
            crop.height = ~~ (crop.height / prescale);
        }
        if (callback) callback(result);
        return result;
    };
    // check if all the dependencies are there
    SmartCrop.isAvailable = function(options) {
        try {
            var s = new this(options),
                c = s.canvas(16, 16);
            if (typeof c.getContext !== 'function') return false;
            return true;
        } catch (e) {
            return false;
        }
    };
    SmartCrop.prototype = {
        canvas: function(w, h) {
            if (this.options.canvasFactory !== null) {
                return this.options.canvasFactory(w, h);
            }
            var c = document.createElement('canvas');
            c.width = w;
            c.height = h;
            return c;
        },
        edgeDetect: function(i, o) {
            var id = i.data,
                od = o.data,
                w = i.width,
                h = i.height;
            for (var y = 0; y < h; y++) {
                for (var x = 0; x < w; x++) {
                    var p = (y * w + x) * 4,
                        lightness;
                    if (x === 0 || x >= w - 1 || y === 0 || y >= h - 1) {
                        lightness = sample(id, p);
                    } else {
                        lightness = sample(id, p) * 4 - sample(id, p - w * 4) - sample(id, p - 4) - sample(id, p + 4) - sample(id, p + w * 4);
                    }
                    od[p + 1] = lightness;
                }
            }
        },
        skinDetect: function(i, o) {
            var id = i.data,
                od = o.data,
                w = i.width,
                h = i.height,
                options = this.options;
            for (var y = 0; y < h; y++) {
                for (var x = 0; x < w; x++) {
                    var p = (y * w + x) * 4,
                        lightness = cie(id[p], id[p + 1], id[p + 2]) / 255,
                        skin = this.skinColor(id[p], id[p + 1], id[p + 2]);
                    if (skin > options.skinThreshold && lightness >= options.skinBrightnessMin && lightness <= options.skinBrightnessMax) {
                        od[p] = (skin - options.skinThreshold) * (255 / (1 - options.skinThreshold));
                    } else {
                        od[p] = 0;
                    }
                }
            }
        },
        saturationDetect: function(i, o) {
            var id = i.data,
                od = o.data,
                w = i.width,
                h = i.height,
                options = this.options;
            for (var y = 0; y < h; y++) {
                for (var x = 0; x < w; x++) {
                    var p = (y * w + x) * 4,
                        lightness = cie(id[p], id[p + 1], id[p + 2]) / 255,
                        sat = saturation(id[p], id[p + 1], id[p + 2]);
                    if (sat > options.saturationThreshold && lightness >= options.saturationBrightnessMin && lightness <= options.saturationBrightnessMax) {
                        od[p + 2] = (sat - options.saturationThreshold) * (255 / (1 - options.saturationThreshold));
                    } else {
                        od[p + 2] = 0;
                    }
                }
            }
        },
        crops: function(image) {
            var crops = [],
                width = image.width,
                height = image.height,
                options = this.options,
                minDimension = min(width, height),
                cropWidth = options.cropWidth || minDimension,
                cropHeight = options.cropHeight || minDimension;
            for (var scale = options.maxScale; scale >= options.minScale; scale -= options.scaleStep) {
                for (var y = 0; y + cropHeight * scale <= height; y += options.step) {
                    for (var x = 0; x + cropWidth * scale <= width; x += options.step) {
                        crops.push({
                            x: x,
                            y: y,
                            width: cropWidth * scale,
                            height: cropHeight * scale
                        });
                    }
                }
            }
            return crops;
        },
        score: function(output, crop) {
            var score = {
                    detail: 0,
                    saturation: 0,
                    skin: 0,
                    total: 0
                },
                options = this.options,
                od = output.data,
                downSample = options.scoreDownSample,
                invDownSample = 1 / downSample,
                outputHeightDownSample = output.height * downSample,
                outputWidthDownSample = output.width * downSample,
                outputWidth = output.width;
            for (var y = 0; y < outputHeightDownSample; y += downSample) {
                for (var x = 0; x < outputWidthDownSample; x += downSample) {
                    var p = (~~(y * invDownSample) * outputWidth + ~~(x * invDownSample)) * 4,
                        importance = this.importance(crop, x, y),
                        detail = od[p + 1] / 255;
                    score.skin += od[p] / 255 * (detail + options.skinBias) * importance;
                    score.detail += detail * importance;
                    score.saturation += od[p + 2] / 255 * (detail + options.saturationBias) * importance;
                }
            }
            score.total = (score.detail * options.detailWeight + score.skin * options.skinWeight + score.saturation * options.saturationWeight) / crop.width / crop.height;
            return score;
        },
        importance: function(crop, x, y) {
            var options = this.options;
            if (crop.x > x || x >= crop.x + crop.width || crop.y > y || y >= crop.y + crop.height) return options.outsideImportance;
            x = (x - crop.x) / crop.width;
            y = (y - crop.y) / crop.height;
            var px = abs(0.5 - x) * 2,
                py = abs(0.5 - y) * 2,
                // distance from edge
                dx = Math.max(px - 1 + options.edgeRadius, 0),
                dy = Math.max(py - 1 + options.edgeRadius, 0),
                d = (dx * dx + dy * dy) * options.edgeWeight;
            var s = 1.41 - sqrt(px * px + py * py);
            if (options.ruleOfThirds) {
                s += (Math.max(0, s + d + 0.5) * 1.2) * (thirds(px) + thirds(py));
            }
            return s + d;
        },
        skinColor: function(r, g, b) {
            var mag = sqrt(r * r + g * g + b * b),
                options = this.options,
                rd = (r / mag - options.skinColor[0]),
                gd = (g / mag - options.skinColor[1]),
                bd = (b / mag - options.skinColor[2]),
                d = sqrt(rd * rd + gd * gd + bd * bd);
            return 1 - d;
        },
        analyse: function(image) {
            var result = {},
                options = this.options,
                canvas = this.canvas(image.width, image.height),
                ctx = canvas.getContext('2d');
            ctx.drawImage(image, 0, 0);
            var input = ctx.getImageData(0, 0, canvas.width, canvas.height),
                output = ctx.getImageData(0, 0, canvas.width, canvas.height);
            this.edgeDetect(input, output);
            this.skinDetect(input, output);
            this.saturationDetect(input, output);
            var scoreCanvas = this.canvas(ceil(image.width / options.scoreDownSample), ceil(image.height / options.scoreDownSample)),
                scoreCtx = scoreCanvas.getContext('2d');
            ctx.putImageData(output, 0, 0);
            scoreCtx.drawImage(canvas, 0, 0, canvas.width, canvas.height, 0, 0, scoreCanvas.width, scoreCanvas.height);
            var scoreOutput = scoreCtx.getImageData(0, 0, scoreCanvas.width, scoreCanvas.height);
            var topScore = -Infinity,
                topCrop = null,
                crops = this.crops(image);
            for (var i = 0, i_len = crops.length; i < i_len; i++) {
                var crop = crops[i];
                crop.score = this.score(scoreOutput, crop);
                if (crop.score.total > topScore) {
                    topCrop = crop;
                    topScore = crop.score.total;
                }
            }
            result.crops = crops;
            result.topCrop = topCrop;
            if (options.debug && topCrop) {
                ctx.fillStyle = 'rgba(255, 0, 0, 0.1)';
                ctx.fillRect(topCrop.x, topCrop.y, topCrop.width, topCrop.height);
                if (true) {
                    for (var y = 0; y < output.height; y++) {
                        for (var x = 0; x < output.width; x++) {
                            var p = (y * output.width + x) * 4;
                            var importance = this.importance(topCrop, x, y);
                            if (importance > 0) {
                                output.data[p + 1] += importance * 32;
                            }
                            if (importance < 0) {
                                output.data[p] += importance * -64;
                            }
                            output.data[p + 3] = 255;
                        }
                    }
                    ctx.putImageData(output, 0, 0);
                }
                ctx.strokeStyle = 'rgba(255, 0, 0, 0.8)';
                ctx.strokeRect(topCrop.x, topCrop.y, topCrop.width, topCrop.height);
                result.debugCanvas = canvas;
            }
            return result;
        }
    };
    // aliases and helpers
    var min = Math.min,
        max = Math.max,
        abs = Math.abs,
        ceil = Math.ceil,
        sqrt = Math.sqrt;

    function extend(o) {
        for (var i = 1, i_len = arguments.length; i < i_len; i++) {
            var arg = arguments[i];
            if (arg) {
                for (var name in arg) {
                    o[name] = arg[name];
                }
            }
        }
        return o;
    }
    // gets value in the range of [0, 1] where 0 is the center of the pictures
    // returns weight of rule of thirds [0, 1]

    function thirds(x) {
        x = ((x - (1 / 3) + 1) % 2 * 0.5 - 0.5) * 16;
        return Math.max(1 - x * x, 0);
    }

    function cie(r, g, b) {
        return 0.5126 * b + 0.7152 * g + 0.0722 * r;
    }

    function sample(id, p) {
        return cie(id[p], id[p + 1], id[p + 2]);
    }

    function saturation(r, g, b) {
        var maximum = max(r / 255, g / 255, b / 255),
            minumum = min(r / 255, g / 255, b / 255);
        if (maximum === minumum) {
            return 0;
        }
        var l = (maximum + minumum) / 2,
            d = maximum - minumum;
        return l > 0.5 ? d / (2 - maximum - minumum) : d / (maximum + minumum);
    }
    // amd

    if (typeof define !== 'undefined' && define.amd) define(function() {
        return SmartCrop;
    });
    //common js
    if (typeof exports !== 'undefined') exports.SmartCrop = SmartCrop;
    // browser
    else if (typeof navigator !== 'undefined') window.SmartCrop = SmartCrop;
    // nodejs
    if (typeof module !== 'undefined') {
        module.exports = SmartCrop;
    }
})();
var newnodes;
var fminitialized = false;
var panelDomQueue = [],
    DOM_TRANSFER_LIMIT = 15
if (typeof seqno == 'undefined') var seqno = Math.floor(Math.random() * 1000000000);
if (typeof n_h == 'undefined') var n_h = false;
if (typeof requesti == 'undefined') var requesti = makeid(10);
if (typeof folderlink == 'undefined') var folderlink = false;
if (typeof lang == 'undefined') var lang = 'en';
if (typeof Ext == 'undefined') var Ext = false;
if (typeof ie9 == 'undefined') var ie9 = false;
if (typeof loadingDialog == 'undefined') {
    var loadingDialog = {};
    loadingDialog.show = function() {
        $('.dark-overlay').show();
        $('.loading-spinner').show();
    };
    loadingDialog.hide = function() {
        $('.dark-overlay').hide();
        $('.loading-spinner').hide();
    };
}
var fmconfig = {};
if (localStorage.fmconfig) fmconfig = JSON.parse(localStorage.fmconfig);
var maxaction;
var zipid = 1;

function MegaData() {
    this.d = {};
    this.v = [];
    this.c = {};
    this.u = {};
    this.t = {};
    this.h = {};
    this.sn = false;
    this.filter = false;
    this.sortfn = false;
    this.sortd = false;
    this.rendered = false;
    this.currentdirid = false;
    this.viewmode = 0;
    this.csortd = -1;
    this.csort = 'name';
    this.reset = function() {
        this.d = {};
        this.v = [];
        this.c = {};
        this.u = {};
        this.t = {};
        this.sn = false;
        this.filter = false;
        this.sortfn = false;
        this.sortd = false;
        this.rendered = false;
        this.RootID = undefined;
        this.RubbishID = undefined;
        this.InboxID = undefined;
        this.viewmode = 0;
    }
    this.sortBy = function(fn, d) {
        this.v.sort(function(a, b) {
            if (!d) d = 1;
            if (a.t > b.t) return -1;
            else if (a.t < b.t) return 1;
            return fn(a, b, d);
        });
        this.sortfn = fn;
        this.sortd = d;
    };
    this.sort = function() {
        this.sortBy(this.sortfn, this.sortd);
        this.sortBy(this.sortfn, this.sortd);
    };
    this.sortReverse = function() {
        var d = 1;
        if (this.sortd > 0) d = -1;
        this.sortBy(this.sortfn, d);
    };
    this.sortByName = function(d) {
        this.sortfn = function(a, b, d) {
            if (typeof a.name == 'string' && typeof b.name == 'string') return a.name.localeCompare(b.name) * d;
            else return -1;
        };
        this.sortd = d;
        this.sort();
    };
    this.sortByDateTime = function(d) {
        this.sortfn = function(a, b, d) {
            if (a.ts < b.ts) return -1 * d;
            else return 1 * d;
        }
        this.sortd = d;
        this.sort();
    };
    this.sortBySize = function(d) {
        this.sortfn = function(a, b, d) {
            if (typeof a.s !== 'undefined' && typeof b.s !== 'undefined' && a.s < b.s) return -1 * d;
            else return 1 * d;
        }
        this.sortd = d;
        this.sort();
    };
    this.sortByType = function(d) {
        this.sortfn = function(a, b, d) {
            if (typeof a.name == 'string' && typeof b.name == 'string') return filetype(a.name).localeCompare(filetype(b.name)) * d;
            else return -1;
        }
        this.sortd = d;
        this.sort();
    };
    this.doSort = function(n, d) {
        $('.grid-table-header .arrow').removeClass('asc desc');
        if (d > 0) $('.arrow.' + n).addClass('desc');
        else $('.arrow.' + n).addClass('asc');
        if (n == 'name') M.sortByName(d);
        else if (n == 'size') M.sortBySize(d);
        else if (n == 'type') M.sortByType(d);
        else if (n == 'date') M.sortByDateTime(d);
        if (fmconfig.uisorting) storefmconfig('sorting', {
            n: n,
            d: d
        });
        else fmsortmode(M.currentdirid, n, d);
    };
    /* Filters: */
    this.filterBy = function(f) {
        this.filter = f;
        this.v = [];
        for (var i in this.d) {
            if (f(this.d[i])) this.v.push(this.d[i]);
        }
    };
    this.filterByParent = function(id) {
        this.filterBy(function(node) {
            if (node.name && node.p == id) return true;
        });
    };
    this.filterBySearch = function(str) {
        str = str.replace('search/', '');
        this.filterBy(function(node) {
            if (node.name && str && node.name.toLowerCase().indexOf(str.toLowerCase()) >= 0) return true;
        });
    };
    this.avatars = function() {
        if (!M.c.contacts) M.c.contacts = {};
        M.c.contacts[u_handle] = 1;
        for (var u in M.c['contacts'])
            if (!avatars[u]) {
                api_req({
                    a: 'uga',
                    u: u,
                    ua: '+a'
                }, {
                    u: u,
                    callback: function(res, ctx) {
                        if (typeof res !== 'number') {
                            var blob = new Blob([str_to_ab(base64urldecode(res))], {
                                type: 'image/jpeg'
                            });
                            avatars[ctx.u] = {
                                data: blob,
                                url: myURL.createObjectURL(blob)
                            }
                            var el = $('.contact-block-view-avatar.' + ctx.u + ',.avatar.' + ctx.u + ',.contacts-avatar.' + ctx.u);
                            if (el.length > 0) el.find('img').attr('src', avatars[ctx.u].url);
                            if (u_handle == ctx.u) $('.fm-avatar img,.fm-account-avatar img').attr('src', avatars[ctx.u].url);
                        }
                    }
                });
            }
        delete M.c.contacts[u_handle];
    }
    this.renderAvatars = function() {
        $('.contact-block-view-avatar').each(function(i, e) {
            var c = $(e).attr('class');
        });
        $('.avatar').each(function(i, e) {
            var c = $(e).attr('class');
        });
    }
    this.contactstatus = function(h) {
        var folders = 0;
        var files = 0;
        var ts = 0;
        if (M.d[h]) {
            var a = fm_getnodes(h);
            for (var i in a) {
                var n = M.d[a[i]];
                if (n) {
                    if (ts < n.ts) ts = n.ts;
                    if (n.t) folders++;
                    else files++;
                }
            }
        }
        return {
            files: files,
            folders: folders,
            ts: ts
        };
    };
    this.renderMain = function(u) {
        hideEmptyMsg();
        var jsp = $('.file-block-scrolling').data('jsp');
        if (jsp) jsp.destroy();
        var jsp = $('.contacts-blocks-scrolling').data('jsp');
        if (jsp) jsp.destroy();
        if (!u) {
            $('.grid-table.fm tr').remove();
            $('.file-block-scrolling div').remove();
            $('.file-block-scrolling a').remove();
            $('.contacts-blocks-scrolling div').remove();
            $('.contacts-grid-table tr').not('.clone-of-header').remove();
        }
        if (this.v.length == 0) {
            if (M.currentdirid == M.RubbishID) $('.fm-empty-trashbin').removeClass('hidden');
            else if (M.currentdirid == 'contacts') $('.fm-empty-contacts').removeClass('hidden');
            else if (M.currentdirid.substr(0, 7) == 'search/') $('.fm-empty-search').removeClass('hidden');
            else if (M.currentdirid == M.RootID) $('.fm-empty-cloud').removeClass('hidden');
            else if (M.currentdirid == M.InboxID) $('.fm-empty-messages').removeClass('hidden');
        }
        for (var i in this.v) {
            if (this.v[i].name) {
                var s = '';
                var t = '';
                var c = '';
                if (this.v[i].t) {
                    t = l[1049];
                    c = ' folder';
                } else {
                    t = filetype(this.v[i].name);
                    s = htmlentities(bytesToSize(this.v[i].s));
                }
                var html,
                    t,
                    el,
                    star = '';
                if (this.v[i].fav) star = ' star';
                if (this.viewmode == 1) {
                    if (this.currentdirid == 'contacts') {
                        var avatar = staticpath + 'images/mega/default-avatar.png';
                        if (avatars[this.v[i].h]) avatar = avatars[this.v[i].h].url;
                        el = 'div';
                        t = '.contacts-blocks-scrolling';
                        html = '<div id="' + htmlentities(this.v[i].h) + '" class="contact-block-view"><span class="contact-status no-status"></span><div class="contact-block-view-avatar ' + this.v[i].h + '"><span><img alt="" src="' + avatar + '" /></span></div><div class="contact-block-view-name">' + htmlentities(this.v[i].name) + '</div></div>';
                    } else {
                        t = '.file-block-scrolling';
                        el = 'a';
                        html = '<a class="file-block' + c + '" id="' + htmlentities(this.v[i].h) + '"><span class="file-status-icon' + star + '"></span><span class="block-view-file-type ' + fileicon(this.v[i]) + '"><img alt="" /></span><span class="file-block-title">' + htmlentities(this.v[i].name) + '</span></a>';
                    }
                } else {
                    el = 'tr';
                    if (this.currentdirid == 'contacts') {
                        var cs = this.contactstatus(this.v[i].h);
                        var contains = fm_contains(cs.files, cs.folders);
                        var time = time2last(cs.ts);
                        if (cs.files == 0 && cs.folders == 0) {
                            contains = l[1050];
                            time = l[1051];
                        }
                        var avatar = staticpath + 'images/mega/default-avatar.png';
                        if (avatars[this.v[i].h]) avatar = avatars[this.v[i].h].url;
                        html = '<tr id="' + htmlentities(this.v[i].h) + '"><td><span class="contacts-avatar ' + this.v[i].h + '"><span><img src="' + avatar + '" alt=""/></span></span><span class="contacts-username">' + htmlentities(this.v[i].name) + '</span></td><td width="130" class="hidden"><span class="contact-status online-status"></span><span class="contact-status-text">Online</span></td><td  width="200">' + htmlentities(contains) + '</td><td width="200">' + htmlentities(time) + '</td></tr>';
                        t = '.contacts-grid-table';
                    } else {
                        html = '<tr id="' + htmlentities(this.v[i].h) + '" class="' + c + '"><td width="30"><span class="grid-status-icon' + star + '"></span></td><td><span class="transfer-filtype-icon ' + fileicon(this.v[i]) + '"> </span><span class="tranfer-filetype-txt">' + htmlentities(this.v[i].name) + '</span></td><td width="100">' + s + '</td><td width="130">' + t + '</td><td width="120">' + time2date(this.v[i].ts) + '</td><td width="50" class="grid-url-field"><a href="" class="grid-url-arrow"></a></td></tr>';
                        t = '.grid-table.fm';
                    }
                }
                if (!u || $(t + ' ' + el).length == 0) {
                    // if the current view does not have any nodes, just append it
                    $(t).append(html);
                } else if (u && $(t + ' #' + this.v[i].h).length == 0 && this.v[i - 1] && $(t + ' #' + this.v[i - 1].h).length > 0) {
                    // if there is a node before the new node in the current view, add it after that node:
                    $(t + ' #' + this.v[i - 1].h).after(html);
                } else if (u && $(t + ' #' + this.v[i].h).length == 0 && this.v[i + 1] && $(t + ' #' + this.v[i + 1].h).length > 0) {
                    // if there is a node after the new node in the current view, add it before that node:
                    $(t + ' #' + this.v[i + 1].h).before(html);
                } else if ($(t + ' #' + this.v[i].h).length == 0 && this.v[i].t) {
                    // new folder: insert new node before the first folder in the current view
                    $($(t + ' ' + el)[0]).before(html);
                } else if ($(t + ' #' + this.v[i].h).length == 0 && !this.v[i].t) {
                    // new file: insert new node before the first file in the current view
                    var a = $(t + ' ' + el).not('.folder');
                    if (a.length > 0) $(a[0]).before(html);
                    else {
                        // if this view does not have any files, insert after the last folder
                        a = $(t + ' ' + el);
                        $(a[a.length - 1]).after(html);
                    }
                }
            }
        }
        $('.grid-url-arrow').unbind('click');
        $('.grid-url-arrow').bind('click', function() {
            $.selected = [
                $(this).closest('tr').attr('id')
            ];
            if (u_type === 0) ephemeralDialog(l[1005]);
            else M.getlinks([$.selected]);
        });
        if (this.viewmode == 1) {
            $('.file-block-scrolling').append('<div class="clear"></div>');
            iconUI();
            fa_duplicates = {};
            fm_thumbnails();
        } else gridUI();
        fmtopUI();
    };
    this.renderShare = function(h) {
        var html = '';
        if (M.d[h].shares) {
            for (var u in M.d[h].shares) {
                if (M.u[u]) {
                    var rt = '';
                    var sr = {
                        r0: '',
                        r1: '',
                        r2: ''
                    };
                    if (M.d[h].shares[u].r == 0) {
                        rt = l[55];
                        sr.r0 = ' active';
                    } else if (M.d[h].shares[u].r == 1) {
                        rt = l[56];
                        sr.r1 = ' active';
                    } else if (M.d[h].shares[u].r == 2) {
                        rt = l[57];
                        sr.r2 = ' active';
                    }
                    var avatar = staticpath + 'images/mega/default-avatar.png';
                    if (avatars[M.u[u].h]) avatar = avatars[M.u[u].h].url;
                    html += '<div class="add-contact-item" id="' + u + '"><div class="add-contact-pad"><span class="avatar ' + M.u[u].h + '"><span><img src="' + avatar + '" alt=""/></span></span><span class="add-contact-username">' + htmlentities(M.u[u].m) + '</span><div class="fm-share-dropdown">' + rt + '</div><div class="fm-share-permissions-block hidden"><div class="fm-share-permissions' + sr.r0 + '" id="rights_0">' + l[55] + '</div><div class="fm-share-permissions' + sr.r1 + '" id="rights_1">' + l[56] + '</div><div class="fm-share-permissions' + sr.r2 + '" id="rights_2">' + l[57] + '</div><div class="fm-share-permissions" id="rights_3">' + l[83] + '</div></div></div></div>';
                }
            }
            $('.share-dialog .fm-shared-to').html(html);
            $('.share-dialog .fm-share-empty').addClass('hidden');
            $('.share-dialog .fm-shared-to').removeClass('hidden');
        } else {
            $('.share-dialog .fm-share-empty').removeClass('hidden');
            $('.share-dialog .fm-shared-to').addClass('hidden');
        }
    };
    this.renderTree = function() {
        $('.cloudsub').attr('id', 'treesub_' + M.RootID);
        if (!folderlink) $('.rubbishsub').attr('id', 'treesub_' + M.RubbishID);
        $('#treesub_' + M.RootID).html('');
        this.buildtree(this.d[this.RootID]);
        $('#treesub_contacts').html('');
        this.buildtree({
            h: 'contacts'
        });
        $('#treesub_' + M.RubbishID).html('');
        this.buildtree({
            h: M.RubbishID
        });
        treeUI();
    };
    this.renderContacts = function() {
        $('#treesub_contacts').html('');
        this.buildtree({
            h: 'contacts'
        });
        treeUI();
    };
    this.openFolder = function(id, force, chat) {
        topContextMenu(1);
        $('.fm-files-view-icon').removeClass('hidden');
        if (d) console.log('openFolder()', M.currentdirid, id);
        if (id !== 'notifications' && $('.fm-main.notifications').attr('class').indexOf('hidden') < 0) notificationsUI(1);
        this.search = false;
        this.chat = false;
        if (!fminitialized) {
            fminitialized = true;
            $('.top-search-bl').show();
        } else if (id == this.currentdirid && !force) return false;
        if (id == 'rubbish') id = this.RubbishID;
        else if (id == 'inbox') id = this.InboxID;
        else if (id == 'cloudroot') id = this.RootID;
        else if (id == 'contacts') id = 'contacts';
        else if (id && id.substr(0, 7) == 'account') accountUI();
        else if (id && id.substr(0, 13) == 'notifications') notificationsUI();
        else if (id && id.substr(0, 7) == 'search/') this.search = true;
        else if (id && id.substr(0, 5) == 'chat/') this.chat = true;
        else if (!id || !M.d[id]) id = this.RootID;
        this.currentdirid = id;
        if (id == this.RootID) $('.fm-connector-first').removeClass('active');
        if (this.chat) {
            treeUIopen(M.currentdirid.replace('chat/', ''), 1);
            chatui();
            fmtopUI();
            M.renderPath();
        } else if (id && id.substr(0, 7) !== 'account' && id.substr(0, 13) !== 'notifications') {
            $('.fm-right-files-block').removeClass('hidden');
            $('.fm-right-account-block').addClass('hidden');
            var tt = new Date().getTime();
            if (id.substr(0, 6) == 'search') M.filterBySearch(M.currentdirid);
            else M.filterByParent(M.currentdirid);
            var viewmode = 0;
            if (typeof fmconfig.uiviewmode !== 'undefined' && fmconfig.uiviewmode) {
                if (fmconfig.viewmode) viewmode = fmconfig.viewmode;
            } else if (typeof fmconfig.viewmodes !== 'undefined' && typeof fmconfig.viewmodes[id] !== 'undefined') viewmode = fmconfig.viewmodes[id];
            else {
                for (var i in M.v) {
                    var ext = fileext(M.v[i].name);
                    var images = '|jpg|gif|png|';
                    if (images.indexOf('|' + ext + '|') >= 0) viewmode = 1;
                }
            }
            M.viewmode = viewmode;
            if (fmconfig.uisorting && fmconfig.sorting) M.doSort(fmconfig.sorting.n, fmconfig.sorting.d);
            else if (fmconfig.sortmodes && fmconfig.sortmodes[id]) M.doSort(fmconfig.sortmodes[id].n, fmconfig.sortmodes[id].d);
            else M.doSort('name', 1);
            M.renderMain();
            M.renderPath();
            if (fminitialized && (id.substr(0, 6) !== 'search')) {
                if ($('treea_' + M.currentdirid).length == 0) {
                    var n = M.d[M.currentdirid];
                    if (n && n.p) treeUIopen(n.p, false, true);
                }
                treeUIopen(M.currentdirid, 1);
            }
            if (d) console.log('time for rendering:', new Date().getTime() - tt);
            setTimeout(function() {
                M.renderPath();
            }, 1);
        }
        if (!n_h) window.location.hash = '#fm/' + M.currentdirid;
        searchPath();
    };
    this.runbugfix = function() {
        for (var i in M.d) {
            if (M.d[i].t && M.d[i].shares) {
                var nodes = fm_getnodes(M.d[i].h);
                console.log(nodes);
                for (var j in nodes) {
                    var n = M.d[nodes[j]];
                    if (n.name) {
                        console.log(n.name);
                        console.log(n.key);
                    }
                }
            }
        }
    };
    this.buildtree = function(n) {
        if (n && this.c[n.h]) {
            var folders = [];
            for (var i in this.c[n.h])
                if (this.d[i].t == 1 && this.d[i].name) folders.push(this.d[i]);
            if (n.h == M.RubbishID) $('.fm-tree-header.recycle-item').addClass('recycle-notification');
            if (folders.length > 0) {
                if (n.h == M.RootID) $('.fm-left-panel .fm-tree-header.cloud-drive-item').addClass('contains-subfolders');
                else if (n.h == M.RubbishID) $('.fm-left-panel .fm-tree-header.recycle-item').addClass('contains-subfolders');
                else if (n.h == 'contacts') $('.fm-left-panel .fm-tree-header.contacts-item').addClass('contains-subfolders');
                else $('#treesub_' + n.h).siblings('a').addClass('contains-folders');
            }
            // sort by name is default in the tree

            folders.sort(function(a, b) {
                if (a.name) return a.name.localeCompare(b.name);
            });
            if (n.h == 'contacts') {
                // in case of contacts we have custom sort/grouping:
                if (localStorage.csort) this.csort = localStorage.csort;
                if (localStorage.csortd) this.csortd = parseInt(localStorage.csortd);
                if (this.csort == 'shares') {
                    folders.sort(function(a, b) {
                        if (M.c[a.h] && M.c[b.h]) {
                            if (a.name) return a.name.localeCompare(b.name);
                        } else if (M.c[a.h] && !M.c[b.h]) return 1 * M.csortd;
                        else if (!M.c[a.h] && M.c[b.h]) return -1 * M.csortd;
                        return 0;
                    });
                } else if (this.csort == 'name') {
                    folders.sort(function(a, b) {
                        if (a.name) return parseInt(a.name.localeCompare(b.name) * M.csortd);
                    });
                }
                $('.contacts-sorting-by').removeClass('active');
                $('.contacts-sorting-by.' + this.csort).addClass('active');
                $('.contacts-sorting-type').removeClass('active');
                $('.contacts-sorting-type.' + (this.csortd > 0 ? 'asc' : 'desc')).addClass('active');
            }
            for (var i in folders) {
                var treenode = '<span>' + htmlentities(folders[i].name) + '</span>';
                var contactc = '';
                var statusc = '';
                if (n.h == 'contacts') {
                    contactc = 'contact';
                    statusc = 'no-status';
                    var avatar = staticpath + 'images/mega/default-avatar.png';
                    if (avatars[folders[i].h]) avatar = avatars[folders[i].h].url;
                    treenode = '<span><span class="avatar ' + folders[i].h + '"><span><img src="' + avatar + '" alt=""/></span></span><span class="messages-icon"><span class="active">2</span></span><span class="contact-name">' + htmlentities(folders[i].name) + '</span></span>';
                }
                var s = '';
                if (typeof folders[i].shares != 'undefined') s = 'shared-folder';
                var ulc = '';
                var expandedc = '';
                var buildnode = false;
                if (fmconfig && fmconfig.treenodes && fmconfig.treenodes[folders[i].h] && typeof M.c[folders[i].h] !== 'undefined') {
                    for (var h in M.c[folders[i].h]) {
                        var n2 = M.d[h];
                        if (n2 && n2.t) buildnode = true;
                    }
                }
                if (buildnode) {
                    ulc = 'class="opened"';
                    expandedc = 'expanded';
                } else if (fmconfig && fmconfig.treenodes && fmconfig.treenodes[folders[i].h]) fmtreenode(folders[i].h, false);
                var containsc = '';
                var cns = M.c[folders[i].h];
                if (cns)
                    for (var cn in cns)
                        if (M.d[cn] && M.d[cn].t) containsc = 'contains-folders';
                var html = '<li id="treeli_' + folders[i].h + '"><span class="fm-connector ' + contactc + '"></span><span class="fm-horizontal-connector ' + contactc + '"></span><a class="fm-tree-folder ' + contactc + ' ' + s + ' ' + statusc + ' ' + expandedc + ' ' + containsc + '" id="treea_' + folders[i].h + '">' + treenode + '</a><ul id="treesub_' + folders[i].h + '" ' + ulc + '></ul></li>';
                if ($('#treeli_' + folders[i].h).length == 0) {
                    if (folders[i - 1] && $('#treeli_' + folders[i - 1].h).length > 0) $('#treeli_' + folders[i - 1].h).after(html);
                    else if (i == 0 && $('#treesub_' + n.h + ' li').length > 0) $($('#treesub_' + n.h + ' li')[0]).before(html);
                    else $('#treesub_' + n.h).append(html);
                }
                if (buildnode) this.buildtree(folders[i]);
            }
        }
    };
    this.getPath = function(id) {
        var a = [];
        var g = 1;
        while (g) {
            if (M.d[id] || id == 'contacts' || id == 'messages' || id == M.InboxID) a.push(id);
            else return [];
            if (id == this.RootID || id == 'contacts' || id == 'messages' || id == this.RubbishID || id == this.InboxID) g = 0;
            if (g) id = this.d[id].p;
        }
        return a;
    };
    this.pathLength = function() {
        var length = 0;
        var c = $('.fm-new-folder').attr('class');
        if (c && c.indexOf('hidden') < 0) length += $('.fm-new-folder').width();
        var c = $('.fm-folder-upload').attr('class');
        if (c && c.indexOf('hidden') < 0) length += $('.fm-folder-upload').width();
        var c = $('.fm-file-upload').attr('class');
        if (c && c.indexOf('hidden') < 0) length += $('.fm-file-upload').width();
        var c = $('.fm-clearbin-button').attr('class');
        if (c && c.indexOf('hidden') < 0) length += $('.fm-clearbin-button').width();
        var c = $('.fm-add-user').attr('class');
        if (c && c.indexOf('hidden') < 0) length += $('.fm-add-user').width();
        length += $('.fm-breadcrumbs-block').width();
        length += $('.fm-back-button').width();
        return length;
    };
    this.renderPath = function() {
        var hasnext = '',
            typeclass;
        var html = '<div class="clear"></div>';
        var a = this.getPath(this.currentdirid);
        for (var i in a) {
            if (a[i] == this.RootID) {
                if (folderlink && M.d[this.RootID]) {
                    name = htmlentities(M.d[this.RootID].name);
                    typeclass = 'folder';
                } else {
                    name = l[164];
                    typeclass = 'cloud-drive';
                }
            } else if (a[i] == 'contacts') {
                typeclass = 'contacts';
                name = l[165];
            } else if (a[i] == this.RubbishID) {
                typeclass = 'recycle-bin';
                name = l[167];
            } else if (a[i] == 'messages' || a[i] == M.InboxID) {
                typeclass = 'messages';
                name = l[166];
            } else {
                name = htmlentities(this.d[a[i]].name);
                typeclass = 'folder';
            }
            html = '<a class="fm-breadcrumbs ' + typeclass + ' contains-directories ' + hasnext + ' ui-droppable" id="path_' + htmlentities(a[i]) + '"><span class="right-arrow-bg ui-draggable"><span>' + name + '</span></span></a>' + html;
            hasnext = 'has-next-button';
        }
        if (this.currentdirid && this.currentdirid.substr(0, 5) == 'chat/') {
            $('.fm-breadcrumbs-block').html('<a class="fm-breadcrumbs contacts contains-directories has-next-button" id="path_contacts"><span class="right-arrow-bg"><span>Contacts</span></span></a><a class="fm-breadcrumbs chat" id="chatcrumb"><span class="right-arrow-bg"><span>Andrei.d</span></span></a>');
            $('.search-files-result').addClass('hidden');
        } else if (this.currentdirid && this.currentdirid.substr(0, 7) == 'search/') {
            $('.fm-breadcrumbs-block').html('<a class="fm-breadcrumbs search contains-directories ui-droppable" id="' + htmlentities(a[i]) + '"><span class="right-arrow-bg ui-draggable"><span>' + htmlentities(this.currentdirid.replace('search/', '')) + '</span></span></a>');
            $('.search-files-result .search-number').text(M.v.length);
            $('.search-files-result').removeClass('hidden');
            $('.search-files-result').addClass('last-button');
        } else {
            $('.search-files-result').addClass('hidden');
            $('.fm-breadcrumbs-block').html(html);
        }
        $('.fm-new-folder span').text(l[68]);
        $('.fm-file-upload span').text(l[99]);
        $('.fm-folder-upload span').text(l[98]);
        $('.fm-right-header').removeClass('long-path');
        if (M.pathLength() + 260 > $('.fm-right-header').width()) {
            $('.fm-right-header').addClass('long-path');
            $('.fm-new-folder span').text('');
            $('.fm-file-upload span').text('');
            $('.fm-folder-upload span').text('');
        }
        var el = $('.fm-breadcrumbs-block .fm-breadcrumbs span span');
        var i = 0;
        while (M.pathLength() + 260 > $('.fm-right-header').width() && i < el.length) {
            $(el[i]).text('');
            i++;
        }
        $('.fm-breadcrumbs-block a').unbind('click');
        $('.fm-breadcrumbs-block a').bind('click', function(event) {
            if ($(this).attr('id') == 'chatcrumb') return false;
            else if (M.currentdirid && M.currentdirid.substr(0, 7) == 'search/') return false;
            M.openFolder($(this).attr('id').replace('path_', ''));
        });
    };
    this.getById = function(id) {
        if (this.d[id]) return this.d[id];
        else return false;
    };
    this.addNode = function(n, ignoreDB) {
        if (!M.d[n.p] && n.p !== 'contacts') {
            if (n.sk) n.p = n.u;
            else if (n.su) n.p = n.su;
        }
        if (n.p && n.p.length == 11 && !M.d[n.p]) {
            var u = this.u[n.p];
            if (u) {
                u.name = u.m;
                u.h = u.u;
                u.t = 1;
                u.p = 'contacts';
                M.addNode(u);
            } else console.log('something went wrong!', n.p, this.u[n.p]);
        }
        if (mDB && !ignoreDB && !pfkey) mDBadd('f', clone(n));
        if (n.p) {
            if (typeof this.c[n.p] == 'undefined') this.c[n.p] = [];
            this.c[n.p][n.h] = 1;
        }
        if (n.t == 2) this.RootID = n.h;
        if (n.t == 3) this.InboxID = n.h;
        if (n.t == 4) this.RubbishID = n.h;
        if (!n.c) {
            if (n.sk) u_sharekeys[n.h] = crypto_process_sharekey(n.h, n.sk);
            if (n.t !== 2 && n.t !== 3 && n.t !== 4 && n.k) {
                crypto_processkey(u_handle, u_k_aes, n);
                u_nodekeys[n.h] = n.key;
            } else if (!n.k) {
                if (n.a) {
                    if (!missingkeys[n.h]) {
                        missingkeys[n.h] = true;
                        newmissingkeys = true;
                    }
                }
            }
            if (n.hash) {
                if (!this.h[n.hash]) this.h[n.hash] = [];
                this.h[n.hash].push(n.h);
            }
        }
        if (this.d[n.h] && this.d[n.h].shares) n.shares = this.d[n.h].shares;
        this.d[n.h] = n;
        if (typeof newnodes !== 'undefined') newnodes.push(n);
    };
    this.delNode = function(h) {
        var a = 0;

        function ds(h) {
            removeUInode(h);
            if (M.c[h] && h.length < 11) {
                for (var h2 in M.c[h]) ds(h2);
                delete M.c[h];
            }
            if (mDB && !pfkey) mDBdel('f', h);
            if (M.d[h]) {
                M.delIndex(M.d[h].p, h);
                M.delHash(M.d[h]);
                delete M.d[h];
            }
            if (M.v[h]) delete M.v[h];
        }
        ds(h);
    };
    this.delHash = function(n) {
        if (n.hash && M.h[n.hash]) {
            for (var i in M.h[n.hash]) {
                if (M.h[n.hash][i] == n.h) {
                    M.h[n.hash].splice(i, 1);
                    break;
                }
            }
            if (M.h[n.hash].length == 0) delete M.h[n.hash];
        }
    }
    this.addContact = function(email) {
        api_req({
            a: 'ur',
            u: email,
            l: '1',
            i: requesti
        }, {
            callback: function(res, params) {
                if (typeof res == 'object') {
                    if (res.u) {
                        newnodes = [];
                        process_u([{
                            c: 1,
                            m: res.m,
                            h: res.u,
                            u: res.u,
                            ts: (new Date().getTime() / 1000)
                        }], false);
                        rendernew();
                    }
                } else if ((res == 0) || (res == -303)) {
                    var talready = '';
                    if (res == -303) talready = 'already ';
                    msgDialog('info', l[150], l[151].replace('[X]', talready));
                } else if (res == -2) msgDialog('info', l[135], l[152]);
                $('.add-user-popup input').val('');
                loadingDialog.hide();
            }
        });
    };
    this.clearRubbish = function(sel) {
        var selids = [];
        if (sel && $.selected)
            for (var i in $.selected) selids[$.selected[i]] = 1;
        for (var h in M.c[M.RubbishID]) {
            if (!sel || selids[h]) {
                this.delNode(h);
                api_req({
                    a: 'd',
                    n: h,
                    i: requesti
                });
                if (sel) {
                    $('.grid-table.fm#' + h).remove();
                    $('.file-block#' + h).remove();
                }
            }
        }
        var hasFolders = false;
        if (sel)
            for (var h in M.c[M.RubbishID])
                if (M.d[h].t) hasFolders = true;
        if (!hasFolders) {
            $('#treesub_' + M.RubbishID).remove();
            $('.fm-tree-header.recycle-item').removeClass('contains-subfolders expanded recycle-notification');
            if (this.RubbishID == this.currentdirid) {
                $('.grid-table.fm tr').remove();
                $('.file-block').remove();
                $('.fm-empty-trashbin').removeClass('hidden');
            }
        }
        if (this.RubbishID == this.currentdirid) {
            if (M.viewmode) iconUI();
            else gridUI();
        }
        this.rubbishIco();
        treeUI();
    }
    this.addUser = function(u, ignoreDB) {
        this.u[u.u] = u;
        if (mDB && !ignoreDB && !pfkey) mDBadd('u', clone(u));
    };
    this.copyNodes = function(cn, t, del) {
        loadingDialog.show();
        if (t.length == 11 && !u_pubkeys[t]) {
            api_cachepubkeys({
                cachepubkeyscomplete: function(ctx) {
                    if (u_pubkeys[ctx.t]) M.copyNodes(ctx.cn, ctx.t);
                    else {
                        loadingDialog.hide();
                        alert(l[200]);
                    }
                },
                cn: cn,
                t: t
            }, [
                t
            ]);
            return false;
        }
        var a = [];
        var r = [];
        for (var i in cn) {
            var s = fm_getnodes(cn[i]);
            for (var j in s) r.push(s[j]);
            r.push(cn[i]);
        }
        for (var i in r) {
            var n = M.d[r[i]];
            if (n) {
                var ar = clone(n.ar);
                if (typeof ar.fav !== 'undefined') delete ar.fav;
                var mkat = enc_attr(ar, n.key);
                var attr = ab_to_base64(mkat[0]);
                var key;
                if (t.length == 11) key = base64urlencode(encryptto(t, a32_to_str(mkat[1])));
                else key = a32_to_base64(encrypt_key(u_k_aes, mkat[1]));
                var nn = {
                    h: n.h,
                    t: n.t,
                    a: attr,
                    k: key
                };
                var p = n.p;
                for (var j in cn)
                    if (cn[j] == nn.h) p = false;
                if (p) nn.p = p;
                a.push(nn);
            }
        }
        var ops = {
            a: 'p',
            t: t,
            n: a,
            i: requesti
        };
        var s = fm_getsharenodes(t);
        if (s.length > 0) {
            var mn = [];
            for (i in a) mn.push(a[i].h);
            ops.cr = crypto_makecr(mn, s, true);
        }
        api_req(ops, {
            cn: cn,
            del: del,
            t: t,
            callback: function(res, ctx) {
                if (ctx.del) {
                    var j = [];
                    for (var i in ctx.cn) {
                        M.delNode(ctx.cn[i]);
                        api_req({
                            a: 'd',
                            n: cn[i],
                            i: requesti
                        });
                    }
                }
                newnodes = [];
                if (res.u) process_u(res.u, true);
                if (res.f) process_f(res.f);
                loadingDialog.hide();
                rendernew();
            }
        });
    };
    this.moveNodes = function(n, t) {
        newnodes = [];
        var j = [];
        for (var i in n) {
            var h = n[i];
            j.push({
                a: 'm',
                n: h,
                t: t,
                i: requesti
            });
            if (M.d[h] && M.d[h].p) {
                if (M.c[M.d[h].p] && M.c[M.d[h].p][h]) delete M.c[M.d[h].p][h];
                if (typeof M.c[t] == 'undefined') M.c[t] = [];
                M.c[t][h] = 1;
                removeUInode(h);
                this.nodeAttr({
                    h: h,
                    p: t
                });
                newnodes.push(M.d[h]);
            }
        }
        rendernew();
        this.rubbishIco();
        processmove(j);
    }
    this.accountData = function(cb, blockui) {
        if (this.account && this.account.lastupdate > new Date().getTime() - 300000 && cb) cb(this.account);
        else {
            if (blockui) loadingDialog.show();
            account = {};
            api_req({
                a: 'uq',
                strg: 1,
                xfer: 1,
                pro: 1
            }, {
                account: account,
                callback: function(res, ctx) {
                    loadingDialog.hide();
                    if (typeof res == 'object') {
                        ctx.account.type = res.utype;
                        ctx.account.stype = res.stype;
                        ctx.account.stime = res.scycle;
                        ctx.account.scycle = res.snext;
                        ctx.account.expiry = res.suntil;
                        ctx.account.space = Math.round(res.mstrg);
                        ctx.account.space_used = Math.round(res.cstrg);
                        ctx.account.bw = Math.round(res.mxfer);
                        ctx.account.servbw_used = Math.round(res.csxfer);
                        ctx.account.downbw_used = Math.round(res.caxfer);
                        ctx.account.servbw_limit = res.srvratio;
                        ctx.account.balance = res.balance;
                        ctx.account.reseller = res.reseller;
                        ctx.account.prices = res.prices;
                        if (res.balance.length == 0) ctx.account.balance = [
                            ['0.00',
                                'EUR'
                            ]
                        ];
                        if (!u_attr.p) {
                            ctx.account.servbw_used = 0;
                            if (res.tah) {
                                var t = 0;
                                for (var i in res.tah) t += res.tah[i];
                                ctx.account.downbw_used = t;
                                ctx.account.bw = res.tal;
                            }
                        }
                    }
                }
            });
            api_req({
                a: 'uavl'
            }, {
                account: account,
                callback: function(res, ctx) {
                    if (typeof res != 'object') res = [];
                    ctx.account.vouchers = voucherData(res);
                }
            });
            api_req({
                a: 'utt'
            }, {
                account: account,
                callback: function(res, ctx) {
                    if (typeof res != 'object') res = [];
                    ctx.account.transactions = res;
                }
            });
            api_req({
                a: 'utp'
            }, {
                account: account,
                callback: function(res, ctx) {
                    if (typeof res != 'object') res = [];
                    ctx.account.purchases = res;
                }
            });
            api_req({
                a: 'usl'
            }, {
                account: account,
                callback: function(res, ctx) {
                    if (typeof res != 'object') res = [];
                    ctx.account.sessions = res;
                }
            });
            api_req({
                a: 'ug'
            }, {
                cb: cb,
                account: account,
                callback: function(res, ctx) {
                    if (typeof res == 'object') {
                        if (res.p) {
                            u_attr.p = res.p;
                            if (u_attr.p) topmenuUI();
                        }
                    }
                    ctx.account.lastupdate = new Date().getTime();
                    if (!ctx.account.bw) ctx.account.bw = 1024 * 1024 * 1024 * 10;
                    if (!ctx.account.servbw_used) ctx.account.servbw_used = 0;
                    if (!ctx.account.downbw_used) ctx.account.downbw_used = 0;
                    M.account = ctx.account;
                    if (ctx.cb) ctx.cb(ctx.account);
                }
            });
        }
    }
    this.delIndex = function(p, h) {
        if (M.c[p] && M.c[p][h]) delete M.c[p][h];
        var a = 0;
        for (var i in M.c[p]) a++;
        if (a == 0) {
            delete M.c[p];
            $('#treea' + p).removeClass('contains-folders');
        }
    }
    this.rubbishIco = function() {
        var i = 0;
        if (typeof M.c[M.RubbishID] !== 'undefined')
            for (var a in M.c[M.RubbishID]) i++;
        if (i > 0) $('.fm-tree-header.recycle-item').addClass('recycle-notification contains-subfolders');
        else {
            $('.fm-tree-header.recycle-item').removeClass('recycle-notification expanded contains-subfolders');
            $('.fm-tree-header.recycle-item').prev('.fm-connector-first').removeClass('active');
        }
    }
    this.nodeAttr = function(a) {
        var n = M.d[a.h];
        if (n) {
            for (var i in a) n[i] = a[i];
            if (mDB && !pfkey) mDBadd('f', clone(n));
        }
    }
    this.rename = function(h, name) {
        if (M.d[h]) {
            var n = M.d[h];
            if (n && n.ar) {
                n.ar.n = name;
                var mkat = enc_attr(n.ar, n.key);
                var attr = ab_to_base64(mkat[0]);
                var key = a32_to_base64(encrypt_key(u_k_aes, mkat[1]));
                M.nodeAttr({
                    h: h,
                    name: name,
                    a: attr
                });
                api_req({
                    a: 'a',
                    n: h,
                    attr: attr,
                    key: key,
                    i: requesti
                });
                $('.grid-table.fm #' + h + ' .tranfer-filetype-txt').text(name);
                $('.file-block#' + h + ' .file-block-title').text(name);
                $('#treea_' + h + ' span').text(name);
                if ($('#path_' + h).length > 0) M.renderPath();
            }
        }
    }
    this.favourite = function(h_ar, del) {
        if (del) del = 0;
        else del = 1;
        for (var i in h_ar) {
            if (M.d[h_ar[i]]) {
                var n = M.d[h_ar[i]];
                if (n && n.ar) {
                    n.ar.fav = del;
                    var mkat = enc_attr(n.ar, n.key);
                    var attr = ab_to_base64(mkat[0]);
                    var key = a32_to_base64(encrypt_key(u_k_aes, mkat[1]));
                    M.nodeAttr({
                        h: n.h,
                        fav: del,
                        a: attr
                    });
                    api_req({
                        a: 'a',
                        n: n.h,
                        attr: attr,
                        key: key,
                        i: requesti
                    });
                    if (!m) {
                        if (del) {
                            $('.grid-table.fm #' + n.h + ' .grid-status-icon').addClass('star');
                            $('.file-block#' + n.h + ' .file-status-icon').addClass('star');
                        } else {
                            $('.grid-table.fm #' + n.h + ' .grid-status-icon').removeClass('star');
                            $('.file-block#' + n.h + ' .file-status-icon').removeClass('star');
                        }
                    }
                }
            }
        }
    }
    this.nodeShare = function(h, s, ignoreDB) {
        if (this.d[h]) {
            if (typeof this.d[h].shares == 'undefined') this.d[h].shares = [];
            this.d[h].shares[s.u] = s;
            if (mDB) {
                s['h_u'] = h + '_' + s.u;
                if (mDB && !ignoreDB && !pfkey) mDBadd('s', clone(s));
            }
            sharedUInode(h, 1);
            if ($.dialog == 'sharing' && $.selected && $.selected[0] == h) shareDialog();
            if (mDB && !pfkey) mDBadd('ok', {
                h: h,
                k: a32_to_base64(encrypt_key(u_k_aes, u_sharekeys[h])),
                ha: crypto_handleauth(h)
            });
        }
    }
    this.delnodeShare = function(h, u) {
        console.log('delnodeShare');
        if (this.d[h] && typeof this.d[h].shares !== 'undefined') {
            delete this.d[h].shares[u];
            var a = 0;
            for (var i in this.d[h].shares)
                if (this.d[h].shares[i]) a++;
            if (a == 0) {
                delete this.d[h].shares;
                M.nodeAttr({
                    h: h,
                    shares: undefined
                });
                delete u_sharekeys[h];
                sharedUInode(h, 0);
                if (mDB) mDBdel('ok', h);
            }
            if (mDB) mDBdel('s', h + '_' + u);
            if ($.dialog == 'sharing' && $.selected && $.selected[0] == h) shareDialog();
        }
    }
    this.getlinks = function(h) {
        loadingDialog.show();
        this.links = [];
        this.folderlinks = [];
        for (var i in h) {
            var n = M.d[h[i]];
            if (n) {
                if (n.t) this.folderlinks.push(n.h);
                this.links.push(n.h);
            }
        }
        if (d) console.log('getlinks', this.links);
        if (this.folderlinks.length > 0) this.getFolderlinks();
        else this.getlinksDone();
    }
    this.getlinksDone = function() {
        for (var i in this.links) api_req({
            a: 'l',
            n: this.links[i]
        }, {
            node: this.links[i],
            last: i == this.links.length - 1,
            callback: function(res, ctx) {
                if (typeof res != 'number') M.nodeAttr({
                    h: M.d[ctx.node].h,
                    ph: res
                });
                if (ctx.last) {
                    linksDialog();
                    loadingDialog.hide();
                }
            }
        });
    }
    this.getFolderlinks = function() {
        if (this.folderlinks.length > 0) {
            var n = M.d[this.folderlinks[0]];
            this.folderlinks.splice(0, 1);
            if (n) {
                this.fln = n;
                if (n.shares && n.shares['EXP']) this.getFolderlinks();
                else {
                    var h = fm_getnodes(n.h);
                    h.push(n.h);
                    api_setshare(n.h, [{
                        u: 'EXP',
                        r: 0
                    }], h, {
                        done: function(res) {
                            if (res.r && res.r[0] == 0) M.nodeShare(M.fln.h, {
                                h: M.fln.h,
                                r: 0,
                                u: 'EXP',
                                ts: Math.floor(new Date().getTime() / 1000)
                            });
                            M.getFolderlinks();
                        }
                    });
                }
            } else this.getFolderlinks();
        } else this.getlinksDone();
    }
    this.makeDir = function(n) {
        if (is_chrome_firefox & 4) return;
        var dirs = [];

        function getfolders(d, o) {
            var c = 0;
            for (var e in M.d) {
                if (M.d[e].t == 1 && M.d[e].p == d) {
                    var p = o || [];
                    if (!o) p.push(fm_safename(M.d[d].name));
                    p.push(fm_safename(M.d[e].name));
                    if (!getfolders(M.d[e].h, p)) dirs.push(p);
                    ++c;
                }
            }
            return c;
        }
        getfolders(n);
        if (d) console.log('makedir', dirs);
        if (is_chrome_firefox) {
            var root = mozGetDownloadsFolder();
            if (root) dirs.filter(String).forEach(function(p) {
                try {
                    p = mozFile(root, 0, p);
                    if (!p.exists()) p.create(Ci.nsIFile.DIRECTORY_TYPE, parseInt('0755', 8));
                } catch (e) {
                    Cu.reportError(e);
                    console.log('makedir', e.message);
                }
            });
        } else {
            if (d) console.log('MAKEDIR: TODO');
        }
    }
    this.addDownload = function(n, z, preview) {
        // todo cesar: preview parameter indicates that this is a image fpreview download
        delete $.dlhash;
        var zipname,
            path;
        var nodes = [];
        var paths = {};
        for (var i in n) {
            if (M.d[n[i]]) {
                if (M.d[n[i]].t) {
                    if (!z) this.makeDir(n[i]);
                    var subids = fm_getnodes(n[i]);
                    for (var j in subids) {
                        var p = this.getPath(subids[j]);
                        var path = '';
                        for (var k in p) {
                            if (p[k], M.d[p[k]].t) path = fm_safename(M.d[p[k]].name) + '/' + path;
                            if (p[k] == n[i]) break;
                        }
                        if (!M.d[subids[j]].t) {
                            nodes.push(subids[j]);
                            paths[subids[j]] = path;
                        } else console.log('0 path', path);
                    }
                } else {
                    nodes.push(n[i]);
                }
            }
        }
        if (z) {
            zipid++;
            z = zipid;
            if (M.d[n[0]] && M.d[n[0]].t) zipname = M.d[n[0]].name + '.zip';
            else zipname = 'Archive-' + Math.random().toString(16).slice(-4) + '.zip';
            var zipsize = 0;
        } else z = false;
        if (!$.totalDL) $.totalDL = 0;
        for (var i in nodes) {
            n = M.d[nodes[i]];
            if (paths[nodes[i]]) path = paths[nodes[i]];
            else path = '';
            $.totalDL += n.s;
            var li = $('.transfer-table #' + 'dl_' + htmlentities(n.h));
            if (li.length == 0) {
                dl_queue.push({
                    id: n.h,
                    key: n.key,
                    n: n.name,
                    t: n.ts,
                    p: path,
                    size: n.s,
                    onDownloadProgress: this.dlprogress,
                    onDownloadComplete: this.dlcomplete,
                    onBeforeDownloadComplete: this.dlbeforecomplete,
                    onDownloadError: this.dlerror,
                    onDownloadStart: this.dlstart,
                    zipid: z,
                    zipname: zipname,
                    preview: preview
                });
                zipsize += n.s;
                var flashhtml = '';
                if (dlMethod == FlashIO) {
                    flashhtml = '<object width="1" height="1" id="dlswf_' + htmlentities(n.h) + '" type="application/x-shockwave-flash"><param name=FlashVars value="buttonclick=1" /><param name="movie" value="' + document.location.origin + '/downloader.swf"/><param value="always" name="allowscriptaccess"><param name="wmode" value="transparent"><param value="all" name="allowNetworking"></object>';
                }
                if (!z) $('.transfer-table').append('<tr id="dl_' + htmlentities(n.h) + '"><td><span class="transfer-filtype-icon ' + fileicon(n) + '"></span><span class="tranfer-filetype-txt">' + htmlentities(n.name) + '</span></td><td>' + bytesToSize(n.s) + '</td><td><span class="transfer-type download">' + l[373] + '</span>' + flashhtml + '</td><td><span class="transfer-status queued">Queued</span></td><td></td><td></td><td></td></tr>');
            }
        }
        if (dlMethod == MemoryIO && ~ua.indexOf(') gecko') && !localStorage.firefoxDialog && $.totalDL > 104857600) Later(firefoxDialog);
        var flashhtml = '';
        if (dlMethod == FlashIO) {
            flashhtml = '<object width="1" height="1" id="dlswf_zip_' + htmlentities(z) + '" type="application/x-shockwave-flash"><param name=FlashVars value="buttonclick=1" /><param name="movie" value="' + document.location.origin + '/downloader.swf"/><param value="always" name="allowscriptaccess"><param name="wmode" value="transparent"><param value="all" name="allowNetworking"></object>';
        }
        if (z) $('.transfer-table').append('<tr id="zip_' + zipid + '"><td><span class="transfer-filtype-icon ' + fileicon({
            name: 'archive.zip'
        }) + '"></span><span class="tranfer-filetype-txt">' + htmlentities(zipname) + '</span></td><td>' + bytesToSize(zipsize) + '</td><td><span class="transfer-type download">' + l[373] + '</span>' + flashhtml + '</td><td><span class="transfer-status queued">Queued</span></td><td></td><td></td><td></td></tr>');
        //		$('.tranfer-view-icon').addClass('active');
        //		$('.fmholder').addClass('transfer-panel-opened');
        //		$.transferHeader();
        if (!preview) {
            openTransferpanel();
            initGridScrolling();
            initFileblocksScrolling();
            initTreeScroll();
            setupTransferAnalysis();
            downloading = !!dl_queue.length;
        }
        delete $.dlhash;
    }
    this.dlprogress = function(id, perc, bl, bt, kbps, dl_queue_num, force) {
        var st;
        if (dl_queue[dl_queue_num].zipid) {
            id = 'zip_' + dl_queue[dl_queue_num].zipid;
            var tl = 0;
            var ts = 0;
            for (var i in dl_queue) {
                if (dl_queue[i].zipid == dl_queue[dl_queue_num].zipid) {
                    if (!st) st = dl_queue[i].st;
                    ts += dl_queue[i].size;
                    if (dl_queue[i].complete) tl += dl_queue[i].size;
                }
            }
            bt = ts;
            bl = tl + bl;
        } else {
            id = 'dl_' + id;
            st = dl_queue[dl_queue_num].st;
        }
        // var failed = parseInt($('#' + id).data('failed') || "0");
        // failed not long ago
        // if (failed+30000 > NOW()) return;

        if (!bl) return false;
        if (!$.transferprogress) $.transferprogress = {};
        if (kbps == 0) {
            if (!force && (perc != 100 || $.transferprogress[id])) return false;
        }
        if ($('.transfer-table #' + id + ' .progress-block').length == 0) {
            $('.transfer-table #' + id + ' td:eq(3)').html('<div class="progress-block" style=""><div class="progressbar-percents">0%</div><div class="progressbar"><div class="progressbarfill" style="width:0%;"></div></div><div class="clear"></div></div>');
            $.transferHeader();
        }
        var eltime = (new Date().getTime() - st) / 1000;
        var bps = kbps * 1000;
        var retime = bps && (bt - bl) / bps;
        if (bt) {
            // $.transferprogress[id] = Math.floor(bl/bt*100);
            $.transferprogress[id] = [
                bl,
                bt
            ];
            if (!uldl_hold) {
                if (slideshowid == dl_queue[dl_queue_num].id && !previews[slideshowid]) {
                    $('.slideshow-error').addClass('hidden');
                    $('.slideshow-pending').addClass('hidden');
                    $('.slideshow-progress').attr('class', 'slideshow-progress percents-' + perc);
                }
                $('.transfer-table #' + id + ' .progressbarfill').css('width', perc + '%');
                $('.transfer-table #' + id + ' .progressbar-percents').text(perc + '%');
                $('.transfer-table #' + id + ' td:eq(4)').text(bytesToSize(bps, 1) + '/s');
                $('.transfer-table #' + id + ' td:eq(5)').text(secondsToTime(eltime));
                $('.transfer-table #' + id + ' td:eq(6)').text(secondsToTime(retime));
                percent_megatitle();
                if (page.substr(0, 2) !== 'fm') {
                    $('.widget-block').removeClass('hidden');
                    $('.widget-block').show();
                    if (!ul_uploading) $('.widget-circle').attr('class', 'widget-circle percents-' + perc);
                    $('.widget-icon.downloading').removeClass('hidden');
                    $('.widget-speed-block.dlspeed').text(bytesToSize(bps, 1) + '/s');
                    $('.widget-block').addClass('active');
                }
            }
        }
    }
    this.dlcomplete = function(dl) {
        var id = dl.id,
            z = dl.zipid;
        if (slideshowid == id && !previews[slideshowid]) {
            $('.slideshow-pending').addClass('hidden');
            $('.slideshow-error').addClass('hidden');
            $('.slideshow-progress').attr('class', 'slideshow-progress percents-100');
        }
        if (z) id = 'zip_' + z;
        else id = 'dl_' + id;
        $('.transfer-table #' + id + ' td:eq(3)').html('<span class="transfer-status completed">' + l[554] + '</span>');
        if ($('#dlswf_' + id.replace('dl_', '')).length > 0) {
            var flashid = id.replace('dl_', '');
            $('#dlswf_' + flashid).width(170);
            $('#dlswf_' + flashid).height(22);
            $('#' + id + ' .transfer-type').removeClass('download').addClass('safari-downloaded').text('Save File');
        } else {
            $('.transfer-table #' + id).fadeOut('slow', function(e) {
                $(this).remove();
            });
        }
        if (dlMethod == FileSystemAPI) {
            setTimeout(fm_chromebar, 250, $.dlheight);
            setTimeout(fm_chromebar, 500, $.dlheight);
            setTimeout(fm_chromebar, 1000, $.dlheight);
        }
        var a = dl_queue.filter(isQueueActive).length;
        if (a < 2 && !ul_uploading) {
            $('.widget-block').fadeOut('slow', function(e) {
                $('.widget-block').addClass('hidden');
                $('.widget-block').css({
                    opacity: 1
                });
            });
        } else if (a < 2) $('.widget-icon.downloading').addClass('hidden');
        else $('.widget-circle').attr('class', 'widget-circle percents-0');
        if ($.transferprogress && $.transferprogress[id]) {
            if (!$.transferprogress['dlc']) $.transferprogress['dlc'] = 0;
            $.transferprogress['dlc'] += $.transferprogress[id][1];
            delete $.transferprogress[id];
        }
        $.transferHeader();
        Soon(resetUploadDownload);
    }
    this.dlbeforecomplete = function() {
        $.dlheight = $('body').height();
    }
    this.dlerror = function(dl, error) {
        var errorstr,
            fileid = dl.dl_id,
            x;
        if (d) console.log('dlerror', fileid, error);
        else window.onerror('onDownloadError :: ' + error + ' [' + hostname(dl.url) + '] ' + (dl.zipid ? 'isZIP' : ''), '', -1);
        switch (error) {
            case ETOOMANYCONNECTIONS:
                errorstr = l[18];
                break;
            case ESID:
                errorstr = l[19];
                break;
            case EBLOCKED:
            case ETOOMANY:
            case EACCESS:
                errorstr = l[23];
                break;
            case ENOENT:
                errorstr = l[22];
                break;
            case EKEY:
                errorstr = l[24];
                break;
            case EOVERQUOTA:
                if (d) console.log('Quota error');
                // errorstr = l[233];
                // break;
                // case EAGAIN:               errorstr = l[233]; break;
                // case ETEMPUNAVAIL:         errorstr = l[233]; break;
            default:
                errorstr = l[x = 233];
                break;
        }
        if (slideshowid == dl.id && !previews[slideshowid]) {
            $('.slideshow-image-bl').addClass('hidden');
            $('.slideshow-pending').addClass('hidden');
            $('.slideshow-progress').addClass('hidden');
            $('.slideshow-error').removeClass('hidden');
            $('.slideshow-error-txt').text(errorstr);
        }
        if (errorstr) {
            dl.failed = new Date;
            var id = (dl.zipid ? 'zip_' + dl.zipid : 'dl_' + fileid);
            if (x != 233 || !(GlobalProgress[id] || {}).speed) {
                /**
                 * a chunk may fail at any time, don't report a temporary error while
                 * there is network activity associated with the download, though.
                 */
                $('.transfer-table #' + id + ' td:eq(3)').html('<span class="transfer-status error">' + htmlentities(errorstr) + '</span>')
                // .parents('tr').data({'failed' : NOW()});
                $('.transfer-table #' + id + ' td:eq(4)').text('');
                $('.transfer-table #' + id + ' td:eq(6)').text('--:--:--');
            }
        }
    }
    this.dlstart = function(dl) {
        var id = (dl.zipid ? 'zip_' + dl.zipid : 'dl_' + dl.dl_id);
        $('.transfer-table #' + id + ' td:eq(3)').html('<span class="transfer-status initiliazing">' + htmlentities(l[1042]) + '</span>');
        $('.transfer-table').prepend($('.transfer-table #' + id));
        dl.st = NOW();
        ASSERT(typeof dl_queue[dl.pos] === 'object', 'No dl_queue entry for the provided dl...');
        ASSERT(typeof dl_queue[dl.pos] !== 'object' || dl.n == dl_queue[dl.pos].n, 'No matching dl_queue entry...');
        if (typeof dl_queue[dl.pos] === 'object') M.dlprogress(id, 0, 0, 0, 0, dl.pos);
        $.transferHeader();
    }
    this.mobileuploads = [];
    $(document).on('remove', '.transfer-table tr', function() {
        var toClean = 0
        $.each(panelDomQueue, function(i, html) {
            if ($('.transfer-table tr:visible').length - 1 > DOM_TRANSFER_LIMIT) {
                return false;
            }
            $(html).appendTo('.transfer-table')
            toClean++
        });
        panelDomQueue.splice(0, toClean);
        if (panelDomQueue.length == 0 && $('.transfer-table tr:visible').length - 1 == 0) {
            $.transferClose();
            resetUploadDownload();
        }
    });
    this.addToTransferTable = function(elem) {
        if ($('.transfer-table tr').length > DOM_TRANSFER_LIMIT) {
            return panelDomQueue.push(elem);
        }
        $(elem).appendTo('.transfer-table')
    }
    var __ul_id = 8000;
    this.addUpload = function(u) {
        for (var i in u) {
            var f = u[i];
            var ul_id = ++__ul_id;
            if (!f.flashid) f.flashid = false;
            f.target = M.currentdirid;
            f.id = ul_id;
            this.addToTransferTable('<tr id="ul_' + ul_id + '"><td><span class="transfer-filtype-icon ' + fileicon({
                name: f.name
            }) + '"></span><span class="tranfer-filetype-txt">' + htmlentities(f.name) + '</span></td><td>' + bytesToSize(f.size) + '</td><td><span class="transfer-type upload">' + l[372] + '</span></td><td><span class="transfer-status queued">Queued</span></td><td></td><td></td><td></td></tr>');
            ul_queue.push(f);
        }
        if (page == 'start') {
            ulQueue.pause();
            uldl_hold = false; /* this isn't a pause generated by the UI */
        } else openTransferpanel();
        setupTransferAnalysis();
        ul_uploading = !!ul_queue.length;
    }
    this.ulprogress = function(ul, perc, bl, bt, bps) {
        var id = ul.id;
        if ($('.transfer-table #ul_' + id + ' .progress-block').length == 0) {
            $('.transfer-table #ul_' + id + ' .transfer-status').removeClass('queued');
            $('.transfer-table #ul_' + id + ' .transfer-status').addClass('download');
            $('.transfer-table #ul_' + id + ' td:eq(3)').html('<div class="progress-block" style=""><div class="progressbar-percents">0%</div><div class="progressbar"><div class="progressbarfill" style="width:0%;"></div></div><div class="clear"></div></div>');
            $.transferHeader();
        }
        if (!bl || !ul.starttime) return false;
        var eltime = (new Date().getTime() - ul.starttime) / 1000;
        var retime = bps > 1000 ? (bt - bl) / bps : -1;
        if (!$.transferprogress) $.transferprogress = {};
        if (bl && bt && !uldl_hold) {
            // $.transferprogress[id] = Math.floor(bl/bt*100);
            $.transferprogress['ul_' + id] = [
                bl,
                bt
            ];
            $('.transfer-table #ul_' + id + ' .progressbarfill').css('width', perc + '%');
            $('.transfer-table #ul_' + id + ' .progressbar-percents').text(perc + '%');
            $('.transfer-table #ul_' + id + ' td:eq(4)').text(bps ? bytesToSize(bps, 1) + '/s' : '');
            $('.transfer-table #ul_' + id + ' td:eq(5)').text(secondsToTime(eltime));
            $('.transfer-table #ul_' + id + ' td:eq(6)').text(secondsToTime(retime));
            $.transferHeader();
            if (page.substr(0, 2) !== 'fm') {
                $('.widget-block').removeClass('hidden');
                $('.widget-block').show();
                $('.widget-circle').attr('class', 'widget-circle percents-' + perc);
                $('.widget-icon.uploading').removeClass('hidden');
                $('.widget-speed-block.ulspeed').text(bytesToSize(bps, 1) + '/s');
                $('.widget-block').addClass('active');
            }
        }
        percent_megatitle();
    }
    this.ulcomplete = function(ul, h, k) {
        var id = ul.id;
        this.mobile_ul_completed = true;
        for (var i in this.mobileuploads) {
            if (id == this.mobileuploads[i].id) this.mobileuploads[i].done = 1;
            if (!this.mobileuploads[i].done) this.mobile_ul_completed = false;
        }
        if (this.mobile_ul_completed) {
            $('.upload-status-txt').text(l[554]);
            $('#mobileuploadtime').addClass('complete');
            $('#uploadpopbtn').text(l[726]);
            $('#mobileupload_header').text(l[554]);
        }
        $('.transfer-table #ul_' + id + ' td:eq(3)').html('<span class="transfer-status completed">' + l[554] + '</span>');
        $('.transfer-table #ul_' + id).fadeOut('slow', function(e) {
            $(this).remove();
        });
        var a = ul_queue.filter(isQueueActive).length;
        if (a < 2 && !ul_uploading) {
            $('.widget-block').fadeOut('slow', function(e) {
                $('.widget-block').addClass('hidden');
                $('.widget-block').css({
                    opacity: 1
                });
            });
        } else if (a < 2) $('.widget-icon.uploading').addClass('hidden');
        else $('.widget-circle').attr('class', 'widget-circle percents-0');
        if ($.transferprogress && $.transferprogress['ul_' + id]) {
            if (!$.transferprogress['ulc']) $.transferprogress['ulc'] = 0;
            $.transferprogress['ulc'] += $.transferprogress['ul_' + id][1];
            delete $.transferprogress['ul_' + id];
        }
        $.transferHeader();
        Soon(resetUploadDownload);
    }
    this.ulstart = function(ul) {
        var id = ul.id;
        if (d) console.log('ulstart', id);
        $('.transfer-table #ul_' + id + ' td:eq(3)').html('<span class="transfer-status initiliazing">' + htmlentities(l[1042]) + '</span>');
        ul.starttime = new Date().getTime();
        $('.transfer-table').prepend($('.transfer-table #ul_' + id));
        M.ulprogress(ul, 0, 0, 0);
        $.transferHeader();
    }
}

function voucherData(arr) {
    var vouchers = [];
    var varr = arr[0];
    var tindex = {};
    for (var i in arr[1]) tindex[arr[1][i][0]] = arr[1][i];
    for (var i in varr) {
        var redeemed = 0;
        var cancelled = 0;
        var revoked = 0;
        var redeem_email = '';
        if ((varr[i].rdm) && (tindex[varr[i].rdm])) {
            redeemed = tindex[varr[i].rdm][1];
            redeemed_email = tindex[varr[i].rdm][2];
        }
        if (varr[i].xl) cancelled = tindex[varr[i].xl][1];
        if (varr[i].rvk) revoked = tindex[varr[i].rvk][1];
        vouchers.push({
            id: varr[i].id,
            amount: varr[i].g,
            currency: varr[i].c,
            iss: varr[i].iss,
            date: tindex[varr[i].iss][1],
            code: varr[i].v,
            redeemed: redeemed,
            redeem_email: redeem_email,
            cancelled: cancelled,
            revoked: revoked
        });
    }
    return vouchers;
}

function onUploadError(ul, errorstr, reason, xhr) {
    var hn = hostname(ul.posturl);
    if (!d && (!xhr || xhr.readyState < 2 || xhr.status)) {
        var details = [
            browserdetails(ua).name,
            '' + reason,
            xhr ? (xhr.readyState > 1 && xhr.status) : 'NoXHR',
            hn
        ];
        window.onerror('onUploadError :: ' + errorstr + ' [' + details.join('] [') + ']', '', -1);
    }
    if (d) console.error('onUploadError', ul.id, ul.name, errorstr, reason, hn);
    $('.transfer-table #ul_' + ul.id + ' td:eq(3)').html('<span class="transfer-status error">' + htmlentities(errorstr) + '</span>').parents('tr').data({
        'failed': NOW()
    });
}

function addupload(u) {
    M.addUpload(u);
}

function onUploadStart(id) {
    M.ulstart(id);
}

function onUploadProgress(id, p, bl, bt, speed) {
    M.ulprogress(id, p, bl, bt, speed);
}

function onUploadSuccess(id, bl, bt) {
    M.ulcomplete(id, bl, bt);
}

function fm_chromebar(height) {
    if (window.navigator.userAgent.toLowerCase().indexOf('mac') >= 0 || localStorage.chromeDialog == 1) return false;
    var h = height - $('body').height();
    if ((h > 33) && (h < 41)) {
        setTimeout(fm_chromebarcatchclick, 500, $('body').height());
        chromeDialog();
    }
}

function fm_chromebarcatchclick(height) {
    if ($('body').height() != height) {
        chromeDialog(1);
        return false;
    }
    setTimeout(fm_chromebarcatchclick, 200, height);
}

function fm_safename(name) {
    // http://msdn.microsoft.com/en-us/library/aa365247(VS.85)
    name = ('' + name).replace(/[:\/\\<">|?*]+/g, '.').replace(/\s*\.+/g, '.');
    if (name.length > 250) name = name.substr(0, 250) + '.' + name.split('.').pop();
    name = name.replace(/\s+/g, ' ').trim();
    var end = name.lastIndexOf('.');
    end = ~end && end || name.length;
    if (/^(?:CON|PRN|AUX|NUL|COM\d|LPT\d)$/i.test(name.substr(0, end))) name = '!' + name;
    return name;
}

function fm_safepath(path, file) {
    path = ('' + (path || '')).split(/[\\\/]+/).map(fm_safename).filter(String);
    if (file) path.push(fm_safename(file));
    return path;
}

function fm_matchname(p, name) {
    var a = [];
    for (var i in M.d) {
        var n = M.d[i];
        if (n.p == p && name == n.name) a.push({
            id: n.h,
            size: n.s,
            name: n.name
        });
    }
    return a;
}
var t;

function renderfm() {
    var t = new Date().getTime();
    initUI();
    loadingDialog.hide();
    M.sortByName();
    M.renderTree();
    M.renderPath();
    var c = $('#treesub_' + M.RootID).attr('class');
    if (c && c.indexOf('opened') < 0) {
        $('.fm-tree-header.cloud-drive-item').addClass('opened');
        $('#treesub_' + M.RootID).addClass('opened');
    }
    M.openFolder(M.currentdirid);
    if (d) console.log('renderfm() time:', t - new Date().getTime());
}

function rendernew() {
    var t = new Date().getTime();
    var treebuild = [];
    var UImain = false;
    var newcontact = false;
    var newpath = false;
    for (var i in newnodes) {
        var n = newnodes[i];
        if (n.h.length == 11) newcontact = true;
        if (n && n.p && n.t) treebuild[n.p] = 1;
        if (n.p == M.currentdirid || n.h == M.currentdirid) UImain = true;
        if ($('#path_' + n.h).length > 0) newpath = true;
    }
    var UItree = false;
    for (var h in treebuild) {
        var n = M.d[h];
        if (n) {
            M.buildtree(n);
            UItree = true;
        }
    }
    if (UImain) {
        M.filterByParent(M.currentdirid);
        M.sort();
        M.renderMain(true);
        M.renderPath();
        $(window).trigger('resize');
    }
    if (UItree) {
        treeUI();
        treeUIopen(M.currentdirid);
    }
    if (newcontact) {
        M.avatars();
        M.buildtree({
            h: 'contacts'
        });
        treeUIopen('contacts');
        treeUI();
    }
    if (newpath) M.renderPath();
    newnodes = undefined;
}

function execsc(ap) {
    var tparentid = false;
    var trights = false;
    var tmoveid = false;
    var rootsharenodes = [];
    var loadavatars = false;
    newnodes = [];
    // actionpackets:
    for (var i in ap) {
        var a = ap[i];
        if (d) console.log('actionpacket', a);
        if (a.i == requesti) {
            if (d) console.log('OWN ACTION PACKET');
        } else if (a.a == 'fa') {
            M.nodeAttr({
                h: a.n,
                fa: a.fa
            });
        } else if (a.a == 's' && !folderlink) {
            var tsharekey = '';
            var prockey = false;
            if (a.o == u_handle) {
                if (typeof a.r == 'undefined') {
                    // I deleted my share							
                    M.delnodeShare(a.n, a.u);
                } else if (typeof M.d[a.n].shares != 'undefined' && M.d[a.n].shares[a.u] || a.ha == crypto_handleauth(a.n)) {
                    // I updated or created my share
                    u_sharekeys[a.n] = decrypt_key(u_k_aes, base64_to_a32(a.ok));
                    M.nodeShare(a.n, {
                        h: a.n,
                        r: a.r,
                        u: a.u,
                        ts: a.ts
                    });
                }
            } else {
                if (typeof a.n != 'undefined' && typeof a.k != 'undefined' && typeof u_sharekeys[a.n] == 'undefined') {
                    u_sharekeys[a.n] = crypto_process_sharekey(a.n, a.k);
                    tsharekey = a32_to_base64(u_k_aes.encrypt(u_sharekeys[a.n]));
                    prockey = true;
                }
                if (typeof a.o != 'undefined') {
                    if (typeof a.r == 'undefined') {
                        console.log('delete a share');
                        // delete a share:
                        var n = M.d[a.n];
                        if (n && n.p.length != 11) M.nodeAttr({
                            h: a.n,
                            r: 0,
                            su: ''
                        });
                        else M.delNode(a.n);
                        if (!folderlink && a.u !== 'EXP' && fminitialized) addnotification({
                            t: 'dshare',
                            n: a.n,
                            u: a.o
                        });
                        delete u_sharekeys[a.n];
                    } else {
                        console.log('I receive a share, prepare for receiving tree a');
                        // I receive a share, prepare for receiving tree a
                        tparentid = a.o;
                        trights = a.r;
                        if (M.d[a.n]) {
                            // update rights:
                            M.nodeAttr({
                                h: a.n,
                                r: a.r,
                                su: a.o
                            });
                        } else {
                            console.log('look up other root-share-nodes from this user');
                            // look up other root-share-nodes from this user:
                            if (typeof M.c[a.o] != 'undefined')
                                for (var i in M.c[a.o])
                                    if (M.d[i] && M.d[i].t == 1) rootsharenodes[i] = 1;
                            if (!folderlink && fminitialized) addnotification({
                                t: 'share',
                                n: a.n,
                                u: a.o
                            });
                        }
                    }
                }
            }
            if (prockey) {
                var nodes = fm_getnodes(a.n, 1);
                nodes.push(a.n);
                for (var i in nodes) {
                    var n = M.d[nodes[i]];
                    if (n) {
                        var f = {
                            a: n.a,
                            h: n.h,
                            k: n.k
                        };
                        crypto_processkey(u_handle, u_k_aes, f);
                        M.nodeAttr({
                            h: nodes[i],
                            name: f.name,
                            key: f.key,
                            sk: tsharekey
                        });
                        newnodes.push(M.d[n.h]);
                    }
                }
            }
            crypto_share_rsa2aes();
        } else if (a.a == 'k' && !folderlink) {
            if (a.sr) crypto_procsr(a.sr);
            else if (a.cr) crypto_proccr(a.cr);
            else api_req({
                a: 'k',
                cr: crypto_makecr(a.n, [
                    a.h
                ], true)
            });
        } else if (a.a == 't') {
            if (tparentid) {
                for (var b in a.t.f) {
                    if (rootsharenodes[a.t.f[b].h] && M.d[a.t.f[b].h]) {
                        a.t.f[b].r = M.d[a.t.f[b].h].r;
                        a.t.f[b].su = M.d[a.t.f[b].h].su;
                        M.delNode(a.t.f[b].h);
                    }
                }
                if (!M.d[a.t.f[0].p]) a.t.f[0].p = tparentid;
                a.t.f[0].su = tparentid;
                a.t.f[0].r = trights;
                if (tsharekey) {
                    a.t.f[0].sk = tsharekey;
                    tsharekey = false;
                }
                rootsharenodes = [];
            }
            // notification logic:

            if (fminitialized && !folderlink && a.ou && a.ou != u_handle && a.t && a.t.f && a.t.f[0] && a.t.f[0].p.length < 11 && !tmoveid && !tparentid) {
                var targetid = a.t.f[0].p;
                var pnodes = [];
                for (var i in a.t.f)
                    if (a.t.f[i].p == targetid) pnodes.push({
                        h: a.t.f[i].h,
                        t: a.t.f[i].t
                    });
                addnotification({
                    t: 'put',
                    n: targetid,
                    u: a.ou,
                    f: pnodes
                });
            }
            tparentid = false;
            trights = false;
            process_f(a.t.f);
        } else if (a.a == 'c') {
            process_u(a.u);
        } else if (a.a == 'd') {
            M.delNode(a.n);
        } else if (a.a == 'ua' && fminitialized) {
            for (var i in a.ua) {
                if (a.ua[i] == '+a') {
                    avatars[a.u] = undefined;
                    loadavatars = true;
                }
            }
        } else if (a.a == 'u') {
            var n = M.d[a.n];
            if (n) {
                var f = {
                        h: a.n,
                        k: a.k,
                        a: a.at
                    },
                    newpath = 0;
                crypto_processkey(u_handle, u_k_aes, f);
                if (f.key) {
                    u_nodekeys[a.n] = f.key;
                    if (f.name !== n.name) {
                        $('.grid-table.fm #' + n.h + ' .tranfer-filetype-txt').text(f.name);
                        $('.file-block#' + n.h + ' .file-block-title').text(f.name);
                        $('#treea_' + n.h + ' span').text(f.name);
                        if ($('#path_' + n.h).length > 0) newpath = 1;
                        if (n.h == M.RootID) $('.fm-tree-header.cloud-drive-item span').text(f.name);
                    }
                    if (f.fav !== n.fav) {
                        if (f.fav) {
                            $('.grid-table.fm #' + n.h + ' .grid-status-icon').addClass('star');
                            $('.file-block#' + n.h + ' .file-status-icon').addClass('star');
                        } else {
                            $('.grid-table.fm #' + n.h + ' .grid-status-icon').removeClass('star');
                            $('.file-block#' + n.h + ' .file-status-icon').removeClass('star');
                        }
                    }
                    M.nodeAttr({
                        h: a.n,
                        fav: f.fav,
                        name: f.name,
                        key: f.key,
                        a: a.at
                    });
                    if (newpath) M.renderPath();
                }
                if (a.cr) crypto_proccr(a.cr);
            }
        } else if (a.a == 'la') {
            notifymarkcount(true);
            donotify();
        } else {
            if (d) console.log('not processing this action packet', a);
        }
    }
    if (newnodes.length > 0 && fminitialized) rendernew();
    if (loadavatars) M.avatars();
    fm_thumbnails();
    if ($.dialog == 'properties') propertiesDialog();
    getsc();
}
var M = new MegaData();

function fm_updatekey(h, k) {
    var n = M.d[h];
    if (n) {
        var f = {
            h: h,
            k: k,
            a: M.d[h].a
        };
        crypto_processkey(u_handle, u_k_aes, f);
        u_nodekeys[h] = f.key;
        M.nodeAttr({
            h: h,
            name: f.name,
            key: f.key,
            k: k
        });
    }
}

function fm_commitkeyupdate() {
    // refresh render?
}

function loadfm() {
    M.reset();
    fminitialized = false;
    loadingDialog.show();
    api_req({
        a: 'f',
        c: 1,
        r: 1
    }, {
        callback: loadfm_callback
    }, n_h ? 1 : 0);
}

function RightsbyID(id) {
    if (folderlink) return false;
    if (id.length > 8) return false;
    var p = M.getPath(id);
    if (p[p.length - 1] == 'contacts') return M.d[p[p.length - 3]].r;
    else return 2;
}

function isCircular(fromid, toid) {
    var n = M.d[fromid];
    if (n && n.t) {
        if (toid == fromid) return false;
        var p1 = M.getPath(fromid);
        var p2 = M.getPath(toid);
        p1.reverse();
        p2.reverse();
        var c = 1;
        for (var i in p1)
            if (p1[i] !== p2[i]) c = 0;
        if (c) return true;
        else return false;
    } else return false;
}

function RootbyId(id) {
    if (id) id = id.replace('chat/', '');
    var p = M.getPath(id);
    return p[p.length - 1];
}

function ddtype(ids, toid) {
    var r = false;
    for (var i in ids) {
        var fromid = ids[i];
        if (folderlink) return false;
        if (fromid == toid) return false;
        // never allow move to own inbox, or to own contacts
        if (toid == M.InboxID || toid == 'contacts') return false;
        // to a contact, always allow a copy
        if (RootbyId(toid) == 'contacts' && M.d[toid].p == 'contacts') r = 'copy';
        // to a shared folder, only with write rights
        if (RootbyId(toid) == 'contacts' && RightsbyID(toid) > 0) {
            if (isCircular(fromid, toid)) return false;
            else r = 'copy';
        }
        // cannot move or copy to the existing parent

        if (toid == M.d[fromid].p) return false;
        // from own cloud to own cloud / trashbin, always move
        if ((toid == M.RootID || toid == M.RubbishID || M.d[toid].t) && (RootbyId(fromid) == M.RootID) && (RootbyId(toid) == M.RootID || toid == M.RubbishID)) {
            if (isCircular(fromid, toid)) return false;
            else r = 'move';
        }
        // from trashbin or inbox to own cloud, always move

        if ((RootbyId(fromid) == M.RubbishID || RootbyId(fromid) == M.InboxID) && RootbyId(toid) == M.RootID) r = 'move';
        // from inbox to trashbin, always move
        if (RootbyId(fromid) == M.InboxID && RootbyId(toid) == M.RubbishID) r = 'move';
        // from trashbin or inbox to a shared folder with write permission, always copy
        if ((RootbyId(fromid) == M.RubbishID || RootbyId(fromid) == M.InboxID) && RootbyId(toid) == 'contacts' && RightsbyID(toid) > 0) r = 'copy';
        // copy from a share to cloud
        if (RootbyId(fromid) == 'contacts' && (toid == M.RootID || RootbyId(toid) == M.RootID)) r = 'copy';
        // move from a share to trashbin only with full control rights (do a copy + del for proper handling)
        if (RootbyId(fromid) == 'contacts' && toid == M.RubbishID && RightsbyID(fromid) > 1) r = 'copydel';
    }
    return r;
}

function fm_getnodes(h, ignore) {
    var nodes = [];

    function procnode(h) {
        if (M.c[h]) {
            for (var n in M.c[h]) {
                if (M.d[n].name || ignore) nodes.push(n);
                if (M.d[n].t == 1) procnode(n);
            }
        }
    }
    procnode(h);
    return nodes;
}

function fm_getsharenodes(h) {
    var sn = [];
    var n = M.d[h];
    while (n && n.p && n) {
        if (typeof n.shares !== 'undefined' || u_sharekeys[n.h]) sn.push(n.h);
        n = M.d[n.p];
    }
    return sn;
}

function createfolder(toid, name, ulparams) {
    var mkat = enc_attr({
        n: name
    }, []);
    var attr = ab_to_base64(mkat[0]);
    var key = a32_to_base64(encrypt_key(u_k_aes, mkat[1]));
    var req = {
        a: 'p',
        t: toid,
        n: [{
            h: 'xxxxxxxx',
            t: 1,
            a: attr,
            k: key
        }],
        i: requesti
    };
    var sn = fm_getsharenodes(toid);
    if (sn.length) {
        req.cr = crypto_makecr([mkat[1]], sn, false);
        req.cr[1][0] = 'xxxxxxxx';
    }
    if (!ulparams) loadingDialog.show();
    api_req(req, {
        ulparams: ulparams,
        callback: function(res, ctx) {
            if (typeof res != 'number') {
                $('.fm-new-folder').removeClass('active');
                $('.create-folder-input-bl input').val('');
                newnodes = [];
                M.addNode(res.f[0]);
                rendernew();
                loadingDialog.hide();
                if (ctx.ulparams) ulparams.callback(ctx.ulparams, res.f[0].h);
            }
        }
    });
}

function getuid(email) {
    for (var j in M.u)
        if (M.u[j].m == email) return j;
    return false;
}

function doshare(h, t) {
    nodeids = fm_getnodes(h);
    nodeids.push(h);
    api_setshare(h, t, nodeids, {
        t: t,
        h: h,
        done: function(res, ctx) {
            var i;
            if (res.r && res.r[0] == '0') {
                for (i in res.u) M.addUser(res.u[i]);
                for (i in res.r) {
                    if (res.r[i] == 0) {
                        var rights = ctx.t[i].r;
                        var user = ctx.t[i].u;
                        if (user.indexOf('@') >= 0) user = getuid(ctx.t[i].u);
                        M.nodeShare(ctx.h, {
                            h: $.selected[0],
                            r: rights,
                            u: user,
                            ts: Math.floor(new Date().getTime() / 1000)
                        });
                    }
                }
                $('.fm-dialog.share-dialog').removeClass('hidden');
                loadingDialog.hide();
                M.renderShare($.selected[0]);
                shareDialog();
                renderfm();
            } else {
                $('.fm-dialog.share-dialog').removeClass('hidden');
                loadingDialog.hide();
            }
        }
    });
}

function processmove(jsonmove) {
    for (i in jsonmove) {
        var sharingnodes = fm_getsharenodes(jsonmove[i].t);
        if (sharingnodes.length) {
            var movingnodes = fm_getnodes(jsonmove[i].n);
            movingnodes.push(jsonmove[i].n);
            jsonmove[i].cr = crypto_makecr(movingnodes, sharingnodes, true);
        }
        api_req(jsonmove[i]);
    }
}

function process_f(f) {
    for (var i in f) M.addNode(f[i]);
}

function process_u(u) {
    for (var i in u) {
        if (u[i].c == 1) {
            u[i].name = u[i].m;
            u[i].h = u[i].u;
            u[i].t = 1;
            u[i].p = 'contacts';
            M.addNode(u[i]);
        } else if (M.d[u[i].u]) M.delNode(u[i].u);
        M.addUser(u[i]);
    }
}

function process_ok(ok) {
    for (i in ok) {
        if (mDB && !pfkey) mDBadd('ok', ok[i]);
        if (ok[i].ha == crypto_handleauth(ok[i].h)) u_sharekeys[ok[i].h] = decrypt_key(u_k_aes, base64_to_a32(ok[i].k));
    }
}

function folderreqerr(c, e) {
    loadingDialog.hide();
    msgDialog('warninga', l[1043], l[1044] + '<ul><li>' + l[1045] + '</li><li>' + l[247] + '</li><li>' + l[1046] + '</li>', false, function() {
        folderlink = pfid;
        document.location.hash = '';
    });
}

function loadfm_callback(res) {
    if (pfkey && res.f && res.f[0]) {
        M.RootID = res.f[0].h;
        u_sharekeys[res.f[0].h] = base64_to_a32(pfkey);
        folderlink = pfid;
    }
    if (res.u) process_u(res.u);
    if (res.ok) process_ok(res.ok);
    process_f(res.f);
    if (res.s)
        for (var i in res.s) M.nodeShare(res.s[i].h, res.s[i]);
    maxaction = res.sn;
    if (mDB) localStorage[u_handle + '_maxaction'] = maxaction;
    renderfm();
    if (!pfkey) pollnotifications();
    if (res.cr) crypto_procmcr(res.cr);
    if (res.sr) crypto_procsr(res.sr);
    getsc();
}

function storefmconfig(n, c) {
    fmconfig[n] = c;
    localStorage.fmconfig = JSON.stringify(fmconfig);
}

function fmtreenode(id, e) {
    if (RootbyId(id) == 'contacts') return false;
    var treenodes = {};
    if (typeof fmconfig.treenodes !== 'undefined') treenodes = fmconfig.treenodes;
    if (e) treenodes[id] = 1;
    else {
        $('#treesub_' + id + ' .expanded').each(function(i, e) {
            var id2 = $(e).attr('id');
            if (id2) {
                id2 = id2.replace('treea_', '');
                $('#treesub_' + id2).removeClass('opened');
                $('#treea_' + id2).removeClass('expanded');
                delete treenodes[id2];
            }
        });
        delete treenodes[id];
    }
    storefmconfig('treenodes', treenodes);
}

function fmsortmode(id, n, d) {
    var sortmodes = {};
    if (typeof fmconfig.sortmodes !== 'undefined') sortmodes = fmconfig.sortmodes;
    if (n == 'name' && d > 0) delete sortmodes[id];
    else sortmodes[id] = {
        n: n,
        d: d
    };
    storefmconfig('sortmodes', sortmodes);
}

function fmviewmode(id, e) {
    var viewmodes = {};
    if (typeof fmconfig.viewmodes !== 'undefined') viewmodes = fmconfig.viewmodes;
    if (e) viewmodes[id] = 1;
    else viewmodes[id] = 0;
    storefmconfig('viewmodes', viewmodes);
}

function fm_requestfolderid(h, name, ulparams) {
    if (!h) h = M.RootID;
    if (M.c[h]) {
        for (var n in M.c[h]) {
            if (M.d[n] && M.d[n].t && M.d[n].name == name) {
                ulparams.callback(ulparams, M.d[n].h);
                return true;
            }
        }
    }
    createfolder(h, name, ulparams);
}

function clone(obj) {
    if (null == obj || 'object' != typeof obj) return obj;
    if (obj instanceof Date) {
        var copy = new Date();
        copy.setTime(obj.getTime());
        return copy;
    }
    if (obj instanceof Array) {
        var copy = [];
        for (var i = 0, len = obj.length; i < len; i++) {
            copy[i] = clone(obj[i]);
        }
        return copy;
    }
    if (obj instanceof Object) {
        var copy = {};
        for (var attr in obj) {
            if (obj.hasOwnProperty(attr)) copy[attr] = clone(obj[attr]);
        }
        return copy;
    }
}

function balance2pro(callback) {
    api_req({
        a: 'uq',
        pro: 1
    }, {
        cb: callback,
        callback: function(res, ctx) {
            if (typeof res == 'object' && res['balance'] && res['balance'][0]) {
                var pjson = JSON.parse(pro_json);
                for (var i in pjson[0]) {
                    if (pjson[0][i][5] == res['balance'][0][0]) {
                        api_req({
                            a: 'uts',
                            it: 0,
                            si: pjson[0][i][0],
                            p: pjson[0][i][5],
                            c: pjson[0][i][6]
                        }, {
                            cb: ctx.cb,
                            callback: function(res, ctx) {
                                if (typeof res == 'number' && res < 0 && ctx.cb) ctx.cb(false);
                                else {
                                    api_req({
                                        a: 'utc',
                                        s: [
                                            res
                                        ],
                                        m: 0
                                    }, {
                                        cb: ctx.cb,
                                        callback: function(res, ctx) {
                                            if (ctx.cb) ctx.cb(true);
                                            u_checklogin({
                                                checkloginresult: function(u_ctx, r) {
                                                    if (M.account) M.account.lastupdate = 0;
                                                    u_type = r;
                                                    topmenuUI();
                                                    if (u_attr.p) msgDialog('info', l[1047], l[1048]);
                                                }
                                            });
                                        }
                                    });
                                }
                            }
                        });
                    }
                }
            }
        }
    });
}
var MegaChat = false;
if (localStorage.megachat) MegaChat = true;

function chatui() {
    hideEmptyMsg();
    $('.fm-files-view-icon').addClass('hidden');
    $('.fm-blocks-view').addClass('hidden');
    $('.files-grid-view').addClass('hidden');
    $('.contacts-grid-view').addClass('hidden');
    $('.fm-contacts-blocks-view').addClass('hidden');
    $('.fm-chat-block').removeClass('hidden');
    initChatScrolling();
    $('.message-textarea').unbind('keyup');
    $('.message-textarea').bind('keyup', function() {
        $(this).height('auto');
        var text = $(this).val();
        var lines = text.split('\n');
        var count = lines.length;
        if ($(this).val().length != 0 && count > 1) {
            $(this).height($(this).prop('scrollHeight'));
            var scrollBlockHeight = $('.fm-chat-block').outerHeight() - $('.fm-chat-line-block').outerHeight() - 80;
            if (scrollBlockHeight != $('.fm-chat-message-scroll').outerHeight()) {
                $('.fm-chat-message-scroll').height(scrollBlockHeight);
                initChatScrolling();
            }
            // If any popup is opened - moving with buttons

            if ($('.fm-chat-emotions-icon').attr('class').indexOf('active') > -1) {
                var positionY = $('.fm-chat-line-block').outerHeight() - $('.fm-chat-emotion-arrow').position().top;
                $('.fm-chat-emotion-popup').css('bottom', positionY - 17 + 'px');
            }
            if ($('.fm-chat-attach-file').attr('class').indexOf('active') > -1) {
                var positionY = $('.fm-chat-line-block').outerHeight() - $('.fm-chat-attach-arrow').position().top;
                $('.fm-chat-attach-popup').css('bottom', positionY - 17 + 'px');
            }
        } else $(this).height('27px');
    });
    $('.fm-chat-emotions-icon').unbind('click');
    $('.fm-chat-emotions-icon').bind('click', function() {
        if ($(this).attr('class').indexOf('active') > -1) {
            $('.fm-chat-emotion-popup').addClass('hidden');
            $(this).removeClass('active');
        } else {
            $('.fm-chat-emotion-popup').removeClass('hidden');
            $(this).addClass('active');
            var positionY = $('.fm-chat-line-block').outerHeight() - $('.fm-chat-emotion-arrow').position().top;
            $('.fm-chat-emotion-popup').css('bottom', positionY - 17 + 'px');
        }
    });
    $('.fm-chat-attach-file').unbind('click');
    $('.fm-chat-attach-file').bind('click', function() {
        if ($(this).attr('class').indexOf('active') > -1) {
            $('.fm-chat-attach-popup').addClass('hidden');
            $(this).removeClass('active');
        } else {
            $('.fm-chat-attach-popup').removeClass('hidden');
            $(this).addClass('active');
            var positionY = $('.fm-chat-line-block').outerHeight() - $('.fm-chat-attach-arrow').position().top;
            $('.fm-chat-attach-popup').css('bottom', positionY - 17 + 'px');
        }
    });
    $('.fm-chat-file-button.save-button').unbind('mouseover click');
    $('.fm-chat-file-button.save-button').bind('mouseover click', function() {
        var chatDownloadPopup = $('.fm-chat-download-popup');
        var p = $(this);
        var positionY = $(this).closest('.jspPane').outerHeight() - $(this).position().top;
        var positionX = $(this).position().left;
        if (positionY - 174 > 0) {
            $(chatDownloadPopup).css('bottom', positionY - 174 + 'px');
            $(chatDownloadPopup).removeClass('top');
        } else {
            $(chatDownloadPopup).css('bottom', positionY + 'px');
            $(chatDownloadPopup).addClass('top');
        }
        $(chatDownloadPopup).css('left', positionX + $(this).outerWidth() / 2 + 10 + 'px');
        $(this).addClass('active');
        (chatDownloadPopup).removeClass('hidden');
    });
    $('.fm-chat-message-scroll').unbind('click');
    $('.fm-chat-message-scroll').bind('click', function() {
        $('.fm-chat-download-popup').addClass('hidden');
    });
    $('.fm-add-user').unbind('click');
    $('.fm-add-user').bind('click', function() {
        var positionX = $(this).position().left;
        var addUserPopup = $('.fm-add-contact-popup');
        if ($(this).attr('class').indexOf('active') > -1) {
            $(addUserPopup).addClass('hidden');
            $(this).removeClass('active');
        } else {
            $(addUserPopup).removeClass('hidden');
            $(this).addClass('active');
            $(addUserPopup).css('left', positionX - 8 + 'px');
        }
    });
}

function initChatScrolling() {
    $('.fm-chat-message-scroll').jScrollPane({
        enableKeyboardNavigation: false,
        showArrows: true,
        arrowSize: 5
    });
}

function voucherCentering(button) {
    var popupBlock = $('.fm-voucher-popup');
    var rigthPosition = $('.fm-account-main').outerWidth() - $(popupBlock).outerWidth();
    var buttonMid = button.width() / 2;
    popupBlock.css('top', button.position().top + 30);
    popupBlock.css('left', button.position().left + buttonMid + 20 - popupBlock.width() / 2);
    if (rigthPosition - 20 < popupBlock.position().left) {
        popupBlock.css('left', rigthPosition - 20);
    }
}

function andreiScripts() {
    /*
	$('.on_off :checkbox').iphoneStyle({ resizeContainer: false, resizeHandle: false, onChange: function(elem, data)
	{
		if(data) $(elem).closest('.on_off').addClass('active');
		else $(elem).closest('.on_off').removeClass('active');
	}});
	*/
}

function initAccountScroll() {
    $('.fm-account-main').jScrollPane({
        enableKeyboardNavigation: false,
        showArrows: true,
        arrowSize: 5,
        animateScroll: true
    });
    jScrollFade('.fm-account-main');
}

function initGridScrolling() {
    $('.grid-scrolling-table').jScrollPane({
        enableKeyboardNavigation: false,
        showArrows: true,
        arrowSize: 5
    });
    jScrollFade('.grid-scrolling-table');
}

function initFileblocksScrolling() {
    $('.file-block-scrolling').jScrollPane({
        enableKeyboardNavigation: false,
        showArrows: true,
        arrowSize: 5
    });
    jScrollFade('.file-block-scrolling');
    $('.file-block-scrolling.jspPane').height('');
}

function initContactsGridScrolling() {
    var jsp = $('.contacts-grid-scrolling-table').data('jsp');
    if (jsp) jsp.destroy();
    $('.contacts-grid-scrolling-table').jScrollPane({
        enableKeyboardNavigation: false,
        showArrows: true,
        arrowSize: 5
    });
    jScrollFade('.contacts-grid-scrolling-table');
}

function initContactsBlocksScrolling() {
    var jsp = $('.contacts-blocks-scrolling').data('jsp');
    if (jsp) jsp.destroy();
    $('.contacts-blocks-scrolling').jScrollPane({
        enableKeyboardNavigation: false,
        showArrows: true,
        arrowSize: 5
    });
    jScrollFade('.contacts-blocks-scrolling');
}

function initTransferScroll() {
    $('.transfer-scrolling-table').jScrollPane({
        enableKeyboardNavigation: false,
        showArrows: true,
        arrowSize: 5,
        verticalDragMinHeight: 20
    });
    jScrollFade('.transfer-scrolling-table');
}

function initTreeScroll() {
    if (localStorage.leftPaneWidth && $('.fm-left-panel').css('width').replace('px', '') != localStorage.leftPaneWidth) {
        $('.fm-left-panel').css({
            'width': localStorage.leftPaneWidth + 'px'
        });
    }
    $('.fm-tree-panel').jScrollPane({
        enableKeyboardNavigation: false,
        showArrows: true,
        arrowSize: 5,
        animateScroll: true
    });
    $('.fm-tree-panel .jspPane').css('padding-top', '10px');
    $('.fm-tree-panel').unbind('jsp-scroll-y.droppable');
    $('.fm-tree-panel').bind('jsp-scroll-y.droppable', function(event, scrollPositionY, isAtTop, isAtBottom) {
        var t = Math.random();
        $.scroller = t;
        setTimeout(function() {
            if (t == $.scroller) treeDroppable();
        }, 100);
    });
    jScrollFade('.fm-tree-panel');
}
var ddtreedisabled = {};

function treeDroppable() {
    var t = new Date().getTime();
    var tt = $('.fm-tree-panel .jspPane').position().top;
    var toptop = false;
    $('.fm-tree-panel .ui-droppable').each(function(i, e) {
        var id = $(e).attr('id');
        if (!id) {
            $(e).uniqueId();
            id = $(e).attr('id');
        }
        if (toptop || (tt + $(e).height() + $(e).position().top - 10 > 0)) {
            toptop = 1;
            if (ddtreedisabled[id]) {
                delete ddtreedisabled[id];
                $(e).droppable('enable');
            }
        } else {
            ddtreedisabled[id] = 1;
            $(e).droppable('disable');
        }
    });
}

function notificationsScroll() {
    $('.new-notifications-scroll').jScrollPane({
        enableKeyboardNavigation: false,
        showArrows: true,
        arrowSize: 5,
        verticalDragMinHeight: 250
    });
    jScrollFade('.new-notifications-scroll');
}

function cacheselect() {
    $.selected = [];
    $($.selectddUIgrid + ' ' + $.selectddUIitem).each(function(i, o) {
        if ($(o).attr('class').indexOf('ui-selected') > -1) $.selected.push($(o).attr('id'));
    });
}

function hideEmptyMsg() {
    $('.fm-empty-trashbin').addClass('hidden');
    $('.fm-empty-contacts').addClass('hidden');
    $('.fm-empty-search').addClass('hidden');
    $('.fm-empty-cloud').addClass('hidden');
    $('.fm-empty-messages').addClass('hidden');
}

function reselect(n) {
    $('.ui-selected').removeClass('ui-selected');
    if (typeof $.selected == 'undefined') $.selected = [];
    for (var i in $.selected) {
        $('#' + $.selected[i]).addClass('ui-selected');
        if (n) {
            $('#' + $.selected[i] + ' .grid-status-icon').addClass('new');
            $('#' + $.selected[i] + ' .file-status-icon').addClass('new');
        }
    }
    if (n) {
        if (M.viewmode) {
            var jsp = $('.file-block-scrolling').data('jsp');
            var el = $('a.ui-selected');
        } else {
            var jsp = $('.grid-scrolling-table').data('jsp');
            var el = $('tr.ui-selected');
        }
        if (el.length > 0) el = el[0];
        else el = false;
        if (el && jsp) jsp.scrollToElement(el);
    }
}

function treeheaderArrows() {
    $('.cloud-drive-item').removeClass('contains-subfolders expanded');
    if ($('#treesub_' + M.RootID + ' .fm-tree-folder').length > 0) {
        $('.cloud-drive-item').addClass('contains-subfolders');
        if ($('#treesub_' + M.RootID).attr('class').indexOf('opened') > -1) $('.cloud-drive-item').addClass('expanded');
    }
    $('.contacts-item').removeClass('contains-subfolders expanded');
    if ($('#treesub_contacts .fm-tree-folder').length > 0) {
        $('.contacts-item').addClass('contains-subfolders');
        if ($('#treesub_contacts').attr('class').indexOf('opened') > -1) $('.contacts-item').addClass('expanded');
    }
}

function initUI() {
    if (!folderlink) {
        $('.fm-tree-header.cloud-drive-item span').text(l[164]);
        $('.fm-tree-header').not('.cloud-drive-item').show();
        $('.fm-menu-item').show();
        $('.fm-left-menu .folderlink').addClass('hidden');
    }
    $.selectingHeader = function(currentHeader) {
        initTreeScroll();
        var c = currentHeader.attr('class');
        if (c && c.indexOf('active') == -1) {
            $('.fm-menu-item').removeClass('active');
            if (currentHeader.attr('class').indexOf('cloud') > -1) $('.fm-menu-item.cloud').addClass('active');
            else if (currentHeader.attr('class').indexOf('recycle') > -1) $('.fm-menu-item.recycle').addClass('active');
            else if (currentHeader.attr('class').indexOf('contacts') > -1) $('.fm-menu-item.contacts').addClass('active');
            else if (currentHeader.attr('class').indexOf('messages') > -1) $('.fm-menu-item.messages').addClass('active');
            currentHeader.addClass('active');
        }
        $('.fm-tree-panel .fm-tree-header').each(function() {
            var subFoldersBlock = $(this).next();
            if ($(this).attr('class') !== currentHeader.attr('class')) {
                $(this).removeClass('active');
                subFoldersBlock.find('li').removeClass('selected');
                subFoldersBlock.find('.fm-tree-folder').removeClass('active');
                subFoldersBlock.find('.fm-connector').removeClass('mid last vertical-line');
                subFoldersBlock.find('.fm-horizontal-connector').removeClass('active');
                $(this).prev().removeClass('active');
            }
        });
    };
    $.doDD = function(e, ui, a, type) {
        var c = $(ui.draggable.context).attr('class');
        var t,
            ids,
            dd;
        if (c && c.indexOf('fm-tree-folder') > -1) {
            // tree dragged:
            var id = $(ui.draggable.context).attr('id');
            if (id.indexOf('treea_') > -1) ids = [
                id.replace('treea_', '')
            ];
        } else {
            // grid dragged:
            if ($.selected && $.selected.length > 0) ids = $.selected;
        }
        if (type == 1) {
            // tree dropped:
            var c = $(e.target).attr('class');
            if (c && c.indexOf('recycle') > -1) t = M.RubbishID;
            else if (c && c.indexOf('cloud') > -1) t = M.RootID;
            else {
                var t = $(e.target).attr('id');
                if (t && t.indexOf('treea_') > -1) t = t.replace('treea_', '');
                else t = undefined;
            }
        } else {
            // grid dropped:
            var c = $(e.target).attr('class');
            if (c && c.indexOf('folder') > -1) t = $(e.target).attr('id');
        }
        if (ids && ids.length && t) dd = ddtype(ids, t);
        $('.dragger-block').removeClass('move copy warning drag');
        if (a == 'drop' || a == 'out') {
            $(e.target).removeClass('dragover');
            $('.dragger-block').addClass('drag');
        } else if (a == 'over') {
            var id = $(e.target).attr('id');
            if (!id) {
                $(e.target).uniqueId();
                id = $(e.target).attr('id');
            }
            $.currentOver = id;
            setTimeout(function() {
                if ($.currentOver == id) {
                    var h;
                    if (id.indexOf('treea_') > -1) h = id.replace('treea_', '');
                    else {
                        var c = $(id).attr('class');
                        if (c && c.indexOf('cloud-drive-item') > -1) h = M.RootID;
                        else if (c && c.indexOf('recycle-item') > -1) h = M.RubbishID;
                        else if (c && c.indexOf('contacts-item') > -1) h = 'contacts';
                    }
                    if (h) treeUIexpand(h, 1);
                }
            }, 1000);
            if (t == M.RubbishID) $('.dragger-block').addClass('warning');
            else if (dd == 'move') $('.dragger-block').addClass('move');
            else if (dd == 'copy') $('.dragger-block').addClass('copy');
            else $('.dragger-block').addClass('drag');
            $(e.target).addClass('dragover');
        }
        if (a == 'drop' && dd) {
            if (dd == 'move') {
                $(ui.draggable).draggable('option', 'revert', false);
                $(ui.draggable).remove();
                $.moveids = ids;
                $.movet = t;
                setTimeout(function() {
                    M.moveNodes($.moveids, $.movet);
                }, 50);
            } else if (dd == 'copy') {
                $(ui.draggable).draggable('option', 'revert', false);
                $.copyids = ids;
                $.copyt = t;
                setTimeout(function() {
                    M.copyNodes($.copyids, $.copyt);
                }, 50);
            }
            $('.dragger-block').hide();
        }
    };
    InitFileDrag();
    createfolderUI();
    cSortMenuUI();
    initContextUI();
    transferPanelUI();
    UIkeyevents();
    addUserUI();
    $('.fm-files-view-icon').unbind('click');
    $('.fm-files-view-icon').bind('click', function(event) {
        $.hideContextMenu();
        cacheselect();
        if ($(this).attr('class').indexOf('listing-view') > -1) {
            if (fmconfig.uiviewmode) storefmconfig('viewmode', 0);
            else fmviewmode(M.currentdirid, 0);
            M.openFolder(M.currentdirid, true);
        } else {
            if (fmconfig.uiviewmode) storefmconfig('viewmode', 1);
            else fmviewmode(M.currentdirid, 1);
            M.openFolder(M.currentdirid, true);
        }
        reselect();
        return false;
    });
    $.hideContextMenu = function(e) {
        if (e && e.target) {
            var c = $(e.target).attr('class');
            if (!c) {
                c = $(e.target).parent();
                if (c) c = $(c).attr('class');
            }
            if (c && c.indexOf('dropdown') > -1 && (c.indexOf('download-item') > -1 || c.indexOf('more-item') > -1) && c.indexOf('active') > -1) return false;
        }
        $('.context-menu-item.dropdown').removeClass('active');
        $('.fm-tree-header').removeClass('dragover');
        $('.fm-tree-folder').removeClass('dragover');
        if ($('.contacts-arrows').attr('class').indexOf('active') > -1) {
            if (e && $(e.target).closest('.contacts-arrows').length == 0) {
                $('.sorting-menu').addClass('hidden');
                $('.contacts-arrows').removeClass('active');
            }
        } else $('.context-menu').addClass('hidden');
    };
    $('#fmholder').unbind('click.contextmenu');
    $('#fmholder').bind('click.contextmenu', function(e) {
        $.hideContextMenu(e);
        if ($.hideTopMenu) $.hideTopMenu(e);
        var c = $(e.target).attr('class');
        if ($(e.target).attr('type') !== 'file' && (c && c.indexOf('upgradelink') == -1) && (c && c.indexOf('campaign-logo') == -1) && (c && c.indexOf('resellerbuy') == -1)) return false;
    });
    $('.fm-back-button').unbind('click');
    $('.fm-back-button').bind('click', function(e) {
        if (!M.currentdirid) return;
        if (M.currentdirid == 'notifications' || M.currentdirid.substr(0, 7) == 'search/' || M.currentdirid.substr(0, 5) == 'chat/') window.history.back();
        else {
            var n = M.d[M.currentdirid];
            if ((n && n.p && M.d[n.p]) || (n && n.p == 'contacts')) M.openFolder(n.p);
        }
    });
    $('.fm-right-header').removeClass('hidden');
    if (folderlink) $('.fm-tree-header.cloud-drive-item span').text((M.d[M.RootID] || {}).name || 'ツ');
    else folderlink = 0;
    $('.add-user-popup-button').unbind('click');
    $('.add-user-popup-button').bind('click', function(e) {
        if (u_type === 0) ephemeralDialog(l[997]);
        else doAddContact(e);
    });
    $('.add-user-popup input').unbind('keypress');
    $('.add-user-popup input').bind('keypress', function(e) {
        if (e.which == 13) doAddContact(e);
    });
    if (ul_queue.length > 0) openTransferpanel();
    if (u_type === 0 && !u_attr.terms) {
        $.termsAgree = function() {
            u_attr.terms = 1;
            api_req({
                a: 'up',
                terms: 'Mq'
            });
        };
        $.termsDeny = function() {
            u_logout();
            document.location.reload();
        };
        termsDialog();
    }
    M.avatars();
    if (typeof dl_import !== 'undefined' && dl_import) dl_fm_import();
    $('.fm-menu-item').unbind('mouseover');
    $('.fm-menu-item').bind('mouseover', function(e) {
        $(this).addClass('active');
        if ($.gridDragging) {
            var c = $(this).attr('class');
            if (!c) return false;
            if (c.indexOf('cloud') > -1) treeUIopen(M.RootID, 0, 0, 1);
            else if (c.indexOf('recycle') > -1) treeUIopen(M.RubbishID, 0, 0, 1);
            else if (c.indexOf('contacts') > -1) treeUIopen('contacts', 0, 0, 1);
            else if (c.indexOf('messages') > -1) treeUIopen(M.InboxID, 0, 0, 1);
        }
    });
    $('.fm-menu-item').unbind('mouseout');
    $('.fm-menu-item').bind('mouseout', function(e) {
        if ($(this).attr('class').indexOf('contacts') > -1 && (RootbyId(M.currentdirid) == 'contacts' || $('.fm-tree-header.contacts-item').attr('class').indexOf('active') > -1)) return false;
        else if ($(this).attr('class').indexOf('messages') > -1 && RootbyId(M.currentdirid) == M.InboxID) return false;
        else if ($(this).attr('class').indexOf('recycle') > -1 && RootbyId(M.currentdirid) == M.RubbishID) return false;
        else if ($(this).attr('class').indexOf('cloud') > -1 && RootbyId(M.currentdirid) == M.RootID) return false;
        $(this).removeClass('active');
    });
    $('.context-menu').unbind('contextmenu');
    $('.context-menu').bind('contextmenu', function(e) {
        if (!localStorage.contextmenu) e.preventDefault();
    });
    $('.fm-new-folder').unbind('mouseover');
    $('.fm-new-folder').bind('mouseover', function(e) {
        $('.fm-new-folder').addClass('hovered');
    });
    $('.fm-new-folder').unbind('mouseout');
    $('.fm-new-folder').bind('mouseout', function(e) {
        $('.fm-new-folder').removeClass('hovered');
    });
    if (dlMethod.warn && !localStorage.browserDialog && !$.browserDialog) {
        setTimeout(function() {
            browserDialog();
        }, 2000);
    }
    $.transferPaneResizable = new FMResizablePane($('.transfer-panel'), {
        'direction': 'n',
        'minHeight': 135,
        'maxHeight': ($(document.body).outerHeight() * 0.45 /* 45%? */ ),
        'persistanceKey': 'transferPaneHeight',
        'handle': '.transfer-drag-handle'
    });
    $($.transferPaneResizable).on('resize', function(e, resize_event, ui) {
        if ($('#fmholder.transfer-panel-opened').size() == 0) {
            $.transferOpen();
            $.transferHeader();
        }
    });
    $($.transferPaneResizable).on('resizestop', function(e, resize_event, ui) {
        if ($.transferPaneResizable.options.minHeight >= ui.size.height) {
            $.transferOpen();
            $.transferHeader();
        };
    });
    $.leftPaneResizable = new FMResizablePane($('.fm-left-panel'), {
        'direction': 'e',
        'minWidth': 200,
        'maxWidth': ($(document.body).outerWidth() * 0.3 /* 30%? */ ),
        'persistanceKey': 'leftPaneWidth',
        'handle': '.left-pane-drag-handle'
    });
    $($.leftPaneResizable).on('resize', function() {
        $(window).trigger('resize');
    });
    $(window).unbind('resize.fmrh hashchange.fmrh');
    $(window).bind('resize.fmrh hashchange.fmrh', fm_resize_handler);
    // because setTimeout was used in treeUI, we should trigger a `resize` evt
    // we need to use setTimeout again :/
    setTimeout(function() {
        $(window).trigger('resize');
    }, 50);
    if (lang != 'en') $('.download-standart-item').text(l[58]);
}

function openTransferpanel() {
    $.transferOpen(1);
    if (M.currentdirid == 'notifications') notificationsScroll();
    else if (M.viewmode) initFileblocksScrolling();
    else initGridScrolling();
    if (!uldl_hold) ulQueue.resume();
    else
    // make sure that terms of service are accepted before any action
    {
        $('.transfer-pause-icon').addClass('active');
        dlQueue.pause();
        ulQueue.pause();
        ui_paused = true;
        //		$('.transfer-table tr td:eq(4), .transfer-table tr td:eq(6)').each(function()
        //		{
        //			$(this).text('');
        //		});
    }
    initTreeScroll();
    $(window).trigger('resize');
}

function doAddContact(e, dialog) {
    var c = '.add-user-popup input';
    if (dialog) c = '.add-contact-dialog input';
    if (checkMail($(c).val())) {
        $.doAddContactVal = $(c).val();
        $(c).val('email@domain.com');
        $(c).css('color', '#D22000');
        setTimeout(function(c) {
            $(c).val($.doAddContactVal);
            $(c).css('color', '#000000');
            $(c).select();
        }, 850, c);
    } else {
        loadingDialog.show();
        M.addContact($(c).val());
        if (dialog) addContactDialog(1);
    }
}

function searchFM() {}

function removeUInode(h) {
    var n = M.d[h];
    var i = 0;
    if (n && n.t) {
        var cns = M.c[n.p];
        if (cns) {
            for (var cn in cns) {
                if (M.d[cn] && M.d[cn].t && cn !== h) i++;
            }
        }
        if (i == 0) $('#treea_' + n.p).removeClass('contains-folders expanded');
    }
    $('#' + h).remove();
    $('#treea_' + h).remove();
    $('#treesub_' + h).remove();
    $('#treeli_' + h).remove();
    treeheaderArrows();
}

function sharedUInode(h, s) {
    if (s) $('#treea_' + h).addClass('shared-folder');
    else {
        $('#treea_' + h).removeClass('shared-folder');
        $('.grid-table.fm #' + h + ' .transfer-filtype-icon').removeClass('folder-shared');
        $('.file-block#' + h + ' .block-view-file-type').removeClass('folder-shared');
    }
    $('.grid-table.fm #' + h + ' .transfer-filtype-icon').addClass(fileicon({
        t: 1,
        shares: s
    }));
    $('.file-block#' + h + ' .block-view-file-type').addClass(fileicon({
        t: 1,
        shares: s
    }));
}

function addnotification(n) {
    if (typeof notifications == 'undefined') return false;
    var timestamp = Math.round(new Date().getTime() / 1000);
    var updated = false;
    if (n.t == 'put') {
        for (i in notifications) {
            if (notifications[i].folderid == n.n && notifications[i].user == n.u && notifications[i].timestamp > timestamp - 120 && notifications[i].type !== 'share' && !updated) {
                notifications[i].timestamp = timestamp;
                notifications[i].read = false;
                notifications[i].count = false;
                if (!notifications[i].nodes) notifications[i].nodes = [];
                for (var i in n.f) notifications[i].nodes.push(n.f[i]);
                updated = true;
            }
        }
    }
    if (!updated) {
        notifications.push({
            id: makeid(10),
            type: n.t,
            timestamp: timestamp,
            user: n.u,
            folderid: n.n,
            nodes: n.f,
            read: false,
            popup: false,
            count: false,
            rendered: false
        });
    }
    donotify();
}

function addUserUI() {
    $('.fm-add-user').unbind('click');
    $('.fm-add-user').bind('click', function(e) {
        var c = $(this).attr('class');
        var c2 = $(e.target).attr('class');
        if ((!c2 || c2.indexOf('fm-add-user') == -1) && $(e.target).prop('tagName') !== 'SPAN') return false;
        if (c.indexOf('active') == -1) {
            $(this).addClass('active');
            $('.add-user-popup input').focus();
        } else $(this).removeClass('active');
        $.hideContextMenu();
    });
}

function ephemeralDialog(msg) {
    msgDialog('confirmation', l[998], msg + ' ' + l[999], l[1000], function(e) {
        if (e) document.location.hash = 'register';
    });
}

function fmremove() {
    var filecnt = 0,
        foldercnt = 0,
        contactcnt = 0,
        removesharecnt = 0;
    for (var i in $.selected) {
        var n = M.d[$.selected[i]];
        if (n && n.p.length == 11) removesharecnt++;
        else if ($.selected[i].length == 11) contactcnt++;
        else if (M.d[$.selected[i]].t) foldercnt++;
        else filecnt++;
    }
    if (removesharecnt) {
        for (var i in $.selected) {
            M.delNode($.selected[i]);
            api_req({
                a: 'd',
                n: $.selected[i],
                i: requesti
            });
            delete u_sharekeys[$.selected[i]];
        }
    } else if (contactcnt) {
        msgDialog('confirmation', l[1001], l[1002].replace('[X]', M.d[$.selected[0]].name), false, function(e) {
            if (e) {
                for (var i in $.selected) {
                    if (M.c[$.selected[i]]) {
                        for (var sharenode in M.c[$.selected[i]]) {
                            console.log(sharenode);
                            M.delNode(sharenode);
                            api_req({
                                a: 'd',
                                n: sharenode,
                                i: requesti
                            });
                            delete u_sharekeys[sharenode];
                        }
                    }
                    M.delNode($.selected[i]);
                    api_req({
                        a: 'ur',
                        u: $.selected[i],
                        l: '0',
                        i: requesti
                    });
                }
            }
        });
    } else if (RootbyId($.selected[0]) == M.RubbishID) {
        msgDialog('clear-bin', l[1003], l[76].replace('[X]', (filecnt + foldercnt)) + ' ' + l[77], l[1007], function(e) {
            if (e) M.clearRubbish(1);
        });
        $('.fm-dialog-button.notification-button').each(function(i, e) {
            if ($(e).text() == l[1018]) $(e).text(l[83]);
        });
    } else if (RootbyId($.selected[0]) == 'contacts') {
        msgDialog('confirmation', l[1003], l[1004].replace('[X]', fm_contains(filecnt, foldercnt)), false, function(e) {
            if (e) {
                M.copyNodes($.selected, M.RubbishID, 1);
                topContextMenu(1);
            }
        });
    } else {
        msgDialog('confirmation', l[1003], l[1004].replace('[X]', fm_contains(filecnt, foldercnt)), false, function(e) {
            if (e) {
                M.moveNodes($.selected, M.RubbishID);
                topContextMenu(1);
            }
        });
    }
}

function fmremdupes(test) {
    var hs = {},
        i,
        f = [];
    var cRootID = RootbyId(M.currentdirid);
    loadingDialog.show();
    for (i in M.d) {
        var n = M.d[i];
        if (n && n.hash && n.h && RootbyId(n.h) === cRootID) {
            if (!hs[n.hash]) hs[n.hash] = [];
            hs[n.hash].push(n.h);
        }
    }
    for (i in hs) {
        var h = hs[i];
        while (h.length > 1) f.push(h.pop());
    }
    for (i in f) {
        console.debug('Duplicate node: ' + f[i] + ' at ~/' + M.getPath(f[i]).reverse().map(function(n) {
            return M.d[n].name || ''
        }).filter(String).join('/'));
    }
    loadingDialog.hide();
    console.log('Found ' + f.length + ' duplicated files.');
    if (!test && f.length) {
        $.selected = f;
        fmremove();
    }
    return f.length;
}

function initContextUI() {
    var c = '.context-menu-item';
    $(c + '.download-item').unbind('click');
    $(c + '.download-item').bind('click', function(event) {
        var c = $(this).attr('class');
        if (c && c.indexOf('dropdown') > -1) {
            $('.context-menu-item.more-item.dropdown').removeClass('active');
            if (c.indexOf('active') > -1) {
                $('.context-menu.files-menu').addClass('hidden');
                $(this).removeClass('active');
                return false;
            }
            $(this).addClass('active');
            $('.context-menu.files-menu .context-menu-divider').hide();
            $('.context-menu.files-menu .context-menu-item').hide();
            $('.context-menu.files-menu .download-standart-item').show();
            $('.context-menu.files-menu .zipdownload-item').show();
            $('.context-menu.files-menu').removeClass('hidden');
            var offset = $(this).offset();
            $('.context-menu.files-menu').css({
                top: offset.top + 35,
                left: offset.left
            });
        } else M.addDownload($.selected);
    });
    $(c + '.download-standart-item').unbind('click');
    $(c + '.download-standart-item').bind('click', function(event) {
        M.addDownload($.selected);
    });
    $(c + '.zipdownload-item').unbind('click');
    $(c + '.zipdownload-item').bind('click', function(event) {
        M.addDownload($.selected, true);
    });
    $(c + '.getlink-item').unbind('click');
    $(c + '.getlink-item').bind('click', function(event) {
        if (u_type === 0) ephemeralDialog(l[1005]);
        else M.getlinks($.selected);
    });
    $(c + '.sharing-item').unbind('click');
    $(c + '.sharing-item').bind('click', function(event) {
        if (u_type === 0) ephemeralDialog(l[1006]);
        else {
            shareDialog();
        }
    });
    $(c + '.rename-item').unbind('click');
    $(c + '.rename-item').bind('click', function(event) {
        renameDialog();
    });
    $(c + '.move-item').unbind('click');
    $(c + '.move-item').bind('click', function(event) {
        $.mctype = 'move';
        mcDialog();
    });
    $(c + '.copy-item').unbind('click');
    $(c + '.copy-item').bind('click', function(event) {
        $.mctype = 'copy-cloud';
        mcDialog();
    });
    $(c + '.newfolder-item').unbind('click');
    $(c + '.newfolder-item').bind('click', function(event) {
        createfolderDialog();
    });
    $(c + '.remove-item').unbind('click');
    $(c + '.remove-item').bind('click', function(event) {
        fmremove();
    });
    $(c + '.removeshare-item').unbind('click');
    $(c + '.removeshare-item').bind('click', function(event) {
        fmremove();
    });
    $(c + '.properties-item').unbind('click');
    $(c + '.properties-item').bind('click', function(event) {
        propertiesDialog();
    });
    $(c + '.permissions-item').unbind('click');
    $(c + '.permissions-item').bind('click', function(event) {
        if (d) console.log('permissions');
    });
    $(c + '.add-star-item').unbind('click');
    $(c + '.add-star-item').bind('click', function(event) {
        M.favourite($.selected, $.delfav);
        if (M.viewmode) $('.file-block').removeClass('ui-selected');
        else $('.grid-table.fm tr').removeClass('ui-selected');
        topContextMenu(1);
    });
    $(c + '.open-item').unbind('click');
    $(c + '.open-item').bind('click', function(event) {
        M.openFolder($.selected[0]);
    });
    $(c + '.preview-item').unbind('click');
    $(c + '.preview-item').bind('click', function(event) {
        slideshow($.selected[0]);
    });
    $(c + '.clearbin-item').unbind('click');
    $(c + '.clearbin-item').bind('click', function(event) {
        doClearbin();
    });
    $(c + '.addcontact-item').unbind('click');
    $(c + '.addcontact-item').bind('click', function(event) {
        addContactDialog();
        if (d) console.log('addcontact');
    });
    $(c + '.refresh-item').unbind('click');
    $(c + '.refresh-item').bind('click', function(event) {
        stopsc();
        stopapi();
        if (typeof mDB !== 'undefined' && !pfid) mDBreload();
        else loadfm();
    });
    $(c + '.select-all').unbind('click');
    $(c + '.select-all').bind('click', function(event) {
        selectionManager.select_all();
    });
    $(c + '.canceltransfer-item').unbind('click');
    $(c + '.canceltransfer-item').bind('click', function(event) {
        var toabort = {};
        $('.transfer-table tr.ui-selected').not('.clone-of-header').each(function(j, el) {
            toabort[$(el).attr('id')] = 1;
            $(this).remove();
        });
        toabort = Object.keys(toabort);
        DownloadManager.abort(toabort);
        UploadManager.abort(toabort);
        Soon(function() {
            // XXX: better way to stretch the scrollbar?
            $(window).trigger('resize');
            resetUploadDownload();
        });
    });
}

function cSortMenuUI() {
    $('.contacts-arrows').unbind('click');
    $('.contacts-arrows').bind('click', function(e) {
        var menuBlock = $('.sorting-menu');
        var bottomPosition = $('body').outerHeight() - $(menuBlock).outerHeight();
        if ($(this).attr('class').indexOf('active') == -1) {
            menuBlock.removeClass('hidden');
            $(this).addClass('active');
            var topl = 0,
                jsp = $('.fm-tree-panel').data('jsp');
            if (jsp) topl = jsp.getContentPositionY();
            menuBlock.css('top', $(this).position().top - topl + 95);
            menuBlock.css('left', $(this).position().left + 35);
            if (bottomPosition - $(menuBlock).position().top < 50) menuBlock.css('top', bottomPosition - 50);
        } else {
            $('.fm-main').bind('click');
            menuBlock.addClass('hidden');
            $(this).removeClass('active');
        }
        return false;
    });
    $('.contacts-sorting-by').unbind('click');
    $('.contacts-sorting-by').bind('click', function(e) {
        var c = $(this).attr('class');
        if (c && c.indexOf('name') > -1) {
            localStorage.csort = 'name';
            localStorage.csortd = 1;
        } else if (c && c.indexOf('shares') > -1) {
            localStorage.csort = 'shares';
            localStorage.csortd = -1;
        }
        M.renderContacts();
    });
    $('.contacts-sorting-type').unbind('click');
    $('.contacts-sorting-type').bind('click', function(e) {
        var c = $(this).attr('class');
        if (c && c.indexOf('desc') > -1) localStorage.csortd = -1;
        else localStorage.csortd = 1;
        M.renderContacts();
    });
}

function createfolderUI() {
    $('.fm-new-folder').unbind('click');
    $('.fm-new-folder').bind('click', function(e) {
        if (($('.fm-new-folder').position().left + 400) > $('body').width()) createfolderDialog();
        else {
            var c = $('.fm-new-folder').attr('class');
            var c2 = $(e.target).attr('class');
            var c3 = $(e.target).parent().attr('class');
            if ((!c2 || c2.indexOf('fm-new-folder') == -1) && (!c3 || c3.indexOf('fm-new-folder') == -1)) return false;
            if (c.indexOf('active') == -1) {
                $('.fm-new-folder').addClass('active');
                $('.create-new-folder input').focus();
            } else $('.fm-new-folder').removeClass('active');
        }
        $.hideContextMenu();
    });
    $('.create-folder-button').unbind('click');
    $('.create-folder-button').bind('click', function(e) {
        docreatefolderUI(e);
        return false;
    });
    $('.create-folder-input-bl input').unbind('keypress');
    $('.create-folder-input-bl input').bind('keypress', function(e) {
        if (e.which == 13) docreatefolderUI(e);
    });
}

function docreatefolderUI(e) {
    if ($('.create-folder-input-bl input').val() == '') $('.create-folder-input-bl input').animate({
        backgroundColor: '#d22000'
    }, 150, function() {
        $('.create-folder-input-bl input').animate({
            backgroundColor: 'white'
        }, 350, function() {
            $('.create-folder-input-bl input').focus();
        });
    });
    else createfolder(M.currentdirid, $('.create-folder-input-bl input').val());
}

function fmtopUI() {
    $('.fm-clearbin-button,.fm-add-user,.fm-new-folder,.fm-file-upload,.fm-folder-upload').addClass('hidden');
    if (RootbyId(M.currentdirid) == M.RubbishID) {
        $('.fm-clearbin-button').removeClass('hidden');
    } else if (RootbyId(M.currentdirid) == M.InboxID) {
        if (d) console.log('Inbox');
    } else if (M.currentdirid == 'contacts') {
        $('.fm-add-user').removeClass('hidden');
    } else if (M.currentdirid.length == 8 && RightsbyID(M.currentdirid) > 0) {
        $('.fm-new-folder').removeClass('hidden');
        $('.fm-file-upload').removeClass('hidden');
        if ((is_chrome_firefox & 2) || 'webkitdirectory' in document.createElement('input')) $('.fm-folder-upload').removeClass('hidden');
        else $('.fm-file-upload').addClass('last-button');
    }
    $('.fm-clearbin-button').unbind('click');
    $('.fm-clearbin-button').bind('click', function() {
        doClearbin();
    });
}

function doClearbin() {
    msgDialog('clear-bin', l[14], l[15], l[1007], function(e) {
        if (e) M.clearRubbish();
    });
}

function notificationsUI(close) {
    if (close) {
        $('.fm-main.notifications').addClass('hidden');
        $('.fm-main.default').removeClass('hidden');
        treeUI();
        if (M.viewmode) iconUI();
        else gridUI();
        return false;
    }
    notifymarkcount(true);
    donotify();
    $('.fm-main.notifications').removeClass('hidden');
    $('.fm-main.default').addClass('hidden');
    $(window).trigger('resize');
}

function accountUI() {
    $('.fm-account-overview').removeClass('hidden');
    $('.fm-account-button').removeClass('active');
    $('.fm-account-sections').addClass('hidden');
    $('.fm-right-files-block').addClass('hidden');
    $('.fm-right-account-block').removeClass('hidden');
    M.accountData(function(account) {
        var perc,
            warning,
            perc_c;
        var id = document.location.hash;
        if (id == '#fm/account/settings') {
            $('.fm-account-settings-button').addClass('active');
            $('.fm-account-settings').removeClass('hidden');
            if (is_chrome_firefox) {
                if (!$('#acc_dls_folder').length) {
                    $('#acc_use_ssl').before($('<div id="acc_dls_folder" style="margin-top:25px">' +
                        '<div class="account-bandwidth-txt">Downloads folder:</div>' +
                        '<input type="button" value="Browse..." style="-moz-appearance:' +
                        'button;margin-right:12px;cursor:pointer" />' +
                        '</div>'));
                    var fld = mozGetDownloadsFolder();
                    $('#acc_dls_folder').append($('<span/>').text(fld && fld.path));
                    $('#acc_dls_folder input').click(function() {
                        var fs = mozFilePicker(0, 2);
                        if (fs) {
                            mozSetDownloadsFolder(fs);
                            $(this).next().text(fs.path);
                        }
                    });
                }
            }
        } else if (id == '#fm/account/profile') {
            $('.fm-account-profile-button').addClass('active');
            $('.fm-account-profile').removeClass('hidden');
        } else if (id == '#fm/account/history') {
            $('.fm-account-history-button').addClass('active');
            $('.fm-account-history').removeClass('hidden');
        } else if (id == '#fm/account/reseller' && M.account.reseller) {
            $('.fm-account-reseller-button').addClass('active');
            $('.fm-account-reseller').removeClass('hidden');
        } else {
            $('.fm-account-overview-button').addClass('active');
            $('.fm-account-overview').removeClass('hidden');
        }
        $('.fm-account-blocks .membership-icon.type').removeClass('free pro1 pro2 pro3');
        if (u_attr.p) {
            // pro account:
            var protext;
            if (u_attr.p == 1) protext = 'PRO I';
            else if (u_attr.p == 2) protext = 'PRO II';
            else if (u_attr.p == 3) protext = 'PRO III';
            $('.membership-big-txt.accounttype').text(protext);
            $('.fm-account-blocks .membership-icon.type').addClass('pro' + u_attr.p);
            if (account.stype == 'S') {
                // subscription
                $('.fm-account-header.typetitle').text(l[434]);
                if (u.stime == 'W') $('.membership-big-txt.type').text(l[747]);
                else if (u.stime == 'M') $('.membership-big-txt.type').text(l[748]);
                else if (u.stime == 'Y') $('.membership-big-txt.type').text(l[749]);
                $('.membershtip-medium-txt.expiry').html(htmlentities(l[750]) + ' <span class="red">' + time2date(account.scycle) + '</span>');
            } else if (account.stype == 'O') {
                // one-time
                $('.fm-account-header.typetitle').text(l[746] + ':');
                $('.membership-big-txt.type').text(l[751]);
                $('.membershtip-medium-txt.expiry').html(l[987] + ' <span class="red">' + time2date(account.expiry) + '</span>');
            }
        } else {
            // free account:
            $('.fm-account-blocks .membership-icon.type').addClass('free');
            $('.membership-big-txt.type').text(l[435]);
            $('.membership-big-txt.accounttype').text(l[435]);
            $('.membershtip-medium-txt.expiry').text(l[436]);
        }
        perc = Math.round((account.servbw_used + account.downbw_used) / account.bw * 100);
        perc_c = perc;
        if (perc_c > 100) perc_c = 100;
        warning = '';
        if (perc > 99 && u_attr.p) {
            warning = '<div class="account-warning-icon"><span class="membership-notification"><span><span class="yellow">' + l[34] + ':</span> ' + l[1008] + ' ' + l[1009] + ' <a href="#pro" class="upgradelink">' + l[920] + '.</a></span><span class="membership-arrow"></span></span>&nbsp;</div>';
        } else if (perc > 99 && !u_attr.p) {
            // @@@ TODO: add dynamic bandwidth available in X minutes:
            warning = '<div class="account-warning-icon"><span class="membership-notification"><span><span class="yellow">' + l[34] + '</span> ' + l[1008] + ' ' + l[1009] + ' <a href="#pro" class="upgradelink">' + l[920] + '</a></span><span class="membership-arrow"></span></span>&nbsp;</div>';
        } else if (!u_attr.p) {
            // @@@ TODO: add dynamic bandwidth available in X minutes:
            var waittime = '30 minutes';
            warning = '<span class="membership-question">?<span class="membership-notification"><span>' + l[1056] + ' ' + l[1054].replace('[X]', waittime) + '</span><span class="membership-arrow"></span></span></span>';
        }
        $('.fm-account-main .membership-circle-bg.green-circle').attr('class', 'membership-circle-bg green-circle percents-' + perc_c);
        if (perc > 100) $('.fm-account-main .membership-circle-bg.green-circle').text(':-(');
        else $('.fm-account-main .membership-circle-bg.green-circle').html(perc + '<span class="membershtip-small-txt">%</span>');
        $('.fm-account-bar.green').width(perc_c + '%');
        var b1 = bytesToSize(account.servbw_used + account.downbw_used);
        b1 = b1.split(' ');
        b1[0] = Math.round(b1[0]) + ' ';
        var b2 = bytesToSize(account.bw);
        b2 = b2.split(' ');
        b2[0] = Math.round(b2[0]) + ' ';
        $('.pro-bandwidth .membership-big-txt.floating').html('<span class="membershtip-small-txt">' + l['439a'].replace('[X1]', '<span class="green lpxf">' + htmlentities(b1[0]) + '<span class="membershtip-small-txt">' + htmlentities(b1[1]) + '</span></span>').replace('[X2]', '<span class="lpxf">' + htmlentities(b2[0]) + '</span>' + ' <span class="membershtip-small-txt">' + htmlentities(b2[1]) + '</span>') + '</span>' + warning);
        $('.fm-account-main .pro-bandwidth').removeClass('hidden');
        $('.fm-account-main .free-bandwidth').addClass('hidden');
        if (perc > 99) $('.fm-account-mutliple-bl.bandwidth').addClass('exceeded');
        perc = Math.round(account.space_used / account.space * 100);
        perc_c = perc;
        if (perc_c > 100) perc_c = 100;
        if (perc > 99) $('.fm-account-mutliple-bl.storage').addClass('exceeded');
        warning = '';
        if (perc > 99) warning = '<div class="account-warning-icon"><span class="membership-notification"><span><span class="yellow">' + l[34] + ':</span> ' + l[1010] + ' ' + l[1011] + ' <a href="#pro"  class="upgradelink">' + l[920] + '.</a></span><span class="membership-arrow"></span></span>&nbsp;</div>';
        else if (perc > 79) warning = '<div class="account-warning-icon"><span class="membership-notification"><span><span class="yellow">' + l[34] + ':</span> ' + l[1012] + ' ' + l[1013] + ' <a href="#pro"  class="upgradelink">' + l[920] + '.</a></span><span class="membership-arrow"></span></span>&nbsp;</div>';
        $('.fm-account-main .membership-circle-bg.blue-circle').attr('class', 'membership-circle-bg blue-circle percents-' + perc_c);
        if (perc > 100) $('.fm-account-main .membership-circle-bg.blue-circle').text(':-(');
        else $('.fm-account-main .membership-circle-bg.blue-circle').html(perc + '<span class="membershtip-small-txt">%</span>');
        $('.fm-account-bar.blue').width(perc_c + '%');
        var b1 = bytesToSize(account.space_used);
        b1 = b1.split(' ');
        b1[0] = Math.round(b1[0]) + ' ';
        var b2 = bytesToSize(account.space);
        b2 = b2.split(' ');
        b2[0] = Math.round(b2[0]) + ' ';
        $('.membership-big-txt.space').html('<span class="membershtip-small-txt">' + l['439a'].replace('[X1]', '<span class="blue lpxf">' + htmlentities(b1[0]) + '<span class="membershtip-small-txt">' + htmlentities(b1[1]) + '</span></span>').replace('[X2]', '<span class="lpxf">' + htmlentities(b2[0]) + '</span>' + ' <span class="membershtip-small-txt">' + htmlentities(b2[1]) + '</span>') + '</span>' + warning);
        $('.fm-account-main .pro-upgrade').unbind('click');
        $('.fm-account-main .pro-upgrade').bind('click', function(e) {
            window.location.hash = 'pro';
        });
        $('.membership-big-txt.balance').html('&euro; ' + htmlentities(account.balance[0][0]));
        var a = 0;
        if (M.c['contacts'])
            for (var i in M.c['contacts']) a++;
        if (a == 1) $('.membership-big-txt.contacts').text(l[990]);
        else $('.membership-big-txt.contacts').text(l[989].replace('[X]', a));
        $('.membershtip-medium-txt.contacts').unbind('click');
        $('.membershtip-medium-txt.contacts').bind('click', function(e) {
            M.openFolder('contacts');
            return false;
        });
        if (!$.sessionlimit) $.sessionlimit = 10;
        if (!$.purchaselimit) $.purchaselimit = 10;
        if (!$.transactionlimit) $.transactionlimit = 10;
        if (!$.voucherlimit) $.voucherlimit = 10;
        $('.account-history-dropdown-button.sessions').text(l[472].replace('[X]', $.sessionlimit));
        $('.account-history-drop-items.session10-').text(l[472].replace('[X]', 10));
        $('.account-history-drop-items.session100-').text(l[472].replace('[X]', 100));
        $('.account-history-drop-items.session250-').text(l[472].replace('[X]', 250));
        M.account.sessions.sort(function(a, b) {
            if (a[0] < b[0]) return 1;
            else return -1;
        });
        $('.grid-table.sessions tr').remove();
        var html = '<tr><th>' + l[479] + '</th><th>' + l[480] + '</th><th>' + l[481] + '</th><th>' + l[482] + '</th></tr>';
        $(account.sessions).each(function(i, el) {
            if (i == $.sessionlimit) return false;
            var country = countrydetails(el[4]);
            var browser = browserdetails(el[2]);
            var recent = l[483];
            if (!el[5]) recent = time2date(el[0]);
            html += '<tr><td><span class="fm-browsers-icon"><img alt="" src="' + staticpath + 'images/browser/' + browser.icon + '" /></span><span class="fm-browsers-txt">' + htmlentities(browser.name) + '</span></td><td>' + htmlentities(el[3]) + '</td><td><span class="fm-flags-icon"><img alt="" src="' + staticpath + 'images/flags/' + country.icon + '" style="margin-left: 0px;" /></span><span class="fm-flags-txt">' + htmlentities(country.name) + '</span></td><td>' + htmlentities(recent) + '</td></tr>';
        });
        $('.grid-table.sessions').html(html);
        $('.account-history-dropdown-button.purchases').text(l[469].replace('[X]', $.purchaselimit));
        $('.account-history-drop-items.purchase10-').text(l[469].replace('[X]', 10));
        $('.account-history-drop-items.purchase100-').text(l[469].replace('[X]', 100));
        $('.account-history-drop-items.purchase250-').text(l[469].replace('[X]', 250));
        M.account.purchases.sort(function(a, b) {
            if (a[1] < b[1]) return 1;
            else return -1;
        });
        $('.grid-table.purchases tr').remove();
        var html = '<tr><th>' + l[475] + '</th><th>' + l[476] + '</th><th>' + l[477] + '</th><th>' + l[478] + '</th></tr>';
        $(account.purchases).each(function(i, el) {
            var paymentmethod = 'Voucher';
            if (el[4] == 1) paymentmethod = 'PayPal';
            var pro = {
                '9.99': [
                    'PRO I (' + l[918] + ')',
                    '1'
                ],
                '19.99': [
                    'PRO II (' + l[918] + ')',
                    '2'
                ],
                '29.99': [
                    'PRO III (' + l[918] + ')',
                    '3'
                ],
                '99.99': [
                    'PRO I (' + l[919] + ')',
                    '1'
                ],
                '199.99': [
                    'PRO II (' + l[919] + ')',
                    '2'
                ],
                '299.99': [
                    'PRO III (' + l[919] + ')',
                    '3'
                ]
            };
            html += '<tr><td>' + time2date(el[1]) + '</td><td><span class="fm-member-icon"><img alt="" src="' + staticpath + 'images/mega/icons/retina/pro' + pro[el[2]][1] + '@2x.png" /></span><span class="fm-member-icon-txt"> ' + pro[el[2]][0] + '</span></td><td>&euro;' + htmlentities(el[2]) + '</td><td>' + paymentmethod + '</td></tr>';
        });
        $('.grid-table.purchases').html(html);
        $('.account-history-dropdown-button.transactions').text(l[471].replace('[X]', $.transactionlimit));
        $('.account-history-drop-items.transaction10-').text(l[471].replace('[X]', 10));
        $('.account-history-drop-items.transaction100-').text(l[471].replace('[X]', 100));
        $('.account-history-drop-items.transaction250-').text(l[471].replace('[X]', 250));
        M.account.transactions.sort(function(a, b) {
            if (a[1] < b[1]) return 1;
            else return -1;
        });
        $('.grid-table.transactions tr').remove();
        var html = '<tr><th>' + l[475] + '</th><th>' + l[484] + '</th><th>' + l[485] + '</th><th>' + l[486] + '</th></tr>';
        $(account.transactions).each(function(i, el) {
            var credit = '',
                debit = '';
            if (el[2] > 0) credit = '<span class="green">&euro;' + htmlentities(el[2]) + '</span>';
            else debit = '<span class="red">&euro;' + htmlentities(el[2]) + '</span>';
            html += '<tr><td>' + time2date(el[1]) + '</td><td>' + htmlentities(el[0]) + '</td><td>' + credit + '</td><td>' + debit + '</td></tr>';
        });
        $('.grid-table.transactions').html(html);
        var i = new Date().getFullYear() - 10,
            html = '<option value="">YYYY</option>';
        $('.fm-account-select.year .account-select-txt').text('YYYY');
        while (i >= 1900) {
            if (u_attr.birthyear && i == u_attr.birthyear) {
                sel = ' selected';
                $('.fm-account-select.year .account-select-txt').text(u_attr.birthyear);
            } else sel = '';
            html += '<option value="' + i + '"' + sel + '>' + i + '</option>';
            i--;
        }
        $('.fm-account-select.year select').html(html);
        var i = 1,
            html = '<option value="">DD</option>',
            sel = '';;
        $('.fm-account-select.day .account-select-txt').text('DD');
        while (i < 32) {
            if (u_attr.birthday && i == u_attr.birthday) {
                sel = ' selected';
                $('.fm-account-select.day .account-select-txt').text(u_attr.birthday);
            } else sel = '';
            html += '<option value="' + i + '"' + sel + '>' + i + '</option>';
            i++;
        }
        $('.fm-account-select.day select').html(html);
        var i = 1,
            html = '<option value="">MM</option>',
            sel = '';
        $('.fm-account-select.month .account-select-txt').text('MM');
        while (i < 13) {
            if (u_attr.birthmonth && i == u_attr.birthmonth) {
                sel = ' selected';
                $('.fm-account-select.month .account-select-txt').text(u_attr.birthmonth);
            } else sel = '';
            html += '<option value="' + i + '"' + sel + '>' + i + '</option>';
            i++;
        }
        $('.fm-account-select.month select').html(html);
        var html = '<option value="">' + l[996] + '</option>',
            sel = '';
        $('.fm-account-select.country .account-select-txt').text(l[996]);
        for (country in isocountries) {
            if (u_attr.country && country == u_attr.country) {
                sel = ' selected';
                $('.fm-account-select.country .account-select-txt').text(isocountries[country]);
            } else sel = '';
            html += '<option value="' + country + '"' + sel + '>' + isocountries[country] + '</option>';
        }
        $('.fm-account-select.country select').html(html);
        $('.fm-account-select select').unbind('change');
        $('.fm-account-select select').bind('change', function(e) {
            var val = $(this).val();
            if ($(this).attr('name') == 'account-vouchertype') {
                $(this).find('option').each(function(i, e) {
                    if (val == $(e).val()) val = $(e).text();
                });
            } else {
                if ($(this).attr('name') == 'account-country') val = isocountries[val];
                $('.fm-account-save-block').removeClass('hidden');
            }
            $(this).parent().find('.account-select-txt').text(val);
        });
        $('#account-firstname,#account-lastname').unbind('keyup');
        $('#account-firstname,#account-lastname').bind('keyup', function(e) {
            $('.fm-account-save-block').removeClass('hidden');
        });
        $('.fm-account-cancel').unbind('click');
        $('.fm-account-cancel').bind('click', function(e) {
            $('.fm-account-save-block').addClass('hidden');
            accountUI();
        });
        $('.fm-account-save').unbind('click');
        $('.fm-account-save').bind('click', function(e) {
            u_attr.firstname = $('#account-firstname').val();
            u_attr.lastname = $('#account-lastname').val();
            u_attr.birthday = $('.fm-account-select.day select').val();
            u_attr.birthmonth = $('.fm-account-select.month select').val();
            u_attr.birthyear = $('.fm-account-select.year select').val();
            u_attr.country = $('.fm-account-select.country select').val();
            api_req({
                a: 'up',
                firstname: base64urlencode(to8(u_attr.firstname)),
                lastname: base64urlencode(to8(u_attr.lastname)),
                birthday: base64urlencode(u_attr.birthday),
                birthmonth: base64urlencode(u_attr.birthmonth),
                birthyear: base64urlencode(u_attr.birthyear),
                country: base64urlencode(u_attr.country)
            });
            $('.fm-account-save-block').addClass('hidden');
            if (M.account.dl_maxSlots) {
                localStorage.dl_maxSlots = M.account.dl_maxSlots;
                dl_maxSlots = M.account.dl_maxSlots;
                dlQueue.setSize(dl_maxSlots);
            }
            if (M.account.ul_maxSlots) {
                localStorage.ul_maxSlots = M.account.ul_maxSlots;
                ul_maxSlots = M.account.ul_maxSlots;
                ulQueue.setSize(ul_maxSlots);
            }
            if (typeof M.account.ul_maxSpeed !== 'undefined') {
                localStorage.ul_maxSpeed = M.account.ul_maxSpeed;
                ul_maxSpeed = M.account.ul_maxSpeed;
            }
            if (typeof M.account.use_ssl !== 'undefined') {
                localStorage.use_ssl = M.account.use_ssl;
                use_ssl = M.account.use_ssl;
            }
            if (typeof M.account.ul_skipIdentical !== 'undefined') {
                localStorage.ul_skipIdentical = M.account.ul_skipIdentical;
                ul_skipIdentical = M.account.ul_skipIdentical;
            }
            if (typeof M.account.uisorting !== 'undefined') storefmconfig('uisorting', M.account.uisorting);
            if (typeof M.account.uiviewmode !== 'undefined') storefmconfig('uiviewmode', M.account.uiviewmode);
            if ($('#account-password').val() == '' && ($('#account-new-password').val() !== '' || $('#account-confirm-password').val() !== '')) {
                msgDialog('warninga', l[135], l[719], false, function() {
                    $('#account-password').focus();
                });
            } else if ($('#account-new-password').val() !== $('#account-confirm-password').val()) {
                msgDialog('warninga', 'Error', l[715], false, function() {
                    $('#account-new-password').val('');
                    $('#account-confirm-password').val('');
                    $('#account-new-password').focus();
                });
            } else if ($('#account-confirm-password').val() !== '' && $('#account-password').val() !== '') {
                loadingDialog.show();
                changepw($('#account-password').val(), $('#account-confirm-password').val(), {
                    callback: function(res) {
                        loadingDialog.hide();
                        if (res == EACCESS) {
                            msgDialog('warninga', l[135], l[724], false, function() {
                                $('#account-password').val('');
                                $('#account-password').focus();
                            });
                        } else if (typeof res == 'number' && res < 0) msgDialog('warninga', 'Error', l[200]);
                        else {
                            msgDialog('info', l[726], l[725], false, function() {
                                $('#account-confirm-password,#account-password,#account-new-password').val('');
                            });
                        }
                    }
                });
            } else $('#account-confirm-password,#account-password,#account-new-password').val('');
            accountUI();
        });
        $('#account-firstname').val(u_attr.firstname);
        $('#account-lastname').val(u_attr.lastname);
        $('.account-history-dropdown-button').unbind('click');
        $('.account-history-dropdown-button').bind('click', function() {
            $(this).addClass('active');
            $('.account-history-dropdown').addClass('hidden');
            $(this).next().removeClass('hidden');
        });
        $('.account-history-drop-items').unbind('click');
        $('.account-history-drop-items').bind('click', function() {
            $(this).parent().prev().removeClass('active');
            $(this).parent().find('.account-history-drop-items').removeClass('active');
            $(this).parent().parent().find('.account-history-dropdown-button').text($(this).text());
            var c = $(this).attr('class');
            if (!c) c = '';
            if (c.indexOf('session10-') > -1) $.sessionlimit = 10;
            else if (c.indexOf('session100-') > -1) $.sessionlimit = 100;
            else if (c.indexOf('session250-') > -1) $.sessionlimit = 250;
            if (c.indexOf('purchaselimit10-') > -1) $.purchaselimit = 10;
            else if (c.indexOf('purchase100-') > -1) $.purchaselimit = 100;
            else if (c.indexOf('purchase250-') > -1) $.purchaselimit = 250;
            if (c.indexOf('transaction10-') > -1) $.transactionlimit = 10;
            else if (c.indexOf('transaction100-') > -1) $.transactionlimit = 100;
            else if (c.indexOf('transaction250-') > -1) $.transactionlimit = 250;
            if (c.indexOf('voucher10-') > -1) $.voucherlimit = 10;
            else if (c.indexOf('voucher100-') > -1) $.voucherlimit = 100;
            else if (c.indexOf('voucher250-') > -1) $.voucherlimit = 250;
            $(this).addClass('active');
            $(this).closest('.account-history-dropdown').addClass('hidden');
            accountUI();
        });
        $('#slider-range-max').slider({
            min: 1,
            max: 6,
            range: 'min',
            value: dl_maxSlots,
            slide: function(e, ui) {
                M.account.dl_maxSlots = ui.value;
                $('.fm-account-save-block').removeClass('hidden');
            }
        });
        $('#slider-range-max2').slider({
            min: 1,
            max: 6,
            range: 'min',
            value: ul_maxSlots,
            slide: function(e, ui) {
                M.account.ul_maxSlots = ui.value;
                $('.fm-account-save-block').removeClass('hidden');
            }
        });
        $('.ulspeedradio').removeClass('radioOn').addClass('radioOff');
        var i = 3;
        if (ul_maxSpeed == 0) i = 1;
        else if (ul_maxSpeed == -1) i = 2;
        else $('#ulspeedvalue').val(Math.floor(ul_maxSpeed / 1024));
        $('#rad' + i + '_div').removeClass('radioOff').addClass('radioOn');
        $('#rad' + i).removeClass('radioOff').addClass('radioOn');
        $('.ulspeedradio input').unbind('click');
        $('.ulspeedradio input').bind('click', function(e) {
            var id = $(this).attr('id');
            if (id == 'rad2') M.account.ul_maxSpeed = -1;
            else if (id == 'rad1') M.account.ul_maxSpeed = 0;
            else {
                if (parseInt($('#ulspeedvalue').val()) > 0) M.account.ul_maxSpeed = parseInt($('#ulspeedvalue').val()) * 1024;
                else M.account.ul_maxSpeed = 100 * 1024;
            }
            $('.ulspeedradio').removeClass('radioOn').addClass('radioOff');
            $(this).addClass('radioOn').removeClass('radioOff');
            $(this).parent().addClass('radioOn').removeClass('radioOff');
            $('.fm-account-save-block').removeClass('hidden');
        });
        $('#ulspeedvalue').unbind('click keyup');
        $('#ulspeedvalue').bind('click keyup', function(e) {
            $('.ulspeedradio').removeClass('radioOn').addClass('radioOff');
            $('#rad3,#rad3_div').addClass('radioOn').removeClass('radioOff');
            if (parseInt($('#ulspeedvalue').val()) > 0) M.account.ul_maxSpeed = parseInt($('#ulspeedvalue').val()) * 1024;
            else M.account.ul_maxSpeed = 100 * 1024;
            $('.fm-account-save-block').removeClass('hidden');
        });
        $('.ulskip').removeClass('radioOn').addClass('radioOff');
        var i = 5;
        if (ul_skipIdentical) i = 4;
        $('#rad' + i + '_div').removeClass('radioOff').addClass('radioOn');
        $('#rad' + i).removeClass('radioOff').addClass('radioOn');
        $('.ulskip input').unbind('click');
        $('.ulskip input').bind('click', function(e) {
            var id = $(this).attr('id');
            if (id == 'rad4') M.account.ul_skipIdentical = 1;
            else if (id == 'rad5') M.account.ul_skipIdentical = 0;
            $('.ulskip').removeClass('radioOn').addClass('radioOff');
            $(this).addClass('radioOn').removeClass('radioOff');
            $(this).parent().addClass('radioOn').removeClass('radioOff');
            $('.fm-account-save-block').removeClass('hidden');
        });
        $('.uisorting').removeClass('radioOn').addClass('radioOff');
        var i = 8;
        if (fmconfig.uisorting) i = 9;
        $('#rad' + i + '_div').removeClass('radioOff').addClass('radioOn');
        $('#rad' + i).removeClass('radioOff').addClass('radioOn');
        $('.uisorting input').unbind('click');
        $('.uisorting input').bind('click', function(e) {
            var id = $(this).attr('id');
            if (id == 'rad8') M.account.uisorting = 0;
            else if (id == 'rad9') M.account.uisorting = 1;
            $('.uisorting').removeClass('radioOn').addClass('radioOff');
            $(this).addClass('radioOn').removeClass('radioOff');
            $(this).parent().addClass('radioOn').removeClass('radioOff');
            $('.fm-account-save-block').removeClass('hidden');
        });
        $('.uiviewmode').removeClass('radioOn').addClass('radioOff');
        var i = 10;
        if (fmconfig.uiviewmode) i = 11;
        $('#rad' + i + '_div').removeClass('radioOff').addClass('radioOn');
        $('#rad' + i).removeClass('radioOff').addClass('radioOn');
        $('.uiviewmode input').unbind('click');
        $('.uiviewmode input').bind('click', function(e) {
            var id = $(this).attr('id');
            if (id == 'rad10') M.account.uiviewmode = 0;
            else if (id == 'rad11') M.account.uiviewmode = 1;
            $('.uiviewmode').removeClass('radioOn').addClass('radioOff');
            $(this).addClass('radioOn').removeClass('radioOff');
            $(this).parent().addClass('radioOn').removeClass('radioOff');
            $('.fm-account-save-block').removeClass('hidden');
        });
        $('.redeem-voucher').unbind('click');
        $('.redeem-voucher').bind('click', function(event) {
            if ($(this).attr('class').indexOf('active') == -1) {
                $(this).addClass('active');
                $('.fm-voucher-popup').removeClass('hidden');
                voucherCentering($(this));
                $(window).bind('resize', function() {
                    voucherCentering($('.redeem-voucher'));
                });
            } else {
                $(this).removeClass('active');
                $('.fm-voucher-popup').addClass('hidden');
            }
        });
        $('.fm-voucher-body input').unbind('focus');
        $('.fm-voucher-body input').bind('focus', function(e) {
            if ($(this).val() == l[487]) $(this).val('');
        });
        $('.fm-voucher-body input').unbind('blur');
        $('.fm-voucher-body input').bind('blur', function(e) {
            if ($(this).val() == '') $(this).val(l[487]);
        });
        $('.fm-voucher-button').unbind('click');
        $('.fm-voucher-button').bind('click', function(e) {
            if ($('.fm-voucher-body input').val() == l[487]) msgDialog('warninga', l[135], l[1015]);
            else {
                loadingDialog.show();
                api_req({
                    a: 'uavr',
                    v: $('.fm-voucher-body input').val()
                }, {
                    callback: function(res, ctx) {
                        loadingDialog.hide();
                        $('.fm-voucher-popup').addClass('hidden');
                        $('.fm-voucher-body input').val(l[487]);
                        if (typeof res == 'number') {
                            if (res == -11) msgDialog('warninga', l[135], l[714]);
                            else if (res < 0) msgDialog('warninga', l[135], l[473]);
                            else {
                                if (M.account) M.account.lastupdate = 0;
                                accountUI();
                            }
                        }
                    }
                });
            }
        });
        $('.vouchercreate').unbind('click');
        $('.vouchercreate').bind('click', function(e) {
            var vouchertype = $('.fm-account-select.vouchertype select').val();
            var voucheramount = parseInt($('#account-voucheramount').val());
            var proceed = false;
            for (var i in M.account.prices)
                if (M.account.prices[i][0] == vouchertype) proceed = true;
            if (!proceed) {
                msgDialog('warninga', 'Error', 'Please select the voucher type.');
                return false;
            }
            if (!voucheramount) {
                msgDialog('warninga', 'Error', 'Please enter a valid voucher amount.');
                return false;
            }
            if (vouchertype == '19.99') vouchertype = '19.991';
            loadingDialog.show();
            api_req({
                a: 'uavi',
                d: vouchertype,
                n: voucheramount,
                c: 'EUR'
            }, {
                callback: function(res, ctx) {
                    M.account.lastupdate = 0;
                    accountUI();
                }
            });
        });
        if (M.account.reseller) {
            $('.fm-account-reseller-button').removeClass('hidden');
            $('.account-history-dropdown-button.vouchers').text(l['466a'].replace('[X]', $.voucherlimit));
            $('.account-history-drop-items.voucher10-').text(l['466a'].replace('[X]', 10));
            $('.account-history-drop-items.voucher100-').text(l['466a'].replace('[X]', 100));
            $('.account-history-drop-items.voucher250-').text(l['466a'].replace('[X]', 250));
            M.account.vouchers.sort(function(a, b) {
                if (a['date'] < b['date']) return 1;
                else return -1;
            });
            $('.grid-table.vouchers tr').remove();
            var html = '<tr><th>' + l[475] + '</th><th>' + l[487] + '</th><th>' + l[477] + '</th><th>' + l[488] + '</th></tr>';
            $(account.vouchers).each(function(i, el) {
                if (i > $.voucherlimit) return false;
                var status = l[489];
                if (el.redeemed > 0 && el.cancelled == 0 && el.revoked == 0) status = l[490] + ' ' + time2date(el.redeemed);
                else if (el.revoked > 0 && el.cancelled > 0) status = l[491] + ' ' + time2date(el.revoked);
                else if (el.cancelled > 0) status = l[492] + ' ' + time2date(el.cancelled);
                html += '<tr><td>' + time2date(el.date) + '</td><td class="selectable">' + htmlentities(el.code) + '</td><td>&euro; ' + htmlentities(el.amount) + '</td><td>' + status + '</td></tr>';
            });
            $('.grid-table.vouchers').html(html);
            $('.fm-account-select.vouchertype select option').remove();
            var prices = [];
            for (var i in M.account.prices) prices.push(M.account.prices[i][0]);
            prices.sort(function(a, b) {
                return (a - b)
            })
            var voucheroptions = '';
            for (var i in prices) voucheroptions += '<option value="' + htmlentities(prices[i]) + '">&euro;' + htmlentities(prices[i]) + ' voucher</option>';
            $('.fm-account-select.vouchertype select').html(voucheroptions);
        }
        $('.fm-purchase-voucher,.membershtip-medium-txt.topup').unbind('click');
        $('.fm-purchase-voucher,.membershtip-medium-txt.topup').bind('click', function(e) {
            document.location.hash = 'resellers';
        });
        if (is_extension || ssl_needed()) $('#acc_use_ssl').hide();
        $('.usessl').removeClass('radioOn').addClass('radioOff');
        var i = 7;
        if (use_ssl) i = 6;
        $('#rad' + i + '_div').removeClass('radioOff').addClass('radioOn');
        $('#rad' + i).removeClass('radioOff').addClass('radioOn');
        $('.usessl input').unbind('click');
        $('.usessl input').bind('click', function(e) {
            var id = $(this).attr('id');
            if (id == 'rad7') M.account.use_ssl = 0;
            else if (id == 'rad6') M.account.use_ssl = 1;
            $('.usessl').removeClass('radioOn').addClass('radioOff');
            $(this).addClass('radioOn').removeClass('radioOff');
            $(this).parent().addClass('radioOn').removeClass('radioOff');
            $('.fm-account-save-block').removeClass('hidden');
        });
        $('.fm-account-change-avatar,.fm-account-avatar').unbind('click');
        $('.fm-account-change-avatar,.fm-account-avatar').bind('click', function(e) {
            avatarDialog();
        });
        if (avatars[u_handle]) $('.fm-account-avatar img').attr('src', avatars[u_handle].url);
        else $('.fm-account-avatar img').attr('src', staticpath + 'images/mega/default-avatar.png');
        $(window).unbind('resize.account');
        $(window).bind('resize.account', function() {
            if (M.currentdirid && M.currentdirid.substr(0, 7) == 'account') initAccountScroll();
        });
        initAccountScroll();
    }, 1);
    if (u_attr.firstname) $('.membership-big-txt.name').text(u_attr.firstname + ' ' + u_attr.lastname);
    else $('.membership-big-txt.name').text(u_attr.name);
    $('.editprofile').unbind('click');
    $('.editprofile').bind('click', function(event) {
        document.location.hash = 'fm/account/profile';
    });
    $('.fm-account-button').unbind('click');
    $('.fm-account-button').bind('click', function(event) {
        if ($(this).attr('class').indexOf('active') == -1) {
            switch (true) {
                case ($(this).attr('class').indexOf('fm-account-overview-button') >= 0):
                    document.location.hash = 'fm/account';
                    break;
                case ($(this).attr('class').indexOf('fm-account-profile-button') >= 0):
                    document.location.hash = 'fm/account/profile';
                    break;
                case ($(this).attr('class').indexOf('fm-account-settings-button') >= 0):
                    document.location.hash = 'fm/account/settings';
                    break;
                case ($(this).attr('class').indexOf('fm-account-history-button') >= 0):
                    document.location.hash = 'fm/account/history';
                    break;
                case ($(this).attr('class').indexOf('fm-account-reseller-button') >= 0):
                    document.location.hash = 'fm/account/reseller';
                    break;
            }
        }
    });
    $('.account-pass-lines').attr('class', 'account-pass-lines');
    $('#account-new-password').unbind('keyup');
    $('#account-new-password').bind('keyup', function(el) {
        $('.account-pass-lines').attr('class', 'account-pass-lines');
        if ($(this).val() !== '') {
            var pws = checkPassword($(this).val());
            if (pws <= 25) $('.account-pass-lines').addClass('good1');
            else if (pws <= 50) $('.account-pass-lines').addClass('good2');
            else if (pws <= 75) $('.account-pass-lines').addClass('good3');
            else $('.account-pass-lines').addClass('good4');
        }
    });
    $('#account-confirm-password').unbind('keyup');
    $('#account-confirm-password').bind('keyup', function(el) {
        if ($(this).val() == $('#account-new-password').val()) $('.fm-account-save-block').removeClass('hidden');
    });
}

function acc_checkpassword(pass) {
    if ((pass == 'Password') || (pass == '')) {
        document.getElementById('acc_pwstatus_text').innerHTML = '';
        document.getElementById('acc_pwstatus').className = 'register-pass-status-block account';
        return false;
    }
    var strength = checkPassword(pass);
    if (strength <= 25) {
        document.getElementById('acc_pwstatus_text').innerHTML = l[220];
        document.getElementById('acc_pwstatus').className = 'register-pass-status-block account good1';
    } else if (strength <= 50) {
        document.getElementById('acc_pwstatus_text').innerHTML = l[221];
        document.getElementById('acc_pwstatus').className = 'register-pass-status-block account good2';
    } else if (strength <= 75) {
        document.getElementById('acc_pwstatus_text').innerHTML = l[222];
        document.getElementById('acc_pwstatus').className = 'register-pass-status-block account good3';
    } else {
        document.getElementById('acc_pwstatus_text').innerHTML = l[223];
        document.getElementById('acc_pwstatus').className = 'register-pass-status-block account good1 good4';
    }
}
var imageCrop;

function avatarDialog(close) {
    if (close) {
        $.dialog = false;
        $('.avatar-dialog').addClass('hidden');
        $('.fm-dialog-overlay').addClass('hidden');
        return true;
    }
    $.dialog = 'avatar';
    $('.fm-dialog.avatar-dialog').removeClass('hidden');
    $('.fm-dialog-overlay').removeClass('hidden');
    $('.avatar-body').html('<div id="avatarcrop"><div class="image-upload-and-crop-container"><div class="image-explorer-container empty"><div class="image-explorer-image-view"><img class="image-explorer-source"><div class="avatar-white-bg"></div><div class="image-explorer-mask circle-mask"></div><div class="image-explorer-drag-delegate"></div></div><div class="image-explorer-scale-slider-wrapper"><input class="image-explorer-scale-slider disabled" type="range" min="0" max="100" step="1" value="0" disabled=""></div></div><div class="fm-notifications-bottom"><input type="file" id="image-upload-and-crop-upload-field" class="image-upload-field" accept="image/jpeg, image/gif, image/png"><label for="image-upload-and-crop-upload-field" class="image-upload-field-replacement fm-account-change-avatar">' + l[1016] + '</label><div class="fm-account-change-avatar" id="fm-change-avatar">' + l[1017] + '</div><div  class="fm-account-change-avatar" id="fm-cancel-avatar">Cancel</div><div class="clear"></div></div></div></div>');
    $('#fm-change-avatar').hide();
    $('#fm-cancel-avatar').hide();
    imageCrop = new ImageUploadAndCrop($('#avatarcrop').find('.image-upload-and-crop-container'), {
        cropButton: $('#fm-change-avatar'),
        onCrop: function(croppedDataURI) {
            var data = dataURLToAB(croppedDataURI);
            api_req({
                'a': 'up',
                '+a': base64urlencode(ab_to_str(data))
            });
            var blob = new Blob([data], {
                type: 'image/jpeg'
            });
            avatars[u_handle] = {
                data: blob,
                url: myURL.createObjectURL(blob)
            }
            $('.fm-account-avatar img').attr('src', avatars[u_handle].url);
            $('.fm-avatar img').attr('src', avatars[u_handle].url);
            avatarDialog(1);
        },
        onImageUpload: function() {
            $('.image-upload-field-replacement.fm-account-change-avatar').hide();
            $('#fm-change-avatar').show();
            $('#fm-cancel-avatar').show();
        },
        onImageUploadError: function() {}
    });
    $('#fm-cancel-avatar,.fm-dialog.avatar-dialog .fm-dialog-close').unbind('click');
    $('#fm-cancel-avatar,.fm-dialog.avatar-dialog .fm-dialog-close').bind('click', function(e) {
        avatarDialog(1);
    });
}

function gridUI() {
    var t = new Date().getTime();
    $.gridDragging = false;
    $.gridLastSelected = false;
    $('.fm-files-view-icon.listing-view').addClass('active');
    $('.fm-files-view-icon.block-view').removeClass('active');
    $.gridHeader = function() {
        var el = $('.grid-table-header th');
        var i = 0;
        var w = 0;
        while (i < el.length) {
            if (i !== 1) w += $(el[i]).width();
            i++;
        }
        $('.grid-table-header th:eq(1)').width($('.files-grid-view').width() - w - 60);
        initTransferScroll();
    }
    $.contactgridHeader = function() {
        var el = $('.contacts-grid-table th');
        var i = 0;
        var w = 0;
        while (i < el.length) {
            if (i !== 0) w += $(el[i]).width();
            i++;
        }
        $('.contacts-grid-header th:eq(0)').width($('.contacts-grid-view').width() - w - 34);
        initTransferScroll();
    }
    if (M.currentdirid == 'contacts') $.selectddUIgrid = '.contacts-grid-table';
    else $.selectddUIgrid = '.grid-scrolling-table';
    $.selectddUIitem = 'tr';
    selectddUI();
    $(window).unbind('resize.grid');
    $(window).bind('resize.grid', function() {
        if (M.viewmode == 0) {
            if (M.currentdirid == 'contacts') {
                $.contactgridHeader();
                initContactsGridScrolling();
            } else {
                initGridScrolling();
                $.gridHeader();
            }
        }
    });
    $('.fm-blocks-view').addClass('hidden');
    $('.fm-contacts-blocks-view').addClass('hidden');
    if (M.currentdirid == 'contacts') {
        $('.files-grid-view').addClass('hidden');
        $('.contacts-grid-view').removeClass('hidden');
        $.contactgridHeader();
        initContactsGridScrolling();
    } else {
        $('.contacts-grid-view').addClass('hidden');
        $('.files-grid-view').removeClass('hidden');
        initGridScrolling();
        $.gridHeader();
    }
    if (RootbyId(M.currentdirid) == 'contacts' || folderlink || RootbyId(M.currentdirid) == M.RubbishID) {
        $('.grid-url-arrow').hide();
        $('.grid-url-header').text('');
    } else {
        $('.grid-url-arrow').show();
        $('.grid-url-header').text('URL');
    }
    $('.files-grid-view,.fm-empty-cloud').unbind('contextmenu');
    $('.files-grid-view,.fm-empty-cloud').bind('contextmenu', function(e) {
        $('.file-block').removeClass('ui-selected');
        $.selected = [];
        if (contextmenuUI(e, 2)) return true;
        else return false;
        $.hideTopMenu();
    });
    if (d) console.log('gridUI() time:', new Date().getTime() - t);
    $('.grid-table-header .arrow').unbind('click');
    $('.grid-table-header .arrow').bind('click', function(e) {
        var c = $(this).attr('class');
        var d = 1;
        if (c && c.indexOf('desc') > -1) d = -1;
        if (c && c.indexOf('name') > -1) M.doSort('name', d);
        else if (c && c.indexOf('size') > -1) M.doSort('size', d);
        else if (c && c.indexOf('type') > -1) M.doSort('type', d);
        else if (c && c.indexOf('date') > -1) M.doSort('date', d);
        if (c) M.renderMain();
    });
}
/**
 * Helper function to get the jScrollPane container of this element
 *
 * @returns {*}
 */

$.fn.getParentJScrollPane = function() {
    var $scrollable_parent = $(this).parents('.jspScrollable:first');
    if ($scrollable_parent.size() > 0) {
        var $jsp = $scrollable_parent.data('jsp');
        if ($jsp) {
            return $jsp;
        } else {
            return false;
        }
    }
}
/**
 * Find jQuery Element in an jQuery array of elements and return its index OR -1 if not found.
 * Pretty similar to the $.inArray, but will match the object IDs.
 *
 *
 * @param el
 * @param arr
 * @returns int -1 or key index
 */

$.elementInArray = function(el, arr) {
    var found = $.map(arr, function(n, i) {
        return el.is(n) ? i : undefined;
    });
    return found.length > 0 ? found[0] : -1;
};
/**
 * Case insensitive :istartswith.
 *
 * @param a
 * @param i
 * @param m
 * @returns {boolean}
 */
jQuery.expr[':'].istartswith = function(a, i, m) {
    return jQuery(a).text().toUpperCase().indexOf(m[3].toUpperCase()) == 0;
};
/**
 * Really simple shortcut logic for select all, copy, paste, delete
 *
 * @constructor
 */
var FMShortcuts = function() {
    var current_operation = null;
    // unbind if already bound.
    $(window).unbind('keydown.fmshortcuts');
    // bind
    $(window).bind('keydown.fmshortcuts', function(e) {
        if (!is_fm()) return true;
        e = e || window.event;
        // DO NOT start the search in case that the user is typing something in a form field... (eg.g. contacts -> add
        // contact field)
        if ($(e.target).is('input, textarea, select') || $.dialog) {
            return;
        }
        var charCode = e.which || e.keyCode; // ff
        var charTyped = String.fromCharCode(charCode).toLowerCase();
        if (charTyped == 'a' && (e.ctrlKey || e.metaKey)) {
            selectionManager.select_all();
            return false; // stop prop.
        } else if ((charTyped == 'c' || charTyped == 'x') && (e.ctrlKey || e.metaKey)) {
            var $items = selectionManager.get_selected();
            if ($items.size() == 0) {
                return; // dont do anything.
            }
            current_operation = {
                'op': charTyped == 'c' ? 'copy' : 'cut',
                'src': $items
            };
            return false; // stop prop.
        } else if (charTyped == 'v' && (e.ctrlKey || e.metaKey)) {
            if (!current_operation) {
                return false; // stop prop.
            }
            $.each(current_operation.src, function(k, v) {
                if (current_operation.op == 'copy') {
                    M.copyNodes([$(v).attr('id')], M.currentdirid);
                } else if (current_operation.op == 'cut') {
                    M.moveNodes([$(v).attr('id')], M.currentdirid);
                }
            });
            if (current_operation.op == 'cut') {
                current_operation = null;
            }
            return false; // stop prop.
        } else if (charCode == 8) {
            var $items = selectionManager.get_selected();
            if ($items.size() == 0) {
                return; // dont do anything.
            }
            $.selected = [];
            $items.each(function() {
                $.selected.push($(this).attr('id'));
            });
            fmremove();
            // force remove, no confirmation
            if (e.ctrlKey || e.metaKey) {
                $('#msgDialog:visible .fm-dialog-button.confirm').trigger('click');
            }
            return false;
        }
    });
}
var fmShortcuts = new FMShortcuts();
/**
 * Simple way for searching for nodes by their first letter.
 *
 * PS: This is meant to be somehow reusable.
 *
 * @param searchable_elements selector/elements a list/selector of elements which should be searched for the user
 * specified key press character
 * @param containers selector/elements a list/selector of containers to which the input field will be centered (the code
 * will dynamically detect and pick the :visible container)
 *
 * @returns {*}
 * @constructor
 */
var QuickFinder = function(searchable_elements, containers) {
    var self = this;
    var DEBUG = false;
    self._is_active = false; // defined as a prop of this. so that when in debug mode it can be easily accessed from
    // out of this scope
    var last_key = null;
    var next_idx = 0;
    // hide on page change
    $(window).unbind('hashchange.quickfinder');
    $(window).bind('hashchange.quickfinder', function() {
        if (self.is_active()) {
            self.deactivate();
        }
    });
    // unbind if already bound.
    $(window).unbind('keypress.quickFinder');
    // bind
    $(window).bind('keypress.quickFinder', function(e) {
        e = e || window.event;
        // DO NOT start the search in case that the user is typing something in a form field... (eg.g. contacts -> add
        // contact field)
        if ($(e.target).is('input, textarea, select') || $.dialog) return;
        var charCode = e.which || e.keyCode; // ff
        if ((charCode >= 48 && charCode <= 57) || (charCode >= 65 && charCode <= 123) ||
            charCode > 255
        ) {
            var charTyped = String.fromCharCode(charCode);
            // get the currently visible container
            var $container = $(containers).filter(':visible');
            if ($container.size() == 0) {
                // no active container, this means that we are receiving events for a page, for which we should not
                // do anything....
                return;
            }
            self._is_active = true;
            $(self).trigger('activated');
            var $found = $(searchable_elements).filter(':visible:istartswith(\'' + charTyped + '\')');
            if (
                /* repeat key press, but show start from the first element */
                (last_key != null && ($found.size() - 1) <= next_idx) ||
                /* repeat key press is not active, should reset the target idx to always select the first element */
                (last_key == null)
            ) {
                next_idx = 0;
                last_key = null;
            } else if (last_key == charTyped) {
                next_idx++;
            } else if (last_key != charTyped) {
                next_idx = 0;
            }
            last_key = charTyped;
            $(searchable_elements).parents('.ui-selectee, .ui-draggable').removeClass('ui-selected');
            var $target_elm = $($found[next_idx]);
            $target_elm.parents('.ui-selectee, .ui-draggable').addClass('ui-selected');
            var $jsp = $target_elm.getParentJScrollPane();
            if ($jsp) {
                var $scrolled_elm = $target_elm.parent('a');
                if ($scrolled_elm.size() == 0) { // not in icon view, its a list view, search for a tr
                    $scrolled_elm = $target_elm.parents('tr:first');
                }
                $jsp.scrollToElement($scrolled_elm);
            }
            $(self).trigger('search');
            if ($target_elm && $target_elm.size() > 0) {
                // ^^ DONT stop prop. if there are no found elements.
                return false;
            }
        }
    });
    // hide the search field when the user had clicked somewhere in the document
    $(document.body).delegate('> *', 'mousedown', function(e) {
        if (self.is_active()) {
            self.deactivate();
            return false;
        }
    });
    // use events as a way to communicate with this from the outside world.
    self.deactivate = function() {
        self._is_active = false;
        $(self).trigger('deactivated');
    };
    self.is_active = function() {
        return self._is_active;
    };
    self.disable_if_active = function() {
        if (self.is_active()) {
            self.deactivate();
        }
    };
    return this;
};
var quickFinder = new QuickFinder('.tranfer-filetype-txt, .file-block-title, td span.contacts-username', '.files-grid-view, .fm-blocks-view, .contacts-grid-table');
/**
 * This should take care of flagging the LAST selected item in those cases:
 *
 *  - jQ UI $.selectable's multi selection using drag area (integrated using jQ UI $.selectable's Events)
 *
 *  - Single click selection (integrated by assumption that the .get_currently_selected will also try to cover this case
 *  when there is only one .ui-selected...this is how no other code had to be changed :))
 *
 *  - Left/right/up/down keys (integrated by using the .set_currently_selected and .get_currently_selected public
 *  methods)
 *
 * @param $selectable
 * @returns {*}
 * @constructor
 */
var SelectionManager = function($selectable) {
    var self = this;
    $selectable.unbind('selectableselecting');
    $selectable.unbind('selectableselected');
    $selectable.unbind('selectableunselecting');
    $selectable.unbind('selectableunselected');
    /**
     * Store all selected items in an _ordered_ array.
     *
     * @type {Array}
     */
    var selected_list = [];
    /**
     * Helper func to clear old reset state from other icons.
     */
    this.clear = function() {
        $('.currently-selected', $selectable).removeClass('currently-selected');
    };
    this.clear(); // remove ANY old .currently-selected values.
    /**
     * The idea of this method is to _validate_ and return the .currently-selected element.
     *
     * @param first_or_last string ("first" or "last") by default will return the first selected element if there is
     * not .currently-selected
     *
     * @returns {*|jQuery|HTMLElement}
     */
    this.get_currently_selected = function(first_or_last) {
        if (!first_or_last) {
            first_or_last = 'first';
        }
        var $currently_selected = $('.currently-selected', $selectable);
        if ($currently_selected.size() == 0) { // NO .currently-selected
            return $('.ui-selected:' + first_or_last, $selectable);
        } else if (!$currently_selected.is('.ui-selected')) { // validate that the currently selected is actually selected.
            // if not, try to get the first_or_last .ui-selected item
            var selected_elms = $('.ui-selected:' + first_or_last, $selectable);
            return selected_elms;
        } else { // everything is ok, we should return the .currently-selected
            return $currently_selected;
        }
    };
    /**
     * Used from the shortcut keys code.
     *
     * @param element
     */
    this.set_currently_selected = function($element) {
        self.clear();
        $element.addClass('currently-selected');
        quickFinder.disable_if_active();
        // Do .scrollIntoView if the parent or parent -> parent DOM Element is a JSP.
        {
            var $jsp = $element.getParentJScrollPane();
            if ($jsp) {
                $jsp.scrollToElement($element);
            }
        }
        var r = Math.random();
        $.topcR = r;
        setTimeout(function(r) {
            if ($.topcR == r) topContextMenu();
        }, 50, r);
    };
    /**
     * Simple helper func, for selecting all elements in the current view.
     */
    this.select_all = function() {
        var $selectable_containers = $([
            '.fm-blocks-view',
            '.files-grid-view',
            '.contacts-grid-view',
            '.fm-contacts-blocks-view'
        ].join(',')).filter(':visible');
        var $selectables = $([
            '.file-block',
            'tr.ui-draggable',
            'tr.ui-selectee',
            '.contact-block-view.ui-draggable'
        ].join(','), $selectable_containers).filter(':visible');
        $selectables.addClass('ui-selected');
        var r = Math.random();
        $.topcR = r;
        setTimeout(function(r) {
            if ($.topcR == r) topContextMenu();
        }, 50, r);
    };
    /**
     * Use this to get ALL (multiple!) selected items in the currently visible view/grid.
     */
    this.get_selected = function() {
        var $selectable_containers = $([
            '.fm-blocks-view',
            '.files-grid-view',
            '.contacts-grid-view',
            '.fm-contacts-blocks-view'
        ].join(',')).filter(':visible');
        var $selected = $([
            '.file-block',
            'tr.ui-draggable',
            'tr.ui-selectee',
            '.contact-block-view.ui-draggable'
        ].join(','), $selectable_containers).filter(':visible.ui-selected');
        return $selected;
    };
    /**
     * Push the last selected item to the end of the selected_list array.
     */
    $selectable.bind('selectableselecting', function(e, data) {
        var $selected = $(data.selecting);
        selected_list.push($selected);
    });
    /**
     * Remove any unselected element from the selected_list array.
     */
    $selectable.bind('selectableunselecting', function(e, data) {
        var $unselected = $(data.unselecting);
        var idx = $.elementInArray($unselected, selected_list);
        if (idx > -1) {
            delete selected_list[idx];
        }
    });
    /**
     * After the user finished selecting the icons, flag the last selected one as .currently-selecting
     */
    $selectable.bind('selectablestop', function(e, data) {
        self.clear();
        // remove `undefined` from the list
        selected_list = $.map(selected_list, function(n, i) {
            if (n != undefined) {
                return n;
            }
        });
        // add the .currently-selected
        if (selected_list.length > 0) {
            $(selected_list[selected_list.length - 1]).addClass('currently-selected');
        }
        selected_list = []; // reset the state of the last selected items for the next selectablestart
    });
    return this;
};
var selectionManager;

function closeDialog() {
    $('.fm-dialog').addClass('hidden');
    $('.fm-dialog-overlay').addClass('hidden');
    $('.export-links-warning').addClass('hidden');
    if ($.dialog == 'terms' && $.termsAgree) delete $.termsAgree;
    delete $.dialog;
}

function UIkeyevents() {
    $(window).unbind('keydown.uikeyevents');
    $(window).bind('keydown.uikeyevents', function(e) {
        var sl = false,
            s;
        if (M.viewmode) s = $('.fm-blocks-view .file-block.ui-selected');
        else s = $('.grid-table.fm tr.ui-selected');
        if (M.chat) return true;
        /**
         * Because of te .unbind, this can only be here... it would be better if its moved to iconUI(), but maybe some
         * other day :)
         */
        if (!$.dialog && !slideshowid && M.viewmode == 1) {
            var items_per_row = Math.floor($('.file-block').parent().outerWidth() / $('.file-block:first').outerWidth(true));
            var total_rows = Math.ceil($('.file-block').size() / items_per_row);
            if (e.keyCode == 37) {
                // left
                var current = selectionManager.get_currently_selected('first');
                // clear old selection if no shiftKey
                if (!e.shiftKey) s.removeClass('ui-selected');
                var $target_element = null;
                if (current.length > 0 && current.prev('.file-block').length > 0) $target_element = current.prev('.file-block');
                else $target_element = $('.file-block:last');
                if ($target_element) {
                    $target_element.addClass('ui-selected');
                    selectionManager.set_currently_selected($target_element);
                }
            } else if (e.keyCode == 39) {
                // right
                var current = selectionManager.get_currently_selected('last');
                if (!e.shiftKey) s.removeClass('ui-selected');
                var $target_element = null;
                var next = current.next('.file-block');
                // clear old selection if no shiftKey
                if (next.length > 0) $target_element = next;
                else $target_element = $('.file-block:first');
                if ($target_element) {
                    $target_element.addClass('ui-selected');
                    selectionManager.set_currently_selected($target_element);
                }
            } else if (e.keyCode == 38 || e.keyCode == 40) { // up & down
                var current = selectionManager.get_currently_selected('first');
                var current_idx = $.elementInArray(current, $('.file-block')) + 1;
                if (!e.shiftKey) {
                    s.removeClass('ui-selected');
                }
                var current_row = Math.ceil(current_idx / items_per_row);
                var current_col = current_idx % items_per_row;
                var target_row;
                if (e.keyCode == 38) { // up
                    // handle the case when the users presses ^ and the current row is the first row
                    target_row = current_row == 1 ? total_rows : current_row - 1;
                } else if (e.keyCode == 40) { // down
                    // handle the case when the users presses DOWN and the current row is the last row
                    target_row = current_row == total_rows ? 1 : current_row + 1;
                }
                // calc the index of the target element

                var target_element_num = ((target_row - 1) * items_per_row) + (current_col - 1);
                var $target = $('.file-block:eq(' + target_element_num + ')');
                $target.addClass('ui-selected');
                selectionManager.set_currently_selected($target);
            }
        }
        if (e.keyCode == 38 && s.length > 0 && $.selectddUIgrid == '.grid-scrolling-table' && !$.dialog) {
            // up in grid
            if (e.shiftKey) $(e).addClass('ui-selected');
            if ($(s[0]).prev().length > 0) {
                if (!e.shiftKey) $('.grid-table.fm tr').removeClass('ui-selected');
                $(s[0]).prev().addClass('ui-selected');
                sl = $(s[0]).prev();
                quickFinder.disable_if_active();
            }
            var r = Math.random();
            $.topcR = r;
            setTimeout(function(r) {
                if ($.topcR == r) topContextMenu();
            }, 50, r);
        } else if (e.keyCode == 40 && s.length > 0 && $.selectddUIgrid == '.grid-scrolling-table' && !$.dialog) {
            // down in grid
            if (e.shiftKey) $(e).addClass('ui-selected');
            if ($(s[s.length - 1]).next().length > 0) {
                if (!e.shiftKey) $('.grid-table.fm tr').removeClass('ui-selected');
                $(s[s.length - 1]).next().addClass('ui-selected');
                sl = $(s[0]).next();
                quickFinder.disable_if_active();
            }
            var r = Math.random();
            $.topcR = r;
            setTimeout(function(r) {
                if ($.topcR == r) topContextMenu();
            }, 50, r);
        } else if (e.keyCode == 46 && s.length > 0 && !$.dialog && RightsbyID(M.currentdirid) > 1) {
            $.selected = [];
            s.each(function(i, e) {
                $.selected.push($(e).attr('id'));
            });
            fmremove();
        } else if (e.keyCode == 13 && s.length > 0 && !$.dialog && !$.msgDialog && $('.fm-new-folder').attr('class').indexOf('active') == -1 && $('.top-search-bl').attr('class').indexOf('active') == -1) {
            $.selected = [];
            s.each(function(i, e) {
                $.selected.push($(e).attr('id'));
            });
            if ($.selected && $.selected.length > 0) {
                var n = M.d[$.selected[0]];
                if (n && n.t) M.openFolder(n.h);
                else if ($.selected.length == 1 && M.d[$.selected[0]] && is_image(M.d[$.selected[0]])) slideshow($.selected[0]);
                else M.addDownload($.selected);
            }
        } else if (e.keyCode == 13 && $.dialog == 'rename') {
            dorename();
        } else if (e.keyCode == 27 && $.dialog) {
            closeDialog();
        } else if (e.keyCode == 27 && $.msgDialog) {
            closeMsg();
            if ($.warningCallback) $.warningCallback(false);
        } else if (e.keyCode == 13 && $.msgDialog == 'confirmation') {
            closeMsg();
            if ($.warningCallback) $.warningCallback(true);
        } else if (e.keyCode == 65 && e.ctrlKey && !$.dialog) {
            $('.grid-table.fm tr').addClass('ui-selected');
            $('.file-block').addClass('ui-selected');
        } else if (e.keyCode == 37 && slideshowid) {
            slideshow_prev();
        } else if (e.keyCode == 39 && slideshowid) {
            slideshow_next();
        } else if (e.keyCode == 27 && slideshowid) {
            slideshow(slideshowid, true);
        } else if (e.keyCode == 27) {
            $.hideTopMenu();
        }
        if (sl && $.selectddUIgrid == '.grid-scrolling-table') {
            var jsp = $('.grid-scrolling-table').data('jsp');
            jsp.scrollToElement(sl);
        }
        searchPath();
    });
}

function searchPath() {
    if (M.currentdirid && M.currentdirid.substr(0, 7) == 'search/') {
        var sel;
        if (M.viewmode) sel = $('.fm-blocks-view .ui-selected');
        else sel = $('.grid-table .ui-selected');
        if (sel.length == 1) {
            var html = '';
            var path = M.getPath($(sel[0]).attr('id'));
            path.reverse();
            for (var i in path) {
                var c,
                    name,
                    id = false,
                    iconimg = '';;
                var n = M.d[path[i]];
                if (path[i].length == 11 && M.u[path[i]]) {
                    id = path[i];
                    c = 'contacts-item';
                    name = M.u[path[i]].m;
                } else if (path[i] == M.RootID) {
                    id = M.RootID;
                    c = 'cloud-drive';
                    name = l[164];
                } else if (path[i] == M.RubbishID) {
                    id = M.RubbishID;
                    c = 'recycle-item';
                    name = l[168];
                } else if (path[i] == M.InboxID) {
                    id = M.InboxID;
                    c = 'inbox-item';
                    name = l[166];
                } else if (n) {
                    id = n.h;
                    c = '';
                    name = n.name;
                    if (n.t) c = 'folder';
                    else iconimg = '<span class="search-path-icon-span ' + fileicon(n) + '"></span>';
                }
                if (id) {
                    html += '<div class="search-path-icon ' + c + '" id="spathicon_' + htmlentities(id) + '">' + iconimg + '</div><div class="search-path-txt" id="spathname_' + htmlentities(id) + '">' + htmlentities(name) + '</div>';
                    if (i < path.length - 1) html += '<div class="search-path-arrow"></div>';
                }
            }
            html += '<div class="clear"></div>';
            $('.search-bottom-menu').html(html);
            $('.fm-blocks-view,.files-grid-view').addClass('search');
            $('.search-path-icon,.search-path-icon').unbind('click');
            $('.search-path-icon,.search-path-txt').bind('click', function(e) {
                var id = $(this).attr('id');
                if (id) {
                    id = id.replace('spathicon_', '').replace('spathname_', '');
                    var n = M.d[id];
                    $.selected = [];
                    if (!n.t) {
                        $.selected.push(id);
                        id = n.p;
                    }
                    if (n) M.openFolder(id);
                    if ($.selected.length > 0) reselect(1);
                }
            });
        } else $('.fm-blocks-view,.files-grid-view').removeClass('search');
    } else $('.fm-blocks-view,.files-grid-view').removeClass('search');
}

function selectddUI() {
    if (M.currentdirid && M.currentdirid.substr(0, 7) == 'account') return false;
    $($.selectddUIgrid + ' ' + $.selectddUIitem + '.folder').droppable({
        tolerance: 'pointer',
        drop: function(e, ui) {
            $.doDD(e, ui, 'drop', 0);
        },
        over: function(e, ui) {
            $.doDD(e, ui, 'over', 0);
        },
        out: function(e, ui) {
            $.doDD(e, ui, 'out', 0);
        }
    });
    $($.selectddUIgrid + ' ' + $.selectddUIitem).draggable({
        start: function(e, u) {
            $.hideContextMenu(e);
            $.gridDragging = true;
            if ($(this).attr('class').indexOf('ui-selected') == -1) {
                $($.selectddUIgrid + ' ' + $.selectddUIitem).removeClass('ui-selected');
                $(this).addClass('ui-selected');
            }
            var s = $($.selectddUIgrid + ' .ui-selected');
            $.selected = [];
            s.each(function(i, e) {
                $.selected.push($(e).attr('id'));
            });
            if (s.length > 1) {
                $('.dragger-block').addClass('multiple');
                $('.dragger-files-number').text(s.length);
                $('.dragger-files-number').show();
            }
            var a = 0,
                html = '',
                cl = '',
                done = {};
            $('#draghelper .dragger-icon').remove();
            for (var i in $.selected) {
                if (a == 0) cl = 'third';
                else if (a == 1) cl = 'second';
                else if (a == 2) cl = 'first';
                var ico = fileicon(M.d[$.selected[i]]);
                if (a < 3 && !done[ico]) {
                    done[ico] = 1;
                    html = '<div class="dragger-icon ' + cl + ' ' + ico + '"></div>' + html;
                    a++;
                }
            }
            $(html).insertBefore('#draghelper .dragger-status');
        },
        drag: function(e, u) {},
        refreshPositions: true,
        containment: 'document',
        distance: 10,
        revertDuration: 200,
        revert: true,
        cursorAt: {
            right: 100,
            bottom: 70
        },
        helper: function(e, ui) {
            return getDDhelper();
        },
        stop: function(event) {
            $.gridDragging = false;
            setTimeout(function() {
                treeUIopen(M.currentdirid);
            }, 500);
        }
    });
    $('.ui-selectable-helper').remove();
    $($.selectddUIgrid).selectable({
        filter: $.selectddUIitem,
        start: function(e, u) {
            $.hideContextMenu(e);
            $.hideTopMenu();
        },
        stop: function(e, u) {
            searchPath();
            topContextMenu();
        }
    });
    /**
     * (Re)Init the selectionManager, because the .selectable() is reinitialized and we need to reattach to its
     * events.
     *
     * @type {SelectionManager}
     */
    selectionManager = new SelectionManager($('.file-block-scrolling'));
    $($.selectddUIgrid + ' ' + $.selectddUIitem).unbind('contextmenu');
    $($.selectddUIgrid + ' ' + $.selectddUIitem).bind('contextmenu', function(e) {
        if ($(this).attr('class').indexOf('ui-selected') == -1) {
            $($.selectddUIgrid + ' ' + $.selectddUIitem).removeClass('ui-selected');
            $(this).addClass('ui-selected');
        }
        cacheselect();
        searchPath();
        if (contextmenuUI(e, 1)) return true;
        else return false;
    });
    $($.selectddUIgrid + ' ' + $.selectddUIitem).unbind('click');
    $($.selectddUIgrid + ' ' + $.selectddUIitem).bind('click', function(e) {
        if ($.gridDragging) return false;
        var s = e.shiftKey && $($.selectddUIgrid + ' .ui-selected');
        if (s && s.length > 0) {
            var start = s[0];
            var end = this;
            if ($.gridLastSelected && $($.gridLastSelected).attr('class').indexOf('ui-selected') > -1) start = $.gridLastSelected;
            else $.gridLastSelected = this;
            if ($(start).index() > $(end).index()) {
                end = start;
                start = this;
            }
            $($.selectddUIgrid + ' ' + $.selectddUIitem).removeClass('ui-selected');
            $([start,
                end
            ]).addClass('ui-selected');
            $(start).nextUntil($(end)).each(function(i, e) {
                $(e).addClass('ui-selected');
            });
            selectionManager.set_currently_selected($(this));
        } else if (e.ctrlKey == false && e.metaKey == false) {
            $($.selectddUIgrid + ' ' + $.selectddUIitem).removeClass('ui-selected');
            $(this).addClass('ui-selected');
            $.gridLastSelected = this;
            selectionManager.set_currently_selected($(this));
        } else {
            if ($(this).hasClass('ui-selected')) $(this).removeClass('ui-selected');
            else {
                $(this).addClass('ui-selected');
                $.gridLastSelected = this;
                selectionManager.set_currently_selected($(this));
            }
        }
        searchPath();
        $.hideContextMenu(e);
        if ($.hideTopMenu) $.hideTopMenu();
        return false;
    });
    $($.selectddUIgrid + ' ' + $.selectddUIitem).unbind('dblclick');
    $($.selectddUIgrid + ' ' + $.selectddUIitem).bind('dblclick', function(e) {
        var h = $(e.currentTarget).attr('id');
        var n = M.d[h] || {};
        if (n.t) {
            $('.top-context-menu').hide();
            M.openFolder(h);
        } else if (is_image(n)) slideshow(h);
        else M.addDownload([h]);
    });
}

function iconUI() {
    $('.fm-files-view-icon.block-view').addClass('active');
    $('.fm-files-view-icon.listing-view').removeClass('active');
    if (M.currentdirid == 'contacts') {
        $.selectddUIgrid = '.contacts-blocks-scrolling';
        $.selectddUIitem = '.contact-block-view';
    } else {
        $.selectddUIgrid = '.file-block-scrolling';
        $.selectddUIitem = 'a';
    }
    selectddUI();
    $('.files-grid-view').addClass('hidden');
    $('.contacts-grid-view').addClass('hidden');
    if (M.currentdirid == 'contacts') {
        $('.fm-blocks-view').addClass('hidden');
        $('.fm-contacts-blocks-view').removeClass('hidden');
        initContactsBlocksScrolling();
    } else {
        $('.fm-contacts-blocks-view').addClass('hidden');
        $('.fm-blocks-view').removeClass('hidden');
        initFileblocksScrolling();
    }
    $(window).unbind('resize.icon');
    $(window).bind('resize.icon', function() {
        if (M.viewmode == 1 && M.currentdirid == 'contacts') initContactsBlocksScrolling();
        else if (M.viewmode == 1) initFileblocksScrolling();
    });
    $('.fm-blocks-view').unbind('contextmenu');
    $('.fm-blocks-view').bind('contextmenu', function(e) {
        $('.file-block').removeClass('ui-selected');
        selectionManager.clear(); // is this required? don't we have a support for a multi-selection context menu?
        $.selected = [];
        if (contextmenuUI(e, 2)) return true;
        else return false;
        $.hideTopMenu();
    });
}

function topContextMenu(close) {
    if (close) {
        fmtopUI();
        $('.top-context-menu').fadeOut(350, function() {
            $('.fm-right-header').removeClass('context');
        });
        delete $.topContextR;
        return;
    }
    cacheselect();
    if ($.selected.length == 0) {
        topContextMenu(1);
        return false;
    }
    var items = menuItems();
    delete items['zipdownload'];
    delete items['refresh'];
    $('.top-icons-block .context-menu-item').hide();
    $('.top-icons-block .context-menu-divider').hide();
    $('.top-context-menu').fadeIn(350);
    setTimeout(function(id) {
        if (id !== M.currentdirid) return;
        $('.fm-right-header').addClass('context');
        $('.fm-file-upload').addClass('hidden');
        $('.fm-folder-upload').addClass('hidden');
    }, 180, M.currentdirid);
    $.topContextSub = {};
    var moreWidth = $('.top-icons-block .context-menu-item.more-item').outerWidth();
    var w = 0,
        i = 0,
        total = 0;
    for (var item in items) total++;
    $('.top-icons-block .context-menu-item').each(function(j, e) {
        var c = $(e).attr('class');
        for (var item in items) {
            if (c && c.indexOf(' ' + item + '-item') > -1) {
                w = w + $('.top-icons-block .context-menu-item').filter('.' + item + '-item').outerWidth() + 3;
                if ((w > $('.top-context-menu').width() - 50) || (w + moreWidth > $('.top-context-menu').width() - 50 && i < total - 1)) {
                    w = w + 200;
                    $.topContextSub[item] = 1;
                    $('.context-menu-item.more-item').show();
                } else {
                    $('.top-icons-block .context-menu-item').filter('.' + item + '-item').show();
                    $('.top-icons-block .context-menu-divider').filter('.' + item).show();
                }
                i++;
            }
        }
    });
    $('.top-icons-block .context-menu-item.more-item').unbind('click');
    $('.top-icons-block .context-menu-item.more-item').bind('click', function(e) {
        $('.context-menu-item.download-item.dropdown').removeClass('active');
        var c = $(this).attr('class');
        if (c && c.indexOf('active') > -1) {
            $(this).removeClass('active');
            $.hideContextMenu(e);
        } else {
            if (c.indexOf('active') > -1) {
                $('.context-menu.files-menu').addClass('hidden');
                $(this).removeClass('active');
                return false;
            }
            $(this).addClass('active');
            $('.context-menu.files-menu .context-menu-divider').hide();
            $('.context-menu.files-menu .context-menu-item').hide();
            for (var item in $.topContextSub) $('.context-menu.files-menu .' + item + '-item').show();
            $('.context-menu.files-menu').removeClass('hidden');
            var offset = $(this).offset();
            $('.context-menu.files-menu').css({
                top: offset.top + 35,
                left: offset.left
            });
        }
    });
    $('.top-icons-block').unbind('mouseover');
    $('.top-icons-block').bind('mouseover', function(e) {
        delete $.topContextR;
    });
    var r = Math.random();
    $.topContextR = r;
    setTimeout(function(r) {
        if (r == $.topContextR) {
            topContextMenu(300);
        }
    }, 2000, r);
    $('.top-context-close').unbind('click');
    $('.top-context-close').bind('click', function() {
        topContextMenu(10);
    });
}

function transferPanelUI() {
    $.transferHeader = function() {
        fm_resize_handler();
        var el = $('.transfer-table-header th');
        var i = 1;
        var w = 0;
        while (i < el.length) {
            w += $(el[i]).width();
            i++;
        }
        $('.transfer-table-header th:eq(0)').width($('.transfer-panel').width() - w - 82);
        $('.transfer-table tr').unbind('click contextmenu');
        $('.transfer-table tr').bind('click contextmenu', function(e) {
            if (e.type == 'contextmenu') {
                $('.context-menu.files-menu .context-menu-item').hide();
                $('.context-menu.files-menu .context-menu-item').filter('.refresh-item,.canceltransfer-item').show();
                var c = $(this).attr('class');
                if (!c || (c && c.indexOf('ui-selected') == -1)) $('.transfer-table tr').removeClass('ui-selected');
                $(this).addClass('ui-selected');
                $(this).addClass('dragover');
                if (contextmenuUI(e)) return true;
                else return false;
            } else {
                var s = $('.transfer-table tr');
                if (e.shiftKey && s.length > 0) {
                    var start = s[0];
                    var end = this;
                    if ($.TgridLastSelected && $($.TgridLastSelected).attr('class').indexOf('ui-selected') > -1) start = $.TgridLastSelected;
                    if ($(start).index() > $(end).index()) {
                        end = start;
                        start = this;
                    }
                    $('.transfer-table tr').removeClass('ui-selected');
                    $([start,
                        end
                    ]).addClass('ui-selected');
                    $(start).nextUntil($(end)).each(function(i, e) {
                        $(e).addClass('ui-selected');
                    });
                } else if (e.metaKey == false) {
                    $('.transfer-table tr').removeClass('ui-selected');
                    $(this).addClass('ui-selected');
                    $.TgridLastSelected = this;
                } else {
                    if ($(this).hasClass('ui-selected')) $(this).removeClass('ui-selected');
                    else {
                        $(this).addClass('ui-selected');
                        $.TgridLastSelected = this;
                    }
                }
            }
        });
        initTransferScroll();
    }
    $(window).unbind('resize.transferpanel');
    $(window).bind('resize.transferpanel', function(e) {
        $.transferHeader();
    });
    $(window).unbind('resize.slideshow');
    $(window).bind('resize.slideshow', function(e) {
        if (slideshowid && previews[slideshowid]) previewsrc(previews[slideshowid].src);
    });
    $('.tranfer-view-icon').unbind('click');
    $('.tranfer-view-icon').bind('click', function(e) {
        $.transferOpen();
    });
    $.transferClose = function() {
        $('.tranfer-view-icon').removeClass('active');
        $('#fmholder').removeClass('transfer-panel-opened');
        $('.transfer-panel').css({
            'height': ''
        });
        $(window).trigger('resize');
    }
    $.transferOpen = function(force) {
        if ($('.tranfer-view-icon').attr('class').indexOf('active') == -1 || force) {
            $('.tranfer-view-icon').addClass('active');
            $('#fmholder').addClass('transfer-panel-opened');
            if (localStorage.transferPaneHeight && $.transferPaneResizable) $('.transfer-panel').css({
                'height': Math.max($.transferPaneResizable.options.minHeight, localStorage.transferPaneHeight) + 'px'
            });
            else $('.transfer-panel').css({
                'height': '193px'
            });
            $.transferHeader();
        } else {
            $.transferClose();
        }
        initTreeScroll();
        if (M.currentdirid == 'notifications') notificationsScroll();
        else if (M.currentdirid && M.currentdirid.substr(0, 7) == 'account') initAccountScroll();
        else if (M.viewmode == 1) initFileblocksScrolling();
        else initGridScrolling();
        $(window).trigger('resize');
    };
    $('.transfer-settings-icon').unbind('click');
    $('.transfer-settings-icon').bind('click', function() {
        if (u_type === 0) ephemeralDialog('Transfer settings are for registered users only.');
        else document.location.hash = 'fm/account/settings';
    });
    $('.transfer-pause-icon').unbind('click');
    $('.transfer-pause-icon').bind('click', function() {
        if ($(this).attr('class').indexOf('active') > -1) {
            // terms of service
            if (u_type || u_attr.terms) {
                $(this).removeClass('active');
                dlQueue.resume();
                ulQueue.resume();
                ui_paused = false;
                uldl_hold = false;
            } else {
                alert(l[214]);
                DEBUG(l[214]);
            }
        } else {
            $(this).addClass('active');
            dlQueue.pause();
            ulQueue.pause();
            ui_paused = true;
            uldl_hold = true;
            $('.transfer-table tr td:eq(4), .transfer-table tr td:eq(6)').each(function() {
                $(this).text('');
            });
        }
    });
}

function getDDhelper() {
    var id = '#fmholder';
    if (page == 'start') id = '#startholder';
    $('.dragger-block').remove();
    $(id).append('<div class="dragger-block drag" id="draghelper"><div class="dragger-status"></div><div class="dragger-files-number">1</div></div>');
    $('.dragger-block').removeClass('multiple');
    $('.dragger-block').show();
    $('.dragger-files-number').hide();
    return $('.dragger-block')[0];
}

function menuItems() {
    var items = [];
    var sourceRoot = RootbyId($.selected[0]);
    if ($.selected.length == 1 && RightsbyID($.selected[0]) > 1) items['rename'] = 1;
    if (RightsbyID($.selected[0]) > 0) {
        items['add-star'] = 1;
        $.delfav = 1;
        for (var i in $.selected) {
            var n = M.d[$.selected[i]];
            if (n && !n.fav) $.delfav = 0;
        }
        if ($.delfav) $('.add-star-item').text(l[976]);
        else $('.add-star-item').text(l[975]);
    }
    var n = M.d[$.selected[0]];
    if (n && n.p.length == 11) items['removeshare'] = 1;
    else if (RightsbyID($.selected[0]) > 1) items['remove'] = 1;
    if (n && $.selected.length == 1 && n.t) items['open'] = 1;
    if (n && $.selected.length == 1 && is_image(n)) items['preview'] = 1;
    if (n && sourceRoot == M.RootID && $.selected.length == 1 && n.t && !folderlink) items['sharing'] = 1;
    if (sourceRoot == M.RootID && !folderlink) {
        items['move'] = 1;
        items['getlink'] = 1;
    } else if (sourceRoot == M.RubbishID && !folderlink) items['move'] = 1;
    items['download'] = 1;
    items['zipdownload'] = 1;
    items['copy'] = 1;
    items['properties'] = 1;
    items['refresh'] = 1;
    if (folderlink) {
        delete items['properties'];
        delete items['copy'];
        delete items['add-star'];
    }
    return items;
}

function contextmenuUI(e, ll, topmenu) {
    if (localStorage.contextmenu) return true;
    topContextMenu(1);
    var t = '.context-menu.files-menu .context-menu-item';
    if (ll == 2) {
        if (RightsbyID(M.currentdirid) && RootbyId(M.currentdirid) !== M.RubbishID) {
            $(t).filter('.context-menu-item').hide();
            $(t).filter('.fileupload-item,.newfolder-item,.refresh-item').show();
            if ((is_chrome_firefox & 2) || 'webkitdirectory' in document.createElement('input')) $(t).filter('.folderupload-item').show();
        } else return false;
    } else if (ll) {
        $(t).hide();
        var c = $(e.currentTarget).attr('class');
        var id = $(e.currentTarget).attr('id');
        if (id) id = id.replace('treea_', '');
        if (id && !M.d[id]) id = undefined;
        if (id && id.length == 11) $(t).filter('.refresh-item,.remove-item').show();
        else if (c && c.indexOf('cloud-drive-item') > -1) {
            var flt = '.refresh-item,.properties-item';
            if (folderlink) flt += ',.zipdownload-item';
            $.selected = [
                M.RootID
            ];
            $(t).filter(flt).show();
        } else if (c && c.indexOf('recycle-item') > -1) $(t).filter('.refresh-item,.clearbin-item').show();
        else if (c && c.indexOf('contacts-item') > -1) $(t).filter('.refresh-item,.addcontact-item').show();
        else if (c && c.indexOf('messages-item') > -1) {
            e.preventDefault();
            return false;
        } else if (c && (c.indexOf('file-block') > -1 || c.indexOf('folder') > -1 || c.indexOf('fm-tree-folder') > -1) || id) {
            var items = menuItems();
            for (var item in items) $(t).filter('.' + item + '-item').show();
        } else return false;
    }
    var m = $('.context-menu.files-menu');
    m.removeClass('hidden');
    var r = $('body').outerWidth() - $(m).outerWidth();
    var b = $('body').outerHeight() - $(m).outerHeight();
    var mX = e.pageX;
    var mY = e.pageY;
    m.css({
        'top': mY,
        'left': mX
    })
    if (b - $(m).position().top < 50) m.css('top', b - 50);
    if (r - $(m).position().left < 1) m.css('left', mX - 10 - $(m).outerWidth());
    e.preventDefault();
}
var tt;

function treeUI() {
    tt = new Date().getTime();
    $('.fm-menu-item').unbind('click');
    $('.fm-menu-item').bind('click', function(event) {
        $('.fm-menu-item').removeClass('active');
        if ($(this).attr('class').indexOf('cloud') > -1) {
            treeUIopen(M.RootID, 1);
            $(this).addClass('active');
            M.openFolder(M.RootID);
            var jsp = $('.fm-tree-panel').data('jsp');
            if (jsp) jsp.scrollTo(0, 0);
        } else if ($(this).attr('class').indexOf('recycle') > -1) {
            $(this).addClass('active');
            M.openFolder(M.RubbishID);
            var pos = $('.fm-tree-header.recycle-item').position();
            var jsp = $('.fm-tree-panel').data('jsp');
            if (jsp) jsp.scrollTo(0, pos.top);
        } else if ($(this).attr('class').indexOf('contacts') > -1) {
            treeUIopen('contacts', 1);
            $(this).addClass('active');
            var pos = $('.fm-tree-header.contacts-item').position();
            var jsp = $('.fm-tree-panel').data('jsp');
            if (jsp) jsp.scrollTo(0, pos.top);
        } else if ($(this).attr('class').indexOf('messages') > -1) {
            $(this).addClass('active');
            M.openFolder(M.InboxID);
            var pos = $('.fm-tree-header.messages-item').position();
            var jsp = $('.fm-tree-panel').data('jsp');
            if (jsp) jsp.scrollTo(0, pos.top);
        }
        return false;
    });
    $('.fm-tree-panel .fm-tree-header').unbind('click contextmenu');
    $('.fm-tree-panel .fm-tree-header').bind('click contextmenu', function(e) {
        $.hideContextMenu(e);
        if (e.type == 'contextmenu') {
            $('.fm-tree-panel .fm-tree-header').removeClass('dragover');
            $('.fm-tree-panel .fm-tree-folder').removeClass('dragover');
            $(this).addClass('dragover');
            if (contextmenuUI(e, 1)) return true;
            else return false;
        }
        $('.fm-tree-panel .fm-connector').removeClass('last vertical-line mid');
        $('.fm-tree-panel .fm-horizontal-connector').removeClass('active');
        $('.fm-tree-panel .fm-tree-folder').removeClass('active');
        $('.fm-tree-panel .fm-connector-first').removeClass('active');
        var id;
        if ($(this).attr('class').indexOf('cloud-drive-item') > -1) id = M.RootID;
        else if ($(this).attr('class').indexOf('recycle-item') > -1) id = M.RubbishID;
        else if ($(this).attr('class').indexOf('contacts-item') > -1) {
            var c = $(e.target).attr('class');
            if (c && c.indexOf('contacts-arrows') > -1) return false;
            id = 'contacts';
        } else if ($(this).attr('class').indexOf('messages-item') > -1) id = M.InboxID;
        var isSubfolders = $(this).attr('class').indexOf('contains-subfolders');
        if (isSubfolders > -1 && $(this).attr('class').indexOf('opened') == -1) {
            var mainConnector = $(this).prev();
            $(this).next().addClass('opened');
            $(this).addClass('opened expanded');
            $(this).next().find('li').each(function() {
                if ($(this).attr('class') && $(this).attr('class').indexOf('selected') > -1) {
                    mainConnector.addClass('active');
                    return false;
                }
            });
        } else if ((id == M.currentdirid) || e.offsetX < 25 || e.layerX < 25) {
            $(this).next().removeClass('opened');
            $(this).removeClass('opened expanded');
            $(this).prev().removeClass('active');
        }
        $.selectingHeader($(this));
        if (id && id !== 'contacts') M.openFolder(id);
        return false;
    });
    $('.fm-tree-panel .fm-tree-folder').not('.contact').draggable({
        revert: true,
        containment: 'document',
        revertDuration: 200,
        distance: 10,
        cursorAt: {
            right: 100,
            bottom: 70
        },
        helper: function(e, ui) {
            return getDDhelper();
        },
        start: function(e, ui) {
            $.treeDragging = true;
            $.hideContextMenu(e);
            var html = '';
            var id = $(e.target).attr('id');
            if (id) id = id.replace('treea_', '');
            if (id && M.d[id]) html = '<div class="dragger-icon ' + fileicon(M.d[id]) + '"></div>'
            $('#draghelper .dragger-icon').remove();
            $(html).insertBefore('#draghelper .dragger-status');
        },
        drag: function(e, u) {
            //console.log('tree dragging',e);
        },
        stop: function(e, u) {
            $.treeDragging = false;
        }
    });
    $('.fm-tree-panel a.fm-tree-folder,.fm-tree-header.cloud-drive-item,.fm-tree-header.recycle-item,.fm-tree-header.messages-item,.fm-tree-header.contacts-item,.fm-menu-item.cloud,.fm-menu-item.recycle').droppable({
        tolerance: 'pointer',
        drop: function(e, ui) {
            $.doDD(e, ui, 'drop', 1);
        },
        over: function(e, ui) {
            $.doDD(e, ui, 'over', 1);
        },
        out: function(e, ui) {
            var c1 = $(e.srcElement).attr('class'),
                c2 = $(e.target).attr('class');
            if (c2 && c2.indexOf('fm-menu-item') > -1 && c1 && (c1.indexOf('cloud') > -1 || c1.indexOf('cloud') > -1)) return false;
            $.doDD(e, ui, 'out', 1);
        }
    });
    $('.fm-tree-panel .fm-tree-folder').unbind('click contextmenu');
    $('.fm-tree-panel .fm-tree-folder').bind('click contextmenu', function(e) {
        var id = $(this).attr('id').replace('treea_', '');
        if (e.type == 'contextmenu') {
            $('.fm-tree-header').removeClass('dragover');
            $('.fm-tree-folder').removeClass('dragover');
            $(this).addClass('dragover');
            $.selected = [
                id
            ];
            if (contextmenuUI(e, 1)) return true;
            else return false;
        }
        if (e.offsetX) e.layerX = false;
        var eoffsetX = e.offsetX;
        if (!eoffsetX) eoffsetX = e.pageX - $(this).offset().left;
        var c = $(e.target).parent().attr('class');
        if (!c || c.indexOf('fm-tree-folder') == -1) eoffsetX = 25;
        if (MegaChat && id && id.length == 11) id = 'chat/' + id;
        if ((eoffsetX < 23) || ($(this).attr('class').indexOf('active') > -1 && $(this).attr('class').indexOf('expanded') == -1) || id == M.currentdirid) {
            treeUIexpand(id);
        } else if ((eoffsetX > 23) || $(this).attr('class').indexOf('active') > -1) {
            M.openFolder(id);
        }
        return false;
    });
    $(window).unbind('resize.tree');
    $(window).bind('resize.tree', function() {
        initTreeScroll();
    });
    setTimeout(initTreeScroll, 10);
    treeheaderArrows();
    if (d) console.log('treeUI()', new Date().getTime() - tt);
}

function treeUIexpand(id, force) {
    if (id) id = id.replace('chat/', '');
    if (id == 'contacts') M.buildtree({
        h: 'contacts'
    });
    else M.buildtree(M.d[id]);
    var b = $('#treea_' + id);
    var d = b.attr('class');
    if (M.currentdirid !== id) {
        var path = M.getPath(M.currentdirid),
            pid = {},
            active_sub = false;
        for (var i in path) pid[path[i]] = i;
        if (pid[M.currentdirid] < pid[id]) active_sub = true;
    }
    if (d && d.indexOf('expanded') > -1 && !force) {
        fmtreenode(id, false);
        $('#treesub_' + id).removeClass('opened');
        b.removeClass('opened');
        b.removeClass('expanded');
        if (active_sub) {
            $('#treeli_' + id + ' .fm-connector').first().removeClass('mid');
            $('#treeli_' + id + ' .fm-connector').first().addClass('vertical-line last');
        }
    } else if (d && d.indexOf('contains-folders') > -1) {
        if (active_sub) {
            $('#treeli_' + id + ' .fm-connector').first().addClass('mid');
            $('#treeli_' + id + ' .fm-connector').first().removeClass('vertical-line last');
        }
        fmtreenode(id, true);
        $('#treesub_' + id).addClass('opened');
        b.addClass('opened')
        b.addClass('expanded');
    }
    if ($('.fm-connector-first.active').length > 0) {
        var connectorst = false;
        $('.fm-connector,.fm-connector-first.active').each(function(i, e) {
            var c = $(e).attr('class');
            if (c && c.indexOf('last') > -1) return false;
            else if (c && c.indexOf('fm-connector-first') > -1) connectorst = true;
            else if (connectorst && (!c || c.indexOf('mid') == -1)) $(e).addClass('vertical-line');
        });
    }
    treeUI();
}

function treeUIopen(id, event, ignoreScroll, dragOver, DragOpen) {
    if (!fminitialized) return false;
    if (!M.d[id] && id !== 'contacts') return false;
    if (id == 'contacts') {
        $('.fm-left-panel .fm-tree-header.contacts-item').addClass('active expanded opened');
        $('.fm-subfolders.contacts').addClass('opened');
    }
    if (!event) {
        var ids = M.getPath(id);
        ids = ids.reverse();
        var i = 1;
        while (i < ids.length) {
            if (M.d[ids[i]]) treeUIexpand(ids[i], 1);
            i++;
        }
    }
    if ($.hideContextMenu) $.hideContextMenu(event);
    $('.fm-tree-panel .fm-connector').removeClass('last vertical-line mid');
    $('.fm-tree-panel .fm-horizontal-connector').removeClass('active');
    $('.fm-tree-panel .fm-tree-folder').removeClass('opened');
    var b = $('#treea_' + id);
    var d = b.attr('class');
    $('.fm-tree-panel .fm-tree-folder').removeClass('active');
    $('.fm-tree-panel .fm-tree-folder').removeClass('lightactive');
    var a = M.getPath(id);
    if (b.length > 0) {
        $('.fm-left-panel .fm-connector').each(function(i, e) {
            if (i == 0) $(e).prev().prev().prev().closest('.fm-connector-first').addClass('active');
            $(e).addClass('vertical-line');
            var id2 = $(e).next().next().closest('.fm-tree-folder').attr('id');
            if (id2 && id2.replace('treea_', '') == id) return false;
        });
        $(a).each(function(i, e) {
            var f = $('#treea_' + e).prev().prev().closest('.fm-connector');
            if (i > 0) {
                fmtreenode(e, true);
                $('#treesub_' + e).addClass('opened');
                $('#treea_' + e).addClass('opened expanded');
                f.removeClass('vertical-line');
                f.addClass('mid');
            } else f.addClass('last');
            if (e == M.currentdirid) $('#treea_' + e).addClass('active');
            else $('#treea_' + e).addClass('lightactive');
            $('#treea_' + e).prev().closest('.fm-horizontal-connector').addClass('active');
        });
    }
    var scrollTo = false;
    var stickToTop = false;
    if (id == M.RootID || id == 'contacts' || id == M.InboxID || id == M.RubbishID || id == 'messages') {
        if (id == M.RootID) scrollTo = $('.fm-left-panel .cloud-drive-item');
        else if (id == M.InboxID) scrollTo = $('.fm-left-panel .messages-item');
        else if (id == 'contacts') {
            scrollTo = $('.fm-left-panel .contacts-item');
            stickToTop = true;
        } else if (id == M.RubbishID) {
            scrollTo = $('.fm-left-panel .recycle-item');
            stickToTop = true;
        } else if (id == 'messages') scrollTo = $('.fm-left-panel .messages-item');
        if (scrollTo) $.selectingHeader(scrollTo);
        if (scrollTo && dragOver) $(scrollTo).addClass('dragover');
        if (!dragOver && ($(scrollTo).length == 0 || $(scrollTo).visible())) scrollTo = false;
    } else {
        var currentHeader = b.closest('.fm-subfolders').prev();
        $('.fm-tree-panel .fm-connector-first').addClass('active');
        $.selectingHeader(currentHeader);
        if ($('#treea_' + id).length > 0 && !$('#treea_' + id).visible()) scrollTo = $('#treea_' + id);
    }
    if (scrollTo && !ignoreScroll) {
        var jsp = $('.fm-tree-panel').data('jsp');
        if (jsp) setTimeout(function() {
            jsp.scrollToElement(scrollTo, stickToTop);
        }, 50);
    }
    treeUI();
}

function renameDialog() {
    if ($.selected.length > 0) {
        $.dialog = 'rename';
        $('.rename-dialog').removeClass('hidden');
        $('.rename-dialog').addClass('active');
        $('.fm-dialog-overlay').removeClass('hidden');
        $('.rename-dialog .fm-dialog-close').unbind('click');
        $('.rename-dialog .fm-dialog-close').bind('click', function() {
            $.dialog = false;
            $('.rename-dialog').addClass('hidden');
            $('.fm-dialog-overlay').addClass('hidden');
        });
        $('.rename-dialog .fm-dialog-input-clear').unbind('click');
        $('.rename-dialog .fm-dialog-input-clear').bind('click', function() {
            var n = M.d[$.selected[0]];
            var ext = fileext(n.name);
            if (ext.length > 0) ext = '.' + ext;
            if (n.t) ext = '';
            $('.rename-dialog input').val(ext);
            $('.rename-dialog').removeClass('active');
            $('.rename-dialog input')[0].selectionStart = 0;
            $('.rename-dialog input')[0].selectionEnd = 0;
            $('.rename-dialog input').focus();
        });
        $('.fm-dialog-rename-button').unbind('click');
        $('.fm-dialog-rename-button').bind('click', function() {
            var c = $('.rename-dialog').attr('class');
            if (c && c.indexOf('active') > -1) dorename();
        });
        var n = M.d[$.selected[0]];
        if (n.t) $('.rename-dialog .fm-dialog-title').text(l[425]);
        else $('.rename-dialog .fm-dialog-title').text(l[426]);
        $('.rename-dialog input').val(n.name);
        var ext = fileext(n.name);
        if (!n.t && ext.length > 0) {
            $('.rename-dialog input')[0].selectionStart = 0;
            $('.rename-dialog input')[0].selectionEnd = $('.rename-dialog input').val().length - ext.length - 1;
        }
        $('.rename-dialog input').unbind('click keydown keyup keypress');
        $('.rename-dialog input').focus();
        $('.rename-dialog input').bind('click keydown keyup keypress', function(e) {
            var n = M.d[$.selected[0]];
            var ext = fileext(n.name);
            if ($(this).val() == '' || (!n.t && ext.length > 0 && $(this).val() == '.' + ext)) $('.rename-dialog').removeClass('active');
            else $('.rename-dialog').addClass('active');
            if (!n.t && ext.length > 0) {
                if (this.selectionStart > $('.rename-dialog input').val().length - ext.length - 2) {
                    this.selectionStart = $('.rename-dialog input').val().length - ext.length - 1;
                    this.selectionEnd = $('.rename-dialog input').val().length - ext.length - 1;
                    if (e.which == 46) return false;
                } else if (this.selectionEnd > $('.rename-dialog input').val().length - ext.length - 1) {
                    this.selectionEnd = $('.rename-dialog input').val().length - ext.length - 1;
                    return false;
                }
            }
        });
    }
}

function dorename() {
    if ($('.rename-dialog input').val() !== '') {
        var h = $.selected[0];
        var n = M.d[h];
        var nn = $('.rename-dialog input').val();
        if (nn !== n.name) M.rename(h, nn);
        $.dialog = false;
        $('.rename-dialog').addClass('hidden');
        $('.fm-dialog-overlay').addClass('hidden');
    }
}

function msgDialog(type, title, msg, submsg, callback) {
    $.msgDialog = type;
    $('#msgDialog').removeClass('clear-bin-dialog confirmation-dialog warning-dialog-b warning-dialog-a notification-dialog');
    $('#msgDialog .icon').removeClass('fm-bin-clear-icon .fm-notification-icon');
    $.warningCallback = callback;
    if (type == 'clear-bin') {
        $('#msgDialog').addClass('clear-bin-dialog');
        $('#msgDialog .icon').addClass('fm-bin-clear-icon');
        $('#msgDialog .fm-notifications-bottom').html('<div class="fm-dialog-button notification-button active cancel">' + l[82] + '</div><div class="fm-dialog-button notification-button active confirm">' + l[1018] + '</div><div class="clear"></div>');
        $('#msgDialog .fm-dialog-button').eq(0).bind('click', function() {
            closeMsg();
            if ($.warningCallback) $.warningCallback(false);
        });
        $('#msgDialog .fm-dialog-button').eq(1).bind('click', function() {
            closeMsg();
            if ($.warningCallback) $.warningCallback(true);
        });
    } else if (type == 'warninga' || type == 'warningb' || type == 'info') {
        $('#msgDialog .fm-notifications-bottom').html('<div class="fm-dialog-button notification-button active">' + l[81] + '</div><div class="clear"></div>');
        $('#msgDialog .fm-dialog-button').bind('click', function() {
            closeMsg();
            if ($.warningCallback) $.warningCallback(true);
        });
        $('#msgDialog .icon').addClass('fm-notification-icon');
        if (type == 'warninga') $('#msgDialog').addClass('warning-dialog-a');
        else if (type == 'warningb') $('#msgDialog').addClass('warning-dialog-b');
        else if (type == 'info') $('#msgDialog').addClass('notification-dialog');
    } else if (type == 'confirmation') {
        $('#msgDialog .fm-notifications-bottom').html('<div class="fm-dialog-button notification-button active cancel">' + l[79] + '</div><div class="fm-dialog-button notification-button active confirm">' + l[78] + '</div><div class="clear"></div>');
        $('#msgDialog .fm-dialog-button').eq(0).bind('click', function() {
            closeMsg();
            if ($.warningCallback) $.warningCallback(false);
        });
        $('#msgDialog .fm-dialog-button').eq(1).bind('click', function() {
            closeMsg();
            if ($.warningCallback) $.warningCallback(true);
        });
        $('#msgDialog .icon').addClass('fm-notification-icon');
        $('#msgDialog').addClass('confirmation-dialog');
    }
    $('#msgDialog .fm-dialog-title').text(title);
    $('#msgDialog .fm-notification-info p').html(msg);
    if (submsg) {
        $('#msgDialog .fm-notification-warning').text(submsg);
        $('#msgDialog .fm-notification-warning').show();
    } else $('#msgDialog .fm-notification-warning').hide();
    $('#msgDialog .fm-dialog-close').unbind('click');
    $('#msgDialog .fm-dialog-close').bind('click', function() {
        closeMsg();
        if ($.warningCallback) $.warningCallback(false);
    });
    $('#msgDialog').removeClass('hidden');
    $('.fm-dialog-overlay').removeClass('hidden');
}

function closeMsg() {
    $('#msgDialog').addClass('hidden');
    $('.fm-dialog-overlay').addClass('hidden');
    delete $.msgDialog;
}

function shareDialog(close) {
    if (close) {
        $('.share-dialog').addClass('hidden');
        $('.fm-dialog-overlay').addClass('hidden');
        $.dialog = false;
        return true;
    }
    M.renderShare($.selected[0]);
    $('.fm-share-add-contacts').removeClass('active');
    $('.fm-share-contacts-popup').addClass('hidden');
    $.dialog = 'sharing';
    $('.fm-share-add-contacts').unbind('click');
    $('.fm-share-add-contacts').bind('click', function() {
        if ($(this).attr('class').indexOf('active') == -1) {
            var jsp = $('.fm-share-contacts-body').data('jsp');
            if (jsp) jsp.destroy();
            var u = [];
            var html = '';
            for (var i in M.c['contacts'])
                if (M.u[i]) u.push(M.u[i]);
            u.sort(function(a, b) {
                if (a.name && b.name) return a.name.localeCompare(b.name);
                else return -1;
            });
            for (var i in u) {
                var avatar = staticpath + 'images/mega/default-top-avatar.png';
                if (avatars[u[i].h]) avatar = avatars[u[i].h].url;
                html += '<a class="add-contact-item" id="' + htmlentities(u[i].h) + '"><span class="add-contact-pad"><span class="avatar ' + u[i].h + '"><span><img src="' + avatar + '" alt=""></span></span><span class="add-contact-username">' + htmlentities(u[i].m) + '</span></span></a>';
            }
            $('.fm-share-contacts-body').html(html);
            $('.fm-share-contacts-popup').removeClass('hidden');
            $('.fm-share-contacts-popup input').val(l[1019]);
            $('.fm-share-contacts-popup input').unbind('click');
            $('.fm-share-contacts-popup input').bind('click', function() {
                if ($(this).val() == l[1019]) $(this).val('');
            });
            $('.fm-share-contacts-popup input').unbind('keyup');
            $('.fm-share-contacts-popup input').bind('keyup', function() {
                if (!checkMail($(this).val())) $('.add-contact-button').addClass('active');
            });
            $('.fm-share-contacts-body .add-contact-item').unbind('click');
            $('.fm-share-contacts-body .add-contact-item').bind('click', function() {
                if ($(this).attr('class').indexOf('ui-selected') > -1) $(this).removeClass('ui-selected');
                else $(this).addClass('ui-selected');
                var sl = $('.fm-share-contacts-body .ui-selected');
                if (sl.length > 0) $('.add-contact-button').addClass('active');
                else $('.add-contact-button').removeClass('active');
            });
            $(this).addClass('active');
            $('.fm-share-contacts-body').jScrollPane({
                enableKeyboardNavigation: false,
                showArrows: true,
                arrowSize: 5,
                animateScroll: true
            });
            jScrollFade('.fm-share-contacts-body');
        } else {
            $('.fm-share-add-contacts').removeClass('active');
            $('.fm-share-contacts-popup').addClass('hidden');
        }
    });
    $('.cancel-contact-button').unbind('click');
    $('.cancel-contact-button').bind('click', function() {
        $('.fm-share-contacts-popup').addClass('hidden');
        $('.fm-share-add-contacts').removeClass('active');
    });
    $('.add-contact-button, .fm-share-contacts-search').unbind('click');
    $('.add-contact-button, .fm-share-contacts-search').bind('click', function() {
        var e = $('.fm-share-contacts-popup input').val();
        if (e !== '' && e !== l[1019] && checkMail(e)) {
            msgDialog('warninga', l[135], l[141], '', function() {
                $('.fm-dialog-overlay').removeClass('hidden');
            });
        } else {
            var sl = $('.fm-share-contacts-body .ui-selected');
            if (e == '' && sl.length == 0) {
                msgDialog('warninga', l[135], l[1020], '', function() {
                    $('.fm-dialog-overlay').removeClass('hidden');
                    $('.fm-share-contacts-head input').focus();
                });
            } else {
                var t = [];
                var s = M.d[$.selected[0]].shares;
                if (e !== '' && e !== l[1019]) {
                    var user = getuid(e);
                    if (user) e = user;
                    if (!(s && s[e])) t.push({
                        u: e,
                        r: 0
                    });
                }
                $('.fm-share-contacts-body .ui-selected').each(function(i, el) {
                    var id = $(el).attr('id');
                    if (id && !(s && s[id])) t.push({
                        u: id,
                        r: 0
                    });
                });
                $('.fm-share-contacts-popup').addClass('hidden');
                $('.fm-share-add-contacts').removeClass('active');
                if (t.length > 0) {
                    loadingDialog.show();
                    $('.fm-dialog.share-dialog').addClass('hidden');
                    doshare($.selected[0], t);
                }
            }
        }
    });
    $('.share-folder-block').addClass('hidden');
    var n = M.d[$.selected[0]];
    if (n && n.shares && u_sharekeys[n.h]) {
        for (var i in n.shares) {
            if (i == 'EXP') {
                $('#share_on_off').html('<div class="on_off public-checkbox"><input type="checkbox" id="public-checkbox" /></div>');
                $('.public-checkbox input').attr('checked', true);
                $('.share-folder-block :checkbox').iphoneStyle({
                    checkedLabel: l[1021],
                    uncheckedLabel: l[1022],
                    resizeContainer: false,
                    resizeHandle: false,
                    onChange: function(elem, data) {
                        if (d) console.log('remove shared folder...');
                    }
                });
                $('.share-folder-icon div').addClass(fileicon(n));
                $('.share-folder-block').removeClass('hidden');
                $('.share-folder-info .propreties-dark-txt').text(n.name);
                if (!n.ph) {
                    api_req({
                        a: 'l',
                        n: $.selected[0]
                    }, {
                        n: n,
                        callback: function(res, ctx) {
                            M.nodeAttr({
                                h: ctx.n.h,
                                ph: res
                            });
                            $('.share-folder-block .properties-file-link').html('https://mega.co.nz/#F!' + htmlentities(res) + '!' + htmlentities(a32_to_base64(u_sharekeys[ctx.n.h])));
                        }
                    });
                } else $('.share-folder-block .properties-file-link').html('https://mega.co.nz/#F!' + htmlentities(n.ph) + '!' + htmlentities(a32_to_base64(u_sharekeys[n.h])));
            }
        }
    }
    $('.share-dialog .fm-dialog-close, .share-dialog .cancel-button, .share-dialog .save-button').unbind('click');
    $('.share-dialog .fm-dialog-close, .share-dialog .cancel-button, .share-dialog .save-button').bind('click', function() {
        var sops = [];
        if ($('.share-folder-block').attr('class').indexOf('hidden') == -1 && !$('.public-checkbox input').attr('checked')) {
            M.delnodeShare($.selected[0], 'EXP');
            api_req({
                a: 'l',
                n: $.selected[0]
            }, {
                callback: function(res) {
                    if (typeof res != 'number') api_req({
                        a: 'l',
                        p: res
                    });
                }
            });
            sops.push({
                u: 'EXP',
                r: ''
            });
        }
        if ($.delShare) {
            for (var i in $.delShare) {
                sops.push({
                    u: $.delShare[i],
                    r: ''
                });
                M.delnodeShare($.selected[0], $.delShare[i]);
            }
            delete $.delShare;
        }
        if (sops.length > 0) api_req({
            a: 's',
            n: $.selected[0],
            s: sops,
            ha: '',
            i: requesti
        });
        shareDialog(1);
    });
    $('.fm-share-dropdown').unbind('click');
    $('.fm-share-dropdown').bind('click', function() {
        $('.fm-share-permissions-block').addClass('hidden');
        $(this).next().removeClass('hidden');
        var dropdownPosition = $(this).next().offset().top + 140;
        var scrBlockPosition = $(this).closest('.fm-share-body').offset().top + 318;
        if (scrBlockPosition - dropdownPosition < 10) {
            $(this).next().addClass('bottom');
        }
    });
    $('.fm-share-permissions').unbind('click');
    $('.fm-share-permissions').bind('click', function() {
        $(this).parent().parent().find('.fm-share-permissions').removeClass('active');
        $(this).addClass('active');
        var r = $(this).attr('id');
        if (r) r = r.replace('rights_', '');
        var t = '';
        if (r == 0) t = l[55];
        else if (r == 1) t = l[56];
        else if (r == 2) t = l[57];
        else if (r == 3) t = l[83];
        $(this).parent().parent().find('.fm-share-dropdown').text(t);
        var id = $(this).parent().parent().parent().attr('id');
        if (r == 3) {
            if (!$.delShare) $.delShare = [];
            $.delShare.push(id);
            if (d) console.log('delShare', $.delShare);
        } else doshare($.selected[0], [{
            u: id,
            r: r
        }]);
        $('.fm-share-permissions-block').addClass('hidden');
    });
    $('.share-dialog').removeClass('hidden');
    $('.fm-dialog-overlay').removeClass('hidden');
    $('.fm-share-body').jScrollPane({
        enableKeyboardNavigation: false,
        showArrows: true,
        arrowSize: 5,
        animateScroll: true
    });
    jScrollFade('.fm-share-body');
}

function mcDialog(close) {
    if (close) {
        $.dialog = false;
        $('.move-dialog').addClass('hidden');
        $('.fm-dialog-overlay').addClass('hidden');
        $('.move-dialog #mainsub').html('');
        return true;
    }
    $.mcselected = M.RootID;
    var jsp = $('.fm-move-dialog-body').data('jsp');
    if (jsp) jsp.scrollTo(0, 0, false);
    if ($.selected.length > 0) {
        $.dialog = 'mc';
        $('.move-dialog #topheader').removeClass('contacts-item cloud-drive-item active');
        $('.move-dialog #bottomheader').removeClass('recycle-item recyle-notification contacts-item cloud-drive-item active');
        $('.move-dialog .fm-dialog-title').text(l[63] + ' (' + l[118] + ')');
        $('.move-dialog .move-button').text(l[63]);
        if ($.mctype == 'move') {
            $('.move-dialog .fm-dialog-title').text(l[62] + ' (' + l[118] + ')');
            $('.move-dialog .move-button').text(l[62]);
            $('.move-dialog #topheader').addClass('cloud-drive-item active');
            $('.move-dialog #topheader span').text(l[164]);
            $('.move-dialog #bottomheader').addClass('recycle-item');
            $('.move-dialog #bottomheader span').text(l[167]);
        } else if ($.mctype == 'copy-cloud') {
            $('.move-dialog #topheader').addClass('cloud-drive-item active');
            $('.move-dialog #topheader span').text(l[164]);
            $('.move-dialog #bottomheader').addClass('contacts-item');
            $('.move-dialog #bottomheader span').text(l[165]);
        } else if ($.mctype == 'copy-contacts') {
            $('.move-dialog #topheader').addClass('contacts-item active');
            $('.move-dialog #topheader span').text(l[165]);
            $('.move-dialog #bottomheader').addClass('cloud-drive-item');
            $('.move-dialog #bottomheader span').text(l[164]);
        }
        var html;
        if ($.mctype == 'move' || $.mctype == 'copy-cloud') html = $('.fm-tree-pad .fm-subfolders').first().html();
        else html = $('#treesub_contacts').html();
        html = html.replace(/treea_/g, 'mctreea_').replace(/treesub_/g, 'mctreesub_');
        $('.move-dialog .fm-move-dialog-body .fm-subfolders').first().html(html);
        $('.move-dialog #mainsub').html(html);
        $('.move-dialog #mainsub ul').removeClass('opened');
        $('.move-dialog #mainsub a').removeClass('expanded active lightactive');
        $('.move-dialog .messages-icon').hide();
        $.mctreeUI = function() {
            $('.move-dialog #mainsub a').unbind('click');
            $('.move-dialog #mainsub a').bind('click', function(e, ui) {
                $.mcselected = $(this).attr('id').replace('mctreea_', '');
                M.buildtree(M.d[$.mcselected]);
                var html = $('#treesub_' + $.mcselected).html();
                if (html) $('#mctreesub_' + $.mcselected).html(html.replace(/treea_/g, 'mctreea_').replace(/treesub_/g, 'mctreesub_'));
                $.mctreeUI();
                var c = $(this).attr('class');
                if (c.indexOf('contains-folders') > -1) {
                    c2 = $(this).next().attr('class');
                    if ((c.indexOf('active') > -1 || e.offsetX < 25 || e.layerX < 25) && ((c2 && c2.indexOf('opened') > -1))) {
                        $(this).next().removeClass('opened');
                        $(this).removeClass('expanded');
                    } else if ((c.indexOf('active') > -1 || e.offsetX < 25 || e.layerY < 25) && ((c2 && c2.indexOf('opened') == -1) || !c2)) {
                        $(this).next().addClass('opened');
                        $(this).addClass('expanded');
                    }
                }
                $('.move-dialog .fm-move-dialog-body .fm-subfolders a').removeClass('active');
                $(this).addClass('active');
                $('.fm-move-dialog-body').jScrollPane({
                    showArrows: true,
                    arrowSize: 5,
                    animateScroll: true
                });
                jScrollFade('.fm-move-dialog-body');
                $('.move-dialog .move-button').addClass('active');
                $('.move-dialog .fm-tree-header').removeClass('active');
                $('.move-dialog #topheader').addClass('active');
            });
            $('.move-dialog .fm-tree-header').unbind('click');
            $('.move-dialog .fm-tree-header').bind('click', function(e, ui) {
                var c = $(this).attr('class');
                var doScroll = false;
                if (c && c.indexOf('contacts') > -1 && $.mctype == 'copy-cloud') {
                    $.mctype = 'copy-contacts';
                    mcDialog();
                    doScroll = true;
                } else if (c && c.indexOf('cloud-drive') > -1 && $.mctype == 'copy-contacts') {
                    $.mctype = 'copy-cloud';
                    mcDialog();
                    doScroll = true;
                }
                if (doScroll) {
                    var jsp = $('.fm-move-dialog-body').data('jsp');
                    if (jsp) jsp.scrollTo(0, 0);
                    return false;
                }
                if (c && c.indexOf('cloud-drive') > -1) $.mcselected = M.RootID;
                else if (c && c.indexOf('recycle-item') > -1) $.mcselected = M.RubbishID;
                $('.move-dialog .fm-move-dialog-body .fm-subfolders a').removeClass('active');
                $('.move-dialog .fm-tree-header').removeClass('active');
                $(this).addClass('active');
                if (!c || (c && c.indexOf('contacts') == -1)) $('.move-dialog .move-button').addClass('active');
            });
            $('.fm-move-dialog-body .fm-connector').removeClass('vertical-line last mid');
            $('.fm-move-dialog-body .fm-horizontal-connector').removeClass('active');
        };
        $.mctreeUI();
        $('.move-dialog .move-button').addClass('active');
        $('.move-dialog').removeClass('hidden');
        $('.fm-dialog-overlay').removeClass('hidden');
        $('.fm-move-dialog-body').jScrollPane({
            showArrows: true,
            arrowSize: 5,
            animateScroll: true
        });
        jScrollFade('.fm-move-dialog-body');
        $('.move-dialog .fm-dialog-close').unbind('click');
        $('.move-dialog .fm-dialog-close').bind('click', function() {
            mcDialog(1);
        });
        $('.move-dialog .cancel-button').unbind('click');
        $('.move-dialog .cancel-button').bind('click', function() {
            mcDialog(1);
        });
        $('.move-dialog .move-button').unbind('click');
        $('.move-dialog .move-button').bind('click', function() {
            var t = $.mcselected;
            if ($.mctype == 'move') {
                var n = [];
                for (var i in $.selected)
                    if (!isCircular($.selected[i], t)) n.push($.selected[i]);
                M.moveNodes(n, t);
                topContextMenu(1);
            } else if ($.mctype.substr(0, 4) == 'copy') {
                if ($.mctype == 'copy-contacts' && t.length == 8) {
                    if (RightsbyID(t) == 0) {
                        alert(l[1023]);
                        return false;
                    }
                }
                var n = [];
                for (var i in $.selected)
                    if (!isCircular($.selected[i], t)) n.push($.selected[i]);
                M.copyNodes(n, t);
            }
            mcDialog(1);
        });
    }
}

function getclipboardlinks() {
    var l = '';
    for (var i in M.links) {
        var n = M.d[M.links[i]];
        var key,
            s;
        if (n.t) {
            key = u_sharekeys[n.h];
            s = '';
        } else {
            key = n.key;
            s = htmlentities(bytesToSize(n.s));
        }
        if (n && n.ph) {
            var F = '';
            if (n.t) F = 'F';
            if (i > 0) l += '\n';
            l += 'https://mega.co.nz/#' + F + '!' + htmlentities(n.ph);
            if ($('#export-checkbox').is(':checked')) l += '!' + a32_to_base64(key);
        }
    }
    return l;
}

function getclipboardkeys() {
    var l = '';
    for (var i in M.links) {
        var n = M.d[M.links[i]];
        var key;
        if (n.t) key = u_sharekeys[n.h];
        else key = n.key;
        l += a32_to_base64(key) + '\n';
    }
    return l;
}

function linksDialog(close) {
    var jsp = $('.export-link-body').data('jsp');
    if (jsp) jsp.destroy();
    if (close) {
        $.dialog = false;
        $('.fm-dialog-overlay').addClass('hidden');
        $('.fm-dialog.export-links-dialog').addClass('hidden');
        $('.export-links-warning').addClass('hidden');
        return true;
    }
    $.dialog = 'links';
    var html = '';
    for (var i in M.links) {
        var n = M.d[M.links[i]];
        var key,
            s,
            F;
        if (n.t) {
            F = 'F';
            key = u_sharekeys[n.h];
            s = '';
        } else {
            F = '';
            key = n.key;
            s = htmlentities(bytesToSize(n.s));
        }
        if (n && n.ph) {
            html += '<div class="export-link-item"><div class="export-icon ' + fileicon(n) + '" ></div><div class="export-link-text-pad"><div class="export-link-txt">' + htmlentities(n.name) + ' <span class="export-link-gray-txt"> ' + s + '</span></div><div class="export-link-txt">https://mega.co.nz/#' + F + '!' + htmlentities(n.ph) + '<span class="export-link-gray-txt file-key">!' + a32_to_base64(key) + '</span></div></div></div>';
        }
    }
    $('.export-links-warning-close').unbind('click');
    $('.export-links-warning-close').bind('click', function() {
        $('.export-links-warning').addClass('hidden');
    });
    $('#export-checkbox').unbind('click');
    $('#export-checkbox').bind('click', function() {
        if ($(this).attr('class').indexOf('checkboxOn') == -1) {
            $(this).closest('.fm-dialog').addClass('file-keys-view');
            $(this).attr('class', 'checkboxOn');
            $(this).parent().attr('class', 'checkboxOn');
            $(this).attr('checked', true);
        } else {
            $(this).closest('.fm-dialog').removeClass('file-keys-view');
            $(this).attr('class', 'checkboxOff');
            $(this).parent().attr('class', 'checkboxOff');
            $(this).attr('checked', false);
        }
    });
    $('.export-links-dialog .fm-dialog-close').unbind('click');
    $('.export-links-dialog .fm-dialog-close').bind('click', function() {
        linksDialog(1);
    });
    if (is_extension) {
        if (!is_chrome_firefox) {
            $('.fm-dialog-chrome-clipboard').removeClass('hidden');
            $('#chromeclipboard').fadeTo(1, 0.01);
        }
        // chrome & firefox extension:

        $('#clipboardbtn1').unbind('click');
        $('#clipboardbtn1').bind('click', function() {
            if (is_chrome_firefox) mozSetClipboard(getclipboardlinks());
            else {
                $('#chromeclipboard')[0].value = getclipboardlinks();
                $('#chromeclipboard').select();
                document.execCommand('copy');
            }
        });
        $('#clipboardbtn2').unbind('click');
        $('#clipboardbtn2').bind('click', function() {
            if (is_chrome_firefox) mozSetClipboard(getclipboardkeys());
            else {
                $('#chromeclipboard')[0].value = getclipboardkeys();
                $('#chromeclipboard').select();
                document.execCommand('copy');
            }
        });
        $('#clipboardbtn1').text(l[370]);
        $('#clipboardbtn2').text(l[1033]);
    } else {
        $('#clipboardbtn1').html(htmlentities(l[370]) + '<object data="OneClipboard.swf" id="clipboardswf1" type="application/x-shockwave-flash"  width="100%" height="26" allowscriptaccess="always"><param name="wmode" value="transparent"><param value="always" name="allowscriptaccess"><param value="all" name="allowNetworkin"><param name=FlashVars value="buttonclick=1" /></object>');
        $('#clipboardbtn2').html(htmlentities(l[1033]) + '<object data="OneClipboard.swf" id="clipboardswf2" type="application/x-shockwave-flash"  width="100%" height="26" allowscriptaccess="always"><param name="wmode" value="transparent"><param value="always" name="allowscriptaccess"><param value="all" name="allowNetworkin"><param name=FlashVars value="buttonclick=1" /></object>');
        $('#clipboardbtn1').unbind('mouseover');
        $('#clipboardbtn1').bind('mouseover', function() {
            var e = $('#clipboardswf1')[0];
            if (e && e.setclipboardtext) e.setclipboardtext(getclipboardlinks());
        });
        $('#clipboardbtn2').unbind('mouseover');
        $('#clipboardbtn2').bind('mouseover', function() {
            var e = $('#clipboardswf2')[0];
            if (e && e.setclipboardtext) e.setclipboardtext(getclipboardkeys());
        });
    }
    $('#export-checkbox').attr('checked', true);
    $('#export-checkbox').addClass('checkboxOn').removeClass('checkboxOff');
    $('#export-checkbox').parent().addClass('checkboxOn').removeClass('checkboxOff');
    $('.export-links-dialog').addClass('file-keys-view');
    $('.export-links-dialog .export-link-body').html(html);
    $('.fm-dialog-overlay').removeClass('hidden');
    $('.export-links-warning').removeClass('hidden');
    $('.fm-dialog.export-links-dialog').removeClass('hidden');
    $('.export-link-body').jScrollPane({
        showArrows: true,
        arrowSize: 5
    });
    jScrollFade('.export-link-body');
    $('.fm-dialog.export-links-dialog').css('margin-top', $('.fm-dialog.export-links-dialog').height() / 2 * -1);
}

function createfolderDialog(close) {
    $.dialog = 'createfolder';
    if (close) {
        $.dialog = false;
        if ($.cftarget) delete $.cftarget;
        $('.fm-dialog-overlay').addClass('hidden');
        $('.fm-dialog.create-folder-dialog').addClass('hidden');
        return true;
    }
    $('.create-folder-dialog input').unbind('keyup');
    $('.create-folder-dialog input').bind('keyup', function() {
        if ($('.create-folder-dialog input').val() == '' || $('.create-folder-dialog input').val() == l[157]) $('.create-folder-dialog').removeClass('active');
        else $('.create-folder-dialog').addClass('active');
    });
    $('.create-folder-dialog input').unbind('keypress');
    $('.create-folder-dialog input').bind('keypress', function(e) {
        if (e.which == 13 && $(this).val() !== '') {
            if (!$.cftarget) $.cftarget = M.currentdirid;
            createfolder($.cftarget, $(this).val());
            createfolderDialog(1);
        }
    });
    $('.create-folder-dialog .fm-dialog-close').unbind('click');
    $('.create-folder-dialog .fm-dialog-close').bind('click', function() {
        createfolderDialog(1);
    });
    $('.fm-dialog-input-clear').unbind('click');
    $('.fm-dialog-input-clear').bind('click', function() {
        $('.create-folder-dialog input').val('');
        $('.create-folder-dialog').removeClass('active');
    });
    $('.fm-dialog-new-folder-button').unbind('click');
    $('.fm-dialog-new-folder-button').bind('click', function() {
        var v = $('.create-folder-dialog input').val();
        if (v == '' || v == l[157]) alert(l[1024]);
        else {
            if (!$.cftarget) $.cftarget = M.currentdirid;
            createfolder($.cftarget, v);
            createfolderDialog(1);
        }
    });
    $('.fm-dialog-overlay').removeClass('hidden');
    $('.fm-dialog.create-folder-dialog').removeClass('hidden');
    $('.create-folder-dialog').removeClass('active');
    $('.create-folder-dialog input').val('');
    $('.create-folder-dialog input').focus();
}

function addContactDialog(close) {
    $.dialog = 'addcontact';
    if (close) {
        $.dialog = false;
        if ($.cftarget) delete $.cftarget;
        $('.fm-dialog-overlay').addClass('hidden');
        $('.fm-dialog.add-contact-dialog').addClass('hidden');
        return true;
    }
    $('.add-contact-dialog input').unbind('keyup');
    $('.add-contact-dialog input').bind('keyup', function() {
        if ($('.add-contact-dialog input').val() == '' || $('.add-contact-dialog input').val() == l[157]) $('.add-contact-dialog').removeClass('active');
        else $('.add-contact-dialog').addClass('active');
    });
    $('.add-contact-dialog input').unbind('keypress');
    $('.add-contact-dialog input').bind('keypress', function(e) {
        if (e.which == 13 && $(this).val() !== '') {
            if (u_type === 0) ephemeralDialog(l[997]);
            else doAddContact(e, 1);
        }
    });
    $('.fm-dialog-add-contact-button').unbind('click');
    $('.fm-dialog-add-contact-button').bind('click', function(e) {
        if ($('.add-contact-dialog input').val() !== '') {
            if (u_type === 0) ephemeralDialog(l[997]);
            else doAddContact(e, 1);
        }
    });
    $('.add-contact-dialog .fm-dialog-close').unbind('click');
    $('.add-contact-dialog .fm-dialog-close').bind('click', function() {
        addContactDialog(1);
    });
    $('.fm-dialog-input-clear').unbind('click');
    $('.fm-dialog-input-clear').bind('click', function() {
        $('.add-contact-dialog input').val('');
        $('.add-contact-dialog').removeClass('active');
        $('.add-contact-dialog input').focus();
    });
    $('.fm-dialog-add-folder-button').unbind('click');
    $('.fm-dialog-add-folder-button').bind('click', function(e) {
        var v = $('.add-contact-dialog input').val();
        if (v == '' || v == l[157]) alert(l[1024]);
        else {
            if (u_type === 0) ephemeralDialog(l[997]);
            else doAddContact(e, 1);
        }
    });
    $('.fm-dialog-overlay').removeClass('hidden');
    $('.fm-dialog.add-contact-dialog').removeClass('hidden');
    $('.add-contact-dialog').removeClass('active');
    $('.add-contact-dialog input').val('');
    $('.add-contact-dialog input').focus();
}

function chromeDialog(close) {
    if (close) {
        $.dialog = false;
        $('.fm-dialog-overlay').addClass('hidden');
        $('.fm-dialog.chrome-dialog').addClass('hidden');
        return true;
    }
    $('.fm-dialog-overlay').removeClass('hidden');
    $('.fm-dialog.chrome-dialog').removeClass('hidden');
    $.dialog = 'chrome';
    $('.chrome-dialog .browsers-button,.chrome-dialog .fm-dialog-close').unbind('click')
    $('.chrome-dialog .browsers-button,.chrome-dialog .fm-dialog-close').bind('click', function() {
        chromeDialog(1);
    });
    $('#chrome-checkbox').unbind('click');
    $('#chrome-checkbox').bind('click', function() {
        if ($(this).attr('class').indexOf('checkboxOn') == -1) {
            localStorage.chromeDialog = 1;
            $(this).attr('class', 'checkboxOn');
            $(this).parent().attr('class', 'checkboxOn');
            $(this).attr('checked', true);
        } else {
            delete localStorage.chromeDialog;
            $(this).attr('class', 'checkboxOff');
            $(this).parent().attr('class', 'checkboxOff');
            $(this).attr('checked', false);
        }
    });
}

function firefoxDialog(close) {
    if (close) {
        $.dialog = false;
        $('.fm-dialog-overlay').addClass('hidden');
        $('.fm-dialog.firefox-dialog').addClass('hidden');
        return true;
    }
    if (page == 'download') $('.ff-extension-txt').text(l[1932]);
    else $('.ff-extension-txt').text(l[1174]);
    $('.fm-dialog-overlay').removeClass('hidden');
    $('.fm-dialog.firefox-dialog').removeClass('hidden');
    $.dialog = 'firefox';
    $('.firefox-dialog .browsers-button,.firefox-dialog .fm-dialog-close,.firefox-dialog .close-button').unbind('click')
    $('.firefox-dialog .browsers-button,.firefox-dialog .fm-dialog-close,.firefox-dialog .close-button').bind('click', function() {
        firefoxDialog(1);
    });
    $('#firefox-checkbox').unbind('click');
    $('#firefox-checkbox').bind('click', function() {
        if ($(this).attr('class').indexOf('checkboxOn') == -1) {
            localStorage.firefoxDialog = 1;
            $(this).attr('class', 'checkboxOn');
            $(this).parent().attr('class', 'checkboxOn');
            $(this).attr('checked', true);
        } else {
            delete localStorage.firefoxDialog;
            $(this).attr('class', 'checkboxOff');
            $(this).parent().attr('class', 'checkboxOff');
            $(this).attr('checked', false);
        }
    });
}

function browserDialog(close) {
    if (close) {
        $.dialog = false;
        $('.fm-dialog-overlay').addClass('hidden');
        $('.fm-dialog.browsers-dialog').addClass('hidden');
        return true;
    }
    $.browserDialog = 1;
    $.dialog = 'browser';
    $('.fm-dialog-overlay').removeClass('hidden');
    $('.fm-dialog.browsers-dialog').removeClass('hidden');
    $('.browsers-dialog .browsers-button,.browsers-dialog .fm-dialog-close').unbind('click')
    $('.browsers-dialog .browsers-button,.browsers-dialog .fm-dialog-close').bind('click', function() {
        browserDialog(1);
    });
    $('#browsers-checkbox').unbind('click');
    $('#browsers-checkbox').bind('click', function() {
        if ($(this).attr('class').indexOf('checkboxOn') == -1) {
            localStorage.browserDialog = 1;
            $(this).attr('class', 'checkboxOn');
            $(this).parent().attr('class', 'checkboxOn');
            $(this).attr('checked', true);
        } else {
            delete localStorage.chromeDialog;
            $(this).attr('class', 'checkboxOff');
            $(this).parent().attr('class', 'checkboxOff');
            $(this).attr('checked', false);
        }
    });
    $('.browsers-top-icon').removeClass('ie9 ie10 safari');
    var bc,
        bh,
        bt;
    if ('-ms-scroll-limit' in document.documentElement.style && '-ms-ime-align' in document.documentElement.style) {
        if (page !== 'download' && ('' + page).split('/').shift() !== 'fm') {
            browserDialog(1);
            return false;
        }
        // IE11

        bc = 'ie10';
        bh = l[884].replace('[X]', 'IE 11');
        // if (page == 'download') bt = l[1933];
        // else bt = l[886];
        bt = l[1933];
    } else if (navigator.userAgent.indexOf('MSIE 10') > -1) {
        bc = 'ie10';
        bh = l[884].replace('[X]', 'Internet Explorer 10');
        if (page == 'download') bt = l[1933];
        else bt = l[886];
    } else if ((navigator.userAgent.indexOf('Safari') > -1) && (navigator.userAgent.indexOf('Chrome') == -1)) {
        bc = 'safari';
        bh = l[884].replace('[X]', 'Safari');
        if (page == 'download') bt = l[1933];
        else bt = l[887].replace('[X]', 'Safari');
    } else {
        bc = 'safari';
        bh = l[884].replace('[X]', l[885]);
        bt = l[887].replace('[X]', 'Your browser');
    }
    $('.browsers-top-icon').addClass(bc);
    $('.browsers-info-block p').text(bt);
    $('.browsers-info-header').text(bh);
    $('.browsers-info-header').text(bh);
    $('.browsers-info-header p').text(bt);
}

function propertiesDialog(close) {
    if (close) {
        $.dialog = false;
        $('.fm-dialog-overlay').addClass('hidden');
        $('.fm-dialog.properties-dialog').addClass('hidden');
        return true;
    }
    $.dialog = 'properties';
    $('.fm-dialog-overlay').removeClass('hidden');
    $('.fm-dialog.properties-dialog').removeClass('hidden');
    $('.fm-dialog.properties-dialog .fm-dialog-close,.fm-dialog.properties-dialog .close-button').unbind('click');
    $('.fm-dialog.properties-dialog .fm-dialog-close,.fm-dialog.properties-dialog .close-button').bind('click', function() {
        propertiesDialog(1);
    });
    $('.fm-dialog.properties-dialog .properties-shared-block').hide();
    $('.fm-dialog.properties-dialog .properties-link-block').hide();
    $('.fm-dialog.properties-dialog #keyoption').hide();
    var filecnt = 0,
        foldercnt = 0,
        size = 0,
        sfilecnt = 0,
        sfoldercnt = 0;
    for (var i in $.selected) {
        var n = M.d[$.selected[i]];
        if (n.t) {
            var nodes = fm_getnodes(n.h);
            for (var i in nodes) {
                if (M.d[nodes[i]] && !M.d[nodes[i]].t) {
                    size += M.d[nodes[i]].s;
                    sfilecnt++;
                } else sfoldercnt++;
            }
            foldercnt++;
        } else {
            filecnt++
            size += n.s;
        }
    }
    var p = {};
    if ((filecnt + foldercnt) == 1) {
        p.t6 = '';
        p.t7 = '';
        $('.fm-dialog.properties-dialog').removeClass('multiple');
        if (filecnt) {
            p.t3 = l[87] + ':';
            p.t5 = ' second';
            if (n.mtime) {
                p.t6 = l[94] + ':';
                p.t7 = htmlentities(time2date(n.mtime));
            }
        } else {
            p.t3 = l[894] + ':';
            p.t5 = '';
        }
        p.t1 = l[86] + ':';
        p.t2 = htmlentities(n.name);
        p.t4 = bytesToSize(size);
        if (foldercnt) {
            p.t6 = l[897] + ':';
            p.t7 = fm_contains(sfilecnt, sfoldercnt);
        }
        p.t8 = l[896] + ':';
        p.t9 = htmlentities(time2date(n.ts));
    } else {
        $('.fm-dialog.properties-dialog').addClass('multiple');
        p.t1 = '';
        p.t2 = '<b>' + fm_contains(filecnt + sfilecnt, foldercnt + sfoldercnt) + '</b>';
        p.t3 = l[894] + ':';
        p.t4 = bytesToSize(size);
        p.t5 = ' second';
        p.t8 = l[93] + ':';
        p.t9 = l[1025];
    }
    var html = '<div class="properties-small-gray">' + p.t1 + '</div><div class="propreties-dark-txt">' + p.t2 + '</div><div class="properties-float-bl"><span class="properties-small-gray">' + p.t3 + '</span><span class="propreties-dark-txt">' + p.t4 + '</span></div><div class="properties-float-bl' + p.t5 + '"><span class="properties-small-gray">' + p.t6 + '</span><span class="propreties-dark-txt">' + p.t7 + '</span></div><div class="properties-small-gray">' + p.t8 + '</div><div class="propreties-dark-txt">' + p.t9 + '</div>';
    $('.properties-txt-pad').html(html);
    if ((filecnt + foldercnt) == 1) $('.properties-file-icon').html('<div class="' + fileicon(n) + '"></div>');
    else {
        var a = 0,
            done = {};
        $('.properties-file-icon').html('');
        for (var i in $.selected) {
            var ico = fileicon(M.d[$.selected[i]]);
            if (a < 3 && !done[ico]) {
                done[ico] = 1;
                $('.properties-file-icon').prepend('<div class="' + ico + '"></div>');
                a++;
            }
        }
    }
    $('.on_off :checkbox').iphoneStyle({
        checkedLabel: l[1021],
        uncheckedLabel: l[1022],
        resizeContainer: false,
        resizeHandle: false,
        onChange: function(elem, data) {
            if (data) $(elem).closest('.on_off').addClass('active');
            else $(elem).closest('.on_off').removeClass('active');
        }
    });
    $('input[name=properties-checkbox]').unbind('click');
    $('input[name=properties-checkbox]').bind('click', function() {
        if ($(this).attr('class').indexOf('checkboxOn') == -1) {
            $('.properties-file-lnk-pad').addClass('show-key');
            $(this).attr('class', 'checkboxOn');
            $(this).parent().attr('class', 'checkboxOn');
            $(this).attr('checked', true);
        } else {
            $('.properties-file-lnk-pad').removeClass('show-key');
            $(this).attr('class', 'checkboxOff');
            $(this).parent().attr('class', 'checkboxOff');
            $(this).attr('checked', false);
        }
    });
}

function paypalDialog(url, close) {
    if (close) {
        $('.fm-dialog.paypal-dialog').addClass('hidden');
        $('.fm-dialog-overlay').addClass('hidden');
        $.dialog = false;
        return false;
    }
    $.dialog = 'paypal';
    $('.fm-dialog.paypal-dialog').removeClass('hidden');
    $('.fm-dialog-overlay').removeClass('hidden');
    $('.fm-dialog.paypal-dialog a').attr('href', url);
    $('.paypal-dialog .fm-dialog-close').unbind('click');
    $('.paypal-dialog .fm-dialog-close').bind('click', function(e) {
        paypalDialog(false, 1);
    });
}

function termsDialog(close, pp) {
    if (close) {
        $('.fm-dialog.terms-dialog').addClass('hidden');
        $('.fm-dialog-overlay').addClass('hidden');
        if ($.termsAgree) $.termsAgree = undefined;
        if ($.termsDeny) $.termsDeny = undefined;
        $.dialog = false;
        return false;
    }
    if (!pp) pp = 'terms';
    $.dialog = pp;
    if (!pages[pp]) {
        loadingDialog.show();
        silent_loading = function() {
            loadingDialog.hide();
            termsDialog(false, $.dialog);
        };
        jsl.push(jsl2[pp]);
        jsl_start();
        return false;
    }
    $('.fm-dialog.terms-dialog').removeClass('hidden');
    $('.fm-dialog-overlay').removeClass('hidden');
    $('.fm-dialog.terms-dialog .terms-main').html(pages[pp].split('((TOP))')[1].split('((BOTTOM))')[0].replace('main-mid-pad new-bottom-pages', ''));
    $('.terms-body').jScrollPane({
        showArrows: true,
        arrowSize: 5,
        animateScroll: true,
        verticalDragMinHeight: 50
    });
    jScrollFade('.terms-body');
    $('.fm-terms-cancel').unbind('click');
    $('.fm-terms-cancel').bind('click', function(e) {
        if ($.termsDeny) $.termsDeny();
        termsDialog(1);
    });
    $('.fm-terms-agree').unbind('click');
    $('.fm-terms-agree').bind('click', function(e) {
        if ($.termsAgree) $.termsAgree();
        termsDialog(1);
    });
    $('.terms-dialog .fm-dialog-close').unbind('click');
    $('.terms-dialog .fm-dialog-close').bind('click', function(e) {
        if ($.termsDeny) $.termsDeny();
        termsDialog(1);
    });
}

function slingshotDialog(close) {
    if (close) {
        $('.fm-dialog.slingshot-dialog').addClass('hidden');
        $('.fm-dialog-overlay').addClass('hidden');
        $.dialog = false;
        return false;
    }
    $('.slingshot-dialog .fm-dialog-button.fm-terms-agree,.slingshot-dialog .fm-dialog-close').unbind('click');
    $('.slingshot-dialog .fm-dialog-button.fm-terms-agree,.slingshot-dialog .fm-dialog-close').bind('click', function(e) {
        slingshotDialog(1);
    });
    $('.fm-dialog.slingshot-dialog').removeClass('hidden');
    $('.fm-dialog-overlay').removeClass('hidden');
    $.dialog = 'slingshot';
}
var previews = {};
var preqs = {};
var pfails = {};
var slideshowid;

function slideshowsteps() {
    var check = false,
        forward = [],
        backward = [];
    for (var i in M.v) {
        if (is_image(M.v[i])) {
            if (M.v[i].h == slideshowid) check = true;
            else if (check) forward.push(M.v[i].h);
            else backward.push(M.v[i].h);
        }
    }
    return {
        backward: backward,
        forward: forward
    };
}

function slideshow_next() {
    var valid = true;
    $.each(dl_queue || [], function(id, file) {
        if (file.id == slideshowid) {
            valid = false;
            return false; /* break loop */
        }
    });
    if (!valid) return;
    var steps = slideshowsteps();
    if (steps.forward.length > 0) slideshow(steps.forward[0]);
}

function slideshow_prev() {
    var valid = true;
    $.each(dl_queue || [], function(id, file) {
        if (file.id == slideshowid) {
            valid = false;
            return false; /* break loop */
        }
    });
    if (!valid) return;
    var steps = slideshowsteps();
    if (steps.backward.length > 0) slideshow(steps.backward[steps.backward.length - 1]);
}

function slideshow(id, close) {
    if (d) console.log('slideshow', id, close, slideshowid);
    if (close) {
        slideshowid = false;
        $('.slideshow-dialog').addClass('hidden');
        $('.slideshow-overlay').addClass('hidden');
        for (var i in dl_queue) {
            if (dl_queue[i] && dl_queue[i].id == id) {
                if (dl_queue[i].preview) {
                    DownloadManager.abort(dl_queue[i]);
                }
                break;
            }
        }
        return false;
    }
    if (folderlink) {
        $('.slideshow-getlink').hide();
        $('.slideshow-line').hide();
    } else {
        $('.slideshow-getlink').show();
        $('.slideshow-line').show();
    }
    $('.slideshow-dialog .close-slideshow,.slideshow-overlay,.slideshow-error-close').unbind('click');
    $('.slideshow-dialog .close-slideshow,.slideshow-overlay,.slideshow-error-close').bind('click', function(e) {
        slideshow(id, 1);
    });
    var n = M.d[id];
    if (!n) return;
    $('.slideshow-filename').text(n.name);
    $('.slideshow-image').attr('src', '');
    $('.slideshow-pending').removeClass('hidden');
    $('.slideshow-progress').addClass('hidden');
    $('.slideshow-error').addClass('hidden');
    $('.slideshow-image').width(0);
    $('.slideshow-image').height(0);
    $('.slideshow-image-bl').addClass('hidden');
    $('.slideshow-prev-button,.slideshow-next-button').removeClass('active');
    slideshowid = id;
    var steps = slideshowsteps();
    if (steps.backward.length > 0) $('.slideshow-prev-button').addClass('active');
    if (steps.forward.length > 0) $('.slideshow-next-button').addClass('active');
    $('.slideshow-prev-button,.slideshow-next-button').unbind('click');
    $('.slideshow-prev-button,.slideshow-next-button').bind('click', function(e) {
        var c = $(this).attr('class');
        if (c && c.indexOf('active') > -1) {
            var steps = slideshowsteps();
            if (c.indexOf('prev') > -1 && steps.backward.length > 0) slideshow_prev();
            else if (c.indexOf('next') > -1 && steps.forward.length > 0) slideshow_next();
        }
    });
    $('.slideshow-download').unbind('click');
    $('.slideshow-download').bind('click', function(e) {
        for (var i in dl_queue) {
            if (dl_queue[i] && dl_queue[i].id == slideshowid) {
                dl_queue[i].preview = false;
                openTransferpanel();
                return;
            }
        }
        M.addDownload([slideshowid]);
    });
    $('.slideshow-getlink').unbind('click');
    $('.slideshow-getlink').bind('click', function(e) {
        if (u_type === 0) ephemeralDialog(l[1005]);
        else M.getlinks([slideshowid]);
    });
    if (previews[id]) {
        previewsrc(previews[id].src);
        fetchnext();
    } else if (!preqs[id]) fetchsrc(id);
    $('.slideshow-overlay').removeClass('hidden');
    $('.slideshow-dialog').removeClass('hidden');
}

function fetchnext() {
    var n = M.d[slideshowsteps().forward[0]];
    if (!n || !n.fa) return;
    if (n.fa.indexOf(':1*') > -1 && !preqs[n.h] && !previews[n.h]) fetchsrc(n.h);
}

function fetchsrc(id) {
    function eot(id, err) {
        delete preqs[id];
        delete pfails[id];
        M.addDownload([id], false, err ? -1 : true);
    }
    eot.timeout = 12000;
    if (pfails[id]) {
        // for slideshow_next/prev
        if (slideshowid == id) return eot(id, 1);
        delete pfails[id];
    }
    var n = M.d[id];
    preqs[id] = 1;
    var treq = {};
    treq[id] = {
        fa: n.fa,
        k: n.key
    };
    api_getfileattr(treq, 1, function(ctx, id, uint8arr) {
        previewimg(id, uint8arr);
        if (!n.fa || n.fa.indexOf(':0*') < 0) {
            if (d) console.log('Thumbnail found missing on preview, creating...', id, n);
            var aes = new sjcl.cipher.aes([n.key[0],
                n.key[1],
                n.key[2],
                n.key[3]
            ]);
            createthumbnail(false, aes, id, uint8arr);
        }
        if (id == slideshowid) fetchnext();
    }, eot);
}

function previewsrc(src) {
    var img = new Image();
    img.onload = function() {
        if (this.height > $(window).height() - 100) {
            var factor = this.height / ($(window).height() - 100);
            this.height = $(window).height() - 100;
            this.width = Math.round(this.width / factor);
        }
        var w = this.width,
            h = this.height;
        if (w < 700) w = 700;
        if (h < 500) h = 500;
        $('.slideshow-image').attr('src', this.src);
        $('.slideshow-dialog').css('margin-top', h / 2 * -1);
        $('.slideshow-dialog').css('margin-left', w / 2 * -1);
        $('.slideshow-image').width(this.width);
        $('.slideshow-image').height(this.height);
        $('.slideshow-dialog').width(w);
        $('.slideshow-dialog').height(h);
        $('.slideshow-image-bl').removeClass('hidden');
        $('.slideshow-pending').addClass('hidden');
        $('.slideshow-progress').addClass('hidden');
    };
    img.src = src;
}

function previewimg(id, uint8arr) {
    try {
        var blob = new Blob([uint8arr], {
            type: 'image/jpeg'
        });
    } catch (err) {}
    if (!blob || blob.size < 25) blob = new Blob([uint8arr.buffer]);
    previews[id] = {
        blob: blob,
        src: myURL.createObjectURL(blob),
        time: new Date().getTime()
    };
    if (id == slideshowid) {
        previewsrc(previews[id].src);
    }
    if (Object.keys(previews).length == 1) {
        $(window).unload(function() {
            for (var id in previews) {
                myURL.revokeObjectURL(previews[id].src);
            }
        });
    }
}
var thumbnails = [];
var thumbnailblobs = [];
var th_requested = [];
var fa_duplicates = {};

function fm_thumbnails() {
    var treq = {},
        a = 0;
    if (myURL) {
        for (var i in M.v) {
            var n = M.v[i];
            if (n.fa) {
                if (typeof fa_duplicates[n.fa] == 'undefined') fa_duplicates[n.fa] = 0;
                else fa_duplicates[n.fa] = 1;
                if (!thumbnails[n.h] && !th_requested[n.h]) {
                    treq[n.h] = {
                        fa: n.fa,
                        k: n.key
                    };
                    th_requested.push(n.h);
                } else fm_thumbnail_render(n);
            }
            a++;
        }
        if (a > 0) {
            api_getfileattr(treq, 0, function(ctx, node, uint8arr) {
                try {
                    var blob = new Blob([uint8arr], {
                        type: 'image/jpeg'
                    });
                } catch (err) {}
                if (blob.size < 25) blob = new Blob([uint8arr.buffer]);
                thumbnailblobs[node] = blob;
                thumbnails[node] = myURL.createObjectURL(blob);
                fm_thumbnail_render(M.d[node]);
                // deduplicate in view when there is a duplicate fa:
                if (M.d[node] && fa_duplicates[M.d[node].fa] > 0) {
                    for (var i in M.v) {
                        if (M.v[i].h !== node && M.v[i].fa == M.d[node].fa && !thumbnails[M.v[i].h]) {
                            thumbnails[M.v[i].h] = thumbnails[node];
                            fm_thumbnail_render(M.v[i]);
                        }
                    }
                }
            });
        }
    }
}

function fm_thumbnail_render(n) {
    if (!n || !thumbnails[n.h]) return;
    if ($('.file-block#' + n.h).length > 0) {
        $('.file-block#' + n.h + ' img').attr('src', thumbnails[n.h]);
        $('.file-block#' + n.h + ' img').parent().addClass('thumb');
    }
}

function fm_contains(filecnt, foldercnt) {
    var containstxt = l[782];
    if ((foldercnt > 1) && (filecnt > 1)) containstxt = l[828].replace('[X1]', foldercnt).replace('[X2]', filecnt);
    else if ((foldercnt > 1) && (filecnt == 1)) containstxt = l[829].replace('[X]', foldercnt);
    else if ((foldercnt == 1) && (filecnt > 1)) containstxt = l[830].replace('[X]', filecnt);
    else if ((foldercnt == 1) && (filecnt == 1)) containstxt = l[831];
    else if (foldercnt > 1) containstxt = l[832].replace('[X]', foldercnt);
    else if (filecnt > 1) containstxt = l[833].replace('[X]', filecnt);
    else if (foldercnt == 1) containstxt = l[834];
    else if (filecnt == 1) containstxt = l[835];
    return containstxt;
}

function clipboardcopycomplete() {
    if (d) console.log('clipboard copied');
}

function saveprogress(id, bytesloaded, bytestotal) {
    if (d) console.log('saveprogress', id, bytesloaded, bytestotal);
}

function savecomplete(id) {
    $('.fm-dialog.download-dialog').addClass('hidden');
    $('.fm-dialog-overlay').addClass('hidden');
    if (!$.dialog)
        $('#dlswf_' + id).remove();
    var dl = IdToFile(id);
    M.dlcomplete(dl);
    DownloadManager.cleanupUI(dl, true);
}
/**
 * Because of the left and transfer panes resizing options, we are now implementing the UI layout logic here, instead of
 * the original code from the styles.css.
 * The main reason is that, the CSS is not able to correctly calculate values based on other element's properties (e.g.
 * width, height, position, etc).
 * This is why we do a on('resize') handler which handles the resize of the generic layout of Mega's FM.
 */

function fm_resize_handler() {
    // transfer panel resize logic
    var right_pane_height = ($('#fmholder').outerHeight() - ($('#topmenu').outerHeight() + $('.transfer-panel').outerHeight()));
    $('.fm-main.default').css({
        'height': right_pane_height + 'px'
    });
    $('.transfer-scrolling-table').css({
        'height': ($('.transfer-panel').outerHeight() - ($('.transfer-panel-title').outerHeight() + $('.transfer-table-header').outerHeight())) + 'px'
    });
    // left panel resize logic
    var right_panel_margin = $('.fm-left-panel').outerWidth();
    var resize_handle_width = $('.left-pane-drag-handle').outerWidth();
    $('.fm-main.default > div:not(.fm-left-panel)').each(function() {
        $(this).css({
            'margin-left': right_panel_margin
        });
    });
    $('.fm-main.notifications > .new-notification-top').each(function() {
        $(this).css({
            'margin-left': right_panel_margin
        });
    });
    $('.fm-main.notifications > .new-notifications-scroll').each(function() {
        $(this).css({
            'margin-left': (304 - right_panel_margin) * -1
        });
    });
    $([
        '.files-grid-view .grid-scrolling-table',
        '.file-block-scrolling',
        '.contacts-grid-view .contacts-grid-scrolling-table'
    ].join(', ')).css({
        'width': ($(document.body).outerWidth() - ($('.fm-left-panel').outerWidth()))
    });
    if (M.currentdirid == 'contacts') {
        if (M.viewmode) initContactsBlocksScrolling();
        else initContactsGridScrolling();
    }
    if (M.chat) initChatScrolling();
    var right_blocks_height = right_pane_height - $('.fm-right-header').outerHeight() - 10 /* padding */ ;
    $('.fm-right-files-block > *:not(.fm-right-header)').css({
        'height': right_blocks_height + 'px',
        'min-height': right_blocks_height + 'px'
    });
    // account page tweak, required since the transfer panel resize logic was introduced
    var $account_save_block = $('.fm-account-save-block');
    if ($('.transfer-panel').size() > 0) {
        $account_save_block.css({
            'top': $('.transfer-panel').position().top - $account_save_block.outerHeight(),
            'bottom': ''
        });
    }
}
/**
 * Implements the behavior of "File Manager - Resizable Panes":
 * - Initializes a jQuery UI .resizable
 * - Sets w/h/direction
 * - Persistance (only saving is implemented here, you should implement by yourself an initial set of the w/h from the
 *  localStorage
 * - Proxies the jQ UI's resizable events - `resize` and `resizestop`
 * - Can be initialized only once per element (instance is stored in $element.data('fmresizable'))
 *
 * @param element
 * @param opts
 * @returns {*}
 * @constructor
 */

function FMResizablePane(element, opts) {
    var $element = $(element);
    var self = this;
    var $self = $(this);
    self.element = element;
    /**
     * Default options
     *
     * @type {{direction: string, persistanceKey: string, minHeight: undefined, minWidth: undefined, handle: string}}
     */
    var defaults = {
        'direction': 'n',
        'persistanceKey': 'transferPanelHeight',
        'minHeight': undefined,
        'minWidth': undefined,
        'handle': '.transfer-drag-handle'
    };
    var size_attr = 'height';
    opts = $.extend(true, {}, defaults, opts);
    self.options = opts; //expose as public
    /**
     * Depending on the selected direction, pick which css attr should we be changing - width OR height
     */
    if (opts.direction == 'n' || opts.direction == 's') {
        size_attr = 'height';
    } else if (opts.direction == 'e' || opts.direction == 'w') {
        size_attr = 'width';
    }
    /**
     * Destroy if already initialized.
     */

    if ($element.data('fmresizable')) {
        $element.data('fmresizable').destroy();
    }
    self.destroy = function() {
        // some optimizations can be done here in the future.
    };
    /**
     * Basic init/constructor code
     */
    {
        var $handle = $(opts.handle, $element);
        $handle.addClass('ui-resizable-handle ui-resizable-' + opts.direction);
        var resizable_opts = {
            'handles': {},
            minHeight: opts.minHeight,
            minWidth: opts.minWidth,
            maxHeight: opts.maxHeight,
            maxWidth: opts.maxWidth,
            start: function(e, ui) {},
            resize: function(e, ui) {
                var css_attrs = {
                    'top': 0
                };
                css_attrs[size_attr] = ui.size[size_attr];
                $element.css(css_attrs);
                localStorage[opts.persistanceKey] = ui.size[size_attr];
                $self.trigger('resize', [
                    e,
                    ui
                ]);
            },
            'stop': function(e, ui) {
                $self.trigger('resizestop', [
                    e,
                    ui
                ]);
                $(window).trigger('resize');
            }
        };
        resizable_opts['handles'][opts.direction] = $handle;
        $element.resizable(resizable_opts);
        $element.data('fmresizable', this)
    }
    return this;
}
var ext = {};
var extensions = {
    'threed': [
        ['3ds',
            '3dm',
            'max',
            'obj'
        ],
        '3D'
    ],
    'aftereffects': [
        ['aep',
            'aet'
        ],
        'Adobe Aftereffects'
    ],
    'audio': [
        ['mp3',
            'wav',
            '3ga',
            'aif',
            'aiff',
            'flac',
            'iff',
            'm4a',
            'wma'
        ],
        'Audio'
    ],
    'cad': [
        ['dxf',
            'dwg'
        ],
        'CAD'
    ],
    'compressed': [
        ['zip',
            'rar',
            'tgz',
            'gz',
            'bz2',
            'tbz',
            'tar',
            '7z',
            'sitx'
        ],
        'Compressed'
    ],
    'database': [
        ['sql',
            'accdb',
            'db',
            'dbf',
            'mdb',
            'pdb'
        ],
        'Database'
    ],
    'dreamweaver': [
        ['dwt'],
        'Database'
    ],
    'excel': [
        ['xls',
            'xlsx',
            'xlt',
            'xltm'
        ],
        'Excel'
    ],
    'executable': [
        ['exe',
            'com',
            'bin',
            'apk',
            'app',
            'msi',
            'cmd',
            'gadget'
        ],
        'Executable'
    ],
    'fla-lang': [
        ['as',
            'ascs',
            'asc'
        ],
        'ActionScript'
    ],
    'flash': [
        ['fla'],
        'Flash'
    ],
    'font': [
        ['fnt',
            'otf',
            'ttf',
            'fon'
        ],
        'Font'
    ],
    'generic': [
        ['*'],
        'File'
    ],
    'gis': [
        ['gpx',
            'kml',
            'kmz'
        ],
        'GPS File'
    ],
    'graphic': [
        ['gif',
            'tiff',
            'tif',
            'bmp',
            'png',
            'tga'
        ],
        'Image'
    ],
    'html': [
        ['html',
            'htm',
            'dhtml',
            'xhtml'
        ],
        'HTML'
    ],
    'illustrator': [
        ['ai',
            'ait'
        ],
        'Adobe Illustrator'
    ],
    'image': [
        ['jpg',
            'jpeg'
        ],
        'Image'
    ],
    'indesign': [
        ['indd'],
        'Adobe InDesign'
    ],
    'java': [
        ['jar',
            'java',
            'class'
        ],
        'Java'
    ],
    'midi': [
        ['mid',
            'midi'
        ],
        'Midi'
    ],
    'pdf': [
        ['pdf'],
        'PDF'
    ],
    'photoshop': [
        ['abr',
            'psb',
            'psd'
        ],
        'Adobe Photoshop'
    ],
    'playlist': [
        ['pls',
            'm3u',
            'asx'
        ],
        'Playlist'
    ],
    'podcast': [
        ['pcast'],
        'Podcast'
    ],
    'powerpoint': [
        ['pps',
            'ppt',
            'pptx'
        ],
        'Powerpoint'
    ],
    'premiere': [
        ['prproj',
            'ppj'
        ],
        'Adobe Premiere'
    ],
    'raw': [
        ['3fr',
            'arw',
            'bay',
            'cr2',
            'dcr',
            'dng',
            'fff',
            'mef',
            'mrw',
            'nef',
            'pef',
            'rw2',
            'srf',
            'orf',
            'rwl'
        ],
        'RAW'
    ],
    'real-audio': [
        ['rm',
            'ra',
            'ram'
        ],
        'Real Audio'
    ],
    'sourcecode': [
        ['sh',
            'c',
            'cc',
            'cpp',
            'cxx',
            'h',
            'hpp',
            'dll',
            'iso'
        ],
        'Source code'
    ],
    'spreadsheet': [
        ['ods',
            'ots',
            'gsheet',
            'nb',
            'xlr',
            'numbers'
        ],
        'Spreadsheet'
    ],
    'swf': [
        ['swf'],
        'SWF'
    ],
    'torrent': [
        ['torrent'],
        'Torrent'
    ],
    'text': [
        ['txt',
            'rtf',
            'ans',
            'ascii',
            'log',
            'odt',
            'wpd'
        ],
        'Text',
        'pages'
    ],
    'vcard': [
        ['vcf'],
        'Vcard'
    ],
    'vector': [
        ['svgz',
            'svg',
            'cdr',
            'eps'
        ],
        'Vector'
    ],
    'video': [
        ['mkv',
            'webm',
            'avi',
            'mp4',
            'm4v',
            'mpg',
            'mpeg',
            'mov',
            '3g2',
            '3gp',
            'asf',
            'wmv'
        ],
        'Video'
    ],
    'flash-video': [
        ['flv'],
        'Flash Video'
    ],
    'video-subtitle': [
        ['srt'],
        'Subtitle'
    ],
    'web-data': [
        ['html',
            'xml',
            'shtml',
            'dhtml',
            'js',
            'css'
        ],
        'Web Client Code'
    ],
    'web-lang': [
        ['php',
            'php3',
            'php4',
            'php5',
            'phtml',
            'inc',
            'asp',
            'pl',
            'cgi',
            'py'
        ],
        'Web Server Code'
    ],
    'word.png': [
        ['doc',
            'docx',
            'dotx',
            'wps'
        ],
        'MS Word'
    ]
};
var extdesc = {
    '3ds': '3D Scene',
    '3dm': '3D Model',
    '3fr': 'RAW Image',
    '3g2': 'Multimedia',
    '3gp': '3D Model',
    '7z': '7-Zip Compressed',
    'accdb': 'Database',
    'aep': 'After Effects',
    'aet': 'After Effects',
    'ai': 'Illustrator',
    'aif': 'Audio Interchange',
    'aiff': 'Audio Interchange',
    'ait': 'Illustrator',
    'ans': 'ANSI Text File',
    'apk': 'Android App',
    'app': 'Mac OSX App',
    'arw': 'RAW Image',
    'as': 'ActionScript',
    'asc': 'ActionScript Com',
    'ascii': 'ASCII Text',
    'asf': 'Streaming Video',
    'asp': 'Active Server',
    'aspx': 'Active Server',
    'asx': 'Advanced Stream',
    'avi': 'A/V Interleave',
    'bat': 'DOS Batch',
    'bay': 'Casio RAW Image',
    'bmp': 'Bitmap Image',
    'bz2': 'UNIX Compressed',
    'c': 'C/C++ Source Code',
    'cc': 'C++ Source Code',
    'cdr': 'CorelDRAW Image',
    'cgi': 'CGI Script',
    'class': 'Java Class',
    'com': 'DOS Command',
    'cpp': 'C++ Source Code',
    'cr2': 'Raw Image',
    'css': 'CSS Style Sheet',
    'cxx': 'C++ Source Code',
    'dcr': 'RAW Image',
    'db': 'Database',
    'dbf': 'Database',
    'dhtml': 'Dynamic HTML',
    'dll': 'Dynamic Link Library',
    'dng': 'Digital Negative',
    'doc': 'MS Word',
    'docx': 'MS Word',
    'dotx': 'MS Word Template',
    'dwg': 'Drawing DB File',
    'dwt': 'Dreamweaver',
    'dxf': 'DXF Image',
    'eps': 'EPS Image',
    'exe': 'Executable',
    'fff': 'RAW Image',
    'fla': 'Adobe Flash',
    'flac': 'Lossless Audio',
    'flv': 'Flash Video',
    'fnt': 'Windows Font',
    'fon': 'Font',
    'gadget': 'Windows Gadget',
    'gif': 'GIF Image',
    'gpx': 'GPS Exchange',
    'gsheet': 'Spreadsheet',
    'gz': 'Gnu Compressed',
    'h': 'Header',
    'hpp': 'Header',
    'hpp': 'Header',
    'htm': 'HTML Document',
    'html': 'HTML Document',
    'iff': 'Interchange',
    'inc': 'Include',
    'indd': 'Adobe InDesign',
    'iso': 'ISO Image',
    'jar': 'Java Archive',
    'java': 'Java Code',
    'jpeg': 'JPEG Image',
    'jpg': 'JPEG Image',
    'js': 'JavaScript',
    'kml': 'Keyhole Markup',
    'kml': 'Google Earth',
    'log': 'Log',
    'm3u': 'Media Playlist',
    'm4a': 'MPEG-4 Audio',
    'max': '3ds Max Scene',
    'mdb': 'MS Access',
    'mef': 'RAW Image',
    'mid': 'MIDI Audio',
    'midi': 'MIDI Audio',
    'mkv': 'MKV Video',
    'mov': 'QuickTime Movie',
    'mp3': 'MP3 Audio',
    'mpeg': 'MPEG Movie',
    'mpg': 'MPEG Movie',
    'mrw': 'Raw Image',
    'msi': 'MS Installer',
    'nb': 'Mathematica',
    'numbers': 'Numbers',
    'nef': 'RAW Image',
    'obj': 'Wavefront',
    'ods': 'Spreadsheet',
    'odt': 'Text Document',
    'otf': 'OpenType Font',
    'ots': 'Spreadsheet',
    'orf': 'RAW Image',
    'pages': 'Pages Doc',
    'pcast': 'Podcast',
    'pdb': 'Database',
    'pdf': 'PDF Document',
    'pef': 'RAW Image',
    'php': 'PHP Code',
    'php3': 'PHP Code',
    'php4': 'PHP Code',
    'php5': 'PHP Code',
    'phtml': 'PHTML Web',
    'pl': 'Perl Script',
    'pls': 'Audio Playlist',
    'png': 'PNG Image',
    'ppj': 'Adobe Premiere',
    'pps': 'MS PowerPoint',
    'ppt': 'MS PowerPoint',
    'pptx': 'MS PowerPoint',
    'prproj': 'Adobe Premiere',
    'ps': 'PostScript',
    'psb': 'Photoshop',
    'psd': 'Photoshop',
    'py': 'Python Script',
    'ra': 'Real Audio',
    'ram': 'Real Audio',
    'rar': 'RAR Compressed',
    'rm': 'Real Media',
    'rtf': 'Rich Text',
    'rw2': 'RAW',
    'rwl': 'RAW Image',
    'sh': 'Bash Shell',
    'shtml': 'Server HTML',
    'sitx': 'X Compressed',
    'sql': 'SQL Database',
    'srf': 'Sony RAW Image',
    'srt': 'Subtitle',
    'svg': 'Vector Image',
    'svgz': 'Vector Image',
    'swf': 'Flash Movie',
    'tar': 'Archive',
    'tbz': 'Compressed',
    'tga': 'Targa Graphic',
    'tgz': 'Compressed',
    'tif': 'TIF Image',
    'tiff': 'TIFF Image',
    'torrent': 'Torrent',
    'ttf': 'TrueType Font',
    'txt': 'Text Document',
    'vcf': 'vCard',
    'wav': 'Wave Audio',
    'webm': 'WebM Video',
    'wma': 'WM Audio',
    'wmv': 'WM Video',
    'wpd': 'WordPerfect',
    'wps': 'MS Works',
    'xhtml': 'XHTML Web',
    'xlr': 'MS Works',
    'xls': 'MS Excel',
    'xlsx': 'MS Excel',
    'xlt': 'MS Excel',
    'xltm': 'MS Excel',
    'xml': 'XML Document',
    'zip': 'ZIP Archive',
    'mp4': 'MP4 Video'
}
for (var i in extensions) {
    for (var a in extensions[i][0]) {
        var desc = extensions[i][1];
        if (extdesc[extensions[i][0][a]]) desc = extdesc[extensions[i][0][a]];
        ext[extensions[i][0][a]] = [
            i,
            desc
        ];
    }
}

function filetype(n) {
    if (ext[fileext(n)]) return ext[fileext(n)][1];
    else return 'File';
}

function fileicon(n) {
    var ico;
    var name = n.name;
    if (n.t && n.shares) ico = 'folder-shared';
    else if (n.t) ico = 'folder';
    else if (ext[fileext(n.name)]) ico = ext[fileext(n.name)][0];
    else ico = 'generic';
    var iconurl = ico;
    return iconurl;
}

function fileext(name) {
    if (!name) name = 'unknown';
    var ext = name.substr(name.lastIndexOf('.') + 1);
    if (ext == name) ext = '';
    return ext.toLowerCase();
    return name;
}
var mXHRTimeoutMS = localStorage.xhrtimeout || 2 * 60 * 1000;
(function(w) {
    var _xhr_queue = [],
        total = 0

    function newXhr() {
        var xhr = getxhr();
        xhr.__id = ++total
        xhr.__timeout = null;
        xhr.__timeout_ms = mXHRTimeoutMS;
        xhr.clear_timeout = function() {
            if (this.__timeout) {
                clearTimeout(this.__timeout);
                delete this.__timeout;
            }
        };
        xhr.setup_timeout = function() {
            this.clear_timeout();
            this.__timeout = setTimeout(this.mOnTimeout, this.__timeout_ms);
        };
        xhr._abort = xhr.abort;
        xhr._send = xhr.send
        xhr.send = function() {
            this.setup_timeout();
            if (arguments.length == 0) {
                // download
                xhr.started = Date.now()
                return xhr._send();
            }
            // upload

            return xhr._send.apply(this, arguments)
        }
        xhr.abort = function() {
            DEBUG('Socket: aborting', this.__id);
            this.clear_timeout();
            this.listener = null; /* we're done here, release this slot */
            this._abort();
        }
        xhr.nolistener = function() {
            this.clear_timeout();
            if (!this.__failed) {
                if (d) console.error('Socket: no listener for socket', this.__id);
                this.__failed = true;
                this._abort();
            }
        }
        xhr.onreadystatechange = function() {
            if (!this.listener) return this.nolistener();
            this.setup_timeout();
            switch (this.readyState) {
                case this.HEADERS_RECEIVED:
                    if ((Date.now() - this.started) > 10000) {
                        var ttfb = hostname(this.responseURL || this._murl) + ' took +10s';
                        if (d) console.log(ttfb);
                        else window.onerror(ttfb, '', -1);
                    }
                    break;
                case 4:
                    if (this.listener.on_ready) {
                        this.clear_timeout();
                        if (57005 === this.listener.on_ready(arguments, this)) {
                            this.onerror();
                        } else {
                            this.listener = null; /* we're done here, release this slot */
                        }
                    }
                    break;
                    // case 2:
                    // force progress update in case of a previous error with the chunk
                    // this.onprogress({zSaaDc:1});
            }
        }
        xhr.upload.onprogress = function() {
            if (!xhr.listener) return xhr.nolistener(); /* no one is listening */
            xhr.setup_timeout();
            /**
             *	Update the start time, so we meassure the response time
             *	not the upload time
             */
            xhr.started = Date.now()
            if (xhr.listener.on_upload_progress) {
                xhr.listener.on_upload_progress(arguments, xhr);
            }
        }
        xhr.xhr_cleanup = function(e) {
            if (!this.listener) return this.nolistener();
            this.clear_timeout();
            if (this.listener.on_error && !this.__failed) {
                var l = this.listener;
                this.listener = null; /* release */
                this.__failed = true;
                if (e !== 40958) {
                    var r = e && e.type || 'error';
                    if (d) console.error('Socket: on' + r, this.__id, this);
                    l.on_error(arguments, this, r);
                }
                this._abort();
                for (var i = 0; i < _xhr_queue.length; i++) {
                    if (_xhr_queue[i].__id == this.__id) {
                        _xhr_queue.splice(i, 1);
                        break;
                    }
                }
            }
        };
        xhr.onerror = xhr.xhr_cleanup;
        xhr.mOnTimeout = xhr.xhr_cleanup.bind(xhr, {
            type: 'mtimeout'
        });
        xhr.onprogress = function() {
            if (!this.listener) return this.nolistener();
            this.setup_timeout();
            if (this.listener.on_progress) {
                this.listener.on_progress(arguments, this)
            }
        }
        return xhr;
    }
    w.killallXhr = function() {
        for (var i = 0; i < _xhr_queue.length; i++) {
            _xhr_queue[i].abort();
        }
    }
    w.clearXhr = function() {
        _xhr_queue = $.grep(_xhr_queue, function(val) {
            return val.listener !== null;
        });
    };
    w.getXhr = function(object) {
        var zclass = (object.constructor || {}).name || 'no-class';
        for (var i = 0; i < _xhr_queue.length; i++) {
            if (!_xhr_queue[i].listener && _xhr_queue[i].type == zclass) {
                _xhr_queue[i].listener = object;
                _xhr_queue[i].lname = '' + object;
                _xhr_queue[i].__failed = false;
                return _xhr_queue[i];
            }
        }
        /* create a new xhr object */

        var xhr = newXhr();
        xhr.listener = object;
        xhr.lname = '' + object;
        xhr.type = zclass;
        /* add it to the queue so we can recicle it */
        _xhr_queue.push(xhr);
        return xhr;
    }
})(this);
// cr@mega.co.nz
function MegaEvents() {}
MegaEvents.prototype.trigger = function(name, args) {
    if (!(this._events && this._events.hasOwnProperty(name))) return false;
    if (d > 1) console.log(' >>> Triggering ' + name, this._events[name].length, args);
    args = args || []
    var done = 0,
        evs = this._events[name];
    for (var i in evs) {
        try {
            evs[i].apply(null, args);
        } catch (ex) {
            console.error(ex);
        }
        ++done;
    }
    return done;
};
MegaEvents.prototype.on = function(name, callback) {
    if (!this._events) this._events = {};
    if (!this._events.hasOwnProperty(name)) {
        this._events[name] = [];
    }
    this._events[name].push(callback);
    return this;
};
// cr@mega.co.nz
var DEFAULT_CONCURRENCY = 4

function MegaQueue(worker, limit) {
    this._limit = limit || 5;
    this._queue = [];
    this._running = 0
    this._worker = worker
    this._noTaskCount = 0;
    this._qpaused = {};
}
inherits(MegaQueue, MegaEvents)
MegaQueue.prototype.setSize = function(size) {
    this._limit = size;
    this._process();
}
MegaQueue.prototype.isEmpty = function() {
    return this._running == 0 && this._queue.length == 0;
}
MegaQueue.prototype.pushFirst = function(arg, next, self) {
    if (d) {
        var found;
        for (var i in this._queue) {
            if (this._queue[i][0] == arg) {
                found = true;
                break;
            }
        }
        ASSERT(!found, 'Huh, that task already exists');
    }
    this._queue.unshift([arg,
        next,
        self
    ]);
    this._process();
};
MegaQueue.prototype.resume = function() {
    this._paused = false;
    this._process();
    this.trigger('resume')
};
MegaQueue.prototype.canExpand = function() {
    return this._limit <= this._running && this._limit * 1.5 >= this._running;
}
/**
 * Expand temporarily the queue size, it should be called
 * when a task is about to end (for sure) so a new
 * task can start.
 *
 * It is useful when download many tiny files
 */

MegaQueue.prototype.expand = function() {
    if (this.canExpand()) {
        this._expanded = true;
        this._process();
        if (d) console.log('expand queue ' + this._running);
        return true;
    }
    return false;
};
MegaQueue.prototype.shrink = function() {
    this._limit = Math.max(this._limit - 1, 1);
    if (d) console.error('shrking queue to ', this._limit);
    return this._limit;
}
MegaQueue.prototype.filter = function(gid, foreach) {
    var len = this._queue.length + $.len(this._qpaused);
    if (!len) {
        if (d) console.debug('Nothing to filter', gid);
    } else {
        if (!foreach) {
            foreach = function(aTask) {
                aTask = aTask[0];
                if (d && !aTask.destroy) console.log('Removing Task ' + aTask);
                if (aTask.destroy) aTask.destroy();
            };
        }
        var tasks = this.slurp(gid);
        if (this._qpaused[gid]) {
            tasks = tasks.concat(this._qpaused[gid]);
            delete this._qpaused[gid];
        }
        tasks.map(foreach);
        // XXX: For Transfers, check if there might be leaked tasks without the file reference (ie, "dl" for dlQueue)
        if (d) console.log('Queue filtered, %d/%d tasks remaining', this._queue.length + $.len(this._qpaused), len, gid);
    }
};
MegaQueue.prototype.slurp = function(gid) {
    var res = [];
    this._queue = this._queue.filter(function(item) {
        return item[0][gid] ? (res.push(item), false) : true;
    });
    return res;
};
MegaQueue.prototype.pause = function() {
    if (d) {
        console.log('pausing queue');
        if (d > 1 && console.trace) console.trace();
    }
    this._paused = true;
    this.trigger('pause')
};
MegaQueue.prototype.isPaused = function() {
    return this._paused;
}
MegaQueue.prototype.pushAll = function(tasks, next, error) {
    function CCQueueChecker(task, response) {
        if (response.length && response[0] === false) {
            /**
             *	The first argument of .done(false) is false, which
             *	means that something went wrong
             */
            return error(task, response);
        }
        removeValue(tasks, task);
        if (tasks.length == 0) next();
    }
    var i = 0,
        len = tasks.length
    for (i = 0; i < len; i++) {
        tasks[i].onQueueDone = CCQueueChecker;
        this.push(tasks[i]);
    }
};
MegaQueue.prototype.run_in_context = function(task) {
    this._running++;
    this._worker(task[0], function MQRicStub() {
        ASSERT(task[0], 'This should not be reached twice.');
        if (!task[0]) return; /* already called */
        this._running--;
        var done = task[1] || task[0].onQueueDone;
        if (done) done.apply(task[2] || this, [
            task[0],
            arguments
        ]);
        task[0] = task[1] = task[2] = undefined;
        this._process();
    }.bind(this));
}
MegaQueue.prototype.validateTask = function() {
    return true;
}
MegaQueue.prototype.getNextTask = function() {
    var i,
        r,
        len = this._queue.length
    for (i = 0; i < len; i++) {
        if ((r = this.validateTask(this._queue[i][0])))
            return r < 0 ? null : this._queue.splice(i, 1)[0];
    }
    return null;
};
MegaQueue.prototype.process = function() {
    var args;
    if (this._paused) return;
    if (this._later) {
        clearTimeout(this._later);
        delete this._later;
    }
    while (this._running < this._limit && this._queue.length > 0) {
        args = this.getNextTask();
        if (args === null) {
            if (++this._noTaskCount == 666 && !$.len(this._qpaused)) {
                /**
                 * XXX: Prevent an infinite loop when there's a connection hang,
                 * with the UI reporting either "Temporary error; retrying" or
                 * a stalled % Status... [dc]
                 */
                if (d) console.error('*** CHECK THIS ***', this);
                this._noTaskCount = -1;
                return false;
            }
            this._process(1200);
            return false;
        }
        this._noTaskCount = 0;
        this.run_in_context(args);
        this.trigger('working', args);
    }
    if (this._expanded) {
        args = this.getNextTask();
        if (args) {
            this.run_in_context(args);
            this.trigger('working', args);
        }
        delete this._expanded;
    }
    if (!args && this.mull) this.mull();
    return true;
};
MegaQueue.prototype.destroy = function() {
    clearTimeout(this._later);
    // this._limit = -1
    // this._queue = null;
    // this._queue = [];
    if (d) ASSERT(this._queue.length == 0, 'This queue was not properly cleaned...');
    oDestroy(this);
}
MegaQueue.prototype._process = function(ms) {
    if (this._later) clearTimeout(this._later);
    this._later = setTimeout(this.process.bind(this), ms || 300);
};
MegaQueue.prototype.push = function(arg, next, self) {
    this._queue.push([arg,
        next,
        self
    ]);
    this.trigger('queue');
    this._process();
};

function TransferQueue() {
    MegaQueue.prototype.constructor.apply(this, arguments);
}
inherits(TransferQueue, MegaQueue);
TransferQueue.prototype.mull = function() {
    if (this.isEmpty() && $.len(this._qpaused)) {
        this.dispatch(Object.keys(this._qpaused).shift());
    }
};
TransferQueue.prototype.dispatch = function(gid) {
    // dispatch a paused transfer
    ASSERT(GlobalProgress[gid], 'No transfer associated with ' + gid);
    ASSERT(!GlobalProgress[gid] || this._qpaused[gid], 'This transfer is not in hold: ' + gid);
    if (this._qpaused[gid] && !GlobalProgress[gid].paused) {
        this._queue = this._qpaused[gid].concat(this._queue);
        delete this._qpaused[gid];
        this._process();
        return true;
    }
    return false;
};
TransferQueue.prototype.pause = function(gid) {
    if (!gid) return MegaQueue.prototype.pause.apply(this, arguments);
    // pause single transfer
    if (GlobalProgress[gid] && !GlobalProgress[gid].paused) {
        var p = GlobalProgress[gid],
            chunk;
        p.paused = true;
        while ((chunk = p.working.pop())) {
            if (d) console.error('Aborting by pause: ' + chunk);
            chunk.abort();
            this.pushFirst(chunk);
            this._running--;
        }
        this._qpaused[gid] = this.slurp(gid);
        $('.transfer-table #' + gid + ' td:eq(2) span.speed').text(' (paused)');
        GlobalProgress[gid].speed = 0; // reset speed
        if (($.transferprogress || {})[gid]) {
            $.transferprogress[gid][2] = 0; // reset speed
        }
        Soon(percent_megatitle);
    } else if (d) {
        if (!GlobalProgress[gid]) console.error('No transfer associated with ' + gid);
        else console.log('This transfer is ALREADY paused: ' + gid);
    }
};
TransferQueue.prototype.resume = function(gid) {
    if (!gid) return MegaQueue.prototype.resume.apply(this, arguments);
    if (GlobalProgress[gid] && GlobalProgress[gid].paused) {
        delete GlobalProgress[gid].paused;
        if (this.isEmpty()) this.dispatch(gid);
        $('.transfer-table #' + gid + ' td:eq(2) span.speed').text('');
    } else if (d) {
        if (!GlobalProgress[gid]) console.error('No transfer associated with ' + gid);
        else console.error('This transfer is not paused: ' + gid);
    }
};
(function(window) {
    'use strict';

    function storage_s2n(s) {
        return s.toLowerCase() === 'persistent' ? window.PERSISTENT : window.TEMPORARY;
    }

    function storage_n2s(n) {
        return +n == window.PERSISTENT ? 'Persistent' : 'Temporary';
    }

    function queryUsageAndQuota(aType, aSuccess, aError) {
        var sType = storage_n2s(aType);
        if (navigator['webkit' + sType + 'Storage']) {
            return navigator['webkit' + sType + 'Storage'].queryUsageAndQuota(aSuccess, aError);
        }
        if (window.webkitStorageInfo) {
            return window.webkitStorageInfo.queryUsageAndQuota(aType, aSuccess, aError);
        }
        Soon(aError.bind(window, new Error('Unknown FileSystem API')));
    }

    function requestQuota(aType, aSize, aSuccess, aError) {
        var sType = storage_n2s(aType);
        if (navigator['webkit' + sType + 'Storage']) {
            return navigator['webkit' + sType + 'Storage'].requestQuota(aSize, aSuccess, aError);
        }
        if (window.webkitStorageInfo) {
            return window.webkitStorageInfo.requestQuota(aType, aSize, aSuccess, aError);
        }
        Soon(aError.bind(window, new Error('Unknown FileSystem API.')));
    }

    function clearit(storagetype, t, callback) {
        var tsec = t || 3600;

        function errorHandler2(e) {
            if (d) console.error('error', e);
            if (callback) callback(e);
        }

        function toArray(list) {
            return Array.prototype.slice.call(list || [], 0);
        }

        function readentry() {
            if (entries.length == 0) {
                if (callback) callback(0);
            } else if (i < entries.length) {
                var file = entries[i];
                if (file.isFile && !isTrasferActive(file.name)) {
                    file.getMetadata(function(metadata) {
                        // do not delete file while it's being copied from FS to DL folder
                        // conservative assumption that a file is being written at 1024 bytes per ms
                        // add 30000 ms margin
                        var deltime = metadata.modificationTime.getTime() + tsec * 1000 + metadata.size / 1024 + 30000;
                        if (deltime < Date.now() && deltime < lastactive) {
                            file.remove(function() {
                                totalsize += metadata.size;
                                if (d) console.log('temp file removed', file.name, bytesToSize(metadata.size));
                                if (++del == entries.length && callback) callback(totalsize);
                            }, function() {
                                if (d) console.log('temp file removal failed', file.name, bytesToSize(metadata.size));
                                if (++del == entries.length && callback) callback(totalsize);
                            });
                        } else {
                            if (d) console.log('tmp file too new to remove', file.name, bytesToSize(metadata.size));
                            if (++del == entries.length && callback) callback(totalsize);
                        }
                    });
                }
                i++;
                readentry();
            }
        }

        function onInitFs(fs) {
            fs.root.getDirectory('mega', {
                create: true
            }, function(dirEntry) {
                function readEntries() {
                    dirReader.readEntries(function(results) {
                        if (!results.length) {
                            readentry();
                        } else {
                            entries = entries.concat(toArray(results));
                            readEntries();
                        }
                    }, errorHandler2);
                }
                var dirReader = dirEntry.createReader();
                readEntries();
            }, errorHandler2);
        }
        var i = 0;
        var del = 0;
        var entries = [];
        var totalsize = 0;
        if (window.webkitRequestFileSystem) {
            queryUsageAndQuota(storagetype, function(used, remaining) {
                if (used + remaining) {
                    if (d) console.log('Cleaning %s Storage...', storage_n2s(storagetype), bytesToSize(used), bytesToSize(remaining));
                    window.webkitRequestFileSystem(storagetype, 1024, onInitFs, errorHandler2);
                } else {
                    if (callback) callback(0);
                }
            }, errorHandler2);
        } else errorHandler2();
    }
    var WRITERR_DIAGTITLE = 'Out of HTML5 Offline Storage space',
        chrome_write_error_msg = 0;

    function free_space(callback, ms) {
        /* error */
        clearit(0, 0, function(s) {
            if (d) console.log('Freed %s of temporary storage', bytesToSize(s));
            // clear persistent files:
            clearit(1, 0, function(s) {
                if (d) console.log('Freed %s of persistent storage', bytesToSize(s));
                if (callback) setTimeout(callback, ms || 2600);
            });
        });
    }
    var HUGE_QUOTA = 1024 * 1024 * 1024 * 100;

    function dl_getspace(reqsize, callback, max_retries) {
        function retry(aStorageType, aEvent) {
            if (d) console.error('Retrying...', max_retries, arguments);
            if (max_retries) Later(dl_getspace.bind(this, reqsize, callback, --max_retries));
            else {
                callback(aStorageType, aEvent, -1);
            }
        }
        var zRetry = retry.bind(null, 0);
        if (typeof max_retries === 'undefined') max_retries = 3;
        if (d) console.log('Requesting disk space for %s (%d bytes)', bytesToSize(reqsize), reqsize);
        queryUsageAndQuota(PERSISTENT, function onPQU(used, remaining) {
            if (d) console.log('Used persistent storage: %s, remaining: %s', bytesToSize(used), bytesToSize(remaining));
            queryUsageAndQuota(TEMPORARY, function onTQU(tused, tremaining) {
                if (d) console.log('Used temporary storage: %s, remaining: %s', bytesToSize(tused), bytesToSize(tremaining));
                if (used > 0 || remaining > 0) {
                    if (remaining < reqsize) {
                        clearit(1, 300, retry.bind(null, 1));
                    } else {
                        callback(PERSISTENT);
                    }
                } else {
                    /**
                     * Check if our temporary storage quota is sufficient to proceed.
                     * (require 400% + 100MB margin because the quota can change during the download)
                     */
                    if (tremaining > reqsize * 5 + 1024 * 1024 * 100) {
                        callback();
                    } else if (tused + tremaining > reqsize * 5 + 1024 * 1024 * 100) {
                        clearit(0, 300, zRetry);
                    } else {
                        /**
                         * Highly likely that we will run out of 20% of 50% of free our diskspace
                         * -> request persistent storage to be able to use all remaining disk space.
                         */
                        requestQuota(PERSISTENT, HUGE_QUOTA, function onRQ(grantedBytes) {
                            if (d) console.log('Granted persistent storage: %s', bytesToSize(grantedBytes));
                            if (grantedBytes == 0) {
                                // user canceled the quota request?
                                retry(0, {
                                    code: FileError.SECURITY_ERR
                                });
                            } else {
                                /**
                                 * Looks like Chrome is granting storage even in Incognito mode,
                                 * ideally it should call our errorHandler without bothering
                                 * the user... [CHROME 36.0.1985.125]
                                 */
                                window.webkitRequestFileSystem(PERSISTENT, grantedBytes, function(fs) {
                                    callback(PERSISTENT);
                                }, retry.bind(null, 1));
                            }
                        }, zRetry);
                    }
                }
            }, zRetry);
        }, zRetry);
    }

    function errorHandler(type, e) {
        // TODO: FileError is deprecated. Please use the 'name' or 'message' attributes of DOMError rather than 'code'.
        switch (e.code) {
            case FileError.QUOTA_EXCEEDED_ERR:
                alert('Error writing file, is your harddrive almost full? (' + type + ')');
                break;
            case FileError.NOT_FOUND_ERR:
                alert('NOT_FOUND_ERR in ' + type);
                break;
            case FileError.SECURITY_ERR:
                alert('File transfers do not work with Chrome Incognito. (Security Error in ' + type + ')');
                break;
            case FileError.INVALID_MODIFICATION_ERR:
                alert('INVALID_MODIFICATION_ERR in ' + type);
                break;
            case FileError.INVALID_STATE_ERR:
                console.log('INVALID_STATE_ERROR in ' + type + ', retrying...');
                Later(this.fsInitOp.bind(this));
                break;
            default:
                alert('webkitRequestFileSystem failed in ' + type);
        }
    }
    window.FileSystemAPI = function fsIO(dl_id, dl) {
        var
            dl_fw,
            dl_chunks = [],
            dl_chunksizes = [],
            dl_writing,
            dl_position = 0,
            dl_buffer,
            dl_geturl,
            dl_filesize,
            dl_filename,
            dl_done,
            dl_storagetype = 0,
            targetpos = 0,
            zfileEntry,
            wTimer,
            failed = false,
            that = this;

        function dl_createtmpfile(fs) {
            var options = {
                create: true
            };
            fs.root.getDirectory('mega', options, function(dirEntry) {
                if (d) console.log('Opening file for writing: mega/' + dl_id);
                if (is_chrome_firefox) options.fxo = Object.create(dl, {
                    size: {
                        value: dl_filesize
                    }
                });
                fs.root.getFile('mega/' + dl_id, options, function(fileEntry) {
                    fileEntry.createWriter(function(fileWriter) {
                        if (d) console.log('File "mega/' + dl_id + '" created');
                        dl_fw = fileWriter;
                        dl_fw.onerror = function(e) {
                            /* onwriteend() will take care of it */
                            if (d) console.error(e);
                        };
                        dl_fw.onwriteend = function() {
                            if (that) {
                                ASSERT(dl_fw.readyState === dl_fw.DONE, 'Error truncating file!');
                                if (dl_fw.readyState === dl_fw.DONE) {
                                    if (that.begin) that.begin();
                                    else if (d) console.error('No \'begin\' function, this must be aborted...', dl);
                                    that = null;
                                }
                                return;
                            }
                            if (dl_fw.position == targetpos) {
                                chrome_write_error_msg = 0;
                                /* reset error counter */
                                dl_ack_write();
                            } else {
                                console.error('Short write (' + dl_fw.position + ' / ' + targetpos + ')');
                                /* try to release disk space and retry */
                                free_space(function() {
                                    if (++chrome_write_error_msg % 21 == 0 && !$.msgDialog) {
                                        chrome_write_error_msg = 0;
                                        msgDialog('warningb', WRITERR_DIAGTITLE, 'Your browser storage for MEGA is full. ' +
                                            'Your download will continue automatically after you free up some space.');
                                    }
                                    failed = true;
                                    dl_ack_write();
                                });
                            }
                        };
                        zfileEntry = fileEntry;
                        dl_fw.truncate(0);
                    }, errorHandler.bind(that, 'createWriter'));
                }, errorHandler.bind(that, 'getFile'));
                options = undefined;
            }, errorHandler.bind(that, 'getDirectory'));
        }
        this.fsInitOp = function check() {
            dl_getspace(dl_filesize, function(aStorageType, aEvent, aFail) {
                if (wTimer === null) return;
                if (aFail === -1) {
                    if (!$.msgDialog) {
                        msgDialog('warningb', WRITERR_DIAGTITLE, 'Your available browser storage for MEGA cannot ' +
                            'handle this download size, please free up some disk space.');
                    }
                    return wTimer = setTimeout(this.fsInitOp.bind(this), 2801);
                }
                dl_storagetype = aStorageType !== 1 ? 0 : 1;
                if (d) console.log('Using Storage: ' + storage_n2s(dl_storagetype), aStorageType, aEvent, aFail);
                window.requestFileSystem(dl_storagetype, dl_filesize, dl_createtmpfile, errorHandler.bind(this, 'RequestFileSystem'));
            }.bind(this));
        };
        this.abort = function(err) {
            if (wTimer) clearTimeout(wTimer);
            wTimer = null;
            if (dl_fw) {
                if (is_chrome_firefox) {
                    dl_fw.close(err);
                } else if (err) {
                    dl_fw.onerror = dl_fw.onwriteend = function() {};
                    dl_fw.truncate(0);
                }
            }
        };

        function dl_ack_write() {
            if (failed) {
                /* reset error flag */
                failed = false;
                /* retry */
                dl_fw.seek(dl_position);
                DEBUG('IO: error, retrying');
                return wTimer = setTimeout(function() {
                    dl_fw.write(new Blob([dl_buffer]))
                }, 2600);
            }
            if ($.msgDialog && $('#msgDialog:visible .fm-dialog-title').text() == WRITERR_DIAGTITLE) closeDialog();
            dl_buffer = null;
            dl_writing = false;
            if (dl_done) dl_done(); /* notify writer */
        }
        this.write = function(buffer, position, done) {
            if (dl_writing || position != dl_fw.position)
                throw new Error([position,
                    buffer.length,
                    position + buffer.length,
                    dl_fw.position
                ]);
            failed = false;
            targetpos = buffer.length + dl_fw.position;
            dl_writing = true;
            dl_position = position;
            dl_buffer = buffer
            dl_done = done;
            if (d) console.log('Write ' + buffer.length + ' bytes at ' + position + '/' + dl_fw.position);
            dl_fw.write(new Blob([buffer]));
        };
        this.download = function(name, path) {
            document.getElementById('dllink').download = name;
            document.getElementById('dllink').href = zfileEntry.toURL();
            if (!is_chrome_firefox) document.getElementById('dllink').click();
        }
        this.setCredentials = function(url, size, filename, chunks, sizes) {
            dl_geturl = url;
            dl_filesize = size;
            dl_filename = filename;
            dl_chunks = chunks;
            dl_chunksizes = sizes;
            this.fsInitOp();
        };
    };
    window.requestFileSystem = window.requestFileSystem || window.webkitRequestFileSystem;
    if (navigator.webkitGetUserMedia) Later(function() {
        if (dlMethod === FileSystemAPI)
            window.webkitRequestFileSystem(0, 65536, function(fs) {
                free_space();
            }, function(e) {
                if (e && e.code === FileError.SECURITY_ERR) {
                    console.error('Switching to MemoryIO');
                    window.Incognito = true;
                    dlMethod = MemoryIO;
                }
            });
    });
})(this);

function FileIO(dl_id, dl) {
    var file;
    this.write = function(buffer, offset, done) {
        file = new File([file,
            buffer
        ], file.name, {
            type: file.type,
            lastModified: Date.now()
        });
        Soon(done);
    };
    this.download = function(name, path) {
        var file_url = myURL.createObjectURL(file);
        var dlLinkNode = document.getElementById('dllink');
        dlLinkNode.download = name;
        dlLinkNode.href = file_url;
        dlLinkNode.click();
        Later(function() {
            myURL.revokeObjectURL(file_url);
            file_url = undefined;
        });
    };
    this.setCredentials = function(url, size, name) {
        if (this.is_zip || !dl.zipid) {
            file = new File([''], name, {
                type: 'application/octet-stream',
                lastModified: Date.now()
            });
        }
        this.begin();
    };
}
FileIO.usable = function() {
    var r = false;
    if (typeof File !== 'undefined') {
        try {
            var f = new File(['M'], 'M.txt', {
                type: 'text/plain'
            });
            r = f.size === 1 && f.name === 'M.txt';
        } catch (e) {}
    }
    return r;
}

function MemoryIO(dl_id, dl) {
    var dblob,
        offset = 0,
        msie = typeof MSBlobBuilder === 'function'
    if (d) console.log('Creating new MemoryIO instance', dl_id, dl);
    this.write = function(buffer, position, done) {
        try {
            if (msie) dblob.append(have_ab ? buffer : buffer.buffer);
            else dblob.push(new Blob([buffer]));
        } catch (e) {
            dlFatalError(dl, e);
        }
        offset += (have_ab ? buffer : buffer.buffer).length;
        buffer = null;
        Later(done);
    };
    this.download = function(name, path) {
        var blob = this.getBlob();
        if (is_chrome_firefox) {
            requestFileSystem(0, blob.size, function(fs) {
                var opt = {
                    create: !0,
                    fxo: dl
                };
                fs.root.getFile(dl_id, opt, function(fe) {
                    fe.createWriter(function(fw) {
                        fw.onwriteend = fe.toURL.bind(fe);
                        fw.write(blob);
                    });
                });
            });
        } else if (msie) {
            navigator.msSaveOrOpenBlob(blob, name);
        } else {
            var blob_url = myURL.createObjectURL(blob);
            var dlLinkNode = document.getElementById('dllink');
            dlLinkNode.download = name;
            dlLinkNode.href = blob_url;
            dlLinkNode.click();
            Later(function() {
                myURL.revokeObjectURL(blob_url);
                blob_url = undefined;
            });
        }
        this.abort();
    };
    this.setCredentials = function(url, size, filename, chunks, sizes) {
        if (d) DEBUG('MemoryIO Begin', dl_id, Array.prototype.slice.call(arguments));
        if (size > 950 * 1048576) {
            dlFatalError(dl, Error('File too big to be reliably handled in memory.'));
        }
        dblob = msie ? new MSBlobBuilder() : [];
        this.begin();
    };
    this.abort = function() {
        dblob = undefined;
    };
    this.getBlob = function() {
        return msie ? dblob.getBlob() : new Blob(dblob);
    };
}

function FlashIO(dl_id, dl) {
    var IO = this,
        offset = 0,
        dl_id = dl.zip_dl_id || dl_id,
        swfid = 'dlswf_' + (dl.zipid ? 'zip_' + dl.zipid : dl_id),
        retries = 0
    this.write = function(buffer, position, done) {
        var node = document.getElementById(swfid);
        if (typeof node.flashdata !== 'function') {
            return setTimeout(function() {
                if (!dl.cancelled) {
                    if (++retries < 400) IO.write(buffer, position, done);
                    else dlFatalError(dl, 'FlashIO Object unavailable');
                }
            }, 300);
        }
        var j,
            k,
            len,
            subdata;
        if (have_ab)
            len = buffer.length;
        else
            len = buffer.buffer.length;
        if (have_ab)
            subdata = ab_to_base64(buffer);
        else
            subdata = base64urlencode(buffer.buffer);
        node.flashdata(dl_id, subdata);
        offset += len
        Later(done);
    };
    this.download = function(name, path) {
        document.getElementById(swfid).flashdata(dl_id, '', name);
    };
    this.setCredentials = function(url, size, filename, chunks, sizes) {
        // dl_geturl = url;
        // dl_filesize = size;
        // dl_filename = filename;
        // dl_chunks   = chunks;
        // dl_chunksizes = sizes;
        IO.begin();
    };
}
FlashIO.warn = true;
var fetchingFile = null,
    __ccXID = 0
    /**
     *  How many queue IO we want before pausing the
     *	XHR fetching, useful when we have internet
     *  faster than our IO (first world problem)
     */
    ,
    IO_THROTTLE = 15
    // Keep a record of active transfers.
var GlobalProgress = {};

function dlSetActiveTransfer(dl_id) {
    var data = JSON.parse(localStorage.aTransfers || '{}');
    data[dl_id] = Date.now();
    localStorage.aTransfers = JSON.stringify(data);
}

function isTrasferActive(dl_id) {
    var date = null;
    if (localStorage.aTransfers) {
        var data = JSON.parse(localStorage.aTransfers);
        date = data[dl_id];
    }
    return date;
}

function dlClearActiveTransfer(dl_id) {
    var data = JSON.parse(localStorage.aTransfers || '{}');
    if (data[dl_id]) {
        delete data[dl_id];
        if (!$.len(data)) delete localStorage.aTransfers;
        else localStorage.aTransfers = JSON.stringify(data);
    }
}
if (localStorage.aTransfers) {
    Soon(function() {
        var data = {},
            now = NOW();
        try {
            data = JSON.parse(localStorage.aTransfers);
        } catch (e) {}
        for (var r in data) {
            // Let's assume there was a system/browser crash...
            if ((now - data[r]) > 86400000) delete data[r];
        }
        if (!$.len(data)) delete localStorage.aTransfers;
        else localStorage.aTransfers = JSON.stringify(data);
    });
}

function ClassChunk(task) {
    this.task = task;
    this.dl = task.download;
    this.url = task.url
    this.size = task.size
    this.io = task.download.io
    this.done = false
    this.avg = [
        0,
        0
    ]
    this.gid = task.file.gid;
    this.xid = this.gid + '_' + (++__ccXID)
    this.failed = false
    // this.backoff  = 1936+Math.floor(Math.random()*2e3);
    this.lastPing = NOW()
    this.lastUpdate = NOW()
    this.Progress = GlobalProgress[this.gid]
    this.Progress.dl_xr = this.Progress.dl_xr || getxr() // global download progress
    this.Progress.speed = this.Progress.speed || 1
    this.Progress.size = this.Progress.size || (this.dl.zipid ? Zips[this.dl.zipid].size : this.io.size)
    this.Progress.dl_lastprogress = this.Progress.dl_lastprogress || 0;
    this.Progress.dl_prevprogress = this.Progress.dl_prevprogress || 0;
    this.Progress.data[this.xid] = [
        0,
        task.size
    ];
    this[this.gid] = !0;
}
ClassChunk.prototype.toString = function() {
    return '[ClassChunk ' + this.xid + ']';
};
ClassChunk.prototype.abort = function() {
    if (this.oet) clearTimeout(this.oet);
    if (this.xhr) this.xhr.xhr_cleanup(40958);
    if (this.Progress) removeValue(this.Progress.working, this, 1);
    delete this.xhr;
};
// destroy {{{
ClassChunk.prototype.destroy = function() {
    if (d) console.log('Destroying ' + this);
    this.abort();
    oDestroy(this);
};
// }}}
// shouldIReportDone {{{
ClassChunk.prototype.shouldIReportDone = function(report_done) {
    var pbx = this.Progress.data[this.xid];
    if (!pbx) return;
    if (!report_done) report_done = !this.done && dlQueue.canExpand() && (pbx[1] - pbx[0]) / this.Progress.speed <= dlDoneThreshold;
    if (report_done) {
        if (d) console.log(this + ' reporting done() earlier to start another download.');
        this.done = true;
        dlQueue.expand();
    }
    return report_done;
};
// }}}
// updateProgress {{{
ClassChunk.prototype.updateProgress = function(force) {
    if (ui_paused) {
        // do not update the UI
        return false;
    }
    // var r = this.shouldIReportDone(force === 2);

    var r = force !== 2 ? this.shouldIReportDone() : 127;
    if (this.Progress.dl_lastprogress + 200 > NOW() && !force) {
        // too soon
        return false;
    }
    var _progress = this.Progress.done
    for (var i in this.Progress.data) {
        _progress += this.Progress.data[i][0];
    }
    this.dl.onDownloadProgress(this.dl.dl_id, Math.min(99, Math.floor(_progress / this.Progress.size * 100)), _progress, // global progress
        this.Progress.size, // total download size
        this.Progress.speed = this.Progress.dl_xr.update(_progress - this.Progress.dl_prevprogress), // speed
        this.dl.pos, // this download position
        force && force !== 2
    );
    this.Progress.dl_prevprogress = _progress
    this.Progress.dl_lastprogress = NOW()
    return r;
}
// }}}
// isCancelled {{{

ClassChunk.prototype.isCancelled = function() {
    if (!this.dl) return true;
    var is_cancelled = !!this.dl.cancelled;
    if (!is_cancelled) {
        if (typeof(this.dl.pos) !== 'number') {
            this.dl.pos = IdToFile(this.dl.id).pos
        }
        is_cancelled = !dl_queue[this.dl.pos] || !dl_queue[this.dl.pos].n;
    }
    if (is_cancelled) {
        if (d) console.log(this + ' aborting itself because download was canceled.', this.task.chunk_id);
        this.dl.cancelled = true;
        this.finish_download();
        this.task.file.destroy();
        this.destroy();
    }
    return is_cancelled;
}
// }}}
// finish_download {{{

ClassChunk.prototype.finish_download = function() {
    if (d) ASSERT(!!this.xhr || !this.dl || this.dl.cancelled, 'Don\'t call me twice!');
    if (this.xhr) {
        this.abort();
        this.task_done.apply(this, arguments);
    }
}
// }}}
// XHR::on_progress {{{

ClassChunk.prototype.on_progress = function(args) {
    if (!this.Progress.data[this.xid] || this.isCancelled()) return;
    // if (args[0].loaded) this.Progress.data[this.xid][0] = args[0].loaded;
    // this.updateProgress(!!args[0].zSaaDc ? 0x9a : 0);
    this.Progress.data[this.xid][0] = args[0].loaded;
    this.updateProgress();
};
// }}}
// XHR::on_error {{{
ClassChunk.prototype.on_error = function(args, xhr) {
    if (d) console.error('ClassChunk.on_error', this.task && this.task.chunk_id, args, xhr, this);
    if (this.isCancelled()) {
        ASSERT(0, 'This chunk should have been destroyed before reaching XHR.onerror..');
        return;
    }
    this.Progress.data[this.xid][0] = 0; /* reset progress */
    this.updateProgress(2);
    this.oet = setTimeout(this.finish_download.bind(this, false, xhr.readyState > 1 && xhr.status), 950 + Math.floor(Math.random() * 2000));
}
// }}}
// XHR::on_ready {{{

ClassChunk.prototype.on_ready = function(args, xhr) {
    if (this.isCancelled()) return;
    var r = xhr.response || {};
    if (r.byteLength == this.size) {
        this.Progress.done += r.byteLength;
        delete this.Progress.data[this.xid];
        this.updateProgress(true);
        if (navigator.appName != 'Opera') {
            this.io.dl_bytesreceived += r.byteLength;
        }
        this.dl.decrypter++;
        Decrypter.push([
            [this.dl,
                this.task.offset
            ],
            this.dl.nonce,
            this.task.offset / 16,
            new Uint8Array(r)
        ])
        this.dl.retries = 0;
        this.finish_download();
        this.destroy();
    } else if (!this.dl.cancelled) {
        if (d) console.error('HTTP FAILED', this.dl.n, xhr.status, 'am i done? ' + this.done, r.bytesLength, this.size);
        if (dlMethod === MemoryIO) try {
            new Uint8Array(16777216);
        } catch (e) {
            // We're running out of memory..
            console.error('Uh, oh...', e);
            dlFatalError(this.dl, e);
        }
        return 57005;
    }
};
// }}}
ClassChunk.prototype.run = function(task_done) {
    if (this.isCancelled()) return;
    if (this.size < 100 * 1024 && dlQueue.expand()) {
        /**
         *	It is an small chunk and we *should* finish soon if everything goes
         *	fine. We release our slot so another chunk can start now. It is useful
         *	to speed up tiny downloads on a ZIP file
         */
        this.done = true;
    }
    this.task_done = task_done;
    if (!this.io.dl_bytesreceived) {
        this.io.dl_bytesreceived = 0;
    }
    this.Progress.working.push(this);
    /* let the fun begin! */
    if (d) console.log(this + ' Fetching ' + this.url);
    this.xhr = getXhr(this);
    this.xhr._murl = this.url;
    if (chromehack) {
        var t = this.url.lastIndexOf('/dl/');
        this.xhr.open('POST', this.url.substr(0, t + 1));
        this.xhr.setRequestHeader('MEGA-Chrome-Antileak', this.url.substr(t));
    } else {
        this.xhr.open('POST', this.url, true);
    }
    this.xhr.responseType = have_ab ? 'arraybuffer' : 'text';
    this.xhr.send();
};
// }}}
// ClassFile {{{
function ClassEmptyChunk(dl) {
    this.task = {
        zipid: dl.zipid,
        id: dl.id
    };
    this.dl = dl;
}
ClassEmptyChunk.prototype.run = function(task_done) {
    if (this.dl.zipid) {
        this.dl.writer.push({
            data: new Uint8Array(0),
            offset: 0
        });
        Soon(task_done);
    } else
        this.dl.io.write(new Uint8Array(0), 0, function() {
            task_done();
            this.dl.ready();
            oDestroy(this);
        }.bind(this));
}

function ClassFile(dl) {
    this.task = dl;
    this.dl = dl;
    this.gid = DownloadManager.GetGID(dl);
    if (!dl.zipid || !GlobalProgress[this.gid]) {
        GlobalProgress[this.gid] = {
            data: {},
            done: 0,
            working: []
        };
        dlSetActiveTransfer(dl.zipid || dl.dl_id);
    }
    this[this.gid] = !0;
}
ClassFile.prototype.toString = function() {
    return '[ClassFile ' + this.gid + ']';
};
ClassFile.prototype.destroy = function() {
    if (d) console.log('Destroying ' + this, this.dl ? (this.dl.cancelled ? 'cancelled' : 'finished') : 'expunged');
    if (!this.dl) return;
    if (this.dl.quota_t) {
        clearTimeout(this.dl.quota_t);
        delete this.dl.quota_t;
    }
    if (this.dl.retry_t) {
        clearTimeout(this.dl.retry_t);
        delete this.dl.retry_t;
    }
    if (this.dl.cancelled) {
        if (this.dl.zipid && Zips[this.dl.zipid])
            Zips[this.dl.zipid].destroy(47839);
    } else {
        if (!this.emptyFile && !checkLostChunks(this.dl) && (typeof skipcheck == 'undefined' || !skipcheck)) {
            dl_reportstatus(this.dl, EKEY);
            if (this.dl.zipid) Zips[this.dl.zipid].destroy(EKEY);
        } else if (this.dl.zipid) {
            Zips[this.dl.zipid].done(this);
        } else {
            this.dl.onDownloadProgress(this.dl.dl_id, 100, this.dl.size, this.dl.size, 0, this.dl.pos);
            this.dl.onBeforeDownloadComplete(this.dl.pos);
            if (!this.dl.preview) {
                this.dl.io.download(this.dl.zipname || this.dl.n, this.dl.p || '');
            }
            this.dl.onDownloadComplete(this.dl);
            if (dlMethod != FlashIO) DownloadManager.cleanupUI(this.dl, true);
        }
    }
    if (!this.dl.zipid) delete GlobalProgress[this.gid];
    dlClearActiveTransfer(this.dl.zipid || this.dl.dl_id);
    this.dl.ready = function onDeadEnd() {
        if (d) console.error('We reached a dead end..')
    };
    this.dl.writer.destroy();
    oDestroy(this);
}
ClassFile.prototype.run = function(task_done) {
    ASSERT(this.gid && GlobalProgress[this.gid], 'Invalid ClassFile state (' + (!!this.gid) + ', ' + (this.dl && !!this.dl.cancelled) + ')');
    if (!this.gid || !GlobalProgress[this.gid]) {
        return task_done(); // Hmm..
    }
    fetchingFile = 1;
    this.dl.retries = 0; /* set the retries flag */
    DEBUG('dl_key ' + this.dl.key);
    if (!GlobalProgress[this.gid].started) {
        GlobalProgress[this.gid].started = true;
        this.dl.onDownloadStart(this.dl);
    }
    this.dl.ready = function() {
        if (d) console.log('@dl.ready', this.chunkFinished, this.dl.writer.isEmpty(), this.dl.decrypter);
        if (this.chunkFinished && this.dl.decrypter == 0 && this.dl.writer.isEmpty()) {
            this.destroy();
        }
    }.bind(this);
    this.dl.io.begin = function() {
        var tasks = [];
        if (!this.dl || this.dl.cancelled) {
            if (d) console.log(this + ' cancelled while initializing.');
        } else {
            if (d) console.log('Adding', (this.dl.urls || []).length, 'tasks for', this.dl.dl_id);
            if (this.dl.urls)
                for (var key in this.dl.urls) {
                    var url = this.dl.urls[key];
                    tasks.push(new ClassChunk({
                        url: url.url,
                        size: url.size,
                        offset: url.offset,
                        download: this.dl,
                        chunk_id: key,
                        zipid: this.dl.zipid,
                        id: this.dl.id,
                        file: this
                    }));
                }
            if ((this.emptyFile = (tasks.length == 0)) && this.dl.zipid) {
                tasks.push(new ClassEmptyChunk(this.dl));
            }
            if (tasks.length > 0) {
                dlQueue.pushAll(tasks, function onChunkFinished() {
                    this.chunkFinished = true;
                }.bind(this), failureFunction);
            }
        }
        if (task_done) {
            fetchingFile = 0;
            task_done();
            if (this.dl) {
                delete this.dl.urls;
                delete this.dl.io.begin;
            }
            task_done = null;
        }
        if (tasks.length == 0) {
            // force file download
            this.destroy();
        }
    }.bind(this);
    dlGetUrl(this.dl, function(error, res, o) {
        if (!this.dl || this.dl.cancelled) {
            if (d) console.error('Knock, knock..', this.dl);
            if (this.dl) {
                /* Remove leaked items from dlQueue & dl_queue */
                DownloadManager.abort(this.dl);
                this.destroy(); // XXX: should be expunged already
            }
            error = true;
        } else if (error) {
            /* failed */
            this.dl.retry_t = setTimeout(function onGetUrlError() {
                /* retry !*/
                ERRDEBUG('retrying ', this.dl.n);
                dlQueue.pushFirst(this);
                if (ioThrottlePaused) dlQueue.resume();
            }.bind(this), dl_retryinterval);
            DEBUG('retry to fetch url in ', dl_retryinterval, ' ms');
        } else {
            var info = dl_queue.splitFile(res.s);
            this.dl.url = res.g;
            this.dl.urls = dl_queue.getUrls(info.chunks, info.offsets, res.g)
            try {
                return this.dl.io.setCredentials(res.g, res.s, o.n, info.chunks, info.offsets);
            } catch (e) {
                setTransferStatus(this.dl, e, true);
            }
        }
        if (error && task_done) {
            fetchingFile = 0;
            Soon(task_done); /* release worker */
            task_done = null;
        }
    }.bind(this));
};
// }}}
function dl_writer(dl, is_ready) {
    function finish_write(task, done) {
        done();
        if (typeof task.callback == 'function') {
            task.callback();
        }
        if (dl.ready) dl.ready(); /* tell the download scheduler we're done */
        delete task.data;
    }
    dl.writer = new MegaQueue(function dlIOWriterStub(task, done) {
        if (!task.data.byteLength || dl.cancelled) {
            if (d) console.error(dl.cancelled ? 'download cancelled' : 'writing empty chunk');
            return finish_write(task, done);
        }
        dl.io.write(task.data, task.offset, function() {
            dl.writer.pos += task.data.length;
            if (dl.data) {
                new Uint8Array(dl.data, task.offset, task.data.length).set(task.data);
            }
            return finish_write(task, done);
        });
    }, 1);
    throttleByIO(dl.writer);
    dl.writer.pos = 0
    dl.writer.validateTask = function(t) {
        var r = (!is_ready || is_ready()) && t.offset == dl.writer.pos;
        // if (d) console.log('validateTask', r, t.offset, dl.writer.pos, t, dl, dl.writer);
        return r;
    };
};
var Decrypter = CreateWorkers('decrypter.js', function(context, e, done) {
    var dl = context[0],
        offset = context[1]
    if (typeof(e.data) == 'string') {
        if (e.data[0] == '[') {
            var t = JSON.parse(e.data),
                pos = offset
            for (var i = 0; i < t.length; i += 4, pos = pos + 1048576) {
                dl.macs[pos] = [
                    t[i],
                    t[i + 1],
                    t[i + 2],
                    t[i + 3]
                ];
            }
        }
        DEBUG('worker replied string', e.data, dl.macs);
    } else {
        var plain = new Uint8Array(e.data.buffer || e.data);
        DEBUG('Decrypt done', dl.cancelled);
        dl.decrypter--
        if (!dl.cancelled) {
            dl.writer.push({
                data: plain,
                offset: offset
            });
        }
        plain = null
        done();
    }
}, 4);
/**
 *	Keep in track real active downloads.
 *
 *	Despite the fact that the DownloadQueue has a limitted size,
 *	to speed up things for tiny downloads each download is able to
 *	report to the scheduler that they are done when it may not be necessarily
 *	true (but they are for instance close to their finish)
 */
// ETA (in seconds) to consider a download finished, used to speed up chunks
var dlDoneThreshold = 3

function downloader(task, done) {
    if (!task.dl) {
        if (d) console.log('Skipping frozen task ' + task);
        return done();
    }
    return task.run(done);
}

function getxr() {
    return {
        update: function(b) {
            var ts = Date.now(),
                t;
            if (b < 0) {
                this.tb = {};
                this.st = 0;
                return 0;
            }
            if (b) this.tb[ts] = this.tb[ts] ? this.tb[ts] + b : b;
            b = 0;
            for (t in this.tb) {
                t = parseInt(t);
                if (t < ts - this.window) delete this.tb[t];
                else b += this.tb[t];
            }
            if (!b) {
                this.st = 0;
                return 0;
            } else if (!this.st) this.st = ts;
            if (!(ts -= this.st)) return 0;
            if (ts > this.window) ts = this.window;
            return b / ts;
        },
        tb: {},
        st: 0,
        window: 60000
    }
}
var dlMethod, dl_maxSlots = readLocalStorage('dl_maxSlots', 'int', {
        min: 1,
        max: 6,
        def: 5
    }),
    dl_legacy_ie = (typeof XDomainRequest != 'undefined') && (typeof ArrayBuffer == 'undefined'),
    dl_maxchunk = 16 * 1048576,
    ui_paused = false,
    dlQueue = new TransferQueue(downloader, dl_maxSlots)
    /** @FIXME: move me somewhere else */
$.len = function(obj) {
    return Object.keys(obj).length;
};

function dl_cancel() {
    DownloadManager.abort(null);
}
/**
 *	Global object which can be used to abort
 *	a given file (and their chunks/files)
 */

var DownloadManager = {
    newUrl: function DM_newUrl(dl, callback) {
        if (callback) {
            if (!this.nup) this.nup = {};
            if (this.nup[dl.dl_id]) {
                this.nup[dl.dl_id].push(callback);
                return;
            }
            this.nup[dl.dl_id] = [
                callback
            ];
        }
        if (d) console.log('Retrieving New URLs for', dl.dl_id);
        dlQueue.pause();
        dlGetUrl(dl, function(error, res, o) {
            if (error) return Later(this.newUrl.bind(this, dl));
            var changed = 0
            for (var i = 0; i < dlQueue._queue.length; i++) {
                if (dlQueue._queue[i][0].dl === dl) {
                    dlQueue._queue[i][0].url = res.g + '/' +
                        dlQueue._queue[i][0].url.replace(/.+\//, '')
                    changed++
                }
            }
            if (this.nup && this.nup[dl.dl_id]) {
                this.nup[dl.dl_id].forEach(function(callback) {
                    callback(res.g, res);
                });
                delete this.nup[dl.dl_id];
            }
            DEBUG('got', changed, 'new URL for', dl.dl_id, 'resume everything');
            dlQueue.resume();
        }.bind(this));
    },
    cleanupUI: function DM_cleanupUI(gid) {
        if (typeof gid === 'object') gid = this.GetGID(gid);
        var l = dl_queue.length;
        while (l--) {
            var dl = dl_queue[l];
            if (gid === this.GetGID(dl)) {
                if (d) console.log('cleanupUI', gid, dl.n, dl.zipname);
                if (dl.io instanceof MemoryIO) {
                    dl.io.abort();
                }
                // oDestroy(dl.io);

                dl_queue[l] = Object.freeze({});
            }
        }
        if (dlMethod !== FlashIO) $('#' + gid).fadeOut('slow', function() {
            $(this).remove()
        });
    },
    GetGID: function DM_GetGID(dl) {
        return dl.zipid ? 'zip_' + dl.zipid : 'dl_' + dl.dl_id;
    },
    abort: function DM_abort(gid, keepUI) {
        if (gid === null || Array.isArray(gid)) // all || grp
        {
            this._multiAbort = 1;
            if (gid) gid.forEach(this.abort.bind(this));
            else dl_queue.filter(isQueueActive).forEach(this.abort.bind(this));
            delete this._multiAbort;
            Soon(resetUploadDownload);
        } else {
            if (typeof gid === 'object') gid = this.GetGID(gid);
            else if (gid[0] === 'u') return;
            var l = dl_queue.length;
            while (l--) {
                var dl = dl_queue[l];
                if (gid === this.GetGID(dl)) {
                    if (!dl.cancelled) try {
                        if (typeof dl.io.abort === 'function') {
                            if (d) console.log('IO.abort', gid, dl);
                            dl.io.abort('User cancelled');
                        }
                    } catch (e) {
                        console.error(e);
                    }
                    dl.cancelled = true;
                    if (dl.zipid && Zips[dl.zipid]) {
                        Zips[dl.zipid].cancelled = true;
                    }
                    if (dl.io && typeof dl.io.begin === 'function') {
                        /**
                         * Canceled while Initializing? Let's free up stuff
                         * and notify the scheduler for the running task
                         */
                        dl.io.begin();
                    }
                }
            }
            if (!keepUI) this.cleanupUI(gid);
            /**
			 * We rely on `dl.cancelled` to let chunks destroy himself.
			 * However, if the dl is paused we might end up with the
			 + ClassFile.destroy uncalled, which will be leaking.
			 */
            var foreach;
            if (dlQueue._qpaused[gid]) {
                foreach = function(task) {
                    task = task[0];
                    return task instanceof ClassChunk && task.isCancelled() || task.destroy();
                };
            }
            dlQueue.filter(gid, foreach);
            /**
             * Active chunks might are stuck waiting reply,
             * which won't get destroyed itself right away.
             */
            if (GlobalProgress[gid]) {
                var chunk,
                    w = GlobalProgress[gid].working;
                while ((chunk = w.pop())) {
                    chunk.isCancelled();
                }
            }
            if (!this._multiAbort) Soon(resetUploadDownload);
        }
    }
};
var ioThrottlePaused = false;

function throttleByIO(writer) {
    writer.on('queue', function() {
        if (writer._queue.length >= IO_THROTTLE && !dlQueue.isPaused()) {
            DEBUG('IO_THROTTLE: pause XHR');
            dlQueue.pause();
            ioThrottlePaused = true;
        }
    });
    writer.on('working', function() {
        if (writer._queue.length < IO_THROTTLE && ioThrottlePaused) {
            DEBUG('IO_THROTTLE: resume XHR');
            dlQueue.resume();
            ioThrottlePaused = false;
        }
    });
}
// TODO: move the next functions to fm.js when no possible conflicts

function fm_tfsorderupd() {
    M.t = {};
    $('.transfer-table tr[id]').each(function(pos, node) {
        if (d) ASSERT(-1 != ['ul',
            'dl',
            'zip'
        ].indexOf(('' + node.id).split('_').shift()), 'Huh, unexpected node id: ' + node.id);
        M.t[pos] = node.id;
        M.t[node.id] = pos;
    });
    if (d) console.log('M.t', M.t);
}

function fm_tfspause(gid) {
    if (gid[0] === 'u') ulQueue.pause(gid);
    else dlQueue.pause(gid);
}

function fm_tfsresume(gid) {
    if (gid[0] === 'u') ulQueue.resume(gid);
    else dlQueue.resume(gid);
}

function fm_tfsmove(gid, dir) // -1:up, 1:down
{
    var tfs = $('#' + gid),
        to,
        act,
        p1,
        p2;
    ASSERT(tfs.length === 1, 'Invalid transfer node: ' + gid);
    if (tfs.length != 1) return;
    ASSERT(GlobalProgress[gid] && GlobalProgress[gid].working.length == 0, 'Invalid transfer state: ' + gid);
    if (!GlobalProgress[gid] || GlobalProgress[gid].working.length) return;
    if (~dir) {
        to = tfs.next();
        act = 'after';
    } else {
        to = tfs.prev();
        act = 'before';
    }
    var id = to && to.attr('id') || 'x';
    ASSERT(GlobalProgress[id] && GlobalProgress[id].working.length == 0, 'Invalid [to] transfer state: ' + gid);
    if (!GlobalProgress[id] || GlobalProgress[id].working.length) return;
    if (id[0] == gid[0] || 'zdz'.indexOf(id[0] + gid[0]) != -1) {
        to[act](tfs);
    } else {
        if (d) console.log('Unable to move ' + gid);
        return;
    }
    fm_tfsorderupd();
    if (gid[0] === 'z' || id[0] === 'z') {
        var mQueue = [],
            trick = Object.keys(M.t).map(Number).filter(function(n) {
                return !isNaN(n) && M.t[n][0] != 'u';
            }),
            p = 0;
        for (var i in trick) {
            ASSERT(i == trick[i] && M.t[i], 'Oops..');
            var mQ = dlQueue.slurp(M.t[i]);
            for (var x in mQ) {
                (dl_queue[p] = mQ[x][0].dl).pos = p;
                ++p;
            }
            mQueue = mQueue.concat(mQ);
        }
        // we should probably fix our Array inheritance

        for (var i = p, len = dl_queue.length; i < len; ++i) {
            delete dl_queue[i];
        }
        dl_queue.length = p;
        dlQueue._queue = mQueue;
        return;
    }
    if (gid[0] === 'u') {
        var m_prop = 'ul';
        var mQueue = ulQueue._queue;
        var m_queue = ul_queue;
    } else {
        var m_prop = 'dl';
        var mQueue = dlQueue._queue;
        var m_queue = dl_queue;
    }
    var t_queue = m_queue.filter(isQueueActive);
    if (t_queue.length != m_queue.length) {
        var i = 0,
            m = t_queue.length;
        while (i < m) {
            (m_queue[i] = t_queue[i]).pos = i;
            ++i;
        }
        m_queue.length = i;
        while (m_queue[i]) {
            delete m_queue[i++];
        }
    }
    for (var i in mQueue) {
        if (mQueue[i][0][gid]) {
            var tmp = mQueue[i],
                m_q = tmp[0][m_prop];
            p1 = +i + dir;
            p2 = m_q.pos;
            tmp[0][m_prop].pos = mQueue[p1][0][m_prop].pos;
            mQueue[p1][0][m_prop].pos = p2;
            mQueue[i] = mQueue[p1];
            mQueue[p1] = tmp;
            p1 = m_queue.indexOf(m_q);
            tmp = m_queue[p1];
            m_queue[p1] = m_queue[p1 + dir];
            m_queue[p1 + dir] = tmp;
            ASSERT(m_queue[p1].pos === mQueue[i][0][m_prop].pos, 'Huh, move sync error..');
            break;
        }
    }
};
// chunk scheduler {{{
dlQueue.validateTask = function(pzTask) {
    var r = pzTask instanceof ClassChunk || pzTask instanceof ClassEmptyChunk;
    if (!r && pzTask instanceof ClassFile && !fetchingFile) {
        var i = this._queue.length;
        while (i-- && !(this._queue[i][0] instanceof ClassChunk));
        if ((r = !~i) && $.len(this._qpaused)) {
            fm_tfsorderupd();
            // About to start a new download, check if a previously paused dl was resumed.
            var p1 = M.t[pzTask.gid];
            for (var i = 0; i < p1; ++i) {
                var gid = M.t[i];
                if (this._qpaused[gid] && this.dispatch(gid)) return -48879;
            }
        }
    }
    return r;
};
// }}}
function checkLostChunks(file) {
    var dl_key = file.key
        // , t = []
        // $.each(file.macs, function(i, mac) {
        // t.push(i);
        // });
        // t.sort(function(a, b) {
        // return parseInt(a) - parseInt(b);
        // });
        // $.each(t, function(i, v) {
        // t[i] = file.macs[v];
        // });
    var t = Object.keys(file.macs).map(Number).sort(function(a, b) {
        return a - b
    }).map(function(v) {
        return file.macs[v]
    });
    var mac = condenseMacs(t, [
        dl_key[0] ^ dl_key[4],
        dl_key[1] ^ dl_key[5],
        dl_key[2] ^ dl_key[6],
        dl_key[3] ^ dl_key[7]
    ]);
    if (have_ab && (dl_key[6] != (mac[0] ^ mac[1]) || dl_key[7] != (mac[2] ^ mac[3]))) {
        return false;
    }
    if (file.data) {
        var options = {
            onPreviewRetry: file.preview === -1
        };
        if (!file.zipid) options.raw = is_rawimage(file.n);
        createnodethumbnail(file.id, new sjcl.cipher.aes([dl_key[0] ^ dl_key[4],
            dl_key[1] ^ dl_key[5],
            dl_key[2] ^ dl_key[6],
            dl_key[3] ^ dl_key[7]
        ]), ++ul_faid, file.data, options);
        file.data = null;
    }
    return true;
}
/**
 *	DownloadQueue
 *
 *	Array extension to override push, so we can easily
 *	kick up the download (or queue it) without modifying the
 *	caller codes
 */

function DownloadQueue() {}
inherits(DownloadQueue, Array);
DownloadQueue.prototype.getUrls = function(dl_chunks, dl_chunksizes, url) {
    var dl_urls = []
    $.each(dl_chunks, function(key, pos) {
        dl_urls.push({
            url: url + '/' + pos + '-' + (pos + dl_chunksizes[pos] - 1),
            size: dl_chunksizes[pos],
            offset: pos
        })
    });
    return dl_urls;
}
DownloadQueue.prototype.splitFile = function(dl_filesize) {
    var dl_chunks = [],
        dl_chunksizes = []
    var pp,
        p = pp = 0;
    for (var i = 1; i <= 8 && p < dl_filesize - i * '128'.KB(); i++) {
        dl_chunksizes[p] = i * '128'.KB()
        dl_chunks.push(p);
        pp = p;
        p += dl_chunksizes[p];
    }
    var chunksize = dl_filesize / dlQueue._limit / 2
    if (chunksize > '16'.MB()) chunksize = '16'.MB()
    else if (chunksize <= '1'.MB()) chunksize = '1'.MB();
    else chunksize = '1'.MB() * Math.floor(chunksize / '1'.MB())
    var reserved = dl_filesize - (chunksize * (dlQueue._limit - 1))
    while (p < dl_filesize) {
        dl_chunksizes[p] = p > reserved ? '1'.MB() : chunksize;
        dl_chunks.push(p);
        pp = p;
        p += dl_chunksizes[p];
    }
    if (!(dl_chunksizes[pp] = dl_filesize - pp)) {
        delete dl_chunksizes[pp];
        delete dl_chunks[dl_chunks.length - 1];
    }
    return {
        chunks: dl_chunks,
        offsets: dl_chunksizes
    };
}
var dl_lastquotawarning = 0,
    dl_retryinterval = 1000

function dlQueuePushBack(aTask) {
    ASSERT(aTask && aTask.onQueueDone, 'Invalid aTask.');
    dlQueue.pushFirst(aTask);
    if (ioThrottlePaused) dlQueue.resume();
}

function failureFunction(task, args) {
    var code = args[1] || 0,
        dl = task.task.download
    if (d) console.error('Fai1ure', dl.zipname || dl.n, code, task.task.chunk_id, task.task.offset, task.onQueueDone.name);
    if (code == 509) {
        var t = NOW();
        if (t - dl_lastquotawarning > 60000) {
            dl_lastquotawarning = t;
            dl_reportstatus(dl, code == 509 ? EOVERQUOTA : ETOOMANYCONNECTIONS); // XXX
            dl.quota_t = setTimeout(function() {
                dlQueuePushBack(task);
            }, 60000);
            return 1;
        }
    }
    /* update UI */

    dl_reportstatus(dl, EAGAIN);
    if (code == 403 || code == 404) {
        DownloadManager.newUrl(dl, function(rg) {
            if (!task.url) return;
            task.url = rg + '/' + task.url.replace(/.+\//, '');
            dlQueuePushBack(task);
        });
    } else {
        /* check for network error  */
        dl.dl_failed = true;
        api_reportfailure(hostname(dl.url), network_error_check);
        dlQueuePushBack(task);
    }
    return 2;
}
DownloadQueue.prototype.push = function() {
    var pos = Array.prototype.push.apply(this, arguments),
        id = pos - 1,
        dl = this[id],
        dl_id = dl.ph || dl.id,
        dl_key = dl.key,
        dl_keyNonce = JSON.stringify([dl_key[0] ^ dl_key[4],
            dl_key[1] ^ dl_key[5],
            dl_key[2] ^ dl_key[6],
            dl_key[3] ^ dl_key[7],
            dl_key[4],
            dl_key[5]
        ]),
        dlIO
    if (dl.zipid) {
        if (!Zips[dl.zipid]) Zips[dl.zipid] = new ZipWriter(dl.zipid, dl);
        dlIO = Zips[dl.zipid].addEntryFile(dl);
    } else {
        dlIO = dl.preview ? new MemoryIO(dl_id, dl) : new dlMethod(dl_id, dl);
    }
    if (!use_workers) {
        dl.aes = new sjcl.cipher.aes([dl_key[0] ^ dl_key[4],
            dl_key[1] ^ dl_key[5],
            dl_key[2] ^ dl_key[6],
            dl_key[3] ^ dl_key[7]
        ]);
    }
    /* In case it failed and it was manually cancelled and retried */
    // DownloadManager.release("id:" + dl_id);

    dl.pos = id // download position in the queue
    dl.dl_id = dl_id; // download id
    dl.io = dlIO;
    dl.nonce = dl_keyNonce
    // Use IO object to keep in track of progress
    // and speed
    dl.io.progress = 0;
    dl.io.size = dl.size;
    dl.decrypter = 0;
    if (!dl.zipid) {
        dl_writer(dl);
    } else {
        dl.writer = dlIO;
    }
    dl.macs = {}
    dl.urls = []
    dlQueue.push(new ClassFile(dl));
    return pos;
};

function dl_reportstatus(dl, code) {
    if (dl) {
        dl.lasterror = code;
        dl.onDownloadError(dl, code);
    }
    if (code === EKEY) {
        // TODO: Check if other codes should raise abort()
        Later(function() {
            DownloadManager.abort(dl, true);
        });
    }
}

function dlGetUrlDone(res, ctx) {
    if (typeof res == 'number') {
        dl_reportstatus(ctx.object, res);
    } else if (typeof res == 'object') {
        if (res.d) {
            dl_reportstatus(ctx.object, res.d ? 2 : 1)
        } else if (res.g) {
            var ab = base64_to_ab(res.at),
                o = dec_attr(ab, [
                    ctx.dl_key[0] ^ ctx.dl_key[4],
                    ctx.dl_key[1] ^ ctx.dl_key[5],
                    ctx.dl_key[2] ^ ctx.dl_key[6],
                    ctx.dl_key[3] ^ ctx.dl_key[7]
                ]);
            if (typeof o == 'object' && typeof o.n == 'string') {
                if (have_ab && res.s <= 48 * 1048576 && is_image(o.n) && (!res.fa || res.fa.indexOf(':0*') < 0 || res.fa.indexOf(':1*') < 0 || ctx.object.preview === -1)) {
                    ctx.object.data = new ArrayBuffer(res.s);
                }
                return ctx.next(false, res, o, ctx.object);
            }
            dl_reportstatus(ctx.object, EAGAIN);
        } else {
            dl_reportstatus(ctx.object, res.e);
        }
    } else {
        dl_reportstatus(ctx.object, EAGAIN);
    }
    dl_retryinterval *= 1.2;
    ctx.next(new Error('failed'))
}

function dlGetUrl(object, callback) {
    var req = {
        a: 'g',
        g: 1,
        ssl: use_ssl,
    }
    if (object.ph) {
        req.p = object.ph;
    } else if (object.id) {
        req.n = object.id;
    }
    api_req(req, {
        object: object,
        next: callback,
        dl_key: object.key,
        callback: dlGetUrlDone
    }, n_h ? 1 : 0);
}

function IdToFile(id) {
    var dl = {};
    for (var i in dl_queue) {
        if (id == dl_queue[i].id) {
            dl = dl_queue[i];
            ASSERT(dl.pos == i, 'dl.pos !== i');
            break;
        }
    }
    // $.each(dl_queue, function(i, _dl) {
    // if (id == _dl.id) {
    // dl = _dl
    // dl.pos = i
    // return false;
    // }
    // });

    return dl;
}
if (localStorage.dlMethod) {
    dlMethod = window[localStorage.dlMethod];
} else if (is_chrome_firefox & 4) {
    dlMethod = FirefoxIO;
} else if (window.webkitRequestFileSystem) {
    dlMethod = FileSystemAPI;
} else if (navigator.msSaveOrOpenBlob || 'download' in document.createElementNS('http://www.w3.org/1999/xhtml', 'a')) {
    dlMethod = MemoryIO;
} else {
    dlMethod = FlashIO;
}
if (dlMethod.init) dlMethod.init();
var dl_queue = new DownloadQueue

function UploadQueue() {}
inherits(UploadQueue, Array);
/* Helper functions {{{ */
var ul_completion = [];
var ul_completing;

function ul_completepending(target) {
    if (ul_completion.length) {
        console.error('I\'m weak, debug me.')
        var ul = ul_completion.shift();
        // var ctx = {
        // target : target,
        // ul_queue_num : ul[3],
        // size: ul_queue[ul[3]].size,
        // callback : ul_completepending2,
        // faid : ul[1].faid,
        // file : ul[1]
        // };
        //api_completeupload(ul[0],ul[1],ul[2],ctx);
        var file = ul[1];
        file.response = ul[0]
        file.filekey = ul[2]
        ul_finalize(file)
    } else ul_completing = false;
}

function ul_completepending2(res, ctx) {
    DEBUG('ul_completepending2', res, ctx)
    ASSERT(typeof res == 'object' && res.f, 'Unexpected UL Server Response.', res);
    if (typeof res == 'object' && res.f) {
        if (ctx.faid) storedattr[ctx.faid].target = res.f[0].h;
        newnodes = [];
        process_f(res.f);
        rendernew();
        fm_thumbnails();
        if (ctx.faid) api_attachfileattr(res.f[0].h, ctx.faid);
        onUploadSuccess(ul_queue[ctx.ul_queue_num]);
        ul_queue[ctx.ul_queue_num] = {}
        ctx.file.ul_failed = false;
        ctx.file.retries = 0;
        ul_completepending(ctx.target);
    } else Later(resetUploadDownload);
    if (ctx.file.owner) ctx.file.owner.destroy();
    else oDestroy(ctx.file);
}

function ul_deduplicate(File, identical) {
    var n,
        uq = File.ul;
    if (identical && ul_skipIdentical) {
        n = identical;
    } else if (!M.h[uq.hash] && !identical) {
        return ul_start(File)
    } else if (M.h[uq.hash]) {
        n = M.d[M.h[uq.hash][0]];
    }
    if (!n) return ul_start(File);
    DEBUG(File.file.name, 'ul_deduplicate', n)
    api_req({
        a: 'g',
        g: 1,
        ssl: use_ssl,
        n: n.h
    }, {
        uq: uq,
        n: n,
        skipfile: (ul_skipIdentical && identical),
        callback: function(res, ctx) {
            if (res.e == ETEMPUNAVAIL && ctx.skipfile) {
                ctx.uq.repair = ctx.n.key;
                ul_start(File);
            } else if (typeof res == 'number' || res.e) {
                ul_start(File);
            } else if (ctx.skipfile) {
                onUploadSuccess(uq);
                File.file.ul_failed = false;
                File.file.retries = 0;
                File.file.done_starting();
            } else {
                File.file.filekey = ctx.n.key
                File.file.response = ctx.n.h
                File.file.faid = ctx.n.fa
                File.file.path = ctx.uq.path
                File.file.name = ctx.uq.name
                File.file.done_starting();
                ul_finalize(File.file)
            }
        }
    });
}

function ul_Identical(target, path, hash, size) {
    if (!target || !path) return false;
    var p = path.split('/');
    var n = M.d[target];
    for (var i in p) {
        if (!n) return false;
        var foldername = p[i];
        var h = n.h;
        n = false;
        for (var j in M.c[h]) {
            if (M.d[j] && M.d[j].name == foldername) {
                if (M.d[j].t) n = M.d[j];
                else if (p.length == parseInt(i) + 1 && (hash == M.d[j].hash || size == M.d[j].s)) return M.d[j];
            }
        }
    }
    return false;
}
/* }}} */
/**
 *	Check if the network is up!
 *
 *	This function is called when an error happen at the upload
 *	stage *and* it is anything *but* network issue.
 */

function network_error_check() {
    var i = 0,
        ul = {
            error: 0,
            retries: 0
        },
        dl = {
            error: 0,
            retries: 0
        }
    for (i = 0; i < dl_queue.length; i++) {
        if (dl_queue[i] && dl_queue[i].dl_failed) {
            if (d) console.log('Failed download:', dl_queue[i].zipname || dl_queue[i].n, 'Retries: ' + dl_queue[i].retries, dl_queue[i].zipid);
            dl.retries += dl_queue[i].retries
            if (dl_queue[i].retries++ == 5) {
                /**
                 *	The user has internet yet the download keeps failing
                 *	we request the server a new download url but unlike in upload
                 *	this is fine because we resume the download
                 */
                DownloadManager.newUrl(dl_queue[i]);
                dl.retries = 0;
            }
            dl.error++
        }
    }
    for (i = 0; i < ul_queue.length; i++) {
        if (ul_queue[i] && ul_queue[i].ul_failed) {
            ul.retries += ul_queue[i].retries
            if (ul_queue[i].retries++ == 10) {
                /**
                 *	Worst case ever. The client has internet *but*
                 *	this upload keeps failing in the last 10 minutes.
                 *
                 *	We request a new upload URL to the server, and the upload
                 *	starts from scratch
                 */
                ERRDEBUG('restarting because it failed', ul_queue[i].retries, 'times', ul);
                UploadManager.restart(ul_queue[i], 'network_error_check');
                ul_queue[i].retries = 0;
            }
            ul.error++;
        }
    }
    /**
     *	Check for error on upload and downloads
     *
     *	If we have many errors (average of 3 errors)
     *	we try to shrink the number of connections to the
     *	server to see if that fixes the problem
     */

    $([ul,
        dl
    ]).each(function(i, k) {
        var ratio = k.retries / k.error
        if (ratio > 0 && ratio % 8 == 0) {
            // if we're failing in average for the 3rd time,
            // lets shrink our upload queue size
            ERRDEBUG('shrinking: ' + (k == ul ? 'ul' : 'dl'))
            var queue = (k == ul ? ulQueue : dlQueue)
            queue.shrink();
        }
    });
}
var UploadManager = {
    GetGID: function UM_GetGID(ul) {
        return 'ul_' + ul.id;
    },
    abort: function UM_abort(gid) {
        if (gid === null || Array.isArray(gid)) // all || grp
        {
            this._multiAbort = 1;
            if (gid) gid.forEach(this.abort.bind(this));
            else ul_queue.filter(isQueueActive).forEach(this.abort.bind(this));
            delete this._multiAbort;
            Soon(resetUploadDownload);
        } else {
            if (typeof gid === 'object') gid = this.GetGID(gid);
            else if (gid[0] !== 'u') return;
            var l = ul_queue.length,
                FUs = [];
            while (l--) {
                var ul = ul_queue[l];
                if (gid === this.GetGID(ul)) {
                    if (d) console.log('Aborting ' + gid, ul.name);
                    ul.abort = true;
                    FUs.push([ul.owner,
                        l
                    ]);
                }
            }
            ulQueue.pause(gid);
            ulQueue.filter(gid);
            FUs.map(function(o) {
                var ul = o[0],
                    idx = o[1];
                if (ul) ul.destroy();
                ul_queue[idx] = Object.freeze({});
            });
            if (!this._multiAbort) Soon(resetUploadDownload);
            $('#' + gid).fadeOut('slow', function() {
                $(this).remove()
            });
        }
    },
    restart: function UM_restart(file, reason, xhr) {
        onUploadError(file, 'Upload failed - restarting...', reason, xhr);
        // reschedule
        ulQueue.poke(file);
    },
    retry: function UM_retry(file, chunk, reason, xhr) {
        var start = chunk.start,
            end = chunk.end,
            cid = '' + chunk;
        file.ul_failed = true;
        api_reportfailure(hostname(file.posturl), network_error_check);
        // reschedule
        ulQueue.pause(); // Hmm..
        if (!file.__umRetries) file.__umRetries = 1;
        if (!file.__umRetryTimer) file.__umRetryTimer = {};
        var tid = ++file.__umRetries;
        file.__umRetryTimer[tid] = setTimeout(function() {
            var q = file.__umRetryTimer || {};
            delete q[tid];
            if (reason.indexOf('IO failed') == -1) tid = --file.__umRetries;
            if (tid < 34) {
                var newTask = new ChunkUpload(file, start, end);
                ulQueue.pushFirst(newTask);
            } else {
                if (d) console.error('Too many retries for ' + cid);
                msgDialog('warninga', l[1309], l[1498] + ': ' + file.name, reason);
                UploadManager.abort(file);
            }
            if (!$.len(q)) {
                delete file.__umRetryTimer;
                ulQueue.resume();
            }
        }, 950 + Math.floor(Math.random() * 2000))
        onUploadError(file, 'Upload failed - retrying', reason.substr(0, 2) == 'IO' ? 'IO Failed' : reason, xhr);
        chunk.done(); /* release worker */
    },
    isReady: function UM_isReady(Task) /* unused */ {
        return !Task.file.paused || Task.__retry;
    }
};

function ul_get_posturl(File) {
    return function(res, ctx) {
        delete ul_queue[ctx.reqindex].posturl; /* reset in case of a retry */
        if (typeof res == 'object') {
            if (typeof res.p == 'string' && res.p.length > 0) {
                ul_queue[ctx.reqindex].posturl = res.p;
            }
        }
        if (ctx.reqindex == File.ul.pos) {
            if (ul_queue[ctx.reqindex].posturl) {
                ul_upload(File);
            } else {
                /* retry */
                ul_start(File);
            }
        }
    };
}

function ul_upload(File) {
    var i,
        file = File.file
    if (file.repair) {
        var ul_key = file.repair;
        file.ul_key = [
            ul_key[0] ^ ul_key[4],
            ul_key[1] ^ ul_key[5],
            ul_key[2] ^ ul_key[6],
            ul_key[3] ^ ul_key[7],
            ul_key[4],
            ul_key[5]
        ]
    } else if (!file.ul_key) {
        file.ul_key = Array(6);
        // generate ul_key and nonce
        for (i = 6; i--;) file.ul_key[i] = rand(4294967296);
    }
    file.ul_keyNonce = JSON.stringify(file.ul_key)
    file.ul_macs = []
    file.totalbytessent = 0
    file.ul_readq = []
    file.ul_plainq = {}
    file.ul_intransit = 0
    file.ul_inflight = {}
    file.ul_sendchunks = {};
    file.ul_aes = new sjcl.cipher.aes([
        file.ul_key[0],
        file.ul_key[1],
        file.ul_key[2],
        file.ul_key[3]
    ]);
    if (file.size) {
        var pp,
            p = 0,
            tasks = {}
        for (i = 1; i <= 8 && p < file.size - i * ul_block_size; i++) {
            tasks[p] = new ChunkUpload(file, p, i * ul_block_size);
            pp = p;
            p += i * ul_block_size
        }
        while (p < file.size) {
            tasks[p] = new ChunkUpload(file, p, ul_block_extra_size);
            pp = p;
            p += ul_block_extra_size
        }
        if (file.size - pp > 0) {
            tasks[pp] = new ChunkUpload(file, pp, file.size - pp)
        }
        // if (d) console.log('ulTasks', tasks);

        Object.keys(tasks).reverse().forEach(function(s) {
            ulQueue.pushFirst(tasks[s]);
        });
    } else {
        ulQueue.pushFirst(new ChunkUpload(file, 0, 0));
    }
    var isi = have_ab && !file.faid && is_image(file.name);
    if (isi) {
        file.faid = ++ul_faid;
        createthumbnail(file, file.ul_aes, ul_faid, null, null, {
            raw: isi != 1 && isi
        });
    }
    onUploadStart(file);
    file.done_starting();
}

function ul_start(File) {
    if (File.file.posturl) return ul_upload(File);
    var maxpf = 128 * 1048576,
        next = ul_get_posturl(File),
        total = 0,
        len = ul_queue.length,
        max = File.file.pos + 8
        /* CPU INTENSIVE
	$.each(ul_queue, function(i, cfile) {
		if (i < File.file.pos || cfile.posturl) return; // continue
		if (i >= File.file.pos+8 || maxpf <= 0) return false; // break
		api_req({
			a : 'u',
			ssl : use_ssl,
			ms : ul_maxSpeed,
			s : cfile.size,
			r : cfile.retries,
			e : cfile.ul_lastreason
		}, { reqindex : i, callback : next });
		maxpf -= cfile.size
		total++;
	});
	*/
    for (var i = File.file.pos; i < len && i < max && maxpf > 0; i++) {
        var cfile = ul_queue[i];
        if (!isQueueActive(cfile)) continue;
        api_req({
            a: 'u',
            ssl: use_ssl,
            ms: ul_maxSpeed,
            s: cfile.size,
            r: cfile.retries,
            e: cfile.ul_lastreason
        }, {
            reqindex: i,
            callback: next
        });
        maxpf -= cfile.size
        total++;
    }
    DEBUG2('request urls for ', total, ' files')
}

function ChunkUpload(file, start, end) {
    this.file = file;
    this.ul = file;
    this.start = start;
    this.end = end;
    this.gid = file.owner.gid;
    this.xid = this.gid + '_' + start + '-' + end;
    this.jid = (Math.random() * Date.now()).toString(36);
    this[this.gid] = !0;
    // if (d) console.log('Creating ' + this);
}
ChunkUpload.prototype.toString = function() {
    return '[ChunkUpload ' + this.xid + '$' + this.jid + ']';
};
ChunkUpload.prototype.destroy = function() {
    // if (d) console.log('Destroying ' + this);
    this.abort();
    oDestroy(this);
};
ChunkUpload.prototype.updateprogress = function() {
    if (this.file.paused || this.file.complete || ui_paused) return;
    var tp = this.file.sent || 0,
        p = this.file.progress;
    for (var i in p) tp += p[i];
    // only start measuring progress once the TCP buffers are filled
    // (assumes a modern TCP stack with a large intial window)
    if (!this.file.speedometer && this.file.progressevents > 5) this.file.speedometer = bucketspeedometer(tp);
    this.file.progressevents = (this.file.progressevents || 0) + 1;
    onUploadProgress(this.file, Math.floor(tp / this.file.size * 100), tp, this.file.size, GlobalProgress[this.gid].speed = (this.file.speedometer ? this.file.speedometer.progress(tp) : 0) // speed
    );
    if (tp == this.file.size) this.file.complete = true;
};
ChunkUpload.prototype.abort = function() {
    if (this.oet) clearTimeout(this.oet);
    if (this.xhr) this.xhr.xhr_cleanup(40958);
    if (GlobalProgress[this.gid]) removeValue(GlobalProgress[this.gid].working, this, 1);
    else if (d) console.error('This should not be reached twice or after FileUpload destroy...');
    delete this.xhr;
};
ChunkUpload.prototype.on_upload_progress = function(args, xhr) {
    if (!this.file || !this.file.progress || this.file.abort)
        return this.done && this.done();
    this.file.progress[this.start] = args[0].loaded
    this.updateprogress();
};
ChunkUpload.prototype.on_error = function(args, xhr, reason) {
    if (this.file && !this.file.abort && this.file.progress) {
        this.file.progress[this.start] = 0;
        this.updateprogress();
        if (!xhr) xhr = this.xhr;
        if (args == EKEY) UploadManager.restart(this.file, reason, xhr);
        else UploadManager.retry(this.file, this, 'xhr failed: ' + reason, xhr);
    }
    this.done();
}
ChunkUpload.prototype.on_ready = function(args, xhr) {
    if (!this.file || !this.file.progress) {
        if (d) console.error('Upload aborted... ' + this, this);
        return Soon(this.done.bind(this));
    }
    if (xhr.status == 200 && typeof xhr.response == 'string' && xhr.statusText == 'OK') {
        var response = xhr.response
        if (response.length > 27) {
            response = base64urldecode(response);
        }
        if (!response.length || response == 'OK' || response.length == 27) {
            this.file.sent += this.bytes.buffer.length || this.bytes.length;
            delete this.file.progress[this.start];
            this.updateprogress();
            if (response.length == 27) {
                var t = [],
                    ul_key = this.file.ul_key
                for (p in this.file.ul_macs) t.push(p);
                t.sort(function(a, b) {
                    return parseInt(a) - parseInt(b)
                });
                for (var i = 0; i < t.length; i++) t[i] = this.file.ul_macs[t[i]];
                var mac = condenseMacs(t, this.file.ul_key);
                var filekey = [
                    ul_key[0] ^ ul_key[4],
                    ul_key[1] ^ ul_key[5],
                    ul_key[2] ^ mac[0] ^ mac[1],
                    ul_key[3] ^ mac[2] ^ mac[3],
                    ul_key[4],
                    ul_key[5],
                    mac[0] ^ mac[1],
                    mac[2] ^ mac[3]
                ];
                if (u_k_aes && !this.file.ul_completing) {
                    // var ctx = {
                    // file: this.file,
                    // size: this.file.size,
                    // ul_queue_num : this.file.pos,
                    // callback : ul_completepending2,
                    // faid : this.file.faid
                    // };
                    //api_completeupload(response, ul_queue[file.id], filekey,ctx);
                    this.file.ul_completing = true;
                    this.file.filekey = filekey
                    this.file.response = base64urlencode(response)
                    ul_finalize(this.file);
                } else {
                    ASSERT(0, 'BUG: Assigning to file.completion which is unused.');
                    this.file.completion.push([
                        response.url,
                        this.file,
                        filekey,
                        this.file.id
                    ]);
                }
            }
            this.bytes = null;
            this.file.retries = 0; /* reset error flag */
            return this.done();
        } else {
            ASSERT(0, 'Invalid upload response: ' + response);
            if (response != EKEY) return this.on_error(EKEY, null, 'EKEY error')
        }
    }
    this.srverr = xhr.status + 1;
    if (d) console.log(this + ' bad response from server', xhr.status, this.file.name, typeof xhr.response == 'string', xhr.statusText);
    this.oet = setTimeout(this.on_error.bind(this, null, xhr, 'BRFS [l:' + (xhr.response ? xhr.response.length : 'Unk') + ']'), 1950 + Math.floor(Math.random() * 2000));
}
ChunkUpload.prototype.upload = function() {
    if (!this.file) {
        if (d) console.error('This upload was cancelled while the Encrypter was working, prevent this aborting it beforehand');
        return;
    }
    if (!this.file.posturl) {
        onUploadError(this.file, 'Internal error (0xBADF001)');
        if (!this.file.abort) ASSERT(0, 'No PostURL! ' + (typeof this.file.posturl));
        return
    }
    var xhr = getXhr(this);
    xhr._murl = this.file.posturl;
    if (d) console.log('pushing', this.file.posturl + this.suffix)
    if (chromehack) {
        var data8 = new Uint8Array(this.bytes.buffer);
        var send8 = new Uint8Array(this.bytes.buffer, 0, data8.length);
        send8.set(data8);
        var t = this.file.posturl.lastIndexOf('/ul/');
        xhr.open('POST', this.file.posturl.substr(0, t + 1));
        xhr.setRequestHeader('MEGA-Chrome-Antileak', this.file.posturl.substr(t) + this.suffix);
        xhr.send(send8);
    } else {
        xhr.open('POST', this.file.posturl + this.suffix);
        xhr.send(this.bytes.buffer);
    }
    this.xhr = xhr;
};
ChunkUpload.prototype.io_ready = function(task, args) {
    if (args[0] || !this.file || !this.file.ul_keyNonce) {
        if (this.file) {
            if (d) console.error('UL IO Error', args[0]);
            if (this.file.done_starting) this.file.done_starting();
            UploadManager.retry(this.file, this, 'IO failed: ' + args[0]);
        } else {
            if (d) console.error('The FileReader finished, but this upload was cancelled...');
        }
    } else {
        var task = [
            this,
            this.file.ul_keyNonce,
            this.start / 16,
            this.bytes
        ];
        // TODO: Modify CreateWorkers() and use this gid to terminate over cancelled uploads
        task[this.gid] = 1;
        Encrypter.push(task, this.upload, this);
    }
    this.bytes = null;
};
ChunkUpload.prototype.done = function(ee) {
    if (d) console.log(this + '.done');
    if (this._done) {
        /* release worker */
        this._done();
        /* clean up references */
        this.destroy();
    }
};
ChunkUpload.prototype.run = function(done) {
    this._done = done;
    this.file.ul_reader.push(this, this.io_ready, this);
    GlobalProgress[this.gid].working.push(this);
};

function FileUpload(file) {
    this.file = file;
    this.ul = file;
    this.gid = 'ul_' + this.ul.id;
    this[this.gid] = !0;
    GlobalProgress[this.gid] = {
        working: []
    };
}
FileUpload.prototype.toString = function() {
    return '[FileUpload ' + this.gid + ']';
};
FileUpload.prototype.destroy = function() {
    if (d) console.log('Destroying ' + this);
    if (!this.file) return;
    // Hmm, looks like there are more ChunkUploads than what we really upload (!?)
    if (d) ASSERT(GlobalProgress[this.gid].working.length === 0, 'Huh, there are working upload chunks?..');
    if (is_chrome_firefox && this.file._close) {
        this.file._close();
    }
    ASSERT(this.file.owner === this, 'Invalid FileUpload Owner...');
    ulQueue.poke(this.file, 57005);
    if (this.file.done_starting) Soon(this.file.done_starting);
    delete GlobalProgress[this.gid];
    oDestroy(this.file);
    oDestroy(this);
};
FileUpload.prototype.run = function(done) {
    var file = this.file,
        self = this
    file.abort = false; /* fix in case it restarts from scratch */
    file.ul_failed = false;
    file.retries = 0;
    file.xr = getxr();
    file.ul_lastreason = file.ul_lastreason || 0
    if (start_uploading || $('#ul_' + file.id).length == 0) {
        done();
        ASSERT(0, 'This shouldn\'t happen');
        return ulQueue.pushFirst(this);
    }
    if (!GlobalProgress[this.gid].started) {
        GlobalProgress[this.gid].started = true;
    }
    if (d) console.log(file.name, 'starting upload', file.id)
    start_uploading = true;
    var started = false;
    file.done_starting = function() {
        if (started) return;
        started = true;
        start_uploading = false;
        delete file.done_starting;
        file = self = undefined;
        done();
    };
    try {
        if (file.hash && file.ts) throw 'The fingerprint exists already.';
        fingerprint(file, function(hash, ts) {
            file.hash = hash;
            file.ts = ts;
            var identical = ul_Identical(file.target, file.path || file.name, file.hash, file.size);
            DEBUG(file.name, 'fingerprint', M.h[hash] || identical)
            if (M.h[hash] || identical) ul_deduplicate(self, identical);
            else ul_start(self);
        });
    } catch (e) {
        if (d) console.error('FINGERPRINT ERROR', file.name, e.message || e);
        if (!is_extension && e.result === 2152857621 && file.size === 0) {
            var msg =
                'Sorry, upload failed. ' +
                'If you were trying to upload a folder, ' +
                'please note you will need to use our extension for this to work.';
            Later(firefoxDialog);
            msgDialog('warninga', str_mtrunc(file.name, 40), msg, l[1677] + ': ' + (e.message || e.name || e));
            UploadManager.abort(file);
            this.destroy();
        } else ul_start(this);
    }
};
UploadQueue.prototype.push = function() {
    var pos = Array.prototype.push.apply(this, arguments) - 1,
        file = this[pos]
    file.pos = pos;
    ulQueue.poke(file);
    return pos + 1;
};
/**
 *	Wrap fm_requestfolderid to make it parallel friendly
 */
var Mkdir = Parallel(function(args, next) {
    fm_requestfolderid(args[0], args[1], {
        callback: function(ctx, h) {
            next(h);
        }
    });
});

function ul_cancel() {
    UploadManager.abort(null);
}

function ul_finalize(file) {
    var p
    DEBUG(file.name, 'ul_finalize')
    if (is_chrome_firefox && file._close) file._close();
    if (file.repair) file.target = M.RubbishID;
    var dirs = (file.path || '').split(/\//g).filter(function(a) {
        return a.length > 0;
    })
    if (dirs.length > 0 && dirs[dirs.length - 1] == file.name) {
        dirs.pop();
    }
    ASSERT(file.filekey, '*** filekey is missing ***');
    Cascade(dirs, Mkdir, function(dir) {
        var body = {
            n: file.name
        }
        if (file.hash) body.c = file.hash
        var ea = enc_attr(body, file.filekey)
        var faid = file.faid ? api_getfa(file.faid) : false
        var req = {
            a: 'p',
            t: dir,
            n: [{
                h: file.response,
                t: 0,
                a: ab_to_base64(ea[0]),
                k: a32_to_base64(encrypt_key(u_k_aes, file.filekey))
            }],
            i: requesti
        };
        if (faid) req.n[0].fa = faid;
        if (dir) {
            var sn = fm_getsharenodes(dir);
            if (sn.length) {
                req.cr = crypto_makecr([file.filekey], sn, false);
                req.cr[1][0] = file.response;
            }
        }
        DEBUG(file.name, 'save to dir', dir, req)
        api_req(req, {
            target: dir,
            ul_queue_num: file.pos,
            size: file.size,
            faid: file.faid,
            file: file,
            callback: ul_completepending2
        });
    }, file.target || M.RootID);
}

function ul_filereader(fs, file) {
    var handler;
    if (is_chrome_firefox && 'u8' in file) {
        if (d) console.log('Using Firefox ulReader');
        handler = function ulReader(task, done) {
            var error = null;
            try {
                task.bytes = file.u8(task.start, task.end);
            } catch (e) {
                error = e;
            }
            Soon(function() {
                done(error)
            })
        };
    }
    if (!handler) handler = function(task, done) {
        var end = task.start + task.end,
            blob;
        fs.pos = task.start;
        fs.onerror = function(evt) {
            done(new Error(evt));
            done = null;
        };
        fs.onloadend = function(evt) {
            if (done) {
                var target = evt.target,
                    error = true;
                if (target.readyState == FileReader.DONE) {
                    if (target.result instanceof ArrayBuffer) {
                        try {
                            task.bytes = new Uint8Array(target.result);
                            error = null;
                        } catch (e) {
                            console.error(e);
                            error = e;
                        }
                    }
                }
                done(error);
            }
            blob = undefined;
        };
        try {
            if (file.slice || file.mozSlice) {
                if (file.slice) blob = file.slice(task.start, end);
                else blob = file.mozSlice(task.start, end);
                xhr_supports_typed_arrays = true;
            } else {
                blob = file.webkitSlice(task.start, end);
            }
            fs.readAsArrayBuffer(blob);
        } catch (e) {
            console.error(e);
            done(e);
            done = null;
        }
    };
    return new MegaQueue(handler, 1);
}

function worker_uploader(task, done) {
    if (d && d > 1) console.log('worker_uploader', task, done);
    task.run(done);
}
var ul_queue = new UploadQueue,
    ul_maxSlots = readLocalStorage('ul_maxSlots', 'int', {
        min: 1,
        max: 6,
        def: 4
    }),
    Encrypter, ulQueue = new TransferQueue(worker_uploader, ul_maxSlots),
    ul_skipIdentical = 0,
    start_uploading = false,
    ul_maxSpeed = 0,
    ul_faid = 0,
    ul_block_size = 131072,
    ul_block_extra_size = 1048576,
    uldl_hold = false,
    ul_dom = []
Encrypter = CreateWorkers('encrypter.js', function(context, e, done) {
    var file = context.file
    if (!file || !file.ul_macs) {
        // TODO: This upload was cancelled, we should terminate the worker rather than waiting
        if (d) console.error('This upload was cancelled, we should terminate the worker rather than waiting');
        return typeof e.data == 'string' || done();
    }
    if (typeof e.data == 'string') {
        if (e.data[0] == '[') file.ul_macs[context.start] = JSON.parse(e.data);
        else DEBUG('WORKER:', e.data);
    } else {
        context.bytes = new Uint8Array(e.data.buffer || e.data);
        context.suffix = '/' + context.start + '?c=' + base64urlencode(chksum(context.bytes.buffer));
        done();
    }
}, 4);

function isQueueActive(q) {
    return typeof q.id !== 'undefined';
}

function resetUploadDownload() {
    if (!ul_queue.some(isQueueActive)) {
        ul_queue = new UploadQueue();
        ul_uploading = false;
    }
    if (!dl_queue.some(isQueueActive)) {
        dl_queue = new DownloadQueue();
        downloading = false;
    }
    if (!downloading && !ul_uploading) {
        clearXhr(); /* destroy all xhr */
        panelDomQueue = [];
        GlobalProgress = {};
        delete $.transferprogress;
        if ($.transferClose) $.transferClose(); /* in case it isn't closed already.. */
        if ($.mTransferAnalysis) {
            clearInterval($.mTransferAnalysis);
            delete $.mTransferAnalysis;
        }
    }
    if (d) console.log('resetUploadDownload', ul_queue.length, dl_queue.length);
    Later(percent_megatitle);
}
if (localStorage.ul_skipIdentical) ul_skipIdentical = parseInt(localStorage.ul_skipIdentical);
ulQueue.poke = function(file, meth) {
    if (file.owner) {
        var gid = UploadManager.GetGID(file);
        file.retries = 0;
        file.sent = 0;
        file.progress = {};
        file.posturl = '';
        file.completion = [];
        file.abort = true;
        ulQueue.pause(gid);
        ulQueue.filter(gid);
        if (file.__umRetryTimer) {
            var t = file.__umRetryTimer;
            for (var i in t) clearTimeout(t[i]);
            ulQueue.resume();
        }
        if (file.ul_reader) {
            file.ul_reader.filter(gid);
            file.ul_reader.destroy();
        }
        if (!meth) meth = 'pushFirst';
        delete file.__umRetries;
        delete file.__umRetryTimer;
    }
    if (meth != 57005) {
        file.sent = 0;
        file.progress = {};
        file.completion = [];
        file.owner = new FileUpload(file);
        file.ul_reader = ul_filereader(new FileReader, file);
        ulQueue[meth || 'push'](file.owner);
    }
};
ulQueue.validateTask = function(pzTask) {
    if (pzTask instanceof ChunkUpload && (!pzTask.file.paused || pzTask.__retry)) {
        return true;
    }
    if (pzTask instanceof FileUpload && !start_uploading && $('#ul_' + pzTask.file.id).length != 0) {
        return true;
    }
    return false;
};
if (localStorage.ul_maxSpeed) ul_maxSpeed = parseInt(localStorage.ul_maxSpeed);
if (localStorage.ul_skipIdentical) {
    ul_skipIdentical = parseInt(localStorage.ul_skipIdentical);
}
var dlid = false;
var dlkey = false;
var cn_url = false;
var init_l = true;
var pfkey = false;
var pfid = false;
var n_h = false;
var n_k_aes = false;
var fmdirid = false;
var u_type, cur_page, u_checked
var confirmcode = false;
var confirmok = false;
var hash = window.location.hash;
var chrome_msg = false;
var init_anoupload = false;
var blogid = false;
var pwchangecode = false;
var resetpwcode = false;
var resetpwemail = '';
var mobileparsed = false;
var mobilekeygen = false;
var subdirid = false;
var subsubdirid = false;
var notifications;
var account = false;
var register_txt = false;
var login_next = false;
var loggedout = false;
var pro_json = '[[["N02zLAiWqRU",1,500,1024,1,"9.99","EUR"],["zqdkqTtOtGc",1,500,1024,12,"99.99","EUR"],["j-r9sea9qW4",2,2048,4096,1,"19.99","EUR"],["990PKO93JQU",2,2048,4096,12,"199.99","EUR"],["bG-i_SoVUd0",3,4096,8182,1,"29.99","EUR"],["e4dkakbTRWQ",3,4096,8182,12,"299.99","EUR"]]]';

function startMega() {
    if (silent_loading) {
        silent_loading();
        jsl = [];
        silent_loading = false;
        return false;
    } else populate_l();
    if (pages['dialogs']) {
        $('body').append(translate(pages['dialogs'].replace(/{staticpath}/g, staticpath)));
        delete pages['dialogs'];
    }
    jsl = [];
    init_page();
}

function mainScroll() {
    $('.main-scroll-block').jScrollPane({
        showArrows: true,
        arrowSize: 5,
        animateScroll: true,
        verticalDragMinHeight: 150,
        enableKeyboardNavigation: true
    });
    $('.main-scroll-block').unbind('jsp-scroll-y');
    jScrollFade('.main-scroll-block');
    if (page == 'doc' || page.substr(0, 4) == 'help') scrollMenu();
}

function scrollMenu() {
    $('.main-scroll-block').bind('jsp-scroll-y', function(event, scrollPositionY, isAtTop, isAtBottom) {
        if (page == 'doc' || page.substr(0, 4) == 'help') {
            var sc = scrollPositionY - 30;
            if (isAtTop) sc = 30;
            if ($('.main-scroll-block .jspPane').height() - sc - $('.new-left-menu-block').height() - $('.nw-bottom-block').height() - 100 < 0) sc = $('.main-scroll-block .jspPane').height() - $('.new-left-menu-block').height() - $('.nw-bottom-block').height() - 100;
            $('.new-left-menu-block').css('padding-top', sc + 'px');
        }
    });
}

function init_page() {
    closeDialog();
    if ('-fa-ar-he-'.indexOf('-' + lang + '-') > -1) $('body').addClass('rtl');
    if ($.startscroll) delete $.startscroll;
    if ($.dlscroll) delete $.dlscroll
    if ($.infoscroll) delete $.infoscroll;
    if (page == 'plugin') {
        if (navigator.userAgent.toLowerCase().indexOf('firefox') > -1) page = 'firefox';
        else page = 'chrome';
    } else if (page == 'notifications') page = 'fm/notifications';
    if (localStorage.signupcode && u_type !== false) delete localStorage.signupcode;
    else if (localStorage.signupcode && page.substr(0, 6) !== 'signup' && page !== 'register' && page !== 'terms' && page !== 'privacy' && page !== 'chrome' && page !== 'firefox') {
        register_txt = l[1291];
        document.location.hash = 'signup' + localStorage.signupcode;
        return false;
    }
    $('.top-head').remove();
    $('#loading').hide();
    if (loadingDialog) loadingDialog.hide();
    page = page.replace('%21', '!').replace('%21', '!');
    if (page.substr(0, 1) == '!' && page.length > 1) {
        dlkey = false;
        var ar = page.substr(1, page.length - 1).split('!');
        if (ar[0]) dlid = ar[0].replace(/[^a-z^A-Z^0-9^_^-]/g, '');
        if (ar[1]) dlkey = ar[1].replace(/[^a-z^A-Z^0-9^_^-]/g, '');
    }
    if (page.substr(0, 2) == 'F!' && page.length > 2) {
        var ar = page.substr(2, page.length - 1).split('!');
        if (ar[0]) pfid = ar[0].replace(/[^a-z^A-Z^0-9^_^-]/g, '');
        if (ar[1]) pfkey = ar[1].replace(/[^a-z^A-Z^0-9^_^-]/g, '');
        n_h = pfid;
        api_setfolder(n_h);
        if (waitxhr) waitsc();
        u_n = pfid;
        page = 'fm';
    } else {
        n_h = false;
        if (u_sid) {
            api_setsid(u_sid);
            if (waitxhr) waitsc();
        }
        u_n = false;
        pfkey = false;
        pfid = false;
    }
    confirmcode = false;
    pwchangecode = false;
    if (page.substr(0, 7) == 'confirm') {
        confirmcode = page.replace('confirm', '');
        page = 'confirm';
    }
    if (page.substr(0, 7) == 'pwreset') {
        resetpwcode = page.replace('pwreset', '');
        page = 'resetpassword';
    }
    if (page.substr(0, 5) == 'newpw') {
        pwchangecode = page.replace('newpw', '');
        page = 'newpw';
    }
    blogmonth = false;
    blogsearch = false;
    if (page.substr(0, 7) == 'voucher') {
        loadingDialog.show();
        var vouchercode = page.substr(7, page.length - 7);
        api_req({
            a: 'uavq',
            v: vouchercode
        }, {
            callback: function(res) {
                if (typeof res == 'number') {
                    document.location.hash = '';
                    return false;
                } else if (res && !res[3]) {
                    msgDialog('warninga', 'Invalid URL', 'Did you already activate your Pro membership? Please log in to your account.', false, function() {
                        document.location.hash = 'login';
                    });
                    return false;
                } else if (res[0] == 'vGuzSLMU7WA') slingshotDialog();
                localStorage.voucher = page.replace('voucher', '');
                if (!u_type) {
                    if (u_wasloggedin()) {
                        login_txt = l[1040];
                        document.location.hash = 'login';
                    } else {
                        register_txt = l[1041];
                        document.location.hash = 'register';
                    }
                } else document.location.hash = 'fm/account';
            }
        });
        return false;
    }
    if (localStorage.voucher && u_type !== false) {
        api_req({
            a: 'uavr',
            v: localStorage.voucher
        }, {
            callback: function(res) {
                if (typeof res != 'number' || res >= 0) balance2pro();
            }
        });
        delete localStorage.voucher;
    }
    if (page.substr(0, 10) == 'blogsearch') {
        blogsearch = decodeURIComponent(page.substr(11, page.length - 2));
        if (!blogsearch) document.location.hash = 'blog';
        page = 'blog';
    } else if (page.substr(0, 4) == 'blog' && page.length > 4 && page.length < 10) {
        blogid = page.substr(5, page.length - 2);
        page = 'blogarticle';
    } else if (page.substr(0, 4) == 'blog' && page.length > 4) {
        blogmonth = page.substr(5, page.length - 2);
        page = 'blog';
    }
    if (page.substr(0, 6) == 'signup') {
        var signupcode = page.substr(6, page.length - 1);
        loadingDialog.show();
        api_req({
            a: 'uv',
            c: signupcode
        }, {
            callback: function(res) {
                loadingDialog.hide();
                if (typeof res == 'number' && res < 0) {
                    if (localStorage.signupcode) {
                        delete localStorage.signupcode;
                        delete localStorage.registeremail;
                    } else msgDialog('warningb', l[135], l[1290]);
                    document.location.hash = 'start';
                } else if (u_type === false) {
                    localStorage.signupcode = signupcode;
                    localStorage.registeremail = res;
                    document.location.hash = 'register';
                    if (!register_txt) register_txt = l[1289];
                } else {
                    var confirmtxt = 'You are currently logged in. Would you like to log out and register a new account?';
                    if (l[1824]) confirmtxt = l[1824];
                    msgDialog('confirmation', l[968], confirmtxt, '', function(e) {
                        if (e) mLogout();
                        else document.location.hash = '';
                    });
                }
            }
        });
    } else if (page == 'newpw') {
        setpwset(pwchangecode, {
            callback: function(res) {
                loadingDialog.hide();
                if (res[0] == EACCESS || res[0] == 0) alert(l[727]);
                else if (res[0] == EEXPIRED) alert(l[728]);
                else if (res[0] == ENOENT) alert(l[729]);
                else alert(l[200]);
                if (u_type == 3) {
                    page = 'account';
                    parsepage(pages['account']);
                    load_acc();
                } else {
                    page = 'login';
                    parsepage(pages['login']);
                    init_login();
                }
            }
        });
    } else if (page == 'confirm') {
        loadingDialog.show();
        var ctx = {
            signupcodeok: function(email, name) {
                loadingDialog.hide();
                confirmok = true;
                page = 'login';
                parsepage(pages['login']);
                login_txt = l[378];
                init_login();
                $('#login-name2').val(email);
                $('.register-st2-button').addClass('active');
                $('#login-name2').attr('readonly', true);
                topmenuUI();
            },
            signupcodebad: function(res) {
                loadingDialog.hide();
                if (res == EINCOMPLETE) alert(l[703]);
                else if (res == ENOENT) login_txt = l[704];
                else alert(l[705] + res);
                page = 'login';
                parsepage(pages['login']);
                init_login();
                topmenuUI();
            }
        }
        verifysignupcode(confirmcode, ctx);
    } else if (u_type == 2) {
        parsepage(pages['key']);
        init_key();
    } else if (page == 'login') {
        parsepage(pages['login']);
        init_login();
    } else if (page == 'account') {
        document.location.hash = 'fm/account';
        return false;
    } else if (page == 'register') {
        parsepage(pages['register']);
        init_register();
    } else if (page == 'chrome') {
        parsepage(pages['chrome']);
        var h = 0;
        $('.chrome-bottom-block').each(function(i, e) {
            if ($(e).height() > h) h = $(e).height();
        });
        $('.chrome-bottom-block').height(h);
        if ('-en-'.indexOf('-' + lang + '-') == -1) $('.chrome-download-button').css('font-size', '12px');
        if (!is_extension && typeof chrome !== 'undefined' && !chrome.app.isInstalled) {
            $('.chrome-app-button,.chrome-app-scr').unbind('click');
            $('.chrome-app-button,.chrome-app-scr').bind('click', function() {
                chrome.webstore.install();
                return false;
            });
            $('.chrome-app-scr').css('cursor', 'pointer');
        }
    } else if (page == 'key') {
        parsepage(pages['key']);
        init_key();
    } else if (page == 'contact') {
        parsepage(pages['contact']);
        if (lang == 'ru') $('.account-mid-block').addClass('high');
    } else if (page.substr(0, 4) == 'help') {
        parsepage(pages['help']);
        init_help();
    } else if (page == 'privacy') {
        parsepage(pages['privacy']);
    } else if (page == 'privacycompany') {
        parsepage(pages['privacycompany']);
    } else if (page == 'dev' || page == 'developers') {
        parsepage(pages['dev']);
        dev_init('dev');
    } else if (page == 'doc') {
        parsepage(pages['dev']);
        dev_init('doc');
    } else if (page == 'backup' && !u_type) {
        login_txt = l[1298];
        parsepage(pages['login']);
        init_login();
    } else if (page == 'backup') {
        parsepage(pages['backup']);
        init_backup();
    } else if (page == 'recovery') {
        parsepage(pages['recovery']);
        init_recovery();
    } else if (page.substr(0, 7) == 'recover' && page.length > 25) {
        parsepage(pages['reset']);
        init_reset();
    } else if (page == 'sdkterms') {
        parsepage(pages['sdkterms']);
    } else if (page.substr(0, 3) == 'sdk') {
        parsepage(pages['dev']);
        if (page.length > 3) dev_init('sdk', page.replace('sdk_', ''));
        else dev_init('sdk');
    } else if (page == 'about') {
        parsepage(pages['about']);
        $('.team-person-block').removeClass('first');
        var html = '';
        var a = 4;
        $('.team-person-block').sort(function() {
            return (Math.round(Math.random()) - 0.5)
        }).each(function(i, e) {
            if (a == 4) {
                html += e.outerHTML.replace('team-person-block', 'team-person-block first');
                a = 0;
            } else html += e.outerHTML;
            a++;
        });
        $('#emailp').html($('#emailp').text().replace('jobs@mega.co.nz', '<a href="mailto:jobs@mega.co.nz">jobs@mega.co.nz</a>'));
        $('.new-bottom-pages.about').html(html + '<div class="clear"></div>');
        mainScroll();
    } else if (page == 'terms') {
        parsepage(pages['terms']);
    } else if (page == 'takedown') {
        parsepage(pages['takedown']);
    } else if (page == 'affiliateterms') {
        parsepage(pages['affiliateterms']);
    } else if (page == 'blog') {
        parsepage(pages['blog']);
        init_blog();
    } else if (page == 'blogarticle') {
        parsepage(pages['blogarticle']);
        init_blogarticle();
    } else if (page == 'copyright') {
        parsepage(pages['copyright']);
        $('.reg-st5-complete-button').unbind('click');
        $('.reg-st5-complete-button').bind('click', function(e) {
            document.location.hash = 'copyrightnotice';
        });
        if (lang == 'en') {
            $('#copyright_txt').text($('#copyright_txt').text().split('(i)')[0]);
            $('#copyright_en').removeClass('hidden');
            mainScroll();
        }
    } else if (page.substr(0, 3) == 'pro') {
        parsepage(pages['pro']);
        init_pro();
    } else if (page == 'credits') {
        parsepage(pages['credits']);
        var html = '';
        $('.credits-main-pad a').sort(function() {
            return (Math.round(Math.random()) - 0.5)
        }).each(function(i, e) {
            html += e.outerHTML;
        });
        $('.credits-main-pad').html(html + '<div class="clear"></div>');
    } else if (page == 'firefox') {
        parsepage(pages['firefox']);
        $('.ff-bott-button').unbind('mouseover');
        $('.ff-bott-button').bind('mouseover', function() {
            $('.ff-icon').addClass('hovered');
        });
        $('.ff-bott-button').unbind('mouseout');
        $('.ff-bott-button').bind('mouseout', function() {
            $('.ff-icon').removeClass('hovered');
        });
    } else if (page.substr(0, 4) == 'sync') {
        parsepage(pages['sync']);
        init_sync();
    } else if (page == 'mobile') {
        parsepage(pages['mobile']);
    } else if (page == 'affiliates' && u_attr && u_attr.aff_payment) {
        parsepage(pages['affiliatemember']);
        init_affiliatemember();
    } else if (page == 'affiliates') {
        parsepage(pages['affiliates']);
    } else if (page == 'resellers') {
        parsepage(pages['resellers']);
    } else if (page == 'takedown') {
        parsepage(pages['takedown']);
    } else if (page == 'affiliatesignup' && u_type < 3) {
        if (loggedout) {
            document.location.hash = 'start';
            return false;
        }
        login_txt = l[376];
        parsepage(pages['login']);
        init_login();
    } else if (page == 'affiliatesignup') {
        parsepage(pages['affiliatesignup']);
        init_affiliatesignup();
    } else if (page == 'done') {
        parsepage(pages['done']);
        init_done();
    } else if (page == 'copyrightnotice') {
        parsepage(pages['copyrightnotice']);
        init_cn();
    } else if (dlid) {
        page = 'download';
        parsepage(pages['download'], 'download');
        dlinfo(dlid, dlkey, false);
    } else if (is_fm()) {
        var id = false;
        if (page.substr(0, 2) == 'fm') {
            id = page.replace('fm/', '');
            if (id.length < 5) id = false;
        }
        if (!id && fminitialized) id = M.RootID;
        // switch between FM & folderlinks (completely reinitialize)
        if ((!pfid && folderlink) || (pfid && folderlink === 0)) {
            M.reset();
            folderlink = 0;
            fminitialized = false;
            mDBloaded = {
                'ok': 0,
                'u': 0,
                'f_sk': 0,
                'f': 0,
                's': 0
            };
            notifications = undefined;
        }
        if (!fminitialized) {
            if (id) M.currentdirid = id;
            if (!m && $('#fmholder').html() == '') $('#fmholder').html('<div id="topmenu"></div>' + translate(pages['fm'].replace(/{staticpath}/g, staticpath)));
            if (typeof mDB !== 'undefined' && !pfid) mDBstart();
            else loadfm();
            andreiScripts();
            if (pfid) {
                $('.fm-left-menu .folderlink').removeClass('hidden');
                $('.fm-tree-header.cloud-drive-item span').text(l[808]);
                $('.fm-tree-header').not('.cloud-drive-item').hide();
                $('.fm-menu-item').hide();
            }
        } else if (!pfid && id && id !== M.currentdirid) M.openFolder(id);
        $('#topmenu').html(parsetopmenu());
        $('body').attr('class', '');
        $('#pageholder').hide();
        $('#startholder').hide();
        if ($('#fmholder:visible').length == 0) {
            $('#fmholder').show();
            if (fminitialized) {
                if (M.viewmode == 1) iconUI();
                else gridUI();
                treeUI();
                if ($.transferHeader) $.transferHeader();
            }
        }
        if (fminitialized) {
            if (M.currentdirid == 'account') accountUI();
            else if (M.currentdirid == 'notifications') notificationsUI();
            else if (M.currentdirid == 'search') searchFM();
        }
    } else if (page.substr(0, 2) == 'fm' && !u_type) {
        if (loggedout) {
            document.location.hash = 'start';
            return false;
        }
        login_next = page;
        login_txt = l[1298];
        document.location.hash = 'login';
    } else {
        page = 'start';
        parsepage(pages['start'], 'start');
        init_start();
    }
    topmenuUI();
    loggedout = false;
}
var avatars = {};

function loginDialog(close) {
    if (close) {
        $('.top-login-popup').removeClass('active');
        return false;
    }
    if (localStorage.hideloginwarning || document.location.href.substr(0, 19) == 'chrome-extension://' || is_chrome_firefox) {
        $('.top-login-warning').addClass('hidden');
        $('.login-notification-icon').removeClass('hidden');
    }
    $('.login-checkbox,.top-login-popup .radio-txt').unbind('click');
    $('.login-checkbox,.top-login-popup .radio-txt').bind('click', function(e) {
        var c = $('.login-checkbox').attr('class');
        if (c.indexOf('checkboxOff') > -1) $('.login-checkbox').attr('class', 'login-checkbox checkboxOn');
        else $('.login-checkbox').attr('class', 'login-checkbox checkboxOff');
    });
    $('.top-login-forgot-pass').unbind('click');
    $('.top-login-forgot-pass').bind('click', function(e) {
        document.location.hash = 'recovery';
        loginDialog(1);
    });
    $('.top-dialog-login-button').unbind('click');
    $('.top-dialog-login-button').bind('click', function(e) {
        tooltiplogin();
    });
    $('#login-name').unbind('focus');
    $('#login-name').bind('focus', function(e) {
        if ($(this).val() == l[195]) $(this).val('');
    });
    $('#login-name').unbind('blur');
    $('#login-name').bind('blur', function(e) {
        if ($(this).val() == '') $(this).val(l[195]);
    });
    $('#login-password').unbind('focus');
    $('#login-password').bind('focus', function(e) {
        if ($(this).val() == l[909]) {
            $(this).val('');
            $(this)[0].type = 'password';
        }
    });
    $('#login-password').unbind('blur');
    $('#login-password').bind('blur', function(e) {
        if ($(this).val() == '') {
            $(this).val(l[909]);
            $(this)[0].type = 'text';
        }
    });
    $('.top-login-full').unbind('click');
    $('.top-login-full').bind('click', function(e) {
        loginDialog(1);
        document.location.hash = 'login';
    });
    $('#login-password, #login-name').unbind('keydown');
    $('#login-password, #login-name').bind('keydown', function(e) {
        $('.top-login-pad').removeClass('both-incorrect-inputs');
        $('.top-login-input-tooltip.both-incorrect').removeClass('active');
        $('.top-login-input-block.password').removeClass('incorrect');
        $('.top-login-input-block.e-mail').removeClass('incorrect');
        if (e.keyCode == 13) tooltiplogin();
    });
    $('.top-login-warning-close').unbind('click');
    $('.top-login-warning-close').bind('click', function(e) {
        if ($('.loginwarning-checkbox').attr('class').indexOf('checkboxOn') > -1) localStorage.hideloginwarning = 1;
        $('.top-login-warning').addClass('hidden');
        $('.login-notification-icon').removeClass('hidden');
    });
    $('.login-notification-icon').unbind('click');
    $('.login-notification-icon').bind('click', function(e) {
        $('.top-login-warning').removeClass('hidden');
        $(this).addClass('hidden');
    });
    $('.top-login-input-block').unbind('click');
    $('.top-login-input-block').bind('click', function(e) {
        $(this).find('input').focus();
    });
    $('.loginwarning-checkbox,.top-login-warning .radio-txt').unbind('click');
    $('.loginwarning-checkbox,.top-login-warning .radio-txt').bind('click', function(e) {
        var c = '.loginwarning-checkbox',
            c2 = $(c).attr('class');
        $(c).removeClass('checkboxOn checkboxOff');
        if (c2.indexOf('checkboxOff') > -1) $(c).addClass('checkboxOn');
        else $(c).addClass('checkboxOff');
    });
    $('.top-login-popup').addClass('active');
}

function tooltiplogin() {
    var e = $('#login-name').val();
    if (e == '' || e == l[195] || checkMail(e)) {
        $('.top-login-input-block.e-mail').addClass('incorrect');
        $('#login-name').val('');
        $('#login-name').focus();
    } else if ($('#login-password').val() == '' || $('#login-password').val() == l[909]) $('.top-login-input-block.password').addClass('incorrect');
    else {
        $('.top-dialog-login-button').html('<img alt="" src="' + staticpath + 'images/mega/ajax-loader.gif">');
        $('.top-dialog-login-button').addClass('loading');
        if ($('.loginwarning-checkbox').attr('class').indexOf('checkboxOn') > -1) localStorage.hideloginwarning = 1;
        var remember;
        if ($('.login-checkbox').attr('class').indexOf('checkboxOn') > -1) remember = 1;
        postLogin($('#login-name').val(), $('#login-password').val(), remember, function(r) {
            $('.top-dialog-login-button').html(l[171]);
            $('.top-dialog-login-button').removeClass('loading');
            if (r == EBLOCKED) {
                alert(l[730]);
            } else if (r) {
                u_type = r;
                if (login_next) document.location.hash = login_next;
                else if (page !== 'login') init_page();
                else document.location.hash = 'fm';
                login_next = false;
            } else {
                $('.top-login-pad').addClass('both-incorrect-inputs');
                $('.top-login-input-tooltip.both-incorrect').addClass('active');
                $('#login-password').select();
            }
        });
    }
}

function mLogout() {
    $.dologout = function(Quiet) {
        if ((fminitialized && downloading) || ul_uploading) {
            if (Quiet) return true;
            msgDialog('confirmation', l[967], l[377] + ' ' + l[507] + '?', false, function(e) {
                if (e) {
                    if (downloading) dl_cancel();
                    if (ul_uploading) ul_cancel();
                    resetUploadDownload();
                    loadingDialog.show();
                    var t = setInterval(function() {
                        if (!$.dologout(!0)) {
                            clearInterval(t);
                        }
                    }, 200);
                }
            });
        } else {
            u_logout(1);
            document.location.reload();
        }
    }
    var cnt = 0;
    if (M.c[M.RootID] && u_type === 0)
        for (var i in M.c[M.RootID]) cnt++;
    if (u_type === 0 && cnt > 0) {
        msgDialog('confirmation', l[1057], l[1058], l[1059], function(e) {
            if (e) $.dologout();
        });
    } else $.dologout();
}

function topmenuUI() {
    if (u_type === 0) $('.top-login-button').text(l[967]);
    //$('.cloud-popup-icon').hide();
    $('.warning-popup-icon').addClass('hidden');
    $('.top-menu-item.upgrade-your-account,.context-menu-divider.upgrade-your-account').hide();
    $('.top-menu-item.register,.top-menu-item.login').hide();
    $('.top-menu-item.logout,.context-menu-divider.logout').hide();
    $('.top-menu-item.clouddrive,.top-menu-item.account').hide();
    $('.activity-status,.activity-status-block').hide();
    $('.membership-status').removeClass('free');
    $('.membership-status').hide();
    $('.top-head .user-name').hide();
    if (fminitialized) $('.top-search-bl').show();
    else $('.top-search-bl').hide();
    $('.fm-avatar').hide();
    if (u_type) {
        $('.top-menu-item.logout,.context-menu-divider.logout').show();
        $('.top-menu-item.clouddrive,.top-menu-item.account').show();
        $('.fm-avatar').show();
        if (u_attr.p) {
            $('.membership-icon-pad .membership-icon').attr('class', 'membership-icon pro' + u_attr.p);
            if (u_attr.p == 1) $('.membership-icon-pad .membership-big-txt.red').text('PRO I');
            else if (u_attr.p == 1) $('.membership-icon-pad .membership-big-txt.red').text('PRO II');
            else if (u_attr.p == 1) $('.membership-icon-pad .membership-big-txt.red').text('PRO III');
            $('.membership-status').addClass('pro');
            $('.membership-status').html('PRO');
            $('.membership-popup.pro-popup');
        } else {
            $('.top-menu-item.upgrade-your-account,.context-menu-divider.upgrade-your-account').show();
            $('.membership-status').addClass('free');
            $('.membership-status').html(l[435]);
        }
        $('.membership-status').show();
    } else {
        if (u_type === 0 && !confirmok && page !== 'key') {
            $('.top-menu-item.register').text(l[968]);
            $('.top-menu-item.clouddrive').show();
            $('.warning-popup-icon').removeClass('hidden');
            $('.warning-icon-area').unbind('click');
            $('.warning-icon-area').bind('click', function(e) {
                var c = $('.top-warning-popup').attr('class');
                if (c && c.indexOf('active') > -1) $('.top-warning-popup').removeClass('active');
                else $('.top-warning-popup').addClass('active');
            });
            $('.top-warning-popup').unbind('click');
            $('.top-warning-popup').bind('click', function(e) {
                $('.top-warning-popup').removeClass('active');
                document.location.hash = 'register';
            });
            if (page !== 'register') $('.top-warning-popup').addClass('active');
        }
        $('.top-menu-item.upgrade-your-account').show();
        $('.top-menu-item.upgrade-your-account').text(l[129]);
        $('.membership-status-block').hide();
        $('.create-account-button').show();
        $('.create-account-button').unbind('click');
        $('.create-account-button').bind('click', function() {
            document.location.hash = 'register';
        });
        $('.top-login-button').show();
        $('.top-login-button').unbind('click');
        $('.top-login-button').bind('click', function() {
            if (u_type === 0) mLogout();
            else {
                var c = $('.top-login-popup').attr('class');
                if (c && c.indexOf('active') > -1) loginDialog(1);
                else loginDialog();
            }
        });
        $('.top-menu-item.register,.context-menu-divider.register,.top-menu-item.login').show();
        if (u_type === 0) {
            $('.top-menu-item.login').hide();
            $('.top-menu-item.logout,.context-menu-divider.logout').show();
        }
        $('.top-login-arrow').css('margin-right', $('.top-menu-icon').width() + $('.create-account-button').width() + ($('.top-login-button').width() / 2) + 78 + 'px');
    }
    $('.top-menu-arrow').css('margin-right', $('.top-menu-icon').width() / 2 + 'px');
    $.hideTopMenu = function(e) {
        var c;
        if (e) c = $(e.target).attr('class');
        if (!e || ($(e.target).parents('.membership-popup').length == 0 && ((c && c.indexOf('membership-status') == -1) || !c)) || (c && c.indexOf('membership-button') > -1)) {
            $('.membership-popup').removeClass('active');
            $('.membership-status-block').removeClass('active');
        }
        if (!e || ($(e.target).parents('.top-menu-popup').length == 0 && ((c && c.indexOf('top-menu-icon') == -1) || !c))) {
            $('.top-menu-popup').removeClass('active');
            $('.top-menu-icon').removeClass('active');
        }
        if (!e || ($(e.target).parents('.top-warning-popup').length == 0 && ((c && c.indexOf('warning-icon-area') == -1) || !c))) {
            $('.top-warning-popup').removeClass('active');
        }
        if (!e || ($(e.target).parents('.top-user-status-popup').length == 0 && ((c && c.indexOf('activity-status') == -1) || !c))) {
            $('.top-user-status-popup').removeClass('active');
            $('.activity-status-block').removeClass('active');
        }
        if (!e || ($(e.target).parents('.notification-popup').length == 0 && ((c && c.indexOf('cloud-popup-icon') == -1) || !c))) {
            $('.notification-popup').addClass('hidden');
            $('.cloud-popup-icon').removeClass('active');
        }
        if (!e || ($(e.target).parents('.top-login-popup').length == 0 && ((c && c.indexOf('top-login-button') == -1) || !c))) {
            $('.top-login-popup').removeClass('active');
        }
        if ((!e || $(e.target).parents('.create-new-folder').length == 0) && (!c || c.indexOf('fm-new-folder') == -1)) {
            var c3;
            if (e && e.target) c3 = $(e.target).parent().attr('class');
            if (!c3 || c3.indexOf('fm-new-folder') == -1) $('.fm-new-folder').removeClass('active');
        }
        if ((!e || $(e.target).parents('.fm-add-user,.add-user-popup').length == 0) && (!c || c.indexOf('fm-add-user') == -1)) {
            $('.fm-add-user').removeClass('active');
        }
    }
    $('#pageholder').unbind('click');
    $('#pageholder').bind('click', function(e) {
        $.hideTopMenu(e);
    });
    $('#startholder').unbind('click');
    $('#startholder').bind('click', function(e) {
        $.hideTopMenu(e);
    });
    $('.top-menu-icon').unbind('click');
    $('.top-menu-icon').bind('click', function(e) {
        if ($(this).attr('class').indexOf('active') == -1) {
            $(this).addClass('active');
            $('.top-menu-popup').addClass('active');
        } else {
            $(this).removeClass('active');
            $('.top-menu-popup').removeClass('active');
        }
    });
    $('.activity-status-block').unbind('click');
    $('.activity-status-block').bind('click', function(e) {
        if ($(this).attr('class').indexOf('active') == -1) {
            $(this).addClass('active');
            $('.top-user-status-popup').addClass('active');
        } else {
            $(this).removeClass('active');
            $('.top-user-status-popup').removeClass('active');
        }
    });
    $('.top-user-status-item').unbind('click');
    $('.top-user-status-item').bind('click', function(e) {
        if ($(this).attr('class').indexOf('active') == -1) {
            $('.top-user-status-item').removeClass('active');
            $(this).addClass('active');
            $('.activity-status-block').find('.activity-status').attr('class', $(this).find('.activity-status').attr('class'));
            $('.activity-status-block').removeClass('active');
            $('.top-user-status-popup').removeClass('active');
        }
    });
    $('.membership-status-block').unbind('click');
    $('.membership-status-block').bind('click', function(e) {
        $('.membership-popup .membership-loading').show();
        $('.membership-popup .membership-main-block').hide();
        if ($(this).attr('class').indexOf('active') == -1) {
            $(this).addClass('active');
            if (u_attr.p) $('.pro-popup').addClass('active');
            else $('.free-popup').addClass('active');
            M.accountData(function(account) {
                var perc,
                    warning,
                    perc_c;
                $('.membership-popup .membership-loading').hide();
                $('.membership-popup .membership-main-block').show();
                if (u_attr.p) {
                    $('.membership-popup.pro-popup .membership-icon').addClass('pro' + u_attr.p);
                    $('.membership-popup.pro-popup .membership-icon-txt-bl .membershtip-medium-txt').html(l[987] + ' <span class="red">' + time2date(account.expiry) + '</span>');
                } else {
                    $('.membership-popup .upgrade-account').unbind('click');
                    $('.membership-popup .upgrade-account').bind('click', function() {
                        document.location.hash = 'pro';
                    });
                }
                if (account.balance && account.balance[0] && account.balance[0][0] > 0) $('.membership-popup .membership-price-txt .membership-big-txt').html('&euro; ' + htmlentities(account.balance[0][0]));
                else $('.membership-popup .membership-price-txt .membership-big-txt').html('&euro; 0.00');
                perc = Math.round(account.space_used / account.space * 100);
                perc_c = perc;
                if (perc_c > 100) perc_c = 100;
                $('.membership-popup .membership-circle-bg.blue-circle').attr('class', 'membership-circle-bg blue-circle percents-' + perc_c);
                $('.membership-popup .membership-circle-bg.blue-circle').html(perc + '<span class="membershtip-small-txt">%</span>');
                var b1 = bytesToSize(account.space_used);
                b1 = b1.split(' ');
                b1[0] = Math.round(b1[0]) + ' ';
                var b2 = bytesToSize(account.space);
                b2 = b2.split(' ');
                b2[0] = Math.round(b2[0]) + ' ';
                warning = '';
                if (perc > 99) warning = '<div class="account-warning-icon"><span class="membership-notification"><span><span class="yellow">' + l[34] + '</span> ' + l[1010] + '. ' + l[1011] + ' <a href="#pro"  class="upgradelink">' + l[920] + '</a></span><span class="membership-arrow"></span></span>&nbsp;</div>';
                else if (perc > 80) warning = '<div class="account-warning-icon"><span class="membership-notification"><span><span class="yellow">' + l[34] + '</span> ' + l[1012] + ' ' + l[1013] + ' <a href="#pro"  class="upgradelink">' + l[920] + '</a></span><span class="membership-arrow"></span></span>&nbsp;</div>';
                var usedspace = '<span class="membershtip-small-txt">' + l['439a'].replace('[X1]', '<span class="blue lpxf">' + htmlentities(b1[0]) + '<span class="membershtip-small-txt">' + htmlentities(b1[1]) + '</span></span>').replace('[X2]', '<span class="lpxf">' + htmlentities(b2[0]) + '</span>' + ' <span class="membershtip-small-txt">' + htmlentities(b2[1]) + '</span>') + '</span>';
                var usedspacetxt = l[799];
                if (lang == 'de') usedspacetxt = l[799].charAt(0).toLowerCase() + l[799].slice(1);
                $('.membership-usage-txt.storage').html('<div class="membership-big-txt">' + usedspace + '</div><div class="membershtip-medium-txt">' + usedspacetxt + warning + '</div>');
                if (perc > 80) $('.membership-usage-txt.storage').addClass('exceeded');
                perc = Math.round((account.servbw_used + account.downbw_used) / account.bw * 100);
                perc_c = perc;
                if (perc_c > 100) perc_c = 100;
                $('.membership-popup .membership-circle-bg.green-circle').attr('class', 'membership-circle-bg green-circle percents-' + perc_c);
                $('.membership-popup .membership-circle-bg.green-circle').html(perc + '<span class="membershtip-small-txt">%</span>');
                var b1 = bytesToSize(account.servbw_used + account.downbw_used);
                b1 = b1.split(' ');
                b1[0] = Math.round(b1[0]) + ' ';
                var b2 = bytesToSize(account.bw);
                b2 = b2.split(' ');
                b2[0] = Math.round(b2[0]) + ' ';
                var waittime = '30 minutes';
                warning = '';
                if (perc > 99 && !u_attr.p) warning = '<div class="account-warning-icon"><span class="membership-notification"><span><span class="yellow">' + l[34] + '</span> <span class="red">' + l[17].toLowerCase() + '</span><br /> ' + l[1054].replace('[X]', '<span class="green">' + waittime + '</span>') + ' ' + l[1055] + ' <a href="#pro"  class="upgradelink">' + l[920] + '</a></span><span class="membership-arrow"></span></span>&nbsp;</div>';
                else if (perc > 99 && u_attr.p) warning = '<div class="account-warning-icon"><span class="membership-notification"><span><span class="yellow">' + l[34] + '</span> ' + l[1008] + ' ' + l[1009] + ' <a href="#pro" class="upgradelink">' + l[920] + '</a></span><span class="membership-arrow"></span></span>&nbsp;</div>';
                else if (perc > 80) warning = '<div class="account-warning-icon"><span class="membership-notification"><span><span class="yellow">' + l[34] + '</span> ' + l[1053] + ' ' + l[1009] + ' <a href="#pro" class="upgradelink">' + l[920] + '</a></span><span class="membership-arrow"></span></span>&nbsp;</div>';
                var usedbw = '<span class="membershtip-small-txt">' + l['439a'].replace('[X1]', '<span class="green lpxf">' + htmlentities(b1[0]) + '<span class="membershtip-small-txt">' + htmlentities(b1[1]) + '</span></span>').replace('[X2]', '<span class="lpxf">' + htmlentities(b2[0]) + '</span>' + ' <span class="membershtip-small-txt">' + htmlentities(b2[1]) + '</span>') + '</span>';
                var usedbwtxt = l[973];
                if (lang == 'de') usedbwtxt = l[973].charAt(0).toLowerCase() + l[973].slice(1);
                $('.membership-usage-txt.bandwidth').html('<div class="membership-big-txt">' + usedbw + '</div><div class="membershtip-medium-txt">' + usedbwtxt + warning + '</div>');
                if (perc > 80) $('.membership-usage-txt.bandwidth').addClass('exceeded');
                $('.membership-popup .membership-button').unbind('click');
                $('.membership-popup .membership-button').bind('click', function(e) {
                    document.location.hash = 'fm/account';
                    $.hideTopMenu(e);
                });
            });
        } else {
            $(this).removeClass('active');
            if ($(this).find('.membership-status').attr('class').indexOf('free') == -1) $('.pro-popup').removeClass('active');
            else $('.free-popup').removeClass('active');
        }
    });
    $('.top-menu-popup .top-menu-item').unbind('click');
    $('.top-menu-popup .top-menu-item').bind('click', function() {
        $('.top-menu-popup').removeClass('active');
        $('.top-menu-icon').removeClass('active');
        var c = $(this).attr('class');
        if (!c) c = '';
        if (c.indexOf('privacycompany') > -1) document.location.hash = 'privacycompany';
        else if (c.indexOf('upgrade-your-account') > -1) document.location.hash = 'pro';
        else if (c.indexOf('register') > -1) document.location.hash = 'register';
        else if (c.indexOf('login') > -1) document.location.hash = 'login';
        else if (c.indexOf('aboutus') > -1) document.location.hash = 'about';
        else if (c.indexOf('megablog') > -1) document.location.hash = 'blog';
        else if (c.indexOf('credits') > -1) document.location.hash = 'credits';
        else if (c.indexOf('chrome') > -1) document.location.hash = 'chrome';
        else if (c.indexOf('resellers') > -1) document.location.hash = 'resellers';
        else if (c.indexOf('firefox') > -1) document.location.hash = 'firefox';
        else if (c.indexOf('mobile') > -1) document.location.hash = 'mobile';
        else if (c.indexOf('sync') > -1) document.location.hash = 'sync';
        else if (c.indexOf('help') > -1) document.location.hash = 'help';
        else if (c.indexOf('contact') > -1) document.location.hash = 'contact';
        else if (c.indexOf('sitemap') > -1) document.location.hash = 'sitemap';
        else if (c.indexOf('sdk') > -1) document.location.hash = 'sdk';
        else if (c.indexOf('doc') > -1) document.location.hash = 'doc';
        else if (c.indexOf('affiliateterms') > -1) document.location.hash = 'affiliateterms';
        else if (c.indexOf('aff') > -1) document.location.hash = 'affiliates';
        else if (c.indexOf('terms') > -1) document.location.hash = 'terms';
        else if (c.indexOf('privacypolicy') > -1) document.location.hash = 'privacy';
        else if (c.indexOf('copyright') > -1) document.location.hash = 'copyright';
        else if (c.indexOf('takedown') > -1) document.location.hash = 'takedown';
        else if (c.indexOf('account') > -1) document.location.hash = 'fm/account';
        else if (c.indexOf('languages') > -1) languageDialog();
        else if (c.indexOf('clouddrive') > -1) document.location.hash = 'fm';
        else if (c.indexOf('logout') > -1) {
            mLogout();
        }
    });
    $('.top-search-input').unbind('focus');
    $('.top-search-input').bind('focus', function() {
        $('.top-search-bl').addClass('active');
        if ($(this).val() == l[102]) $(this).val('');
    });
    $('.top-search-input').unbind('blur');
    $('.top-search-input').bind('blur', function() {
        $(this).closest('.top-search-bl').removeClass('active');
        if ($(this).val() == '') {
            $(this).val(l[102]);
            $('.top-search-bl').removeClass('contains-value');
        } else $('.top-search-bl').addClass('contains-value');
    });
    $('.top-clear-button').unbind('click');
    $('.top-clear-button').bind('click', function() {
        $('.top-search-input').val(l[102]);
        $('.top-search-bl').removeClass('contains-value');
    });
    $('.top-search-input').unbind('keyup');
    $('.top-search-input').bind('keyup', function(e) {
        if (e.keyCode == 13 && ($('.top-search-input').val().length > 2 || !asciionly($('.top-search-input').val()))) {
            document.location.hash = 'fm/search/' + $('.top-search-input').val();
        }
    });
    if (avatars[u_handle]) $('.fm-avatar img').attr('src', avatars[u_handle].url);
    $('.fm-avatar img').unbind('click');
    $('.fm-avatar img').bind('click', function(e) {
        if ($(this).attr('src').indexOf('blob:') > -1) document.location.hash = 'fm/account';
        else avatarDialog();
    });
    $('.top-head .logo').unbind('click');
    $('.top-head .logo').bind('click', function(e) {
        document.location.hash = '#';
    });
    var c = $('.fm-dialog.registration-success').attr('class');
    if (c.indexOf('hidden') == -1) {
        $('.fm-dialog.registration-success').addClass('hidden');
        $('.fm-dialog-overlay').addClass('hidden');
    }
    if (page.substr(0, 2) !== 'fm' && u_type == 3 && !avatars[u_handle]) M.avatars();
    if (ul_uploading || downloading) $('.widget-block').removeClass('hidden');
    $('.widget-block').unbind('click');
    $('.widget-block').bind('click', function(e) {
        if ($.infoscroll && page == 'download') startpageMain();
        else if ($.dlhash) document.location.hash = $.dlhash;
        else document.location.hash = 'fm';
    });
    if (M && M.currentdirid && M.currentdirid.substr(0, 7) == 'search/') {
        $('.top-search-bl').addClass('contains-value');
        $('.top-search-bl input').val(M.currentdirid.replace('search/', ''));
    }
    if (u_type) $('.membership-popup-arrow').css('margin-right', $('.top-menu-icon').width() + $('.membership-status-block').width() / 2 + 90 + 'px');
    initNotifications();
}

function is_fm() {
    if ((u_type !== false && page == '') || (u_type !== false && page.substr(0, 2) == 'fm') || (u_type !== false && page == 'start') || (u_type !== false && page.substr(0, 7) == 'account') || pfid) return true;
    else return false;
}

function parsepage(pagehtml, pp) {
    $('body').removeClass('ads');
    $('#fmholder').hide();
    $('#pageholder').hide();
    $('#startholder').hide();
    megatitle();
    pagehtml = translate(pagehtml);
    pagehtml = pagehtml.replace(/{staticpath}/g, staticpath);
    if (document.location.href.substr(0, 19) == 'chrome-extension://') pagehtml = pagehtml.replace(/\/#/g, '/' + urlrootfile + '#');
    $('body').removeClass('notification-body bottom-pages new-startpage');
    if (page == 'notifications') $('body').addClass('notification-body');
    else if (page == 'start') $('body').addClass('new-startpage');
    else $('body').addClass('bottom-pages');
    var top = parsetopmenu();
    var bmenu = pages['bottom'];
    var bmenu2 = pages['bottom2'];
    if (document.location.href.substr(0, 19) == 'chrome-extension://') bmenu2 = bmenu2.replace(/\/#/g, '/' + urlrootfile + '#');
    pagehtml = pagehtml.replace('((MEGAINFO))', translate(pages['megainfo']).replace(/{staticpath}/g, staticpath));
    pagehtml = pagehtml.replace('((TOP))', top);
    pagehtml = pagehtml.replace('((BOTTOM))', translate(bmenu2));
    $('#startholder').html(translate(pages['transferwidget']) + pagehtml);
    $('#startholder').show();
    mainScroll();
    $(window).unbind('resize.subpage');
    $(window).bind('resize.subpage', function(e) {
        if (page !== 'start' && page !== 'download') mainScroll();
    });
    $('.nw-bottom-block').addClass(lang);
    UIkeyevents();
}

function parsetopmenu() {
    var top = pages['top'].replace(/{staticpath}/g, staticpath);
    if (document.location.href.substr(0, 19) == 'chrome-extension://') top = top.replace(/\/#/g, '/' + urlrootfile + '#');
    top = translate(top);
    return top;
}
window.onhashchange = function() {
    var tpage = document.location.hash;
    if (silent_loading) {
        document.location.hash = hash;
        return false;
    }
    if (tpage == '#info' && page == 'start') {
        if (!$.infoscroll) startpageScroll();
        return false;
    }
    if ((tpage == '#' || tpage == '' || tpage == 'start') && page == 'start') {
        if ($.infoscroll) startpageMain();
        return false;
    }
    if (document.getElementById('overlay').style.display == '' && !is_fm()) {
        document.location.hash = hash;
        return false;
    }
    dlid = false;
    hash = window.location.hash;
    if (window.location.hash) page = window.location.hash.replace('#', '');
    else page = '';
    if (page) {
        for (var p in subpages) {
            if (page && page.substr(0, p.length) == p) {
                for (i in subpages[p]) {
                    if (!jsl_loaded[jsl2[subpages[p][i]].n]) jsl.push(jsl2[subpages[p][i]]);
                }
            }
        }
    }
    if (jsl.length > 0) {
        loadingDialog.show();
        jsl_start();
    } else init_page();
}

function languageDialog(close) {
    if (close) {
        $('.fm-dialog.languages-dialog').addClass('hidden');
        $('.fm-dialog-overlay').addClass('hidden');
        $.dialog = false;
        return false;
    }
    var html = '<div class="nlanguage-txt-block">';
    var larray = [];
    for (var la in languages)
        if (ln2[la]) larray.push({
            l: ln[la],
            l2: ln2[la],
            c: la
        });
    larray.sort(function(a, b) {
        return a.l.localeCompare(b.l);
    });
    var i = 1,
        a = 0,
        sel = '';
    for (var j in larray) {
        var la = larray[j].c;
        if (ln2[la]) {
            if (la == lang) sel = ' selected';
            else sel = '';
            html += '<a href="#" id="nlanguagelnk_' + la + '" class="nlanguage-lnk' + sel + '"><span class="nlanguage-tooltip"> <span class="nlanguage-tooltip-bg"> <span class="nlanguage-tooltip-main"> ' + ln2[la] + '</span></span></span>' + ln[la] + '</a><div class="clear"></div>';
            if (i == Math.ceil(larray.length / 4) && a + 1 < larray.length) {
                html += '</div><div class="nlanguage-txt-block">';
                i = 0;
            }
            i++;
            a++;
        }
    }
    html += '</div><div class="clear"></div>';
    $('.languages-dialog-body').html(html);
    $('.fm-dialog.languages-dialog').removeClass('hidden');
    $('.fm-dialog-overlay').removeClass('hidden');
    $.dialog = 'languages';
    $('.fm-dialog.languages-dialog .fm-dialog-close').unbind('click');
    $('.fm-dialog.languages-dialog .fm-dialog-close').bind('click', function(e) {
        languageDialog(1);
    });
    $('.fm-languages-save').unbind('click');
    $('.fm-languages-save').bind('click', function(e) {
        languageDialog(1);
        setTimeout(function() {
            var lng = $('.nlanguage-lnk.selected').attr('id');
            lng = lng.replace('nlanguagelnk_', '');
            if (lng !== lang) {
                localStorage.lang = lng;
                document.location.reload();
            }
        }, 100);
    });
    $('.nlanguage-lnk').unbind('click');
    $('.nlanguage-lnk').bind('click', function(e) {
        $('.nlanguage-lnk').removeClass('selected');
        $(this).addClass('selected');
        return false;
    });
}
window.onbeforeunload = function() {
    if (downloading || ul_uploading) return l[377];
    if (mDB && mDBact && localStorage[u_handle + '_mDBactive']) delete localStorage[u_handle + '_mDBactive'];
}

function start_over() {
    if (!$.startmotion) $.startmotion = true;
    else return false;
    $('.st-main-button-icon').fadeOut(100, function() {
        $('.st-main-button-icon-hovered').fadeIn(450);
        $.startignore = true;
        $.startmotion = false;
    });
    $('.st-main-info').addClass('active');
    $('.st-main-cursor').addClass('active');
    $('.st-main-button').addClass('active');
}

function start_out() {
    if (!$.startmotion) $.startmotion = true;
    else return false;
    $.startignore = false;
    $('.st-main-button-icon-hovered').fadeOut(100, function() {
        $('.st-main-button-icon').fadeIn(450);
        $.startmotion = false;
    });
    $('.st-main-info').removeClass('active');
    $('.st-main-cursor').removeClass('active');
    $('.st-main-button').removeClass('active');
}

function init_start() {
    megainfotxt();
    if (lang !== 'en' && lang !== 'de') {
        l[225] = l[225].toLowerCase();
        l[225] = l[225].substr(0, 1).toUpperCase() + l[225].substr(1, l[225].length - 1).toLowerCase();
    }
    if (lang !== 'en') $('.st-main-info.uploadtxt').text(l[225]);
    if (page == 'start') {
        $('.st-main-button-icon').unbind('mouseover');
        $('.st-main-button-icon').bind('mouseover', function(event) {
            if (!$.dragging && !$.startscrolling) start_over();
        });
        $('.st-main-button-icon').unbind('mouseout');
        $('.st-main-button-icon').bind('mouseout', function(event) {
            if (!$.startignore) setTimeout(function() {
                start_out();
            }, 300);
        });
        $('.st-main-button-icon-hovered').unbind('mouseout');
        $('.st-main-button-icon-hovered').bind('mouseout', function(event) {
            if (!$.dragging) start_out();
        });
    }
    $(window).unbind('resize');
    $(window).bind('resize', function(e) {
        if (page == 'start' && $.infoscroll) {
            startscrollIgnore(1000);
            jScrollStart();
        }
    });
    $('.st-bottom-scroll-button.scrolldown').unbind('click');
    $('.st-bottom-scroll-button.scrolldown').bind('click', function(event) {
        startpageScroll();
    });
    $('.st-bottom-scroll-button.scrollup').unbind('click');
    $('.st-bottom-scroll-button.scrollup').bind('click', function(event) {
        startpageMain();
    });
    var el = '.st-mid-white-block';
    if (page == 'download') el = '.download-mid-white-block';
    $(el).unbind('mousewheel');
    $(el).bind('mousewheel', function(e) {
        if (e && e.originalEvent && (e.originalEvent.wheelDelta < 0 || e.originalEvent.deltaY > 0) && !$.infoscroll) startpageScroll();
    });
    if (page == 'start') InitFileDrag();
    if (document.location.hash == '#info') startpageScroll(1);
}
$.jScroll = {};

function jScrollStart() {
    $('.st-main-block').jScrollPane({
        showArrows: true,
        arrowSize: 5,
        animateScroll: true
    });
    jScrollFade('.st-main-block');
    $('.st-main-block').unbind('jsp-scroll-y.back');
    $('.st-main-block').bind('jsp-scroll-y.back', function(event, scrollPositionY, isAtTop, isAtBottom) {
        if (isAtTop && !$.scrollIgnore) startpageMain();
        else if (!isAtTop) startscrollIgnore(500);
    });
}

function startpageScroll(blockSwing) {
    if (page == 'download') $('.st-bottom-scroll-button.scrollup').text(l[1375]);
    $.infoscroll = true;
    if ($.hideTopMenu) $.hideTopMenu();
    var el = '.st-mid-white-block';
    if (page == 'download') el = '.download-mid-white-block';
    $(el).addClass('active');
    $('.st-main-bottom.scroll.floating').show();
    $('.st-full-block').removeClass('hidden');
    if (page == 'start') document.location.hash = '#info';
    if (blockSwing) {
        $('.st-main-block').scrollTop($('.st-main-block').height());
        startpageJSP();
    } else {
        $.startscrolling = true;
        $('.st-main-block').animate({
            scrollTop: $('.st-main-block').height()
        }, '300', 'swing', function() {
            setTimeout(startpageJSP, 50);
            $.startscrolling = false;
        });
    }
}

function megainfotxt() {
    if (lang !== 'en') {
        $('.infotxt1').text(l[12]);
        $('.infotxt2').text(l[1060]);
        $('.infotxt3').text(l[1061]);
        $('.infotxt4').text(l[1062]);
        $('.infotxt5').text(l[1063]);
        $('.infotxt6').text(l[1064]);
        $('.infotxt7').text(l[1065]);
        $('.infotxt8').text(l[1073]);
        $('.infotxt9').text(l[1368].replace('[X]', ''));
        $('.infotxt10').text(l[1369].replace('[X]', ''));
        $('fmholder').addClass(lang);
    }
    if (lang == 'fr') $('.st-small-red-txt.tb').text('To');
    $('.st-apps-icon').unbind('click');
    $('.st-apps-icon').bind('click', function(e) {
        var c = $(this).attr('class');
        if (c && c.indexOf('mobile') > -1) document.location.hash = 'mobile';
        else if (c && c.indexOf('sync') > -1) document.location.hash = 'sync';
        else if (c && c.indexOf('browser') > -1) document.location.hash = 'plugin';
        else if (c && c.indexOf('chat') > -1) document.location.hash = 'blog_22';
    });
}

function startpageMain() {
    $.infoscroll = false;
    if (page == 'download') $('.widget-block').hide();
    var el = '.st-mid-white-block';
    if (page == 'download') el = '.download-mid-white-block';
    $(el).show();
    $('.top-head').show();
    var jsp = $('.st-main-block').data('jsp');
    if (jsp) jsp.destroy();
    $('.st-main-block').scrollTop($('.st-main-block').height());
    $('.st-main-bottom.scroll.floating').hide();
    $.startscrolling = true;
    $('.st-main-block').animate({
        scrollTop: 0
    }, '300', 'swing', function() {
        var el = '.st-mid-white-block';
        if (page == 'download') el = '.download-mid-white-block';
    });
    setTimeout(function() {
        var el = '.st-mid-white-block';
        if (page == 'download') el = '.download-mid-white-block';
        $(el).removeClass('active');
        $.startscrolling = false;
        if (page == 'start') document.location.hash = '#';
    }, 295);
}

function startpageJSP() {
    if (page == 'download') $('.download-mid-white-block').hide();
    else $('.st-mid-white-block').hide();
    $('.top-head').hide();
    $('.st-main-block').scrollTop(0);
    jScrollStart();
}

function startscrollIgnore(t) {
    if (!$.scrollIgnore) $.scrollIgnore = 0;
    $.scrollIgnore++;
    setTimeout(function() {
        $.scrollIgnore--;
    }, t);
}
var arkanoid_entropy;

function load_start_arkanoid() {
    if (typeof Arkanoid == 'undefined') {
        setTimeout(load_start_arkanoid, 500);
    } else start_arkanoid();
}

function init_key() {
    /*
	if (m)
	{
		crypto_rsagenkey();
		return false;	
	}		
	$('.register-game-button.start').unbind('click');
	$('.register-game-button.start').bind('click',function(e)
	{
		$('.reg-st4-canvas-block.splash').addClass('hidden');
		$('.reg-st4-canvas-block.game').removeClass('hidden');
		load_start_arkanoid();
	});	
	$('.register-game-button.skip').unbind('click');
	$('.register-game-button.skip').bind('click',function(e)
	{
		key_step2();
	});
	if (typeof Arkanoid == 'undefined' && !silent_loading)
	{	
		jsl.push(jsl2['arkanoid_js']);
		jsl_start();
	}	
	$('.register-st2-button.next').unbind('click');
	$('.register-st2-button.next').bind('click',function(e)
	{
		key_step2();
	});
	*/
    $('.key1').addClass('hidden');
    $('.key2').removeClass('hidden');
    if (typeof u_privk == 'undefined') {
        crypto_rsagenkey();
        u_ed25519();
    } else ui_keycomplete();
}

function key_step2() {
    $.killarkanoid = true;
    $('.key1').addClass('hidden');
    $('.key2').removeClass('hidden');
    if (typeof u_privk == 'undefined') {
        crypto_rsagenkey();
        u_ed25519();
    } else ui_keycomplete();
}
var arkanoid;

function start_arkanoid() {
    arkanoid = new Arkanoid('canvas');
    arkanoid.start();
    arkanoid_entropy = function() {
        if (!$.entropy) $.entropy = 0;
        $.entropy++;
        var perc = Math.round($.entropy / 256 * 100);
        if (perc <= 100) {
            $('.membership-circle-bg.game-circle').attr('class', 'membership-circle-bg game-circle percents-' + perc);
            $('.membership-circle-bg.game-circle').html(perc + '<span class="membershtip-small-txt">%</span>');
        }
        if (perc >= 100) {
            $('.key1 .top-login-input-tooltip').addClass('active');
            $('.register-st2-button.next').addClass('active');
        }
    };
}

function ui_keycomplete() {
    $('.key1').addClass('hidden');
    $('.key2').addClass('hidden');
    $('.key3').removeClass('hidden');
    init_pro();
    mainScroll();
}
var pro_package;
var pro_packs = [];
var pro_balance = 0;
var pro_paymentmethod;
var pro_m;
var pro_usebalance = false;

function init_pro() {
    if (u_type == 3) {
        api_req({
            a: 'uq',
            pro: 1,
        }, {
            callback: function(res) {
                if (typeof res == 'object' && res.balance && res.balance[0]) pro_balance = res.balance[0][0];
            }
        });
    }
    if (document.location.hash.indexOf('#pro/') > -1) {
        localStorage.affid = document.location.hash.replace('#pro/', '');
        localStorage.affts = new Date().getTime();
    }
    $('body').addClass('pro');
    if (lang != 'en') $('body').addClass(lang);
    json = JSON.parse(pro_json);
    for (var i in json[0]) {
        if ((json[0][i][2] == '500') && (json[0][i][5] == '9.99')) pro_packs['pro1_month'] = json[0][i];
        else if ((json[0][i][2] == '500') && (json[0][i][5] == '99.99')) pro_packs['pro1_year'] = json[0][i];
        else if ((json[0][i][2] == '2048') && (json[0][i][5] == '19.99')) pro_packs['pro2_month'] = json[0][i];
        else if ((json[0][i][2] == '2048') && (json[0][i][5] == '199.99')) pro_packs['pro2_year'] = json[0][i];
        else if ((json[0][i][2] == '4096') && (json[0][i][5] == '29.99')) pro_packs['pro3_month'] = json[0][i];
        else if ((json[0][i][2] == '4096') && (json[0][i][5] == '299.99')) pro_packs['pro3_year'] = json[0][i];
    }
    if (!m) {
        if (lang == 'fr') $('.reg-st3-big-txt').each(function(e, o) {
            $(o).html($(o).html().replace('GB', 'Go').replace('TB', 'To'));
        });
        if (lang !== 'en') $('.reg-st3-save-txt').addClass(lang);
        $('.reg-st3-save-icon').removeClass('hidden');
        $('.reg-checkbox :checkbox').iphoneStyle({
            resizeContainer: false,
            resizeHandle: false,
            onChange: function(elem, data) {
                if (data) {
                    $('#month').addClass('red');
                    $('#year').removeClass('red');
                    $('.reg-st3-save-icon').addClass('hidden');
                    $('.pro-new-year').addClass('hidden');
                    $('.pro-new-month').removeClass('hidden');
                    $('.pro1 .reg-st3-bott-title.right').html('9<span>.99 &euro;</span>');
                    $('.pro2 .reg-st3-bott-title.right').html('19<span>.99 &euro;</span>');
                    $('.pro3 .reg-st3-bott-title.right').html('29<span>.99 &euro;</span>');
                    $('.pro1 .reg-st3-bandwidth .reg-st3-big-txt').html('1 <span>TB</span>');
                    $('.pro2 .reg-st3-bandwidth .reg-st3-big-txt').html('4 <span>TB</span>');
                    $('.pro3 .reg-st3-bandwidth .reg-st3-big-txt').html('8 <span>TB</span>');
                } else {
                    $('#month').removeClass('red');
                    $('#year').addClass('red');
                    $('.reg-st3-save-icon').removeClass('hidden');
                    $('.pro-new-year').removeClass('hidden');
                    $('.pro-new-month').addClass('hidden');
                    $('.pro1 .reg-st3-bott-title.right').html('99<span>.99 &euro;</span>');
                    $('.pro2 .reg-st3-bott-title.right').html('199<span>.99 &euro;</span>');
                    $('.pro3 .reg-st3-bott-title.right').html('299<span>.99 &euro;</span>');
                    $('.pro1 .reg-st3-bandwidth .reg-st3-big-txt').html('12 <span>TB</span>');
                    $('.pro2 .reg-st3-bandwidth .reg-st3-big-txt').html('48 <span>TB</span>');
                    $('.pro3 .reg-st3-bandwidth .reg-st3-big-txt').html('96 <span>TB</span>');
                }
                if (lang == 'fr') $('.reg-st3-big-txt').each(function(e, o) {
                    $(o).html($(o).html().replace('GB', 'Go').replace('TB', 'To'));
                });
            }
        });
        $('.reg-st3-membership-bl').unbind('click');
        $('.reg-st3-membership-bl').bind('click', function(e) {
            $('.reg-st3-membership-bl').removeClass('selected');
            $(this).addClass('selected');
        });
        $('.reg-st3-membership-bl').unbind('dblclick');
        $('.reg-st3-membership-bl').bind('dblclick', function(e) {
            $('.reg-st3-membership-bl').removeClass('selected');
            $(this).addClass('selected');
            pro_proceed(e);
        });
        $('.register-st2-button-arrow').unbind('click');
        $('.register-st2-button-arrow').bind('click', function(e) {
            pro_proceed(e);
        });
        $('.pro-bottom-button').unbind('click');
        $('.pro-bottom-button').bind('click', function(e) {
            document.location.hash = 'contact';
        });
    }
}

function pro_proceed(e) {
    var c = $('.reg-st3-membership-bl.selected').attr('class');
    if (c.indexOf('free') > -1) {
        if (page == 'fm') document.location.hash = '#start';
        else document.location.hash = '#fm';
        return false;
    } else if (c.indexOf('pro1') > -1 && $('#reg-checkbox').attr('checked')) pro_package = 'pro1_month';
    else if (c.indexOf('pro1') > -1) pro_package = 'pro1_year';
    else if (c.indexOf('pro2') > -1 && $('#reg-checkbox').attr('checked')) pro_package = 'pro2_month';
    else if (c.indexOf('pro2') > -1) pro_package = 'pro2_year';
    else if (c.indexOf('pro3') > -1 && $('#reg-checkbox').attr('checked')) pro_package = 'pro3_month';
    else if (c.indexOf('pro3') > -1) pro_package = 'pro3_year';
    if (pro_package) pro_continue();
}

function pro_continue() {
    pro_paymentmethod = '';
    if (u_type === false) {
        u_storage = init_storage(localStorage);
        loadingDialog.show();
        u_checklogin({
            checkloginresult: function(u_ctx, r) {
                pro_pay();
            }
        }, true);
    } else if (parseFloat(pro_balance) >= parseFloat(pro_packs[pro_package][5])) {
        msgDialog('confirmation', 'Prepaid balance', 'Do you want to use your prepaid balance to proceed?', false, function(e) {
            if (e) pro_paymentmethod = 'pro_prepaid';
            pro_pay();
        });
    } else pro_pay();
}

function pro_pay() {
    var aff = 0;
    if (localStorage.affid && localStorage.affts > new Date().getTime() - 86400000) aff = localStorage.affid;
    loadingDialog.show();
    api_req({
        a: 'uts',
        it: 0,
        si: pro_packs[pro_package][0],
        p: pro_packs[pro_package][5],
        c: pro_packs[pro_package][6],
        aff: aff
    }, {
        callback: function(res) {
            if (typeof res == 'number' && res < 0) {
                loadingDialog.hide();
                alert(l[200]);
            } else {
                if (pro_paymentmethod == 'pro_voucher' || pro_paymentmethod == 'pro_prepaid') pro_m = 0;
                else pro_m = 1;
                api_req({
                    a: 'utc',
                    s: [
                        res
                    ],
                    m: pro_m
                }, {
                    callback: function(res) {
                        if (pro_paymentmethod == 'pro_prepaid') {
                            loadingDialog.hide();
                            if (typeof res == 'number' && res < 0) {
                                if (res == EOVERQUOTA) alert(l[514]);
                                else alert(l[200]);
                            } else {
                                if (M.account) M.account.lastupdate = 0;
                                document.location.hash = 'account';
                            }
                        } else {
                            var ppurl = 'https://www.paypal.com/cgi-bin/webscr';
                            if (res && res.EUR) {
                                var j = 0;
                                for (var i in res.EUR) {
                                    if (j == 0) ppurl += '?';
                                    else ppurl += '&';
                                    ppurl += i + '=' + encodeURIComponent(res.EUR[i]);
                                    j++;
                                }
                                if (d) console.log(ppurl);
                                if (ul_uploading || downloading) {
                                    loadingDialog.hide();
                                    paypalDialog(ppurl);
                                } else document.location = ppurl;
                            } else {
                                loadingDialog.hide();
                                alert(l[200]);
                            }
                        }
                    }
                });
            }
        }
    });
}
var login_txt = false,
    login_email = false;

function dologin() {
    if ((document.getElementById('login_email').value == '') || (document.getElementById('login_email').value == l[195])) {
        alert(l[197]);
    } else if (checkMail(document.getElementById('login_email').value)) {
        alert(l[198]);
    } else if (document.getElementById('login_password').value == '') {
        alert(l[199]);
    } else {
        if (m) loadingDialog.show();
        else document.getElementById('overlay').style.display = '';
        if (confirmok) {
            if (u_signupenck) {
                if (checksignuppw(document.getElementById('login_password').value)) {
                    var ctx = {
                        callback: function(res, ctx) {
                            if (m) loadingDialog.hide();
                            else document.getElementById('overlay').style.display = 'none';
                            if (res[0] == EACCESS) {
                                alert(l[732]);
                            } else if (typeof res[0] == 'string') {
                                if (u_type) {
                                    if (login_next) document.location.hash = login_next;
                                    else if (page !== 'login') init_page();
                                    else document.location.hash = 'fm';
                                    login_next = false;
                                    document.title = 'MEGA';
                                } else postlogin();
                            } else {
                                alert(l[200]);
                            }
                        }
                    }
                    if (d) console.log('u_handle');
                    if (d) console.log(u_handle);
                    var passwordaes = new sjcl.cipher.aes(prepare_key_pw(document.getElementById('login_password').value));
                    api_updateuser(ctx, {
                        uh: stringhash(document.getElementById('login_email').value.toLowerCase(), passwordaes),
                        c: confirmcode
                    })
                } else {
                    alert(l[201]);
                    if (m) loadingDialog.hide();
                    else document.getElementById('overlay').style.display = 'none';
                    document.getElementById('login_password').value = '';
                }
            }
        } else {
            postlogin();
        }
    }
}

function doConfirm(email, password, callback) {
    if (u_signupenck) {
        if (checksignuppw(password)) {
            if (d) console.log('u_handle');
            if (d) console.log(u_handle);
            var passwordaes = new sjcl.cipher.aes(prepare_key_pw(password));
            api_updateuser({
                callback2: callback,
                callback: function(res, ctx) {
                    loadingDialog.hide();
                    if (res[0] == EACCESS) {
                        if (m) alert(l[732]);
                        else msgDialog('warninga', l[135], l[732]);
                    } else if (typeof res[0] == 'string') {
                        confirmok = false;
                        if (ctx.callback2) ctx.callback2();
                    } else {
                        alert(l[200]);
                    }
                }
            }, {
                uh: stringhash(email.toLowerCase(), passwordaes),
                c: confirmcode
            })
        } else {
            loadingDialog.hide();
            if (m) {
                loadingDialog.hide();
                alert(l[201]);
            } else {
                $('#login-password2').val('');
                $('.login-register-input.password').addClass('incorrect');
                msgDialog('warninga', l[135], l[201]);
            }
        }
    }
}

function postLogin(email, password, remember, callback) {
    var ctx = {
        callback2: callback,
        checkloginresult: function(ctx, r) {
            if (ctx.callback2) ctx.callback2(r);
        }
    }
    var passwordaes = new sjcl.cipher.aes(prepare_key_pw(password));
    var uh = stringhash(email.toLowerCase(), passwordaes);
    u_login(ctx, email, password, uh, remember);
}

function pagelogin() {
    var e = $('#login-name2').val();
    if (e == '' || e == l[195] || checkMail(e)) {
        $('.login-register-input.email').addClass('incorrect');
        $('#login-name2').focus();
    } else if ($('#login-password2').val() == '' || $('#login-password2').val() == l[909]) {
        $('.login-register-input.password').addClass('incorrect');
        $('#login-password2').focus();
    } else {
        loadingDialog.show();
        $('.top-dialog-login-button').addClass('loading');
        if ($('.loginwarning-checkbox').attr('class').indexOf('checkboxOn')) localStorage.hideloginwarning = 1;
        if (confirmok) {
            doConfirm($('#login-name2').val(), $('#login-password2').val(), function() {
                loadingDialog.show();
                postLogin($('#login-name2').val(), $('#login-password2').val(), remember, function(r) {
                    loadingDialog.hide();
                    if (r == EBLOCKED) {
                        alert(l[730]);
                    } else if (r) {
                        u_type = r;
                        document.location.hash = 'key';
                    }
                });
            });
        } else {
            var remember;
            if ($('.login-check').attr('class').indexOf('checkboxOn') > -1) remember = 1;
            postLogin($('#login-name2').val(), $('#login-password2').val(), remember, function(r) {
                loadingDialog.hide();
                if (r == EBLOCKED) {
                    alert(l[730]);
                } else if (r) {
                    u_type = r;
                    if (login_next) document.location.hash = login_next;
                    else if (page !== 'login') init_page();
                    else document.location.hash = 'fm';
                    login_next = false;
                } else {
                    $('.login-register-input.password').addClass('incorrect');
                    $('.login-register-input.email').addClass('incorrect');
                    msgDialog('warninga', l[135], l[1130] + ' ' + l[969], false, function(e) {
                        $('#login-password2').val('');
                        $('#login-name2').select();
                    });
                }
            });
        }
    }
}

function init_login() {
    if (login_email) $('#login-name2').val(login_email);
    if (confirmok) {
        $('.register-st2-txt-block').addClass('hidden');
        $('.login-page-create-new').addClass('hidden');
        $('.top-login-forgot-pass').addClass('hidden');
        $('.main-top-info-block').removeClass('hidden');
        $('.register-st2-button-arrow').text(l[1131]);
        $('.main-italic-header.login').text(l[1131]);
        $('.main-top-info-text').text(l[378]);
    } else {
        $('.register-st2-button').addClass('active');
        if (login_txt) {
            $('.main-top-info-block').removeClass('hidden');
            $('.main-top-info-text').text(login_txt);
            login_txt = false;
        }
    }
    $('#login-name2').unbind('focus');
    $('#login-name2').bind('focus', function(e) {
        $('.login-register-input.email').addClass('focused');
        if ($(this).val() == l[195]) $(this).val('');
    });
    $('#login-name2').unbind('blur');
    $('#login-name2').bind('blur', function(e) {
        $('.login-register-input.email').removeClass('focused');
        if ($(this).val() == '') $(this).val(l[195]);
    });
    $('#login-password2').unbind('focus');
    $('#login-password2').bind('focus', function(e) {
        $('.login-register-input.password').addClass('focused');
        if ($(this).val() == l[909]) {
            $(this).val('');
            $(this)[0].type = 'password';
        }
    });
    $('#login-password2').unbind('blur');
    $('#login-password2').bind('blur', function(e) {
        $('.login-register-input.password').removeClass('focused');
        if ($(this).val() == '') {
            $(this).val(l[909]);
            $(this)[0].type = 'text';
        }
    });
    $('#login-password2, #login-name2').unbind('keydown');
    $('#login-password2, #login-name2').bind('keydown', function(e) {
        if ($('#login-name2').val() !== '' && $('#login-name2').val() !== l[195] && $('#login-password2').val() !== '' && $('#login-password2').val() !== l[909]) $('.register-st2-button').addClass('active');
        $('.login-register-input.password').removeClass('incorrect');
        $('.login-register-input.email').removeClass('incorrect');
        if (e.keyCode == 13) pagelogin();
    });
    $('.register-st2-button').unbind('click');
    $('.register-st2-button').bind('click', function(e) {
        pagelogin();
    });
    $('.login .radio-txt,.login-check').unbind('click');
    $('.login .radio-txt,.login-check').bind('click', function(e) {
        if ($('.login-check').attr('class').indexOf('checkboxOn') > -1) {
            $('.login-check').addClass('checkboxOff');
            $('.login-check').removeClass('checkboxOn');
        } else {
            $('.login-check').addClass('checkboxOn');
            $('.login-check').removeClass('checkboxOff');
        }
    });
    $('.top-login-forgot-pass').unbind('click');
    $('.top-login-forgot-pass').bind('click', function(e) {
        document.location.hash = 'recovery';
    });
    $('.login-page-create-new span').unbind('click');
    $('.login-page-create-new span').bind('click', function(e) {
        document.location.hash = 'register';
    });
    $('.login-register-input').unbind('click');
    $('.login-register-input').bind('click', function(e) {
        $(this).find('input').focus();
    });
}

function postlogin() {
    if (m) loadingDialog.show();
    var ctx = {
        checkloginresult: function(ctx, r) {
            if (m) loadingDialog.hide();
            else document.getElementById('overlay').style.display = 'none';
            if (r == EBLOCKED) {
                alert(l[730]);
            } else if (r) {
                document.getElementById('login_password').value = '';
                document.getElementById('login_email').value = '';
                u_type = r;
                if (page == 'login') {
                    if (document.location.hash == '#fm') {
                        page = 'fm';
                        init_page();
                    } else {
                        if (login_next) document.location.hash = login_next;
                        else if (page !== 'login') init_page();
                        else document.location.hash = 'fm';
                        login_next = false;
                        document.title = 'MEGA';
                    }
                } else init_page();
                if (d) console.log('logged in');
            } else {
                document.getElementById('login_password').value = '';
                alert(l[201]);
            }
        }
    }
    var passwordaes = new sjcl.cipher.aes(prepare_key_pw(document.getElementById('login_password').value));
    var uh = stringhash(document.getElementById('login_email').value.toLowerCase(), passwordaes);
    u_login(ctx, document.getElementById('login_email').value, document.getElementById('login_password').value, uh, document.getElementById('login_remember').checked);
}
var notifications;

function pollnotifications() {
    if (u_type == 3 && typeof notifications == 'undefined') {
        notifications = [];
        if (M.currentdirid == 'notifications') loadingDialog.show();
        api_req('c=100', {
            callback: function(json, params) {
                if (typeof json == 'object' && json.fsn && u_type) {
                    if (M.currentdirid == 'notifications') loadingDialog.hide();
                    notifications = [];
                    var currtime = Math.floor(new Date().getTime() / 1000);
                    for (var i in json.c) {
                        notifications.push({
                            id: makeid(10),
                            type: json.c[i].t,
                            timestamp: currtime - json.c[i].td,
                            user: json.c[i].u,
                            folderid: json.c[i].n,
                            nodes: json.c[i].f,
                            read: json.c[i].td >= (json.ltd || 0),
                            popup: true,
                            count: json.c[i].td >= (json.ltd || 0),
                            rendered: true
                        });
                    }
                    var c = $('.notification-popup').attr('class');
                    donotify();
                    $('.cloud-popup-icon').show();
                }
            }
        }, 3);
    }
}
var lastnotification = 0;

function notifycounter() {
    if (typeof notifications == 'undefined') return false;
    var a = 0;
    $.each(notifications, function(i, n) {
        if (!n.count) a++;
    });
    if (a == 0) {
        $('.notification-num').hide();
        $('.notification-num').text(0);
    } else {
        $('.notification-num').text(a);
        $('.notification-num').show();
    }
    megatitle();
}

function donotify() {
    if (typeof notifications == 'undefined') return false;
    var useremails = {};
    if (M && M.u)
        for (var i in M.u) useremails[i] = M.u[i].m;
    notifications.sort(function(a, b) {
        if (a.timestamp > b.timestamp) return -1;
        else if (a.timestamp < b.timestamp) return 1;
        else return 0;
    });
    var phtml = '',
        nhtml = '';
    var i = 0,
        a = 0;
    var curdate = false;
    $.each(notifications, function(i, n) {
        if ((i > 100) && (page != 'notifications')) return false;
        var date = new Date(n.timestamp * 1000).getFullYear() + '-' + new Date(n.timestamp * 1000).getMonth() + '-' + new Date(n.timestamp * 1000).getDate();
        if (curdate != date) {
            nhtml += ntdatehtml(n.timestamp * 1000);
            curdate = date;
        }
        var obj = false;
        var title = '';
        if (n.type == 'share') {
            // new share
            if (useremails[n.user]) title = l[824].replace('[X]', htmlentities(useremails[n.user]));
            else title = l[825];
            obj = notificationhtml(n.id, 'share', title, n.timestamp, n.read);
        } else if (n.type == 'dshare') {
            // revoked share
            if (useremails[n.user]) title = l[826].replace('[X]', htmlentities(useremails[n.user]));
            else title = l[827];
            obj = notificationhtml(n.id, 'dshare', title, n.timestamp, n.read);
        } else if (n.type == 'put') {
            // put nodes
            var nodes = n.nodes;
            var filecnt = 0;
            var foldercnt = 0;
            var ntext = '';
            for (var j in nodes) {
                if (nodes[j].t == 1) foldercnt++;
                else filecnt++;
            }
            if ((foldercnt > 1) && (filecnt > 1)) ntext = l[828].replace('[X1]', foldercnt).replace('[X2]', filecnt);
            else if ((foldercnt > 1) && (filecnt == 1)) ntext = l[829].replace('[X]', foldercnt);
            else if ((foldercnt == 1) && (filecnt > 1)) ntext = l[830].replace('[X]', filecnt);
            else if ((foldercnt == 1) && (filecnt == 1)) ntext = l[831];
            else if (foldercnt > 1) ntext = l[832].replace('[X]', foldercnt);
            else if (filecnt > 1) ntext = l[833].replace('[X]', filecnt);
            else if (foldercnt == 1) ntext = l[834];
            else if (filecnt == 1) ntext = l[835];
            if (useremails[n.user]) title = l[836].replace('[X]', htmlentities(useremails[n.user])).replace('[DATA]', ntext);
            else if ((filecnt + foldercnt) > 1) title = l[837].replace('[X]', ntext);
            else title = l[838].replace('[X]', ntext);
            obj = notificationhtml(n.id, 'put', title, n.timestamp, n.read);
        }
        if (obj) {
            nhtml += obj.nhtml;
            var max = Math.floor(($('body').height() - 50) / 70);
            if (max > 10) max = 10;
            if (i < max) phtml += obj.rhtml;
            if (!n.popup) {
                n.popup = true;
                donotifypopup(n.id, obj.phtml);
            }
        }
        if (!n.count) a++;
    });
    if (M.currentdirid == 'notifications') {
        notifymarkcount(true);
        notifycounter();
        $('.new-notification-pad').html(nhtml);
        $('.nt-info-txt,.new-notification-pad .notification-type').unbind('click');
        $('.nt-info-txt,.new-notification-pad .notification-type').bind('click', function(e) {
            var id = $(this).attr('id');
            if (id) {
                id = id.replace('no_', '');
                id = id.replace('type_', '');
                id = id.replace('txt_', '');
                for (var i in notifications) {
                    if (notifications[i].id == id && (notifications[i].type == 'put' || notifications[i].type == 'share')) {
                        $.selected = [];
                        for (var j in notifications[i].nodes) $.selected.push(notifications[i].nodes[j].h);
                        M.openFolder(notifications[i].folderid);
                        reselect(1);
                    }
                }
            }
        });
        notificationsScroll();
    }
    if (a == 0) {
        $('.notification-num').text(0);
        $('.notification-num').hide();
    } else {
        $('.notification-num').text(a);
        $('.notification-num').show();
    }
    $('.notification-scr-list').html(phtml);
    var jsp = $('.notification-scroll').data('jsp');
    if (jsp) jsp.destroy();
    $('.notification-scroll').jScrollPane({
        showArrows: true,
        arrowSize: 5
    });
    jScrollFade('.notification-scroll');
    if (notifications.length == 0) {
        $('.notification-popup').addClass('empty');
        $('.nt-main-block').addClass('empty');
    } else {
        $('.notification-popup').removeClass('empty');
        $('.nt-main-block').removeClass('empty');
    }
    $('.notification-item').unbind('click');
    $('.notification-item').bind('click', function(el, i) {
        notifymarkcount(true);
        notifycounter();
        $('.notification-popup').addClass('hidden');
        $('.cloud-popup-icon').removeClass('active');
        var id = $(this).attr('id');
        if (id) {
            for (var i in notifications) {
                if (notifications[i].id == id && (notifications[i].type == 'put' || notifications[i].type == 'share')) {
                    $.selected = [];
                    for (var j in notifications[i].nodes) $.selected.push(notifications[i].nodes[j].h);
                    M.openFolder(notifications[i].folderid);
                    reselect(1);
                }
            }
        }
    });
    megatitle();
}

function notifyclock() {
    if ($('.cloud-popup-icon').attr('class').indexOf('active') > 0) {
        donotify();
        var node = typeof notifications !== 'undefined' && notifications[0];
        if ((node) && (node.timestamp * 1000 > new Date().getTime() - 60000)) setTimeout(notifyclock, 990);
        else setTimeout(notifyclock, 60000);
    }
}

function hide_notiblock() {
    notifymarkcount(true);
    $('.notification-icon').removeClass('active');
    $('.notification-popup').addClass('hidden');
}

function popup(id, html) {
    $('#popnotifications').append(html);
    $('#popup_' + id).css('bottom', ($('.nt-popup').length * 61) - 50 + 'px');
    $('#popup_' + id).css('opacity', 0).show().animate({
        opacity: 1
    });
    setTimeout(hide_notipop, 5000, id);
}

function hide_notipop(id) {
    if ((id) && ($('#popup_' + id).css('opacity') == 1)) {
        $('#popup_' + id).css('opacity', 1).show().animate({
            opacity: 0
        });
        setTimeout(remove_notipop, 1000);
    }
}
var click_noti_id = false;

function click_noti(id) {
    click_noti_id = id;
    hide_notipop(id);
}

function remove_notipop() {
    $('.nt-popup').each(function(id, el) {
        if ($(el).css('opacity') == 0) $(el).remove();
    });
}

function notifymarkcount(nread) {
    var a = 0;
    for (i in notifications) {
        var n = notifications[i];
        n.count = true;
        if (nread && !n.read) {
            n.read = true;
            a++;
        }
    }
    if (nread && $.maxnotification !== maxaction && a > 0) {
        $.maxnotification = maxaction;
        api_req({
            a: 'sla',
            i: requesti
        });
    }
}

function render_notifications() {
    for (i in notifications) {
        var n = notifications[i];
        n.count = true;
    }
}

function ntdatehtml(timestamp) {
    var months = [
        l[850],
        l[851],
        l[852],
        l[853],
        l[854],
        l[855],
        l[856],
        l[857],
        l[858],
        l[859],
        l[860],
        l[861]
    ];
    var month = months[new Date(timestamp).getMonth()];
    var day = new Date(timestamp).getDate();
    return '<div class="nt-circle-bg1"><div class="nt-circle-bg2"><div class="nt-circle-bg3"><span class="nt-circle-date">' + day + '</span><span class="nt-circle-month">' + month + '</span></div></div></div>';
}

function notificationhtml(id, type, title, time, read) {
    var className = '',
        rhtml = '',
        phtml = '',
        nread = '',
        href = '',
        nstyle = '',
        nstyle2 = '',
        onclick = '',
        nhtml = '';
    if (read) nread = 'read';
    if (type == 'share') {
        className = 'nt-incoming-share';
        nstyle2 = 'style="cursor:pointer;"';
    } else if (type == 'put') {
        className = 'nt-new-files';
        nstyle2 = 'style="cursor:pointer;"';
    } else if (type == 'dshare') {
        className = 'nt-revocation-of-incoming';
        nstyle = 'style="cursor:default;"';
    }
    rhtml += '<a class="notification-item ' + className + ' ' + nread + '" ' + nstyle + ' id="' + htmlentities(id) + '">';
    rhtml += '<span class="notification-status-icon">';
    rhtml += '<span class="notification-type">';
    rhtml += '<span class="notification-content">';
    rhtml += '<span class="notification-info">' + title + '</span>';
    rhtml += '<span class="notification-date">' + time2last(time) + '</span>';
    rhtml += '</span></span></span></a>';
    phtml += '<div class="nt-popup ' + className + '" id="popup_' + id + '">'
    phtml += '<div class="notification-type">'
    phtml += '<div class="notification-content">';
    phtml += '<div class="nt-popup-close"></div>';
    phtml += '<div class="notification-info" ' + nstyle2 + '>' + title + '</div>';
    phtml += '</div></div></div>';
    nhtml += '<div class="nt-main-date">' + time2last(time) + '</div>';
    nhtml += '<div class="nt-info-block" id="no_' + id + '">';
    nhtml += '<div class="nt-info-connector"></div>';
    nhtml += '<div class="notification-type ' + className + '" ' + nstyle2 + ' id="type_' + htmlentities(id) + '"></div>';
    nhtml += '<div class="nt-info-txt" ' + nstyle2 + ' id="txt_' + htmlentities(id) + '">' + title + '</div>';
    nhtml += '<div class="clear"></div></div><div class="clear"></div>';
    var r = {
        nhtml: nhtml,
        rhtml: rhtml,
        phtml: phtml
    };
    return r;
}

function donotifypopup(id, html) {
    $('#popnotifications').append(html);
    $('#popup_' + id).css('bottom', ($('.nt-popup').length * 61) - 50 + 'px');
    $('#popup_' + id).css('opacity', 0).show().animate({
        opacity: 1
    });
    $('.nt-popup').bind('unbind');
    $('.nt-popup').bind('click', function(e) {
        var id = $(this).attr('id');
        if (id) {
            id = id.replace('popup_', '');
            for (var i in notifications) {
                if (notifications[i].id == id && (notifications[i].type == 'put' || notifications[i].type == 'share')) {
                    $.selected = [];
                    for (var j in notifications[i].nodes) $.selected.push(notifications[i].nodes[j].h);
                    M.openFolder(notifications[i].folderid);
                    reselect(1);
                }
            }
            hide_notipop(id);
        }
    });
    setTimeout(hide_notipop, 5000, id);
}

function initNotifications() {
    if (typeof notifications !== 'undefined' && notifications.length > 0) $('.cloud-popup-icon').show();
    //else $('.cloud-popup-icon').hide();
    $('.cloud-popup-icon').unbind('click');
    $('.cloud-popup-icon').bind('click', function() {
        if ($(this).attr('class').indexOf('active') == -1) {
            $(this).addClass('active');
            $('.notification-popup').css('left', $(this).position().left);
            $('.notification-popup').removeClass('hidden');
            notifyclock();
            donotify();
        } else {
            notifymarkcount(true);
            notifycounter();
            $(this).removeClass('active');
            $('.notification-popup').addClass('hidden');
        }
    });
    $('.notifications-button').unbind('click');
    $('.notifications-button').bind('click', function(e) {
        $('.cloud-popup-icon').removeClass('active');
        $('.notification-popup').addClass('hidden');
        document.location.hash = 'fm/notifications';
    });
    notifycounter();
}(function() {
    var n = this,
        t = n._,
        r = {},
        e = Array.prototype,
        u = Object.prototype,
        i = Function.prototype,
        a = e.push,
        o = e.slice,
        c = e.concat,
        l = u.toString,
        f = u.hasOwnProperty,
        s = e.forEach,
        p = e.map,
        h = e.reduce,
        v = e.reduceRight,
        d = e.filter,
        g = e.every,
        m = e.some,
        y = e.indexOf,
        b = e.lastIndexOf,
        x = Array.isArray,
        _ = Object.keys,
        j = i.bind,
        w = function(n) {
            return n instanceof w ? n : this instanceof w ? (this._wrapped = n, void 0) : new w(n)
        };
    'undefined' != typeof exports ? ('undefined' != typeof module && module.exports && (exports = module.exports = w), exports._ = w) : n._ = w,
    w.VERSION = '1.4.4';
    var A = w.each = w.forEach = function(n, t, e) {
        if (null != n)
            if (s && n.forEach === s)
                n.forEach(t, e);
            else if (n.length === +n.length) {
            for (var u = 0, i = n.length; i > u; u++)
                if (t.call(e, n[u], u, n) === r)
                    return
        } else
            for (var a in n)
                if (w.has(n, a) && t.call(e, n[a], a, n) === r)
                    return
    };
    w.map = w.collect = function(n, t, r) {
        var e = [];
        return null == n ? e : p && n.map === p ? n.map(t, r) : (A(n, function(n, u, i) {
            e[e.length] = t.call(r, n, u, i)
        }), e)
    };
    var O = 'Reduce of empty array with no initial value';
    w.reduce = w.foldl = w.inject = function(n, t, r, e) {
        var u = arguments.length > 2;
        if (null == n && (n = []), h && n.reduce === h)
            return e && (t = w.bind(t, e)),
                u ? n.reduce(t, r) : n.reduce(t);
        if (A(n, function(n, i, a) {
            u ? r = t.call(e, r, n, i, a) : (r = n, u = !0)
        }), !u)
            throw new TypeError(O);
        return r
    },
    w.reduceRight = w.foldr = function(n, t, r, e) {
        var u = arguments.length > 2;
        if (null == n && (n = []), v && n.reduceRight === v)
            return e && (t = w.bind(t, e)),
                u ? n.reduceRight(t, r) : n.reduceRight(t);
        var i = n.length;
        if (i !== +i) {
            var a = w.keys(n);
            i = a.length
        }
        if (A(n, function(o, c, l) {
            c = a ? a[--i] : --i,
            u ? r = t.call(e, r, n[c], c, l) : (r = n[c], u = !0)
        }), !u)
            throw new TypeError(O);
        return r
    },
    w.find = w.detect = function(n, t, r) {
        var e;
        return E(n, function(n, u, i) {
                return t.call(r, n, u, i) ? (e = n, !0) : void 0
            }),
            e
    },
    w.filter = w.select = function(n, t, r) {
        var e = [];
        return null == n ? e : d && n.filter === d ? n.filter(t, r) : (A(n, function(n, u, i) {
            t.call(r, n, u, i) && (e[e.length] = n)
        }), e)
    },
    w.reject = function(n, t, r) {
        return w.filter(n, function(n, e, u) {
            return !t.call(r, n, e, u)
        }, r)
    },
    w.every = w.all = function(n, t, e) {
        t || (t = w.identity);
        var u = !0;
        return null == n ? u : g && n.every === g ? n.every(t, e) : (A(n, function(n, i, a) {
            return (u = u && t.call(e, n, i, a)) ? void 0 : r
        }), !!u)
    };
    var E = w.some = w.any = function(n, t, e) {
        t || (t = w.identity);
        var u = !1;
        return null == n ? u : m && n.some === m ? n.some(t, e) : (A(n, function(n, i, a) {
            return u || (u = t.call(e, n, i, a)) ? r : void 0
        }), !!u)
    };
    w.contains = w.include = function(n, t) {
        return null == n ? !1 : y && n.indexOf === y ? n.indexOf(t) != -1 : E(n, function(n) {
            return n === t
        })
    },
    w.invoke = function(n, t) {
        var r = o.call(arguments, 2),
            e = w.isFunction(t);
        return w.map(n, function(n) {
            return (e ? t : n[t]).apply(n, r)
        })
    },
    w.pluck = function(n, t) {
        return w.map(n, function(n) {
            return n[t]
        })
    },
    w.where = function(n, t, r) {
        return w.isEmpty(t) ? r ? null : [] : w[r ? 'find' : 'filter'](n, function(n) {
            for (var r in t)
                if (t[r] !== n[r])
                    return !1;
            return !0
        })
    },
    w.findWhere = function(n, t) {
        return w.where(n, t, !0)
    },
    w.max = function(n, t, r) {
        if (!t && w.isArray(n) && n[0] === +n[0] && 65535 > n.length)
            return Math.max.apply(Math, n);
        if (!t && w.isEmpty(n))
            return -1 / 0;
        var e = {
            computed: -1 / 0,
            value: -1 / 0
        };
        return A(n, function(n, u, i) {
                var a = t ? t.call(r, n, u, i) : n;
                a >= e.computed && (e = {
                    value: n,
                    computed: a
                })
            }),
            e.value
    },
    w.min = function(n, t, r) {
        if (!t && w.isArray(n) && n[0] === +n[0] && 65535 > n.length)
            return Math.min.apply(Math, n);
        if (!t && w.isEmpty(n))
            return 1 / 0;
        var e = {
            computed: 1 / 0,
            value: 1 / 0
        };
        return A(n, function(n, u, i) {
                var a = t ? t.call(r, n, u, i) : n;
                e.computed > a && (e = {
                    value: n,
                    computed: a
                })
            }),
            e.value
    },
    w.shuffle = function(n) {
        var t,
            r = 0,
            e = [];
        return A(n, function(n) {
                t = w.random(r++),
                e[r - 1] = e[t],
                e[t] = n
            }),
            e
    };
    var k = function(n) {
        return w.isFunction(n) ? n : function(t) {
            return t[n]
        }
    };
    w.sortBy = function(n, t, r) {
        var e = k(t);
        return w.pluck(w.map(n, function(n, t, u) {
            return {
                value: n,
                index: t,
                criteria: e.call(r, n, t, u)
            }
        }).sort(function(n, t) {
            var r = n.criteria,
                e = t.criteria;
            if (r !== e) {
                if (r > e || r === void 0)
                    return 1;
                if (e > r || e === void 0)
                    return -1
            }
            return n.index < t.index ? -1 : 1
        }), 'value')
    };
    var F = function(n, t, r, e) {
        var u = {},
            i = k(t || w.identity);
        return A(n, function(t, a) {
                var o = i.call(r, t, a, n);
                e(u, o, t)
            }),
            u
    };
    w.groupBy = function(n, t, r) {
        return F(n, t, r, function(n, t, r) {
            (w.has(n, t) ? n[t] : n[t] = []).push(r)
        })
    },
    w.countBy = function(n, t, r) {
        return F(n, t, r, function(n, t) {
            w.has(n, t) || (n[t] = 0),
            n[t]++
        })
    },
    w.sortedIndex = function(n, t, r, e) {
        r = null == r ? w.identity : k(r);
        for (var u = r.call(e, t), i = 0, a = n.length; a > i;) {
            var o = i + a >>> 1;
            u > r.call(e, n[o]) ? i = o + 1 : a = o
        }
        return i
    },
    w.toArray = function(n) {
        return n ? w.isArray(n) ? o.call(n) : n.length === +n.length ? w.map(n, w.identity) : w.values(n) : []
    },
    w.size = function(n) {
        return null == n ? 0 : n.length === +n.length ? n.length : w.keys(n).length
    },
    w.first = w.head = w.take = function(n, t, r) {
        return null == n ? void 0 : null == t || r ? n[0] : o.call(n, 0, t)
    },
    w.initial = function(n, t, r) {
        return o.call(n, 0, n.length - (null == t || r ? 1 : t))
    },
    w.last = function(n, t, r) {
        return null == n ? void 0 : null == t || r ? n[n.length - 1] : o.call(n, Math.max(n.length - t, 0))
    },
    w.rest = w.tail = w.drop = function(n, t, r) {
        return o.call(n, null == t || r ? 1 : t)
    },
    w.compact = function(n) {
        return w.filter(n, w.identity)
    };
    var R = function(n, t, r) {
        return A(n, function(n) {
                w.isArray(n) ? t ? a.apply(r, n) : R(n, t, r) : r.push(n)
            }),
            r
    };
    w.flatten = function(n, t) {
        return R(n, t, [])
    },
    w.without = function(n) {
        return w.difference(n, o.call(arguments, 1))
    },
    w.uniq = w.unique = function(n, t, r, e) {
        w.isFunction(t) && (e = r, r = t, t = !1);
        var u = r ? w.map(n, r, e) : n,
            i = [],
            a = [];
        return A(u, function(r, e) {
                (t ? e && a[a.length - 1] === r : w.contains(a, r)) || (a.push(r), i.push(n[e]))
            }),
            i
    },
    w.union = function() {
        return w.uniq(c.apply(e, arguments))
    },
    w.intersection = function(n) {
        var t = o.call(arguments, 1);
        return w.filter(w.uniq(n), function(n) {
            return w.every(t, function(t) {
                return w.indexOf(t, n) >= 0
            })
        })
    },
    w.difference = function(n) {
        var t = c.apply(e, o.call(arguments, 1));
        return w.filter(n, function(n) {
            return !w.contains(t, n)
        })
    },
    w.zip = function() {
        for (var n = o.call(arguments), t = w.max(w.pluck(n, 'length')), r = Array(t), e = 0; t > e; e++)
            r[e] = w.pluck(n, '' + e);
        return r
    },
    w.object = function(n, t) {
        if (null == n)
            return {};
        for (var r = {}, e = 0, u = n.length; u > e; e++)
            t ? r[n[e]] = t[e] : r[n[e][0]] = n[e][1];
        return r
    },
    w.indexOf = function(n, t, r) {
        if (null == n)
            return -1;
        var e = 0,
            u = n.length;
        if (r) {
            if ('number' != typeof r)
                return e = w.sortedIndex(n, t),
                    n[e] === t ? e : -1;
            e = 0 > r ? Math.max(0, u + r) : r
        }
        if (y && n.indexOf === y)
            return n.indexOf(t, r);
        for (; u > e; e++)
            if (n[e] === t)
                return e;
        return -1
    },
    w.lastIndexOf = function(n, t, r) {
        if (null == n)
            return -1;
        var e = null != r;
        if (b && n.lastIndexOf === b)
            return e ? n.lastIndexOf(t, r) : n.lastIndexOf(t);
        for (var u = e ? r : n.length; u--;)
            if (n[u] === t)
                return u;
        return -1
    },
    w.range = function(n, t, r) {
        1 >= arguments.length && (t = n || 0, n = 0),
        r = arguments[2] || 1;
        for (var e = Math.max(Math.ceil((t - n) / r), 0), u = 0, i = Array(e); e > u;)
            i[u++] = n,
            n += r;
        return i
    },
    w.bind = function(n, t) {
        if (n.bind === j && j)
            return j.apply(n, o.call(arguments, 1));
        var r = o.call(arguments, 2);
        return function() {
            return n.apply(t, r.concat(o.call(arguments)))
        }
    },
    w.partial = function(n) {
        var t = o.call(arguments, 1);
        return function() {
            return n.apply(this, t.concat(o.call(arguments)))
        }
    },
    w.bindAll = function(n) {
        var t = o.call(arguments, 1);
        return 0 === t.length && (t = w.functions(n)),
            A(t, function(t) {
                n[t] = w.bind(n[t], n)
            }),
            n
    },
    w.memoize = function(n, t) {
        var r = {};
        return t || (t = w.identity),
            function() {
                var e = t.apply(this, arguments);
                return w.has(r, e) ? r[e] : r[e] = n.apply(this, arguments)
            }
    },
    w.delay = function(n, t) {
        var r = o.call(arguments, 2);
        return setTimeout(function() {
            return n.apply(null, r)
        }, t)
    },
    w.defer = function(n) {
        return w.delay.apply(w, [
            n,
            1
        ].concat(o.call(arguments, 1)))
    },
    w.throttle = function(n, t) {
        var r,
            e,
            u,
            i,
            a = 0,
            o = function() {
                a = new Date,
                u = null,
                i = n.apply(r, e)
            };
        return function() {
            var c = new Date,
                l = t - (c - a);
            return r = this,
                e = arguments,
                0 >= l ? (clearTimeout(u), u = null, a = c, i = n.apply(r, e)) : u || (u = setTimeout(o, l)),
                i
        }
    },
    w.debounce = function(n, t, r) {
        var e,
            u;
        return function() {
            var i = this,
                a = arguments,
                o = function() {
                    e = null,
                    r || (u = n.apply(i, a))
                },
                c = r && !e;
            return clearTimeout(e),
                e = setTimeout(o, t),
                c && (u = n.apply(i, a)),
                u
        }
    },
    w.once = function(n) {
        var t,
            r = !1;
        return function() {
            return r ? t : (r = !0, t = n.apply(this, arguments), n = null, t)
        }
    },
    w.wrap = function(n, t) {
        return function() {
            var r = [
                n
            ];
            return a.apply(r, arguments),
                t.apply(this, r)
        }
    },
    w.compose = function() {
        var n = arguments;
        return function() {
            for (var t = arguments, r = n.length - 1; r >= 0; r--)
                t = [
                    n[r].apply(this, t)
                ];
            return t[0]
        }
    },
    w.after = function(n, t) {
        return 0 >= n ? t() : function() {
            return 1 > --n ? t.apply(this, arguments) : void 0
        }
    },
    w.keys = _ || function(n) {
        if (n !== Object(n))
            throw new TypeError('Invalid object');
        var t = [];
        for (var r in n)
            w.has(n, r) && (t[t.length] = r);
        return t
    },
    w.values = function(n) {
        var t = [];
        for (var r in n)
            w.has(n, r) && t.push(n[r]);
        return t
    },
    w.pairs = function(n) {
        var t = [];
        for (var r in n)
            w.has(n, r) && t.push([r,
                n[r]
            ]);
        return t
    },
    w.invert = function(n) {
        var t = {};
        for (var r in n)
            w.has(n, r) && (t[n[r]] = r);
        return t
    },
    w.functions = w.methods = function(n) {
        var t = [];
        for (var r in n)
            w.isFunction(n[r]) && t.push(r);
        return t.sort()
    },
    w.extend = function(n) {
        return A(o.call(arguments, 1), function(t) {
                if (t)
                    for (var r in t)
                        n[r] = t[r]
            }),
            n
    },
    w.pick = function(n) {
        var t = {},
            r = c.apply(e, o.call(arguments, 1));
        return A(r, function(r) {
                r in n && (t[r] = n[r])
            }),
            t
    },
    w.omit = function(n) {
        var t = {},
            r = c.apply(e, o.call(arguments, 1));
        for (var u in n)
            w.contains(r, u) || (t[u] = n[u]);
        return t
    },
    w.defaults = function(n) {
        return A(o.call(arguments, 1), function(t) {
                if (t)
                    for (var r in t)
                        null == n[r] && (n[r] = t[r])
            }),
            n
    },
    w.clone = function(n) {
        return w.isObject(n) ? w.isArray(n) ? n.slice() : w.extend({}, n) : n
    },
    w.tap = function(n, t) {
        return t(n),
            n
    };
    var I = function(n, t, r, e) {
        if (n === t)
            return 0 !== n || 1 / n == 1 / t;
        if (null == n || null == t)
            return n === t;
        n instanceof w && (n = n._wrapped),
        t instanceof w && (t = t._wrapped);
        var u = l.call(n);
        if (u != l.call(t))
            return !1;
        switch (u) {
            case '[object String]':
                return n == t + '';
            case '[object Number]':
                return n != +n ? t != +t : 0 == n ? 1 / n == 1 / t : n == +t;
            case '[object Date]':
            case '[object Boolean]':
                return +n == +t;
            case '[object RegExp]':
                return n.source == t.source && n.global == t.global && n.multiline == t.multiline && n.ignoreCase == t.ignoreCase
        }
        if ('object' != typeof n || 'object' != typeof t)
            return !1;
        for (var i = r.length; i--;)
            if (r[i] == n)
                return e[i] == t;
        r.push(n),
        e.push(t);
        var a = 0,
            o = !0;
        if ('[object Array]' == u) {
            if (a = n.length, o = a == t.length)
                for (; a-- && (o = I(n[a], t[a], r, e)););
        } else {
            var c = n.constructor,
                f = t.constructor;
            if (c !== f && !(w.isFunction(c) && c instanceof c && w.isFunction(f) && f instanceof f))
                return !1;
            for (var s in n)
                if (w.has(n, s) && (a++, !(o = w.has(t, s) && I(n[s], t[s], r, e))))
                    break;
            if (o) {
                for (s in t)
                    if (w.has(t, s) && !a--)
                        break;
                o = !a
            }
        }
        return r.pop(),
            e.pop(),
            o
    };
    w.isEqual = function(n, t) {
        return I(n, t, [], [])
    },
    w.isEmpty = function(n) {
        if (null == n)
            return !0;
        if (w.isArray(n) || w.isString(n))
            return 0 === n.length;
        for (var t in n)
            if (w.has(n, t))
                return !1;
        return !0
    },
    w.isElement = function(n) {
        return !(!n || 1 !== n.nodeType)
    },
    w.isArray = x || function(n) {
        return '[object Array]' == l.call(n)
    },
    w.isObject = function(n) {
        return n === Object(n)
    },
    A(['Arguments',
        'Function',
        'String',
        'Number',
        'Date',
        'RegExp'
    ], function(n) {
        w['is' + n] = function(t) {
            return l.call(t) == '[object ' + n + ']'
        }
    }),
    w.isArguments(arguments) || (w.isArguments = function(n) {
        return !(!n || !w.has(n, 'callee'))
    }),
        'function' != typeof / . / && (w.isFunction = function(n) {
            return 'function' == typeof n
        }),
    w.isFinite = function(n) {
        return isFinite(n) && !isNaN(parseFloat(n))
    },
    w.isNaN = function(n) {
        return w.isNumber(n) && n != +n
    },
    w.isBoolean = function(n) {
        return n === !0 || n === !1 || '[object Boolean]' == l.call(n)
    },
    w.isNull = function(n) {
        return null === n
    },
    w.isUndefined = function(n) {
        return n === void 0
    },
    w.has = function(n, t) {
        return f.call(n, t)
    },
    w.noConflict = function() {
        return n._ = t,
            this
    },
    w.identity = function(n) {
        return n
    },
    w.times = function(n, t, r) {
        for (var e = Array(n), u = 0; n > u; u++)
            e[u] = t.call(r, u);
        return e
    },
    w.random = function(n, t) {
        return null == t && (t = n, n = 0),
            n + Math.floor(Math.random() * (t - n + 1))
    };
    var M = {
        escape: {
            '&': '&amp;',
            '<': '&lt;',
            '>': '&gt;',
            '"': '&quot;',
            '\'': '&#x27;',
            '/': '&#x2F;'
        }
    };
    M.unescape = w.invert(M.escape);
    var S = {
        escape: RegExp('[' + w.keys(M.escape).join('') + ']', 'g'),
        unescape: RegExp('(' + w.keys(M.unescape).join('|') + ')', 'g')
    };
    w.each(['escape',
        'unescape'
    ], function(n) {
        w[n] = function(t) {
            return null == t ? '' : ('' + t).replace(S[n], function(t) {
                return M[n][t]
            })
        }
    }),
    w.result = function(n, t) {
        if (null == n)
            return null;
        var r = n[t];
        return w.isFunction(r) ? r.call(n) : r
    },
    w.mixin = function(n) {
        A(w.functions(n), function(t) {
            var r = w[t] = n[t];
            w.prototype[t] = function() {
                var n = [
                    this._wrapped
                ];
                return a.apply(n, arguments),
                    D.call(this, r.apply(w, n))
            }
        })
    };
    var N = 0;
    w.uniqueId = function(n) {
        var t = ++N + '';
        return n ? n + t : t
    },
    w.template = function(n, t, r) {
        var e;
        r = w.defaults({}, r);
        var u = RegExp([(r.escape || T).source, (r.interpolate || T).source, (r.evaluate || T).source].join('|') + '|$', 'g'),
            i = 0,
            a = '__p+=\'';
        n.replace(u, function(t, r, e, u, o) {
            return a += n.slice(i, o).replace(B, function(n) {
                    return '\\' + q[n]
                }),
                r && (a += '\'+\n((__t=(' + r + '))==null?\'\':_.escape(__t))+\n\''),
                e && (a += '\'+\n((__t=(' + e + '))==null?\'\':__t)+\n\''),
                u && (a += '\';\n' + u + '\n__p+=\''),
                i = o + t.length,
                t
        }),
        a += '\';\n',
        r.variable || (a = 'with(obj||{}){\n' + a + '}\n'),
        a = 'var __t,__p=\'\',__j=Array.prototype.join,' + 'print=function(){__p+=__j.call(arguments,\'\');};\n' + a + 'return __p;\n';
        try {
            e = Function(r.variable || 'obj', '_', a)
        } catch (o) {
            throw o.source = a,
            o
        }
        if (t)
            return e(t, w);
        var c = function(n) {
            return e.call(this, n, w)
        };
        return c.source = 'function(' + (r.variable || 'obj') + '){\n' + a + '}',
            c
    },
    w.chain = function(n) {
        return w(n).chain()
    };
    var D = function(n) {
        return this._chain ? w(n).chain() : n
    };
    w.mixin(w),
    A(['pop',
        'push',
        'reverse',
        'shift',
        'sort',
        'splice',
        'unshift'
    ], function(n) {
        var t = e[n];
        w.prototype[n] = function() {
            var r = this._wrapped;
            return t.apply(r, arguments),
                'shift' != n && 'splice' != n || 0 !== r.length || delete r[0],
                D.call(this, r)
        }
    }),
    A(['concat',
        'join',
        'slice'
    ], function(n) {
        var t = e[n];
        w.prototype[n] = function() {
            return D.call(this, t.apply(this._wrapped, arguments))
        }
    }),
    w.extend(w.prototype, {
        chain: function() {
            return this._chain = !0,
                this
        },
        value: function() {
            return this._wrapped
        }
    })
}).call(this);
window.CanvasCropper = (function() {
    function CanvasCropper(width, height) {
        if (!CanvasCropper.isSupported()) {
            throw new Error('This browser doesn\'t support CanvasCropper.');
        }
        return this.init.apply(this, arguments);
    }
    var supportsCanvas = (function() {
        var canvas = document.createElement('canvas');
        return (typeof canvas.getContext === 'function') && canvas.getContext('2d');
    }());
    CanvasCropper.isSupported = function() {
        return supportsCanvas;
    };
    CanvasCropper.prototype.defaults = {
        outputFormat: 'image/jpeg',
        backgroundFillColor: undefined
    };
    CanvasCropper.prototype.init = function(width, height, opts) {
        this.width = width;
        this.height = height || width;
        this.options = $.extend({}, this.defaults, opts);
        this.canvas = $('<canvas/>').attr('width', this.width).attr('height', this.height)[0];
        return this;
    };
    CanvasCropper.prototype.cropToDataURI = function(image, sourceX, sourceY, cropWidth, cropHeight) {
        return this.crop(image, sourceX, sourceY, cropWidth, cropHeight).getDataURI(this.options.outputFormat);
    };
    CanvasCropper.prototype.crop = function(image, sourceX, sourceY, cropWidth, cropHeight) {
        var context = this.canvas.getContext('2d'),
            targetX = 0,
            targetY = 0,
            targetWidth = this.width,
            targetHeight = this.height;
        context.clearRect(targetX, targetY, targetWidth, targetHeight);
        if (this.options.backgroundFillColor) {
            context.fillStyle = this.options.backgroundFillColor;
            context.fillRect(targetX, targetY, targetWidth, targetHeight);
        }
        if (sourceX < 0) {
            targetX = Math.round((Math.abs(sourceX) / cropWidth) * targetWidth);
            sourceX = 0;
        }
        if (sourceY < 0) {
            targetY = Math.round((Math.abs(sourceY) / cropHeight) * targetHeight);
            sourceY = 0;
        }
        if (sourceX + cropWidth > image.naturalWidth) {
            var newCropWidth = image.naturalWidth - sourceX;
            targetWidth *= newCropWidth / cropWidth;
            cropWidth = newCropWidth;
        }
        if (sourceY + cropHeight > image.naturalHeight) {
            var newCropHeight = image.naturalHeight - sourceY;
            targetHeight *= newCropHeight / cropHeight;
            cropHeight = newCropHeight;
        }
        context.canvas.width = 250;
        context.canvas.height = 250;
        context.drawImage(image, sourceX, sourceY, cropWidth, cropHeight, targetX, targetY, 250, 250);
        return this;
    };
    CanvasCropper.prototype.getDataURI = function(outputFormat) {
        if (outputFormat) {
            return this.canvas.toDataURL('image/jpeg', 0.85);
        }
    };
    return CanvasCropper;
})();
window.ClientFileHandler = (function() {
    function ClientFileHandler(opts) {
        return this.init(opts);
    }
    ClientFileHandler.typeFilters = {
        all: /.*/,
        application: /^application\/.*/,
        audio: /^audio\/.*/,
        image: /^image\/.*/,
        imageWeb: /^image\/(jpeg|png|gif)$/,
        text: /^text\/.*/,
        video: /^video\/.*/
    };
    ClientFileHandler.prototype.defaults = {
        fileTypeFilter: ClientFileHandler.typeFilters.all,
        fileCountLimit: Infinity,
        fileSizeLimit: 20 * 1024 * 1024,
        onSuccess: $.noop,
        onError: $.noop
    };
    ClientFileHandler.prototype.init = function(opts) {
        this.options = $.extend({}, this.defaults, opts);
        if (opts && !opts.fileSizeLimit) {
            this.options.fileSizeLimit = this.defaults.fileSizeLimit;
        }
        if (opts && !opts.fileCountLimit) {
            this.options.fileCountLimit = this.defaults.fileCountLimit;
        }
        _.bindAll(this);
        return this;
    };
    ClientFileHandler.prototype.handleFiles = function(fileList, fileSourceElem) {
        var filteredFiles = this.filterFiles(fileList);
        if (filteredFiles.valid.length > 0) {
            _.isFunction(this.options.onSuccess) && this.options.onSuccess(filteredFiles.valid);
        } else {
            _.isFunction(this.options.onError) && this.options.onError(filteredFiles.invalid);
        }
    };
    ClientFileHandler.prototype.filterFiles = function(fileList) {
        var fileTypeFilter = _.isRegExp(this.options.fileTypeFilter) ? this.options.fileTypeFilter : this.defaults.fileTypeFilter,
            fileSizeLimit = this.options.fileSizeLimit,
            invalid = {
                byType: [],
                bySize: [],
                byCount: []
            },
            valid = _.filter(fileList, function(file) {
                if (!fileTypeFilter.test(file.type)) {
                    invalid.byType.push(file);
                    return false;
                }
                if (file.size > fileSizeLimit) {
                    invalid.bySize.push(file);
                    return false;
                }
                return true;
            });
        if (valid.length > this.options.fileCountLimit) {
            invalid.byCount = valid.slice(this.options.fileCountLimit);
            valid = valid.slice(0, this.options.fileCountLimit);
        }
        return {
            valid: valid,
            invalid: invalid
        };
    };
    return ClientFileHandler;
})();
window.ClientFileReader = (function() {
    var fileReaderSupport = !!(window.File && window.FileList && window.FileReader);
    var _readMethodMap = {
        ArrayBuffer: 'readAsArrayBuffer',
        BinaryString: 'readAsBinaryString',
        DataURL: 'readAsDataURL',
        Text: 'readAsText'
    };

    function ClientFileReader(opts) {
        if (!ClientFileReader.isSupported()) {
            throw new Error('ClientFileReader requires FileReaderAPI support');
        }
        return this.init(opts);
    }
    ClientFileReader.isSupported = function() {
        return fileReaderSupport;
    };
    $.extend(ClientFileReader.prototype, ClientFileHandler.prototype);
    ClientFileReader.readMethods = {
        ArrayBuffer: 'ArrayBuffer',
        BinaryString: 'BinaryString',
        DataURL: 'DataURL',
        Text: 'Text'
    };
    ClientFileReader.typeFilters = ClientFileHandler.typeFilters;
    ClientFileReader.prototype.defaults = $.extend({}, ClientFileHandler.prototype.defaults, {
        readMethod: ClientFileReader.readMethods.DataURL,
        onRead: $.noop
    });
    ClientFileReader.prototype.init = function(opts) {
        ClientFileHandler.prototype.init.call(this, opts);
        this.options.onSuccess = this.onSuccess;
        return this;
    };
    ClientFileReader.prototype.onSuccess = function(files) {
        var readMethod = _.has(_readMethodMap, this.options.readMethod) ? _readMethodMap[this.options.readMethod] : undefined;
        if (readMethod) {
            _.each(files, _.bind(function(file) {
                var fileReader = new FileReader();
                fileReader.onload = _.bind(this.readFile, this, file);
                fileReader[readMethod](file);
            }, this));
        }
    };
    ClientFileReader.prototype.readFile = function(file, fileReaderEvent) {
        _.isFunction(this.options.onRead) && this.options.onRead(fileReaderEvent.target.result, file);
    };
    return ClientFileReader;
})();
window.DragDropFileTarget = (function() {
    function DragDropFileTarget(el, opts) {
        return this.init.apply(this, arguments);
    }
    DragDropFileTarget.prototype.getDefaults = function() {
        return {
            activeDropTargetClass: 'active-drop-target',
            uploadPrompt: 'Drag a file here to upload',
            clientFileHandler: null
        };
    };
    DragDropFileTarget.prototype.init = function(el, opts) {
        _.bindAll(this, 'onDragOver', 'onDragEnd', 'onDrop');
        this.$target = $(el);
        this.options = $.extend({}, this.getDefaults(), opts);
        this.$target.attr('data-upload-prompt', this.options.uploadPrompt);
        this.$target.bind('dragover', this.onDragOver);
        this.$target.bind('dragleave', this.onDragEnd);
        this.$target.bind('dragend', this.onDragEnd);
        this.$target.bind('drop', this.onDrop);
    };
    DragDropFileTarget.prototype.onDragOver = function(e) {
        e.preventDefault();
        this.$target.addClass(this.options.activeDropTargetClass);
    };
    DragDropFileTarget.prototype.onDragEnd = function(e) {
        e.preventDefault();
        this.$target.removeClass(this.options.activeDropTargetClass);
    };
    DragDropFileTarget.prototype.onDrop = function(e) {
        e.preventDefault();
        e.originalEvent.preventDefault();
        this.$target.removeClass(this.options.activeDropTargetClass);
        if (this.options.clientFileHandler) {
            this.options.clientFileHandler.handleFiles(e.originalEvent.dataTransfer.files, e.originalEvent.target);
        }
    };
    return DragDropFileTarget;
})();
window.UploadInterceptor = (function() {
    function UploadInterceptor(el, opts) {
        return this.init.apply(this, arguments);
    }
    UploadInterceptor.prototype.defaults = {
        replacementEl: undefined,
        clientFileHandler: null
    };
    UploadInterceptor.prototype.init = function(el, opts) {
        _.bindAll(this, 'onSelectFile', 'onReplacementClick');
        this.$el = $(el);
        this.options = $.extend({}, this.defaults, opts);
        this.$el.bind('change', this.onSelectFile);
        if (this.options.replacementEl) {
            this.$replacement = $(this.options.replacementEl);
            this.$el.hide();
            if ($.browser && $.browser.msie) {
                if (!this.$replacement.is('label')) {
                    this.$replacement.hide();
                    this.$el.show();
                }
            } else {
                this.$replacement.bind('click', this.onReplacementClick);
            }
        }
    };
    UploadInterceptor.prototype.onSelectFile = function(e) {
        if ($(e.target).val() && this.options.clientFileHandler) {
            this.options.clientFileHandler.handleFiles(e.target.files, this.$el);
        }
    };
    UploadInterceptor.prototype.onReplacementClick = function(e) {
        e.preventDefault();
        this.$el.click();
    };
    UploadInterceptor.prototype.destroy = function() {
        this.$el.off('change', this.onSelectFile);
        this.$replacement.off('click', this.onReplacementClick);
    };
    return UploadInterceptor;
})();
window.ImageExplorer = (function() {
    function ImageExplorer($container, opts) {
        this.init.apply(this, arguments);
    }
    ImageExplorer.scaleModes = {
        fill: 'fill',
        contain: 'contain',
        containAndFill: 'containAndFill'
    };
    ImageExplorer.zoomModes = {
        localZoom: 'localZoom',
        imageZoom: 'imageZoom'
    };
    ImageExplorer.prototype.defaults = {
        initialScaleMode: ImageExplorer.scaleModes.containAndFill,
        zoomMode: ImageExplorer.zoomModes.localZoom,
        emptyClass: 'empty',
        scaleMax: 1
    };
    ImageExplorer.prototype.init = function($container, opts) {
        this.$container = $container;
        this.$imageView = this.$container.find('.image-explorer-image-view');
        this.$sourceImage = this.$container.find('.image-explorer-source');
        this.$mask = this.$container.find('.image-explorer-mask');
        this.$dragDelegate = this.$container.find('.image-explorer-drag-delegate');
        this.$scaleSlider = this.$container.find('.image-explorer-scale-slider');
        this.options = $.extend({}, this.defaults, opts);
        this.imageProperties = {};
        _.bindAll(this);
        this.toggleEmpty(true);
        if (this.$sourceImage[0].naturalWidth) {
            this.toggleEmpty(false);
            this.initImage({
                target: this.$sourceImage[0]
            });
        }
        this.$sourceImage.bind('load', this.initImage);
        this.initDragDelegate();
        this.initScaleSlider();
    };
    ImageExplorer.prototype.getImageSrc = function() {
        return (this.$sourceImage) ? this.$sourceImage.attr('src') : undefined;
    };
    ImageExplorer.prototype.setImageSrc = function(src) {
        if (this.$sourceImage) {
            this.$sourceImage.attr('src', '').attr('src', src);
        }
    };
    ImageExplorer.prototype.initImage = function(e) {
        var image = e.target;
        this.imageProperties.naturalWidth = image.naturalWidth;
        this.imageProperties.naturalHeight = image.naturalHeight;
        this._removeError();
        this.toggleEmpty(false);
        this.setInitialScale();
    };
    ImageExplorer.prototype.initDragDelegate = function() {
        var imageOffset;
        this.$dragDelegate.draggable({
            start: _.bind(function() {
                imageOffset = this.$sourceImage.offset();
            }, this),
            drag: _.bind(function(e, ui) {
                this.$sourceImage.offset({
                    top: imageOffset.top + ui.position.top - ui.originalPosition.top,
                    left: imageOffset.left + ui.position.left - ui.originalPosition.left
                });
            }, this),
            revert: true,
            revertDuration: 0
        });
    };
    ImageExplorer.prototype.initScaleSlider = function() {
        this.$scaleSlider.bind('change', _.bind(function(e) {
            this.updateImageScale(this.sliderValToScale(e.target.value));
        }, this));
    };
    ImageExplorer.prototype.setInitialScale = function() {
        var maskWidth = this.$mask.width(),
            maskHeight = this.$mask.height(),
            naturalWidth = this.imageProperties.naturalWidth,
            naturalHeight = this.imageProperties.naturalHeight,
            initialScale = 1;
        this.minScale = 1;
        switch (this.options.initialScaleMode) {
            case ImageExplorer.scaleModes.fill:
                this.minScale = initialScale = this.getFillScale(naturalWidth, naturalHeight, maskWidth, maskHeight);
                break;
            case ImageExplorer.scaleModes.contain:
                if (this.$mask.hasClass('circle-mask')) {
                    this.minScale = initialScale = this.getCircularContainedScale(naturalWidth, naturalHeight, maskWidth / 2);
                } else {
                    this.minScale = initialScale = this.getContainedScale(naturalWidth, naturalHeight, maskWidth, maskHeight);
                }
                break;
            case ImageExplorer.scaleModes.containAndFill:
                if (this.$mask.hasClass('circle-mask')) {
                    this.minScale = this.getCircularContainedScale(naturalWidth, naturalHeight, maskWidth / 2);
                } else {
                    this.minScale = this.getContainedScale(naturalWidth, naturalHeight, maskWidth, maskHeight);
                }
                initialScale = this.getFillScale(naturalWidth, naturalHeight, maskWidth, maskHeight);
                break;
        }
        this.maxScale = Math.max(initialScale, this.options.scaleMax);
        this.resetScaleSlider(this.scaleToSliderVal(initialScale));
        this.updateImageScale(initialScale, ImageExplorer.zoomModes.imageZoom);
        this.resetImagePosition();
    };
    ImageExplorer.prototype.getFillScale = function(imageWidth, imageHeight, constraintWidth, constraintHeight) {
        var widthRatio = constraintWidth / imageWidth,
            heightRatio = constraintHeight / imageHeight;
        return Math.max(widthRatio, heightRatio);
    };
    ImageExplorer.prototype.getContainedScale = function(imageWidth, imageHeight, constraintWidth, constraintHeight) {
        var widthRatio = constraintWidth / imageWidth,
            heightRatio = constraintHeight / imageHeight;
        return Math.min(widthRatio, heightRatio);
    };
    ImageExplorer.prototype.getCircularContainedScale = function(imageWidth, imageHeight, constraintRadius) {
        var theta = Math.atan(imageHeight / imageWidth),
            scaledWidth = Math.cos(theta) * constraintRadius * 2;
        return scaledWidth / imageWidth;
    };
    ImageExplorer.prototype.sliderValToScale = function(sliderValue) {
        var sliderValAsUnitInterval = sliderValue / (this.$scaleSlider.attr('max') - this.$scaleSlider.attr('min'));
        return this.minScale + (sliderValAsUnitInterval * (this.maxScale - this.minScale));
    };
    ImageExplorer.prototype.scaleToSliderVal = function(scale) {
        var sliderValAsUnitInterval = (scale - this.minScale) / (this.maxScale - this.minScale);
        return sliderValAsUnitInterval * (this.$scaleSlider.attr('max') - this.$scaleSlider.attr('min'));
    };
    ImageExplorer.prototype.updateImageScale = function(newScale, zoomMode) {
        var newWidth = Math.round(newScale * this.imageProperties.naturalWidth),
            newHeight = Math.round(newScale * this.imageProperties.naturalHeight),
            newMarginLeft,
            newMarginTop;
        zoomMode = zoomMode || this.options.zoomMode;
        switch (zoomMode) {
            case ImageExplorer.zoomModes.imageZoom:
                newMarginLeft = -1 * newWidth / 2;
                newMarginTop = -1 * newHeight / 2;
                break;
            case ImageExplorer.zoomModes.localZoom:
                var oldWidth = this.$sourceImage.width(),
                    oldHeight = this.$sourceImage.height(),
                    oldMarginLeft = parseInt(this.$sourceImage.css('margin-left'), 10),
                    oldMarginTop = parseInt(this.$sourceImage.css('margin-top'), 10),
                    sourceImagePosition = this.$sourceImage.position(),
                    imageViewCenterX = this.$imageView.width() / 2,
                    imageViewCenterY = this.$imageView.height() / 2,
                    oldImageFocusX = imageViewCenterX - sourceImagePosition.left - oldMarginLeft,
                    oldImageFocusY = imageViewCenterY - sourceImagePosition.top - oldMarginTop,
                    newImageFocusX = (oldImageFocusX / oldWidth) * newWidth,
                    newImageFocusY = (oldImageFocusY / oldHeight) * newHeight;
                newMarginLeft = imageViewCenterX - sourceImagePosition.left - newImageFocusX;
                newMarginTop = imageViewCenterY - sourceImagePosition.top - newImageFocusY;
                break;
        }
        this.$sourceImage.width(newWidth).height(newHeight).css({
            'margin-left': Math.round(newMarginLeft) + 'px',
            'margin-top': Math.round(newMarginTop) + 'px'
        });
    };
    ImageExplorer.prototype.resetImagePosition = function() {
        this.$sourceImage.css({
            top: '50%',
            left: '50%'
        });
    };
    ImageExplorer.prototype.resetScaleSlider = function(initialValue) {
        this.$scaleSlider.val(initialValue).removeClass('disabled').removeAttr('disabled');
    };
    ImageExplorer.prototype.toggleEmpty = function(toggle) {
        this.$container.toggleClass(this.options.emptyClass, toggle);
    };
    ImageExplorer.prototype.get$ImageView = function() {
        return this.$imageView;
    };
    ImageExplorer.prototype.get$SourceImage = function() {
        return this.$sourceImage;
    };
    ImageExplorer.prototype.get$Mask = function() {
        return this.$mask;
    };
    ImageExplorer.prototype.get$DragDelegate = function() {
        return this.$dragDelegate;
    };
    ImageExplorer.prototype.getMaskedImageProperties = function() {
        var currentScaleX = this.$sourceImage.width() / this.imageProperties.naturalWidth,
            currentScaleY = this.$sourceImage.height() / this.imageProperties.naturalHeight,
            maskPosition = this.$mask.position(),
            imagePosition = this.$sourceImage.position();
        maskPosition.top += parseInt(this.$mask.css('margin-top'), 10);
        maskPosition.left += parseInt(this.$mask.css('margin-left'), 10);
        imagePosition.top += parseInt(this.$sourceImage.css('margin-top'), 10);
        imagePosition.left += parseInt(this.$sourceImage.css('margin-left'), 10);
        return {
            maskedAreaImageX: Math.round((maskPosition.left - imagePosition.left) / currentScaleX),
            maskedAreaImageY: Math.round((maskPosition.top - imagePosition.top) / currentScaleY),
            maskedAreaWidth: Math.round(this.$mask.width() / currentScaleX),
            maskedAreaHeight: Math.round(this.$mask.height() / currentScaleY)
        };
    };
    ImageExplorer.prototype.showError = function(title, contents) {
        alert(title + ' ' + contents);
    };
    ImageExplorer.prototype.clearError = function() {
        this._removeError();
        this._resetFromError();
    };
    ImageExplorer.prototype.hasValidImage = function() {
        return !!(this.getImageSrc() && this.$sourceImage.prop('naturalWidth'));
    };
    ImageExplorer.prototype._resetFromError = function() {
        var hasValidImage = this.hasValidImage();
        this.toggleEmpty(!hasValidImage);
        this.$container.removeClass('error');
        _.isFunction(this.options.onErrorReset) && this.options.onErrorReset(hasValidImage ? this.getImageSrc() : undefined);
    };
    ImageExplorer.prototype._removeError = function() {
        this.$imageView.find('.aui-message.error').remove();
    };
    return ImageExplorer;
})();
window.ImageUploadAndCrop = (function() {
    function ImageUploadAndCrop($container, opts) {
        if (!ImageUploadAndCrop.isSupported()) {
            throw new Error('This browser doesn\'t support ImageUploadAndCrop.');
        }
        this.init.apply(this, arguments);
    }
    ImageUploadAndCrop.isSupported = function() {
        return CanvasCropper.isSupported();
    };
    ImageUploadAndCrop.prototype.defaults = {
        HiDPIMultiplier: 2,
        dragDropUploadPrompt: l[1390],
        onImageUpload: $.noop,
        onImageUploadError: $.noop,
        onCrop: $.noop,
        outputFormat: 'image/png',
        fallbackUploadOptions: {},
        initialScaleMode: ImageExplorer.scaleModes.containAndFill,
        scaleMax: 1,
        fileSizeLimit: 15 * 1024 * 1024,
        maxImageDimension: 5000
    };
    ImageUploadAndCrop.prototype.init = function($container, opts) {
        this.options = $.extend({}, this.defaults, opts);
        this.$container = $container;
        _.bindAll(this);
        this.imageExplorer = new ImageExplorer(this.$container.find('.image-explorer-container'), {
            initialScaleMode: this.options.initialScaleMode,
            scaleMax: this.options.scaleMax,
            onErrorReset: this._onErrorReset
        });
        if (ClientFileReader.isSupported()) {
            this.clientFileReader = new ClientFileReader({
                onRead: this._onFileProcessed,
                onError: this._onFilesError,
                fileTypeFilter: ClientFileReader.typeFilters.imageWeb,
                fileCountLimit: 1,
                fileSizeLimit: this.options.fileSizeLimit
            });
            this.dragDropFileTarget = new DragDropFileTarget(this.imageExplorer.get$ImageView(), {
                uploadPrompt: this.options.dragDropUploadPrompt,
                clientFileHandler: this.clientFileReader
            });
        } else {
            this.$container.addClass('filereader-unsupported');
            var fallbackOptions = $.extend({
                onUpload: this._onFileProcessed,
                onError: this._onFileError
            }, this.options.fallbackUploadOptions);
            this.clientFileReader = new ClientFileIframeUploader(fallbackOptions);
        }
        this.uploadIntercepter = new UploadInterceptor(this.$container.find('.image-upload-field'), {
            replacementEl: this.$container.find('.image-upload-field-replacement'),
            clientFileHandler: this.clientFileReader
        });
        var mask = this.imageExplorer.get$Mask();
        this.canvasCroppper = new CanvasCropper(mask.width() * this.options.HiDPIMultiplier, mask.height() * this.options.HiDPIMultiplier, {
            outputFormat: this.options.outputFormat
        });
        this.options.cropButton && $(this.options.cropButton).click(this.crop);
    };
    ImageUploadAndCrop.prototype.crop = function() {
        var cropProperties = this.imageExplorer.getMaskedImageProperties(),
            croppedDataURI = this.canvasCroppper.cropToDataURI(this.imageExplorer.get$SourceImage()[0], cropProperties.maskedAreaImageX, cropProperties.maskedAreaImageY, cropProperties.maskedAreaWidth, cropProperties.maskedAreaHeight);
        _.isFunction(this.options.onCrop) && this.options.onCrop(croppedDataURI);
    };
    ImageUploadAndCrop.prototype.resetState = function() {
        this.imageExplorer.clearError();
        this._resetFileUploadField();
    };
    ImageUploadAndCrop.prototype._onFileProcessed = function(imageSrc) {
        if (imageSrc) {
            if (!isNaN(this.options.maxImageDimension)) {
                var validatePromise = this.validateImageResolution(imageSrc);
                validatePromise.done(_.bind(function(imageWidth, imageHeight) {
                    this.setImageSrc(imageSrc);
                }, this)).fail(_.bind(function(imageWidth, imageHeight) {
                    this._onFileError('The selected image size is ' + imageWidth + 'px * ' + imageHeight + 'px. The maximum allowed image size is ' + this.options.maxImageDimension + 'px * ' + this.options.maxImageDimension + 'px');
                }, this));
            } else {
                this.setImageSrc(imageSrc);
            }
        } else {
            this._onFileError();
        }
    };
    ImageUploadAndCrop.prototype.setImageSrc = function(imageSrc) {
        this.imageExplorer.setImageSrc(imageSrc);
        _.isFunction(this.options.onImageUpload) && this.options.onImageUpload(imageSrc);
        this._resetFileUploadField();
    };
    ImageUploadAndCrop.prototype.validateImageResolution = function(imageSrc) {
        var validatePromise = $.Deferred(),
            tmpImage = new Image(),
            self = this;
        tmpImage.onload = function() {
            if (this.naturalWidth > self.options.maxImageDimension || this.naturalHeight > self.options.maxImageDimension) {
                validatePromise.reject(this.naturalWidth, this.naturalHeight);
            } else {
                validatePromise.resolve(this.naturalWidth, this.naturalHeight);
            }
        };
        tmpImage.src = imageSrc;
        return validatePromise;
    };
    ImageUploadAndCrop.prototype._onFilesError = function(invalidFiles) {
        if (invalidFiles && invalidFiles.bySize && invalidFiles.bySize.length) {
            var file = _.first(invalidFiles.bySize);
            this._onFileError('File "' + TextUtil.abbreviateText(file.name, 50) + '" is ' + TextUtil.formatSizeInBytes(file.size) + ' which is larger than the maximum allowed size of ' + TextUtil.formatSizeInBytes(this.options.fileSizeLimit));
        } else {
            this._onFileError();
        }
    };
    ImageUploadAndCrop.prototype._onFileError = function(error) {
        var title = 'There was an error uploading your image',
            contents = error || 'Please check that your file is a valid image and try again.';
        this.imageExplorer.showError(title, contents);
        this._resetFileUploadField();
        _.isFunction(this.options.onImageUploadError) && this.options.onImageUploadError(error);
    };
    ImageUploadAndCrop.prototype._resetFileUploadField = function() {
        var form = this.$container.find('#image-upload-and-crop-upload-field').prop('form');
        form && form.reset();
    };
    ImageUploadAndCrop.prototype._onErrorReset = function(imgSrc) {
        if (imgSrc) {
            _.isFunction(this.options.onImageUpload) && this.options.onImageUpload(imgSrc);
        }
    };
    return ImageUploadAndCrop;
})();
window.TextUtil = (function() {
    return {
        formatSizeInBytes: function(size) {
            var units = [
                    ' bytes',
                    'KB',
                    'MB',
                    'GB',
                    'TB',
                    'PB'
                ],
                magnitudeStep = 1024,
                orderOfMagnitude = 0,
                maxMagnitude = units.length - 1;
            size = (typeof size === 'number') ? size : parseInt(size, 10);
            if (isNaN(size)) {
                return '';
            }
            while (size >= magnitudeStep && orderOfMagnitude < maxMagnitude) {
                size /= magnitudeStep;
                orderOfMagnitude++;
            }
            size = Math.floor((size * 10)) / 10;
            return size + units[orderOfMagnitude];
        },
        abbreviateText: function(text, maxLength, opt_replacement) {
            if (typeof text !== 'string') {
                return undefined;
            }
            if (isNaN(maxLength) || maxLength < 0 || text.length <= maxLength) {
                return text;
            }
            var replacement = (typeof opt_replacement === 'string') ? opt_replacement : '-',
                removedCharCount = text.length - maxLength + replacement.length,
                textCenter = Math.round(text.length / 2);
            return text.substring(0, textCenter - Math.ceil(removedCharCount / 2)) + replacement +
                text.substring(textCenter + Math.floor(removedCharCount / 2), text.length);
        }
    };
})();
var isocountries = {
    'US': 'United States',
    'GB': 'United Kingdom',
    'CA': 'Canada',
    'AX': 'Aaland Islands',
    'AF': 'Afghanistan',
    'AP': 'African Regional Ind.Property organization',
    'AL': 'Albania',
    'DZ': 'Algeria',
    'AS': 'American Samoa',
    'AD': 'Andorra',
    'AO': 'Angola',
    'AI': 'Anguilla',
    'AQ': 'Antarctica',
    'AG': 'Antigua and Barbuda',
    'AR': 'Argentina',
    'AM': 'Armenia',
    'AW': 'Aruba',
    'AU': 'Australia',
    'AT': 'Austria',
    'AZ': 'Azerbaijan',
    'BS': 'Bahamas',
    'BH': 'Bahrain',
    'BD': 'Bangladesh',
    'BB': 'Barbados',
    'BY': 'Belarus',
    'BE': 'Belgium',
    'BZ': 'Belize',
    'BJ': 'Benin',
    'BM': 'Bermuda',
    'BT': 'Bhutan',
    'BO': 'Bolivia',
    'BA': 'Bosnia And Herzegowina',
    'BW': 'Botswana',
    'BV': 'Bouvet Island',
    'BR': 'Brazil',
    'IO': 'British Indian Ocean Territory',
    'BN': 'Brunei Darussalam',
    'BG': 'Bulgaria',
    'BF': 'Burkina Faso',
    'BI': 'Burundi',
    'KH': 'Cambodia',
    'CM': 'Cameroon',
    'CV': 'Cape Verde',
    'KY': 'Cayman Islands',
    'CF': 'Central African Republic',
    'TD': 'Chad',
    'CL': 'Chile',
    'CN': 'China',
    'CX': 'Christmas Island',
    'CC': 'Cocos(Keeling)Islands',
    'CO': 'Colombia',
    'KM': 'Comoros',
    'CG': 'Congo',
    'CD': 'Congo-Kinshasa',
    'CK': 'Cook Islands',
    'CR': 'Costa Rica',
    'CI': 'Cote D\'Ivoire',
    'HR': 'Croatia',
    'CU': 'Cuba',
    'CY': 'Cyprus',
    'CZ': 'Czech Republic',
    'DK': 'Denmark',
    'DJ': 'Djibouti',
    'DM': 'Dominica',
    'DO': 'Dominican Republic',
    'TL': 'East Timor',
    'EC': 'Ecuador',
    'EG': 'Egypt',
    'SV': 'El Salvador',
    'GQ': 'Equatorial Guinea',
    'ER': 'Eritrea',
    'EE': 'Estonia',
    'ET': 'Ethiopia',
    'FK': 'Falkland Islands',
    'FO': 'Faroe Islands',
    'FJ': 'Fiji',
    'FI': 'Finland',
    'FR': 'France',
    'FX': 'France Metropolitan',
    'GF': 'French Guiana',
    'PF': 'French Polynesia',
    'TF': 'French Southern Territories',
    'GA': 'Gabon',
    'GM': 'Gambia',
    'GE': 'Georgia',
    'DE': 'Germany',
    'GH': 'Ghana',
    'GI': 'Gibraltar',
    'GR': 'Greece',
    'GL': 'Greenland',
    'GD': 'Grenada',
    'GP': 'Guadeloupe',
    'GU': 'Guam',
    'GG': 'Guernsey',
    'GT': 'Guatemala',
    'GN': 'Guinea',
    'GW': 'Guinea-Bissau',
    'GY': 'Guyana',
    'HT': 'Haiti',
    'HN': 'Honduras',
    'HK': 'Hong Kong',
    'HU': 'Hungary',
    'IS': 'Iceland',
    'IN': 'India',
    'ID': 'Indonesia',
    'IR': 'Iran',
    'IQ': 'Iraq',
    'IE': 'Ireland',
    'IM': 'Isle of Man',
    'IL': 'Israel',
    'IT': 'Italy',
    'JM': 'Jamaica',
    'JP': 'Japan',
    'JE': 'Jersey',
    'JO': 'Jordan',
    'KZ': 'Kazakhstan',
    'KE': 'Kenya',
    'KI': 'Kiribati',
    'KW': 'Kuwait',
    'KG': 'Kyrgyzstan',
    'LA': 'Lao People\'s Republic',
    'LV': 'Latvia',
    'LB': 'Lebanon',
    'LS': 'Lesotho',
    'LR': 'Liberia',
    'LY': 'Libyan Arab Jamahiriya',
    'LI': 'Liechtenstein',
    'LT': 'Lithuania',
    'LU': 'Luxembourg',
    'MO': 'Macau',
    'MK': 'Macedonia',
    'MG': 'Madagascar',
    'MW': 'Malawi',
    'MY': 'Malaysia',
    'MV': 'Maldives',
    'ML': 'Mali',
    'MT': 'Malta',
    'MH': 'Marshall Islands',
    'MQ': 'Martinique',
    'MR': 'Mauritania',
    'MU': 'Mauritius',
    'YT': 'Mayotte',
    'MX': 'Mexico',
    'FM': 'Micronesia',
    'MD': 'Moldova',
    'MC': 'Monaco',
    'MN': 'Mongolia',
    'ME': 'Montenegro',
    'MS': 'Montserrat',
    'MA': 'Morocco',
    'MZ': 'Mozambique',
    'MM': 'Myanmar',
    'NA': 'Namibia',
    'NR': 'Nauru',
    'NP': 'Nepal',
    'NL': 'Netherlands',
    'AN': 'Netherlands Antilles',
    'NC': 'New Caledonia',
    'NZ': 'New Zealand',
    'NI': 'Nicaragua',
    'NE': 'Niger',
    'NG': 'Nigeria',
    'NU': 'Niue',
    'NF': 'Norfolk Island',
    'KP': 'North Korea',
    'MP': 'Northern Mariana Islands',
    'NO': 'Norway',
    'OM': 'Oman',
    'PK': 'Pakistan',
    'PW': 'Palau',
    'PS': 'Palestinian territories',
    'PA': 'Panama',
    'PG': 'Papua New Guinea',
    'PY': 'Paraguay',
    'PE': 'Peru',
    'PH': 'Philippines',
    'PN': 'Pitcairn',
    'PL': 'Poland',
    'PT': 'Portugal',
    'PR': 'Puerto Rico',
    'QA': 'Qatar',
    'RE': 'Reunion',
    'RO': 'Romania',
    'RU': 'Russian Federation',
    'RW': 'Rwanda',
    'MF': 'Saint Martin',
    'KN': 'Saint Kitts And Nevis',
    'LC': 'Saint Lucia',
    'VC': 'Saint Vincent And The Grenadines??Unknown',
    'WS': 'Samoa',
    'SM': 'San Marino',
    'ST': 'Sao Tome And Principe',
    'SA': 'Saudi Arabia',
    'SN': 'Senegal',
    'RS': 'Serbia',
    'SC': 'Seychelles',
    'SL': 'Sierra Leone',
    'SG': 'Singapore',
    'SK': 'Slovakia',
    'SI': 'Slovenia',
    'SB': 'Solomon Islands',
    'SO': 'Somalia',
    'ZA': 'South Africa',
    'GS': 'South Georgia/South Sandwich Islands',
    'KR': 'South Korea(Republic Of Korea)',
    'SS': 'South Sudan',
    'ES': 'Spain',
    'LK': 'Sri Lanka',
    'SH': 'St Helena',
    'PM': 'St Pierre and Miquelon',
    'SD': 'Sudan',
    'SR': 'Suriname',
    'SJ': 'Svalbard And Jan Mayen Islands',
    'SZ': 'Swaziland',
    'SE': 'Sweden',
    'CH': 'Switzerland',
    'SY': 'Syrian Arab Republic',
    'TW': 'Taiwan',
    'TJ': 'Tajikistan',
    'TZ': 'Tanzania',
    'TH': 'Thailand',
    'TG': 'Togo',
    'TK': 'Tokelau',
    'TO': 'Tonga',
    'TT': 'Trinidad And Tobago',
    'TN': 'Tunisia',
    'TR': 'Turkey',
    'TM': 'Turkmenistan',
    'TC': 'Turks And Caicos Islands',
    'TV': 'Tuvalu',
    'UG': 'Uganda',
    'UA': 'Ukraine',
    'AE': 'United Arab Emirates',
    'UM': 'U.S.Minor Outlying Islands',
    'UY': 'Uruguay',
    'UZ': 'Uzbekistan',
    'VU': 'Vanuatu',
    'VA': 'Vatican City State',
    'VE': 'Venezuela',
    'VN': 'Viet Nam',
    'VG': 'Virgin Islands(British)',
    'VI': 'Virgin Islands(U.S.)',
    'WF': 'Wallis And Futuna Islands',
    'EH': 'Western Sahara',
    'YE': 'Yemen',
    'ZR': 'Zaire',
    'ZM': 'Zambia',
    'ZW': 'Zimbabwe'
};
(function() {
    var iOSCheckbox,
        matched,
        userAgent,
        __slice = Array.prototype.slice;
    if ($.browser == null) {
        userAgent = navigator.userAgent || '';
        jQuery.uaMatch = function(ua) {
            var match;
            ua = ua.toLowerCase();
            match = /(chrome)[ \/]([\w.]+)/.exec(ua) || /(webkit)[ \/]([\w.]+)/.exec(ua) || /(opera)(?:.*version)?[ \/]([\w.]+)/.exec(ua) || /(msie) ([\w.]+)/.exec(ua) || ua.indexOf('compatible') < 0 && /(mozilla)(?:.*? rv:([\w.]+))?/.exec(ua) || [];
            return {
                browser: match[1] || '',
                version: match[2] || '0'
            };
        };
        matched = jQuery.uaMatch(userAgent);
        jQuery.browser = {};
        if (matched.browser) {
            jQuery.browser[matched.browser] = true;
            jQuery.browser.version = matched.version;
        }
        if (jQuery.browser.webkit) jQuery.browser.safari = true;
    }
    iOSCheckbox = (function() {
        function iOSCheckbox(elem, options) {
            var key,
                opts,
                value;
            this.elem = $(elem);
            opts = $.extend({}, iOSCheckbox.defaults, options);
            for (key in opts) {
                value = opts[key];
                this[key] = value;
            }
            this.elem.data(this.dataName, this);
            this.wrapCheckboxWithDivs();
            this.attachEvents();
            this.disableTextSelection();
            if (this.resizeHandle) this.optionallyResize('handle');
            if (this.resizeContainer) this.optionallyResize('container');
            this.initialPosition();
        }
        iOSCheckbox.prototype.isDisabled = function() {
            return this.elem.is(':disabled');
        };
        iOSCheckbox.prototype.wrapCheckboxWithDivs = function() {
            this.elem.wrap('<div class=\'' + this.containerClass + '\' />');
            this.container = this.elem.parent();
            this.offLabel = $('<label class=\'' + this.labelOffClass + '\'>\n  <span>' + this.uncheckedLabel + '</span>\n</label>').appendTo(this.container);
            this.offSpan = this.offLabel.children('span');
            this.onLabel = $('<label class=\'' + this.labelOnClass + '\'>\n  <span>' + this.checkedLabel + '</span>\n</label>').appendTo(this.container);
            this.onSpan = this.onLabel.children('span');
            return this.handle = $('<div class=\'' + this.handleClass + '\'>\n  <div class=\'' + this.handleRightClass + '\'>\n    <div class=\'' + this.handleCenterClass + '\' />\n  </div>\n</div>').appendTo(this.container);
        };
        iOSCheckbox.prototype.disableTextSelection = function() {
            if ($.browser.msie) {
                return $([this.handle,
                    this.offLabel,
                    this.onLabel,
                    this.container
                ]).attr('unselectable', 'on');
            }
        };
        iOSCheckbox.prototype._getDimension = function(elem, dimension) {
            if ($.fn.actual != null) {
                return elem.actual(dimension);
            } else {
                return elem[dimension]();
            }
        };
        iOSCheckbox.prototype.optionallyResize = function(mode) {
            var newWidth,
                offLabelWidth,
                onLabelWidth;
            onLabelWidth = this._getDimension(this.onLabel, 'width');
            offLabelWidth = this._getDimension(this.offLabel, 'width');
            if (mode === 'container') {
                newWidth = onLabelWidth > offLabelWidth ? onLabelWidth : offLabelWidth;
                newWidth += this._getDimension(this.handle, 'width') + this.handleMargin;
                return this.container.css({
                    width: newWidth
                });
            } else {
                newWidth = onLabelWidth > offLabelWidth ? onLabelWidth : offLabelWidth;
                return this.handle.css({
                    width: newWidth
                });
            }
        };
        iOSCheckbox.prototype.onMouseDown = function(event) {
            var x;
            event.preventDefault();
            if (this.isDisabled()) return;
            x = event.pageX || event.originalEvent.changedTouches[0].pageX;
            iOSCheckbox.currentlyClicking = this.handle;
            iOSCheckbox.dragStartPosition = x;
            return iOSCheckbox.handleLeftOffset = parseInt(this.handle.css('left'), 10) || 0;
        };
        iOSCheckbox.prototype.onDragMove = function(event, x) {
            var newWidth,
                p;
            if (iOSCheckbox.currentlyClicking !== this.handle) return;
            p = (x + iOSCheckbox.handleLeftOffset - iOSCheckbox.dragStartPosition) / this.rightSide;
            if (p < 0) p = 0;
            if (p > 1) p = 1;
            newWidth = p * this.rightSide;
            this.handle.css({
                left: newWidth
            });
            this.onLabel.css({
                width: newWidth + this.handleRadius
            });
            this.offSpan.css({
                marginRight: -newWidth
            });
            return this.onSpan.css({
                marginLeft: -(1 - p) * this.rightSide
            });
        };
        iOSCheckbox.prototype.onDragEnd = function(event, x) {
            var p;
            if (iOSCheckbox.currentlyClicking !== this.handle) return;
            if (this.isDisabled()) return;
            if (iOSCheckbox.dragging) {
                p = (x - iOSCheckbox.dragStartPosition) / this.rightSide;
                this.elem.prop('checked', p >= 0.5);
            } else {
                this.elem.prop('checked', !this.elem.prop('checked'));
            }
            iOSCheckbox.currentlyClicking = null;
            iOSCheckbox.dragging = null;
            return this.didChange();
        };
        iOSCheckbox.prototype.refresh = function() {
            return this.didChange();
        };
        iOSCheckbox.prototype.didChange = function() {
            var new_left;
            if (typeof this.onChange === 'function') {
                this.onChange(this.elem, this.elem.prop('checked'));
            }
            if (this.isDisabled()) {
                this.container.addClass(this.disabledClass);
                return false;
            } else {
                this.container.removeClass(this.disabledClass);
            }
            new_left = this.elem.prop('checked') ? this.rightSide : 0;
            this.handle.animate({
                left: new_left
            }, this.duration);
            this.onLabel.animate({
                width: new_left + this.handleRadius
            }, this.duration);
            this.offSpan.animate({
                marginRight: -new_left
            }, this.duration);
            return this.onSpan.animate({
                marginLeft: new_left - this.rightSide
            }, this.duration);
        };
        iOSCheckbox.prototype.attachEvents = function() {
            var localMouseMove,
                localMouseUp,
                self;
            self = this;
            localMouseMove = function(event) {
                return self.onGlobalMove.apply(self, arguments);
            };
            localMouseUp = function(event) {
                self.onGlobalUp.apply(self, arguments);
                $(document).unbind('mousemove touchmove', localMouseMove);
                return $(document).unbind('mouseup touchend', localMouseUp);
            };
            this.elem.change(function() {
                return self.refresh();
            });
            return this.container.bind('mousedown touchstart', function(event) {
                self.onMouseDown.apply(self, arguments);
                $(document).bind('mousemove touchmove', localMouseMove);
                return $(document).bind('mouseup touchend', localMouseUp);
            });
        };
        iOSCheckbox.prototype.initialPosition = function() {
            var containerWidth,
                offset;
            containerWidth = this._getDimension(this.container, 'width');
            this.offLabel.css({
                width: containerWidth - this.containerRadius
            });
            offset = this.containerRadius + 1;
            if ($.browser.msie && $.browser.version < 7) offset -= 3;
            this.rightSide = containerWidth - this._getDimension(this.handle, 'width') - offset;
            if (this.elem.is(':checked')) {
                this.handle.css({
                    left: this.rightSide
                });
                this.onLabel.css({
                    width: this.rightSide + this.handleRadius
                });
                this.offSpan.css({
                    marginRight: -this.rightSide
                });
            } else {
                this.onLabel.css({
                    width: 0
                });
                this.onSpan.css({
                    marginLeft: -this.rightSide
                });
            }
            if (this.isDisabled()) return this.container.addClass(this.disabledClass);
        };
        iOSCheckbox.prototype.onGlobalMove = function(event) {
            var x;
            if (!(!this.isDisabled() && iOSCheckbox.currentlyClicking)) return;
            event.preventDefault();
            x = event.pageX || event.originalEvent.changedTouches[0].pageX;
            if (!iOSCheckbox.dragging && (Math.abs(iOSCheckbox.dragStartPosition - x) > this.dragThreshold)) {
                iOSCheckbox.dragging = true;
            }
            return this.onDragMove(event, x);
        };
        iOSCheckbox.prototype.onGlobalUp = function(event) {
            var x;
            if (!iOSCheckbox.currentlyClicking) return;
            event.preventDefault();
            x = event.pageX || event.originalEvent.changedTouches[0].pageX;
            this.onDragEnd(event, x);
            return false;
        };
        iOSCheckbox.defaults = {
            duration: 200,
            checkedLabel: 'ON',
            uncheckedLabel: 'OFF',
            resizeHandle: true,
            resizeContainer: true,
            disabledClass: 'iPhoneCheckDisabled',
            containerClass: 'iPhoneCheckContainer',
            labelOnClass: 'iPhoneCheckLabelOn',
            labelOffClass: 'iPhoneCheckLabelOff',
            handleClass: 'iPhoneCheckHandle',
            handleCenterClass: 'iPhoneCheckHandleCenter',
            handleRightClass: 'iPhoneCheckHandleRight',
            dragThreshold: 0,
            handleMargin: 0,
            handleRadius: 36,
            containerRadius: 0,
            dataName: 'iphoneStyle',
            onChange: function() {}
        };
        return iOSCheckbox;
    })();
    $.iphoneStyle = this.iOSCheckbox = iOSCheckbox;
    $.fn.iphoneStyle = function() {
        var args,
            checkbox,
            dataName,
            existingControl,
            method,
            params,
            _i,
            _len,
            _ref,
            _ref2,
            _ref3,
            _ref4;
        args = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
        dataName = (_ref = (_ref2 = args[0]) != null ? _ref2.dataName : void 0) != null ? _ref : iOSCheckbox.defaults.dataName;
        _ref3 = this.filter(':checkbox');
        for (_i = 0, _len = _ref3.length; _i < _len; _i++) {
            checkbox = _ref3[_i];
            existingControl = $(checkbox).data(dataName);
            if (existingControl != null) {
                method = args[0],
                params = 2 <= args.length ? __slice.call(args, 1) : [];
                if ((_ref4 = existingControl[method]) != null) {
                    _ref4.apply(existingControl, params);
                }
            } else {
                new iOSCheckbox(checkbox, args[0]);
            }
        }
        return this;
    };
    $.fn.iOSCheckbox = function(options) {
        var opts;
        if (options == null) options = {};
        opts = $.extend({}, options, {
            resizeHandle: false,
            disabledClass: 'iOSCheckDisabled',
            containerClass: 'iOSCheckContainer',
            labelOnClass: 'iOSCheckLabelOn',
            labelOffClass: 'iOSCheckLabelOff',
            handleClass: 'iOSCheckHandle',
            handleCenterClass: 'iOSCheckHandleCenter',
            handleRightClass: 'iOSCheckHandleRight',
            dataName: 'iOSCheckbox'
        });
        return this.iphoneStyle(opts);
    };
}).call(this);
//     Int64.js
//
//     Copyright (c) 2012 Robert Kieffer
//     MIT License - http://opensource.org/licenses/mit-license.php
/**
 * Support for handling 64-bit int numbers in Javascript (node.js)
 *
 * JS Numbers are IEEE-754 binary double-precision floats, which limits the
 * range of values that can be represented with integer precision to:
 *
 * 2^^53 <= N <= 2^53
 *
 * Int64 objects wrap a node Uint8Array that holds the 8-bytes of int64 data.  These
 * objects operate directly on the buffer which means that if they are created
 * using an existing buffer then setting the value will modify the Uint8Array, and
 * vice-versa.
 *
 * Internal Representation
 *
 * The internal buffer format is Big Endian.  I.e. the most-significant byte is
 * at buffer[0], the least-significant at buffer[7].  For the purposes of
 * converting to/from JS native numbers, the value is assumed to be a signed
 * integer stored in 2's complement form.
 *
 * For details about IEEE-754 see:
 * http://en.wikipedia.org/wiki/Double_precision_floating-point_format
 */
// Useful masks and values for bit twiddling
var MASK31 = 2147483647,
    VAL31 = 2147483648;
var MASK32 = 4294967295,
    VAL32 = 4294967296;
// Map for converting hex octets to strings
var _HEX = [];
for (var i = 0; i < 256; i++) {
    _HEX[i] = (i > 15 ? '' : '0') + i.toString(16);
}
//
// Int64
//
/**
 * Constructor accepts any of the following argument types:
 *
 * new Int64(buffer[, offset=0]) - Existing Uint8Array with byte offset
 * new Int64(string)             - Hex string (throws if n is outside int64 range)
 * new Int64(number)             - Number (throws if n is outside int64 range)
 * new Int64(hi, lo)             - Raw bits as two 32-bit values
 */

var Int64 = function(a1, a2) {
    if (a1 instanceof Uint8Array) {
        this.buffer = a1;
        this.offset = a2 || 0;
    } else {
        this.buffer = this.buffer || new Uint8Array(8);
        this.offset = 0;
        this.setValue.apply(this, arguments);
    }
};
// Max integer value that JS can accurately represent
Int64.MAX_INT = Math.pow(2, 53);
// Min integer value that JS can accurately represent
Int64.MIN_INT = -Math.pow(2, 53);
Int64.prototype = {
    /**
     * Do in-place 2's compliment.  See
     * http://en.wikipedia.org/wiki/Two's_complement
     */
    _2scomp: function() {
        var b = this.buffer,
            o = this.offset,
            carry = 1;
        for (var i = o + 7; i >= o; i--) {
            var v = (b[i] ^ 255) + carry;
            b[i] = v & 255;
            carry = v >> 8;
        }
    },
    /**
     * Set the value. Takes any of the following arguments:
     *
     * setValue(string) - A hexidecimal string
     * setValue(number) - Number (throws if n is outside int64 range)
     * setValue(hi, lo) - Raw bits as two 32-bit values
     */
    setValue: function(hi, lo) {
        var negate = false;
        if (arguments.length == 1) {
            if (typeof(hi) == 'number') {
                // Simplify bitfield retrieval by using abs() value.  We restore sign
                // later
                negate = hi < 0;
                hi = Math.abs(hi);
                lo = hi % VAL32;
                hi = hi / VAL32;
                if (hi > VAL32) throw new RangeError(hi + ' is outside Int64 range');
                hi = hi | 0;
            } else if (typeof(hi) == 'string') {
                hi = (hi + '').replace(/^0x/, '');
                lo = hi.substr(-8);
                hi = hi.length > 8 ? hi.substr(0, hi.length - 8) : '';
                hi = parseInt(hi, 16);
                lo = parseInt(lo, 16);
            } else {
                throw new Error(hi + ' must be a Number or String');
            }
        }
        // Technically we should throw if hi or lo is outside int32 range here, but
        // it's not worth the effort. Anything past the 32'nd bit is ignored.
        // Copy bytes to buffer

        var b = this.buffer,
            o = this.offset;
        for (var i = 7; i >= 0; i--) {
            b[o + i] = lo & 255;
            lo = i == 4 ? hi : lo >>> 8;
        }
        // Restore sign of passed argument

        if (negate) this._2scomp();
    },
    /**
     * Convert to a native JS number.
     *
     * WARNING: Do not expect this value to be accurate to integer precision for
     * large (positive or negative) numbers!
     *
     * @param allowImprecise If true, no check is performed to verify the
     * returned value is accurate to integer precision.  If false, imprecise
     * numbers (very large positive or negative numbers) will be forced to +/-
     * Infinity.
     */
    toNumber: function(allowImprecise) {
        var b = this.buffer,
            o = this.offset;
        // Running sum of octets, doing a 2's complement
        var negate = b[0] & 128,
            x = 0,
            carry = 1;
        for (var i = 7, m = 1; i >= 0; i--, m *= 256) {
            var v = b[o + i];
            // 2's complement for negative numbers
            if (negate) {
                v = (v ^ 255) + carry;
                carry = v >> 8;
                v = v & 255;
            }
            x += v * m;
        }
        // Return Infinity if we've lost integer precision

        if (!allowImprecise && x >= Int64.MAX_INT) {
            return negate ? -Infinity : Infinity;
        }
        return negate ? -x : x;
    },
    /**
     * Convert to a JS Number. Returns +/-Infinity for values that can't be
     * represented to integer precision.
     */
    valueOf: function() {
        return this.toNumber(false);
    },
    /**
     * Return string value
     *
     * @param radix Just like Number#toString()'s radix
     */
    toString: function(radix) {
        return this.valueOf().toString(radix || 10);
    },
    /**
     * Return a string showing the buffer octets, with MSB on the left.
     *
     * @param sep separator string. default is '' (empty string)
     */
    toOctetString: function(sep) {
        var out = new Array(8);
        var b = this.buffer,
            o = this.offset;
        for (var i = 0; i < 8; i++) {
            out[i] = _HEX[b[o + i]];
        }
        return out.join(sep || '');
    },
    /**
     * Pretty output in console.log
     */
    inspect: function() {
        return '[Int64 value:' + this + ' octets:' + this.toOctetString(' ') + ']';
    }
};
/* ezBuffer {{{ */
/**
 *  Your best friend when dealing with buffers
 *
 *  TODO: Perhaps I should be public
 */
function ezBuffer(size) {
    var obj = new Uint8Array(size),
        buffer = new DataView(obj.buffer),
        offset = 0;
    return {
        debug: function() {
            console.error(['DEBUG',
                offset,
                obj.length
            ]);
        },
        getArray: function() {
            var bytes = []
            $.each(obj, function(i, val) {
                bytes.push(val);
            });
            return bytes;
        },
        getBytes: function() {
            return obj;
        },
        appendBytes: function(text) {
            var isArray = typeof text != 'string';
            for (var i = text.length; i--;) {
                if (isArray) {
                    obj[offset + i] = text[i];
                } else {
                    // We assume it is an string
                    obj[offset + i] = text.charCodeAt(i);
                }
            }
            offset += text.length
        },
        i64: function(number, bigendian) {
            var buffer = new Int64(number).buffer
            if (!bigendian) {
                // swap the by orders
                var nbuffer = new Uint8Array(buffer.length),
                    len = buffer.length - 1
                for (var i = len; i >= 0; i--) {
                    nbuffer[i] = buffer[len - i]
                }
                buffer = nbuffer;
            }
            // append the buffer

            this.appendBytes(buffer);
        },
        i32: function(number, bigendian) {
            buffer.setInt32(offset, number, !bigendian);
            offset += 4;
        },
        i16: function(number, bigendian) {
            buffer.setInt16(offset, number, !bigendian);
            offset += 2;
        },
        i8: function(number, bigendian) {
            buffer.setInt8(offset, number, !bigendian);
            offset += 1;
        },
        resize: function(newsize) {
            var zclass = obj.constructor,
                zobj = new zclass(newsize)
            zobj.set(obj, 0);
            obj = zobj;
            buffer = new DataView(obj.buffer)
            return obj;
        },
        /**
         *  Check if the current bytestream has enough
         *  size to add "size" more bytes. If it doesn't have
         *  we return a new bytestream object
         */
        resizeIfNeeded: function(size) {
            if (obj.length < (size + offset)) {
                return this.resize(size + offset);
            }
            return obj;
        }
    };
}
/* }}} */

var Zips = {};
var ZIPClass = function(totalSize) {
        var self = this,
            maxZipSize = Math.pow(2, 31) * 0.9,
            isZip64 = totalSize > maxZipSize || localStorage.zip64 == 1
        this.isZip64 = isZip64 /* make it public */
        if (isZip64 && !localStorage.zip64warnShown) {
            localStorage.zip64warnShown = !0;
            msgDialog('warninga', l[34], l[2033]);
        }
        // Constants

        var fileHeaderLen = 30,
            noCompression = 0,
            zipVersion = isZip64 ? 45 : 20,
            defaultFlags = 2056 /* UTF-8 */ ,
            i32max = 4294967295,
            i16max = 65535,
            zip64ExtraId = 1,
            zipUtf8ExtraId = 28789,
            directory64LocLen = 20,
            directory64EndLen = 56,
            directoryEndLen = 22,
            fileHeaderSignature = 67324752,
            directory64LocSignature = 117853008,
            directory64EndSignature = 101075792,
            directoryEndSignature = 101010256,
            dataDescriptorSignature = 134695760 // de-facto standard; required by OS X Finder
            ,
            directoryHeaderSignature = 33639248,
            dataDescriptorLen = 16,
            dataDescriptor64Len = 24,
            directoryHeaderLen = 46
            /* ZipHeader  {{{ */
            /**
             *  ZipHeader struct
             */

        function ZipHeader() {
            this.readerVersion = zipVersion;
            this.Flags = defaultFlags;
            this.Method = noCompression;
            this.date = 0
            this.crc32 = 0;
            this.size = 0;
            this.unsize = 0;
            this.file = '';
            this.extra = [];
            this.getBytes = function() {
                var buf = ezBuffer(fileHeaderLen + this.file.length + this.extra.length);
                buf.i32(fileHeaderSignature)
                buf.i16(this.readerVersion);
                buf.i16(this.Flags)
                buf.i16(this.Method)
                DosDateTime(this.date, buf)
                buf.i32(this.crc32); // crc32
                buf.i32(this.size); // compress size
                buf.i32(this.unsize); // uncompress size
                buf.i16(this.file.length);
                buf.i16(this.extra.length);
                buf.appendBytes(this.file);
                buf.appendBytes(this.extra);
                return buf.getBytes();
            }
        }
        /** }}} */
        // ZipCentralDirectory {{{

        function ZipCentralDirectory() {
            this.creatorVersion = zipVersion;
            this.readerVersion = zipVersion;
            this.Flags = defaultFlags;
            this.Method = noCompression;
            this.date = 0;
            this.crc32 = 0;
            this.file = ''
            this.size = 0; // compressed size
            this.unsize = 0; // uncompressed size
            this.offset = 0;
            this.externalAttr = 0;
            this.getBytes = function() {
                var extra = [],
                    ebuf
                if (isZip64) {
                    ebuf = ezBuffer(28); // 2xi16 + 3xi64
                    ebuf.i16(zip64ExtraId);
                    ebuf.i16(24);
                    ebuf.i64(this.size);
                    ebuf.i64(this.unsize);
                    ebuf.i64(this.offset);
                    extra = extra.concat(ebuf.getArray());
                }
                var buf = ezBuffer(directoryHeaderLen + this.file.length + extra.length);
                buf.i32(directoryHeaderSignature);
                buf.i16(this.creatorVersion);
                buf.i16(this.readerVersion);
                buf.i16(this.Flags);
                buf.i16(this.Method)
                DosDateTime(this.date, buf)
                buf.i32(this.crc32);
                buf.i32(isZip64 ? i32max : this.size);
                buf.i32(isZip64 ? i32max : this.unsize);
                buf.i16(this.file.length);
                buf.i16(extra.length);
                buf.i16(0); // no comments
                buf.i32(0); // disk number
                buf.i32(this.externalAttr);
                buf.i32(isZip64 ? i32max : this.offset);
                buf.appendBytes(this.file);
                buf.appendBytes(extra);
                return buf.getBytes();
            }
        }
        // }}}
        // ZipDataDescriptor {{{

        function ZipDataDescriptor() {
            this.crc32 = 0;
            this.size = 0;
            this.unsize = 0;
            this.getBytes = function() {
                var buf = ezBuffer(isZip64 ? dataDescriptor64Len : dataDescriptorLen);
                buf.i32(dataDescriptorSignature);
                buf.i32(this.crc32);
                if (isZip64) {
                    buf.i64(this.size);
                    buf.i64(this.unsize);
                } else {
                    buf.i32(this.size);
                    buf.i32(this.unsize);
                }
                return buf.getBytes();
            };
        }
        // }}}
        // DosDateTime {{{
        /**
         *  Set an unix time (or now if missing) in the zip
         *  expected format
         */

        function DosDateTime(sec, buf) {
            var date = new Date(),
                dosTime,
                dosDate
            if (sec) {
                date = new Date(sec * 1000);
            }
            dosTime = date.getHours();
            dosTime = dosTime << 6;
            dosTime = dosTime | date.getMinutes();
            dosTime = dosTime << 5;
            dosTime = dosTime | date.getSeconds() / 2;
            dosDate = date.getFullYear() - 1980;
            dosDate = dosDate << 4;
            dosDate = dosDate | (date.getMonth() + 1);
            dosDate = dosDate << 5;
            dosDate = dosDate | date.getDate();
            buf.i16(dosTime);
            buf.i16(dosDate);
        }
        // }}}

        self.writeCentralDir = function(filename, size, time, crc32, directory, headerpos) {
            filename = to8(filename)
            var dirRecord = new ZipCentralDirectory();
            dirRecord.file = filename;
            dirRecord.date = time;
            dirRecord.size = size;
            dirRecord.unsize = size;
            dirRecord.crc32 = crc32;
            dirRecord.offset = headerpos;
            dirRecord.externalAttr = directory ? 1 : 0;
            var dataDescriptor = new ZipDataDescriptor();
            dataDescriptor.crc32 = crc32;
            dataDescriptor.size = size;
            dataDescriptor.unsize = size;
            return {
                dirRecord: dirRecord.getBytes(),
                dataDescriptor: dataDescriptor.getBytes()
            };
        }
        self.writeSuffix = function(pos, dirData) {
            var dirDatalength = 0;
            for (var i in dirData) dirDatalength += dirData[i].length;
            var buf = ezBuffer(22);
            if (isZip64) {
                var xbuf = new ezBuffer(directory64EndLen + directory64LocLen)
                xbuf.i32(directory64EndSignature)
                // directory64EndLen - 4 bytes - 8 bytes
                xbuf.i64(directory64EndLen - 4 - 8)
                xbuf.i16(zipVersion)
                xbuf.i16(zipVersion)
                xbuf.i32(0) // disk number
                xbuf.i32(0) // number of the disk with the start of the central directory
                xbuf.i64(dirData.length)
                xbuf.i64(dirData.length)
                xbuf.i64(dirDatalength);
                xbuf.i64(pos);
                xbuf.i32(directory64LocSignature)
                xbuf.i32(0)
                xbuf.i64(pos + dirDatalength)
                xbuf.i32(1) // total number of disks
                buf.resize(22 + xbuf.getBytes().length)
                buf.appendBytes(xbuf.getBytes());
            }
            buf.i32(directoryEndSignature)
            buf.i32(0); // skip
            buf.i16(isZip64 ? i16max : dirData.length)
            buf.i16(isZip64 ? i16max : dirData.length)
            buf.i32(isZip64 ? i32max : dirDatalength);
            buf.i32(isZip64 ? i32max : pos);
            buf.i16(0); // no comments
            return buf.getBytes();
        };
        self.writeHeader = function(filename, size, date) {
            filename = to8(filename)
            var header = new ZipHeader();
            header.file = filename;
            header.size = size;
            header.date = date;
            var ebuf = ezBuffer(1 + 4 + 4 + filename.length)
            ebuf.i16(zipUtf8ExtraId)
            ebuf.i16(5 + filename.length) // size
            ebuf.i8(1) // version
            ebuf.i32(crc32(filename))
            ebuf.appendBytes(filename)
            header.extra = ebuf.getArray();
            return header.getBytes();
        }
    }
    /**
     *	ZipEntryIO
     *
     *	It implements a FileIO object but underneath it writes using
     *	`ZipWriter.write()` method. This object adds a few bytes before and after
     *	the buffer itself, some zip structures.
     */

function ZipEntryIO(zipWriter, aFile) {
    this.file = aFile;
    this.zipWriter = zipWriter;
    this.queued = 0
};
ZipEntryIO.prototype.toString = function() {
    return '[ZipEntry ' + (this.file && this.file.n) + ']';
};
ZipEntryIO.prototype.destroy = function() {
    if (d) console.log('Destroying ' + this);
    if (this.file) oDestroy(this);
};
ZipEntryIO.prototype.abort = function(e) {
    if (this.zipWriter) {
        // this.zipWriter.destroy(e);
        this.destroy();
    }
};
ZipEntryIO.prototype.isEmpty = function() {
    return this.queued == 0;
}
ZipEntryIO.prototype.setCredentials = function() {
    this.begin();
};
ZipEntryIO.prototype.push = function(obj) {
    this.queued++
    obj.zfile = this;
    this.zipWriter.zwriter.push(obj, function() {
        this.queued--
        if (this.file.ready) this.file.ready();
    }.bind(this));
};

function ZipWriter(dl_id, dl) {
    this.dl = dl;
    this.size = 0
    this.nfiles = 0
    this.is_ready = false
    this.queues = [];
    this.hashes = {};
    this.dirData = [];
    this.offset = 0;
    this.file_offset = 0;
    if ((dlMethod === FileSystemAPI) || ((typeof FirefoxIO !== 'undefined') && dlMethod === FirefoxIO)) {
        this.io = new CacheIO(dl_id, dl);
    } else this.io = new dlMethod(dl_id, dl)
    this.io.is_zip = true;
    this.zwriter = new MegaQueue(dlZipWriterIOWorker.bind(this), 1);
    this.zwriter.validateTask = dlZipWriterValidate.bind(this);
    this.io.begin = function() {
        this.is_ready = true;
        this.zwriter.process();
    }.bind(this);
}
ZipWriter.prototype.toString = function() {
    return '[ZipWriter ' + (this.dl && this.dl.zipname) + ']';
};
ZipWriter.prototype.createZipObject = function() {
    if (!this.ZipObject) {
        this.ZipObject = new ZIPClass(this.size);
        if (this.ZipObject.isZip64) {
            this.size += this.nfiles * 28 // extra bytes for each ZipCentralDirectory 
            this.size += this.nfiles * 24 // extra bytes for each dataDescriptor
            this.size += 98 // final bytes
        } else {
            this.size += this.nfiles * 16 // extra bytes for each dataDescriptor
            this.size += 22 // final bytes
        }
        this.io.setCredentials('', this.size, this.dl.zipname);
        ERRDEBUG('isZip64', this.ZipObject.isZip64, this.size);
    }
    return this.ZipObject;
};
ZipWriter.prototype.destroy = function(error) {
    if (d) console.log('Destroying ' + this, this.cancelled);
    if (this.dl) {
        var dl = this.dl;
        this.zwriter.destroy();
        delete Zips[dl.zipid];
        delete GlobalProgress['zip_' + dl.zipid];
        if (error || this.cancelled) {
            if (this.io.abort) this.io.abort(error || this);
        } else if (dlMethod != FlashIO) DownloadManager.cleanupUI(dl, true);
        oDestroy(this);
    }
}

function dlZipWriterIOWorker(task, done) {
    var file = task.zfile.file;
    if (typeof file === 'undefined') {
        if (d) console.error('File aborted...', task);
        return done();
    }
    this.hashes[file.id] = crc32(task.data, this.hashes[file.id] || 0, task.data.byteLength)
    this.file_offset += task.data.byteLength;
    var buffer = task.data;
    if (task.offset === 0) {
        var header = this.ZipObject.writeHeader(file.p + file.n, file.size, file.t);
        task.zfile.file.io.entryPos = this.offset;
        /* prepend header data to the block */
        var d = new Uint8Array(header.byteLength + buffer.byteLength);
        d.set(header, 0);
        d.set(buffer, header.byteLength);
        /* replace task.data */
        delete task.data;
        buffer = d
    }
    this.io.write(buffer, this.offset, done);
    this.offset += buffer.byteLength;
}

function dlZipWriterValidate(t) {
    if (!this.ZipObject) {
        this.createZipObject(); /* create the zipobject if it doesnt exists */
    }
    return this.is_ready && t.zfile == this.queues[0] && t.offset == this.file_offset;
};
ZipWriter.prototype.done = function(zfile) {
    var file = zfile.dl;
    var centralDir = this.ZipObject.writeCentralDir(file.p + file.n, file.size, file.t, this.hashes[file.id], false, file.io.entryPos);
    this.dirData.push(centralDir.dirRecord)
    this.zwriter.pause(); /* pause all IO */
    this.queues.shift();
    var buffer = centralDir.dataDescriptor
    if (this.queues.length == 0) {
        var end = this.ZipObject.writeSuffix(buffer.byteLength + this.offset, this.dirData),
            size = 0,
            offset = buffer.byteLength,
            buf
        for (var i in this.dirData) {
            size += this.dirData[i].byteLength;
        }
        buf = new Uint8Array(buffer.byteLength + size + end.byteLength);
        buf.set(buffer, 0);
        for (var i in this.dirData) {
            buf.set(this.dirData[i], offset);
            offset += this.dirData[i].byteLength;
        }
        buf.set(end, offset);
        delete buffer;
        return this.io.write(buf, this.offset, this._eof.bind(this));
    }
    this.io.write(buffer, this.offset, this.finalize_file.bind(this));
    this.offset += buffer.byteLength;
}
ZipWriter.prototype.finalize_file = function() {
    this.file_offset = 0;
    this.zwriter.resume();
};
ZipWriter.prototype._eof = function() {
    this.dl.onBeforeDownloadComplete(this.dl.pos);
    this.io.download(this.dl.zipname, '');
    this.dl.onDownloadComplete(this.dl);
    this.destroy();
};
ZipWriter.prototype.addEntryFile = function(file) {
    var io = new ZipEntryIO(this, file);
    this.queues.push(io);
    this.nfiles++
    this.size += file.size + 30 + 9 + 2 * (file.p.length + file.n.length) /* header */ + 46 + file.p.length + file.n.length /* dirRecord */
    return io;
};
/**
 * CacheIO, intended to minimize real disk I/O when
 *          creating ZIPs with several small files.
 */
function CacheIO(dl_id, dl) {
    var IO,
        u8buf,
        offsetI = 0,
        offsetO = 0,
        __max_chunk_size = 32 * 1048576;
    if (d) console.log('Creating new CacheIO instance', dl_id, dl);

    function PUSH(done, buffer) {
        if (!buffer) buffer = u8buf.subarray(0, offsetI);
        IO.write(buffer, offsetO, done);
        offsetO += buffer.byteLength;
    }

    function FILL(buffer) {
        u8buf.set(buffer, offsetI);
        offsetI += buffer.byteLength;
    }
    this.write = function(buffer, offset, done) {
        if (d) console.log('CacheIOing...', buffer.byteLength, offset, offsetI, offsetO);
        if (offsetI + buffer.byteLength > __max_chunk_size) {
            function next() {
                if (next.write) {
                    next.write();
                    next.write = 0;
                } else {
                    if (buffer) FILL(buffer);
                    next.done();
                }
            }
            next.done = done;
            if (offsetI) PUSH(next);
            if (buffer.byteLength > __max_chunk_size) {
                next.write = function() {
                    PUSH(next, buffer);
                    buffer = undefined;
                };
                if (!offsetI) Soon(next);
            }
            offsetI = 0;
        } else {
            FILL(buffer);
            Soon(done);
        }
    };
    this.download = function(name, path) {
        function finish() {
            IO.download.apply(IO, args);
            u8buf = undefined;
        }
        var args = arguments;
        if (offsetI) {
            PUSH(finish);
        } else {
            finish();
        }
    };
    this.setCredentials = function(url, size) {
        if (d) console.log('CacheIO Begin', dl_id, arguments);
        if (this.is_zip || !dl.zipid) {
            __max_chunk_size = Math.min(size + 4194304, __max_chunk_size);
            u8buf = new Uint8Array(__max_chunk_size);
            IO = new dlMethod(dl_id, dl);
            IO.begin = this.begin;
            IO.is_zip = this.is_zip;
            IO.setCredentials.apply(IO, arguments);
        } else this.begin();
    };
    this.abort = function() {
        u8buf = undefined;
        if (IO && IO.abort) IO.abort.apply(IO, arguments);
    };
}
// crc32 {{{

var crc32table = [
    0,
    1996959894,
    3993919788,
    2567524794,
    124634137,
    1886057615,
    3915621685,
    2657392035,
    249268274,
    2044508324,
    3772115230,
    2547177864,
    162941995,
    2125561021,
    3887607047,
    2428444049,
    498536548,
    1789927666,
    4089016648,
    2227061214,
    450548861,
    1843258603,
    4107580753,
    2211677639,
    325883990,
    1684777152,
    4251122042,
    2321926636,
    335633487,
    1661365465,
    4195302755,
    2366115317,
    997073096,
    1281953886,
    3579855332,
    2724688242,
    1006888145,
    1258607687,
    3524101629,
    2768942443,
    901097722,
    1119000684,
    3686517206,
    2898065728,
    853044451,
    1172266101,
    3705015759,
    2882616665,
    651767980,
    1373503546,
    3369554304,
    3218104598,
    565507253,
    1454621731,
    3485111705,
    3099436303,
    671266974,
    1594198024,
    3322730930,
    2970347812,
    795835527,
    1483230225,
    3244367275,
    3060149565,
    1994146192,
    31158534,
    2563907772,
    4023717930,
    1907459465,
    112637215,
    2680153253,
    3904427059,
    2013776290,
    251722036,
    2517215374,
    3775830040,
    2137656763,
    141376813,
    2439277719,
    3865271297,
    1802195444,
    476864866,
    2238001368,
    4066508878,
    1812370925,
    453092731,
    2181625025,
    4111451223,
    1706088902,
    314042704,
    2344532202,
    4240017532,
    1658658271,
    366619977,
    2362670323,
    4224994405,
    1303535960,
    984961486,
    2747007092,
    3569037538,
    1256170817,
    1037604311,
    2765210733,
    3554079995,
    1131014506,
    879679996,
    2909243462,
    3663771856,
    1141124467,
    855842277,
    2852801631,
    3708648649,
    1342533948,
    654459306,
    3188396048,
    3373015174,
    1466479909,
    544179635,
    3110523913,
    3462522015,
    1591671054,
    702138776,
    2966460450,
    3352799412,
    1504918807,
    783551873,
    3082640443,
    3233442989,
    3988292384,
    2596254646,
    62317068,
    1957810842,
    3939845945,
    2647816111,
    81470997,
    1943803523,
    3814918930,
    2489596804,
    225274430,
    2053790376,
    3826175755,
    2466906013,
    167816743,
    2097651377,
    4027552580,
    2265490386,
    503444072,
    1762050814,
    4150417245,
    2154129355,
    426522225,
    1852507879,
    4275313526,
    2312317920,
    282753626,
    1742555852,
    4189708143,
    2394877945,
    397917763,
    1622183637,
    3604390888,
    2714866558,
    953729732,
    1340076626,
    3518719985,
    2797360999,
    1068828381,
    1219638859,
    3624741850,
    2936675148,
    906185462,
    1090812512,
    3747672003,
    2825379669,
    829329135,
    1181335161,
    3412177804,
    3160834842,
    628085408,
    1382605366,
    3423369109,
    3138078467,
    570562233,
    1426400815,
    3317316542,
    2998733608,
    733239954,
    1555261956,
    3268935591,
    3050360625,
    752459403,
    1541320221,
    2607071920,
    3965973030,
    1969922972,
    40735498,
    2617837225,
    3943577151,
    1913087877,
    83908371,
    2512341634,
    3803740692,
    2075208622,
    213261112,
    2463272603,
    3855990285,
    2094854071,
    198958881,
    2262029012,
    4057260610,
    1759359992,
    534414190,
    2176718541,
    4139329115,
    1873836001,
    414664567,
    2282248934,
    4279200368,
    1711684554,
    285281116,
    2405801727,
    4167216745,
    1634467795,
    376229701,
    2685067896,
    3608007406,
    1308918612,
    956543938,
    2808555105,
    3495958263,
    1231636301,
    1047427035,
    2932959818,
    3654703836,
    1088359270,
    936918000,
    2847714899,
    3736837829,
    1202900863,
    817233897,
    3183342108,
    3401237130,
    1404277552,
    615818150,
    3134207493,
    3453421203,
    1423857449,
    601450431,
    3009837614,
    3294710456,
    1567103746,
    711928724,
    3020668471,
    3272380065,
    1510334235,
    755167117
];

function crc32(data, crc, len) {
    if (typeof(crc) == 'undefined') crc = 0;
    if (typeof(len) == 'undefined') len = data.length;
    var x = 0;
    var y = 0;
    var off = data.length - len;
    crc = crc ^ -1;
    for (var i = 0; i < len; i++) {
        y = (crc ^ data[i + off]) & 255;
        x = crc32table[y];
        crc = (crc >>> 8) ^ x;
    }
    return crc ^ -1;
}
// }}}

jsl_done = true;
boot_done();